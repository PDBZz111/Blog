{"meta":{"version":1,"warehouse":"3.0.2"},"models":{"Asset":[{"_id":"themes/hexo-theme-matery/source/favicon.png","path":"favicon.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/css/gitment.css","path":"css/gitment.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/css/matery.css","path":"css/matery.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/css/my-gitalk.css","path":"css/my-gitalk.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/css/my.css","path":"css/my.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/js/matery.js","path":"js/matery.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/js/search.js","path":"js/search.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/avatar.jpg","path":"medias/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/comment_bg.png","path":"medias/comment_bg.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/icp.png","path":"medias/icp.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/logo.png","path":"medias/logo.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/animate/animate.min.css","path":"libs/animate/animate.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/aos/aos.css","path":"libs/aos/aos.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/aos/aos.js","path":"libs/aos/aos.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/aplayer/APlayer.min.css","path":"libs/aplayer/APlayer.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/aplayer/APlayer.min.js","path":"libs/aplayer/APlayer.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/background/canvas-nest.js","path":"libs/background/canvas-nest.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/background/ribbon-dynamic.js","path":"libs/background/ribbon-dynamic.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/background/ribbon.min.js","path":"libs/background/ribbon.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/background/ribbon-refresh.min.js","path":"libs/background/ribbon-refresh.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeBlockFuction.js","path":"libs/codeBlock/codeBlockFuction.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeLang.js","path":"libs/codeBlock/codeLang.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeCopy.js","path":"libs/codeBlock/codeCopy.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeShrink.js","path":"libs/codeBlock/codeShrink.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/cryptojs/crypto-js.min.js","path":"libs/cryptojs/crypto-js.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/dplayer/DPlayer.min.css","path":"libs/dplayer/DPlayer.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/gitalk/gitalk.css","path":"libs/gitalk/gitalk.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/gitment/gitment-default.css","path":"libs/gitment/gitment-default.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/instantpage/instantpage.js","path":"libs/instantpage/instantpage.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/jqcloud/jqcloud-1.0.4.min.js","path":"libs/jqcloud/jqcloud-1.0.4.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/jqcloud/jqcloud.css","path":"libs/jqcloud/jqcloud.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/masonry/masonry.pkgd.min.js","path":"libs/masonry/masonry.pkgd.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/others/busuanzi.pure.mini.js","path":"libs/others/busuanzi.pure.mini.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/others/clicklove.js","path":"libs/others/clicklove.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/scrollprogress/scrollProgress.min.js","path":"libs/scrollprogress/scrollProgress.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/tocbot/tocbot.css","path":"libs/tocbot/tocbot.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/tocbot/tocbot.min.js","path":"libs/tocbot/tocbot.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/cover.jpg","path":"medias/cover.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/10.jpg","path":"medias/featureimages/10.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/13.jpg","path":"medias/featureimages/13.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/15.jpg","path":"medias/featureimages/15.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/16.jpg","path":"medias/featureimages/16.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/2.jpg","path":"medias/featureimages/2.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/21.jpg","path":"medias/featureimages/21.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/22.jpg","path":"medias/featureimages/22.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/23.jpg","path":"medias/featureimages/23.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/3.jpg","path":"medias/featureimages/3.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/5.jpg","path":"medias/featureimages/5.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/7.jpg","path":"medias/featureimages/7.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/8.jpg","path":"medias/featureimages/8.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/dplayer/DPlayer.min.js","path":"libs/dplayer/DPlayer.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/gitment/gitment.js","path":"libs/gitment/gitment.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/jquery/jquery.min.js","path":"libs/jquery/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/valine/Valine.min.js","path":"libs/valine/Valine.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/0.jpg","path":"medias/banner/0.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/2.jpg","path":"medias/banner/2.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/3.jpg","path":"medias/banner/3.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/0.jpg","path":"medias/featureimages/0.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/1.jpg","path":"medias/featureimages/1.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/11.jpg","path":"medias/featureimages/11.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/12.jpg","path":"medias/featureimages/12.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/14.jpg","path":"medias/featureimages/14.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/17.jpg","path":"medias/featureimages/17.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/18.jpg","path":"medias/featureimages/18.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/19.jpg","path":"medias/featureimages/19.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/20.jpg","path":"medias/featureimages/20.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/4.jpg","path":"medias/featureimages/4.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/6.jpg","path":"medias/featureimages/6.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/9.jpg","path":"medias/featureimages/9.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.eot","path":"libs/awesome/webfonts/fa-regular-400.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.ttf","path":"libs/awesome/webfonts/fa-regular-400.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.woff","path":"libs/awesome/webfonts/fa-regular-400.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.woff2","path":"libs/awesome/webfonts/fa-regular-400.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/gitalk/gitalk.min.js","path":"libs/gitalk/gitalk.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/css/lightgallery.min.css","path":"libs/lightGallery/css/lightgallery.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.eot","path":"libs/lightGallery/fonts/lg.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.svg","path":"libs/lightGallery/fonts/lg.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.woff","path":"libs/lightGallery/fonts/lg.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.ttf","path":"libs/lightGallery/fonts/lg.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/loading.gif","path":"libs/lightGallery/img/loading.gif","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/video-play.png","path":"libs/lightGallery/img/video-play.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/youtube-play.png","path":"libs/lightGallery/img/youtube-play.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/vimeo-play.png","path":"libs/lightGallery/img/vimeo-play.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/js/lightgallery-all.min.js","path":"libs/lightGallery/js/lightgallery-all.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/materialize.min.css","path":"libs/materialize/materialize.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/materialize.min.js","path":"libs/materialize/materialize.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/css/share.min.css","path":"libs/share/css/share.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.eot","path":"libs/share/fonts/iconfont.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.svg","path":"libs/share/fonts/iconfont.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.ttf","path":"libs/share/fonts/iconfont.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.woff","path":"libs/share/fonts/iconfont.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/js/jquery.share.min.js","path":"libs/share/js/jquery.share.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/js/social-share.min.js","path":"libs/share/js/social-share.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/valine/av-min.js","path":"libs/valine/av-min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/1.jpg","path":"medias/banner/1.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/5.jpg","path":"medias/banner/5.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/6.jpg","path":"medias/banner/6.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/css/all.css","path":"libs/awesome/css/all.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.eot","path":"libs/awesome/webfonts/fa-brands-400.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.woff","path":"libs/awesome/webfonts/fa-brands-400.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.ttf","path":"libs/awesome/webfonts/fa-brands-400.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.woff2","path":"libs/awesome/webfonts/fa-brands-400.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.woff","path":"libs/awesome/webfonts/fa-solid-900.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.woff2","path":"libs/awesome/webfonts/fa-solid-900.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.svg","path":"libs/awesome/webfonts/fa-regular-400.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.eot","path":"libs/awesome/webfonts/fa-solid-900.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.ttf","path":"libs/awesome/webfonts/fa-solid-900.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/4.jpg","path":"medias/banner/4.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/reward/wechat.png","path":"medias/reward/wechat.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/reward/alipay.jpg","path":"medias/reward/alipay.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/echarts/echarts.min.js","path":"libs/echarts/echarts.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.svg","path":"libs/awesome/webfonts/fa-brands-400.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.svg","path":"libs/awesome/webfonts/fa-solid-900.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/avatar1.jpg","path":"medias/avatar1.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"themes/hexo-theme-matery/_config.yml","hash":"a47aaf88af6d0c8407041ad354ef2a50291c6cdf","modified":1661148424167},{"_id":"themes/hexo-theme-matery/languages/zh-CN.yml","hash":"5fa6da78c3d17f46c3676b5e5b704ef2ecd79550","modified":1661140288529},{"_id":"themes/hexo-theme-matery/languages/default.yml","hash":"d659ee071b32e161c2920e285b464fc917513163","modified":1661140278674},{"_id":"themes/hexo-theme-matery/layout/about.ejs","hash":"c81fd0da8a9a8e89e4b168f61eb091a848ac4f3a","modified":1661142384766},{"_id":"themes/hexo-theme-matery/layout/archive.ejs","hash":"57733d52d17361e735fcc95f875e0b1b9ebdcbd8","modified":1660412121172},{"_id":"themes/hexo-theme-matery/layout/category.ejs","hash":"4ac716d15d84e7c37f07308a5ec008a2ac090c9b","modified":1660412121172},{"_id":"themes/hexo-theme-matery/layout/categories.ejs","hash":"c431e772d0f7700592228bbd9502793bdc28a893","modified":1660412121172},{"_id":"themes/hexo-theme-matery/layout/contact.ejs","hash":"72fb5af3fc2f8955e2eb10926bbe4532a04ccd1b","modified":1660412121173},{"_id":"themes/hexo-theme-matery/layout/friends.ejs","hash":"e9716a948172e6ad46c18cc7e78770cdc46f1857","modified":1660412121173},{"_id":"themes/hexo-theme-matery/layout/index.ejs","hash":"3cabb8e3680858c1412277def37bdef73981be0f","modified":1660412121173},{"_id":"themes/hexo-theme-matery/layout/layout.ejs","hash":"e179c72cb4eef88e5168cadafa2e1c3b46fd1486","modified":1660412121173},{"_id":"themes/hexo-theme-matery/layout/post.ejs","hash":"3783bb4d7807e3a3701d67499a878c69a0a872d6","modified":1660412121173},{"_id":"themes/hexo-theme-matery/layout/tag.ejs","hash":"058eb27ff10f5314d8b9e334c54419b9a6572315","modified":1660412121173},{"_id":"themes/hexo-theme-matery/layout/tags.ejs","hash":"851c0ee599e91e7b1d657673859e8b6ff79cf50b","modified":1660412121173},{"_id":"themes/hexo-theme-matery/source/favicon.png","hash":"774fee8c6d0be9dbb010b20f36c06848d06e3da0","modified":1660412121175},{"_id":"source/_data/friends.json","hash":"7aaf75a7da831bcd0407991f3b91ea9eec3131ba","modified":1661139498314},{"_id":"source/about/index.md","hash":"f74eb97474295730c06afc7e72400720c425e25b","modified":1660412121163},{"_id":"source/categories/index.md","hash":"fc4c27bcf747e040d4c26724c2d39e6144e56401","modified":1660412121163},{"_id":"source/friends/index.md","hash":"a68a54c4dc54927013e992b66d717ad93f1b23cc","modified":1660412121164},{"_id":"source/contact/index.md","hash":"73e6f5ce187d4b26cc018d73faf8fe20d6e402ce","modified":1660412121163},{"_id":"source/tags/index.md","hash":"91bb2c6d5b1bdf1ada2adaaf2fa487706dd8a3a4","modified":1660412121164},{"_id":"source/_posts/conclusion/2020-conclusion-working.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1660412120843},{"_id":"themes/hexo-theme-matery/layout/_custom/custom.styl","hash":"67bca810ceacd9b62d627702cf7f3f1584be473e","modified":1660412121165},{"_id":"themes/hexo-theme-matery/layout/_custom/sidebar.swig","hash":"051e8b669b37a6d8898c474958eeefd71482c629","modified":1660412121165},{"_id":"themes/hexo-theme-matery/layout/_partial/back-top.ejs","hash":"be527741c39c9dc4a13ad712b49fe8db0147fe1e","modified":1660412121165},{"_id":"themes/hexo-theme-matery/layout/_partial/baidu-push.ejs","hash":"2841870e0c625787de348221e5ddb7bbe99ec5a2","modified":1660412121165},{"_id":"themes/hexo-theme-matery/layout/_partial/bg-cover-content.ejs","hash":"45f2a9a65905de64cacdac42032eb7705ad5afc7","modified":1660412121165},{"_id":"themes/hexo-theme-matery/layout/_partial/baidu-analytics.ejs","hash":"4b01030b7136192bdbd704e29a0fe12f92767551","modified":1660412121165},{"_id":"themes/hexo-theme-matery/layout/_partial/bg-cover.ejs","hash":"d5a7b9bb96e04c0a3485dd873748f19c50a6a04f","modified":1660412121166},{"_id":"themes/hexo-theme-matery/layout/_partial/disqus.ejs","hash":"1b392f2160f962f62f3ddf5e1155c7f2f4888e1d","modified":1660412121166},{"_id":"themes/hexo-theme-matery/layout/_partial/footer.ejs","hash":"ce93bcd80ece1bc320b10208dd0947fcb25da501","modified":1661141633167},{"_id":"themes/hexo-theme-matery/layout/_partial/github-link.ejs","hash":"fd4034bca2eb3987dcf113e6477260bee97eb1e7","modified":1660412121166},{"_id":"themes/hexo-theme-matery/layout/_partial/gitalk.ejs","hash":"27764936791ce36b527bea63689435346bbfb425","modified":1660412121166},{"_id":"themes/hexo-theme-matery/layout/_partial/gitment.ejs","hash":"90888c945384aa1ee4650bd43bd7ea670f25828c","modified":1660412121167},{"_id":"themes/hexo-theme-matery/layout/_partial/google-analytics.ejs","hash":"890c8f04c1f4905dfceb3ea9fd6efdd040d79c01","modified":1660412121167},{"_id":"themes/hexo-theme-matery/layout/_partial/head.ejs","hash":"adaeca6ae9064c41047c3fb4f8bd046b736ae457","modified":1660412121167},{"_id":"themes/hexo-theme-matery/layout/_partial/header.ejs","hash":"4bcdbd27273dd1b7098d4cfa6479b5d6b138cd12","modified":1660412121167},{"_id":"themes/hexo-theme-matery/layout/_partial/index-cover.ejs","hash":"c2743ec50f018054cd3d1f6facfccef3f3999ba3","modified":1661142464030},{"_id":"themes/hexo-theme-matery/layout/_partial/livere.ejs","hash":"42728561c09589f79b698eb059ab4def53ed3642","modified":1660412121167},{"_id":"themes/hexo-theme-matery/layout/_partial/minivaline.ejs","hash":"68085770dc09d71c14d323dff940fe6c1826ba76","modified":1660412121167},{"_id":"themes/hexo-theme-matery/layout/_partial/navigation.ejs","hash":"5a2179a9a3de6f56b0aaa154a11919b8f34fcbf9","modified":1660412121168},{"_id":"themes/hexo-theme-matery/layout/_partial/mobile-nav.ejs","hash":"8ce2974b19765e1f05d935a4f18abf7c84a980da","modified":1660412121168},{"_id":"themes/hexo-theme-matery/layout/_partial/paging.ejs","hash":"d8773abab5d0b672b70a9df20a8f9f7f6b0a2dae","modified":1660412121168},{"_id":"themes/hexo-theme-matery/layout/_partial/post-cover.ejs","hash":"7f583c935253e2bf6421791715ee9de4989add6e","modified":1660412121168},{"_id":"themes/hexo-theme-matery/layout/_partial/post-detail-toc.ejs","hash":"ea50a5669847740894d5737a6330bf1013ae2e65","modified":1660412121168},{"_id":"themes/hexo-theme-matery/layout/_partial/post-detail.ejs","hash":"8ad8a7ec3f6438af496c51fd6bef1684e158a9ef","modified":1660412121168},{"_id":"themes/hexo-theme-matery/layout/_partial/prev-next.ejs","hash":"908ddab5b5d5662c50b46ada0e03e06fe0a6c310","modified":1660412121168},{"_id":"themes/hexo-theme-matery/layout/_partial/post-statis.ejs","hash":"de0d5763ddd64463f43135678b64c044884b8406","modified":1660412121168},{"_id":"themes/hexo-theme-matery/layout/_partial/reprint-statement.ejs","hash":"04f181269e003e75e716f63b3222be055502c6c2","modified":1661141239169},{"_id":"themes/hexo-theme-matery/layout/_partial/search.ejs","hash":"c5f1a2de30363f370c8c37994140d6ef4fd0c4b7","modified":1660412121169},{"_id":"themes/hexo-theme-matery/layout/_partial/reward.ejs","hash":"90c2ab31492f8226454537d6b987e9399119047d","modified":1660412121169},{"_id":"themes/hexo-theme-matery/layout/_partial/share.ejs","hash":"e50fae64b6cfdbed18861eb49eca5018a920c7a4","modified":1660412121169},{"_id":"themes/hexo-theme-matery/layout/_partial/social-link.ejs","hash":"f640583d45179abc1ef57951e7f61fb9e10f44c9","modified":1660412121169},{"_id":"themes/hexo-theme-matery/layout/_partial/valine.ejs","hash":"ef335be75e3f26580583af8699b8497f350ae200","modified":1660412121169},{"_id":"themes/hexo-theme-matery/layout/_widget/category-radar.ejs","hash":"131e2eabf6b216210efd0746300889adfee357be","modified":1660412121170},{"_id":"themes/hexo-theme-matery/layout/_widget/category-cloud.ejs","hash":"3ef458166041a8a12e493cc5963a5af5d98c1dfc","modified":1660412121170},{"_id":"themes/hexo-theme-matery/layout/_widget/dream.ejs","hash":"d6692f8c81013191fce59f47df1b6171649181ca","modified":1660412121170},{"_id":"themes/hexo-theme-matery/layout/_widget/music.ejs","hash":"226def64bcb1263f40212805fec4cdf6dc61034b","modified":1660412121170},{"_id":"themes/hexo-theme-matery/layout/_widget/my-gallery.ejs","hash":"f5259f18a906f2862fe72b90c28125b5f6b7d0b1","modified":1660412121170},{"_id":"themes/hexo-theme-matery/layout/_widget/my-skills.ejs","hash":"9edbeb1ec6212762d597ae7a05b5a219f72c8f98","modified":1660412121171},{"_id":"themes/hexo-theme-matery/layout/_widget/my-projects.ejs","hash":"141f19a8aa41b7a21436f23ce114bd5fda932512","modified":1660412121171},{"_id":"themes/hexo-theme-matery/layout/_widget/post-calendar.ejs","hash":"fb5ee7674070956d134ddca6890a9bd3f398cc0f","modified":1660412121171},{"_id":"themes/hexo-theme-matery/layout/_widget/post-charts.ejs","hash":"20f0b6155eee348276dd91790f6a52b1005a0518","modified":1660412121171},{"_id":"themes/hexo-theme-matery/layout/_widget/recommend.ejs","hash":"416f2f47f34df031fe4eef050fc21a2de06fdb83","modified":1660412121171},{"_id":"themes/hexo-theme-matery/layout/_widget/tag-wordcloud.ejs","hash":"5245a8fe51faa99f8db4180e604a90b20ae04c35","modified":1660412121172},{"_id":"themes/hexo-theme-matery/layout/_widget/tag-cloud.ejs","hash":"d32898104477acef56c33d00a68b48db15dcf2e6","modified":1660412121171},{"_id":"themes/hexo-theme-matery/layout/_widget/video.ejs","hash":"6eaab5fccff9ad69d1d877a0f0585e2fcb89ba52","modified":1660412121172},{"_id":"themes/hexo-theme-matery/source/css/gitment.css","hash":"d5ef623065d1fbc897119f7b70ccf7563e329917","modified":1660412121174},{"_id":"themes/hexo-theme-matery/source/css/matery.css","hash":"e0d770d554fb3565a7993bf8046cc998997ef5bc","modified":1660412121174},{"_id":"themes/hexo-theme-matery/source/css/my-gitalk.css","hash":"4e3e855767ac5a48b13af1d6a42df13d8975e03f","modified":1660412121174},{"_id":"themes/hexo-theme-matery/source/css/my.css","hash":"b3c32b573a4a9ef3dfeffbd544a9c3f451e67a54","modified":1660412121174},{"_id":"themes/hexo-theme-matery/source/js/matery.js","hash":"ddfef10e80a09b8efb48c52ede773e71d5890c78","modified":1660412121175},{"_id":"themes/hexo-theme-matery/source/js/search.js","hash":"77ecae23dd3edd8ad962c5b12954652bb2f7a1b6","modified":1660412121175},{"_id":"themes/hexo-theme-matery/source/medias/avatar.jpg","hash":"ba479c0b93b89302b2c0f2c7abc4de9354ed1380","modified":1661159368916},{"_id":"themes/hexo-theme-matery/source/medias/comment_bg.png","hash":"dfc93d24081884fbc58cab0f8fd19e77d31d6123","modified":1660412121229},{"_id":"themes/hexo-theme-matery/source/medias/icp.png","hash":"27a96f31f7d0413c6ade6f40e06f021f501151c7","modified":1660412121241},{"_id":"themes/hexo-theme-matery/source/medias/logo.png","hash":"d9095f5ea8719374d9d1ff020279426f5b2a1396","modified":1660412121241},{"_id":"source/_posts/best-practice/how-to-retry-elegantly.md","hash":"02d777ac62446855ad7ca018b3d78e254fceb9e6","modified":1661158728858},{"_id":"source/_posts/conclusion/2020-conclusion-slim.md","hash":"cd1ea2975a6da5363ab075b26f422b8d9805e74a","modified":1660412120722},{"_id":"source/_posts/data-analysis/r-study-basic-type.md","hash":"d1ae8f0e77a84f9f69a266e4e56463bc98c300af","modified":1660412120843},{"_id":"source/_posts/data-analysis/r-study-install.md","hash":"0ce51d6967d0f50c092ad401dc7f96ed0863f21e","modified":1660412120844},{"_id":"source/_posts/hexo/hexo-config.md","hash":"449cb661833ae59f8d85071d2b8f75b542599433","modified":1661159022839},{"_id":"source/_posts/hexo/hexo-start.md","hash":"9f851a08286f96ddb6901cc59aa0d6f14871d7b5","modified":1661159105319},{"_id":"source/_posts/hexo/hexo-theme.md","hash":"a6dcadeca2b1ea9c1b4d9cf2bd9f403b62184fcf","modified":1661159135895},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package.md","hash":"d070a9ca5596f7b897c81fffc3a6fe36def60ac4","modified":1660412120907},{"_id":"source/_posts/picture/go-draw-word-in-pic.md","hash":"e8edbd87eaab986e0eb4e33f080294a8374dcb9c","modified":1660412120919},{"_id":"source/_posts/picture/go-draw-word-in-pic2.md","hash":"435cab9451954e5048ad3fb5948b7f656d25ac69","modified":1660412120960},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package.md","hash":"72572888cd3a10f43e3aee94abc9e0cf61e8d424","modified":1660412121069},{"_id":"source/_posts/picture/go-wx-pic-generator.md","hash":"7e586648b0847e1b0c2066178104636a655167df","modified":1661158656273},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message.md","hash":"d220c1b2784428816384549d380e898dd1253f96","modified":1660412121100},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2.md","hash":"f291f37d68d62bf10f3abef83c96a6f334fdf22c","modified":1661159278642},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue.md","hash":"a948e4410ccb0824504b18fe388574320a59fd70","modified":1661141448225},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue.md","hash":"835567f72409d1a10a612e7c1bbd1bbe83c75b35","modified":1661141442146},{"_id":"source/_posts/thoughts/cogito-ergo-sum.md","hash":"a1cc3392fce0af05e6bea3c813eb8d4282296ece","modified":1660412121162},{"_id":"source/_posts/thoughts/what-is-your-answer.md","hash":"d2fdc7ada12f0432791ac9587060c728a41f2ae6","modified":1660412121163},{"_id":"source/_posts/thoughts/why-are-we-biased.md","hash":"ce32172238a797431dd303021523498135f058a2","modified":1660412121163},{"_id":"themes/hexo-theme-matery/source/libs/animate/animate.min.css","hash":"5dfcbcee866e9dc564916416281885f3e320871e","modified":1660412121175},{"_id":"themes/hexo-theme-matery/source/libs/aos/aos.css","hash":"ded9739f803d114c9168d3351fded72b3b478b4c","modified":1660412121176},{"_id":"themes/hexo-theme-matery/source/libs/aos/aos.js","hash":"5a8e6d07ffa55642418ab3fd4b263aa08284b77a","modified":1660412121176},{"_id":"themes/hexo-theme-matery/source/libs/aplayer/APlayer.min.css","hash":"7f4f8913f2d46ade2def5134e2cc8684a4b87939","modified":1660412121176},{"_id":"themes/hexo-theme-matery/source/libs/aplayer/APlayer.min.js","hash":"70c0c4a9bf698747b7c058c21287ad617355e5dd","modified":1660412121177},{"_id":"themes/hexo-theme-matery/source/libs/background/canvas-nest.js","hash":"d2569ef80127ed2f4af7ef4d9f82b037794eec69","modified":1660412121196},{"_id":"themes/hexo-theme-matery/source/libs/background/ribbon-dynamic.js","hash":"8f53dbd5f9a40c377664bf8ca0d5d5ed75b91757","modified":1660412121196},{"_id":"themes/hexo-theme-matery/source/libs/background/ribbon.min.js","hash":"6a99d494c030388f96f6086a7aaa0f03f3fe532e","modified":1660412121197},{"_id":"themes/hexo-theme-matery/source/libs/background/ribbon-refresh.min.js","hash":"8568bc391adb16e763baa8ae26fb4f40fd40d8d5","modified":1661142228768},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeBlockFuction.js","hash":"a8133367d48199e7505c2d831ca848b4202b9ba6","modified":1660412121197},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeLang.js","hash":"066d2c89ad429e44f6467b9267da782ccaad57de","modified":1660412121197},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeCopy.js","hash":"6ab7871d36cab438bbd4d781bc1fe7618b46b6e7","modified":1660412121197},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeShrink.js","hash":"3edbe498f7bb9e7daa77f9db30e1b5eeab40e067","modified":1660412121197},{"_id":"themes/hexo-theme-matery/source/libs/cryptojs/crypto-js.min.js","hash":"33810b2b757fc4327bc1d3b83bb5e0d3dc1fec5b","modified":1660412121198},{"_id":"themes/hexo-theme-matery/source/libs/dplayer/DPlayer.min.css","hash":"5d52d3b34fceb9d7e11f1beaf7ed380b4249dec4","modified":1660412121198},{"_id":"themes/hexo-theme-matery/source/libs/gitalk/gitalk.css","hash":"9c0bacfbd4519d3859e3bbb06128ba241804d8b1","modified":1660412121204},{"_id":"themes/hexo-theme-matery/source/libs/gitment/gitment-default.css","hash":"a0625d8b432af8bdc820f8768d36cde439e7257c","modified":1660412121205},{"_id":"themes/hexo-theme-matery/source/libs/instantpage/instantpage.js","hash":"043eba3c85c2e2009a9fabf3c4fc55537852fd86","modified":1660412121206},{"_id":"themes/hexo-theme-matery/source/libs/jqcloud/jqcloud-1.0.4.min.js","hash":"26849509f196a2d21bbfd15696e5d5153163b8f1","modified":1660412121207},{"_id":"themes/hexo-theme-matery/source/libs/jqcloud/jqcloud.css","hash":"4e6538c8312aeeab845d361c37a8c1a0931241f0","modified":1660412121207},{"_id":"themes/hexo-theme-matery/source/libs/masonry/masonry.pkgd.min.js","hash":"f81cd7bfcf7aa2d043bd3e6077df42656fc44b82","modified":1660412121212},{"_id":"themes/hexo-theme-matery/source/libs/others/busuanzi.pure.mini.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1660412121215},{"_id":"themes/hexo-theme-matery/source/libs/others/clicklove.js","hash":"6a39b8c683ba5dcd92f70c6ab45d1cfac3213e8e","modified":1660412121215},{"_id":"themes/hexo-theme-matery/source/libs/scrollprogress/scrollProgress.min.js","hash":"777ffe5d07e85a14fbe97d846f45ffc0087251cc","modified":1660412121215},{"_id":"themes/hexo-theme-matery/source/libs/tocbot/tocbot.css","hash":"9783581bec83e6bd6cd279f0af23a2862f46a587","modified":1660412121218},{"_id":"themes/hexo-theme-matery/source/libs/tocbot/tocbot.min.js","hash":"5ec27317f0270b8cf6b884c6f12025700b9a565c","modified":1660412121218},{"_id":"themes/hexo-theme-matery/source/medias/cover.jpg","hash":"d4957ff7cc5e88555cd840f2956ab0561e6f1ccf","modified":1660412121229},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/10.jpg","hash":"98e7f6fd9c97d4de9044b6871ca08ebf14db11b9","modified":1660412121231},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/13.jpg","hash":"35a320174f8e316e3eadaec658024276b651c6e9","modified":1660412121232},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/15.jpg","hash":"da0fbee3b7bde1607eace377ddf834c0be99edfe","modified":1660412121233},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/16.jpg","hash":"97a829c4bc94f9d2929b20a1a9b798c57b9f7205","modified":1660412121234},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/2.jpg","hash":"4bba691cf71a517ecaeaf42afd3e8f8b31e346c1","modified":1660412121236},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/21.jpg","hash":"b26edb128bb0bf58b23fd2f014e9555e89a2ca3b","modified":1660412121237},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/22.jpg","hash":"754579747a3e99747d890fca3162f370b96a7941","modified":1660412121237},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/23.jpg","hash":"7d7f37da3fa7128343adac23866449eb2c6a549a","modified":1660412121238},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/3.jpg","hash":"6ec646c2a70f5f11edacf225c1477f2200a37a96","modified":1660412121238},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/5.jpg","hash":"41ca20129a37fedc573eec28dd7d7b9e5b09228a","modified":1660412121239},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/7.jpg","hash":"7975141cd64e875122c0ea33daaca1a06bf00b8e","modified":1660412121240},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/8.jpg","hash":"8e4b7186352085483ca1174c7c0800114c48df8b","modified":1660412121240},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/EDaBTlbkyvbhmng.jpg","hash":"398a3bd4f74e6701ffee802e68707303dbb62f96","modified":1660412120720},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/GBvgTpbkyvbhlEB.jpg","hash":"ce85d0352cfd7704eb25580f879a485bdbd02f97","modified":1660412120721},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/IStGDBbkyvbhmow.jpg","hash":"b1c46a21dadae19e1b97fa9bf471192c61530735","modified":1660412120721},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/dtFxiMbkyvbhlzo.jpg","hash":"d2621edda28a9d2b9f5aaf498de1231ceefc8802","modified":1660412120721},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/fuuTyTbkyvbhmsa.jpg","hash":"aac6b22d8acdadc0f1fc81961aa729fac15c167c","modified":1660412120722},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/timg.jpg","hash":"7eac6dd798ef8867c7577387e59712ba001ac7c5","modified":1660412120722},{"_id":"source/_posts/data-analysis/r-study-basic-type/1.png","hash":"e07719816e5244d13c9201cd922174cffeff18a7","modified":1660412120843},{"_id":"source/_posts/data-analysis/r-study-install/10.png","hash":"354dee43985acf02898880a1562a99276f077aff","modified":1660412120844},{"_id":"source/_posts/data-analysis/r-study-install/7.png","hash":"f73cee1216b666cf96891569231bc1a2465ec628","modified":1660412120860},{"_id":"source/_posts/data-analysis/r-study-install/8.png","hash":"e61673687cc99e719a526e79810e5236c8bd3502","modified":1660412120860},{"_id":"source/_posts/hexo/hexo-start/hexo-10.jpg","hash":"b5669f360d81ef1954a8e528845f069c3b05ad81","modified":1660412120863},{"_id":"source/_posts/hexo/hexo-start/hexo-11.jpg","hash":"2383f2a8b5c4f4b417457ef7bf07612bca5be34b","modified":1660412120863},{"_id":"source/_posts/hexo/hexo-start/hexo-14.jpg","hash":"95bb8d19bca5263e81bc5a523bbcc22ceffe0a92","modified":1660412120864},{"_id":"source/_posts/hexo/hexo-start/hexo-15.jpg","hash":"590b6d79af3ebd60decfbbc3700e2ea1b561271c","modified":1660412120865},{"_id":"source/_posts/hexo/hexo-start/hexo-16.jpg","hash":"9384c5bf7619867cabf2c56b8b4944effdde3aac","modified":1660412120866},{"_id":"source/_posts/hexo/hexo-start/hexo-18.jpg","hash":"9e43bf788998ce7cad5876971b03f1cbaab6dfe7","modified":1660412120866},{"_id":"source/_posts/hexo/hexo-start/hexo-7.jpg","hash":"12d14c67621041e1e553444386af5bab0ebe1fc5","modified":1660412120874},{"_id":"source/_posts/hexo/hexo-theme/hexo-theme-2.jpg","hash":"db148a0a43ac9b6d3e2811a7be497c60e39757d3","modified":1660412120877},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/10.png","hash":"b77e16cdf377229a89eb30c9a94d318fd0983d62","modified":1660412120909},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/3.png","hash":"6e01668f661e2f9b9aa7ad85d71a071397606736","modified":1660412120916},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/4.png","hash":"d074c847068689e484a7f0863fcae73ec0fe40ac","modified":1660412120916},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/5.png","hash":"aa9b9d17f40297a94b6afaa9bc706747a2a6fe63","modified":1660412120916},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/6.png","hash":"bf3d36fe911855ee07006fad5a5b5a8f0206f4a4","modified":1660412120917},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/7.png","hash":"eecdbf7873baf90e4dab4c5efe8921880ae9fc95","modified":1660412120917},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/8.png","hash":"db77f142ad2a073a8c6c4d6bd569a9d9a8691f8c","modified":1660412120917},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/9.png","hash":"6f3d15420b035f3212e87f7ef99b9b368ce2c9cd","modified":1660412120918},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/test.jpg","hash":"c2e2dfa4631d71bcace54635876051d9d768e909","modified":1660412120918},{"_id":"source/_posts/picture/go-draw-word-in-pic/1.png","hash":"6f8d45022ced79d396dbefbb8a6b2dbad6d1fd86","modified":1660412120919},{"_id":"source/_posts/picture/go-draw-word-in-pic/2.png","hash":"0f034a85ef70d737229e07d490ae48b85be14cd2","modified":1660412120920},{"_id":"source/_posts/picture/go-draw-word-in-pic/3.png","hash":"3b597d9cfb081d6c7695b3a413bc0f93a4e98a46","modified":1660412120921},{"_id":"source/_posts/picture/go-draw-word-in-pic/4.png","hash":"d8a6f1ddfd76927e1972db67eff61719e9a62082","modified":1660412120921},{"_id":"source/_posts/picture/go-draw-word-in-pic/5.png","hash":"fbf329f33f064b6c5c611bb4443ff895b67b1b07","modified":1660412120921},{"_id":"source/_posts/picture/go-draw-word-in-pic/6.png","hash":"a56ba4e919001cbcbdd7460be8d2f70fa34e2c50","modified":1660412120921},{"_id":"source/_posts/picture/go-draw-word-in-pic/7.png","hash":"505b2ebc736e41d30e94706ed4f497d530e0a8b2","modified":1660412120922},{"_id":"source/_posts/picture/go-draw-word-in-pic/8.png","hash":"d50adf948f46ba5be5c0650a745fa98fd866401f","modified":1660412120922},{"_id":"source/_posts/picture/go-draw-word-in-pic/9.png","hash":"34b6f3de272f256c2fbf4d83a94c47d9ae414b13","modified":1660412120922},{"_id":"source/_posts/picture/go-draw-word-in-pic2/1.png","hash":"a500d8eb41306efb10f7f9a33cb5b5834219c732","modified":1660412120960},{"_id":"source/_posts/picture/go-draw-word-in-pic2/2.png","hash":"c51e0690fe9d9f318d7c0c4c771effbcfb96659c","modified":1660412120960},{"_id":"source/_posts/picture/go-draw-word-in-pic2/4.png","hash":"e9aebd8566a54a14a544813c610c8bac80fe9819","modified":1660412120961},{"_id":"source/_posts/picture/go-draw-word-in-pic2/3.png","hash":"b04bf9d31ac1403f738d5228f34c340a4c04f58a","modified":1660412120961},{"_id":"source/_posts/picture/go-draw-word-in-pic2/6.png","hash":"c3c30359945125a0782c6889995e4261c5ad3661","modified":1660412120962},{"_id":"source/_posts/picture/go-draw-word-in-pic2/7.png","hash":"8a837c5d24461b4d5ec3228f591befb4621805bc","modified":1660412120963},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/1.png","hash":"04c358a44501b18dad940efa117bd0bb84a049eb","modified":1660412121069},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/4.png","hash":"5fb65220cc46f0c2f600f664fefc81ef718a2470","modified":1660412121072},{"_id":"source/_posts/picture/go-wx-pic-generator/10.png","hash":"1a854bfda404ed50e2f07709d033785ac8262cb8","modified":1660412121080},{"_id":"source/_posts/picture/go-wx-pic-generator/3.png","hash":"342337ffae16801acd265ab8867673611684a705","modified":1660412121084},{"_id":"source/_posts/picture/go-wx-pic-generator/8.png","hash":"640916898da3bd1de27deb50f7aae51015688c98","modified":1660412121096},{"_id":"source/_posts/java/basic/java-basic.md","hash":"67a8bf061bf6e35faf9754be846a78c24b66f51d","modified":1660412120878},{"_id":"source/_posts/java/basic/java-class.md","hash":"1334a7e36bf47475cfbb10a95f2392d29d2c3e57","modified":1660412120878},{"_id":"source/_posts/java/basic/java-package.md","hash":"aa8b622030adc89deca1c00bd7013b39c24ce734","modified":1660412120878},{"_id":"source/_posts/java/basic/java-simple-structure.md","hash":"287bce1c1f49de1688b573bc21a51ce6ce7da4e7","modified":1660412120878},{"_id":"source/_posts/java/basic/java-variable.md","hash":"3af29e7bf460dca2ffd88be077157375243228fb","modified":1660412120878},{"_id":"source/_posts/java/introduction/java-environment-mac.md","hash":"decf00d1009a108854d5f980f957d842a20d18e0","modified":1661159187164},{"_id":"source/_posts/java/introduction/java-environment-windows.md","hash":"6d071f95fd44125ffd70d2d221bebf79bf0da3cd","modified":1661159191311},{"_id":"source/_posts/java/introduction/java-environment.md","hash":"aa9e95dffa5a54545ed5ee4f9e8db920529cdff1","modified":1661159177471},{"_id":"source/_posts/java/introduction/java-ide.md","hash":"bd2db4086df9d7bb456fcdd5808f2a3c3dc7dba3","modified":1661159194883},{"_id":"source/_posts/java/introduction/java-introduction.md","hash":"ad1fae9f3f06257ff3e2e29cfa1effa4801f54c3","modified":1661159198844},{"_id":"source/_posts/java/introduction/java-primer-conclusion.md","hash":"1b494eb4cfdaba99c2d68110a724728c0ea674f4","modified":1661159202071},{"_id":"source/_posts/java/introduction/java-simple-example.md","hash":"38b8106c708f1d37aeffc5b561e41bcfc8544849","modified":1661159206213},{"_id":"source/_posts/java/introduction/java-started.md","hash":"cb59a07520eb1f1d25bec6b4b62ce230e89a523f","modified":1661159211346},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/111.png.jpg","hash":"0e03633ffa9b61abf63dfdcff166af3666e035e3","modified":1660412121100},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/20170716034945131.jpg","hash":"f0d2b33f828a8fb8b272a04f5edee0a77884d49d","modified":1660412121101},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/{6582FAF9-A46E-4239-810B-E1D6883ED070}.png.jpg","hash":"a8e0e3c465ac56a94fda7fc0f68238bdee767213","modified":1660412121101},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/5b65729e0001439305000294.jpg","hash":"508787c40c4334c10bc3b8ee1ff35642d9b66d62","modified":1660412121101},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2/$2ER{ZD68TZW07[M5{$JZGL.png","hash":"58b529e4823b6fdc186b4cf5ffe8fc3882227d3f","modified":1660412121102},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/u=1091165172,1855706818&fm=26&gp=0.jpg","hash":"0e18b8632c7fadda31f0cbec10ba6ae107e2ba6f","modified":1660412121101},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2/42P7LF)NXQ`0JIN0~~43]PE.png","hash":"b2bdaad6ee0264bf59383085da87f9ae9dddde39","modified":1660412121103},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2/DTHP)NN0CQ28[@(HHY2R8{5.png","hash":"6f40fe3481cb6f04f4f2ef2cbc2b8ce9c8ae1d45","modified":1660412121103},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/54b719620c68404a8b8dfacc070420cb.jpg","hash":"df1a9d5b46cbb20e860b20e67fca2cb97b133983","modified":1660412121104},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/8(%(3A_Y`_N8XX8W5XHZMWY.png","hash":"a44213e3d6885bc41da1be8a86046562624f7ac7","modified":1660412121105},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/5d2ae72753a8e90481.png","hash":"a44213e3d6885bc41da1be8a86046562624f7ac7","modified":1660412121104},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/AG4T332}_NEUNPUAU(A_)U6.png","hash":"e73d36e2590575ee108efa029ff6c46b2fd71f39","modified":1660412121106},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/A51]5T0]5(4`@P{}[06(%~Q.png","hash":"5ca3d7f4d865069533bbc95798635789e71ea547","modified":1660412121105},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/[@YD9OX4WP)E9$ME_7`Z]NB.png","hash":"cc7fc5a0227d754d63bb2b3c8aac475baf6bc522","modified":1660412121107},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/$QT%QELKW@$DM92E@ZNA647.png","hash":"ccc7358da110b58f3dc0bf4abb63277d9d4c719e","modified":1660412121122},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/1@J8$IFWP3]K{)U]{E~7V{1.png","hash":"ce55dff0b4e3ac2be4f95327b567b90e0084a3bf","modified":1660412121122},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/LH`~)W5TPAA`OB6`5UH@FIB.png","hash":"e915fd31ab9850bc003fcb6b790d86004ad08a92","modified":1660412121123},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/8Q$8RRCK~N@S]1@71KPJ]NC.png","hash":"a58c4780b913e910b6f41ae0b78779e05fbc7700","modified":1660412121123},{"_id":"themes/hexo-theme-matery/source/libs/dplayer/DPlayer.min.js","hash":"82276be41d2001e820020a219b90ad5b026302d1","modified":1660412121199},{"_id":"themes/hexo-theme-matery/source/libs/gitment/gitment.js","hash":"5a13983930b019450e4fe01a407c64b3dd316be4","modified":1660412121206},{"_id":"themes/hexo-theme-matery/source/libs/jquery/jquery.min.js","hash":"a8927ac2830b2fdd4a729eb0eb7f80923539ceb9","modified":1660412121208},{"_id":"themes/hexo-theme-matery/source/libs/valine/Valine.min.js","hash":"d6c03e8c3e547b5f48878081d10559b80f626948","modified":1660412121219},{"_id":"themes/hexo-theme-matery/source/medias/banner/0.jpg","hash":"69ec96cd9b4bc3aa631adc9da61353f50c39f031","modified":1660412121222},{"_id":"themes/hexo-theme-matery/source/medias/banner/2.jpg","hash":"39fb2535460ce66cc0b34e07ffb9411db1405f09","modified":1660412121224},{"_id":"themes/hexo-theme-matery/source/medias/banner/3.jpg","hash":"4ac047e92d0363b1a61ab756aca6dac13fb77494","modified":1660412121225},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/0.jpg","hash":"1c3300f029fc85d6dda6fa4f1d699551034cdaf7","modified":1660412121230},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/1.jpg","hash":"684ae89de8cb7acefae19f5aee6c612037c46393","modified":1660412121230},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/11.jpg","hash":"f55972ce7175684f2b11c3c9fc2b5b14bccbfae8","modified":1660412121231},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/12.jpg","hash":"8a4b2e7d92ae95c3b0c921db23c35aa9a41a7d58","modified":1660412121232},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/14.jpg","hash":"38e11221406785bcd93aa9cd23e568e164630ef1","modified":1660412121233},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/17.jpg","hash":"42d47903551ee81885c1386022982cae165841c5","modified":1660412121234},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/18.jpg","hash":"64829272ec85bb819d55ff89e5b5fd6f64aa436b","modified":1660412121235},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/19.jpg","hash":"eb250906fdbc0c408f42ae9933725bc1a05d79fb","modified":1660412121235},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/20.jpg","hash":"3b11f9b461168d907073f793190865fe621a8573","modified":1660412121236},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/4.jpg","hash":"e06c47de27619984be9d5d02947f8370a432dfea","modified":1660412121239},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/6.jpg","hash":"c8f2aa4bbb041158b4e73733a341e6a77c8583f7","modified":1660412121240},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/9.jpg","hash":"b956a2291a04b2132366b53666cf34858b8bdb1f","modified":1660412121241},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/1565529015677.png","hash":"7894b5cf7ccdfb4b3c9b96c8cf03e3511a6d457c","modified":1660412120720},{"_id":"source/_posts/conclusion/2020-conclusion-slim/12.jpeg","hash":"113197f7b1c87e761f67006fe9a90e29911f0904","modified":1660412120750},{"_id":"source/_posts/conclusion/2020-conclusion-slim/13.jpeg","hash":"461e305796809248dff97f2dc8be1d17e472544e","modified":1660412120750},{"_id":"source/_posts/conclusion/2020-conclusion-slim/16.jpeg","hash":"cb5eee9b6a8c1526915e6032bc60072d27a83415","modified":1660412120764},{"_id":"source/_posts/conclusion/2020-conclusion-slim/17.jpeg","hash":"8bad89c62fb379cda243f4ccba3649c09dca72d7","modified":1660412120765},{"_id":"source/_posts/conclusion/2020-conclusion-slim/18.jpeg","hash":"d09c6ebc9b9df0f0ea909a7e2188b9da94cee86f","modified":1660412120765},{"_id":"source/_posts/conclusion/2020-conclusion-slim/2.jpg","hash":"ccb5c3e5153e305ef3d70b6c97ee4110cc7a044c","modified":1660412120769},{"_id":"source/_posts/conclusion/2020-conclusion-slim/21.jpeg","hash":"6e5599bedc3ea7499479ec795949932d9a9ebf5f","modified":1660412120780},{"_id":"source/_posts/conclusion/2020-conclusion-slim/22.jpeg","hash":"d03410dea44133bf0ea0cd99fb57dea4cc77395f","modified":1660412120781},{"_id":"source/_posts/conclusion/2020-conclusion-slim/29.jpeg","hash":"6e37bf58a3fb1a73d2ae35515be3b645b3be9785","modified":1660412120788},{"_id":"source/_posts/conclusion/2020-conclusion-slim/3.jpeg","hash":"218138a2d00ebbaf4504d51f744ca968dfe961ba","modified":1660412120789},{"_id":"source/_posts/conclusion/2020-conclusion-slim/30.jpeg","hash":"a20447796551ccae15ae86bce11cc75796c54257","modified":1660412120790},{"_id":"source/_posts/conclusion/2020-conclusion-slim/7.jpeg","hash":"cd9e632484d18dab4b2d39ac35737a33b389f5a7","modified":1660412120842},{"_id":"source/_posts/conclusion/2020-conclusion-slim/9.jpeg","hash":"8a01dde7b0f028dfb86d5e41fd19bbe138831728","modified":1660412120843},{"_id":"source/_posts/data-analysis/r-study-install/13.png","hash":"c9cc7f8f452e4f189ae78673297689bc95d9d4aa","modified":1660412120850},{"_id":"source/_posts/data-analysis/r-study-install/3.png","hash":"73f5e04dfcd1844f83dc277249bd03e6d83461c7","modified":1660412120856},{"_id":"source/_posts/data-analysis/r-study-install/9.png","hash":"945fad9f56d3a051d085c6e74a695f505907e867","modified":1660412120861},{"_id":"source/_posts/hexo/hexo-start/hexo-12.jpg","hash":"5766686c2f3da4e2cb840ae6b48a575a0ee264da","modified":1660412120864},{"_id":"source/_posts/hexo/hexo-start/hexo-13.jpg","hash":"dfb043214d16fa5374c4aa9f201d7878a016a623","modified":1660412120864},{"_id":"source/_posts/hexo/hexo-start/hexo-19.jpg","hash":"88362d043eb93ac285a839ecb8ba60dbeb754f73","modified":1660412120867},{"_id":"source/_posts/hexo/hexo-start/hexo-6.jpg","hash":"395d28d979a8ea73ea69b077c577a9d447ae1308","modified":1660412120874},{"_id":"source/_posts/hexo/hexo-start/hexo-8.jpg","hash":"7dd52e6bec2f1512d20e35a53d5ceefd74a6c787","modified":1660412120875},{"_id":"source/_posts/hexo/hexo-theme/hexo-theme-3.jpg","hash":"77f12a53ba4cd2a8f24b18cd6665e4d5eb8b8677","modified":1660412120878},{"_id":"source/_posts/picture/go-draw-word-in-pic/gilmer-heavy.ttf","hash":"c81ab4019c9acf24177b851c38898d587d544ca5","modified":1660412120923},{"_id":"source/_posts/picture/go-draw-word-in-pic2/5.png","hash":"adb099539b527b7f327f693a722d1cc4e7262fb5","modified":1660412120962},{"_id":"source/_posts/picture/go-draw-word-in-pic2/gilmer-heavy.ttf","hash":"c81ab4019c9acf24177b851c38898d587d544ca5","modified":1660412121032},{"_id":"source/_posts/picture/go-wx-pic-generator/2.png","hash":"312f8c15e07af6df8504a443f203315a910d5ac0","modified":1660412121083},{"_id":"source/_posts/picture/go-wx-pic-generator/5.jpg","hash":"e5009707d2f0b0e5b3baf151fad04bf3d3be5859","modified":1660412121088},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/TIM图片20190714173105.png","hash":"b883a4fd592787e1c1b0e1e1b55c7ec4ea19736e","modified":1660412121106},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (1).png","hash":"cd15c9d6ff045f4c8d412e7d760402d2d1a64633","modified":1660412121108},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon.png","hash":"ef6a820e4d80e850e0e03786262abfcfe8fd82f1","modified":1660412121161},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/屏幕快照 2019-07-28 下午6.04.42.png","hash":"8bcc45818f1d822c2671ed984fa293814a874036","modified":1660412121162},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.eot","hash":"439c8afd3373acb4a73135a34e220464a89cd5e2","modified":1660412121185},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.ttf","hash":"0f4bd02942a54a6b3200d9078adff88c2812e751","modified":1660412121187},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.woff","hash":"59439d3ad31d856d78ec3e2bd9f1eafa2c7a581c","modified":1660412121187},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.woff2","hash":"f6f653b4ea8fc487bdb590d39d5a726258a55f40","modified":1660412121187},{"_id":"themes/hexo-theme-matery/source/libs/gitalk/gitalk.min.js","hash":"f474cbab17f020c9b6040cb6594ac71d3b33b969","modified":1661140587541},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/css/lightgallery.min.css","hash":"1b7227237f9785c66062a4811508916518e4132c","modified":1660412121209},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.eot","hash":"54caf05a81e33d7bf04f2e420736ce6f1de5f936","modified":1660412121209},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.svg","hash":"67d261ac428761389c895e1da73664e633e14a72","modified":1660412121210},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.woff","hash":"3048de344dd5cad4624e0127e58eaae4b576f574","modified":1660412121210},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.ttf","hash":"f6421c0c397311ae09f9257aa58bcd5e9720f493","modified":1660412121210},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/loading.gif","hash":"15a76af2739482d8de7354abc6d8dc4fca8d145e","modified":1660412121210},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/video-play.png","hash":"2962e03ddbe04d7e201a5acccac531a2bbccddfc","modified":1660412121211},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/youtube-play.png","hash":"f8d11384d33b7a79ee2ba8d522844f14d5067a80","modified":1660412121211},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/vimeo-play.png","hash":"9b72fc0f86a01467ed0b68c9cc4d604ec316d517","modified":1660412121211},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/js/lightgallery-all.min.js","hash":"f8cd48e1fff82ecd54a7ce3e69de8dba7c92d113","modified":1660412121212},{"_id":"themes/hexo-theme-matery/source/libs/materialize/materialize.min.css","hash":"30351cf15f5f2325275d7e0754afdef011f4b830","modified":1660412121213},{"_id":"themes/hexo-theme-matery/source/libs/materialize/materialize.min.js","hash":"33969d4c44ba0cb0aef851f258ba35845e5d8680","modified":1661141845349},{"_id":"themes/hexo-theme-matery/source/libs/share/css/share.min.css","hash":"7126de5cec8371e580b7b1f22512da0985cc39e5","modified":1660412121216},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.eot","hash":"00ff749c8e202401190cc98d56087cdda716abe4","modified":1660412121216},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.svg","hash":"1d56c9d5db0273f07c43cc1397e440f98ba7827a","modified":1660412121216},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.ttf","hash":"afd898f59d363887418669520b24d175f966a083","modified":1660412121217},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.woff","hash":"2e3fce1dcfbd6e2114e7bfbeaf72d3c62e15a1bd","modified":1660412121217},{"_id":"themes/hexo-theme-matery/source/libs/share/js/jquery.share.min.js","hash":"de34668d902ec082d17ddb6dd7ad24255fb547c5","modified":1660412121217},{"_id":"themes/hexo-theme-matery/source/libs/share/js/social-share.min.js","hash":"ba635a17a9d9d132369f9fe4b1fbcaf001ea6ac9","modified":1660412121218},{"_id":"themes/hexo-theme-matery/source/libs/valine/av-min.js","hash":"9cb4babc20eb8fb5a86c4b0cc894fdb0f3cd9534","modified":1660412121220},{"_id":"themes/hexo-theme-matery/source/medias/banner/1.jpg","hash":"ab122a36998a4f62a61e61a4fc5e00248113413b","modified":1660412121223},{"_id":"themes/hexo-theme-matery/source/medias/banner/5.jpg","hash":"852418f4f09e796e12bc3bab7a1488d3f37d6486","modified":1660412121227},{"_id":"themes/hexo-theme-matery/source/medias/banner/6.jpg","hash":"ed7282cc129c4ff9f322d2f2897fb4aac5c48589","modified":1660412121228},{"_id":"source/_posts/conclusion/2020-conclusion-slim/11.jpeg","hash":"829b147569ec0847bb077b51c8c675d2e8b31f94","modified":1660412120749},{"_id":"source/_posts/conclusion/2020-conclusion-slim/14.jpeg","hash":"52cf9375e1fe8d3be4108946d78632d8f21869ce","modified":1660412120751},{"_id":"source/_posts/conclusion/2020-conclusion-slim/24.jpeg","hash":"df8877da9544232e1d467873c6c0e05f35f83d00","modified":1660412120783},{"_id":"source/_posts/conclusion/2020-conclusion-slim/25.jpeg","hash":"a6a48a1e2ce38f622f9d0c482e6291bf501dacfd","modified":1660412120784},{"_id":"source/_posts/conclusion/2020-conclusion-slim/28.jpeg","hash":"773c409d6efe6dfc90cb16541472051a4590f284","modified":1660412120788},{"_id":"source/_posts/conclusion/2020-conclusion-slim/8.jpeg","hash":"3ae531ef8b7e27a8a81e38bdd57ef32bd0549a49","modified":1660412120842},{"_id":"source/_posts/data-analysis/r-study-install/12.png","hash":"492b571299cb018eba4c682d10c6d0f5a670f4b9","modified":1660412120850},{"_id":"source/_posts/data-analysis/r-study-install/15.png","hash":"65ffecc8dc3bcf92af300394f00fca6f2a1ec30f","modified":1660412120853},{"_id":"source/_posts/data-analysis/r-study-install/5.png","hash":"8fa494c3938cc34f701c33fde9733e1a9ca6e546","modified":1660412120858},{"_id":"source/_posts/hexo/hexo-start/hexo-1.jpg","hash":"30e047ba9bdff93812a0d16f122108ebd9138f00","modified":1660412120862},{"_id":"source/_posts/hexo/hexo-start/hexo-17.jpg","hash":"670cb5ad256015ca55a9b525a22ffa650cb3605b","modified":1660412120866},{"_id":"source/_posts/hexo/hexo-start/hexo-3.jpg","hash":"e499a867ba114e730b88768de27121c6d89fc2f7","modified":1660412120870},{"_id":"source/_posts/hexo/hexo-start/hexo-4.jpg","hash":"e0130876440e9cd8e6976cc61033197cea390128","modified":1660412120873},{"_id":"source/_posts/hexo/hexo-start/hexo-5.jpg","hash":"5024f7d9661f0d18be5bb48636285c2ee66154a9","modified":1660412120873},{"_id":"source/_posts/hexo/hexo-theme/hexo-theme-1.jpg","hash":"191f97dde9784818ffd14f08fb902baf76724393","modified":1660412120877},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/11.png","hash":"a3c2f6dfa125a67f837c0723cbaa826173c946c5","modified":1660412120909},{"_id":"source/_posts/picture/go-draw-word-in-pic/10.png","hash":"44a2973585e8f9a0c4a96d59c9120a50145949af","modified":1660412120920},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/2.png","hash":"76c147cc611b6e1fd0d5a18c554da91b45a3d9ea","modified":1660412121070},{"_id":"source/_posts/java/introduction/java-environment-mac/10-jdk-mac.png","hash":"a058e42380742e3be7911c30ea4c54263f2e99e9","modified":1660412120882},{"_id":"source/_posts/java/introduction/java-environment-mac/13-jdk-mac.png","hash":"aa4d7a93b28afb3424a5c107724b07cb9cbeed3d","modified":1660412120883},{"_id":"source/_posts/java/introduction/java-environment-mac/12-jdk-mac.png","hash":"79b6a623b06142723ea9dc4981f3ef12ff3bcd75","modified":1660412120883},{"_id":"source/_posts/java/introduction/java-environment-mac/14-jdk-mac.png","hash":"4bc54995d9f778084a8b486634bc30793f1592f0","modified":1660412120883},{"_id":"source/_posts/java/introduction/java-environment-mac/16-jdk-mac.png","hash":"5451e575e4bf08b384335bb070bb46817edad5bd","modified":1660412120885},{"_id":"source/_posts/java/introduction/java-environment-mac/5-jdk-mac.png","hash":"b65be8a8b49518b8fc8ea4f1c1b7d1113352180c","modified":1660412120890},{"_id":"source/_posts/java/introduction/java-environment-mac/6-jdk-mac.png","hash":"cc0550022513036a612d666bab64f1876d703ec3","modified":1660412120890},{"_id":"source/_posts/java/introduction/java-environment-mac/7-jdk-mac.png","hash":"57310fc56a96be434f0ad69eb6387a82f54d0d5a","modified":1660412120891},{"_id":"source/_posts/java/introduction/java-environment-mac/8-jdk-mac.png","hash":"52eacf47993855414045b0719196da9001ccb153","modified":1660412120891},{"_id":"source/_posts/java/introduction/java-environment-mac/9-jdk-mac.png","hash":"1c9dbad3045f234695be69fb4c27c0cd53ab1918","modified":1660412120892},{"_id":"source/_posts/java/introduction/java-environment-windows/2-jdk-windows.png","hash":"4d1cb8168cde93a8aabef63c8d12a8ccb56a60e4","modified":1660412120893},{"_id":"source/_posts/java/introduction/java-environment-windows/3-jdk-windows.png","hash":"2a89504a729c391003e94d74941aeada3fde7e4a","modified":1660412120893},{"_id":"source/_posts/java/introduction/java-environment-windows/4-jdk-windows.png","hash":"155d9ca099b6138a5f3c2df3b826f6ce972d847a","modified":1660412120893},{"_id":"source/_posts/java/introduction/java-environment-windows/5-jdk-windows.png","hash":"ac4f6a18554f2d1aae972e1bf6737dd60551613d","modified":1660412120893},{"_id":"source/_posts/java/introduction/java-environment-windows/6-jdk-windows.png","hash":"f26f02913932acf206e345b96a2749c22d68a7c1","modified":1660412120894},{"_id":"source/_posts/java/introduction/java-environment-windows/7-jdk-windows.png","hash":"79f375c43ac760ce5a88aef12df9e788494f0643","modified":1660412120894},{"_id":"source/_posts/java/introduction/java-environment-windows/8-jdk-windows.png","hash":"884e1c6927bf1394dc9941de017deb3b9901daeb","modified":1660412120894},{"_id":"source/_posts/java/introduction/java-environment-windows/9-jdk-windows.png","hash":"8defa728fac888e8203a5e6151596c5ce15280d3","modified":1660412120895},{"_id":"source/_posts/java/introduction/java-ide/java-ide-3.png","hash":"5616c391ba4e9a1341b4c6213758924b9e8124d1","modified":1660412120901},{"_id":"source/_posts/java/introduction/java-ide/java-ide-5.png","hash":"627cfbad99d15a6962df90269eb9df896a6b6021","modified":1660412120902},{"_id":"source/_posts/java/introduction/java-ide/java-ide-6.png","hash":"bc4523f962ca5301e062c864166cf4cc2dfd6f34","modified":1660412120903},{"_id":"source/_posts/java/introduction/java-ide/java-ide-7.png","hash":"db6fcb1e3350c32db0a5ad41400ee7e22023eed1","modified":1660412120903},{"_id":"source/_posts/java/introduction/java-ide/java-ide-8.png","hash":"311e7f7643a2facb45dc3165c938af1bd84b28b7","modified":1660412120903},{"_id":"source/_posts/java/introduction/java-ide/java-ide-9.png","hash":"b7cb86602219d3609159f856c4449b7b85ae0aac","modified":1660412120904},{"_id":"source/_posts/java/introduction/java-simple-example/java-simple-example-1.png","hash":"7be12cd9b902847ed3ca8ce7a6f06139103f1180","modified":1660412120904},{"_id":"source/_posts/java/introduction/java-simple-example/java-simple-example-2.png","hash":"404e3de6764fab8a109a7efceabfb4bc6942fb30","modified":1660412120905},{"_id":"source/_posts/java/introduction/java-simple-example/java-simple-example-3.png","hash":"9b42950df71c6cb651d76dec741a4549e4855fd5","modified":1660412120905},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (4).png","hash":"e5b254e80ab30fa1dc22b5adef3df8635a6529b7","modified":1660412121113},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (5).png","hash":"730d0bf71a637f49ae3ebc6288ed396faa897895","modified":1660412121114},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (1).png","hash":"db81014ac61e04c8cf3122eaf0874e94a9388926","modified":1660412121124},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (13).png","hash":"e82144d9f6ca0118a9394672143cc007425e6374","modified":1660412121130},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (12).png","hash":"9778f24c6fcaf0c3c70f43bbbb37435e4f14ce26","modified":1660412121130},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (14).png","hash":"b09141ab5024ff50de44595de052ec027256912b","modified":1660412121132},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (8).png","hash":"34e2c1289e270d30c1d29cc347e3739b91e504ae","modified":1660412121158},{"_id":"themes/hexo-theme-matery/source/libs/awesome/css/all.css","hash":"6390d0a6e6211ebbd68b49759b4dec8b2a9f04c9","modified":1660412121177},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.eot","hash":"22f9e7d5226408eb2d0a11e118257a3ca22b8670","modified":1660412121179},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.woff","hash":"18838f5260317da3c5ed29bf844ac8a4f7ad0529","modified":1660412121185},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.ttf","hash":"91cbeeaceb644a971241c08362898599d6d968ce","modified":1660412121184},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.woff2","hash":"a46bd47ff0a90b812aafafda587d095cdb844271","modified":1660412121185},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.woff","hash":"92803b8753ceda573c6906774677c5a7081d2fbb","modified":1660412121195},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.woff2","hash":"9c081b88b106c6c04ecb895ba7ba7d3dcb3b55ac","modified":1660412121196},{"_id":"source/_posts/conclusion/2020-conclusion-slim/23.jpeg","hash":"5f3ae7df90d23985e44762e9c3fd17c60bb9d425","modified":1660412120782},{"_id":"source/_posts/conclusion/2020-conclusion-slim/26.jpeg","hash":"ed8c017ba1ee34fff3c3dbc33c26036348fd3a09","modified":1660412120786},{"_id":"source/_posts/data-analysis/r-study-install/14.png","hash":"ff475d130dcdd5078a766a2f79ee6930a6ad8728","modified":1660412120852},{"_id":"source/_posts/data-analysis/r-study-install/2.png","hash":"ef8d06488b29b9e94529e8f57e8ac4ea2d12aa2a","modified":1660412120855},{"_id":"source/_posts/data-analysis/r-study-install/4.png","hash":"dea2d527bfbadb78276fe0a40b72c669b42c99b2","modified":1660412120857},{"_id":"source/_posts/data-analysis/r-study-install/6.png","hash":"6cbcd1b88932f23dfc9bdb3afd00fd2df948fb9e","modified":1660412120859},{"_id":"source/_posts/hexo/hexo-start/hexo-2.jpg","hash":"a2ea1d73f8a2bbc738d29204a9ffc0dc9f81c0a8","modified":1660412120868},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/1.png","hash":"2a37213f95eaefa8754b3ebad3af73ce09f2b3f0","modified":1660412120908},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/3.png","hash":"6c9809d5abc36de5a9bc052d1b298a1fd3cf99af","modified":1660412121071},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/6.png","hash":"b8d7212f6eb7e19cfc9740b453f3a94fbde47b94","modified":1660412121074},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/5.png","hash":"54a2299f13312c3c58598d5da5c9fee5645204b0","modified":1660412121073},{"_id":"source/_posts/java/introduction/java-environment-mac/11-jdk-mac.png","hash":"09153cd9a58d2ea84f64bc4105fee92a0691c221","modified":1660412120882},{"_id":"source/_posts/java/introduction/java-environment-mac/15-jdk-mac.png","hash":"115d45c94471ff20db11d361a5111108181273f9","modified":1660412120884},{"_id":"source/_posts/java/introduction/java-environment-windows/1-jdk-windows.png","hash":"8f643602c33a1a98b96e46349952dea4dae4981b","modified":1660412120892},{"_id":"source/_posts/java/introduction/java-ide/java-ide-4.png","hash":"41e84a42900e891648f3b37130a080606f531181","modified":1660412120902},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (3).png","hash":"75f1f59c807ce3bd52ed890ba8949bddbfad2ae1","modified":1660412121112},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (15).png","hash":"ea8b4fa0316006b0925623cabcfb0cfdea7ea571","modified":1660412121133},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (4).png","hash":"50850273536b61a9ee32e3e5474ad5937addefee","modified":1660412121147},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (5).png","hash":"95202f707630c282c6d8e412a4fbe6cce96f2149","modified":1660412121148},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (9).png","hash":"09e5820fe1ed84d9f74187bd5371c9682a6d2175","modified":1660412121160},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.svg","hash":"3d3a49445343d80f3b553e3e3425b9a7bd49acaf","modified":1660412121186},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.eot","hash":"cab8e84ae5682d1d556e234df9c790985888def8","modified":1660412121189},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.ttf","hash":"9521ed12274c2cbc910cea77657116fcf6545da3","modified":1660412121195},{"_id":"themes/hexo-theme-matery/source/medias/banner/4.jpg","hash":"e5ac5033678afa9d69edffe9a61004f836cb5734","modified":1660412121227},{"_id":"source/_posts/conclusion/2020-conclusion-slim/27.jpeg","hash":"af40212fcd69f4cb51736f5f69fbb0ce4fcf264c","modified":1660412120787},{"_id":"source/_posts/conclusion/2020-conclusion-slim/32.png","hash":"8aee71da0fe7a0e7238270ae23c7ec51079b6607","modified":1660412120805},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/7.png","hash":"553115d70fc769bdc04feceec50b643b8cf899cf","modified":1660412121076},{"_id":"source/_posts/java/introduction/java-environment-mac/2-jdk-mac.png","hash":"bef4170c81af99efbdb89dafa2094fd127648889","modified":1660412120886},{"_id":"source/_posts/java/introduction/java-started/java-started-1.png","hash":"83c77b655ea24647ff6c55c830924baa4e90b845","modified":1660412120906},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (10).png","hash":"b5c24901462f097ec10a1ab3426510443fe7ebbf","modified":1660412121126},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (3).png","hash":"782de3005a2ef3ea1ade98cf9a2f67f9f2cdad21","modified":1660412121145},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (6).png","hash":"6628aa12dcd7366d08b09075654492c3e993e8e0","modified":1660412121151},{"_id":"themes/hexo-theme-matery/source/medias/reward/wechat.png","hash":"d9391db9000c417541784b30ee9c5aa5a3fbbcca","modified":1660412121246},{"_id":"source/_posts/picture/go-wx-pic-generator/11.png","hash":"698a698c40fe8da7a071b3a1a474b567775fb965","modified":1660412121083},{"_id":"source/_posts/java/introduction/java-environment-mac/3-jdk-mac.png","hash":"0b4bb944db5070a12b706f7ffaf451f5d558cfd9","modified":1660412120887},{"_id":"source/_posts/java/introduction/java-ide/java-ide-2.png","hash":"9e81a827e3e5793b7f262df0eda5de1746c65899","modified":1660412120901},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (2).png","hash":"9b4a6e3298f1f24ed62938cfaba39d9a91eefa7d","modified":1660412121110},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (11).png","hash":"7812d9f9dfef253124967a04bd6eb9ba59f601af","modified":1660412121129},{"_id":"source/_posts/data-analysis/r-study-install/11.png","hash":"091618e7f7d7929dc83cd1002c94cf6d1eab3144","modified":1660412120849},{"_id":"source/_posts/hexo/hexo-start/hexo-9.jpg","hash":"2bcd82d840a43571fb0dee47de61dd041de6d513","modified":1660412120876},{"_id":"source/_posts/java/introduction/java-environment-mac/4-jdk-mac.png","hash":"df019bad4cac078997c8a067a59d69be97a34adc","modified":1660412120889},{"_id":"themes/hexo-theme-matery/source/medias/reward/alipay.jpg","hash":"4ce33e80d3ec905650ac9524c516440ca94ecdfa","modified":1660412121244},{"_id":"source/_posts/conclusion/2020-conclusion-slim/19.jpeg","hash":"ea00b6715ec6c38e5e2fe7b3bdd4697f0b6078c5","modified":1660412120768},{"_id":"source/_posts/data-analysis/r-study-install/1043143-20200727074006066-1700986643.png","hash":"c759230eef2baa7ae3b60ce7bbc92368c3e013e8","modified":1660412120846},{"_id":"source/_posts/picture/go-wx-pic-generator/4.jpg","hash":"f0f93d76743e2d654bc9e7cbd6cdca1424c7e539","modified":1660412121087},{"_id":"source/_posts/picture/go-wx-pic-generator/6.jpg","hash":"4856009392ed20baac352f70e4acb0b567ac756b","modified":1660412121090},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (7).png","hash":"6c8acab6bfe5a1f33d4b2f97d39c716365ca7979","modified":1660412121157},{"_id":"themes/hexo-theme-matery/source/libs/echarts/echarts.min.js","hash":"8789b5e4daf0029a6c88f238f10e54d01c4fce82","modified":1660412121203},{"_id":"source/_posts/picture/go-wx-pic-generator/1.png","hash":"875f57e3a655a4a632bbfc322398aa967a0c8f70","modified":1660412121080},{"_id":"source/_posts/java/introduction/java-environment-mac/1-jdk-mac.png","hash":"4acf222e3a5d9728d358cd16a2f0d4300ae6700e","modified":1660412120881},{"_id":"source/_posts/java/introduction/java-ide/java-ide-1.png","hash":"ab6bb5ebfc5b292263824a72ba6eeca819f31f14","modified":1660412120899},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.svg","hash":"5e2d2a159294576bea69cc3360efb5ffe110ab2d","modified":1660412121183},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.svg","hash":"7da88b19e1486f8c968d3cf5ab3f194f01ea17fd","modified":1660412121193},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/2.png","hash":"a61ad75a1a8142fbb010146e04cdd06527e6344e","modified":1660412120915},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon.png","hash":"3e435114b36dc401f60e0abbe3a3e220cdb51017","modified":1660412121121},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (2).png","hash":"5f7e2e15ee7a80e5b620b909a10f8d25c56e5cca","modified":1660412121142},{"_id":"source/_posts/conclusion/2020-conclusion-slim/10.png","hash":"35eb145d331b084141ffe3f7310944b9877f10bb","modified":1660412120747},{"_id":"source/_posts/conclusion/2020-conclusion-slim/20.png","hash":"2efae28fd7e0988fe85fd50e8465cd6fd023726a","modified":1660412120779},{"_id":"source/_posts/conclusion/2020-conclusion-slim/4.png","hash":"fd046d86fc1c3bd4d57ee79743e54e708883e35a","modified":1660412120815},{"_id":"source/_posts/picture/go-wx-pic-generator/7.png","hash":"f20f84e8dc82ed15cffdd1e04428c290558848c7","modified":1660412121095},{"_id":"source/_posts/picture/go-wx-pic-generator/9.png","hash":"e7cb186067731456a88a8efe52e44349786f74bd","modified":1660412121099},{"_id":"source/_posts/conclusion/2020-conclusion-slim/6.png","hash":"e90cbb719271f7d80bbd6909820f8682a5de5a72","modified":1660412120842},{"_id":"source/_posts/conclusion/2020-conclusion-slim/15.png","hash":"3a1490bbc6a9a6bf6bee3c33237b2732b82e8d52","modified":1660412120763},{"_id":"source/_posts/conclusion/2020-conclusion-slim/31.png","hash":"8f133c615c4113a0a690f37a62b18fcb89d16aef","modified":1660412120802},{"_id":"source/_posts/conclusion/2020-conclusion-slim/1.jpg","hash":"af186c836ce5d25dbea309389106504532065d82","modified":1660412120737},{"_id":"source/_posts/conclusion/2020-conclusion-slim/5.png","hash":"2d2e9f6dbe38e9e475a2aafc145b1452b8de781f","modified":1660412120830},{"_id":"source/_posts/picture/go-draw-word-in-pic/方正楷体简体.ttf","hash":"8e153ec0f6ccb6ea99f4e6e1e54747e9fe094d0a","modified":1660412120959},{"_id":"source/_posts/picture/go-draw-word-in-pic2/方正楷体简体.ttf","hash":"8e153ec0f6ccb6ea99f4e6e1e54747e9fe094d0a","modified":1660412121068},{"_id":"source/_posts/picture/go-draw-word-in-pic2/SourceHanSansCN-Bold-2.otf","hash":"de83272324b51764b0fd5e642af63bb9d10d1055","modified":1660412121030},{"_id":"public/atom.xml","hash":"feb8334dd17fbb9edb34478a7502719f0a0a5dae","modified":1661159744611},{"_id":"public/search.xml","hash":"0dfe67d6f09f00d0f21c0bea92258cca41337c84","modified":1661159744611},{"_id":"public/categories/index.html","hash":"ffdb8ab0de14b39d7455e41a93d230c1dd0b557f","modified":1661159744611},{"_id":"public/about/index.html","hash":"312349fb34d8e1e504f3c7d0b3bcda57ed1dc8ad","modified":1661159744611},{"_id":"public/friends/index.html","hash":"de9001eab353ecfc07e549a04128fbb3b7fc53e8","modified":1661159744611},{"_id":"public/contact/index.html","hash":"94f7398c133de54683f3724fcc37bfc050e7172e","modified":1661159744611},{"_id":"public/tags/index.html","hash":"d2afec4a84cdba87085c45b0625a62aa7e14d457","modified":1661159744611},{"_id":"public/2022/08/14/conclusion/2020-conclusion-working/index.html","hash":"85f0e9df625154ca09d65c5f227c158480fe8323","modified":1661159744611},{"_id":"public/2021/08/01/picture/go-wx-pic-generator/index.html","hash":"cb27e7da36c072f43ff6c4f1f1d916f75445e1c7","modified":1661159744611},{"_id":"public/2021/05/30/thoughts/what-is-your-answer/index.html","hash":"eb171bb3aca2d8b879e2074da384d15b01873389","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/index.html","hash":"6ec4abe1cf83283da8775db92a921025b096a73c","modified":1661159744611},{"_id":"public/2020/12/22/picture/go-draw-word-in-pic2/index.html","hash":"72a0e4bdd6aab4b2d734fd91cb723b74b8720e55","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/index.html","hash":"1236274fd3892e98bbbecc9e935594124a63f3bd","modified":1661159744611},{"_id":"public/2020/12/16/picture/go-pic-rotate-use-gg-package/index.html","hash":"13112a97f042b65c6ada223c97d5fdcd2afda03c","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/index.html","hash":"800edfecae950ac175af04a6fd863353240f9a9c","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-basic-type/index.html","hash":"4f2b179bab1af97b37674e0f3b6065305cec8c16","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/index.html","hash":"c737c0c3d7b5e53a4d76df4cadd9c7dc7df4eaa1","modified":1661159744611},{"_id":"public/2020/11/01/thoughts/cogito-ergo-sum/index.html","hash":"b9792815631ee3df969f66ee2637bec356f504cd","modified":1661159744611},{"_id":"public/2020/05/31/thoughts/why-are-we-biased/index.html","hash":"7bf958a1f149f0e2c593967d4726f74b1eb40391","modified":1661159744611},{"_id":"public/2020/05/04/hexo/hexo-theme/index.html","hash":"8c74bd710e3723097bcd1cb9af6d966121fb2dc3","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/index.html","hash":"20131e8dbb9af9ab113660d4ebf8421e874ca9d8","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/index.html","hash":"48c38fe9d6796dd34e5a01b86da8a443332fecf2","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2/index.html","hash":"bb159f186ad1b2483c7a66b2d071b9a62c663af5","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/index.html","hash":"f2e3d071a90874f7f1f60e99435b3bdd4acdede3","modified":1661159744611},{"_id":"public/2020/05/04/best-practice/how-to-retry-elegantly/index.html","hash":"8af04544a48b11b80cde3eeeda5021f9f0d7954b","modified":1661159744611},{"_id":"public/2020/05/04/java/basic/java-class/index.html","hash":"c6ba0afe7218a7e67520d3707eebadaef4f810aa","modified":1661159744611},{"_id":"public/2020/05/04/java/basic/java-variable/index.html","hash":"b0f0073acc45911274bbbe772beb5f70f366b00f","modified":1661159744611},{"_id":"public/2020/05/04/java/basic/java-simple-structure/index.html","hash":"e5603725a763668c468a033614f80b65895f210f","modified":1661159744611},{"_id":"public/2020/05/04/java/basic/java-package/index.html","hash":"94638484bd6feba8f5181021a1e43598fbfd7660","modified":1661159744611},{"_id":"public/2020/05/04/java/basic/java-basic/index.html","hash":"3c60dbfa1bc1cdebd1a35f6c22be786c26d3572d","modified":1661159744611},{"_id":"public/2020/05/03/hexo/hexo-config/index.html","hash":"8fb619b7b9da493ed58b14926779f02336283b16","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/index.html","hash":"eb4b3ff2b3b48fd1284f11fe78691500156ede0e","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-primer-conclusion/index.html","hash":"e7c1b8e8ff09b56d3ec410e9de51d24862bb9e95","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-simple-example/index.html","hash":"e0a56ef0fbde6c27bdd3b67abcd947fc16571b32","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-introduction/index.html","hash":"a3798a53c2bf76dd9e15205d479f48dcd566c406","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-ide/index.html","hash":"b1efdca3146c2446422e31dac0849b7fa7bf0906","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/index.html","hash":"7c84c2a627eedad0d331897d093b8c8db28a1b14","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-windows/index.html","hash":"a82b3b3e75a3277b88dd122e399a92203d60a6d6","modified":1661159744611},{"_id":"public/index.html","hash":"2cf1e5d525167e1f5230d3c98a8a82a60a475dc2","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment/index.html","hash":"846344163d6d7f81356b1a41030c91d228bcf4df","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-started/index.html","hash":"cdd2bf2fa0db6433231205da461bf34246a5a67d","modified":1661159744611},{"_id":"public/page/2/index.html","hash":"6bfc9a51a9b4ea009643e85a37cfd1c88bad4e50","modified":1661159744611},{"_id":"public/archives/index.html","hash":"427500199519fabb970a999227b04a12be1952ce","modified":1661159744611},{"_id":"public/page/3/index.html","hash":"14ca0dc8e09b6abb791a479cfaa6db98d5bd2a6b","modified":1661159744611},{"_id":"public/archives/page/2/index.html","hash":"e1a735ae3384b5e66e45a8fee0fc365cdebe40b3","modified":1661159744611},{"_id":"public/archives/page/3/index.html","hash":"e0626561177f6ce9760257970b7299e5ec9303aa","modified":1661159744611},{"_id":"public/archives/2020/index.html","hash":"70faf0795a9a9f0f4dbf89ae5141ae93418f2faf","modified":1661159744611},{"_id":"public/archives/2020/page/2/index.html","hash":"5f0f5d18ec8ef8504639f9007c696facd844a6fb","modified":1661159744611},{"_id":"public/archives/2020/page/3/index.html","hash":"0795615c400df16940c473d0ee575477c4e151fe","modified":1661159744611},{"_id":"public/archives/2020/05/index.html","hash":"393b7f8db1d7ef16771aed6785e8485c086fc3f2","modified":1661159744611},{"_id":"public/archives/2020/05/page/2/index.html","hash":"861e85058e305354ceae00d2b477e791b36877cc","modified":1661159744611},{"_id":"public/archives/2020/11/index.html","hash":"f0c81f9a07bff9b5e5007044941fa2ab4c1e8cff","modified":1661159744611},{"_id":"public/archives/2020/12/index.html","hash":"7e846af419c2cb1bc6bcdb9b213040ede6407043","modified":1661159744611},{"_id":"public/archives/2021/index.html","hash":"68b3109c1b871052b59873b0ac4f491976821f15","modified":1661159744611},{"_id":"public/archives/2021/02/index.html","hash":"d024b9149f2e1f7b886089f304f40adf34f06793","modified":1661159744611},{"_id":"public/archives/2021/05/index.html","hash":"bbf767f9c44c6e76537bfe5ee74fdf45f0033ba2","modified":1661159744611},{"_id":"public/archives/2021/08/index.html","hash":"bbf9b54b2522691d60314e367ca27f76d933f77f","modified":1661159744611},{"_id":"public/archives/2022/index.html","hash":"da2168d34c185678683a2407b237a4f94ab5c9ec","modified":1661159744611},{"_id":"public/archives/2022/08/index.html","hash":"24aacf06438415301f297c4f7b174a13887b69fe","modified":1661159744611},{"_id":"public/categories/programming/index.html","hash":"c6370ba859665f7f4b9867ff7a082b993a304345","modified":1661159744611},{"_id":"public/categories/programming/page/2/index.html","hash":"e490c4e2bb312a0768786c8be81d4caa520845eb","modified":1661159744611},{"_id":"public/categories/programming/page/3/index.html","hash":"8c6cbc31f17f44f923751de4043cfe8735a1a1e6","modified":1661159744611},{"_id":"public/categories/life/index.html","hash":"b420024d5d2040ec3c6c1ca387296759ec5812b6","modified":1661159744611},{"_id":"public/categories/programming/data-analysis/index.html","hash":"11a9a5707b4f33e66fa7b5d6e65c884ce0bbf19f","modified":1661159744611},{"_id":"public/categories/programming/life/index.html","hash":"0b8e80c67692ff67123c0cec1d0f7c42d1bc9c90","modified":1661159744611},{"_id":"public/categories/life/答案/index.html","hash":"bf5b9b56ca032aae56fd30164bcce8f98a928d67","modified":1661159744611},{"_id":"public/tags/best-practice/index.html","hash":"e287bf711c3105e0f6cf1d9f26fdaa7e3890fa4d","modified":1661159744611},{"_id":"public/tags/retry-gracefully/index.html","hash":"1d831f6c248dfb2c5d690031f9927004a10a236d","modified":1661159744611},{"_id":"public/tags/Spring/index.html","hash":"552c99e0414fdc559542bc99886fc77c39cdae65","modified":1661159744611},{"_id":"public/tags/yearly-conclusion/index.html","hash":"7f19ccd74204e1c08a09bdd7af286256d0c4b089","modified":1661159744611},{"_id":"public/tags/R/index.html","hash":"31f01abdd49658d4116cb30a33ec871c2c9e46f7","modified":1661159744611},{"_id":"public/tags/environment-building/index.html","hash":"20fca653e4d295d46e4e4e25ccccce4ef4adae59","modified":1661159744611},{"_id":"public/tags/Hexo/index.html","hash":"fb39a7aad7df0deb61f6632c97f38450fcca1e58","modified":1661159744611},{"_id":"public/tags/go/index.html","hash":"97d2f780b6068a0d89faa8fbdfd9579ecf044d9a","modified":1661159744611},{"_id":"public/tags/github-pages/index.html","hash":"e473978a3f19abae79ab6a5c7c3a28521b3aca6f","modified":1661159744611},{"_id":"public/tags/travis-ci/index.html","hash":"21d45127755ac45559f47879f91537460e17675d","modified":1661159744611},{"_id":"public/tags/RabbitMQ/index.html","hash":"9d74cca2841aac48c39982b924600d4fc6e99899","modified":1661159744611},{"_id":"public/tags/Thoughts/index.html","hash":"34eae9acc8c4d5d25a7a3bb7dd5fe8b0c1b5086b","modified":1661159744611},{"_id":"public/tags/DelayQueue/index.html","hash":"f3478ae0929d14803051a178364e93b80f5698fe","modified":1661159744611},{"_id":"public/tags/Java/index.html","hash":"6642b2ff14ba1843204b829299aabd2ba3402b04","modified":1661159744611},{"_id":"public/tags/Java/page/2/index.html","hash":"28a34b41ca3f9c4e342d06323f8892c12fb118b3","modified":1661159744611},{"_id":"public/tags/java-basic/index.html","hash":"f328c544e2f502f3270b41b4438c4a17a11d3d9e","modified":1661159744611},{"_id":"public/tags/java-beginning/index.html","hash":"bc516b3d5f35f7f40742f53e9365c1ed999cb95d","modified":1661159744611},{"_id":"public/favicon.png","hash":"774fee8c6d0be9dbb010b20f36c06848d06e3da0","modified":1661159744611},{"_id":"public/medias/avatar.jpg","hash":"ba479c0b93b89302b2c0f2c7abc4de9354ed1380","modified":1661159744611},{"_id":"public/medias/comment_bg.png","hash":"dfc93d24081884fbc58cab0f8fd19e77d31d6123","modified":1661159744611},{"_id":"public/medias/icp.png","hash":"27a96f31f7d0413c6ade6f40e06f021f501151c7","modified":1661159744611},{"_id":"public/medias/logo.png","hash":"d9095f5ea8719374d9d1ff020279426f5b2a1396","modified":1661159744611},{"_id":"public/medias/featureimages/10.jpg","hash":"98e7f6fd9c97d4de9044b6871ca08ebf14db11b9","modified":1661159744611},{"_id":"public/medias/featureimages/13.jpg","hash":"35a320174f8e316e3eadaec658024276b651c6e9","modified":1661159744611},{"_id":"public/medias/featureimages/15.jpg","hash":"da0fbee3b7bde1607eace377ddf834c0be99edfe","modified":1661159744611},{"_id":"public/medias/featureimages/16.jpg","hash":"97a829c4bc94f9d2929b20a1a9b798c57b9f7205","modified":1661159744611},{"_id":"public/medias/featureimages/2.jpg","hash":"4bba691cf71a517ecaeaf42afd3e8f8b31e346c1","modified":1661159744611},{"_id":"public/medias/featureimages/21.jpg","hash":"b26edb128bb0bf58b23fd2f014e9555e89a2ca3b","modified":1661159744611},{"_id":"public/medias/featureimages/22.jpg","hash":"754579747a3e99747d890fca3162f370b96a7941","modified":1661159744611},{"_id":"public/medias/featureimages/23.jpg","hash":"7d7f37da3fa7128343adac23866449eb2c6a549a","modified":1661159744611},{"_id":"public/medias/featureimages/3.jpg","hash":"6ec646c2a70f5f11edacf225c1477f2200a37a96","modified":1661159744611},{"_id":"public/medias/featureimages/5.jpg","hash":"41ca20129a37fedc573eec28dd7d7b9e5b09228a","modified":1661159744611},{"_id":"public/medias/featureimages/7.jpg","hash":"7975141cd64e875122c0ea33daaca1a06bf00b8e","modified":1661159744611},{"_id":"public/medias/featureimages/8.jpg","hash":"8e4b7186352085483ca1174c7c0800114c48df8b","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-regular-400.eot","hash":"439c8afd3373acb4a73135a34e220464a89cd5e2","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-regular-400.ttf","hash":"0f4bd02942a54a6b3200d9078adff88c2812e751","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-regular-400.woff","hash":"59439d3ad31d856d78ec3e2bd9f1eafa2c7a581c","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-regular-400.woff2","hash":"f6f653b4ea8fc487bdb590d39d5a726258a55f40","modified":1661159744611},{"_id":"public/libs/lightGallery/fonts/lg.eot","hash":"54caf05a81e33d7bf04f2e420736ce6f1de5f936","modified":1661159744611},{"_id":"public/libs/lightGallery/fonts/lg.svg","hash":"67d261ac428761389c895e1da73664e633e14a72","modified":1661159744611},{"_id":"public/libs/lightGallery/fonts/lg.woff","hash":"3048de344dd5cad4624e0127e58eaae4b576f574","modified":1661159744611},{"_id":"public/libs/lightGallery/fonts/lg.ttf","hash":"f6421c0c397311ae09f9257aa58bcd5e9720f493","modified":1661159744611},{"_id":"public/libs/lightGallery/img/loading.gif","hash":"15a76af2739482d8de7354abc6d8dc4fca8d145e","modified":1661159744611},{"_id":"public/libs/lightGallery/img/video-play.png","hash":"2962e03ddbe04d7e201a5acccac531a2bbccddfc","modified":1661159744611},{"_id":"public/libs/lightGallery/img/youtube-play.png","hash":"f8d11384d33b7a79ee2ba8d522844f14d5067a80","modified":1661159744611},{"_id":"public/libs/lightGallery/img/vimeo-play.png","hash":"9b72fc0f86a01467ed0b68c9cc4d604ec316d517","modified":1661159744611},{"_id":"public/libs/share/fonts/iconfont.eot","hash":"00ff749c8e202401190cc98d56087cdda716abe4","modified":1661159744611},{"_id":"public/libs/share/fonts/iconfont.svg","hash":"1d56c9d5db0273f07c43cc1397e440f98ba7827a","modified":1661159744611},{"_id":"public/libs/share/fonts/iconfont.ttf","hash":"afd898f59d363887418669520b24d175f966a083","modified":1661159744611},{"_id":"public/libs/share/fonts/iconfont.woff","hash":"2e3fce1dcfbd6e2114e7bfbeaf72d3c62e15a1bd","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-basic-type/1.png","hash":"e07719816e5244d13c9201cd922174cffeff18a7","modified":1661159744611},{"_id":"public/2020/05/04/hexo/hexo-theme/hexo-theme-2.jpg","hash":"db148a0a43ac9b6d3e2811a7be497c60e39757d3","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2/$2ER{ZD68TZW07[M5{$JZGL.png","hash":"58b529e4823b6fdc186b4cf5ffe8fc3882227d3f","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2/42P7LF)NXQ`0JIN0~~43]PE.png","hash":"b2bdaad6ee0264bf59383085da87f9ae9dddde39","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2/DTHP)NN0CQ28[@(HHY2R8{5.png","hash":"6f40fe3481cb6f04f4f2ef2cbc2b8ce9c8ae1d45","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/111.png.jpg","hash":"0e03633ffa9b61abf63dfdcff166af3666e035e3","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/20170716034945131.jpg","hash":"f0d2b33f828a8fb8b272a04f5edee0a77884d49d","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/5b65729e0001439305000294.jpg","hash":"508787c40c4334c10bc3b8ee1ff35642d9b66d62","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/u=1091165172,1855706818&fm=26&gp=0.jpg","hash":"0e18b8632c7fadda31f0cbec10ba6ae107e2ba6f","modified":1661159744611},{"_id":"public/2020/05/04/best-practice/how-to-retry-elegantly/EDaBTlbkyvbhmng.jpg","hash":"398a3bd4f74e6701ffee802e68707303dbb62f96","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/{6582FAF9-A46E-4239-810B-E1D6883ED070}.png.jpg","hash":"a8e0e3c465ac56a94fda7fc0f68238bdee767213","modified":1661159744611},{"_id":"public/2020/05/04/best-practice/how-to-retry-elegantly/GBvgTpbkyvbhlEB.jpg","hash":"ce85d0352cfd7704eb25580f879a485bdbd02f97","modified":1661159744611},{"_id":"public/2020/05/04/best-practice/how-to-retry-elegantly/IStGDBbkyvbhmow.jpg","hash":"b1c46a21dadae19e1b97fa9bf471192c61530735","modified":1661159744611},{"_id":"public/2020/05/04/best-practice/how-to-retry-elegantly/dtFxiMbkyvbhlzo.jpg","hash":"d2621edda28a9d2b9f5aaf498de1231ceefc8802","modified":1661159744611},{"_id":"public/medias/banner/0.jpg","hash":"69ec96cd9b4bc3aa631adc9da61353f50c39f031","modified":1661159744611},{"_id":"public/medias/banner/2.jpg","hash":"39fb2535460ce66cc0b34e07ffb9411db1405f09","modified":1661159744611},{"_id":"public/medias/featureimages/0.jpg","hash":"1c3300f029fc85d6dda6fa4f1d699551034cdaf7","modified":1661159744611},{"_id":"public/medias/banner/3.jpg","hash":"4ac047e92d0363b1a61ab756aca6dac13fb77494","modified":1661159744611},{"_id":"public/medias/featureimages/1.jpg","hash":"684ae89de8cb7acefae19f5aee6c612037c46393","modified":1661159744611},{"_id":"public/medias/featureimages/11.jpg","hash":"f55972ce7175684f2b11c3c9fc2b5b14bccbfae8","modified":1661159744611},{"_id":"public/medias/featureimages/12.jpg","hash":"8a4b2e7d92ae95c3b0c921db23c35aa9a41a7d58","modified":1661159744611},{"_id":"public/medias/featureimages/14.jpg","hash":"38e11221406785bcd93aa9cd23e568e164630ef1","modified":1661159744611},{"_id":"public/medias/featureimages/17.jpg","hash":"42d47903551ee81885c1386022982cae165841c5","modified":1661159744611},{"_id":"public/medias/featureimages/19.jpg","hash":"eb250906fdbc0c408f42ae9933725bc1a05d79fb","modified":1661159744611},{"_id":"public/medias/featureimages/18.jpg","hash":"64829272ec85bb819d55ff89e5b5fd6f64aa436b","modified":1661159744611},{"_id":"public/medias/featureimages/4.jpg","hash":"e06c47de27619984be9d5d02947f8370a432dfea","modified":1661159744611},{"_id":"public/medias/featureimages/20.jpg","hash":"3b11f9b461168d907073f793190865fe621a8573","modified":1661159744611},{"_id":"public/medias/featureimages/6.jpg","hash":"c8f2aa4bbb041158b4e73733a341e6a77c8583f7","modified":1661159744611},{"_id":"public/medias/featureimages/9.jpg","hash":"b956a2291a04b2132366b53666cf34858b8bdb1f","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-brands-400.eot","hash":"22f9e7d5226408eb2d0a11e118257a3ca22b8670","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-brands-400.woff","hash":"18838f5260317da3c5ed29bf844ac8a4f7ad0529","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-brands-400.ttf","hash":"91cbeeaceb644a971241c08362898599d6d968ce","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-solid-900.woff","hash":"92803b8753ceda573c6906774677c5a7081d2fbb","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-brands-400.woff2","hash":"a46bd47ff0a90b812aafafda587d095cdb844271","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-solid-900.woff2","hash":"9c081b88b106c6c04ecb895ba7ba7d3dcb3b55ac","modified":1661159744611},{"_id":"public/2020/05/04/hexo/hexo-theme/hexo-theme-3.jpg","hash":"77f12a53ba4cd2a8f24b18cd6665e4d5eb8b8677","modified":1661159744611},{"_id":"public/2020/05/04/best-practice/how-to-retry-elegantly/1565529015677.png","hash":"7894b5cf7ccdfb4b3c9b96c8cf03e3511a6d457c","modified":1661159744611},{"_id":"public/2020/05/04/best-practice/how-to-retry-elegantly/fuuTyTbkyvbhmsa.jpg","hash":"aac6b22d8acdadc0f1fc81961aa729fac15c167c","modified":1661159744611},{"_id":"public/2020/12/16/picture/go-pic-rotate-use-gg-package/4.png","hash":"5fb65220cc46f0c2f600f664fefc81ef718a2470","modified":1661159744611},{"_id":"public/2020/05/04/best-practice/how-to-retry-elegantly/timg.jpg","hash":"7eac6dd798ef8867c7577387e59712ba001ac7c5","modified":1661159744611},{"_id":"public/2020/12/16/picture/go-pic-rotate-use-gg-package/1.png","hash":"04c358a44501b18dad940efa117bd0bb84a049eb","modified":1661159744611},{"_id":"public/2020/12/22/picture/go-draw-word-in-pic2/1.png","hash":"a500d8eb41306efb10f7f9a33cb5b5834219c732","modified":1661159744611},{"_id":"public/2020/12/22/picture/go-draw-word-in-pic2/3.png","hash":"b04bf9d31ac1403f738d5228f34c340a4c04f58a","modified":1661159744611},{"_id":"public/2020/12/22/picture/go-draw-word-in-pic2/2.png","hash":"c51e0690fe9d9f318d7c0c4c771effbcfb96659c","modified":1661159744611},{"_id":"public/2020/12/22/picture/go-draw-word-in-pic2/4.png","hash":"e9aebd8566a54a14a544813c610c8bac80fe9819","modified":1661159744611},{"_id":"public/2020/12/22/picture/go-draw-word-in-pic2/6.png","hash":"c3c30359945125a0782c6889995e4261c5ad3661","modified":1661159744611},{"_id":"public/2020/12/22/picture/go-draw-word-in-pic2/7.png","hash":"8a837c5d24461b4d5ec3228f591befb4621805bc","modified":1661159744611},{"_id":"public/2021/08/01/picture/go-wx-pic-generator/10.png","hash":"1a854bfda404ed50e2f07709d033785ac8262cb8","modified":1661159744611},{"_id":"public/2021/08/01/picture/go-wx-pic-generator/3.png","hash":"342337ffae16801acd265ab8867673611684a705","modified":1661159744611},{"_id":"public/2021/08/01/picture/go-wx-pic-generator/8.png","hash":"640916898da3bd1de27deb50f7aae51015688c98","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/10.png","hash":"b77e16cdf377229a89eb30c9a94d318fd0983d62","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/3.png","hash":"6e01668f661e2f9b9aa7ad85d71a071397606736","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/5.png","hash":"aa9b9d17f40297a94b6afaa9bc706747a2a6fe63","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/4.png","hash":"d074c847068689e484a7f0863fcae73ec0fe40ac","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/6.png","hash":"bf3d36fe911855ee07006fad5a5b5a8f0206f4a4","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/7.png","hash":"eecdbf7873baf90e4dab4c5efe8921880ae9fc95","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/8.png","hash":"db77f142ad2a073a8c6c4d6bd569a9d9a8691f8c","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/9.png","hash":"6f3d15420b035f3212e87f7ef99b9b368ce2c9cd","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/test.jpg","hash":"c2e2dfa4631d71bcace54635876051d9d768e909","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/1.png","hash":"6f8d45022ced79d396dbefbb8a6b2dbad6d1fd86","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/2.png","hash":"0f034a85ef70d737229e07d490ae48b85be14cd2","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/3.png","hash":"3b597d9cfb081d6c7695b3a413bc0f93a4e98a46","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/4.png","hash":"d8a6f1ddfd76927e1972db67eff61719e9a62082","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/5.png","hash":"fbf329f33f064b6c5c611bb4443ff895b67b1b07","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/6.png","hash":"a56ba4e919001cbcbdd7460be8d2f70fa34e2c50","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/7.png","hash":"505b2ebc736e41d30e94706ed4f497d530e0a8b2","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/8.png","hash":"d50adf948f46ba5be5c0650a745fa98fd866401f","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/9.png","hash":"34b6f3de272f256c2fbf4d83a94c47d9ae414b13","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/54b719620c68404a8b8dfacc070420cb.jpg","hash":"df1a9d5b46cbb20e860b20e67fca2cb97b133983","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/AG4T332}_NEUNPUAU(A_)U6.png","hash":"e73d36e2590575ee108efa029ff6c46b2fd71f39","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/A51]5T0]5(4`@P{}[06(%~Q.png","hash":"5ca3d7f4d865069533bbc95798635789e71ea547","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/5d2ae72753a8e90481.png","hash":"a44213e3d6885bc41da1be8a86046562624f7ac7","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/8(%(3A_Y`_N8XX8W5XHZMWY.png","hash":"a44213e3d6885bc41da1be8a86046562624f7ac7","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/[@YD9OX4WP)E9$ME_7`Z]NB.png","hash":"cc7fc5a0227d754d63bb2b3c8aac475baf6bc522","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/10.png","hash":"354dee43985acf02898880a1562a99276f077aff","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/7.png","hash":"f73cee1216b666cf96891569231bc1a2465ec628","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/8.png","hash":"e61673687cc99e719a526e79810e5236c8bd3502","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-10.jpg","hash":"b5669f360d81ef1954a8e528845f069c3b05ad81","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-11.jpg","hash":"2383f2a8b5c4f4b417457ef7bf07612bca5be34b","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-14.jpg","hash":"95bb8d19bca5263e81bc5a523bbcc22ceffe0a92","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-15.jpg","hash":"590b6d79af3ebd60decfbbc3700e2ea1b561271c","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-16.jpg","hash":"9384c5bf7619867cabf2c56b8b4944effdde3aac","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-18.jpg","hash":"9e43bf788998ce7cad5876971b03f1cbaab6dfe7","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-7.jpg","hash":"12d14c67621041e1e553444386af5bab0ebe1fc5","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/$QT%QELKW@$DM92E@ZNA647.png","hash":"ccc7358da110b58f3dc0bf4abb63277d9d4c719e","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/8Q$8RRCK~N@S]1@71KPJ]NC.png","hash":"a58c4780b913e910b6f41ae0b78779e05fbc7700","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/LH`~)W5TPAA`OB6`5UH@FIB.png","hash":"e915fd31ab9850bc003fcb6b790d86004ad08a92","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/1@J8$IFWP3]K{)U]{E~7V{1.png","hash":"ce55dff0b4e3ac2be4f95327b567b90e0084a3bf","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-simple-example/java-simple-example-1.png","hash":"7be12cd9b902847ed3ca8ce7a6f06139103f1180","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-simple-example/java-simple-example-2.png","hash":"404e3de6764fab8a109a7efceabfb4bc6942fb30","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-simple-example/java-simple-example-3.png","hash":"9b42950df71c6cb651d76dec741a4549e4855fd5","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-windows/2-jdk-windows.png","hash":"4d1cb8168cde93a8aabef63c8d12a8ccb56a60e4","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-windows/3-jdk-windows.png","hash":"2a89504a729c391003e94d74941aeada3fde7e4a","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-windows/4-jdk-windows.png","hash":"155d9ca099b6138a5f3c2df3b826f6ce972d847a","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-windows/6-jdk-windows.png","hash":"f26f02913932acf206e345b96a2749c22d68a7c1","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-windows/5-jdk-windows.png","hash":"ac4f6a18554f2d1aae972e1bf6737dd60551613d","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-windows/7-jdk-windows.png","hash":"79f375c43ac760ce5a88aef12df9e788494f0643","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-windows/8-jdk-windows.png","hash":"884e1c6927bf1394dc9941de017deb3b9901daeb","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-windows/9-jdk-windows.png","hash":"8defa728fac888e8203a5e6151596c5ce15280d3","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-ide/java-ide-3.png","hash":"5616c391ba4e9a1341b4c6213758924b9e8124d1","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-ide/java-ide-5.png","hash":"627cfbad99d15a6962df90269eb9df896a6b6021","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-ide/java-ide-6.png","hash":"bc4523f962ca5301e062c864166cf4cc2dfd6f34","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-ide/java-ide-7.png","hash":"db6fcb1e3350c32db0a5ad41400ee7e22023eed1","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-ide/java-ide-8.png","hash":"311e7f7643a2facb45dc3165c938af1bd84b28b7","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-ide/java-ide-9.png","hash":"b7cb86602219d3609159f856c4449b7b85ae0aac","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/10-jdk-mac.png","hash":"a058e42380742e3be7911c30ea4c54263f2e99e9","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/12-jdk-mac.png","hash":"79b6a623b06142723ea9dc4981f3ef12ff3bcd75","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/13-jdk-mac.png","hash":"aa4d7a93b28afb3424a5c107724b07cb9cbeed3d","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/14-jdk-mac.png","hash":"4bc54995d9f778084a8b486634bc30793f1592f0","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/16-jdk-mac.png","hash":"5451e575e4bf08b384335bb070bb46817edad5bd","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/5-jdk-mac.png","hash":"b65be8a8b49518b8fc8ea4f1c1b7d1113352180c","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/7-jdk-mac.png","hash":"57310fc56a96be434f0ad69eb6387a82f54d0d5a","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/6-jdk-mac.png","hash":"cc0550022513036a612d666bab64f1876d703ec3","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/8-jdk-mac.png","hash":"52eacf47993855414045b0719196da9001ccb153","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/9-jdk-mac.png","hash":"1c9dbad3045f234695be69fb4c27c0cd53ab1918","modified":1661159744611},{"_id":"public/css/prism-tomorrow.css","hash":"3b99487dfc9b4e51e9105a93743b92a761840e34","modified":1661159744611},{"_id":"public/css/gitment.css","hash":"2bd15cc17dca35ac3ecc0acf167a23a1dd362acd","modified":1661159744611},{"_id":"public/css/my-gitalk.css","hash":"eeda46a83d0db1cc239a9cd27d544faf663f9883","modified":1661159744611},{"_id":"public/js/matery.js","hash":"b86de5fe3e9766b7ff80df12ea41c3a9e30825f7","modified":1661159744611},{"_id":"public/css/my.css","hash":"10577fbc30f241b126d1b51b1f56136ecba86b19","modified":1661159744611},{"_id":"public/js/search.js","hash":"499e11786efbb04815b54a1de317cc8606a37555","modified":1661159744611},{"_id":"public/libs/aplayer/APlayer.min.css","hash":"07372a2ba507388d0fed166d761b1c2c2a659dce","modified":1661159744611},{"_id":"public/libs/background/canvas-nest.js","hash":"65333d0dbb9c1173a1b13031b230161fc42c8b2f","modified":1661159744611},{"_id":"public/libs/background/ribbon.min.js","hash":"6a99d494c030388f96f6086a7aaa0f03f3fe532e","modified":1661159744611},{"_id":"public/libs/background/ribbon-refresh.min.js","hash":"b092e0ea18a6e4fea40d18827d934f661f817821","modified":1661159744611},{"_id":"public/libs/codeBlock/codeBlockFuction.js","hash":"c7ab06d27a525b15b1eb69027135269e9b9132fb","modified":1661159744611},{"_id":"public/libs/codeBlock/codeLang.js","hash":"bac88b4d4e3679732d29bd037c34f089cf27cf05","modified":1661159744611},{"_id":"public/libs/codeBlock/codeCopy.js","hash":"6d39a766af62e625f177c4d5cf3adc35eed71e61","modified":1661159744611},{"_id":"public/libs/codeBlock/codeShrink.js","hash":"201e8cd761b4be557247bdaf1ebc7c11c83194f6","modified":1661159744611},{"_id":"public/libs/jqcloud/jqcloud-1.0.4.min.js","hash":"257eaae3020599e4939f50d5008a743827f25b8c","modified":1661159744611},{"_id":"public/libs/background/ribbon-dynamic.js","hash":"052b80c29e6bc585aa28d4504b743bdbac220a88","modified":1661159744611},{"_id":"public/libs/instantpage/instantpage.js","hash":"83ce8919b1a69b2f1809ffaf99b52a8627e650e9","modified":1661159744611},{"_id":"public/libs/tocbot/tocbot.css","hash":"9ab8ef576c9a57115194152e79cca79b0a41dd70","modified":1661159744611},{"_id":"public/libs/scrollprogress/scrollProgress.min.js","hash":"777ffe5d07e85a14fbe97d846f45ffc0087251cc","modified":1661159744611},{"_id":"public/libs/tocbot/tocbot.min.js","hash":"5ec27317f0270b8cf6b884c6f12025700b9a565c","modified":1661159744611},{"_id":"public/libs/aos/aos.js","hash":"02bfb40b0c4b6e9b0b4081218357145cbb327d74","modified":1661159744611},{"_id":"public/libs/others/clicklove.js","hash":"6a39b8c683ba5dcd92f70c6ab45d1cfac3213e8e","modified":1661159744611},{"_id":"public/libs/jqcloud/jqcloud.css","hash":"20d9f11a19d95c70e27cb922e0d6dccbec4eae89","modified":1661159744611},{"_id":"public/libs/others/busuanzi.pure.mini.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1661159744611},{"_id":"public/libs/share/css/share.min.css","hash":"8a778a86f3ce9a042df6be63a9f1039631e351a5","modified":1661159744611},{"_id":"public/libs/animate/animate.min.css","hash":"97afa151569f046b2e01f27c1871646e9cd87caf","modified":1661159744611},{"_id":"public/css/matery.css","hash":"4b35e55a2f175c5e4eebd1f5aafbf879f97e222f","modified":1661159744611},{"_id":"public/libs/aos/aos.css","hash":"191a3705a8f63e589a50a0ff2f2c5559f1a1b6b2","modified":1661159744611},{"_id":"public/libs/aplayer/APlayer.min.js","hash":"22caa28ff6b41a16ff40f15d38f1739e22359478","modified":1661159744611},{"_id":"public/libs/cryptojs/crypto-js.min.js","hash":"5989527a378b55011a59522f41eeb3981518325c","modified":1661159744611},{"_id":"public/libs/gitalk/gitalk.css","hash":"940ded3ea12c2fe1ab0820d2831ec405f3f1fe9f","modified":1661159744611},{"_id":"public/libs/dplayer/DPlayer.min.css","hash":"f7d19655f873b813ffba5d1a17145c91f82631b8","modified":1661159744611},{"_id":"public/libs/gitment/gitment-default.css","hash":"2903c59ee06b965bef32e937bd69f5b0b2190717","modified":1661159744611},{"_id":"public/libs/masonry/masonry.pkgd.min.js","hash":"ff940b4ea68368ca0e4d5560cbb79fb147dfc3c5","modified":1661159744611},{"_id":"public/libs/gitment/gitment.js","hash":"28c02c45ce568e084cd1041dc493f83f9c6c88c6","modified":1661159744611},{"_id":"public/libs/dplayer/DPlayer.min.js","hash":"c3bad7b265574fab0ae4d45867422ea1cb9d6599","modified":1661159744611},{"_id":"public/libs/valine/Valine.min.js","hash":"6cbdbf91e1f046dd41267a5ff0691a1fccba99df","modified":1661159744611},{"_id":"public/libs/lightGallery/js/lightgallery-all.min.js","hash":"9f5ef4bc8a0a3c746ca4f3c3e6d64493b1a977d8","modified":1661159744611},{"_id":"public/libs/lightGallery/css/lightgallery.min.css","hash":"1b7227237f9785c66062a4811508916518e4132c","modified":1661159744611},{"_id":"public/libs/share/js/jquery.share.min.js","hash":"41367dcb857e02e3c417ebe68a554ce1d4430806","modified":1661159744611},{"_id":"public/libs/jquery/jquery.min.js","hash":"2115753ca5fb7032aec498db7bb5dca624dbe6be","modified":1661159744611},{"_id":"public/libs/share/js/social-share.min.js","hash":"a3090a02786dcd4efc6355c1c1dc978add8d6827","modified":1661159744611},{"_id":"public/libs/materialize/materialize.min.css","hash":"30351cf15f5f2325275d7e0754afdef011f4b830","modified":1661159744611},{"_id":"public/libs/gitalk/gitalk.min.js","hash":"6949fb58ee81dc3dd3a18178a492660a6eb4fb16","modified":1661159744611},{"_id":"public/libs/awesome/css/all.css","hash":"ecc41e32ad2696877a1656749841f3b5543bbe3d","modified":1661159744611},{"_id":"public/libs/materialize/materialize.min.js","hash":"503cb535eed90ffa070fb87f6822d76c62b310c3","modified":1661159744611},{"_id":"public/libs/valine/av-min.js","hash":"541efb9edc1ce425cbe3897cfc25803211fe6a05","modified":1661159744611},{"_id":"public/medias/cover.jpg","hash":"d4957ff7cc5e88555cd840f2956ab0561e6f1ccf","modified":1661159744611},{"_id":"public/medias/banner/1.jpg","hash":"ab122a36998a4f62a61e61a4fc5e00248113413b","modified":1661159744611},{"_id":"public/medias/banner/5.jpg","hash":"852418f4f09e796e12bc3bab7a1488d3f37d6486","modified":1661159744611},{"_id":"public/medias/banner/6.jpg","hash":"ed7282cc129c4ff9f322d2f2897fb4aac5c48589","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-regular-400.svg","hash":"3d3a49445343d80f3b553e3e3425b9a7bd49acaf","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-solid-900.eot","hash":"cab8e84ae5682d1d556e234df9c790985888def8","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-solid-900.ttf","hash":"9521ed12274c2cbc910cea77657116fcf6545da3","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/11.jpeg","hash":"829b147569ec0847bb077b51c8c675d2e8b31f94","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/14.jpeg","hash":"52cf9375e1fe8d3be4108946d78632d8f21869ce","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/24.jpeg","hash":"df8877da9544232e1d467873c6c0e05f35f83d00","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/25.jpeg","hash":"a6a48a1e2ce38f622f9d0c482e6291bf501dacfd","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/28.jpeg","hash":"773c409d6efe6dfc90cb16541472051a4590f284","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/8.jpeg","hash":"3ae531ef8b7e27a8a81e38bdd57ef32bd0549a49","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/12.png","hash":"492b571299cb018eba4c682d10c6d0f5a670f4b9","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/15.png","hash":"65ffecc8dc3bcf92af300394f00fca6f2a1ec30f","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/5.png","hash":"8fa494c3938cc34f701c33fde9733e1a9ca6e546","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-1.jpg","hash":"30e047ba9bdff93812a0d16f122108ebd9138f00","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-17.jpg","hash":"670cb5ad256015ca55a9b525a22ffa650cb3605b","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-3.jpg","hash":"e499a867ba114e730b88768de27121c6d89fc2f7","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-4.jpg","hash":"e0130876440e9cd8e6976cc61033197cea390128","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-5.jpg","hash":"5024f7d9661f0d18be5bb48636285c2ee66154a9","modified":1661159744611},{"_id":"public/2020/05/04/hexo/hexo-theme/hexo-theme-1.jpg","hash":"191f97dde9784818ffd14f08fb902baf76724393","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/11.png","hash":"a3c2f6dfa125a67f837c0723cbaa826173c946c5","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/10.png","hash":"44a2973585e8f9a0c4a96d59c9120a50145949af","modified":1661159744611},{"_id":"public/2020/12/16/picture/go-pic-rotate-use-gg-package/2.png","hash":"76c147cc611b6e1fd0d5a18c554da91b45a3d9ea","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (4).png","hash":"e5b254e80ab30fa1dc22b5adef3df8635a6529b7","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (5).png","hash":"730d0bf71a637f49ae3ebc6288ed396faa897895","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (1).png","hash":"db81014ac61e04c8cf3122eaf0874e94a9388926","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (13).png","hash":"e82144d9f6ca0118a9394672143cc007425e6374","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (12).png","hash":"9778f24c6fcaf0c3c70f43bbbb37435e4f14ce26","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (14).png","hash":"b09141ab5024ff50de44595de052ec027256912b","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (8).png","hash":"34e2c1289e270d30c1d29cc347e3739b91e504ae","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/2-jdk-mac.png","hash":"bef4170c81af99efbdb89dafa2094fd127648889","modified":1661159744611},{"_id":"public/2020/12/22/picture/go-draw-word-in-pic2/5.png","hash":"adb099539b527b7f327f693a722d1cc4e7262fb5","modified":1661159744611},{"_id":"public/2020/12/22/picture/go-draw-word-in-pic2/gilmer-heavy.ttf","hash":"c81ab4019c9acf24177b851c38898d587d544ca5","modified":1661159744611},{"_id":"public/2021/08/01/picture/go-wx-pic-generator/2.png","hash":"312f8c15e07af6df8504a443f203315a910d5ac0","modified":1661159744611},{"_id":"public/2021/08/01/picture/go-wx-pic-generator/5.jpg","hash":"e5009707d2f0b0e5b3baf151fad04bf3d3be5859","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/gilmer-heavy.ttf","hash":"c81ab4019c9acf24177b851c38898d587d544ca5","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/TIM图片20190714173105.png","hash":"b883a4fd592787e1c1b0e1e1b55c7ec4ea19736e","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (1).png","hash":"cd15c9d6ff045f4c8d412e7d760402d2d1a64633","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/3.png","hash":"73f5e04dfcd1844f83dc277249bd03e6d83461c7","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/13.png","hash":"c9cc7f8f452e4f189ae78673297689bc95d9d4aa","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/9.png","hash":"945fad9f56d3a051d085c6e74a695f505907e867","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-12.jpg","hash":"5766686c2f3da4e2cb840ae6b48a575a0ee264da","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-13.jpg","hash":"dfb043214d16fa5374c4aa9f201d7878a016a623","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-19.jpg","hash":"88362d043eb93ac285a839ecb8ba60dbeb754f73","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-6.jpg","hash":"395d28d979a8ea73ea69b077c577a9d447ae1308","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-8.jpg","hash":"7dd52e6bec2f1512d20e35a53d5ceefd74a6c787","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon.png","hash":"ef6a820e4d80e850e0e03786262abfcfe8fd82f1","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/屏幕快照 2019-07-28 下午6.04.42.png","hash":"8bcc45818f1d822c2671ed984fa293814a874036","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/12.jpeg","hash":"113197f7b1c87e761f67006fe9a90e29911f0904","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/13.jpeg","hash":"461e305796809248dff97f2dc8be1d17e472544e","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/16.jpeg","hash":"cb5eee9b6a8c1526915e6032bc60072d27a83415","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/17.jpeg","hash":"8bad89c62fb379cda243f4ccba3649c09dca72d7","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/2.jpg","hash":"ccb5c3e5153e305ef3d70b6c97ee4110cc7a044c","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/18.jpeg","hash":"d09c6ebc9b9df0f0ea909a7e2188b9da94cee86f","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/21.jpeg","hash":"6e5599bedc3ea7499479ec795949932d9a9ebf5f","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/22.jpeg","hash":"d03410dea44133bf0ea0cd99fb57dea4cc77395f","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/29.jpeg","hash":"6e37bf58a3fb1a73d2ae35515be3b645b3be9785","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/3.jpeg","hash":"218138a2d00ebbaf4504d51f744ca968dfe961ba","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/30.jpeg","hash":"a20447796551ccae15ae86bce11cc75796c54257","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/7.jpeg","hash":"cd9e632484d18dab4b2d39ac35737a33b389f5a7","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/9.jpeg","hash":"8a01dde7b0f028dfb86d5e41fd19bbe138831728","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-windows/1-jdk-windows.png","hash":"8f643602c33a1a98b96e46349952dea4dae4981b","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-ide/java-ide-4.png","hash":"41e84a42900e891648f3b37130a080606f531181","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/11-jdk-mac.png","hash":"09153cd9a58d2ea84f64bc4105fee92a0691c221","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/15-jdk-mac.png","hash":"115d45c94471ff20db11d361a5111108181273f9","modified":1661159744611},{"_id":"public/libs/echarts/echarts.min.js","hash":"9496f386a0da4601cad22c479cc5543913a4d67f","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/23.jpeg","hash":"5f3ae7df90d23985e44762e9c3fd17c60bb9d425","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/26.jpeg","hash":"ed8c017ba1ee34fff3c3dbc33c26036348fd3a09","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/14.png","hash":"ff475d130dcdd5078a766a2f79ee6930a6ad8728","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/2.png","hash":"ef8d06488b29b9e94529e8f57e8ac4ea2d12aa2a","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/4.png","hash":"dea2d527bfbadb78276fe0a40b72c669b42c99b2","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/6.png","hash":"6cbcd1b88932f23dfc9bdb3afd00fd2df948fb9e","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-2.jpg","hash":"a2ea1d73f8a2bbc738d29204a9ffc0dc9f81c0a8","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/1.png","hash":"2a37213f95eaefa8754b3ebad3af73ce09f2b3f0","modified":1661159744611},{"_id":"public/2020/12/16/picture/go-pic-rotate-use-gg-package/3.png","hash":"6c9809d5abc36de5a9bc052d1b298a1fd3cf99af","modified":1661159744611},{"_id":"public/2020/12/16/picture/go-pic-rotate-use-gg-package/6.png","hash":"b8d7212f6eb7e19cfc9740b453f3a94fbde47b94","modified":1661159744611},{"_id":"public/2020/12/16/picture/go-pic-rotate-use-gg-package/5.png","hash":"54a2299f13312c3c58598d5da5c9fee5645204b0","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (3).png","hash":"75f1f59c807ce3bd52ed890ba8949bddbfad2ae1","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (15).png","hash":"ea8b4fa0316006b0925623cabcfb0cfdea7ea571","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (4).png","hash":"50850273536b61a9ee32e3e5474ad5937addefee","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (5).png","hash":"95202f707630c282c6d8e412a4fbe6cce96f2149","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (9).png","hash":"09e5820fe1ed84d9f74187bd5371c9682a6d2175","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-started/java-started-1.png","hash":"83c77b655ea24647ff6c55c830924baa4e90b845","modified":1661159744611},{"_id":"public/medias/banner/4.jpg","hash":"e5ac5033678afa9d69edffe9a61004f836cb5734","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/27.jpeg","hash":"af40212fcd69f4cb51736f5f69fbb0ce4fcf264c","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/32.png","hash":"8aee71da0fe7a0e7238270ae23c7ec51079b6607","modified":1661159744611},{"_id":"public/2020/12/16/picture/go-pic-rotate-use-gg-package/7.png","hash":"553115d70fc769bdc04feceec50b643b8cf899cf","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (10).png","hash":"b5c24901462f097ec10a1ab3426510443fe7ebbf","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (3).png","hash":"782de3005a2ef3ea1ade98cf9a2f67f9f2cdad21","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (6).png","hash":"6628aa12dcd7366d08b09075654492c3e993e8e0","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/3-jdk-mac.png","hash":"0b4bb944db5070a12b706f7ffaf451f5d558cfd9","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-ide/java-ide-2.png","hash":"9e81a827e3e5793b7f262df0eda5de1746c65899","modified":1661159744611},{"_id":"public/medias/reward/wechat.png","hash":"d9391db9000c417541784b30ee9c5aa5a3fbbcca","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/4-jdk-mac.png","hash":"df019bad4cac078997c8a067a59d69be97a34adc","modified":1661159744611},{"_id":"public/2021/08/01/picture/go-wx-pic-generator/11.png","hash":"698a698c40fe8da7a071b3a1a474b567775fb965","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (2).png","hash":"9b4a6e3298f1f24ed62938cfaba39d9a91eefa7d","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (11).png","hash":"7812d9f9dfef253124967a04bd6eb9ba59f601af","modified":1661159744611},{"_id":"public/medias/reward/alipay.jpg","hash":"4ce33e80d3ec905650ac9524c516440ca94ecdfa","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/11.png","hash":"091618e7f7d7929dc83cd1002c94cf6d1eab3144","modified":1661159744611},{"_id":"public/2020/05/02/hexo/hexo-start/hexo-9.jpg","hash":"2bcd82d840a43571fb0dee47de61dd041de6d513","modified":1661159744611},{"_id":"public/2020/11/28/data-analysis/r-study-install/1043143-20200727074006066-1700986643.png","hash":"c759230eef2baa7ae3b60ce7bbc92368c3e013e8","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/19.jpeg","hash":"ea00b6715ec6c38e5e2fe7b3bdd4697f0b6078c5","modified":1661159744611},{"_id":"public/2021/08/01/picture/go-wx-pic-generator/4.jpg","hash":"f0f93d76743e2d654bc9e7cbd6cdca1424c7e539","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-brands-400.svg","hash":"5e2d2a159294576bea69cc3360efb5ffe110ab2d","modified":1661159744611},{"_id":"public/2021/08/01/picture/go-wx-pic-generator/6.jpg","hash":"4856009392ed20baac352f70e4acb0b567ac756b","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-ide/java-ide-1.png","hash":"ab6bb5ebfc5b292263824a72ba6eeca819f31f14","modified":1661159744611},{"_id":"public/2020/05/01/java/introduction/java-environment-mac/1-jdk-mac.png","hash":"4acf222e3a5d9728d358cd16a2f0d4300ae6700e","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (7).png","hash":"6c8acab6bfe5a1f33d4b2f97d39c716365ca7979","modified":1661159744611},{"_id":"public/2021/08/01/picture/go-wx-pic-generator/1.png","hash":"875f57e3a655a4a632bbfc322398aa967a0c8f70","modified":1661159744611},{"_id":"public/libs/awesome/webfonts/fa-solid-900.svg","hash":"7da88b19e1486f8c968d3cf5ab3f194f01ea17fd","modified":1661159744611},{"_id":"public/2020/11/29/picture/go-basic-usage-of-gg-package/2.png","hash":"a61ad75a1a8142fbb010146e04cdd06527e6344e","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon.png","hash":"3e435114b36dc401f60e0abbe3a3e220cdb51017","modified":1661159744611},{"_id":"public/2020/05/04/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (2).png","hash":"5f7e2e15ee7a80e5b620b909a10f8d25c56e5cca","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/10.png","hash":"35eb145d331b084141ffe3f7310944b9877f10bb","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/20.png","hash":"2efae28fd7e0988fe85fd50e8465cd6fd023726a","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/4.png","hash":"fd046d86fc1c3bd4d57ee79743e54e708883e35a","modified":1661159744611},{"_id":"public/2021/08/01/picture/go-wx-pic-generator/7.png","hash":"f20f84e8dc82ed15cffdd1e04428c290558848c7","modified":1661159744611},{"_id":"public/2021/08/01/picture/go-wx-pic-generator/9.png","hash":"e7cb186067731456a88a8efe52e44349786f74bd","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/6.png","hash":"e90cbb719271f7d80bbd6909820f8682a5de5a72","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/15.png","hash":"3a1490bbc6a9a6bf6bee3c33237b2732b82e8d52","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/31.png","hash":"8f133c615c4113a0a690f37a62b18fcb89d16aef","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/1.jpg","hash":"af186c836ce5d25dbea309389106504532065d82","modified":1661159744611},{"_id":"public/2021/02/17/conclusion/2020-conclusion-slim/5.png","hash":"2d2e9f6dbe38e9e475a2aafc145b1452b8de781f","modified":1661159744611},{"_id":"public/2020/12/22/picture/go-draw-word-in-pic2/方正楷体简体.ttf","hash":"8e153ec0f6ccb6ea99f4e6e1e54747e9fe094d0a","modified":1661159744611},{"_id":"public/2020/12/20/picture/go-draw-word-in-pic/方正楷体简体.ttf","hash":"8e153ec0f6ccb6ea99f4e6e1e54747e9fe094d0a","modified":1661159744611},{"_id":"public/2020/12/22/picture/go-draw-word-in-pic2/SourceHanSansCN-Bold-2.otf","hash":"de83272324b51764b0fd5e642af63bb9d10d1055","modified":1661159744611},{"_id":"themes/hexo-theme-matery/source/medias/avatar1.jpg","hash":"c8c6de0429400fa669a85c72150699181aa901ca","modified":1660412121220},{"_id":"public/medias/avatar1.jpg","hash":"c8c6de0429400fa669a85c72150699181aa901ca","modified":1661159744611}],"Category":[{"name":"编程","_id":"cl70rsfb500085ohu9ti75tpk"},{"name":"life","_id":"cl70rsfb9000d5ohuckahdx5v"},{"name":"数据分析","parent":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbe000o5ohu7ka57f9g"},{"name":"生活","parent":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbi000w5ohuccg86wmx"},{"name":"生活","_id":"cl70rsfbr001m5ohu100072q3"},{"name":"答案","parent":"cl70rsfbr001m5ohu100072q3","_id":"cl70rsfbu001u5ohu4xw16h73"}],"Data":[{"_id":"friends","data":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}],"Page":[{"title":"about","date":"2020-05-01T11:24:13.000Z","type":"about","layout":"about","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2020-05-01 19:24:13\ntype: \"about\"\nlayout: \"about\"\n---\n","updated":"2020-05-01T11:24:13.000Z","path":"about/index.html","comments":1,"_id":"cl70rsf8q00005ohu8bzjcjzc","content":"<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":""},{"title":"categories","date":"2020-05-01T11:23:40.000Z","type":"categories","layout":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2020-05-01 19:23:40\ntype: \"categories\"\nlayout: \"categories\"\n---\n","updated":"2020-05-01T11:23:40.000Z","path":"categories/index.html","comments":1,"_id":"cl70rsf8u00015ohuh6fuave3","content":"<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":""},{"title":"friends","date":"2020-05-01T11:24:29.000Z","type":"friends","layout":"friends","_content":"","source":"friends/index.md","raw":"---\ntitle: friends\ndate: 2020-05-01 19:24:29\ntype: \"friends\"\nlayout: \"friends\"\n---\n","updated":"2020-05-01T11:24:29.000Z","path":"friends/index.html","comments":1,"_id":"cl70rsf8v00025ohu6npo94xn","content":"<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":""},{"title":"留言板","date":"2020-05-01T14:00:27.000Z","_content":"","source":"contact/index.md","raw":"---\ntitle: 留言板\ndate: 2020-05-01 22:00:27\n---\n","updated":"2020-05-01T14:00:27.000Z","path":"contact/index.html","comments":1,"layout":"page","_id":"cl70rsf8v00035ohu3sp8cxhf","content":"<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":""},{"title":"tags","date":"2020-05-01T11:23:57.000Z","type":"tags","layout":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2020-05-01 19:23:57\ntype: \"tags\"\nlayout: \"tags\"\n---\n","updated":"2020-05-01T11:23:57.000Z","path":"tags/index.html","comments":1,"_id":"cl70rsf8w00045ohubyh47hed","content":"<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":""}],"Post":[{"_content":"","source":"_posts/conclusion/2020-conclusion-working.md","raw":"","slug":"conclusion/2020-conclusion-working","published":1,"date":"2022-08-13T17:35:20.843Z","updated":"2022-08-13T17:35:20.843Z","title":"conclusion/2020-conclusion-working","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsf9s00055ohu90m5fofu","content":"<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":""},{"title":"【最佳实践】如何优雅的进行重试","toc":true,"top":true,"cover":true,"date":"2020-05-03T17:00:10.000Z","_content":"\n本文口味：冰镇杨梅           预计阅读：20分钟\n\n## 说明\n\n最近公司在搞活动，需要依赖一个第三方接口，测试阶段并没有什么异常状况，但上线后发现依赖的接口有时候会因为内部错误而返回系统异常，虽然概率不大，但总因为这个而报警总是不好的，何况死信队列的消息还需要麻烦运维进行重新投递，所以加上重试机制势在必行。\n\n重试机制可以保护系统减少因网络波动、依赖服务短暂性不可用带来的影响，让系统能更稳定的运行的一种保护机制。让你原本就稳如狗的系统更是稳上加稳。\n\n![1](https://i.loli.net/2019/08/04/eAUjdRTgskmWF3f.png)\n\n为了方便说明，先假设我们想要进行重试的方法如下：\n\n```java\n@Slf4j\n@Component\npublic class HelloService {\n\n    private static AtomicLong helloTimes = new AtomicLong();\n\n    public String hello(){\n        long times = helloTimes.incrementAndGet();\n        if (times % 4 != 0){\n            log.warn(\"发生异常，time：{}\", LocalTime.now() );\n            throw new HelloRetryException(\"发生Hello异常\");\n        }\n        return \"hello\";\n    }\n}\n```\n\n调用处：\n\n```java\n@Slf4j\n@Service\npublic class HelloRetryService implements IHelloService{\n\n    @Autowired\n    private HelloService helloService;\n\n    public String hello(){\n        return helloService.hello();\n    }\n}\n```\n\n也就是说，这个接口每调4次才会成功一次。\n\n## 手动重试\n\n先来用最简单的方法，直接在调用的时候进重试：\n\n```java\n// 手动重试\npublic String hello(){\n    int maxRetryTimes = 4;\n    String s = \"\";\n    for (int retry = 1; retry <= maxRetryTimes; retry++) {\n        try {\n            s = helloService.hello();\n            log.info(\"helloService返回:{}\", s);\n            return s;\n        } catch (HelloRetryException e) {\n            log.info(\"helloService.hello() 调用失败，准备重试\");\n        }\n    }\n    throw new HelloRetryException(\"重试次数耗尽\");\n}\n```\n\n输出如下：\n\n```shell\n发生异常，time：10:17:21.079413300\nhelloService.hello() 调用失败，准备重试\n发生异常，time：10:17:21.085861800\nhelloService.hello() 调用失败，准备重试\n发生异常，time：10:17:21.085861800\nhelloService.hello() 调用失败，准备重试\nhelloService返回:hello\nservice.helloRetry()：hello\n```\n\n程序在极短的时间内进行了4次重试，然后成功返回。\n\n这样虽然看起来可以解决问题，但实践上，由于没有重试间隔，很可能当时依赖的服务尚未从网络异常中恢复过来，所以极有可能接下来的几次调用都是失败的。\n\n而且，这样需要对代码进行大量的侵入式修改，显然，不优雅。\n\n![3.png](https://i.loli.net/2019/08/04/ABwDil3xTFaIfyu.png)\n\n## 代理模式\n\n上面的处理方式由于需要对业务代码进行大量修改，虽然实现了功能，但是对原有代码的侵入性太强，可维护性差。\n\n所以需要使用一种更优雅一点的方式，不直接修改业务代码，那要怎么做呢？\n\n其实很简单，直接在业务代码的外面再包一层就行了，代理模式在这里就有用武之地了。\n\n```java\n@Slf4j\npublic class HelloRetryProxyService implements IHelloService{\n   \n    @Autowired\n    private HelloRetryService helloRetryService;\n    \n    @Override\n    public String hello() {\n        int maxRetryTimes = 4;\n        String s = \"\";\n        for (int retry = 1; retry <= maxRetryTimes; retry++) {\n            try {\n                s = helloRetryService.hello();\n                log.info(\"helloRetryService 返回:{}\", s);\n                return s;\n            } catch (HelloRetryException e) {\n                log.info(\"helloRetryService.hello() 调用失败，准备重试\");\n            }\n        }\n        throw new HelloRetryException(\"重试次数耗尽\");\n    }\n}\n```\n\n这样，重试逻辑就都由代理类来完成，原业务类的逻辑就不需要修改了，以后想修改重试逻辑也只需要修改这个类就行了，分工明确。比如，现在想要在重试之间加上一个延迟，只需要做一点点修改即可：\n\n```java\n@Override\npublic String hello() {\n    int maxRetryTimes = 4;\n    String s = \"\";\n    for (int retry = 1; retry <= maxRetryTimes; retry++) {\n        try {\n            s = helloRetryService.hello();\n            log.info(\"helloRetryService 返回:{}\", s);\n            return s;\n        } catch (HelloRetryException e) {\n            log.info(\"helloRetryService.hello() 调用失败，准备重试\");\n        }\n        // 延时一秒\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n    throw new HelloRetryException(\"重试次数耗尽\");\n}\n```\n\n代理模式虽然要更加优雅，但是如果依赖的服务很多的时候，要为每个服务都创建一个代理类，显然过于麻烦，而且其实重试的逻辑都大同小异，无非就是重试的次数和延时不一样而已。如果每个类都写这么一长串类似的代码，显然，不优雅！\n\n![4.png](https://i.loli.net/2019/08/04/z6JxEGdhUK9y1YW.png)\n\n## JDK动态代理\n\n这时候，动态代理就闪亮登场了。只需要写一个代理处理类，就可以开局一条狗，砍到九十九。\n\n```java\n@Slf4j\npublic class RetryInvocationHandler implements InvocationHandler {\n\n    private final Object subject;\n\n    public RetryInvocationHandler(Object subject) {\n        this.subject = subject;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        int times = 0;\n\n        while (times < RetryConstant.MAX_TIMES) {\n            try {\n                return method.invoke(subject, args);\n            } catch (Exception e) {\n                times++;\n                log.info(\"times:{},time:{}\", times, LocalTime.now());\n                if (times >= RetryConstant.MAX_TIMES) {\n                    throw new RuntimeException(e);\n                }\n            }\n\n            // 延时一秒\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * 获取动态代理\n     *\n     * @param realSubject 代理对象\n     */\n    public static Object getProxy(Object realSubject) {\n        InvocationHandler handler = new RetryInvocationHandler(realSubject);\n        return Proxy.newProxyInstance(handler.getClass().getClassLoader(),\n                realSubject.getClass().getInterfaces(), handler);\n    }\n\n}\n```\n\n来一发单元测：\n\n```java\n @Test\npublic void helloDynamicProxy() {\n    IHelloService realService = new HelloService();\n    IHelloService proxyService = (IHelloService)RetryInvocationHandler.getProxy(realService);\n\n    String hello = proxyService.hello();\n    log.info(\"hello:{}\", hello);\n}\n```\n\n输出如下：\n\n```shell\nhello times:1\n发生异常，time：11:22:20.727586700\ntimes:1,time:11:22:20.728083\nhello times:2\n发生异常，time：11:22:21.728858700\ntimes:2,time:11:22:21.729343700\nhello times:3\n发生异常，time：11:22:22.729706600\ntimes:3,time:11:22:22.729706600\nhello times:4\nhello:hello\n```\n\n在重试了4次之后输出了`Hello`，符合预期。\n\n动态代理可以将重试逻辑都放到一块，显然比直接使用代理类要方便很多，也更加优雅。\n\n不过不要高兴的太早，这里因为被代理的*HelloService*是一个简单的类，没有依赖其它类，所以直接创建是没有问题的，但如果被代理的类依赖了其它被*Spring*容器管理的类，则这种方式会抛出异常，因为没有把被依赖的实例注入到创建的代理实例中。\n\n这种情况下，就比较复杂了，需要从*Spring*容器中获取已经装配好的，需要被代理的实例，然后为其创建代理类实例，并交给*Spring*容器来管理，这样就不用每次都重新创建新的代理类实例了。\n\n话不多说，撸起袖子就是干。\n\n![timg.jpg](https://i.loli.net/2019/08/11/w8R6EAGCtkneQhI.jpg)\n\n新建一个工具类，用来获取代理实例：\n\n```java\n@Component\npublic class RetryProxyHandler {\n\n    @Autowired\n    private ConfigurableApplicationContext context;\n\n    public Object getProxy(Class clazz) {\n        // 1. 从Bean中获取对象\n        DefaultListableBeanFactory beanFactory = (DefaultListableBeanFactory)context.getAutowireCapableBeanFactory();\n        Map<String, Object> beans = beanFactory.getBeansOfType(clazz);\n        Set<Map.Entry<String, Object>> entries = beans.entrySet();\n        if (entries.size() <= 0){\n            throw new ProxyBeanNotFoundException();\n        }\n        // 如果有多个候选bean, 判断其中是否有代理bean\n        Object bean = null;\n        if (entries.size() > 1){\n            for (Map.Entry<String, Object> entry : entries) {\n                if (entry.getKey().contains(PROXY_BEAN_SUFFIX)){\n                    bean = entry.getValue();\n                }\n            };\n            if (bean != null){\n                return bean;\n            }\n            throw new ProxyBeanNotSingleException();\n        }\n\n        Object source = beans.entrySet().iterator().next().getValue();\n        Object source = beans.entrySet().iterator().next().getValue();\n\n        // 2. 判断该对象的代理对象是否存在\n        String proxyBeanName = clazz.getSimpleName() + PROXY_BEAN_SUFFIX;\n        Boolean exist = beanFactory.containsBean(proxyBeanName);\n        if (exist) {\n            bean = beanFactory.getBean(proxyBeanName);\n            return bean;\n        }\n\n        // 3. 不存在则生成代理对象\n        bean = RetryInvocationHandler.getProxy(source);\n\n        // 4. 将bean注入spring容器\n        beanFactory.registerSingleton(proxyBeanName, bean);\n        return bean;\n    }\n}\n```\n\n使用的是`JDK动态代理`：\n\n```java\n@Slf4j\npublic class RetryInvocationHandler implements InvocationHandler {\n\n    private final Object subject;\n\n    public RetryInvocationHandler(Object subject) {\n        this.subject = subject;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        int times = 0;\n\n        while (times < RetryConstant.MAX_TIMES) {\n            try {\n                return method.invoke(subject, args);\n            } catch (Exception e) {\n                times++;\n                log.info(\"retry times:{},time:{}\", times, LocalTime.now());\n                if (times >= RetryConstant.MAX_TIMES) {\n                    throw new RuntimeException(e);\n                }\n            }\n\n            // 延时一秒\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * 获取动态代理\n     *\n     * @param realSubject 代理对象\n     */\n    public static Object getProxy(Object realSubject) {\n        InvocationHandler handler = new RetryInvocationHandler(realSubject);\n        return Proxy.newProxyInstance(handler.getClass().getClassLoader(),\n                realSubject.getClass().getInterfaces(), handler);\n    }\n\n}\n```\n\n至此，主要代码就完成了，修改一下*HelloService*类，增加一个依赖：\n\n```java\n@Slf4j\n@Component\npublic class HelloService implements IHelloService{\n\n    private static AtomicLong helloTimes = new AtomicLong();\n\n    @Autowired\n    private NameService nameService;\n\n    public String hello(){\n        long times = helloTimes.incrementAndGet();\n        log.info(\"hello times:{}\", times);\n        if (times % 4 != 0){\n            log.warn(\"发生异常，time：{}\", LocalTime.now() );\n            throw new HelloRetryException(\"发生Hello异常\");\n        }\n        return \"hello \" + nameService.getName();\n    }\n}\n```\n\n*NameService*其实很简单，创建的目的仅在于测试依赖注入的*Bean*能否正常运行。\n\n```java\n@Service\npublic class NameService {\n\n    public String getName(){\n        return \"Frank\";\n    }\n}\n```\n\n来一发测试：\n\n```java\n@Test\npublic void helloJdkProxy() throws InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException {\n    IHelloService proxy = (IHelloService) retryProxyHandler.getProxy(HelloService.class);\n    String hello = proxy.hello();\n    log.info(\"hello:{}\", hello);\n}\n```\n\n```text\nhello times:1\n发生异常，time：14:40:27.540672200\nretry times:1,time:14:40:27.541167400\nhello times:2\n发生异常，time：14:40:28.541584600\nretry times:2,time:14:40:28.542033500\nhello times:3\n发生异常，time：14:40:29.542161500\nretry times:3,time:14:40:29.542161500\nhello times:4\nhello:hello Frank\n```\n\n完美，这样就不用担心依赖注入的问题了，因为从*Spring*容器中拿到的*Bean*对象都是已经注入配置好的。当然，这里仅考虑了单例*Bean*的情况，可以考虑的更加完善一点，判断一下容器中*Bean*的类型是Singleton还是*Prototype*，如果是*Singleton*则像上面这样进行操作，如果是*Prototype*则每次都新建代理类对象。\n\n另外，这里使用的是`JDK动态代理`，因此就存在一个天然的缺陷，如果想要被代理的类，没有实现任何接口，那么就无法为其创建代理对象，这种方式就行不通了。\n\n![EDaBTlbkyvbhmng.jpg](https://i.loli.net/2019/08/11/GzmFVto59SLMgOl.jpg)\n\n## CGLib 动态代理\n\n既然已经说到了`JDK动态代理`，那就不得不提`CGLib动态代理`了。使用`JDK动态代理`对被代理的类有要求，不是所有的类都能被代理，而`CGLib动态代理`则刚好解决了这个问题。\n\n创建一个`CGLib动态代理`类：\n\n```java\n@Slf4j\npublic class CGLibRetryProxyHandler implements MethodInterceptor {\n    private Object target;//需要代理的目标对象\n\n    //重写拦截方法\n    @Override\n    public Object intercept(Object obj, Method method, Object[] arr, MethodProxy proxy) throws Throwable {\n        int times = 0;\n\n        while (times < RetryConstant.MAX_TIMES) {\n            try {\n                return method.invoke(target, arr);\n            } catch (Exception e) {\n                times++;\n                log.info(\"cglib retry :{},time:{}\", times, LocalTime.now());\n                if (times >= RetryConstant.MAX_TIMES) {\n                    throw new RuntimeException(e);\n                }\n            }\n\n            // 延时一秒\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n        return null;\n    }\n    //定义获取代理对象方法\n    public Object getCglibProxy(Object objectTarget){\n        this.target = objectTarget;\n        Enhancer enhancer = new Enhancer();\n        enhancer.setSuperclass(objectTarget.getClass());\n        enhancer.setCallback(this);\n        Object result = enhancer.create();\n        return result;\n    }\n}\n```\n\n想要换用`CGLib动态代理`，替换一下这两行代码即可：\n\n```java\n// 3. 不存在则生成代理对象\n//        bean = RetryInvocationHandler.getProxy(source);\nCGLibRetryProxyHandler proxyHandler = new CGLibRetryProxyHandler();\nbean = proxyHandler.getCglibProxy(source);\n```\n\n开始测试：\n\n```java\n@Test\npublic void helloCGLibProxy() {\n    IHelloService proxy = (IHelloService) retryProxyHandler.getProxy(HelloService.class);\n    String hello = proxy.hello();\n    log.info(\"hello:{}\", hello);\n\n    hello = proxy.hello();\n    log.info(\"hello:{}\", hello);\n}\n```\n\n```text\nhello times:1\n发生异常，time：15:06:00.799679100\ncglib retry :1,time:15:06:00.800175400\nhello times:2\n发生异常，time：15:06:01.800848600\ncglib retry :2,time:15:06:01.801343100\nhello times:3\n发生异常，time：15:06:02.802180\ncglib retry :3,time:15:06:02.802180\nhello times:4\nhello:hello Frank\nhello times:5\n发生异常，time：15:06:03.803933800\ncglib retry :1,time:15:06:03.803933800\nhello times:6\n发生异常，time：15:06:04.804945400\ncglib retry :2,time:15:06:04.805442\nhello times:7\n发生异常，time：15:06:05.806886500\ncglib retry :3,time:15:06:05.807881300\nhello times:8\nhello:hello Frank\n```\n\n这样就很棒了，完美的解决了`JDK动态代理`带来的缺陷。优雅指数上涨了不少。\n\n但这个方案仍旧存在一个问题，那就是需要对原来的逻辑进行侵入式修改，在每个被代理实例被调用的地方都需要进行调整，这样仍然会对原有代码带来较多修改。\n\n![fuuTyTbkyvbhmsa.jpg](https://i.loli.net/2019/08/11/IczsWOdt4PL6vom.jpg)\n\n## Spring AOP\n\n想要无侵入式的修改原有逻辑？想要一个注解就实现重试？用`Spring AOP`不就能完美实现吗？使用`AOP`来为目标调用设置切面，即可在目标方法调用前后添加一些额外的逻辑。\n\n先创建一个注解：\n\n```java\n@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface Retryable {\n    int retryTimes() default 3;\n    int retryInterval() default 1;\n}\n```\n\n有两个参数，*retryTimes* 代表最大重试次数，*retryInterval*代表重试间隔。\n\n然后在需要重试的方法上加上注解：\n\n```java\n@Retryable(retryTimes = 4, retryInterval = 2)\npublic String hello(){\n    long times = helloTimes.incrementAndGet();\n    log.info(\"hello times:{}\", times);\n    if (times % 4 != 0){\n        log.warn(\"发生异常，time：{}\", LocalTime.now() );\n        throw new HelloRetryException(\"发生Hello异常\");\n    }\n    return \"hello \" + nameService.getName();\n}\n```\n\n接着，进行最后一步，编写*AOP*切面：\n\n```java\n@Slf4j\n@Aspect\n@Component\npublic class RetryAspect {\n\n    @Pointcut(\"@annotation(com.mfrank.springboot.retry.demo.annotation.Retryable)\")\n    private void retryMethodCall(){}\n\n    @Around(\"retryMethodCall()\")\n    public Object retry(ProceedingJoinPoint joinPoint) throws InterruptedException {\n        // 获取重试次数和重试间隔\n        Retryable retry = ((MethodSignature)joinPoint.getSignature()).getMethod().getAnnotation(Retryable.class);\n        int maxRetryTimes = retry.retryTimes();\n        int retryInterval = retry.retryInterval();\n\n        Throwable error = new RuntimeException();\n        for (int retryTimes = 1; retryTimes <= maxRetryTimes; retryTimes++){\n            try {\n                Object result = joinPoint.proceed();\n                return result;\n            } catch (Throwable throwable) {\n                error = throwable;\n                log.warn(\"调用发生异常，开始重试，retryTimes:{}\", retryTimes);\n            }\n            Thread.sleep(retryInterval * 1000);\n        }\n        throw new RetryExhaustedException(\"重试次数耗尽\", error);\n    }\n}\n```\n\n开始测试：\n\n```java\n@Autowired\nprivate HelloService helloService;\n\n@Test\npublic void helloAOP(){\n    String hello = helloService.hello();\n    log.info(\"hello:{}\", hello);\n}\n```\n\n输出如下：\n\n```text\nhello times:1\n发生异常，time：16:49:30.224649800\n调用发生异常，开始重试，retryTimes:1\nhello times:2\n发生异常，time：16:49:32.225230800\n调用发生异常，开始重试，retryTimes:2\nhello times:3\n发生异常，time：16:49:34.225968900\n调用发生异常，开始重试，retryTimes:3\nhello times:4\nhello:hello Frank\n```\n\n这样就相当优雅了，一个注解就能搞定重试，简直不要更棒。\n\n![IStGDBbkyvbhmow.jpg](https://i.loli.net/2019/08/11/fOegoZhjwECGbA9.jpg)\n\n## Spring 的重试注解\n\n实际上*Spring*中就有比较完善的重试机制，比上面的切面更加好用，还不需要自己动手重新造轮子。\n\n那让我们先来看看这个轮子究竟好不好使。\n\n先引入重试所需的jar包：\n\n```xml\n<dependency>\n    <groupId>org.springframework.retry</groupId>\n    <artifactId>spring-retry</artifactId>\n</dependency>\n<dependency>\n    <groupId>org.aspectj</groupId>\n    <artifactId>aspectjweaver</artifactId>\n</dependency>\n```\n\n然后在启动类或者配置类上添加*@EnableRetry*注解，接下来在需要重试的方法上添加*@Retryable*注解（嗯？好像跟我自定义的注解一样？竟然抄袭我的注解！ [手动滑稽] ） \n\n```java\n@Retryable\npublic String hello(){\n    long times = helloTimes.incrementAndGet();\n    log.info(\"hello times:{}\", times);\n    if (times % 4 != 0){\n        log.warn(\"发生异常，time：{}\", LocalTime.now() );\n        throw new HelloRetryException(\"发生Hello异常\");\n    }\n    return \"hello \" + nameService.getName();\n}\n```\n\n默认情况下，会重试三次，重试间隔为1秒。当然我们也可以自定义重试次数和间隔。这样就跟我前面实现的功能是一毛一样的了。\n\n但*Spring*里的重试机制还支持很多很有用的特性，比如说，可以指定只对特定类型的异常进行重试，这样如果抛出的是其它类型的异常则不会进行重试，就可以对重试进行更细粒度的控制。默认为空，会对所有异常都重试。\n\n```java\n@Retryable{value = {HelloRetryException.class}}\npublic String hello(){2\n    ...\n}\n```\n\n也可以使用*include*和*exclude*来指定包含或者排除哪些异常进行重试。\n\n可以用*maxAttemps*指定最大重试次数，默认为3次。\n\n可以用*interceptor*设置重试拦截器的bean名称。\n\n可以通过*label*设置该重试的唯一标志，用于统计输出。\n\n可以使用*exceptionExpression*来添加异常表达式，在抛出异常后执行，以判断后续是否进行重试。\n\n此外，*Spring*中的重试机制还支持使用*backoff*来设置重试补偿机制，可以设置重试间隔，并且支持设置重试延迟倍数。\n\n举个例子：\n\n```java\n@Retryable(value = {HelloRetryException.class}, maxAttempts = 5,\n           backoff = @Backoff(delay = 1000, multiplier = 2))\npublic String hello(){\n    ...\n}\n```\n\n该方法调用将会在抛出*HelloRetryException*异常后进行重试，最大重试次数为5，第一次重试间隔为1s，之后以2倍大小进行递增，第二次重试间隔为2s，第三次为4s，第四次为8s。\n\n重试机制还支持使用 `@Recover` 注解来进行善后工作，当重试达到指定次数之后，将会调用该方法，可以在该方法中进行日志记录等操作。\n\n这里值得注意的是，想要 `@Recover` 注解生效的话，需要跟被 `@Retryable` 标记的方法在同一个类中，且被 `@Retryable` 标记的方法不能有返回值，否则不会生效。\n\n并且如果使用了 `@Recover` 注解的话，重试次数达到最大次数后，如果在 `@Recover` 标记的方法中无异常抛出，是不会抛出原异常的。\n\n```java\n@Recover\npublic boolean recover(Exception e) {\n    log.error(\"达到最大重试次数\",e);\n    return false;\n}\n```\n\n除了使用注解外，`Spring Retry` 也支持直接在调用时使用代码进行重试：\n\n```java\n@Test\npublic void normalSpringRetry() {\n    // 表示哪些异常需要重试,key表示异常的字节码,value为true表示需要重试\n    Map<Class<? extends Throwable>, Boolean> exceptionMap = new HashMap<>();\n    exceptionMap.put(HelloRetryException.class, true);\n\n    // 构建重试模板实例\n    RetryTemplate retryTemplate = new RetryTemplate();\n\n    // 设置重试回退操作策略，主要设置重试间隔时间\n    FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();\n    long fixedPeriodTime = 1000L;\n    backOffPolicy.setBackOffPeriod(fixedPeriodTime);\n\n    // 设置重试策略，主要设置重试次数\n    int maxRetryTimes = 3;\n    SimpleRetryPolicy retryPolicy = new SimpleRetryPolicy(maxRetryTimes, exceptionMap);\n\n    retryTemplate.setRetryPolicy(retryPolicy);\n    retryTemplate.setBackOffPolicy(backOffPolicy);\n\n    Boolean execute = retryTemplate.execute(\n        //RetryCallback\n        retryContext -> {\n            String hello = helloService.hello();\n            log.info(\"调用的结果:{}\", hello);\n            return true;\n        },\n        // RecoverCallBack\n        retryContext -> {\n            //RecoveryCallback\n            log.info(\"已达到最大重试次数\");\n            return false;\n        }\n    );\n}\n```\n\n此时唯一的好处是可以设置多种重试策略：\n\n```java\nNeverRetryPolicy：只允许调用RetryCallback一次，不允许重试\n\nAlwaysRetryPolicy：允许无限重试，直到成功，此方式逻辑不当会导致死循环\n\nSimpleRetryPolicy：固定次数重试策略，默认重试最大次数为3次，RetryTemplate默认使用的策略\n\nTimeoutRetryPolicy：超时时间重试策略，默认超时时间为1秒，在指定的超时时间内允许重试\n\nExceptionClassifierRetryPolicy：设置不同异常的重试策略，类似组合重试策略，区别在于这里只区分不同异常的重试\n\nCircuitBreakerRetryPolicy：有熔断功能的重试策略，需设置3个参数openTimeout、resetTimeout和delegate\n\nCompositeRetryPolicy：组合重试策略，有两种组合方式，乐观组合重试策略是指只要有一个策略允许即可以重试，\n悲观组合重试策略是指只要有一个策略不允许即可以重试，但不管哪种组合方式，组合中的每一个策略都会执行\n```\n\n可以看出，`Spring` 中的重试机制还是相当完善的，比上面自己写的 `AOP` 切面功能更加强大。\n\n这里还需要再提醒的一点是，由于`Spring Retry`用到了`Aspect`增强，所以就会有使用`Aspect`不可避免的坑——方法内部调用，如果被 `@Retryable` 注解的方法的调用方和被调用方处于同一个类中，那么重试将会失效。\n\n但也还是存在一定的不足，`Spring`的重试机制只支持对异常进行捕获，而无法对返回值进行校验。\n\n![dtFxiMbkyvbhlzo.jpg](https://i.loli.net/2019/08/11/9CuPZHtqMbpLA8a.jpg)\n\n## Guava Retry\n\n最后，再介绍另一个重试利器——`Guava Retry`。\n\n相比`Spring Retry`，`Guava Retry`具有更强的灵活性，可以根据返回值校验来判断是否需要进行重试。\n\n先来看一个小栗子：\n\n先引入jar包：\n\n```xml\n<dependency>\n    <groupId>com.github.rholder</groupId>\n    <artifactId>guava-retrying</artifactId>\n    <version>2.0.0</version>\n</dependency>\n```\n\n然后用一个小Demo来感受一下：\n\n```java\n@Test\npublic void guavaRetry() {\n    Retryer<String> retryer = RetryerBuilder.<String>newBuilder()\n        .retryIfExceptionOfType(HelloRetryException.class)\n        .retryIfResult(StringUtils::isEmpty)\n        .withWaitStrategy(WaitStrategies.fixedWait(3, TimeUnit.SECONDS))\n        .withStopStrategy(StopStrategies.stopAfterAttempt(3))\n        .build();\n\n    try {\n        retryer.call(() -> helloService.hello());\n    } catch (Exception e){\n        e.printStackTrace();\n    }\n}\n```\n\n先创建一个*Retryer*实例，然后使用这个实例对需要重试的方法进行调用，可以通过很多方法来设置重试机制，比如使用*retryIfException*来对所有异常进行重试，使用*retryIfExceptionOfType*方法来设置对指定异常进行重试，使用*retryIfResult*来对不符合预期的返回结果进行重试，使用*retryIfRuntimeException*方法来对所有*RuntimeException*进行重试。\n\n还有五个以*with*开头的方法，用来对重试策略/等待策略/阻塞策略/单次任务执行时间限制/自定义监听器进行设置，以实现更加强大的异常处理。\n\n通过跟 `Spring AOP` 的结合，可以实现比 `Spring Retry` 更加强大的重试功能。\n\n仔细对比之下，`Guava Retry` 可以提供的特性有：\n\n1. 可以设置任务单次执行的时间限制，如果超时则抛出异常。\n2. 可以设置重试监听器，用来执行额外的处理工作。\n3. 可以设置任务阻塞策略，即可以设置当前重试完成，下次重试开始前的这段时间做什么事情。\n4. 可以通过停止重试策略和等待策略结合使用来设置更加灵活的策略，比如指数等待时长并最多10次调用，随机等待时长并永不停止等等。\n\n![GBvgTpbkyvbhlEB.jpg](https://i.loli.net/2019/08/11/MFpbWwysvP6Zqo7.jpg)\n\n## 总结\n\n本文由浅入深的对多种重试的姿势进行了360度无死角教学，从最简单的手动重试，到使用静态代理，再到 `JDK动态代理` 和 `CGLib动态代理` ，再到 `Spring AOP`，都是手工造轮子的过程，最后介绍了两种目前比较好用的轮子，一个是`Spring Retry`，使用起来简单粗暴，与 `Spring` 框架天生搭配，一个注解搞定所有事情，另一个便是 `Guava Retry`，不依赖于 `Spring` 框架，自成体系，使用起来更加灵活强大。\n\n个人认为，大部分场景下，`Spring Retry` 提供的重试机制已经足够强大，如果不需要 `Guava Retry` 提供的额外灵活性，使用 `Spring Retry` 就很棒了。当然，具体情况具体分析，但没有必要的情况下，不鼓励重复造轮子，先把别人的轮子研究清楚再想想还用不用自己动手。\n\n本文到此就告一段落了，又用了一天的时间完成了完成了一篇文章，写作的目的在于总结和分享，我相信最佳实践是可以总结和积累下来的，在大多数场景下都是适用的，这些最佳实践会在逐渐的积累过程中，成为比经验更为重要的东西。因为经验不总结就会忘记，而总结出来的内容却不会被丢失。\n\n如果对于重试你有更好的想法，欢迎提出交流探讨，也欢迎关注我的公众号进行留言交流。\n\n[//]: # (![1565529015677.png]&#40;https://i.loli.net/2019/08/11/8MxBPNgyIlTZDRk.png&#41;)\n","source":"_posts/best-practice/how-to-retry-elegantly.md","raw":"---\ntitle: 【最佳实践】如何优雅的进行重试\ntags:\n  - 最佳实践\n  - 优雅重试\n  - Spring\ncategories:\n  - 编程\ntoc: true\ntop: true\ncover: true\ndate: 2020-05-04 01:00:10\n---\n\n本文口味：冰镇杨梅           预计阅读：20分钟\n\n## 说明\n\n最近公司在搞活动，需要依赖一个第三方接口，测试阶段并没有什么异常状况，但上线后发现依赖的接口有时候会因为内部错误而返回系统异常，虽然概率不大，但总因为这个而报警总是不好的，何况死信队列的消息还需要麻烦运维进行重新投递，所以加上重试机制势在必行。\n\n重试机制可以保护系统减少因网络波动、依赖服务短暂性不可用带来的影响，让系统能更稳定的运行的一种保护机制。让你原本就稳如狗的系统更是稳上加稳。\n\n![1](https://i.loli.net/2019/08/04/eAUjdRTgskmWF3f.png)\n\n为了方便说明，先假设我们想要进行重试的方法如下：\n\n```java\n@Slf4j\n@Component\npublic class HelloService {\n\n    private static AtomicLong helloTimes = new AtomicLong();\n\n    public String hello(){\n        long times = helloTimes.incrementAndGet();\n        if (times % 4 != 0){\n            log.warn(\"发生异常，time：{}\", LocalTime.now() );\n            throw new HelloRetryException(\"发生Hello异常\");\n        }\n        return \"hello\";\n    }\n}\n```\n\n调用处：\n\n```java\n@Slf4j\n@Service\npublic class HelloRetryService implements IHelloService{\n\n    @Autowired\n    private HelloService helloService;\n\n    public String hello(){\n        return helloService.hello();\n    }\n}\n```\n\n也就是说，这个接口每调4次才会成功一次。\n\n## 手动重试\n\n先来用最简单的方法，直接在调用的时候进重试：\n\n```java\n// 手动重试\npublic String hello(){\n    int maxRetryTimes = 4;\n    String s = \"\";\n    for (int retry = 1; retry <= maxRetryTimes; retry++) {\n        try {\n            s = helloService.hello();\n            log.info(\"helloService返回:{}\", s);\n            return s;\n        } catch (HelloRetryException e) {\n            log.info(\"helloService.hello() 调用失败，准备重试\");\n        }\n    }\n    throw new HelloRetryException(\"重试次数耗尽\");\n}\n```\n\n输出如下：\n\n```shell\n发生异常，time：10:17:21.079413300\nhelloService.hello() 调用失败，准备重试\n发生异常，time：10:17:21.085861800\nhelloService.hello() 调用失败，准备重试\n发生异常，time：10:17:21.085861800\nhelloService.hello() 调用失败，准备重试\nhelloService返回:hello\nservice.helloRetry()：hello\n```\n\n程序在极短的时间内进行了4次重试，然后成功返回。\n\n这样虽然看起来可以解决问题，但实践上，由于没有重试间隔，很可能当时依赖的服务尚未从网络异常中恢复过来，所以极有可能接下来的几次调用都是失败的。\n\n而且，这样需要对代码进行大量的侵入式修改，显然，不优雅。\n\n![3.png](https://i.loli.net/2019/08/04/ABwDil3xTFaIfyu.png)\n\n## 代理模式\n\n上面的处理方式由于需要对业务代码进行大量修改，虽然实现了功能，但是对原有代码的侵入性太强，可维护性差。\n\n所以需要使用一种更优雅一点的方式，不直接修改业务代码，那要怎么做呢？\n\n其实很简单，直接在业务代码的外面再包一层就行了，代理模式在这里就有用武之地了。\n\n```java\n@Slf4j\npublic class HelloRetryProxyService implements IHelloService{\n   \n    @Autowired\n    private HelloRetryService helloRetryService;\n    \n    @Override\n    public String hello() {\n        int maxRetryTimes = 4;\n        String s = \"\";\n        for (int retry = 1; retry <= maxRetryTimes; retry++) {\n            try {\n                s = helloRetryService.hello();\n                log.info(\"helloRetryService 返回:{}\", s);\n                return s;\n            } catch (HelloRetryException e) {\n                log.info(\"helloRetryService.hello() 调用失败，准备重试\");\n            }\n        }\n        throw new HelloRetryException(\"重试次数耗尽\");\n    }\n}\n```\n\n这样，重试逻辑就都由代理类来完成，原业务类的逻辑就不需要修改了，以后想修改重试逻辑也只需要修改这个类就行了，分工明确。比如，现在想要在重试之间加上一个延迟，只需要做一点点修改即可：\n\n```java\n@Override\npublic String hello() {\n    int maxRetryTimes = 4;\n    String s = \"\";\n    for (int retry = 1; retry <= maxRetryTimes; retry++) {\n        try {\n            s = helloRetryService.hello();\n            log.info(\"helloRetryService 返回:{}\", s);\n            return s;\n        } catch (HelloRetryException e) {\n            log.info(\"helloRetryService.hello() 调用失败，准备重试\");\n        }\n        // 延时一秒\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n    throw new HelloRetryException(\"重试次数耗尽\");\n}\n```\n\n代理模式虽然要更加优雅，但是如果依赖的服务很多的时候，要为每个服务都创建一个代理类，显然过于麻烦，而且其实重试的逻辑都大同小异，无非就是重试的次数和延时不一样而已。如果每个类都写这么一长串类似的代码，显然，不优雅！\n\n![4.png](https://i.loli.net/2019/08/04/z6JxEGdhUK9y1YW.png)\n\n## JDK动态代理\n\n这时候，动态代理就闪亮登场了。只需要写一个代理处理类，就可以开局一条狗，砍到九十九。\n\n```java\n@Slf4j\npublic class RetryInvocationHandler implements InvocationHandler {\n\n    private final Object subject;\n\n    public RetryInvocationHandler(Object subject) {\n        this.subject = subject;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        int times = 0;\n\n        while (times < RetryConstant.MAX_TIMES) {\n            try {\n                return method.invoke(subject, args);\n            } catch (Exception e) {\n                times++;\n                log.info(\"times:{},time:{}\", times, LocalTime.now());\n                if (times >= RetryConstant.MAX_TIMES) {\n                    throw new RuntimeException(e);\n                }\n            }\n\n            // 延时一秒\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * 获取动态代理\n     *\n     * @param realSubject 代理对象\n     */\n    public static Object getProxy(Object realSubject) {\n        InvocationHandler handler = new RetryInvocationHandler(realSubject);\n        return Proxy.newProxyInstance(handler.getClass().getClassLoader(),\n                realSubject.getClass().getInterfaces(), handler);\n    }\n\n}\n```\n\n来一发单元测：\n\n```java\n @Test\npublic void helloDynamicProxy() {\n    IHelloService realService = new HelloService();\n    IHelloService proxyService = (IHelloService)RetryInvocationHandler.getProxy(realService);\n\n    String hello = proxyService.hello();\n    log.info(\"hello:{}\", hello);\n}\n```\n\n输出如下：\n\n```shell\nhello times:1\n发生异常，time：11:22:20.727586700\ntimes:1,time:11:22:20.728083\nhello times:2\n发生异常，time：11:22:21.728858700\ntimes:2,time:11:22:21.729343700\nhello times:3\n发生异常，time：11:22:22.729706600\ntimes:3,time:11:22:22.729706600\nhello times:4\nhello:hello\n```\n\n在重试了4次之后输出了`Hello`，符合预期。\n\n动态代理可以将重试逻辑都放到一块，显然比直接使用代理类要方便很多，也更加优雅。\n\n不过不要高兴的太早，这里因为被代理的*HelloService*是一个简单的类，没有依赖其它类，所以直接创建是没有问题的，但如果被代理的类依赖了其它被*Spring*容器管理的类，则这种方式会抛出异常，因为没有把被依赖的实例注入到创建的代理实例中。\n\n这种情况下，就比较复杂了，需要从*Spring*容器中获取已经装配好的，需要被代理的实例，然后为其创建代理类实例，并交给*Spring*容器来管理，这样就不用每次都重新创建新的代理类实例了。\n\n话不多说，撸起袖子就是干。\n\n![timg.jpg](https://i.loli.net/2019/08/11/w8R6EAGCtkneQhI.jpg)\n\n新建一个工具类，用来获取代理实例：\n\n```java\n@Component\npublic class RetryProxyHandler {\n\n    @Autowired\n    private ConfigurableApplicationContext context;\n\n    public Object getProxy(Class clazz) {\n        // 1. 从Bean中获取对象\n        DefaultListableBeanFactory beanFactory = (DefaultListableBeanFactory)context.getAutowireCapableBeanFactory();\n        Map<String, Object> beans = beanFactory.getBeansOfType(clazz);\n        Set<Map.Entry<String, Object>> entries = beans.entrySet();\n        if (entries.size() <= 0){\n            throw new ProxyBeanNotFoundException();\n        }\n        // 如果有多个候选bean, 判断其中是否有代理bean\n        Object bean = null;\n        if (entries.size() > 1){\n            for (Map.Entry<String, Object> entry : entries) {\n                if (entry.getKey().contains(PROXY_BEAN_SUFFIX)){\n                    bean = entry.getValue();\n                }\n            };\n            if (bean != null){\n                return bean;\n            }\n            throw new ProxyBeanNotSingleException();\n        }\n\n        Object source = beans.entrySet().iterator().next().getValue();\n        Object source = beans.entrySet().iterator().next().getValue();\n\n        // 2. 判断该对象的代理对象是否存在\n        String proxyBeanName = clazz.getSimpleName() + PROXY_BEAN_SUFFIX;\n        Boolean exist = beanFactory.containsBean(proxyBeanName);\n        if (exist) {\n            bean = beanFactory.getBean(proxyBeanName);\n            return bean;\n        }\n\n        // 3. 不存在则生成代理对象\n        bean = RetryInvocationHandler.getProxy(source);\n\n        // 4. 将bean注入spring容器\n        beanFactory.registerSingleton(proxyBeanName, bean);\n        return bean;\n    }\n}\n```\n\n使用的是`JDK动态代理`：\n\n```java\n@Slf4j\npublic class RetryInvocationHandler implements InvocationHandler {\n\n    private final Object subject;\n\n    public RetryInvocationHandler(Object subject) {\n        this.subject = subject;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        int times = 0;\n\n        while (times < RetryConstant.MAX_TIMES) {\n            try {\n                return method.invoke(subject, args);\n            } catch (Exception e) {\n                times++;\n                log.info(\"retry times:{},time:{}\", times, LocalTime.now());\n                if (times >= RetryConstant.MAX_TIMES) {\n                    throw new RuntimeException(e);\n                }\n            }\n\n            // 延时一秒\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * 获取动态代理\n     *\n     * @param realSubject 代理对象\n     */\n    public static Object getProxy(Object realSubject) {\n        InvocationHandler handler = new RetryInvocationHandler(realSubject);\n        return Proxy.newProxyInstance(handler.getClass().getClassLoader(),\n                realSubject.getClass().getInterfaces(), handler);\n    }\n\n}\n```\n\n至此，主要代码就完成了，修改一下*HelloService*类，增加一个依赖：\n\n```java\n@Slf4j\n@Component\npublic class HelloService implements IHelloService{\n\n    private static AtomicLong helloTimes = new AtomicLong();\n\n    @Autowired\n    private NameService nameService;\n\n    public String hello(){\n        long times = helloTimes.incrementAndGet();\n        log.info(\"hello times:{}\", times);\n        if (times % 4 != 0){\n            log.warn(\"发生异常，time：{}\", LocalTime.now() );\n            throw new HelloRetryException(\"发生Hello异常\");\n        }\n        return \"hello \" + nameService.getName();\n    }\n}\n```\n\n*NameService*其实很简单，创建的目的仅在于测试依赖注入的*Bean*能否正常运行。\n\n```java\n@Service\npublic class NameService {\n\n    public String getName(){\n        return \"Frank\";\n    }\n}\n```\n\n来一发测试：\n\n```java\n@Test\npublic void helloJdkProxy() throws InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException {\n    IHelloService proxy = (IHelloService) retryProxyHandler.getProxy(HelloService.class);\n    String hello = proxy.hello();\n    log.info(\"hello:{}\", hello);\n}\n```\n\n```text\nhello times:1\n发生异常，time：14:40:27.540672200\nretry times:1,time:14:40:27.541167400\nhello times:2\n发生异常，time：14:40:28.541584600\nretry times:2,time:14:40:28.542033500\nhello times:3\n发生异常，time：14:40:29.542161500\nretry times:3,time:14:40:29.542161500\nhello times:4\nhello:hello Frank\n```\n\n完美，这样就不用担心依赖注入的问题了，因为从*Spring*容器中拿到的*Bean*对象都是已经注入配置好的。当然，这里仅考虑了单例*Bean*的情况，可以考虑的更加完善一点，判断一下容器中*Bean*的类型是Singleton还是*Prototype*，如果是*Singleton*则像上面这样进行操作，如果是*Prototype*则每次都新建代理类对象。\n\n另外，这里使用的是`JDK动态代理`，因此就存在一个天然的缺陷，如果想要被代理的类，没有实现任何接口，那么就无法为其创建代理对象，这种方式就行不通了。\n\n![EDaBTlbkyvbhmng.jpg](https://i.loli.net/2019/08/11/GzmFVto59SLMgOl.jpg)\n\n## CGLib 动态代理\n\n既然已经说到了`JDK动态代理`，那就不得不提`CGLib动态代理`了。使用`JDK动态代理`对被代理的类有要求，不是所有的类都能被代理，而`CGLib动态代理`则刚好解决了这个问题。\n\n创建一个`CGLib动态代理`类：\n\n```java\n@Slf4j\npublic class CGLibRetryProxyHandler implements MethodInterceptor {\n    private Object target;//需要代理的目标对象\n\n    //重写拦截方法\n    @Override\n    public Object intercept(Object obj, Method method, Object[] arr, MethodProxy proxy) throws Throwable {\n        int times = 0;\n\n        while (times < RetryConstant.MAX_TIMES) {\n            try {\n                return method.invoke(target, arr);\n            } catch (Exception e) {\n                times++;\n                log.info(\"cglib retry :{},time:{}\", times, LocalTime.now());\n                if (times >= RetryConstant.MAX_TIMES) {\n                    throw new RuntimeException(e);\n                }\n            }\n\n            // 延时一秒\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n        return null;\n    }\n    //定义获取代理对象方法\n    public Object getCglibProxy(Object objectTarget){\n        this.target = objectTarget;\n        Enhancer enhancer = new Enhancer();\n        enhancer.setSuperclass(objectTarget.getClass());\n        enhancer.setCallback(this);\n        Object result = enhancer.create();\n        return result;\n    }\n}\n```\n\n想要换用`CGLib动态代理`，替换一下这两行代码即可：\n\n```java\n// 3. 不存在则生成代理对象\n//        bean = RetryInvocationHandler.getProxy(source);\nCGLibRetryProxyHandler proxyHandler = new CGLibRetryProxyHandler();\nbean = proxyHandler.getCglibProxy(source);\n```\n\n开始测试：\n\n```java\n@Test\npublic void helloCGLibProxy() {\n    IHelloService proxy = (IHelloService) retryProxyHandler.getProxy(HelloService.class);\n    String hello = proxy.hello();\n    log.info(\"hello:{}\", hello);\n\n    hello = proxy.hello();\n    log.info(\"hello:{}\", hello);\n}\n```\n\n```text\nhello times:1\n发生异常，time：15:06:00.799679100\ncglib retry :1,time:15:06:00.800175400\nhello times:2\n发生异常，time：15:06:01.800848600\ncglib retry :2,time:15:06:01.801343100\nhello times:3\n发生异常，time：15:06:02.802180\ncglib retry :3,time:15:06:02.802180\nhello times:4\nhello:hello Frank\nhello times:5\n发生异常，time：15:06:03.803933800\ncglib retry :1,time:15:06:03.803933800\nhello times:6\n发生异常，time：15:06:04.804945400\ncglib retry :2,time:15:06:04.805442\nhello times:7\n发生异常，time：15:06:05.806886500\ncglib retry :3,time:15:06:05.807881300\nhello times:8\nhello:hello Frank\n```\n\n这样就很棒了，完美的解决了`JDK动态代理`带来的缺陷。优雅指数上涨了不少。\n\n但这个方案仍旧存在一个问题，那就是需要对原来的逻辑进行侵入式修改，在每个被代理实例被调用的地方都需要进行调整，这样仍然会对原有代码带来较多修改。\n\n![fuuTyTbkyvbhmsa.jpg](https://i.loli.net/2019/08/11/IczsWOdt4PL6vom.jpg)\n\n## Spring AOP\n\n想要无侵入式的修改原有逻辑？想要一个注解就实现重试？用`Spring AOP`不就能完美实现吗？使用`AOP`来为目标调用设置切面，即可在目标方法调用前后添加一些额外的逻辑。\n\n先创建一个注解：\n\n```java\n@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface Retryable {\n    int retryTimes() default 3;\n    int retryInterval() default 1;\n}\n```\n\n有两个参数，*retryTimes* 代表最大重试次数，*retryInterval*代表重试间隔。\n\n然后在需要重试的方法上加上注解：\n\n```java\n@Retryable(retryTimes = 4, retryInterval = 2)\npublic String hello(){\n    long times = helloTimes.incrementAndGet();\n    log.info(\"hello times:{}\", times);\n    if (times % 4 != 0){\n        log.warn(\"发生异常，time：{}\", LocalTime.now() );\n        throw new HelloRetryException(\"发生Hello异常\");\n    }\n    return \"hello \" + nameService.getName();\n}\n```\n\n接着，进行最后一步，编写*AOP*切面：\n\n```java\n@Slf4j\n@Aspect\n@Component\npublic class RetryAspect {\n\n    @Pointcut(\"@annotation(com.mfrank.springboot.retry.demo.annotation.Retryable)\")\n    private void retryMethodCall(){}\n\n    @Around(\"retryMethodCall()\")\n    public Object retry(ProceedingJoinPoint joinPoint) throws InterruptedException {\n        // 获取重试次数和重试间隔\n        Retryable retry = ((MethodSignature)joinPoint.getSignature()).getMethod().getAnnotation(Retryable.class);\n        int maxRetryTimes = retry.retryTimes();\n        int retryInterval = retry.retryInterval();\n\n        Throwable error = new RuntimeException();\n        for (int retryTimes = 1; retryTimes <= maxRetryTimes; retryTimes++){\n            try {\n                Object result = joinPoint.proceed();\n                return result;\n            } catch (Throwable throwable) {\n                error = throwable;\n                log.warn(\"调用发生异常，开始重试，retryTimes:{}\", retryTimes);\n            }\n            Thread.sleep(retryInterval * 1000);\n        }\n        throw new RetryExhaustedException(\"重试次数耗尽\", error);\n    }\n}\n```\n\n开始测试：\n\n```java\n@Autowired\nprivate HelloService helloService;\n\n@Test\npublic void helloAOP(){\n    String hello = helloService.hello();\n    log.info(\"hello:{}\", hello);\n}\n```\n\n输出如下：\n\n```text\nhello times:1\n发生异常，time：16:49:30.224649800\n调用发生异常，开始重试，retryTimes:1\nhello times:2\n发生异常，time：16:49:32.225230800\n调用发生异常，开始重试，retryTimes:2\nhello times:3\n发生异常，time：16:49:34.225968900\n调用发生异常，开始重试，retryTimes:3\nhello times:4\nhello:hello Frank\n```\n\n这样就相当优雅了，一个注解就能搞定重试，简直不要更棒。\n\n![IStGDBbkyvbhmow.jpg](https://i.loli.net/2019/08/11/fOegoZhjwECGbA9.jpg)\n\n## Spring 的重试注解\n\n实际上*Spring*中就有比较完善的重试机制，比上面的切面更加好用，还不需要自己动手重新造轮子。\n\n那让我们先来看看这个轮子究竟好不好使。\n\n先引入重试所需的jar包：\n\n```xml\n<dependency>\n    <groupId>org.springframework.retry</groupId>\n    <artifactId>spring-retry</artifactId>\n</dependency>\n<dependency>\n    <groupId>org.aspectj</groupId>\n    <artifactId>aspectjweaver</artifactId>\n</dependency>\n```\n\n然后在启动类或者配置类上添加*@EnableRetry*注解，接下来在需要重试的方法上添加*@Retryable*注解（嗯？好像跟我自定义的注解一样？竟然抄袭我的注解！ [手动滑稽] ） \n\n```java\n@Retryable\npublic String hello(){\n    long times = helloTimes.incrementAndGet();\n    log.info(\"hello times:{}\", times);\n    if (times % 4 != 0){\n        log.warn(\"发生异常，time：{}\", LocalTime.now() );\n        throw new HelloRetryException(\"发生Hello异常\");\n    }\n    return \"hello \" + nameService.getName();\n}\n```\n\n默认情况下，会重试三次，重试间隔为1秒。当然我们也可以自定义重试次数和间隔。这样就跟我前面实现的功能是一毛一样的了。\n\n但*Spring*里的重试机制还支持很多很有用的特性，比如说，可以指定只对特定类型的异常进行重试，这样如果抛出的是其它类型的异常则不会进行重试，就可以对重试进行更细粒度的控制。默认为空，会对所有异常都重试。\n\n```java\n@Retryable{value = {HelloRetryException.class}}\npublic String hello(){2\n    ...\n}\n```\n\n也可以使用*include*和*exclude*来指定包含或者排除哪些异常进行重试。\n\n可以用*maxAttemps*指定最大重试次数，默认为3次。\n\n可以用*interceptor*设置重试拦截器的bean名称。\n\n可以通过*label*设置该重试的唯一标志，用于统计输出。\n\n可以使用*exceptionExpression*来添加异常表达式，在抛出异常后执行，以判断后续是否进行重试。\n\n此外，*Spring*中的重试机制还支持使用*backoff*来设置重试补偿机制，可以设置重试间隔，并且支持设置重试延迟倍数。\n\n举个例子：\n\n```java\n@Retryable(value = {HelloRetryException.class}, maxAttempts = 5,\n           backoff = @Backoff(delay = 1000, multiplier = 2))\npublic String hello(){\n    ...\n}\n```\n\n该方法调用将会在抛出*HelloRetryException*异常后进行重试，最大重试次数为5，第一次重试间隔为1s，之后以2倍大小进行递增，第二次重试间隔为2s，第三次为4s，第四次为8s。\n\n重试机制还支持使用 `@Recover` 注解来进行善后工作，当重试达到指定次数之后，将会调用该方法，可以在该方法中进行日志记录等操作。\n\n这里值得注意的是，想要 `@Recover` 注解生效的话，需要跟被 `@Retryable` 标记的方法在同一个类中，且被 `@Retryable` 标记的方法不能有返回值，否则不会生效。\n\n并且如果使用了 `@Recover` 注解的话，重试次数达到最大次数后，如果在 `@Recover` 标记的方法中无异常抛出，是不会抛出原异常的。\n\n```java\n@Recover\npublic boolean recover(Exception e) {\n    log.error(\"达到最大重试次数\",e);\n    return false;\n}\n```\n\n除了使用注解外，`Spring Retry` 也支持直接在调用时使用代码进行重试：\n\n```java\n@Test\npublic void normalSpringRetry() {\n    // 表示哪些异常需要重试,key表示异常的字节码,value为true表示需要重试\n    Map<Class<? extends Throwable>, Boolean> exceptionMap = new HashMap<>();\n    exceptionMap.put(HelloRetryException.class, true);\n\n    // 构建重试模板实例\n    RetryTemplate retryTemplate = new RetryTemplate();\n\n    // 设置重试回退操作策略，主要设置重试间隔时间\n    FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();\n    long fixedPeriodTime = 1000L;\n    backOffPolicy.setBackOffPeriod(fixedPeriodTime);\n\n    // 设置重试策略，主要设置重试次数\n    int maxRetryTimes = 3;\n    SimpleRetryPolicy retryPolicy = new SimpleRetryPolicy(maxRetryTimes, exceptionMap);\n\n    retryTemplate.setRetryPolicy(retryPolicy);\n    retryTemplate.setBackOffPolicy(backOffPolicy);\n\n    Boolean execute = retryTemplate.execute(\n        //RetryCallback\n        retryContext -> {\n            String hello = helloService.hello();\n            log.info(\"调用的结果:{}\", hello);\n            return true;\n        },\n        // RecoverCallBack\n        retryContext -> {\n            //RecoveryCallback\n            log.info(\"已达到最大重试次数\");\n            return false;\n        }\n    );\n}\n```\n\n此时唯一的好处是可以设置多种重试策略：\n\n```java\nNeverRetryPolicy：只允许调用RetryCallback一次，不允许重试\n\nAlwaysRetryPolicy：允许无限重试，直到成功，此方式逻辑不当会导致死循环\n\nSimpleRetryPolicy：固定次数重试策略，默认重试最大次数为3次，RetryTemplate默认使用的策略\n\nTimeoutRetryPolicy：超时时间重试策略，默认超时时间为1秒，在指定的超时时间内允许重试\n\nExceptionClassifierRetryPolicy：设置不同异常的重试策略，类似组合重试策略，区别在于这里只区分不同异常的重试\n\nCircuitBreakerRetryPolicy：有熔断功能的重试策略，需设置3个参数openTimeout、resetTimeout和delegate\n\nCompositeRetryPolicy：组合重试策略，有两种组合方式，乐观组合重试策略是指只要有一个策略允许即可以重试，\n悲观组合重试策略是指只要有一个策略不允许即可以重试，但不管哪种组合方式，组合中的每一个策略都会执行\n```\n\n可以看出，`Spring` 中的重试机制还是相当完善的，比上面自己写的 `AOP` 切面功能更加强大。\n\n这里还需要再提醒的一点是，由于`Spring Retry`用到了`Aspect`增强，所以就会有使用`Aspect`不可避免的坑——方法内部调用，如果被 `@Retryable` 注解的方法的调用方和被调用方处于同一个类中，那么重试将会失效。\n\n但也还是存在一定的不足，`Spring`的重试机制只支持对异常进行捕获，而无法对返回值进行校验。\n\n![dtFxiMbkyvbhlzo.jpg](https://i.loli.net/2019/08/11/9CuPZHtqMbpLA8a.jpg)\n\n## Guava Retry\n\n最后，再介绍另一个重试利器——`Guava Retry`。\n\n相比`Spring Retry`，`Guava Retry`具有更强的灵活性，可以根据返回值校验来判断是否需要进行重试。\n\n先来看一个小栗子：\n\n先引入jar包：\n\n```xml\n<dependency>\n    <groupId>com.github.rholder</groupId>\n    <artifactId>guava-retrying</artifactId>\n    <version>2.0.0</version>\n</dependency>\n```\n\n然后用一个小Demo来感受一下：\n\n```java\n@Test\npublic void guavaRetry() {\n    Retryer<String> retryer = RetryerBuilder.<String>newBuilder()\n        .retryIfExceptionOfType(HelloRetryException.class)\n        .retryIfResult(StringUtils::isEmpty)\n        .withWaitStrategy(WaitStrategies.fixedWait(3, TimeUnit.SECONDS))\n        .withStopStrategy(StopStrategies.stopAfterAttempt(3))\n        .build();\n\n    try {\n        retryer.call(() -> helloService.hello());\n    } catch (Exception e){\n        e.printStackTrace();\n    }\n}\n```\n\n先创建一个*Retryer*实例，然后使用这个实例对需要重试的方法进行调用，可以通过很多方法来设置重试机制，比如使用*retryIfException*来对所有异常进行重试，使用*retryIfExceptionOfType*方法来设置对指定异常进行重试，使用*retryIfResult*来对不符合预期的返回结果进行重试，使用*retryIfRuntimeException*方法来对所有*RuntimeException*进行重试。\n\n还有五个以*with*开头的方法，用来对重试策略/等待策略/阻塞策略/单次任务执行时间限制/自定义监听器进行设置，以实现更加强大的异常处理。\n\n通过跟 `Spring AOP` 的结合，可以实现比 `Spring Retry` 更加强大的重试功能。\n\n仔细对比之下，`Guava Retry` 可以提供的特性有：\n\n1. 可以设置任务单次执行的时间限制，如果超时则抛出异常。\n2. 可以设置重试监听器，用来执行额外的处理工作。\n3. 可以设置任务阻塞策略，即可以设置当前重试完成，下次重试开始前的这段时间做什么事情。\n4. 可以通过停止重试策略和等待策略结合使用来设置更加灵活的策略，比如指数等待时长并最多10次调用，随机等待时长并永不停止等等。\n\n![GBvgTpbkyvbhlEB.jpg](https://i.loli.net/2019/08/11/MFpbWwysvP6Zqo7.jpg)\n\n## 总结\n\n本文由浅入深的对多种重试的姿势进行了360度无死角教学，从最简单的手动重试，到使用静态代理，再到 `JDK动态代理` 和 `CGLib动态代理` ，再到 `Spring AOP`，都是手工造轮子的过程，最后介绍了两种目前比较好用的轮子，一个是`Spring Retry`，使用起来简单粗暴，与 `Spring` 框架天生搭配，一个注解搞定所有事情，另一个便是 `Guava Retry`，不依赖于 `Spring` 框架，自成体系，使用起来更加灵活强大。\n\n个人认为，大部分场景下，`Spring Retry` 提供的重试机制已经足够强大，如果不需要 `Guava Retry` 提供的额外灵活性，使用 `Spring Retry` 就很棒了。当然，具体情况具体分析，但没有必要的情况下，不鼓励重复造轮子，先把别人的轮子研究清楚再想想还用不用自己动手。\n\n本文到此就告一段落了，又用了一天的时间完成了完成了一篇文章，写作的目的在于总结和分享，我相信最佳实践是可以总结和积累下来的，在大多数场景下都是适用的，这些最佳实践会在逐渐的积累过程中，成为比经验更为重要的东西。因为经验不总结就会忘记，而总结出来的内容却不会被丢失。\n\n如果对于重试你有更好的想法，欢迎提出交流探讨，也欢迎关注我的公众号进行留言交流。\n\n[//]: # (![1565529015677.png]&#40;https://i.loli.net/2019/08/11/8MxBPNgyIlTZDRk.png&#41;)\n","slug":"best-practice/how-to-retry-elegantly","published":1,"updated":"2020-05-03T17:00:10.000Z","_id":"cl70rsfb300065ohu2ghc4be7","comments":1,"layout":"post","photos":[],"link":"","content":"<p>本文口味：冰镇杨梅           预计阅读：20分钟</p>\n<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>最近公司在搞活动，需要依赖一个第三方接口，测试阶段并没有什么异常状况，但上线后发现依赖的接口有时候会因为内部错误而返回系统异常，虽然概率不大，但总因为这个而报警总是不好的，何况死信队列的消息还需要麻烦运维进行重新投递，所以加上重试机制势在必行。</p>\n<p>重试机制可以保护系统减少因网络波动、依赖服务短暂性不可用带来的影响，让系统能更稳定的运行的一种保护机制。让你原本就稳如狗的系统更是稳上加稳。</p>\n<p><img src=\"https://i.loli.net/2019/08/04/eAUjdRTgskmWF3f.png\" alt=\"1\"></p>\n<p>为了方便说明，先假设我们想要进行重试的方法如下：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> AtomicLong helloTimes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicLong</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> String <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">long</span> times <span class=\"token operator\">=</span> helloTimes<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>times <span class=\"token operator\">%</span> <span class=\"token number\">4</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发生异常，time：{}\"</span><span class=\"token punctuation\">,</span> LocalTime<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HelloRetryException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发生Hello异常\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>调用处：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloRetryService</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IHelloService</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> HelloService helloService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> String <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> helloService<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>也就是说，这个接口每调4次才会成功一次。</p>\n<h2 id=\"手动重试\"><a href=\"#手动重试\" class=\"headerlink\" title=\"手动重试\"></a>手动重试</h2><p>先来用最简单的方法，直接在调用的时候进重试：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token comment\" spellcheck=\"true\">// 手动重试</span>\n<span class=\"token keyword\">public</span> String <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> maxRetryTimes <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n    String s <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> retry <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> retry <span class=\"token operator\">&lt;=</span> maxRetryTimes<span class=\"token punctuation\">;</span> retry<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            s <span class=\"token operator\">=</span> helloService<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"helloService返回:{}\"</span><span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">HelloRetryException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"helloService.hello() 调用失败，准备重试\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HelloRetryException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"重试次数耗尽\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>输出如下：</p>\n<pre class=\" language-shell\"><code class=\"language-shell\">发生异常，time：10:17:21.079413300\nhelloService.hello() 调用失败，准备重试\n发生异常，time：10:17:21.085861800\nhelloService.hello() 调用失败，准备重试\n发生异常，time：10:17:21.085861800\nhelloService.hello() 调用失败，准备重试\nhelloService返回:hello\nservice.helloRetry()：hello</code></pre>\n<p>程序在极短的时间内进行了4次重试，然后成功返回。</p>\n<p>这样虽然看起来可以解决问题，但实践上，由于没有重试间隔，很可能当时依赖的服务尚未从网络异常中恢复过来，所以极有可能接下来的几次调用都是失败的。</p>\n<p>而且，这样需要对代码进行大量的侵入式修改，显然，不优雅。</p>\n<p><img src=\"https://i.loli.net/2019/08/04/ABwDil3xTFaIfyu.png\" alt=\"3.png\"></p>\n<h2 id=\"代理模式\"><a href=\"#代理模式\" class=\"headerlink\" title=\"代理模式\"></a>代理模式</h2><p>上面的处理方式由于需要对业务代码进行大量修改，虽然实现了功能，但是对原有代码的侵入性太强，可维护性差。</p>\n<p>所以需要使用一种更优雅一点的方式，不直接修改业务代码，那要怎么做呢？</p>\n<p>其实很简单，直接在业务代码的外面再包一层就行了，代理模式在这里就有用武之地了。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloRetryProxyService</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IHelloService</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> HelloRetryService helloRetryService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> String <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> maxRetryTimes <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n        String s <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> retry <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> retry <span class=\"token operator\">&lt;=</span> maxRetryTimes<span class=\"token punctuation\">;</span> retry<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                s <span class=\"token operator\">=</span> helloRetryService<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"helloRetryService 返回:{}\"</span><span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">HelloRetryException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"helloRetryService.hello() 调用失败，准备重试\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HelloRetryException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"重试次数耗尽\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这样，重试逻辑就都由代理类来完成，原业务类的逻辑就不需要修改了，以后想修改重试逻辑也只需要修改这个类就行了，分工明确。比如，现在想要在重试之间加上一个延迟，只需要做一点点修改即可：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> String <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> maxRetryTimes <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n    String s <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> retry <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> retry <span class=\"token operator\">&lt;=</span> maxRetryTimes<span class=\"token punctuation\">;</span> retry<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            s <span class=\"token operator\">=</span> helloRetryService<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"helloRetryService 返回:{}\"</span><span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">HelloRetryException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"helloRetryService.hello() 调用失败，准备重试\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\" spellcheck=\"true\">// 延时一秒</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HelloRetryException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"重试次数耗尽\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>代理模式虽然要更加优雅，但是如果依赖的服务很多的时候，要为每个服务都创建一个代理类，显然过于麻烦，而且其实重试的逻辑都大同小异，无非就是重试的次数和延时不一样而已。如果每个类都写这么一长串类似的代码，显然，不优雅！</p>\n<p><img src=\"https://i.loli.net/2019/08/04/z6JxEGdhUK9y1YW.png\" alt=\"4.png\"></p>\n<h2 id=\"JDK动态代理\"><a href=\"#JDK动态代理\" class=\"headerlink\" title=\"JDK动态代理\"></a>JDK动态代理</h2><p>这时候，动态代理就闪亮登场了。只需要写一个代理处理类，就可以开局一条狗，砍到九十九。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RetryInvocationHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">InvocationHandler</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> Object subject<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">RetryInvocationHandler</span><span class=\"token punctuation\">(</span>Object subject<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>subject <span class=\"token operator\">=</span> subject<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> Object <span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>Object proxy<span class=\"token punctuation\">,</span> Method method<span class=\"token punctuation\">,</span> Object<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> Throwable <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> times <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>times <span class=\"token operator\">&lt;</span> RetryConstant<span class=\"token punctuation\">.</span>MAX_TIMES<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> method<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                times<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"times:{},time:{}\"</span><span class=\"token punctuation\">,</span> times<span class=\"token punctuation\">,</span> LocalTime<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>times <span class=\"token operator\">>=</span> RetryConstant<span class=\"token punctuation\">.</span>MAX_TIMES<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token comment\" spellcheck=\"true\">// 延时一秒</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> null<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 获取动态代理\n     *\n     * @param realSubject 代理对象\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> Object <span class=\"token function\">getProxy</span><span class=\"token punctuation\">(</span>Object realSubject<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        InvocationHandler handler <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RetryInvocationHandler</span><span class=\"token punctuation\">(</span>realSubject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> Proxy<span class=\"token punctuation\">.</span><span class=\"token function\">newProxyInstance</span><span class=\"token punctuation\">(</span>handler<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                realSubject<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInterfaces</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre>\n<p>来一发单元测：</p>\n<pre class=\" language-java\"><code class=\"language-java\"> <span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">helloDynamicProxy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    IHelloService realService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HelloService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    IHelloService proxyService <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>IHelloService<span class=\"token punctuation\">)</span>RetryInvocationHandler<span class=\"token punctuation\">.</span><span class=\"token function\">getProxy</span><span class=\"token punctuation\">(</span>realService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    String hello <span class=\"token operator\">=</span> proxyService<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello:{}\"</span><span class=\"token punctuation\">,</span> hello<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>输出如下：</p>\n<pre class=\" language-shell\"><code class=\"language-shell\">hello times:1\n发生异常，time：11:22:20.727586700\ntimes:1,time:11:22:20.728083\nhello times:2\n发生异常，time：11:22:21.728858700\ntimes:2,time:11:22:21.729343700\nhello times:3\n发生异常，time：11:22:22.729706600\ntimes:3,time:11:22:22.729706600\nhello times:4\nhello:hello</code></pre>\n<p>在重试了4次之后输出了<code>Hello</code>，符合预期。</p>\n<p>动态代理可以将重试逻辑都放到一块，显然比直接使用代理类要方便很多，也更加优雅。</p>\n<p>不过不要高兴的太早，这里因为被代理的<em>HelloService</em>是一个简单的类，没有依赖其它类，所以直接创建是没有问题的，但如果被代理的类依赖了其它被<em>Spring</em>容器管理的类，则这种方式会抛出异常，因为没有把被依赖的实例注入到创建的代理实例中。</p>\n<p>这种情况下，就比较复杂了，需要从<em>Spring</em>容器中获取已经装配好的，需要被代理的实例，然后为其创建代理类实例，并交给<em>Spring</em>容器来管理，这样就不用每次都重新创建新的代理类实例了。</p>\n<p>话不多说，撸起袖子就是干。</p>\n<p><img src=\"https://i.loli.net/2019/08/11/w8R6EAGCtkneQhI.jpg\" alt=\"timg.jpg\"></p>\n<p>新建一个工具类，用来获取代理实例：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RetryProxyHandler</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> ConfigurableApplicationContext context<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> Object <span class=\"token function\">getProxy</span><span class=\"token punctuation\">(</span>Class <span class=\"token class-name\">clazz</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\" spellcheck=\"true\">// 1. 从Bean中获取对象</span>\n        DefaultListableBeanFactory beanFactory <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>DefaultListableBeanFactory<span class=\"token punctuation\">)</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">getAutowireCapableBeanFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Map<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Object<span class=\"token operator\">></span> beans <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBeansOfType</span><span class=\"token punctuation\">(</span>clazz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Set<span class=\"token operator\">&lt;</span>Map<span class=\"token punctuation\">.</span>Entry<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Object<span class=\"token operator\">>></span> entries <span class=\"token operator\">=</span> beans<span class=\"token punctuation\">.</span><span class=\"token function\">entrySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ProxyBeanNotFoundException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\" spellcheck=\"true\">// 如果有多个候选bean, 判断其中是否有代理bean</span>\n        Object bean <span class=\"token operator\">=</span> null<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>Map<span class=\"token punctuation\">.</span>Entry<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Object<span class=\"token operator\">></span> entry <span class=\"token operator\">:</span> entries<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>PROXY_BEAN_SUFFIX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                    bean <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bean <span class=\"token operator\">!=</span> null<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> bean<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ProxyBeanNotSingleException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        Object source <span class=\"token operator\">=</span> beans<span class=\"token punctuation\">.</span><span class=\"token function\">entrySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Object source <span class=\"token operator\">=</span> beans<span class=\"token punctuation\">.</span><span class=\"token function\">entrySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\" spellcheck=\"true\">// 2. 判断该对象的代理对象是否存在</span>\n        String proxyBeanName <span class=\"token operator\">=</span> clazz<span class=\"token punctuation\">.</span><span class=\"token function\">getSimpleName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> PROXY_BEAN_SUFFIX<span class=\"token punctuation\">;</span>\n        Boolean exist <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">containsBean</span><span class=\"token punctuation\">(</span>proxyBeanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>exist<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            bean <span class=\"token operator\">=</span> beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span>proxyBeanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> bean<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\" spellcheck=\"true\">// 3. 不存在则生成代理对象</span>\n        bean <span class=\"token operator\">=</span> RetryInvocationHandler<span class=\"token punctuation\">.</span><span class=\"token function\">getProxy</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\" spellcheck=\"true\">// 4. 将bean注入spring容器</span>\n        beanFactory<span class=\"token punctuation\">.</span><span class=\"token function\">registerSingleton</span><span class=\"token punctuation\">(</span>proxyBeanName<span class=\"token punctuation\">,</span> bean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> bean<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>使用的是<code>JDK动态代理</code>：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RetryInvocationHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">InvocationHandler</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> Object subject<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">RetryInvocationHandler</span><span class=\"token punctuation\">(</span>Object subject<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>subject <span class=\"token operator\">=</span> subject<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> Object <span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>Object proxy<span class=\"token punctuation\">,</span> Method method<span class=\"token punctuation\">,</span> Object<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> Throwable <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> times <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>times <span class=\"token operator\">&lt;</span> RetryConstant<span class=\"token punctuation\">.</span>MAX_TIMES<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> method<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                times<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"retry times:{},time:{}\"</span><span class=\"token punctuation\">,</span> times<span class=\"token punctuation\">,</span> LocalTime<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>times <span class=\"token operator\">>=</span> RetryConstant<span class=\"token punctuation\">.</span>MAX_TIMES<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token comment\" spellcheck=\"true\">// 延时一秒</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> null<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 获取动态代理\n     *\n     * @param realSubject 代理对象\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> Object <span class=\"token function\">getProxy</span><span class=\"token punctuation\">(</span>Object realSubject<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        InvocationHandler handler <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RetryInvocationHandler</span><span class=\"token punctuation\">(</span>realSubject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> Proxy<span class=\"token punctuation\">.</span><span class=\"token function\">newProxyInstance</span><span class=\"token punctuation\">(</span>handler<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getClassLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                realSubject<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInterfaces</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre>\n<p>至此，主要代码就完成了，修改一下<em>HelloService</em>类，增加一个依赖：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloService</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IHelloService</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> AtomicLong helloTimes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicLong</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> NameService nameService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> String <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">long</span> times <span class=\"token operator\">=</span> helloTimes<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello times:{}\"</span><span class=\"token punctuation\">,</span> times<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>times <span class=\"token operator\">%</span> <span class=\"token number\">4</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发生异常，time：{}\"</span><span class=\"token punctuation\">,</span> LocalTime<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HelloRetryException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发生Hello异常\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello \"</span> <span class=\"token operator\">+</span> nameService<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><em>NameService</em>其实很简单，创建的目的仅在于测试依赖注入的<em>Bean</em>能否正常运行。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NameService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> String <span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"Frank\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>来一发测试：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">helloJdkProxy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> InvocationTargetException<span class=\"token punctuation\">,</span> NoSuchMethodException<span class=\"token punctuation\">,</span> InstantiationException<span class=\"token punctuation\">,</span> IllegalAccessException <span class=\"token punctuation\">{</span>\n    IHelloService proxy <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>IHelloService<span class=\"token punctuation\">)</span> retryProxyHandler<span class=\"token punctuation\">.</span><span class=\"token function\">getProxy</span><span class=\"token punctuation\">(</span>HelloService<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    String hello <span class=\"token operator\">=</span> proxy<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello:{}\"</span><span class=\"token punctuation\">,</span> hello<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<pre class=\" language-text\"><code class=\"language-text\">hello times:1\n发生异常，time：14:40:27.540672200\nretry times:1,time:14:40:27.541167400\nhello times:2\n发生异常，time：14:40:28.541584600\nretry times:2,time:14:40:28.542033500\nhello times:3\n发生异常，time：14:40:29.542161500\nretry times:3,time:14:40:29.542161500\nhello times:4\nhello:hello Frank</code></pre>\n<p>完美，这样就不用担心依赖注入的问题了，因为从<em>Spring</em>容器中拿到的<em>Bean</em>对象都是已经注入配置好的。当然，这里仅考虑了单例<em>Bean</em>的情况，可以考虑的更加完善一点，判断一下容器中<em>Bean</em>的类型是Singleton还是<em>Prototype</em>，如果是<em>Singleton</em>则像上面这样进行操作，如果是<em>Prototype</em>则每次都新建代理类对象。</p>\n<p>另外，这里使用的是<code>JDK动态代理</code>，因此就存在一个天然的缺陷，如果想要被代理的类，没有实现任何接口，那么就无法为其创建代理对象，这种方式就行不通了。</p>\n<p><img src=\"https://i.loli.net/2019/08/11/GzmFVto59SLMgOl.jpg\" alt=\"EDaBTlbkyvbhmng.jpg\"></p>\n<h2 id=\"CGLib-动态代理\"><a href=\"#CGLib-动态代理\" class=\"headerlink\" title=\"CGLib 动态代理\"></a>CGLib 动态代理</h2><p>既然已经说到了<code>JDK动态代理</code>，那就不得不提<code>CGLib动态代理</code>了。使用<code>JDK动态代理</code>对被代理的类有要求，不是所有的类都能被代理，而<code>CGLib动态代理</code>则刚好解决了这个问题。</p>\n<p>创建一个<code>CGLib动态代理</code>类：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CGLibRetryProxyHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">MethodInterceptor</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> Object target<span class=\"token punctuation\">;</span><span class=\"token comment\" spellcheck=\"true\">//需要代理的目标对象</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">//重写拦截方法</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> Object <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span>Object obj<span class=\"token punctuation\">,</span> Method method<span class=\"token punctuation\">,</span> Object<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> arr<span class=\"token punctuation\">,</span> MethodProxy proxy<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> Throwable <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> times <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>times <span class=\"token operator\">&lt;</span> RetryConstant<span class=\"token punctuation\">.</span>MAX_TIMES<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> method<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> arr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                times<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cglib retry :{},time:{}\"</span><span class=\"token punctuation\">,</span> times<span class=\"token punctuation\">,</span> LocalTime<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>times <span class=\"token operator\">>=</span> RetryConstant<span class=\"token punctuation\">.</span>MAX_TIMES<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token comment\" spellcheck=\"true\">// 延时一秒</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> null<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\" spellcheck=\"true\">//定义获取代理对象方法</span>\n    <span class=\"token keyword\">public</span> Object <span class=\"token function\">getCglibProxy</span><span class=\"token punctuation\">(</span>Object objectTarget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>target <span class=\"token operator\">=</span> objectTarget<span class=\"token punctuation\">;</span>\n        Enhancer enhancer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Enhancer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        enhancer<span class=\"token punctuation\">.</span><span class=\"token function\">setSuperclass</span><span class=\"token punctuation\">(</span>objectTarget<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        enhancer<span class=\"token punctuation\">.</span><span class=\"token function\">setCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Object result <span class=\"token operator\">=</span> enhancer<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>想要换用<code>CGLib动态代理</code>，替换一下这两行代码即可：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token comment\" spellcheck=\"true\">// 3. 不存在则生成代理对象</span>\n<span class=\"token comment\" spellcheck=\"true\">//        bean = RetryInvocationHandler.getProxy(source);</span>\nCGLibRetryProxyHandler proxyHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CGLibRetryProxyHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbean <span class=\"token operator\">=</span> proxyHandler<span class=\"token punctuation\">.</span><span class=\"token function\">getCglibProxy</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>开始测试：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">helloCGLibProxy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    IHelloService proxy <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>IHelloService<span class=\"token punctuation\">)</span> retryProxyHandler<span class=\"token punctuation\">.</span><span class=\"token function\">getProxy</span><span class=\"token punctuation\">(</span>HelloService<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    String hello <span class=\"token operator\">=</span> proxy<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello:{}\"</span><span class=\"token punctuation\">,</span> hello<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    hello <span class=\"token operator\">=</span> proxy<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello:{}\"</span><span class=\"token punctuation\">,</span> hello<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<pre class=\" language-text\"><code class=\"language-text\">hello times:1\n发生异常，time：15:06:00.799679100\ncglib retry :1,time:15:06:00.800175400\nhello times:2\n发生异常，time：15:06:01.800848600\ncglib retry :2,time:15:06:01.801343100\nhello times:3\n发生异常，time：15:06:02.802180\ncglib retry :3,time:15:06:02.802180\nhello times:4\nhello:hello Frank\nhello times:5\n发生异常，time：15:06:03.803933800\ncglib retry :1,time:15:06:03.803933800\nhello times:6\n发生异常，time：15:06:04.804945400\ncglib retry :2,time:15:06:04.805442\nhello times:7\n发生异常，time：15:06:05.806886500\ncglib retry :3,time:15:06:05.807881300\nhello times:8\nhello:hello Frank</code></pre>\n<p>这样就很棒了，完美的解决了<code>JDK动态代理</code>带来的缺陷。优雅指数上涨了不少。</p>\n<p>但这个方案仍旧存在一个问题，那就是需要对原来的逻辑进行侵入式修改，在每个被代理实例被调用的地方都需要进行调整，这样仍然会对原有代码带来较多修改。</p>\n<p><img src=\"https://i.loli.net/2019/08/11/IczsWOdt4PL6vom.jpg\" alt=\"fuuTyTbkyvbhmsa.jpg\"></p>\n<h2 id=\"Spring-AOP\"><a href=\"#Spring-AOP\" class=\"headerlink\" title=\"Spring AOP\"></a>Spring AOP</h2><p>想要无侵入式的修改原有逻辑？想要一个注解就实现重试？用<code>Spring AOP</code>不就能完美实现吗？使用<code>AOP</code>来为目标调用设置切面，即可在目标方法调用前后添加一些额外的逻辑。</p>\n<p>先创建一个注解：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span>ElementType<span class=\"token punctuation\">.</span>METHOD<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span>RetentionPolicy<span class=\"token punctuation\">.</span>RUNTIME<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Documented</span>\n<span class=\"token keyword\">public</span> @<span class=\"token keyword\">interface</span> <span class=\"token class-name\">Retryable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> <span class=\"token function\">retryTimes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> <span class=\"token function\">retryInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">default</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>有两个参数，<em>retryTimes</em> 代表最大重试次数，<em>retryInterval</em>代表重试间隔。</p>\n<p>然后在需要重试的方法上加上注解：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Retryable</span><span class=\"token punctuation\">(</span>retryTimes <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> retryInterval <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> String <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">long</span> times <span class=\"token operator\">=</span> helloTimes<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello times:{}\"</span><span class=\"token punctuation\">,</span> times<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>times <span class=\"token operator\">%</span> <span class=\"token number\">4</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发生异常，time：{}\"</span><span class=\"token punctuation\">,</span> LocalTime<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HelloRetryException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发生Hello异常\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello \"</span> <span class=\"token operator\">+</span> nameService<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>接着，进行最后一步，编写<em>AOP</em>切面：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Aspect</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RetryAspect</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Pointcut</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@annotation(com.mfrank.springboot.retry.demo.annotation.Retryable)\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">retryMethodCall</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Around</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"retryMethodCall()\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Object <span class=\"token function\">retry</span><span class=\"token punctuation\">(</span>ProceedingJoinPoint joinPoint<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> InterruptedException <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\" spellcheck=\"true\">// 获取重试次数和重试间隔</span>\n        Retryable retry <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>MethodSignature<span class=\"token punctuation\">)</span>joinPoint<span class=\"token punctuation\">.</span><span class=\"token function\">getSignature</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAnnotation</span><span class=\"token punctuation\">(</span>Retryable<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> maxRetryTimes <span class=\"token operator\">=</span> retry<span class=\"token punctuation\">.</span><span class=\"token function\">retryTimes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> retryInterval <span class=\"token operator\">=</span> retry<span class=\"token punctuation\">.</span><span class=\"token function\">retryInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        Throwable error <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> retryTimes <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> retryTimes <span class=\"token operator\">&lt;=</span> maxRetryTimes<span class=\"token punctuation\">;</span> retryTimes<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                Object result <span class=\"token operator\">=</span> joinPoint<span class=\"token punctuation\">.</span><span class=\"token function\">proceed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> throwable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                error <span class=\"token operator\">=</span> throwable<span class=\"token punctuation\">;</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"调用发生异常，开始重试，retryTimes:{}\"</span><span class=\"token punctuation\">,</span> retryTimes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>retryInterval <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RetryExhaustedException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"重试次数耗尽\"</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>开始测试：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Autowired</span>\n<span class=\"token keyword\">private</span> HelloService helloService<span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">helloAOP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    String hello <span class=\"token operator\">=</span> helloService<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello:{}\"</span><span class=\"token punctuation\">,</span> hello<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>输出如下：</p>\n<pre class=\" language-text\"><code class=\"language-text\">hello times:1\n发生异常，time：16:49:30.224649800\n调用发生异常，开始重试，retryTimes:1\nhello times:2\n发生异常，time：16:49:32.225230800\n调用发生异常，开始重试，retryTimes:2\nhello times:3\n发生异常，time：16:49:34.225968900\n调用发生异常，开始重试，retryTimes:3\nhello times:4\nhello:hello Frank</code></pre>\n<p>这样就相当优雅了，一个注解就能搞定重试，简直不要更棒。</p>\n<p><img src=\"https://i.loli.net/2019/08/11/fOegoZhjwECGbA9.jpg\" alt=\"IStGDBbkyvbhmow.jpg\"></p>\n<h2 id=\"Spring-的重试注解\"><a href=\"#Spring-的重试注解\" class=\"headerlink\" title=\"Spring 的重试注解\"></a>Spring 的重试注解</h2><p>实际上<em>Spring</em>中就有比较完善的重试机制，比上面的切面更加好用，还不需要自己动手重新造轮子。</p>\n<p>那让我们先来看看这个轮子究竟好不好使。</p>\n<p>先引入重试所需的jar包：</p>\n<pre class=\" language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.retry<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-retry<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.aspectj<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>aspectjweaver<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>然后在启动类或者配置类上添加<em>@EnableRetry*注解，接下来在需要重试的方法上添加</em>@Retryable*注解（嗯？好像跟我自定义的注解一样？竟然抄袭我的注解！ [手动滑稽] ） </p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Retryable</span>\n<span class=\"token keyword\">public</span> String <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">long</span> times <span class=\"token operator\">=</span> helloTimes<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello times:{}\"</span><span class=\"token punctuation\">,</span> times<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>times <span class=\"token operator\">%</span> <span class=\"token number\">4</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发生异常，time：{}\"</span><span class=\"token punctuation\">,</span> LocalTime<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HelloRetryException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发生Hello异常\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello \"</span> <span class=\"token operator\">+</span> nameService<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>默认情况下，会重试三次，重试间隔为1秒。当然我们也可以自定义重试次数和间隔。这样就跟我前面实现的功能是一毛一样的了。</p>\n<p>但<em>Spring</em>里的重试机制还支持很多很有用的特性，比如说，可以指定只对特定类型的异常进行重试，这样如果抛出的是其它类型的异常则不会进行重试，就可以对重试进行更细粒度的控制。默认为空，会对所有异常都重试。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Retryable</span><span class=\"token punctuation\">{</span>value <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>HelloRetryException<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">public</span> String <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token number\">2</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>也可以使用<em>include</em>和<em>exclude</em>来指定包含或者排除哪些异常进行重试。</p>\n<p>可以用<em>maxAttemps</em>指定最大重试次数，默认为3次。</p>\n<p>可以用<em>interceptor</em>设置重试拦截器的bean名称。</p>\n<p>可以通过<em>label</em>设置该重试的唯一标志，用于统计输出。</p>\n<p>可以使用<em>exceptionExpression</em>来添加异常表达式，在抛出异常后执行，以判断后续是否进行重试。</p>\n<p>此外，<em>Spring</em>中的重试机制还支持使用<em>backoff</em>来设置重试补偿机制，可以设置重试间隔，并且支持设置重试延迟倍数。</p>\n<p>举个例子：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Retryable</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>HelloRetryException<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> maxAttempts <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n           backoff <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@Backoff</span><span class=\"token punctuation\">(</span>delay <span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> multiplier <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> String <span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>该方法调用将会在抛出<em>HelloRetryException</em>异常后进行重试，最大重试次数为5，第一次重试间隔为1s，之后以2倍大小进行递增，第二次重试间隔为2s，第三次为4s，第四次为8s。</p>\n<p>重试机制还支持使用 <code>@Recover</code> 注解来进行善后工作，当重试达到指定次数之后，将会调用该方法，可以在该方法中进行日志记录等操作。</p>\n<p>这里值得注意的是，想要 <code>@Recover</code> 注解生效的话，需要跟被 <code>@Retryable</code> 标记的方法在同一个类中，且被 <code>@Retryable</code> 标记的方法不能有返回值，否则不会生效。</p>\n<p>并且如果使用了 <code>@Recover</code> 注解的话，重试次数达到最大次数后，如果在 <code>@Recover</code> 标记的方法中无异常抛出，是不会抛出原异常的。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Recover</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">recover</span><span class=\"token punctuation\">(</span>Exception e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"达到最大重试次数\"</span><span class=\"token punctuation\">,</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>除了使用注解外，<code>Spring Retry</code> 也支持直接在调用时使用代码进行重试：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">normalSpringRetry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\" spellcheck=\"true\">// 表示哪些异常需要重试,key表示异常的字节码,value为true表示需要重试</span>\n    Map<span class=\"token operator\">&lt;</span>Class<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Throwable</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> Boolean<span class=\"token operator\">></span> exceptionMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    exceptionMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>HelloRetryException<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 构建重试模板实例</span>\n    RetryTemplate retryTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RetryTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 设置重试回退操作策略，主要设置重试间隔时间</span>\n    FixedBackOffPolicy backOffPolicy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FixedBackOffPolicy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">long</span> fixedPeriodTime <span class=\"token operator\">=</span> 1000L<span class=\"token punctuation\">;</span>\n    backOffPolicy<span class=\"token punctuation\">.</span><span class=\"token function\">setBackOffPeriod</span><span class=\"token punctuation\">(</span>fixedPeriodTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 设置重试策略，主要设置重试次数</span>\n    <span class=\"token keyword\">int</span> maxRetryTimes <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n    SimpleRetryPolicy retryPolicy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleRetryPolicy</span><span class=\"token punctuation\">(</span>maxRetryTimes<span class=\"token punctuation\">,</span> exceptionMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    retryTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setRetryPolicy</span><span class=\"token punctuation\">(</span>retryPolicy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    retryTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setBackOffPolicy</span><span class=\"token punctuation\">(</span>backOffPolicy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    Boolean execute <span class=\"token operator\">=</span> retryTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>\n        <span class=\"token comment\" spellcheck=\"true\">//RetryCallback</span>\n        retryContext <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n            String hello <span class=\"token operator\">=</span> helloService<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"调用的结果:{}\"</span><span class=\"token punctuation\">,</span> hello<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\" spellcheck=\"true\">// RecoverCallBack</span>\n        retryContext <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\" spellcheck=\"true\">//RecoveryCallback</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"已达到最大重试次数\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>此时唯一的好处是可以设置多种重试策略：</p>\n<pre class=\" language-java\"><code class=\"language-java\">NeverRetryPolicy：只允许调用RetryCallback一次，不允许重试\n\nAlwaysRetryPolicy：允许无限重试，直到成功，此方式逻辑不当会导致死循环\n\nSimpleRetryPolicy：固定次数重试策略，默认重试最大次数为<span class=\"token number\">3</span>次，RetryTemplate默认使用的策略\n\nTimeoutRetryPolicy：超时时间重试策略，默认超时时间为<span class=\"token number\">1</span>秒，在指定的超时时间内允许重试\n\nExceptionClassifierRetryPolicy：设置不同异常的重试策略，类似组合重试策略，区别在于这里只区分不同异常的重试\n\nCircuitBreakerRetryPolicy：有熔断功能的重试策略，需设置<span class=\"token number\">3</span>个参数openTimeout、resetTimeout和delegate\n\nCompositeRetryPolicy：组合重试策略，有两种组合方式，乐观组合重试策略是指只要有一个策略允许即可以重试，\n悲观组合重试策略是指只要有一个策略不允许即可以重试，但不管哪种组合方式，组合中的每一个策略都会执行</code></pre>\n<p>可以看出，<code>Spring</code> 中的重试机制还是相当完善的，比上面自己写的 <code>AOP</code> 切面功能更加强大。</p>\n<p>这里还需要再提醒的一点是，由于<code>Spring Retry</code>用到了<code>Aspect</code>增强，所以就会有使用<code>Aspect</code>不可避免的坑——方法内部调用，如果被 <code>@Retryable</code> 注解的方法的调用方和被调用方处于同一个类中，那么重试将会失效。</p>\n<p>但也还是存在一定的不足，<code>Spring</code>的重试机制只支持对异常进行捕获，而无法对返回值进行校验。</p>\n<p><img src=\"https://i.loli.net/2019/08/11/9CuPZHtqMbpLA8a.jpg\" alt=\"dtFxiMbkyvbhlzo.jpg\"></p>\n<h2 id=\"Guava-Retry\"><a href=\"#Guava-Retry\" class=\"headerlink\" title=\"Guava Retry\"></a>Guava Retry</h2><p>最后，再介绍另一个重试利器——<code>Guava Retry</code>。</p>\n<p>相比<code>Spring Retry</code>，<code>Guava Retry</code>具有更强的灵活性，可以根据返回值校验来判断是否需要进行重试。</p>\n<p>先来看一个小栗子：</p>\n<p>先引入jar包：</p>\n<pre class=\" language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.github.rholder<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>guava-retrying<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.0.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>然后用一个小Demo来感受一下：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">guavaRetry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Retryer<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span> retryer <span class=\"token operator\">=</span> RetryerBuilder<span class=\"token punctuation\">.</span>&lt;String<span class=\"token operator\">></span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">retryIfExceptionOfType</span><span class=\"token punctuation\">(</span>HelloRetryException<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">retryIfResult</span><span class=\"token punctuation\">(</span>StringUtils<span class=\"token operator\">:</span><span class=\"token operator\">:</span>isEmpty<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">withWaitStrategy</span><span class=\"token punctuation\">(</span>WaitStrategies<span class=\"token punctuation\">.</span><span class=\"token function\">fixedWait</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> TimeUnit<span class=\"token punctuation\">.</span>SECONDS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">withStopStrategy</span><span class=\"token punctuation\">(</span>StopStrategies<span class=\"token punctuation\">.</span><span class=\"token function\">stopAfterAttempt</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        retryer<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> helloService<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>先创建一个<em>Retryer</em>实例，然后使用这个实例对需要重试的方法进行调用，可以通过很多方法来设置重试机制，比如使用<em>retryIfException</em>来对所有异常进行重试，使用<em>retryIfExceptionOfType</em>方法来设置对指定异常进行重试，使用<em>retryIfResult</em>来对不符合预期的返回结果进行重试，使用<em>retryIfRuntimeException</em>方法来对所有<em>RuntimeException</em>进行重试。</p>\n<p>还有五个以<em>with</em>开头的方法，用来对重试策略/等待策略/阻塞策略/单次任务执行时间限制/自定义监听器进行设置，以实现更加强大的异常处理。</p>\n<p>通过跟 <code>Spring AOP</code> 的结合，可以实现比 <code>Spring Retry</code> 更加强大的重试功能。</p>\n<p>仔细对比之下，<code>Guava Retry</code> 可以提供的特性有：</p>\n<ol>\n<li>可以设置任务单次执行的时间限制，如果超时则抛出异常。</li>\n<li>可以设置重试监听器，用来执行额外的处理工作。</li>\n<li>可以设置任务阻塞策略，即可以设置当前重试完成，下次重试开始前的这段时间做什么事情。</li>\n<li>可以通过停止重试策略和等待策略结合使用来设置更加灵活的策略，比如指数等待时长并最多10次调用，随机等待时长并永不停止等等。</li>\n</ol>\n<p><img src=\"https://i.loli.net/2019/08/11/MFpbWwysvP6Zqo7.jpg\" alt=\"GBvgTpbkyvbhlEB.jpg\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>本文由浅入深的对多种重试的姿势进行了360度无死角教学，从最简单的手动重试，到使用静态代理，再到 <code>JDK动态代理</code> 和 <code>CGLib动态代理</code> ，再到 <code>Spring AOP</code>，都是手工造轮子的过程，最后介绍了两种目前比较好用的轮子，一个是<code>Spring Retry</code>，使用起来简单粗暴，与 <code>Spring</code> 框架天生搭配，一个注解搞定所有事情，另一个便是 <code>Guava Retry</code>，不依赖于 <code>Spring</code> 框架，自成体系，使用起来更加灵活强大。</p>\n<p>个人认为，大部分场景下，<code>Spring Retry</code> 提供的重试机制已经足够强大，如果不需要 <code>Guava Retry</code> 提供的额外灵活性，使用 <code>Spring Retry</code> 就很棒了。当然，具体情况具体分析，但没有必要的情况下，不鼓励重复造轮子，先把别人的轮子研究清楚再想想还用不用自己动手。</p>\n<p>本文到此就告一段落了，又用了一天的时间完成了完成了一篇文章，写作的目的在于总结和分享，我相信最佳实践是可以总结和积累下来的，在大多数场景下都是适用的，这些最佳实践会在逐渐的积累过程中，成为比经验更为重要的东西。因为经验不总结就会忘记，而总结出来的内容却不会被丢失。</p>\n<p>如果对于重试你有更好的想法，欢迎提出交流探讨，也欢迎关注我的公众号进行留言交流。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<p>本文口味：冰镇杨梅           预计阅读：20分钟</p>\n<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>最近公司在搞活动，需要依赖一个第三方接口，测试阶段并没有什么异常状况，但上线后发现依赖的接口有时候会因为内部错误而返回系统异常，虽然概率不大，但总因为这个而报警总是不好的，何况死信队列的消息还需要麻烦运维进行重新投递，所以加上重试机制势在必行。</p>\n<p>重试机制可以保护系统减少因网络波动、依赖服务短暂性不可用带来的影响，让系统能更稳定的运行的一种保护机制。让你原本就稳如狗的系统更是稳上加稳。</p>\n<p><img src=\"https://i.loli.net/2019/08/04/eAUjdRTgskmWF3f.png\" alt=\"1\"></p>\n<p>为了方便说明，先假设我们想要进行重试的方法如下：</p>\n<pre><code class=\"java\">@Slf4j\n@Component\npublic class HelloService {\n\n    private static AtomicLong helloTimes = new AtomicLong();\n\n    public String hello(){\n        long times = helloTimes.incrementAndGet();\n        if (times % 4 != 0){\n            log.warn(&quot;发生异常，time：{}&quot;, LocalTime.now() );\n            throw new HelloRetryException(&quot;发生Hello异常&quot;);\n        }\n        return &quot;hello&quot;;\n    }\n}</code></pre>\n<p>调用处：</p>\n<pre><code class=\"java\">@Slf4j\n@Service\npublic class HelloRetryService implements IHelloService{\n\n    @Autowired\n    private HelloService helloService;\n\n    public String hello(){\n        return helloService.hello();\n    }\n}</code></pre>\n<p>也就是说，这个接口每调4次才会成功一次。</p>\n<h2 id=\"手动重试\"><a href=\"#手动重试\" class=\"headerlink\" title=\"手动重试\"></a>手动重试</h2><p>先来用最简单的方法，直接在调用的时候进重试：</p>\n<pre><code class=\"java\">// 手动重试\npublic String hello(){\n    int maxRetryTimes = 4;\n    String s = &quot;&quot;;\n    for (int retry = 1; retry &lt;= maxRetryTimes; retry++) {\n        try {\n            s = helloService.hello();\n            log.info(&quot;helloService返回:{}&quot;, s);\n            return s;\n        } catch (HelloRetryException e) {\n            log.info(&quot;helloService.hello() 调用失败，准备重试&quot;);\n        }\n    }\n    throw new HelloRetryException(&quot;重试次数耗尽&quot;);\n}</code></pre>\n<p>输出如下：</p>\n<pre><code class=\"shell\">发生异常，time：10:17:21.079413300\nhelloService.hello() 调用失败，准备重试\n发生异常，time：10:17:21.085861800\nhelloService.hello() 调用失败，准备重试\n发生异常，time：10:17:21.085861800\nhelloService.hello() 调用失败，准备重试\nhelloService返回:hello\nservice.helloRetry()：hello</code></pre>\n<p>程序在极短的时间内进行了4次重试，然后成功返回。</p>\n<p>这样虽然看起来可以解决问题，但实践上，由于没有重试间隔，很可能当时依赖的服务尚未从网络异常中恢复过来，所以极有可能接下来的几次调用都是失败的。</p>\n<p>而且，这样需要对代码进行大量的侵入式修改，显然，不优雅。</p>\n<p><img src=\"https://i.loli.net/2019/08/04/ABwDil3xTFaIfyu.png\" alt=\"3.png\"></p>\n<h2 id=\"代理模式\"><a href=\"#代理模式\" class=\"headerlink\" title=\"代理模式\"></a>代理模式</h2><p>上面的处理方式由于需要对业务代码进行大量修改，虽然实现了功能，但是对原有代码的侵入性太强，可维护性差。</p>\n<p>所以需要使用一种更优雅一点的方式，不直接修改业务代码，那要怎么做呢？</p>\n<p>其实很简单，直接在业务代码的外面再包一层就行了，代理模式在这里就有用武之地了。</p>\n<pre><code class=\"java\">@Slf4j\npublic class HelloRetryProxyService implements IHelloService{\n\n    @Autowired\n    private HelloRetryService helloRetryService;\n\n    @Override\n    public String hello() {\n        int maxRetryTimes = 4;\n        String s = &quot;&quot;;\n        for (int retry = 1; retry &lt;= maxRetryTimes; retry++) {\n            try {\n                s = helloRetryService.hello();\n                log.info(&quot;helloRetryService 返回:{}&quot;, s);\n                return s;\n            } catch (HelloRetryException e) {\n                log.info(&quot;helloRetryService.hello() 调用失败，准备重试&quot;);\n            }\n        }\n        throw new HelloRetryException(&quot;重试次数耗尽&quot;);\n    }\n}</code></pre>\n<p>这样，重试逻辑就都由代理类来完成，原业务类的逻辑就不需要修改了，以后想修改重试逻辑也只需要修改这个类就行了，分工明确。比如，现在想要在重试之间加上一个延迟，只需要做一点点修改即可：</p>\n<pre><code class=\"java\">@Override\npublic String hello() {\n    int maxRetryTimes = 4;\n    String s = &quot;&quot;;\n    for (int retry = 1; retry &lt;= maxRetryTimes; retry++) {\n        try {\n            s = helloRetryService.hello();\n            log.info(&quot;helloRetryService 返回:{}&quot;, s);\n            return s;\n        } catch (HelloRetryException e) {\n            log.info(&quot;helloRetryService.hello() 调用失败，准备重试&quot;);\n        }\n        // 延时一秒\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n    throw new HelloRetryException(&quot;重试次数耗尽&quot;);\n}</code></pre>\n<p>代理模式虽然要更加优雅，但是如果依赖的服务很多的时候，要为每个服务都创建一个代理类，显然过于麻烦，而且其实重试的逻辑都大同小异，无非就是重试的次数和延时不一样而已。如果每个类都写这么一长串类似的代码，显然，不优雅！</p>\n<p><img src=\"https://i.loli.net/2019/08/04/z6JxEGdhUK9y1YW.png\" alt=\"4.png\"></p>\n<h2 id=\"JDK动态代理\"><a href=\"#JDK动态代理\" class=\"headerlink\" title=\"JDK动态代理\"></a>JDK动态代理</h2><p>这时候，动态代理就闪亮登场了。只需要写一个代理处理类，就可以开局一条狗，砍到九十九。</p>\n<pre><code class=\"java\">@Slf4j\npublic class RetryInvocationHandler implements InvocationHandler {\n\n    private final Object subject;\n\n    public RetryInvocationHandler(Object subject) {\n        this.subject = subject;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        int times = 0;\n\n        while (times &lt; RetryConstant.MAX_TIMES) {\n            try {\n                return method.invoke(subject, args);\n            } catch (Exception e) {\n                times++;\n                log.info(&quot;times:{},time:{}&quot;, times, LocalTime.now());\n                if (times &gt;= RetryConstant.MAX_TIMES) {\n                    throw new RuntimeException(e);\n                }\n            }\n\n            // 延时一秒\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * 获取动态代理\n     *\n     * @param realSubject 代理对象\n     */\n    public static Object getProxy(Object realSubject) {\n        InvocationHandler handler = new RetryInvocationHandler(realSubject);\n        return Proxy.newProxyInstance(handler.getClass().getClassLoader(),\n                realSubject.getClass().getInterfaces(), handler);\n    }\n\n}</code></pre>\n<p>来一发单元测：</p>\n<pre><code class=\"java\"> @Test\npublic void helloDynamicProxy() {\n    IHelloService realService = new HelloService();\n    IHelloService proxyService = (IHelloService)RetryInvocationHandler.getProxy(realService);\n\n    String hello = proxyService.hello();\n    log.info(&quot;hello:{}&quot;, hello);\n}</code></pre>\n<p>输出如下：</p>\n<pre><code class=\"shell\">hello times:1\n发生异常，time：11:22:20.727586700\ntimes:1,time:11:22:20.728083\nhello times:2\n发生异常，time：11:22:21.728858700\ntimes:2,time:11:22:21.729343700\nhello times:3\n发生异常，time：11:22:22.729706600\ntimes:3,time:11:22:22.729706600\nhello times:4\nhello:hello</code></pre>\n<p>在重试了4次之后输出了<code>Hello</code>，符合预期。</p>\n<p>动态代理可以将重试逻辑都放到一块，显然比直接使用代理类要方便很多，也更加优雅。</p>\n<p>不过不要高兴的太早，这里因为被代理的<em>HelloService</em>是一个简单的类，没有依赖其它类，所以直接创建是没有问题的，但如果被代理的类依赖了其它被<em>Spring</em>容器管理的类，则这种方式会抛出异常，因为没有把被依赖的实例注入到创建的代理实例中。</p>\n<p>这种情况下，就比较复杂了，需要从<em>Spring</em>容器中获取已经装配好的，需要被代理的实例，然后为其创建代理类实例，并交给<em>Spring</em>容器来管理，这样就不用每次都重新创建新的代理类实例了。</p>\n<p>话不多说，撸起袖子就是干。</p>\n<p><img src=\"https://i.loli.net/2019/08/11/w8R6EAGCtkneQhI.jpg\" alt=\"timg.jpg\"></p>\n<p>新建一个工具类，用来获取代理实例：</p>\n<pre><code class=\"java\">@Component\npublic class RetryProxyHandler {\n\n    @Autowired\n    private ConfigurableApplicationContext context;\n\n    public Object getProxy(Class clazz) {\n        // 1. 从Bean中获取对象\n        DefaultListableBeanFactory beanFactory = (DefaultListableBeanFactory)context.getAutowireCapableBeanFactory();\n        Map&lt;String, Object&gt; beans = beanFactory.getBeansOfType(clazz);\n        Set&lt;Map.Entry&lt;String, Object&gt;&gt; entries = beans.entrySet();\n        if (entries.size() &lt;= 0){\n            throw new ProxyBeanNotFoundException();\n        }\n        // 如果有多个候选bean, 判断其中是否有代理bean\n        Object bean = null;\n        if (entries.size() &gt; 1){\n            for (Map.Entry&lt;String, Object&gt; entry : entries) {\n                if (entry.getKey().contains(PROXY_BEAN_SUFFIX)){\n                    bean = entry.getValue();\n                }\n            };\n            if (bean != null){\n                return bean;\n            }\n            throw new ProxyBeanNotSingleException();\n        }\n\n        Object source = beans.entrySet().iterator().next().getValue();\n        Object source = beans.entrySet().iterator().next().getValue();\n\n        // 2. 判断该对象的代理对象是否存在\n        String proxyBeanName = clazz.getSimpleName() + PROXY_BEAN_SUFFIX;\n        Boolean exist = beanFactory.containsBean(proxyBeanName);\n        if (exist) {\n            bean = beanFactory.getBean(proxyBeanName);\n            return bean;\n        }\n\n        // 3. 不存在则生成代理对象\n        bean = RetryInvocationHandler.getProxy(source);\n\n        // 4. 将bean注入spring容器\n        beanFactory.registerSingleton(proxyBeanName, bean);\n        return bean;\n    }\n}</code></pre>\n<p>使用的是<code>JDK动态代理</code>：</p>\n<pre><code class=\"java\">@Slf4j\npublic class RetryInvocationHandler implements InvocationHandler {\n\n    private final Object subject;\n\n    public RetryInvocationHandler(Object subject) {\n        this.subject = subject;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        int times = 0;\n\n        while (times &lt; RetryConstant.MAX_TIMES) {\n            try {\n                return method.invoke(subject, args);\n            } catch (Exception e) {\n                times++;\n                log.info(&quot;retry times:{},time:{}&quot;, times, LocalTime.now());\n                if (times &gt;= RetryConstant.MAX_TIMES) {\n                    throw new RuntimeException(e);\n                }\n            }\n\n            // 延时一秒\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * 获取动态代理\n     *\n     * @param realSubject 代理对象\n     */\n    public static Object getProxy(Object realSubject) {\n        InvocationHandler handler = new RetryInvocationHandler(realSubject);\n        return Proxy.newProxyInstance(handler.getClass().getClassLoader(),\n                realSubject.getClass().getInterfaces(), handler);\n    }\n\n}</code></pre>\n<p>至此，主要代码就完成了，修改一下<em>HelloService</em>类，增加一个依赖：</p>\n<pre><code class=\"java\">@Slf4j\n@Component\npublic class HelloService implements IHelloService{\n\n    private static AtomicLong helloTimes = new AtomicLong();\n\n    @Autowired\n    private NameService nameService;\n\n    public String hello(){\n        long times = helloTimes.incrementAndGet();\n        log.info(&quot;hello times:{}&quot;, times);\n        if (times % 4 != 0){\n            log.warn(&quot;发生异常，time：{}&quot;, LocalTime.now() );\n            throw new HelloRetryException(&quot;发生Hello异常&quot;);\n        }\n        return &quot;hello &quot; + nameService.getName();\n    }\n}</code></pre>\n<p><em>NameService</em>其实很简单，创建的目的仅在于测试依赖注入的<em>Bean</em>能否正常运行。</p>\n<pre><code class=\"java\">@Service\npublic class NameService {\n\n    public String getName(){\n        return &quot;Frank&quot;;\n    }\n}</code></pre>\n<p>来一发测试：</p>\n<pre><code class=\"java\">@Test\npublic void helloJdkProxy() throws InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException {\n    IHelloService proxy = (IHelloService) retryProxyHandler.getProxy(HelloService.class);\n    String hello = proxy.hello();\n    log.info(&quot;hello:{}&quot;, hello);\n}</code></pre>\n<pre><code class=\"text\">hello times:1\n发生异常，time：14:40:27.540672200\nretry times:1,time:14:40:27.541167400\nhello times:2\n发生异常，time：14:40:28.541584600\nretry times:2,time:14:40:28.542033500\nhello times:3\n发生异常，time：14:40:29.542161500\nretry times:3,time:14:40:29.542161500\nhello times:4\nhello:hello Frank</code></pre>\n<p>完美，这样就不用担心依赖注入的问题了，因为从<em>Spring</em>容器中拿到的<em>Bean</em>对象都是已经注入配置好的。当然，这里仅考虑了单例<em>Bean</em>的情况，可以考虑的更加完善一点，判断一下容器中<em>Bean</em>的类型是Singleton还是<em>Prototype</em>，如果是<em>Singleton</em>则像上面这样进行操作，如果是<em>Prototype</em>则每次都新建代理类对象。</p>\n<p>另外，这里使用的是<code>JDK动态代理</code>，因此就存在一个天然的缺陷，如果想要被代理的类，没有实现任何接口，那么就无法为其创建代理对象，这种方式就行不通了。</p>\n<p><img src=\"https://i.loli.net/2019/08/11/GzmFVto59SLMgOl.jpg\" alt=\"EDaBTlbkyvbhmng.jpg\"></p>\n<h2 id=\"CGLib-动态代理\"><a href=\"#CGLib-动态代理\" class=\"headerlink\" title=\"CGLib 动态代理\"></a>CGLib 动态代理</h2><p>既然已经说到了<code>JDK动态代理</code>，那就不得不提<code>CGLib动态代理</code>了。使用<code>JDK动态代理</code>对被代理的类有要求，不是所有的类都能被代理，而<code>CGLib动态代理</code>则刚好解决了这个问题。</p>\n<p>创建一个<code>CGLib动态代理</code>类：</p>\n<pre><code class=\"java\">@Slf4j\npublic class CGLibRetryProxyHandler implements MethodInterceptor {\n    private Object target;//需要代理的目标对象\n\n    //重写拦截方法\n    @Override\n    public Object intercept(Object obj, Method method, Object[] arr, MethodProxy proxy) throws Throwable {\n        int times = 0;\n\n        while (times &lt; RetryConstant.MAX_TIMES) {\n            try {\n                return method.invoke(target, arr);\n            } catch (Exception e) {\n                times++;\n                log.info(&quot;cglib retry :{},time:{}&quot;, times, LocalTime.now());\n                if (times &gt;= RetryConstant.MAX_TIMES) {\n                    throw new RuntimeException(e);\n                }\n            }\n\n            // 延时一秒\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n        return null;\n    }\n    //定义获取代理对象方法\n    public Object getCglibProxy(Object objectTarget){\n        this.target = objectTarget;\n        Enhancer enhancer = new Enhancer();\n        enhancer.setSuperclass(objectTarget.getClass());\n        enhancer.setCallback(this);\n        Object result = enhancer.create();\n        return result;\n    }\n}</code></pre>\n<p>想要换用<code>CGLib动态代理</code>，替换一下这两行代码即可：</p>\n<pre><code class=\"java\">// 3. 不存在则生成代理对象\n//        bean = RetryInvocationHandler.getProxy(source);\nCGLibRetryProxyHandler proxyHandler = new CGLibRetryProxyHandler();\nbean = proxyHandler.getCglibProxy(source);</code></pre>\n<p>开始测试：</p>\n<pre><code class=\"java\">@Test\npublic void helloCGLibProxy() {\n    IHelloService proxy = (IHelloService) retryProxyHandler.getProxy(HelloService.class);\n    String hello = proxy.hello();\n    log.info(&quot;hello:{}&quot;, hello);\n\n    hello = proxy.hello();\n    log.info(&quot;hello:{}&quot;, hello);\n}</code></pre>\n<pre><code class=\"text\">hello times:1\n发生异常，time：15:06:00.799679100\ncglib retry :1,time:15:06:00.800175400\nhello times:2\n发生异常，time：15:06:01.800848600\ncglib retry :2,time:15:06:01.801343100\nhello times:3\n发生异常，time：15:06:02.802180\ncglib retry :3,time:15:06:02.802180\nhello times:4\nhello:hello Frank\nhello times:5\n发生异常，time：15:06:03.803933800\ncglib retry :1,time:15:06:03.803933800\nhello times:6\n发生异常，time：15:06:04.804945400\ncglib retry :2,time:15:06:04.805442\nhello times:7\n发生异常，time：15:06:05.806886500\ncglib retry :3,time:15:06:05.807881300\nhello times:8\nhello:hello Frank</code></pre>\n<p>这样就很棒了，完美的解决了<code>JDK动态代理</code>带来的缺陷。优雅指数上涨了不少。</p>\n<p>但这个方案仍旧存在一个问题，那就是需要对原来的逻辑进行侵入式修改，在每个被代理实例被调用的地方都需要进行调整，这样仍然会对原有代码带来较多修改。</p>\n<p><img src=\"https://i.loli.net/2019/08/11/IczsWOdt4PL6vom.jpg\" alt=\"fuuTyTbkyvbhmsa.jpg\"></p>\n<h2 id=\"Spring-AOP\"><a href=\"#Spring-AOP\" class=\"headerlink\" title=\"Spring AOP\"></a>Spring AOP</h2><p>想要无侵入式的修改原有逻辑？想要一个注解就实现重试？用<code>Spring AOP</code>不就能完美实现吗？使用<code>AOP</code>来为目标调用设置切面，即可在目标方法调用前后添加一些额外的逻辑。</p>\n<p>先创建一个注解：</p>\n<pre><code class=\"java\">@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface Retryable {\n    int retryTimes() default 3;\n    int retryInterval() default 1;\n}</code></pre>\n<p>有两个参数，<em>retryTimes</em> 代表最大重试次数，<em>retryInterval</em>代表重试间隔。</p>\n<p>然后在需要重试的方法上加上注解：</p>\n<pre><code class=\"java\">@Retryable(retryTimes = 4, retryInterval = 2)\npublic String hello(){\n    long times = helloTimes.incrementAndGet();\n    log.info(&quot;hello times:{}&quot;, times);\n    if (times % 4 != 0){\n        log.warn(&quot;发生异常，time：{}&quot;, LocalTime.now() );\n        throw new HelloRetryException(&quot;发生Hello异常&quot;);\n    }\n    return &quot;hello &quot; + nameService.getName();\n}</code></pre>\n<p>接着，进行最后一步，编写<em>AOP</em>切面：</p>\n<pre><code class=\"java\">@Slf4j\n@Aspect\n@Component\npublic class RetryAspect {\n\n    @Pointcut(&quot;@annotation(com.mfrank.springboot.retry.demo.annotation.Retryable)&quot;)\n    private void retryMethodCall(){}\n\n    @Around(&quot;retryMethodCall()&quot;)\n    public Object retry(ProceedingJoinPoint joinPoint) throws InterruptedException {\n        // 获取重试次数和重试间隔\n        Retryable retry = ((MethodSignature)joinPoint.getSignature()).getMethod().getAnnotation(Retryable.class);\n        int maxRetryTimes = retry.retryTimes();\n        int retryInterval = retry.retryInterval();\n\n        Throwable error = new RuntimeException();\n        for (int retryTimes = 1; retryTimes &lt;= maxRetryTimes; retryTimes++){\n            try {\n                Object result = joinPoint.proceed();\n                return result;\n            } catch (Throwable throwable) {\n                error = throwable;\n                log.warn(&quot;调用发生异常，开始重试，retryTimes:{}&quot;, retryTimes);\n            }\n            Thread.sleep(retryInterval * 1000);\n        }\n        throw new RetryExhaustedException(&quot;重试次数耗尽&quot;, error);\n    }\n}</code></pre>\n<p>开始测试：</p>\n<pre><code class=\"java\">@Autowired\nprivate HelloService helloService;\n\n@Test\npublic void helloAOP(){\n    String hello = helloService.hello();\n    log.info(&quot;hello:{}&quot;, hello);\n}</code></pre>\n<p>输出如下：</p>\n<pre><code class=\"text\">hello times:1\n发生异常，time：16:49:30.224649800\n调用发生异常，开始重试，retryTimes:1\nhello times:2\n发生异常，time：16:49:32.225230800\n调用发生异常，开始重试，retryTimes:2\nhello times:3\n发生异常，time：16:49:34.225968900\n调用发生异常，开始重试，retryTimes:3\nhello times:4\nhello:hello Frank</code></pre>\n<p>这样就相当优雅了，一个注解就能搞定重试，简直不要更棒。</p>\n<p><img src=\"https://i.loli.net/2019/08/11/fOegoZhjwECGbA9.jpg\" alt=\"IStGDBbkyvbhmow.jpg\"></p>\n<h2 id=\"Spring-的重试注解\"><a href=\"#Spring-的重试注解\" class=\"headerlink\" title=\"Spring 的重试注解\"></a>Spring 的重试注解</h2><p>实际上<em>Spring</em>中就有比较完善的重试机制，比上面的切面更加好用，还不需要自己动手重新造轮子。</p>\n<p>那让我们先来看看这个轮子究竟好不好使。</p>\n<p>先引入重试所需的jar包：</p>\n<pre><code class=\"xml\">&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.retry&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-retry&lt;/artifactId&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;\n    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;\n&lt;/dependency&gt;</code></pre>\n<p>然后在启动类或者配置类上添加<em>@EnableRetry*注解，接下来在需要重试的方法上添加</em>@Retryable*注解（嗯？好像跟我自定义的注解一样？竟然抄袭我的注解！ [手动滑稽] ） </p>\n<pre><code class=\"java\">@Retryable\npublic String hello(){\n    long times = helloTimes.incrementAndGet();\n    log.info(&quot;hello times:{}&quot;, times);\n    if (times % 4 != 0){\n        log.warn(&quot;发生异常，time：{}&quot;, LocalTime.now() );\n        throw new HelloRetryException(&quot;发生Hello异常&quot;);\n    }\n    return &quot;hello &quot; + nameService.getName();\n}</code></pre>\n<p>默认情况下，会重试三次，重试间隔为1秒。当然我们也可以自定义重试次数和间隔。这样就跟我前面实现的功能是一毛一样的了。</p>\n<p>但<em>Spring</em>里的重试机制还支持很多很有用的特性，比如说，可以指定只对特定类型的异常进行重试，这样如果抛出的是其它类型的异常则不会进行重试，就可以对重试进行更细粒度的控制。默认为空，会对所有异常都重试。</p>\n<pre><code class=\"java\">@Retryable{value = {HelloRetryException.class}}\npublic String hello(){2\n    ...\n}</code></pre>\n<p>也可以使用<em>include</em>和<em>exclude</em>来指定包含或者排除哪些异常进行重试。</p>\n<p>可以用<em>maxAttemps</em>指定最大重试次数，默认为3次。</p>\n<p>可以用<em>interceptor</em>设置重试拦截器的bean名称。</p>\n<p>可以通过<em>label</em>设置该重试的唯一标志，用于统计输出。</p>\n<p>可以使用<em>exceptionExpression</em>来添加异常表达式，在抛出异常后执行，以判断后续是否进行重试。</p>\n<p>此外，<em>Spring</em>中的重试机制还支持使用<em>backoff</em>来设置重试补偿机制，可以设置重试间隔，并且支持设置重试延迟倍数。</p>\n<p>举个例子：</p>\n<pre><code class=\"java\">@Retryable(value = {HelloRetryException.class}, maxAttempts = 5,\n           backoff = @Backoff(delay = 1000, multiplier = 2))\npublic String hello(){\n    ...\n}</code></pre>\n<p>该方法调用将会在抛出<em>HelloRetryException</em>异常后进行重试，最大重试次数为5，第一次重试间隔为1s，之后以2倍大小进行递增，第二次重试间隔为2s，第三次为4s，第四次为8s。</p>\n<p>重试机制还支持使用 <code>@Recover</code> 注解来进行善后工作，当重试达到指定次数之后，将会调用该方法，可以在该方法中进行日志记录等操作。</p>\n<p>这里值得注意的是，想要 <code>@Recover</code> 注解生效的话，需要跟被 <code>@Retryable</code> 标记的方法在同一个类中，且被 <code>@Retryable</code> 标记的方法不能有返回值，否则不会生效。</p>\n<p>并且如果使用了 <code>@Recover</code> 注解的话，重试次数达到最大次数后，如果在 <code>@Recover</code> 标记的方法中无异常抛出，是不会抛出原异常的。</p>\n<pre><code class=\"java\">@Recover\npublic boolean recover(Exception e) {\n    log.error(&quot;达到最大重试次数&quot;,e);\n    return false;\n}</code></pre>\n<p>除了使用注解外，<code>Spring Retry</code> 也支持直接在调用时使用代码进行重试：</p>\n<pre><code class=\"java\">@Test\npublic void normalSpringRetry() {\n    // 表示哪些异常需要重试,key表示异常的字节码,value为true表示需要重试\n    Map&lt;Class&lt;? extends Throwable&gt;, Boolean&gt; exceptionMap = new HashMap&lt;&gt;();\n    exceptionMap.put(HelloRetryException.class, true);\n\n    // 构建重试模板实例\n    RetryTemplate retryTemplate = new RetryTemplate();\n\n    // 设置重试回退操作策略，主要设置重试间隔时间\n    FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();\n    long fixedPeriodTime = 1000L;\n    backOffPolicy.setBackOffPeriod(fixedPeriodTime);\n\n    // 设置重试策略，主要设置重试次数\n    int maxRetryTimes = 3;\n    SimpleRetryPolicy retryPolicy = new SimpleRetryPolicy(maxRetryTimes, exceptionMap);\n\n    retryTemplate.setRetryPolicy(retryPolicy);\n    retryTemplate.setBackOffPolicy(backOffPolicy);\n\n    Boolean execute = retryTemplate.execute(\n        //RetryCallback\n        retryContext -&gt; {\n            String hello = helloService.hello();\n            log.info(&quot;调用的结果:{}&quot;, hello);\n            return true;\n        },\n        // RecoverCallBack\n        retryContext -&gt; {\n            //RecoveryCallback\n            log.info(&quot;已达到最大重试次数&quot;);\n            return false;\n        }\n    );\n}</code></pre>\n<p>此时唯一的好处是可以设置多种重试策略：</p>\n<pre><code class=\"java\">NeverRetryPolicy：只允许调用RetryCallback一次，不允许重试\n\nAlwaysRetryPolicy：允许无限重试，直到成功，此方式逻辑不当会导致死循环\n\nSimpleRetryPolicy：固定次数重试策略，默认重试最大次数为3次，RetryTemplate默认使用的策略\n\nTimeoutRetryPolicy：超时时间重试策略，默认超时时间为1秒，在指定的超时时间内允许重试\n\nExceptionClassifierRetryPolicy：设置不同异常的重试策略，类似组合重试策略，区别在于这里只区分不同异常的重试\n\nCircuitBreakerRetryPolicy：有熔断功能的重试策略，需设置3个参数openTimeout、resetTimeout和delegate\n\nCompositeRetryPolicy：组合重试策略，有两种组合方式，乐观组合重试策略是指只要有一个策略允许即可以重试，\n悲观组合重试策略是指只要有一个策略不允许即可以重试，但不管哪种组合方式，组合中的每一个策略都会执行</code></pre>\n<p>可以看出，<code>Spring</code> 中的重试机制还是相当完善的，比上面自己写的 <code>AOP</code> 切面功能更加强大。</p>\n<p>这里还需要再提醒的一点是，由于<code>Spring Retry</code>用到了<code>Aspect</code>增强，所以就会有使用<code>Aspect</code>不可避免的坑——方法内部调用，如果被 <code>@Retryable</code> 注解的方法的调用方和被调用方处于同一个类中，那么重试将会失效。</p>\n<p>但也还是存在一定的不足，<code>Spring</code>的重试机制只支持对异常进行捕获，而无法对返回值进行校验。</p>\n<p><img src=\"https://i.loli.net/2019/08/11/9CuPZHtqMbpLA8a.jpg\" alt=\"dtFxiMbkyvbhlzo.jpg\"></p>\n<h2 id=\"Guava-Retry\"><a href=\"#Guava-Retry\" class=\"headerlink\" title=\"Guava Retry\"></a>Guava Retry</h2><p>最后，再介绍另一个重试利器——<code>Guava Retry</code>。</p>\n<p>相比<code>Spring Retry</code>，<code>Guava Retry</code>具有更强的灵活性，可以根据返回值校验来判断是否需要进行重试。</p>\n<p>先来看一个小栗子：</p>\n<p>先引入jar包：</p>\n<pre><code class=\"xml\">&lt;dependency&gt;\n    &lt;groupId&gt;com.github.rholder&lt;/groupId&gt;\n    &lt;artifactId&gt;guava-retrying&lt;/artifactId&gt;\n    &lt;version&gt;2.0.0&lt;/version&gt;\n&lt;/dependency&gt;</code></pre>\n<p>然后用一个小Demo来感受一下：</p>\n<pre><code class=\"java\">@Test\npublic void guavaRetry() {\n    Retryer&lt;String&gt; retryer = RetryerBuilder.&lt;String&gt;newBuilder()\n        .retryIfExceptionOfType(HelloRetryException.class)\n        .retryIfResult(StringUtils::isEmpty)\n        .withWaitStrategy(WaitStrategies.fixedWait(3, TimeUnit.SECONDS))\n        .withStopStrategy(StopStrategies.stopAfterAttempt(3))\n        .build();\n\n    try {\n        retryer.call(() -&gt; helloService.hello());\n    } catch (Exception e){\n        e.printStackTrace();\n    }\n}</code></pre>\n<p>先创建一个<em>Retryer</em>实例，然后使用这个实例对需要重试的方法进行调用，可以通过很多方法来设置重试机制，比如使用<em>retryIfException</em>来对所有异常进行重试，使用<em>retryIfExceptionOfType</em>方法来设置对指定异常进行重试，使用<em>retryIfResult</em>来对不符合预期的返回结果进行重试，使用<em>retryIfRuntimeException</em>方法来对所有<em>RuntimeException</em>进行重试。</p>\n<p>还有五个以<em>with</em>开头的方法，用来对重试策略/等待策略/阻塞策略/单次任务执行时间限制/自定义监听器进行设置，以实现更加强大的异常处理。</p>\n<p>通过跟 <code>Spring AOP</code> 的结合，可以实现比 <code>Spring Retry</code> 更加强大的重试功能。</p>\n<p>仔细对比之下，<code>Guava Retry</code> 可以提供的特性有：</p>\n<ol>\n<li>可以设置任务单次执行的时间限制，如果超时则抛出异常。</li>\n<li>可以设置重试监听器，用来执行额外的处理工作。</li>\n<li>可以设置任务阻塞策略，即可以设置当前重试完成，下次重试开始前的这段时间做什么事情。</li>\n<li>可以通过停止重试策略和等待策略结合使用来设置更加灵活的策略，比如指数等待时长并最多10次调用，随机等待时长并永不停止等等。</li>\n</ol>\n<p><img src=\"https://i.loli.net/2019/08/11/MFpbWwysvP6Zqo7.jpg\" alt=\"GBvgTpbkyvbhlEB.jpg\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>本文由浅入深的对多种重试的姿势进行了360度无死角教学，从最简单的手动重试，到使用静态代理，再到 <code>JDK动态代理</code> 和 <code>CGLib动态代理</code> ，再到 <code>Spring AOP</code>，都是手工造轮子的过程，最后介绍了两种目前比较好用的轮子，一个是<code>Spring Retry</code>，使用起来简单粗暴，与 <code>Spring</code> 框架天生搭配，一个注解搞定所有事情，另一个便是 <code>Guava Retry</code>，不依赖于 <code>Spring</code> 框架，自成体系，使用起来更加灵活强大。</p>\n<p>个人认为，大部分场景下，<code>Spring Retry</code> 提供的重试机制已经足够强大，如果不需要 <code>Guava Retry</code> 提供的额外灵活性，使用 <code>Spring Retry</code> 就很棒了。当然，具体情况具体分析，但没有必要的情况下，不鼓励重复造轮子，先把别人的轮子研究清楚再想想还用不用自己动手。</p>\n<p>本文到此就告一段落了，又用了一天的时间完成了完成了一篇文章，写作的目的在于总结和分享，我相信最佳实践是可以总结和积累下来的，在大多数场景下都是适用的，这些最佳实践会在逐渐的积累过程中，成为比经验更为重要的东西。因为经验不总结就会忘记，而总结出来的内容却不会被丢失。</p>\n<p>如果对于重试你有更好的想法，欢迎提出交流探讨，也欢迎关注我的公众号进行留言交流。</p>\n"},{"title":"我的2020【健身篇】","toc":true,"date":"2021-02-17T14:54:35.000Z","_content":"\n## 难忘的一年\n\n从几年前到上海工作不久，我便开始了我的健身之旅。一开始的目的其实很简单，只是想要增强一下体能，增加一些肌肉。几年下来，在健身的路上走走停停，肌肉块头确实有所增大，但身材却一言难尽，体重也随着生活的烦恼与日俱增。\n\n2020年换了工作后，更是开始放飞自我。巅峰时期我的体重一度接近180斤，让我承受着这个年纪不该承受的负担。在此期间，身边的朋友开始时不时拿我的体重开玩笑，我的某位同事也一直拿我工牌上的照片来嘲讽我，而我却总是置若罔闻，并没有太放在心上。\n\n到了年中的时候，突然变得有些彷徨和犹豫，想做的事情太多，一时间不知该如何入手。转念一想，要不先减减肥吧，毕竟身体是革命的本钱，身体变强了，做事效率应该也能有所提升。而且身体健康是一直以来都是我比较重视的一方面，也符合“坚持长期主义”的革命纲领。\n\n于是说干就干，撸起袖子，开始了为期两个月的魔鬼训练。说是魔鬼训练，那可能还是有点夸张，但强度确实挺大，每天累的跟狗一样，严格控制饮食，每天只吃健身餐、牛奶、麦片、水果。一顿操作猛如虎，幸好结果也还差强人意。我的体重从接近180斤降到了140左右，肚子上的赘肉明显少了很多，脸也瘦了一圈，同事都说我简直像是变了一个人。听着同事们的夸赞，我表面上波澜不惊，其实心里乐开了花。\n\n经过半年的努力，我发现自己的身材也变得更好了，肌肉开始有了线条，脸上也开始有了棱角，每次洗完澡，都忍不住在镜子面前多看几眼。\n\n回顾过去的半年，在健身减肥方面感慨良多，我想也是时候好好总结反思一下了。\n\n## 放飞自我的半年\n\n2020年初，我换了一份工作。刚进入新公司的我，对一切都充满着新鲜感。食堂新鲜的饭菜略合我胃口，加上不断供的零食诱惑以及每天贴心的下午茶，让我的嘴处于长期劳作状态，鲜有罢工之时。与此同时，由于接触了新的工作内容，编程语言也从Java转入了Go，工作上压力也增加不少。\n\n于是在各类因素的加持下，我的体重便有些不受约束了。去年的时候体重还被我压制在170以下，进新公司之后，体重实现了快速增长，瞬间突破170，以迅雷不及掩耳盗铃之势直奔180而去。\n\n当时的我，还身在胖中不知胖，总安慰自己，这不是胖，是壮，只要身体健康就好。但身边总是会有人有意无意的提到这一点，让我开始明白，我是真的变胖了，还不少。\n\n七月底的时候，我在朋友圈发了一张照片，本是想自嘲一下，没想到引来了无数朋友的调侃。\n\n![1.jpg](1.jpg)\n\n![2.jpg](2.jpg)\n\n绝大多数的评论都是惊叹于我怎么变得这么胖了。虽然嘴上开着玩笑，但说实话还是有一点点受伤。这让我开始正视自己的体重问题了。\n\n## 八月相约减肥\n\n于是，痛定思痛，我开始下定决心减肥。八月份便正式开始踏上减肥之旅。\n\n![3.jpeg](3.jpeg)\n\n一个人减肥总是难以坚持，我深知这一点，所以怂恿了我的 mentor 和我一起减肥。身宽体胖的他刚好也有这样的想法，于是一拍即合，我们约下战书，看一个月后，谁能减掉更多的体重。\n\n公司附近就有一个游泳馆，我们每天中午都会去游泳半小时左右，游完泳后相互对比体重，看自己的体重又下降了多少。他比较喜欢开玩笑，也经常调侃我的体重，这让我更加充满动力，心想着这个月一定要比过他。\n\n![4.png](4.png)\n\n在前半个月里，我们的减肥效果都还不错。在饮食上也有所控制，很少吃零食，中午改成了健身餐，晚饭改成了牛奶麦片，但周末还是没能忍住，放开肚子吃过两次，导致体重迅速反弹。到月底的时候，他以两斤的优势略胜我一筹。\n\n![5.png](5.png)\n\n![7.jpeg](7.jpeg)\n\n![8.jpeg](8.jpeg)\n\n![6.png](6.png)\n\n![9.jpeg](9.jpeg)\n\n八月份减肥小有所成，虽然体重减少的不算太多，但能一天天的看到自己的进步，还是挺高兴的。在这个月的减肥过程中，也顺便学会了游泳这项新技能，这一点倒是挺不错的。\n\n## 九月加速减肥\n\n在八月的减肥比试中落败，心有不甘，于是从九月份开始加大训练量，增加训练的强度，并更严格的控制饮食。结果发现效果显著，只用了半个月时间，就成功的减掉了10斤。在健身房完成了第一百次打卡，体重也从163.9降到了153.7。\n\n![10.png](10.png)\n\n![12.jpeg](12.jpeg)\n\n![11.jpeg](11.jpeg)\n\n![13.jpeg](13.jpeg)\n\n![14.jpeg](14.jpeg)\n\n随后的一段时间，又吃了两顿没控制住，体重应声反弹，但随即被控制住了。到了九月底，目标也顺利完成了。\n\n到了九月底，体重来到150以下了，体脂率也下降到了23%。而且，减肥后脸也瘦了不少，精神面貌确实要好了很多。\n\n![15.png](15.png)\n\n![16.jpeg](16.jpeg)\n\n![18.jpeg](18.jpeg)\n\n![2.jpg](2.jpg)\n\n![17.jpeg](17.jpeg)\n\n![19.jpeg](19.jpeg)\n\n九月份的训练说是魔鬼训练一点也不过分，不仅严格控制饮食，而且有大量的无氧和有氧运动，每次练完都累到怀疑人生，回到家总是腰酸背痛，好几次在半夜里腿抽筋痛醒了过来。\n\n我知道这样的运动确实有些过量了，但还在身体可以接受的范围之内，只要注意不做太大重量拉伤肌肉，尚在可控范围之内。\n\n在慢慢养成习惯之后，每天不出一身汗反而会觉得不自在。健身成了我生活中不可或缺的一部分。\n\n## 十月小幅反弹\n\n经过十一长假的放纵，体重也成功起飞，虽然在假期之后的调整中得到了一些控制，但在饮食控制上有所松懈，所以体重一直有所反复，到月底的时候，体重反弹了1.5斤。\n\n那时候无意中在知乎上看到一款叫红魔的产品，说是可以提升运动效果，增加运动消耗，于是买了两瓶试了试。第一次使用的那天，早上有一段时间手一直在不由自主的发抖，精神有些异常亢奋，锻炼的时候确实感觉更有力量，但可能大部分是咖啡因的效果。\n\n![20.png](20.png)\n\n![23.jpeg](23.jpeg)\n\n![21.jpeg](21.jpeg)\n\n![22.jpeg](22.jpeg)\n\n现在两瓶已经吃完了，刚吃完那几天会有明显的精神萎靡不振的感觉，好在现在已经基本调整过来了。记得有一次吃错了药，在晚上的时候吃了两颗红魔，效果是真的好，不管怎样都睡不着，直到五点多才实在困得不行睡了一会。\n\n现在想想确实有些乱来了，以后不会再乱吃这些东西了。\n\n## 十一月疯狂跑步\n\n经历了一个萎靡不振的十月，自我反思之后，决定尝试一下跑步减肥，之前只是在健身完成之后跑跑步放松一下，没有做太多的跑步运动。\n\n在11月份里，我每天平均跑步5公里，一路坚持下来，效果确实也还可以。\n\n![28.jpeg](28.jpeg)\n\n虽然体重也多次反弹，但目标还是完成了。体重也成功从153降到了141。同时，脸上也不再是一团浆糊，逐渐开始有了棱角。同事都说我简直像是换了一张脸。\n\n![31.png](31.png)\n\n![26.jpeg](26.jpeg)\n\n![24.jpeg](24.jpeg)\n\n![29.jpeg](29.jpeg)\n\n![25.jpeg](25.jpeg)\n\n![30.jpeg](30.jpeg)\n\n![27.jpeg](27.jpeg)\n\n## 十二月后休养生息\n\n十一月跑步有些过头了，膝盖有些受不了了，所以十二月调整了策略，基本没有跑步，运动量也减半了。\n\n因为体重逐渐接近目标，我知道短期快速的减肥很容易反弹，所以希望让体重在没那么大的运动量下，在一个范围内保持稳定。\n\n经过十二月和一月两个月的摸索，体重也成功的维持在145上下，虽然波动也还是不小，不过一两顿的增肥不会再造成太大的困扰，短期体重的骤增也能在随后两天运动下降下来，生活也开始走向常态化。\n\n一月份开始使用keep来锻炼，主要做减脂运动和腹肌训练，目标是把体脂率减下来，并且让腹肌线条更加明显。\n\n![32.png](32.png)\n\n但腹肌训练远比我想象的要难，虽然每次都竭尽全力，但一个月下来，腹肌并没有明显的改善。。。\n\n## 重新起航\n\n一转眼，新年增肥期就已经过去了，不出意外，应该胖了五斤以上。所以准备回上海后重新启动减脂增肌计划。本来计划用一年时间练出六块腹肌，但后来看了一些文章，发现如果训练得当，三个月就够了。再加上自己腹肌力量已经有一定的基础了，三个月时间应该还算充裕，也就是五月结束之前练出六块腹肌。\n\n为此，我需要将体脂率控制在14%左右，相应的体重应该要在125左右。因此我还需要减掉20斤，三个月减20斤，确实不容易，但也不算太难，毕竟之前的减肥经历已经磨练过一次了，所以我还是充满信心。\n\n至于为什么对腹肌有如此的执念，是因为减肥之后发现自己的身材得到了很大的改善，肌肉开始有线条了，胸肌明显增大，肱二头肌和肱三头肌也有明显变化，但腹部堆积的脂肪还是有点多，所以想继续练练，让身形更好看一点。\n\n当然，六块腹肌只是一个中间目标，其背后代表的健康生活方式才是我所追求的，所以也不能舍本逐末，为了锻炼腹肌反而损害了自己的健康。\n\n等完成了六块腹肌之后，需要的便是增加对敏捷、爆发、重量和耐力的综合训练来维持一个健康的身材，等时机成熟再进军八块腹肌。\n\n## 总结\n\n2020年的减脂和增肌效果显著，让我成功的甩掉了胖子的标签，也让我的肌肉力量得到很大的增强。每月一个flag的方式，让我在减肥的路上不再对遥远的目标感到遥遥无期，而是自信面对每天的挑战。把一个大目标拆解成一个个小目标，然后各个击破，并根据实际情况灵活调整，让看似难以实现的目标也能得以完成。\n\n实现目标有很多种方法论，但找到最适合自己的方法论才能更好的完成目标。一路走来，也逐渐发现，制定计划和目标并不难，方法论也只能提供达成目标的工具，对实现目标的那份激情和执着才是源源不断的动力源泉。\n\n当发现生活被迷雾缠绕，无法看清方向时，逃避现实或者自甘堕落都无济于事，雪球最终只会越滚越大。与其等到雪球大到无力解决时被砸得遍体鳞伤，不如提早把问题解决掉。在看似繁杂的问题中，其实只有少数几个关键的问题，只要解决了这几个关键问题，其它问题都会迎刃而解。\n\n每个人的行为方式都是基于自己对生活和人生的理解，都是对自己人生观和价值观的一种践行。每个人经历的生活不一样，所以对人生的理解也会不一样。很多人的行为方式看似很难理解，但在他们的视角里，一切都能自圆其说。事实无对错，但观点分高下。善弈者通盘无妙手，我所追寻的，是深思熟虑之后的步步为营，而不是剑走偏锋式的出奇制胜。\n\n我想这一年收获的不仅仅是健身留下的好身材，更多的是关于健身知识的积累和健身习惯的形成。随着健身习惯的养成，健身早已成为日常生活中不可缺少的一部分，我想不仅要活到老学到老，也要练到老，让强健的身体成为生活和事业的发动机，提供源源不断的精力支持。\n\n2021的序幕已经拉开，如果说，站在2021的尾巴上回顾这一整年，完成哪些事会让我觉得这一年没有虚度，那么六块腹肌和保持较低的体脂率一定位列其中。\n\n路漫漫其修远兮，吾将上下而求索。2021，再接再厉！","source":"_posts/conclusion/2020-conclusion-slim.md","raw":"---\ntitle: 我的2020【健身篇】\ntags:\n  - 年终总结\ncategories:\n  - life\ntoc: true\ndate: 2021-02-17 22:54:35\n---\n\n## 难忘的一年\n\n从几年前到上海工作不久，我便开始了我的健身之旅。一开始的目的其实很简单，只是想要增强一下体能，增加一些肌肉。几年下来，在健身的路上走走停停，肌肉块头确实有所增大，但身材却一言难尽，体重也随着生活的烦恼与日俱增。\n\n2020年换了工作后，更是开始放飞自我。巅峰时期我的体重一度接近180斤，让我承受着这个年纪不该承受的负担。在此期间，身边的朋友开始时不时拿我的体重开玩笑，我的某位同事也一直拿我工牌上的照片来嘲讽我，而我却总是置若罔闻，并没有太放在心上。\n\n到了年中的时候，突然变得有些彷徨和犹豫，想做的事情太多，一时间不知该如何入手。转念一想，要不先减减肥吧，毕竟身体是革命的本钱，身体变强了，做事效率应该也能有所提升。而且身体健康是一直以来都是我比较重视的一方面，也符合“坚持长期主义”的革命纲领。\n\n于是说干就干，撸起袖子，开始了为期两个月的魔鬼训练。说是魔鬼训练，那可能还是有点夸张，但强度确实挺大，每天累的跟狗一样，严格控制饮食，每天只吃健身餐、牛奶、麦片、水果。一顿操作猛如虎，幸好结果也还差强人意。我的体重从接近180斤降到了140左右，肚子上的赘肉明显少了很多，脸也瘦了一圈，同事都说我简直像是变了一个人。听着同事们的夸赞，我表面上波澜不惊，其实心里乐开了花。\n\n经过半年的努力，我发现自己的身材也变得更好了，肌肉开始有了线条，脸上也开始有了棱角，每次洗完澡，都忍不住在镜子面前多看几眼。\n\n回顾过去的半年，在健身减肥方面感慨良多，我想也是时候好好总结反思一下了。\n\n## 放飞自我的半年\n\n2020年初，我换了一份工作。刚进入新公司的我，对一切都充满着新鲜感。食堂新鲜的饭菜略合我胃口，加上不断供的零食诱惑以及每天贴心的下午茶，让我的嘴处于长期劳作状态，鲜有罢工之时。与此同时，由于接触了新的工作内容，编程语言也从Java转入了Go，工作上压力也增加不少。\n\n于是在各类因素的加持下，我的体重便有些不受约束了。去年的时候体重还被我压制在170以下，进新公司之后，体重实现了快速增长，瞬间突破170，以迅雷不及掩耳盗铃之势直奔180而去。\n\n当时的我，还身在胖中不知胖，总安慰自己，这不是胖，是壮，只要身体健康就好。但身边总是会有人有意无意的提到这一点，让我开始明白，我是真的变胖了，还不少。\n\n七月底的时候，我在朋友圈发了一张照片，本是想自嘲一下，没想到引来了无数朋友的调侃。\n\n![1.jpg](1.jpg)\n\n![2.jpg](2.jpg)\n\n绝大多数的评论都是惊叹于我怎么变得这么胖了。虽然嘴上开着玩笑，但说实话还是有一点点受伤。这让我开始正视自己的体重问题了。\n\n## 八月相约减肥\n\n于是，痛定思痛，我开始下定决心减肥。八月份便正式开始踏上减肥之旅。\n\n![3.jpeg](3.jpeg)\n\n一个人减肥总是难以坚持，我深知这一点，所以怂恿了我的 mentor 和我一起减肥。身宽体胖的他刚好也有这样的想法，于是一拍即合，我们约下战书，看一个月后，谁能减掉更多的体重。\n\n公司附近就有一个游泳馆，我们每天中午都会去游泳半小时左右，游完泳后相互对比体重，看自己的体重又下降了多少。他比较喜欢开玩笑，也经常调侃我的体重，这让我更加充满动力，心想着这个月一定要比过他。\n\n![4.png](4.png)\n\n在前半个月里，我们的减肥效果都还不错。在饮食上也有所控制，很少吃零食，中午改成了健身餐，晚饭改成了牛奶麦片，但周末还是没能忍住，放开肚子吃过两次，导致体重迅速反弹。到月底的时候，他以两斤的优势略胜我一筹。\n\n![5.png](5.png)\n\n![7.jpeg](7.jpeg)\n\n![8.jpeg](8.jpeg)\n\n![6.png](6.png)\n\n![9.jpeg](9.jpeg)\n\n八月份减肥小有所成，虽然体重减少的不算太多，但能一天天的看到自己的进步，还是挺高兴的。在这个月的减肥过程中，也顺便学会了游泳这项新技能，这一点倒是挺不错的。\n\n## 九月加速减肥\n\n在八月的减肥比试中落败，心有不甘，于是从九月份开始加大训练量，增加训练的强度，并更严格的控制饮食。结果发现效果显著，只用了半个月时间，就成功的减掉了10斤。在健身房完成了第一百次打卡，体重也从163.9降到了153.7。\n\n![10.png](10.png)\n\n![12.jpeg](12.jpeg)\n\n![11.jpeg](11.jpeg)\n\n![13.jpeg](13.jpeg)\n\n![14.jpeg](14.jpeg)\n\n随后的一段时间，又吃了两顿没控制住，体重应声反弹，但随即被控制住了。到了九月底，目标也顺利完成了。\n\n到了九月底，体重来到150以下了，体脂率也下降到了23%。而且，减肥后脸也瘦了不少，精神面貌确实要好了很多。\n\n![15.png](15.png)\n\n![16.jpeg](16.jpeg)\n\n![18.jpeg](18.jpeg)\n\n![2.jpg](2.jpg)\n\n![17.jpeg](17.jpeg)\n\n![19.jpeg](19.jpeg)\n\n九月份的训练说是魔鬼训练一点也不过分，不仅严格控制饮食，而且有大量的无氧和有氧运动，每次练完都累到怀疑人生，回到家总是腰酸背痛，好几次在半夜里腿抽筋痛醒了过来。\n\n我知道这样的运动确实有些过量了，但还在身体可以接受的范围之内，只要注意不做太大重量拉伤肌肉，尚在可控范围之内。\n\n在慢慢养成习惯之后，每天不出一身汗反而会觉得不自在。健身成了我生活中不可或缺的一部分。\n\n## 十月小幅反弹\n\n经过十一长假的放纵，体重也成功起飞，虽然在假期之后的调整中得到了一些控制，但在饮食控制上有所松懈，所以体重一直有所反复，到月底的时候，体重反弹了1.5斤。\n\n那时候无意中在知乎上看到一款叫红魔的产品，说是可以提升运动效果，增加运动消耗，于是买了两瓶试了试。第一次使用的那天，早上有一段时间手一直在不由自主的发抖，精神有些异常亢奋，锻炼的时候确实感觉更有力量，但可能大部分是咖啡因的效果。\n\n![20.png](20.png)\n\n![23.jpeg](23.jpeg)\n\n![21.jpeg](21.jpeg)\n\n![22.jpeg](22.jpeg)\n\n现在两瓶已经吃完了，刚吃完那几天会有明显的精神萎靡不振的感觉，好在现在已经基本调整过来了。记得有一次吃错了药，在晚上的时候吃了两颗红魔，效果是真的好，不管怎样都睡不着，直到五点多才实在困得不行睡了一会。\n\n现在想想确实有些乱来了，以后不会再乱吃这些东西了。\n\n## 十一月疯狂跑步\n\n经历了一个萎靡不振的十月，自我反思之后，决定尝试一下跑步减肥，之前只是在健身完成之后跑跑步放松一下，没有做太多的跑步运动。\n\n在11月份里，我每天平均跑步5公里，一路坚持下来，效果确实也还可以。\n\n![28.jpeg](28.jpeg)\n\n虽然体重也多次反弹，但目标还是完成了。体重也成功从153降到了141。同时，脸上也不再是一团浆糊，逐渐开始有了棱角。同事都说我简直像是换了一张脸。\n\n![31.png](31.png)\n\n![26.jpeg](26.jpeg)\n\n![24.jpeg](24.jpeg)\n\n![29.jpeg](29.jpeg)\n\n![25.jpeg](25.jpeg)\n\n![30.jpeg](30.jpeg)\n\n![27.jpeg](27.jpeg)\n\n## 十二月后休养生息\n\n十一月跑步有些过头了，膝盖有些受不了了，所以十二月调整了策略，基本没有跑步，运动量也减半了。\n\n因为体重逐渐接近目标，我知道短期快速的减肥很容易反弹，所以希望让体重在没那么大的运动量下，在一个范围内保持稳定。\n\n经过十二月和一月两个月的摸索，体重也成功的维持在145上下，虽然波动也还是不小，不过一两顿的增肥不会再造成太大的困扰，短期体重的骤增也能在随后两天运动下降下来，生活也开始走向常态化。\n\n一月份开始使用keep来锻炼，主要做减脂运动和腹肌训练，目标是把体脂率减下来，并且让腹肌线条更加明显。\n\n![32.png](32.png)\n\n但腹肌训练远比我想象的要难，虽然每次都竭尽全力，但一个月下来，腹肌并没有明显的改善。。。\n\n## 重新起航\n\n一转眼，新年增肥期就已经过去了，不出意外，应该胖了五斤以上。所以准备回上海后重新启动减脂增肌计划。本来计划用一年时间练出六块腹肌，但后来看了一些文章，发现如果训练得当，三个月就够了。再加上自己腹肌力量已经有一定的基础了，三个月时间应该还算充裕，也就是五月结束之前练出六块腹肌。\n\n为此，我需要将体脂率控制在14%左右，相应的体重应该要在125左右。因此我还需要减掉20斤，三个月减20斤，确实不容易，但也不算太难，毕竟之前的减肥经历已经磨练过一次了，所以我还是充满信心。\n\n至于为什么对腹肌有如此的执念，是因为减肥之后发现自己的身材得到了很大的改善，肌肉开始有线条了，胸肌明显增大，肱二头肌和肱三头肌也有明显变化，但腹部堆积的脂肪还是有点多，所以想继续练练，让身形更好看一点。\n\n当然，六块腹肌只是一个中间目标，其背后代表的健康生活方式才是我所追求的，所以也不能舍本逐末，为了锻炼腹肌反而损害了自己的健康。\n\n等完成了六块腹肌之后，需要的便是增加对敏捷、爆发、重量和耐力的综合训练来维持一个健康的身材，等时机成熟再进军八块腹肌。\n\n## 总结\n\n2020年的减脂和增肌效果显著，让我成功的甩掉了胖子的标签，也让我的肌肉力量得到很大的增强。每月一个flag的方式，让我在减肥的路上不再对遥远的目标感到遥遥无期，而是自信面对每天的挑战。把一个大目标拆解成一个个小目标，然后各个击破，并根据实际情况灵活调整，让看似难以实现的目标也能得以完成。\n\n实现目标有很多种方法论，但找到最适合自己的方法论才能更好的完成目标。一路走来，也逐渐发现，制定计划和目标并不难，方法论也只能提供达成目标的工具，对实现目标的那份激情和执着才是源源不断的动力源泉。\n\n当发现生活被迷雾缠绕，无法看清方向时，逃避现实或者自甘堕落都无济于事，雪球最终只会越滚越大。与其等到雪球大到无力解决时被砸得遍体鳞伤，不如提早把问题解决掉。在看似繁杂的问题中，其实只有少数几个关键的问题，只要解决了这几个关键问题，其它问题都会迎刃而解。\n\n每个人的行为方式都是基于自己对生活和人生的理解，都是对自己人生观和价值观的一种践行。每个人经历的生活不一样，所以对人生的理解也会不一样。很多人的行为方式看似很难理解，但在他们的视角里，一切都能自圆其说。事实无对错，但观点分高下。善弈者通盘无妙手，我所追寻的，是深思熟虑之后的步步为营，而不是剑走偏锋式的出奇制胜。\n\n我想这一年收获的不仅仅是健身留下的好身材，更多的是关于健身知识的积累和健身习惯的形成。随着健身习惯的养成，健身早已成为日常生活中不可缺少的一部分，我想不仅要活到老学到老，也要练到老，让强健的身体成为生活和事业的发动机，提供源源不断的精力支持。\n\n2021的序幕已经拉开，如果说，站在2021的尾巴上回顾这一整年，完成哪些事会让我觉得这一年没有虚度，那么六块腹肌和保持较低的体脂率一定位列其中。\n\n路漫漫其修远兮，吾将上下而求索。2021，再接再厉！","slug":"conclusion/2020-conclusion-slim","published":1,"updated":"2021-02-17T14:54:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfb400075ohu812jdjxs","content":"<h2 id=\"难忘的一年\"><a href=\"#难忘的一年\" class=\"headerlink\" title=\"难忘的一年\"></a>难忘的一年</h2><p>从几年前到上海工作不久，我便开始了我的健身之旅。一开始的目的其实很简单，只是想要增强一下体能，增加一些肌肉。几年下来，在健身的路上走走停停，肌肉块头确实有所增大，但身材却一言难尽，体重也随着生活的烦恼与日俱增。</p>\n<p>2020年换了工作后，更是开始放飞自我。巅峰时期我的体重一度接近180斤，让我承受着这个年纪不该承受的负担。在此期间，身边的朋友开始时不时拿我的体重开玩笑，我的某位同事也一直拿我工牌上的照片来嘲讽我，而我却总是置若罔闻，并没有太放在心上。</p>\n<p>到了年中的时候，突然变得有些彷徨和犹豫，想做的事情太多，一时间不知该如何入手。转念一想，要不先减减肥吧，毕竟身体是革命的本钱，身体变强了，做事效率应该也能有所提升。而且身体健康是一直以来都是我比较重视的一方面，也符合“坚持长期主义”的革命纲领。</p>\n<p>于是说干就干，撸起袖子，开始了为期两个月的魔鬼训练。说是魔鬼训练，那可能还是有点夸张，但强度确实挺大，每天累的跟狗一样，严格控制饮食，每天只吃健身餐、牛奶、麦片、水果。一顿操作猛如虎，幸好结果也还差强人意。我的体重从接近180斤降到了140左右，肚子上的赘肉明显少了很多，脸也瘦了一圈，同事都说我简直像是变了一个人。听着同事们的夸赞，我表面上波澜不惊，其实心里乐开了花。</p>\n<p>经过半年的努力，我发现自己的身材也变得更好了，肌肉开始有了线条，脸上也开始有了棱角，每次洗完澡，都忍不住在镜子面前多看几眼。</p>\n<p>回顾过去的半年，在健身减肥方面感慨良多，我想也是时候好好总结反思一下了。</p>\n<h2 id=\"放飞自我的半年\"><a href=\"#放飞自我的半年\" class=\"headerlink\" title=\"放飞自我的半年\"></a>放飞自我的半年</h2><p>2020年初，我换了一份工作。刚进入新公司的我，对一切都充满着新鲜感。食堂新鲜的饭菜略合我胃口，加上不断供的零食诱惑以及每天贴心的下午茶，让我的嘴处于长期劳作状态，鲜有罢工之时。与此同时，由于接触了新的工作内容，编程语言也从Java转入了Go，工作上压力也增加不少。</p>\n<p>于是在各类因素的加持下，我的体重便有些不受约束了。去年的时候体重还被我压制在170以下，进新公司之后，体重实现了快速增长，瞬间突破170，以迅雷不及掩耳盗铃之势直奔180而去。</p>\n<p>当时的我，还身在胖中不知胖，总安慰自己，这不是胖，是壮，只要身体健康就好。但身边总是会有人有意无意的提到这一点，让我开始明白，我是真的变胖了，还不少。</p>\n<p>七月底的时候，我在朋友圈发了一张照片，本是想自嘲一下，没想到引来了无数朋友的调侃。</p>\n<p><img src=\"1.jpg\" alt=\"1.jpg\"></p>\n<p><img src=\"2.jpg\" alt=\"2.jpg\"></p>\n<p>绝大多数的评论都是惊叹于我怎么变得这么胖了。虽然嘴上开着玩笑，但说实话还是有一点点受伤。这让我开始正视自己的体重问题了。</p>\n<h2 id=\"八月相约减肥\"><a href=\"#八月相约减肥\" class=\"headerlink\" title=\"八月相约减肥\"></a>八月相约减肥</h2><p>于是，痛定思痛，我开始下定决心减肥。八月份便正式开始踏上减肥之旅。</p>\n<p><img src=\"3.jpeg\" alt=\"3.jpeg\"></p>\n<p>一个人减肥总是难以坚持，我深知这一点，所以怂恿了我的 mentor 和我一起减肥。身宽体胖的他刚好也有这样的想法，于是一拍即合，我们约下战书，看一个月后，谁能减掉更多的体重。</p>\n<p>公司附近就有一个游泳馆，我们每天中午都会去游泳半小时左右，游完泳后相互对比体重，看自己的体重又下降了多少。他比较喜欢开玩笑，也经常调侃我的体重，这让我更加充满动力，心想着这个月一定要比过他。</p>\n<p><img src=\"4.png\" alt=\"4.png\"></p>\n<p>在前半个月里，我们的减肥效果都还不错。在饮食上也有所控制，很少吃零食，中午改成了健身餐，晚饭改成了牛奶麦片，但周末还是没能忍住，放开肚子吃过两次，导致体重迅速反弹。到月底的时候，他以两斤的优势略胜我一筹。</p>\n<p><img src=\"5.png\" alt=\"5.png\"></p>\n<p><img src=\"7.jpeg\" alt=\"7.jpeg\"></p>\n<p><img src=\"8.jpeg\" alt=\"8.jpeg\"></p>\n<p><img src=\"6.png\" alt=\"6.png\"></p>\n<p><img src=\"9.jpeg\" alt=\"9.jpeg\"></p>\n<p>八月份减肥小有所成，虽然体重减少的不算太多，但能一天天的看到自己的进步，还是挺高兴的。在这个月的减肥过程中，也顺便学会了游泳这项新技能，这一点倒是挺不错的。</p>\n<h2 id=\"九月加速减肥\"><a href=\"#九月加速减肥\" class=\"headerlink\" title=\"九月加速减肥\"></a>九月加速减肥</h2><p>在八月的减肥比试中落败，心有不甘，于是从九月份开始加大训练量，增加训练的强度，并更严格的控制饮食。结果发现效果显著，只用了半个月时间，就成功的减掉了10斤。在健身房完成了第一百次打卡，体重也从163.9降到了153.7。</p>\n<p><img src=\"10.png\" alt=\"10.png\"></p>\n<p><img src=\"12.jpeg\" alt=\"12.jpeg\"></p>\n<p><img src=\"11.jpeg\" alt=\"11.jpeg\"></p>\n<p><img src=\"13.jpeg\" alt=\"13.jpeg\"></p>\n<p><img src=\"14.jpeg\" alt=\"14.jpeg\"></p>\n<p>随后的一段时间，又吃了两顿没控制住，体重应声反弹，但随即被控制住了。到了九月底，目标也顺利完成了。</p>\n<p>到了九月底，体重来到150以下了，体脂率也下降到了23%。而且，减肥后脸也瘦了不少，精神面貌确实要好了很多。</p>\n<p><img src=\"15.png\" alt=\"15.png\"></p>\n<p><img src=\"16.jpeg\" alt=\"16.jpeg\"></p>\n<p><img src=\"18.jpeg\" alt=\"18.jpeg\"></p>\n<p><img src=\"2.jpg\" alt=\"2.jpg\"></p>\n<p><img src=\"17.jpeg\" alt=\"17.jpeg\"></p>\n<p><img src=\"19.jpeg\" alt=\"19.jpeg\"></p>\n<p>九月份的训练说是魔鬼训练一点也不过分，不仅严格控制饮食，而且有大量的无氧和有氧运动，每次练完都累到怀疑人生，回到家总是腰酸背痛，好几次在半夜里腿抽筋痛醒了过来。</p>\n<p>我知道这样的运动确实有些过量了，但还在身体可以接受的范围之内，只要注意不做太大重量拉伤肌肉，尚在可控范围之内。</p>\n<p>在慢慢养成习惯之后，每天不出一身汗反而会觉得不自在。健身成了我生活中不可或缺的一部分。</p>\n<h2 id=\"十月小幅反弹\"><a href=\"#十月小幅反弹\" class=\"headerlink\" title=\"十月小幅反弹\"></a>十月小幅反弹</h2><p>经过十一长假的放纵，体重也成功起飞，虽然在假期之后的调整中得到了一些控制，但在饮食控制上有所松懈，所以体重一直有所反复，到月底的时候，体重反弹了1.5斤。</p>\n<p>那时候无意中在知乎上看到一款叫红魔的产品，说是可以提升运动效果，增加运动消耗，于是买了两瓶试了试。第一次使用的那天，早上有一段时间手一直在不由自主的发抖，精神有些异常亢奋，锻炼的时候确实感觉更有力量，但可能大部分是咖啡因的效果。</p>\n<p><img src=\"20.png\" alt=\"20.png\"></p>\n<p><img src=\"23.jpeg\" alt=\"23.jpeg\"></p>\n<p><img src=\"21.jpeg\" alt=\"21.jpeg\"></p>\n<p><img src=\"22.jpeg\" alt=\"22.jpeg\"></p>\n<p>现在两瓶已经吃完了，刚吃完那几天会有明显的精神萎靡不振的感觉，好在现在已经基本调整过来了。记得有一次吃错了药，在晚上的时候吃了两颗红魔，效果是真的好，不管怎样都睡不着，直到五点多才实在困得不行睡了一会。</p>\n<p>现在想想确实有些乱来了，以后不会再乱吃这些东西了。</p>\n<h2 id=\"十一月疯狂跑步\"><a href=\"#十一月疯狂跑步\" class=\"headerlink\" title=\"十一月疯狂跑步\"></a>十一月疯狂跑步</h2><p>经历了一个萎靡不振的十月，自我反思之后，决定尝试一下跑步减肥，之前只是在健身完成之后跑跑步放松一下，没有做太多的跑步运动。</p>\n<p>在11月份里，我每天平均跑步5公里，一路坚持下来，效果确实也还可以。</p>\n<p><img src=\"28.jpeg\" alt=\"28.jpeg\"></p>\n<p>虽然体重也多次反弹，但目标还是完成了。体重也成功从153降到了141。同时，脸上也不再是一团浆糊，逐渐开始有了棱角。同事都说我简直像是换了一张脸。</p>\n<p><img src=\"31.png\" alt=\"31.png\"></p>\n<p><img src=\"26.jpeg\" alt=\"26.jpeg\"></p>\n<p><img src=\"24.jpeg\" alt=\"24.jpeg\"></p>\n<p><img src=\"29.jpeg\" alt=\"29.jpeg\"></p>\n<p><img src=\"25.jpeg\" alt=\"25.jpeg\"></p>\n<p><img src=\"30.jpeg\" alt=\"30.jpeg\"></p>\n<p><img src=\"27.jpeg\" alt=\"27.jpeg\"></p>\n<h2 id=\"十二月后休养生息\"><a href=\"#十二月后休养生息\" class=\"headerlink\" title=\"十二月后休养生息\"></a>十二月后休养生息</h2><p>十一月跑步有些过头了，膝盖有些受不了了，所以十二月调整了策略，基本没有跑步，运动量也减半了。</p>\n<p>因为体重逐渐接近目标，我知道短期快速的减肥很容易反弹，所以希望让体重在没那么大的运动量下，在一个范围内保持稳定。</p>\n<p>经过十二月和一月两个月的摸索，体重也成功的维持在145上下，虽然波动也还是不小，不过一两顿的增肥不会再造成太大的困扰，短期体重的骤增也能在随后两天运动下降下来，生活也开始走向常态化。</p>\n<p>一月份开始使用keep来锻炼，主要做减脂运动和腹肌训练，目标是把体脂率减下来，并且让腹肌线条更加明显。</p>\n<p><img src=\"32.png\" alt=\"32.png\"></p>\n<p>但腹肌训练远比我想象的要难，虽然每次都竭尽全力，但一个月下来，腹肌并没有明显的改善。。。</p>\n<h2 id=\"重新起航\"><a href=\"#重新起航\" class=\"headerlink\" title=\"重新起航\"></a>重新起航</h2><p>一转眼，新年增肥期就已经过去了，不出意外，应该胖了五斤以上。所以准备回上海后重新启动减脂增肌计划。本来计划用一年时间练出六块腹肌，但后来看了一些文章，发现如果训练得当，三个月就够了。再加上自己腹肌力量已经有一定的基础了，三个月时间应该还算充裕，也就是五月结束之前练出六块腹肌。</p>\n<p>为此，我需要将体脂率控制在14%左右，相应的体重应该要在125左右。因此我还需要减掉20斤，三个月减20斤，确实不容易，但也不算太难，毕竟之前的减肥经历已经磨练过一次了，所以我还是充满信心。</p>\n<p>至于为什么对腹肌有如此的执念，是因为减肥之后发现自己的身材得到了很大的改善，肌肉开始有线条了，胸肌明显增大，肱二头肌和肱三头肌也有明显变化，但腹部堆积的脂肪还是有点多，所以想继续练练，让身形更好看一点。</p>\n<p>当然，六块腹肌只是一个中间目标，其背后代表的健康生活方式才是我所追求的，所以也不能舍本逐末，为了锻炼腹肌反而损害了自己的健康。</p>\n<p>等完成了六块腹肌之后，需要的便是增加对敏捷、爆发、重量和耐力的综合训练来维持一个健康的身材，等时机成熟再进军八块腹肌。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>2020年的减脂和增肌效果显著，让我成功的甩掉了胖子的标签，也让我的肌肉力量得到很大的增强。每月一个flag的方式，让我在减肥的路上不再对遥远的目标感到遥遥无期，而是自信面对每天的挑战。把一个大目标拆解成一个个小目标，然后各个击破，并根据实际情况灵活调整，让看似难以实现的目标也能得以完成。</p>\n<p>实现目标有很多种方法论，但找到最适合自己的方法论才能更好的完成目标。一路走来，也逐渐发现，制定计划和目标并不难，方法论也只能提供达成目标的工具，对实现目标的那份激情和执着才是源源不断的动力源泉。</p>\n<p>当发现生活被迷雾缠绕，无法看清方向时，逃避现实或者自甘堕落都无济于事，雪球最终只会越滚越大。与其等到雪球大到无力解决时被砸得遍体鳞伤，不如提早把问题解决掉。在看似繁杂的问题中，其实只有少数几个关键的问题，只要解决了这几个关键问题，其它问题都会迎刃而解。</p>\n<p>每个人的行为方式都是基于自己对生活和人生的理解，都是对自己人生观和价值观的一种践行。每个人经历的生活不一样，所以对人生的理解也会不一样。很多人的行为方式看似很难理解，但在他们的视角里，一切都能自圆其说。事实无对错，但观点分高下。善弈者通盘无妙手，我所追寻的，是深思熟虑之后的步步为营，而不是剑走偏锋式的出奇制胜。</p>\n<p>我想这一年收获的不仅仅是健身留下的好身材，更多的是关于健身知识的积累和健身习惯的形成。随着健身习惯的养成，健身早已成为日常生活中不可缺少的一部分，我想不仅要活到老学到老，也要练到老，让强健的身体成为生活和事业的发动机，提供源源不断的精力支持。</p>\n<p>2021的序幕已经拉开，如果说，站在2021的尾巴上回顾这一整年，完成哪些事会让我觉得这一年没有虚度，那么六块腹肌和保持较低的体脂率一定位列其中。</p>\n<p>路漫漫其修远兮，吾将上下而求索。2021，再接再厉！</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<h2 id=\"难忘的一年\"><a href=\"#难忘的一年\" class=\"headerlink\" title=\"难忘的一年\"></a>难忘的一年</h2><p>从几年前到上海工作不久，我便开始了我的健身之旅。一开始的目的其实很简单，只是想要增强一下体能，增加一些肌肉。几年下来，在健身的路上走走停停，肌肉块头确实有所增大，但身材却一言难尽，体重也随着生活的烦恼与日俱增。</p>\n<p>2020年换了工作后，更是开始放飞自我。巅峰时期我的体重一度接近180斤，让我承受着这个年纪不该承受的负担。在此期间，身边的朋友开始时不时拿我的体重开玩笑，我的某位同事也一直拿我工牌上的照片来嘲讽我，而我却总是置若罔闻，并没有太放在心上。</p>\n<p>到了年中的时候，突然变得有些彷徨和犹豫，想做的事情太多，一时间不知该如何入手。转念一想，要不先减减肥吧，毕竟身体是革命的本钱，身体变强了，做事效率应该也能有所提升。而且身体健康是一直以来都是我比较重视的一方面，也符合“坚持长期主义”的革命纲领。</p>\n<p>于是说干就干，撸起袖子，开始了为期两个月的魔鬼训练。说是魔鬼训练，那可能还是有点夸张，但强度确实挺大，每天累的跟狗一样，严格控制饮食，每天只吃健身餐、牛奶、麦片、水果。一顿操作猛如虎，幸好结果也还差强人意。我的体重从接近180斤降到了140左右，肚子上的赘肉明显少了很多，脸也瘦了一圈，同事都说我简直像是变了一个人。听着同事们的夸赞，我表面上波澜不惊，其实心里乐开了花。</p>\n<p>经过半年的努力，我发现自己的身材也变得更好了，肌肉开始有了线条，脸上也开始有了棱角，每次洗完澡，都忍不住在镜子面前多看几眼。</p>\n<p>回顾过去的半年，在健身减肥方面感慨良多，我想也是时候好好总结反思一下了。</p>\n<h2 id=\"放飞自我的半年\"><a href=\"#放飞自我的半年\" class=\"headerlink\" title=\"放飞自我的半年\"></a>放飞自我的半年</h2><p>2020年初，我换了一份工作。刚进入新公司的我，对一切都充满着新鲜感。食堂新鲜的饭菜略合我胃口，加上不断供的零食诱惑以及每天贴心的下午茶，让我的嘴处于长期劳作状态，鲜有罢工之时。与此同时，由于接触了新的工作内容，编程语言也从Java转入了Go，工作上压力也增加不少。</p>\n<p>于是在各类因素的加持下，我的体重便有些不受约束了。去年的时候体重还被我压制在170以下，进新公司之后，体重实现了快速增长，瞬间突破170，以迅雷不及掩耳盗铃之势直奔180而去。</p>\n<p>当时的我，还身在胖中不知胖，总安慰自己，这不是胖，是壮，只要身体健康就好。但身边总是会有人有意无意的提到这一点，让我开始明白，我是真的变胖了，还不少。</p>\n<p>七月底的时候，我在朋友圈发了一张照片，本是想自嘲一下，没想到引来了无数朋友的调侃。</p>\n<p><img src=\"1.jpg\" alt=\"1.jpg\"></p>\n<p><img src=\"2.jpg\" alt=\"2.jpg\"></p>\n<p>绝大多数的评论都是惊叹于我怎么变得这么胖了。虽然嘴上开着玩笑，但说实话还是有一点点受伤。这让我开始正视自己的体重问题了。</p>\n<h2 id=\"八月相约减肥\"><a href=\"#八月相约减肥\" class=\"headerlink\" title=\"八月相约减肥\"></a>八月相约减肥</h2><p>于是，痛定思痛，我开始下定决心减肥。八月份便正式开始踏上减肥之旅。</p>\n<p><img src=\"3.jpeg\" alt=\"3.jpeg\"></p>\n<p>一个人减肥总是难以坚持，我深知这一点，所以怂恿了我的 mentor 和我一起减肥。身宽体胖的他刚好也有这样的想法，于是一拍即合，我们约下战书，看一个月后，谁能减掉更多的体重。</p>\n<p>公司附近就有一个游泳馆，我们每天中午都会去游泳半小时左右，游完泳后相互对比体重，看自己的体重又下降了多少。他比较喜欢开玩笑，也经常调侃我的体重，这让我更加充满动力，心想着这个月一定要比过他。</p>\n<p><img src=\"4.png\" alt=\"4.png\"></p>\n<p>在前半个月里，我们的减肥效果都还不错。在饮食上也有所控制，很少吃零食，中午改成了健身餐，晚饭改成了牛奶麦片，但周末还是没能忍住，放开肚子吃过两次，导致体重迅速反弹。到月底的时候，他以两斤的优势略胜我一筹。</p>\n<p><img src=\"5.png\" alt=\"5.png\"></p>\n<p><img src=\"7.jpeg\" alt=\"7.jpeg\"></p>\n<p><img src=\"8.jpeg\" alt=\"8.jpeg\"></p>\n<p><img src=\"6.png\" alt=\"6.png\"></p>\n<p><img src=\"9.jpeg\" alt=\"9.jpeg\"></p>\n<p>八月份减肥小有所成，虽然体重减少的不算太多，但能一天天的看到自己的进步，还是挺高兴的。在这个月的减肥过程中，也顺便学会了游泳这项新技能，这一点倒是挺不错的。</p>\n<h2 id=\"九月加速减肥\"><a href=\"#九月加速减肥\" class=\"headerlink\" title=\"九月加速减肥\"></a>九月加速减肥</h2><p>在八月的减肥比试中落败，心有不甘，于是从九月份开始加大训练量，增加训练的强度，并更严格的控制饮食。结果发现效果显著，只用了半个月时间，就成功的减掉了10斤。在健身房完成了第一百次打卡，体重也从163.9降到了153.7。</p>\n<p><img src=\"10.png\" alt=\"10.png\"></p>\n<p><img src=\"12.jpeg\" alt=\"12.jpeg\"></p>\n<p><img src=\"11.jpeg\" alt=\"11.jpeg\"></p>\n<p><img src=\"13.jpeg\" alt=\"13.jpeg\"></p>\n<p><img src=\"14.jpeg\" alt=\"14.jpeg\"></p>\n<p>随后的一段时间，又吃了两顿没控制住，体重应声反弹，但随即被控制住了。到了九月底，目标也顺利完成了。</p>\n<p>到了九月底，体重来到150以下了，体脂率也下降到了23%。而且，减肥后脸也瘦了不少，精神面貌确实要好了很多。</p>\n<p><img src=\"15.png\" alt=\"15.png\"></p>\n<p><img src=\"16.jpeg\" alt=\"16.jpeg\"></p>\n<p><img src=\"18.jpeg\" alt=\"18.jpeg\"></p>\n<p><img src=\"2.jpg\" alt=\"2.jpg\"></p>\n<p><img src=\"17.jpeg\" alt=\"17.jpeg\"></p>\n<p><img src=\"19.jpeg\" alt=\"19.jpeg\"></p>\n<p>九月份的训练说是魔鬼训练一点也不过分，不仅严格控制饮食，而且有大量的无氧和有氧运动，每次练完都累到怀疑人生，回到家总是腰酸背痛，好几次在半夜里腿抽筋痛醒了过来。</p>\n<p>我知道这样的运动确实有些过量了，但还在身体可以接受的范围之内，只要注意不做太大重量拉伤肌肉，尚在可控范围之内。</p>\n<p>在慢慢养成习惯之后，每天不出一身汗反而会觉得不自在。健身成了我生活中不可或缺的一部分。</p>\n<h2 id=\"十月小幅反弹\"><a href=\"#十月小幅反弹\" class=\"headerlink\" title=\"十月小幅反弹\"></a>十月小幅反弹</h2><p>经过十一长假的放纵，体重也成功起飞，虽然在假期之后的调整中得到了一些控制，但在饮食控制上有所松懈，所以体重一直有所反复，到月底的时候，体重反弹了1.5斤。</p>\n<p>那时候无意中在知乎上看到一款叫红魔的产品，说是可以提升运动效果，增加运动消耗，于是买了两瓶试了试。第一次使用的那天，早上有一段时间手一直在不由自主的发抖，精神有些异常亢奋，锻炼的时候确实感觉更有力量，但可能大部分是咖啡因的效果。</p>\n<p><img src=\"20.png\" alt=\"20.png\"></p>\n<p><img src=\"23.jpeg\" alt=\"23.jpeg\"></p>\n<p><img src=\"21.jpeg\" alt=\"21.jpeg\"></p>\n<p><img src=\"22.jpeg\" alt=\"22.jpeg\"></p>\n<p>现在两瓶已经吃完了，刚吃完那几天会有明显的精神萎靡不振的感觉，好在现在已经基本调整过来了。记得有一次吃错了药，在晚上的时候吃了两颗红魔，效果是真的好，不管怎样都睡不着，直到五点多才实在困得不行睡了一会。</p>\n<p>现在想想确实有些乱来了，以后不会再乱吃这些东西了。</p>\n<h2 id=\"十一月疯狂跑步\"><a href=\"#十一月疯狂跑步\" class=\"headerlink\" title=\"十一月疯狂跑步\"></a>十一月疯狂跑步</h2><p>经历了一个萎靡不振的十月，自我反思之后，决定尝试一下跑步减肥，之前只是在健身完成之后跑跑步放松一下，没有做太多的跑步运动。</p>\n<p>在11月份里，我每天平均跑步5公里，一路坚持下来，效果确实也还可以。</p>\n<p><img src=\"28.jpeg\" alt=\"28.jpeg\"></p>\n<p>虽然体重也多次反弹，但目标还是完成了。体重也成功从153降到了141。同时，脸上也不再是一团浆糊，逐渐开始有了棱角。同事都说我简直像是换了一张脸。</p>\n<p><img src=\"31.png\" alt=\"31.png\"></p>\n<p><img src=\"26.jpeg\" alt=\"26.jpeg\"></p>\n<p><img src=\"24.jpeg\" alt=\"24.jpeg\"></p>\n<p><img src=\"29.jpeg\" alt=\"29.jpeg\"></p>\n<p><img src=\"25.jpeg\" alt=\"25.jpeg\"></p>\n<p><img src=\"30.jpeg\" alt=\"30.jpeg\"></p>\n<p><img src=\"27.jpeg\" alt=\"27.jpeg\"></p>\n<h2 id=\"十二月后休养生息\"><a href=\"#十二月后休养生息\" class=\"headerlink\" title=\"十二月后休养生息\"></a>十二月后休养生息</h2><p>十一月跑步有些过头了，膝盖有些受不了了，所以十二月调整了策略，基本没有跑步，运动量也减半了。</p>\n<p>因为体重逐渐接近目标，我知道短期快速的减肥很容易反弹，所以希望让体重在没那么大的运动量下，在一个范围内保持稳定。</p>\n<p>经过十二月和一月两个月的摸索，体重也成功的维持在145上下，虽然波动也还是不小，不过一两顿的增肥不会再造成太大的困扰，短期体重的骤增也能在随后两天运动下降下来，生活也开始走向常态化。</p>\n<p>一月份开始使用keep来锻炼，主要做减脂运动和腹肌训练，目标是把体脂率减下来，并且让腹肌线条更加明显。</p>\n<p><img src=\"32.png\" alt=\"32.png\"></p>\n<p>但腹肌训练远比我想象的要难，虽然每次都竭尽全力，但一个月下来，腹肌并没有明显的改善。。。</p>\n<h2 id=\"重新起航\"><a href=\"#重新起航\" class=\"headerlink\" title=\"重新起航\"></a>重新起航</h2><p>一转眼，新年增肥期就已经过去了，不出意外，应该胖了五斤以上。所以准备回上海后重新启动减脂增肌计划。本来计划用一年时间练出六块腹肌，但后来看了一些文章，发现如果训练得当，三个月就够了。再加上自己腹肌力量已经有一定的基础了，三个月时间应该还算充裕，也就是五月结束之前练出六块腹肌。</p>\n<p>为此，我需要将体脂率控制在14%左右，相应的体重应该要在125左右。因此我还需要减掉20斤，三个月减20斤，确实不容易，但也不算太难，毕竟之前的减肥经历已经磨练过一次了，所以我还是充满信心。</p>\n<p>至于为什么对腹肌有如此的执念，是因为减肥之后发现自己的身材得到了很大的改善，肌肉开始有线条了，胸肌明显增大，肱二头肌和肱三头肌也有明显变化，但腹部堆积的脂肪还是有点多，所以想继续练练，让身形更好看一点。</p>\n<p>当然，六块腹肌只是一个中间目标，其背后代表的健康生活方式才是我所追求的，所以也不能舍本逐末，为了锻炼腹肌反而损害了自己的健康。</p>\n<p>等完成了六块腹肌之后，需要的便是增加对敏捷、爆发、重量和耐力的综合训练来维持一个健康的身材，等时机成熟再进军八块腹肌。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>2020年的减脂和增肌效果显著，让我成功的甩掉了胖子的标签，也让我的肌肉力量得到很大的增强。每月一个flag的方式，让我在减肥的路上不再对遥远的目标感到遥遥无期，而是自信面对每天的挑战。把一个大目标拆解成一个个小目标，然后各个击破，并根据实际情况灵活调整，让看似难以实现的目标也能得以完成。</p>\n<p>实现目标有很多种方法论，但找到最适合自己的方法论才能更好的完成目标。一路走来，也逐渐发现，制定计划和目标并不难，方法论也只能提供达成目标的工具，对实现目标的那份激情和执着才是源源不断的动力源泉。</p>\n<p>当发现生活被迷雾缠绕，无法看清方向时，逃避现实或者自甘堕落都无济于事，雪球最终只会越滚越大。与其等到雪球大到无力解决时被砸得遍体鳞伤，不如提早把问题解决掉。在看似繁杂的问题中，其实只有少数几个关键的问题，只要解决了这几个关键问题，其它问题都会迎刃而解。</p>\n<p>每个人的行为方式都是基于自己对生活和人生的理解，都是对自己人生观和价值观的一种践行。每个人经历的生活不一样，所以对人生的理解也会不一样。很多人的行为方式看似很难理解，但在他们的视角里，一切都能自圆其说。事实无对错，但观点分高下。善弈者通盘无妙手，我所追寻的，是深思熟虑之后的步步为营，而不是剑走偏锋式的出奇制胜。</p>\n<p>我想这一年收获的不仅仅是健身留下的好身材，更多的是关于健身知识的积累和健身习惯的形成。随着健身习惯的养成，健身早已成为日常生活中不可缺少的一部分，我想不仅要活到老学到老，也要练到老，让强健的身体成为生活和事业的发动机，提供源源不断的精力支持。</p>\n<p>2021的序幕已经拉开，如果说，站在2021的尾巴上回顾这一整年，完成哪些事会让我觉得这一年没有虚度，那么六块腹肌和保持较低的体脂率一定位列其中。</p>\n<p>路漫漫其修远兮，吾将上下而求索。2021，再接再厉！</p>\n"},{"title":"【R语言入门】R语言中的变量与基本数据类型","toc":true,"date":"2020-11-28T00:54:35.000Z","_content":"\n## 说明\n\n在前一篇中，我们介绍了 `R` 语言和 `R Studio` 的安装，并简单的介绍了一个示例，接下来让我们由浅入深的学习 `R` 语言的相关知识。\n\n本篇将主要介绍 `R` 语言的基本操作、变量和几种基本数据类型，好对 `R` 语言的使用方法有一个基本的概念。通过本篇的学习，你将了解到：\n\n1. `R` 语言有哪些基本操作\n2. 什么是变量，以及如何给变量赋值\n3. `R` 语言有哪些基本数据类型，如何确定变量的数据类型\n\n## R 语言的基本操作\n\n`R` 语言的默认提示符是 `>` ，它表示正在等待输入命令，每次输入命令后敲击回车即可执行当前命令。\n\n![](1.png)\n\n`R` 语言支持的基本操作主要有加、减、乘、除、取余和幂运算，对应的运算符分别为：+、-、*、/、%%、^。\n\n加减乘除就不必多说了，但有一点需要提一下，跟许多语言不一样的是，`R` 语言中，除法运算得到的不是整数部分，而是包含小数部分的结果。\n\n```R\n> 9/2\n[1] 4.5\n> 9/4\n[1] 2.25\n> 11/3\n[1] 3.666667\n```\n\n取余运算的含义是计算整除后的余数：\n\n```R\n> 9 %% 2\n[1] 1\n> 9 %% 4\n[1] 1\n> 9 %% 3\n[1] 0\n> 11 % 4\n错误: unexpected input in \"11 % 4\"\n```\n\n在使用时需要注意的是有两个百分号组成，输入错误则会得上上述错误提示。\n\n幂运算跟数学中的幂运算含义一致，`2^3` 代表的是2的3次幂：\n\n```R\n> 2 ^ 3\n[1] 8\n> 3 ^ 2\n[1] 9\n> 2 ^ 10\n[1] 1024\n> 2 ^ 100\n[1] 1.267651e+30\n```\n\n## R 语言中的变量\n\n在使用 `R` 语言时，我们通常很难一步到位得到最终的结果，需要进行一些复杂的计算。这时我们便需要使用变量来存放计算得到的中间结果。\n\n`R` 语言中，可以将变量想象成一个盒子，我们可以将任何数据暂存到这个盒子里，但同一时刻，这个盒子只能保存一个数据，如果被多次赋值，则只会保存最后一次放入的数据。\n\n`R` 语言中的赋值符号是 `->`，虽然也可以使用 `=` 进行赋值，但强烈建议不要这样做，这样不仅显得不专业，而且在一些情况下会出现问题。\n\n```R\n> x <- 3\n> x <- 4\n> x <- 9\n> x\n[1] 9\n```\n\n`R` 语言中的变量不需要事先声明，直接使用即可。如果使用了一个之前没有出现过的变量，则会创建一个新的变量。`R` 语言中变量是区分大小写的，`x` 与 `X` 是两个不同的变量。\n\n```R\n> X\n错误: 找不到对象'X'\n> X <- 1\n> X <- 3\n> X\n[1] 3\n> x\n[1] 9\n```\n\n变量都是有名字的，比如`x`、`y`、`stu_score`，变量的命名必须满足以下规则：\n\n1. 只能使用字母（区分大小写）、数字、“_”（下划线）、“.”（英文句号），不能有中文、空格和其它特殊字符存在\n2. 不能以数字、下划线开头，开头必须是英文字母或者点\n3. 可以以点号开头，但点号后面的符号不能是数字\n\n在 `R` 语言中，如果非要搞一些骚操作，用一些奇怪的变量名，也不是不可以，需要用反引号来包裹。\n\n```R\n> `* 90` <- 10\n> `* 90`\n[1] 10\n> `变量` <- 20\n> `变量`\n[1] 20\n```\n\n当然，不建议这样做，变量取名最好简单且有意义，这样可以减少与其他人的沟通成本以及日后的理解成本。\n\n\n## R 语言中的基本数据类型\n\n`R` 语言中主要数据类型有：向量、列表、矩阵、因子、数据框、数组。这些会在后面的文章中进行介绍，本篇只介绍基本的几种数据类型。\n\n### 1. 逻辑型(logical)\n\n逻辑型数据有两种可能的值，`TRUE` 或 `FALSE` 。\n\n```R\n> v <- TRUE\n> class(v)\n[1] \"logical\"\n> y <- FALSE\n> class(v)\n[1] \"logical\"\n> y <- false\n错误: 找不到对象'false'\n```\n\n`class` 函数可以获取变量的类型信息，可以看到，变量 `v` 和 `y` 都是 `logical` 类型。需要注意的是 `TRUE` 和 `FALSE` 必须全部大写，否则会出现上面的错误提示。\n\n### 2. 数值型(numeric)\n\n`R` 语言中数字的默认类型为数值型，在运算时需要注意其精度问题，当整数部分大于等于7位时，将舍弃小数部分，当整数部分小于7位时，与小数部分一起最多保留7位数字。\n\n```R\n> i <- 10\n> class(i)\n[1] \"numeric\"\n> j <- 11.1\n> class(j)\n[1] \"numeric\"\n> k <- 1.1234567890\n> class(k)\n[1] \"numeric\"\n> k\n[1] 1.123457\n> k <- 123456789.123456789\n> k\n[1] 123456789\n> k <- 1234567.123456789\n> k\n[1] 1234567\n> k <- 123456.123456789\n> k\n[1] 123456.1\n```\n\n### 3. 整数型(integer)\n\n`R` 语言中，整数型需要使用数字+L来表示，如：`2L`、`11L`、`-10L`。\n\n```R\n> i <- 1L\n> class(i)\n[1] \"integer\"\n> j <- 22L\n> class(j)\n[1] \"integer\"\n> k <- -10L\n> class(k)\n[1] \"integer\"\n```\n\n### 4. 字符型(character)\n\n`R` 语言中字符型即字符串类型，通常为用单引号或双引号包围的字符串。\n\n```R\n> name <- \"Frank\"\n> class(name)\n[1] \"character\"\n> doc_name <- \"study.mp4\"\n> class(doc_name)\n[1] \"character\"\n```\n\n### 5. 复数型(Complex)\n\n`R` 语言是支持复数计算的，复数也是 `R` 语言的基本类型之一。\n\n```R\n> c1 <- 3 + 2i\n> class(c1)\n[1] \"complex\"\n> c2 <-6 - 3i\n> class(c2)\n[1] \"complex\"\n```\n\n### 6. 原型(Raw)\n\n`R` 语言还有一种不太常见的基本数据类型，叫原型(`raw`)。`raw` 类型是直接使用其二进制内容来进行保存和使用的类型。\n\n```R\n> v <- charToRaw(\"Hello\")\n> class(v)\n[1] \"raw\"\n> v\n[1] 48 65 6c 6c 6f\n```\n\n### 如何判断变量的类型\n\n当我们拿到一个变量之后，如何判断它的数据类型呢？上面的例子中，其实已经有所提及，使用 `class()` 函数可以简单方便的查看变量的类型，但还有更简单的方式，为了判断某个变量`x` 保存的基本类型，可以用 `is.xxx()` 类函数，如`is.integer(x)`, `is.double(x)`, `is.numeric(x)`, `is.logical(x)`, `is.character(x)`, `is.complex(x)`, `is.raw(x)`。 其中 `is.numeric(x)` 对 `integer` 和 `double` 内容都返回真值。\n\n```R\n> is.character(s)\n[1] TRUE\n> is.character(v)\n[1] FALSE\n> is.raw(v)\n[1] TRUE\n> is.integer(i)\n[1] TRUE\n> is.numeric(i)\n[1] TRUE\n> is.complex(c1)\n[1] TRUE\n> is.integer(c1)\n[1] FALSE\n```\n\n## 小结\n\n至此，本篇就告一段落了，相信通过本篇的学习，对 `R` 语言的基本数据类型能有一个整体的掌握，别忘了回顾一下之前的问题，这些你都了解了吗：\n\n1. `R` 语言有哪些基本操作\n2. 什么是变量，以及如何给变量赋值\n3. `R` 语言有哪些基本数据类型，如何确定变量的数据类型\n\n之后的篇章中，将会继续介绍 `R` 语言的各方各面，让 `R` 语言能为我们的数据分析提供更强力的支持！","source":"_posts/data-analysis/r-study-basic-type.md","raw":"---\ntitle: 【R语言入门】R语言中的变量与基本数据类型\ntags:\n  - R\ncategories:\n  - 编程\n  - 数据分析\ntoc: true\ndate: 2020-11-28 08:54:35\n---\n\n## 说明\n\n在前一篇中，我们介绍了 `R` 语言和 `R Studio` 的安装，并简单的介绍了一个示例，接下来让我们由浅入深的学习 `R` 语言的相关知识。\n\n本篇将主要介绍 `R` 语言的基本操作、变量和几种基本数据类型，好对 `R` 语言的使用方法有一个基本的概念。通过本篇的学习，你将了解到：\n\n1. `R` 语言有哪些基本操作\n2. 什么是变量，以及如何给变量赋值\n3. `R` 语言有哪些基本数据类型，如何确定变量的数据类型\n\n## R 语言的基本操作\n\n`R` 语言的默认提示符是 `>` ，它表示正在等待输入命令，每次输入命令后敲击回车即可执行当前命令。\n\n![](1.png)\n\n`R` 语言支持的基本操作主要有加、减、乘、除、取余和幂运算，对应的运算符分别为：+、-、*、/、%%、^。\n\n加减乘除就不必多说了，但有一点需要提一下，跟许多语言不一样的是，`R` 语言中，除法运算得到的不是整数部分，而是包含小数部分的结果。\n\n```R\n> 9/2\n[1] 4.5\n> 9/4\n[1] 2.25\n> 11/3\n[1] 3.666667\n```\n\n取余运算的含义是计算整除后的余数：\n\n```R\n> 9 %% 2\n[1] 1\n> 9 %% 4\n[1] 1\n> 9 %% 3\n[1] 0\n> 11 % 4\n错误: unexpected input in \"11 % 4\"\n```\n\n在使用时需要注意的是有两个百分号组成，输入错误则会得上上述错误提示。\n\n幂运算跟数学中的幂运算含义一致，`2^3` 代表的是2的3次幂：\n\n```R\n> 2 ^ 3\n[1] 8\n> 3 ^ 2\n[1] 9\n> 2 ^ 10\n[1] 1024\n> 2 ^ 100\n[1] 1.267651e+30\n```\n\n## R 语言中的变量\n\n在使用 `R` 语言时，我们通常很难一步到位得到最终的结果，需要进行一些复杂的计算。这时我们便需要使用变量来存放计算得到的中间结果。\n\n`R` 语言中，可以将变量想象成一个盒子，我们可以将任何数据暂存到这个盒子里，但同一时刻，这个盒子只能保存一个数据，如果被多次赋值，则只会保存最后一次放入的数据。\n\n`R` 语言中的赋值符号是 `->`，虽然也可以使用 `=` 进行赋值，但强烈建议不要这样做，这样不仅显得不专业，而且在一些情况下会出现问题。\n\n```R\n> x <- 3\n> x <- 4\n> x <- 9\n> x\n[1] 9\n```\n\n`R` 语言中的变量不需要事先声明，直接使用即可。如果使用了一个之前没有出现过的变量，则会创建一个新的变量。`R` 语言中变量是区分大小写的，`x` 与 `X` 是两个不同的变量。\n\n```R\n> X\n错误: 找不到对象'X'\n> X <- 1\n> X <- 3\n> X\n[1] 3\n> x\n[1] 9\n```\n\n变量都是有名字的，比如`x`、`y`、`stu_score`，变量的命名必须满足以下规则：\n\n1. 只能使用字母（区分大小写）、数字、“_”（下划线）、“.”（英文句号），不能有中文、空格和其它特殊字符存在\n2. 不能以数字、下划线开头，开头必须是英文字母或者点\n3. 可以以点号开头，但点号后面的符号不能是数字\n\n在 `R` 语言中，如果非要搞一些骚操作，用一些奇怪的变量名，也不是不可以，需要用反引号来包裹。\n\n```R\n> `* 90` <- 10\n> `* 90`\n[1] 10\n> `变量` <- 20\n> `变量`\n[1] 20\n```\n\n当然，不建议这样做，变量取名最好简单且有意义，这样可以减少与其他人的沟通成本以及日后的理解成本。\n\n\n## R 语言中的基本数据类型\n\n`R` 语言中主要数据类型有：向量、列表、矩阵、因子、数据框、数组。这些会在后面的文章中进行介绍，本篇只介绍基本的几种数据类型。\n\n### 1. 逻辑型(logical)\n\n逻辑型数据有两种可能的值，`TRUE` 或 `FALSE` 。\n\n```R\n> v <- TRUE\n> class(v)\n[1] \"logical\"\n> y <- FALSE\n> class(v)\n[1] \"logical\"\n> y <- false\n错误: 找不到对象'false'\n```\n\n`class` 函数可以获取变量的类型信息，可以看到，变量 `v` 和 `y` 都是 `logical` 类型。需要注意的是 `TRUE` 和 `FALSE` 必须全部大写，否则会出现上面的错误提示。\n\n### 2. 数值型(numeric)\n\n`R` 语言中数字的默认类型为数值型，在运算时需要注意其精度问题，当整数部分大于等于7位时，将舍弃小数部分，当整数部分小于7位时，与小数部分一起最多保留7位数字。\n\n```R\n> i <- 10\n> class(i)\n[1] \"numeric\"\n> j <- 11.1\n> class(j)\n[1] \"numeric\"\n> k <- 1.1234567890\n> class(k)\n[1] \"numeric\"\n> k\n[1] 1.123457\n> k <- 123456789.123456789\n> k\n[1] 123456789\n> k <- 1234567.123456789\n> k\n[1] 1234567\n> k <- 123456.123456789\n> k\n[1] 123456.1\n```\n\n### 3. 整数型(integer)\n\n`R` 语言中，整数型需要使用数字+L来表示，如：`2L`、`11L`、`-10L`。\n\n```R\n> i <- 1L\n> class(i)\n[1] \"integer\"\n> j <- 22L\n> class(j)\n[1] \"integer\"\n> k <- -10L\n> class(k)\n[1] \"integer\"\n```\n\n### 4. 字符型(character)\n\n`R` 语言中字符型即字符串类型，通常为用单引号或双引号包围的字符串。\n\n```R\n> name <- \"Frank\"\n> class(name)\n[1] \"character\"\n> doc_name <- \"study.mp4\"\n> class(doc_name)\n[1] \"character\"\n```\n\n### 5. 复数型(Complex)\n\n`R` 语言是支持复数计算的，复数也是 `R` 语言的基本类型之一。\n\n```R\n> c1 <- 3 + 2i\n> class(c1)\n[1] \"complex\"\n> c2 <-6 - 3i\n> class(c2)\n[1] \"complex\"\n```\n\n### 6. 原型(Raw)\n\n`R` 语言还有一种不太常见的基本数据类型，叫原型(`raw`)。`raw` 类型是直接使用其二进制内容来进行保存和使用的类型。\n\n```R\n> v <- charToRaw(\"Hello\")\n> class(v)\n[1] \"raw\"\n> v\n[1] 48 65 6c 6c 6f\n```\n\n### 如何判断变量的类型\n\n当我们拿到一个变量之后，如何判断它的数据类型呢？上面的例子中，其实已经有所提及，使用 `class()` 函数可以简单方便的查看变量的类型，但还有更简单的方式，为了判断某个变量`x` 保存的基本类型，可以用 `is.xxx()` 类函数，如`is.integer(x)`, `is.double(x)`, `is.numeric(x)`, `is.logical(x)`, `is.character(x)`, `is.complex(x)`, `is.raw(x)`。 其中 `is.numeric(x)` 对 `integer` 和 `double` 内容都返回真值。\n\n```R\n> is.character(s)\n[1] TRUE\n> is.character(v)\n[1] FALSE\n> is.raw(v)\n[1] TRUE\n> is.integer(i)\n[1] TRUE\n> is.numeric(i)\n[1] TRUE\n> is.complex(c1)\n[1] TRUE\n> is.integer(c1)\n[1] FALSE\n```\n\n## 小结\n\n至此，本篇就告一段落了，相信通过本篇的学习，对 `R` 语言的基本数据类型能有一个整体的掌握，别忘了回顾一下之前的问题，这些你都了解了吗：\n\n1. `R` 语言有哪些基本操作\n2. 什么是变量，以及如何给变量赋值\n3. `R` 语言有哪些基本数据类型，如何确定变量的数据类型\n\n之后的篇章中，将会继续介绍 `R` 语言的各方各面，让 `R` 语言能为我们的数据分析提供更强力的支持！","slug":"data-analysis/r-study-basic-type","published":1,"updated":"2020-11-28T00:54:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfb6000a5ohu5zhzbo4j","content":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>在前一篇中，我们介绍了 <code>R</code> 语言和 <code>R Studio</code> 的安装，并简单的介绍了一个示例，接下来让我们由浅入深的学习 <code>R</code> 语言的相关知识。</p>\n<p>本篇将主要介绍 <code>R</code> 语言的基本操作、变量和几种基本数据类型，好对 <code>R</code> 语言的使用方法有一个基本的概念。通过本篇的学习，你将了解到：</p>\n<ol>\n<li><code>R</code> 语言有哪些基本操作</li>\n<li>什么是变量，以及如何给变量赋值</li>\n<li><code>R</code> 语言有哪些基本数据类型，如何确定变量的数据类型</li>\n</ol>\n<h2 id=\"R-语言的基本操作\"><a href=\"#R-语言的基本操作\" class=\"headerlink\" title=\"R 语言的基本操作\"></a>R 语言的基本操作</h2><p><code>R</code> 语言的默认提示符是 <code>&gt;</code> ，它表示正在等待输入命令，每次输入命令后敲击回车即可执行当前命令。</p>\n<p><img src=\"1.png\" alt=\"\"></p>\n<p><code>R</code> 语言支持的基本操作主要有加、减、乘、除、取余和幂运算，对应的运算符分别为：+、-、*、/、%%、^。</p>\n<p>加减乘除就不必多说了，但有一点需要提一下，跟许多语言不一样的是，<code>R</code> 语言中，除法运算得到的不是整数部分，而是包含小数部分的结果。</p>\n<pre class=\" language-R\"><code class=\"language-R\">> 9/2\n[1] 4.5\n> 9/4\n[1] 2.25\n> 11/3\n[1] 3.666667</code></pre>\n<p>取余运算的含义是计算整除后的余数：</p>\n<pre class=\" language-R\"><code class=\"language-R\">> 9 %% 2\n[1] 1\n> 9 %% 4\n[1] 1\n> 9 %% 3\n[1] 0\n> 11 % 4\n错误: unexpected input in \"11 % 4\"</code></pre>\n<p>在使用时需要注意的是有两个百分号组成，输入错误则会得上上述错误提示。</p>\n<p>幂运算跟数学中的幂运算含义一致，<code>2^3</code> 代表的是2的3次幂：</p>\n<pre class=\" language-R\"><code class=\"language-R\">> 2 ^ 3\n[1] 8\n> 3 ^ 2\n[1] 9\n> 2 ^ 10\n[1] 1024\n> 2 ^ 100\n[1] 1.267651e+30</code></pre>\n<h2 id=\"R-语言中的变量\"><a href=\"#R-语言中的变量\" class=\"headerlink\" title=\"R 语言中的变量\"></a>R 语言中的变量</h2><p>在使用 <code>R</code> 语言时，我们通常很难一步到位得到最终的结果，需要进行一些复杂的计算。这时我们便需要使用变量来存放计算得到的中间结果。</p>\n<p><code>R</code> 语言中，可以将变量想象成一个盒子，我们可以将任何数据暂存到这个盒子里，但同一时刻，这个盒子只能保存一个数据，如果被多次赋值，则只会保存最后一次放入的数据。</p>\n<p><code>R</code> 语言中的赋值符号是 <code>-&gt;</code>，虽然也可以使用 <code>=</code> 进行赋值，但强烈建议不要这样做，这样不仅显得不专业，而且在一些情况下会出现问题。</p>\n<pre class=\" language-R\"><code class=\"language-R\">> x <- 3\n> x <- 4\n> x <- 9\n> x\n[1] 9</code></pre>\n<p><code>R</code> 语言中的变量不需要事先声明，直接使用即可。如果使用了一个之前没有出现过的变量，则会创建一个新的变量。<code>R</code> 语言中变量是区分大小写的，<code>x</code> 与 <code>X</code> 是两个不同的变量。</p>\n<pre class=\" language-R\"><code class=\"language-R\">> X\n错误: 找不到对象'X'\n> X <- 1\n> X <- 3\n> X\n[1] 3\n> x\n[1] 9</code></pre>\n<p>变量都是有名字的，比如<code>x</code>、<code>y</code>、<code>stu_score</code>，变量的命名必须满足以下规则：</p>\n<ol>\n<li>只能使用字母（区分大小写）、数字、“_”（下划线）、“.”（英文句号），不能有中文、空格和其它特殊字符存在</li>\n<li>不能以数字、下划线开头，开头必须是英文字母或者点</li>\n<li>可以以点号开头，但点号后面的符号不能是数字</li>\n</ol>\n<p>在 <code>R</code> 语言中，如果非要搞一些骚操作，用一些奇怪的变量名，也不是不可以，需要用反引号来包裹。</p>\n<pre class=\" language-R\"><code class=\"language-R\">> `* 90` <- 10\n> `* 90`\n[1] 10\n> `变量` <- 20\n> `变量`\n[1] 20</code></pre>\n<p>当然，不建议这样做，变量取名最好简单且有意义，这样可以减少与其他人的沟通成本以及日后的理解成本。</p>\n<h2 id=\"R-语言中的基本数据类型\"><a href=\"#R-语言中的基本数据类型\" class=\"headerlink\" title=\"R 语言中的基本数据类型\"></a>R 语言中的基本数据类型</h2><p><code>R</code> 语言中主要数据类型有：向量、列表、矩阵、因子、数据框、数组。这些会在后面的文章中进行介绍，本篇只介绍基本的几种数据类型。</p>\n<h3 id=\"1-逻辑型-logical\"><a href=\"#1-逻辑型-logical\" class=\"headerlink\" title=\"1. 逻辑型(logical)\"></a>1. 逻辑型(logical)</h3><p>逻辑型数据有两种可能的值，<code>TRUE</code> 或 <code>FALSE</code> 。</p>\n<pre class=\" language-R\"><code class=\"language-R\">> v <- TRUE\n> class(v)\n[1] \"logical\"\n> y <- FALSE\n> class(v)\n[1] \"logical\"\n> y <- false\n错误: 找不到对象'false'</code></pre>\n<p><code>class</code> 函数可以获取变量的类型信息，可以看到，变量 <code>v</code> 和 <code>y</code> 都是 <code>logical</code> 类型。需要注意的是 <code>TRUE</code> 和 <code>FALSE</code> 必须全部大写，否则会出现上面的错误提示。</p>\n<h3 id=\"2-数值型-numeric\"><a href=\"#2-数值型-numeric\" class=\"headerlink\" title=\"2. 数值型(numeric)\"></a>2. 数值型(numeric)</h3><p><code>R</code> 语言中数字的默认类型为数值型，在运算时需要注意其精度问题，当整数部分大于等于7位时，将舍弃小数部分，当整数部分小于7位时，与小数部分一起最多保留7位数字。</p>\n<pre class=\" language-R\"><code class=\"language-R\">> i <- 10\n> class(i)\n[1] \"numeric\"\n> j <- 11.1\n> class(j)\n[1] \"numeric\"\n> k <- 1.1234567890\n> class(k)\n[1] \"numeric\"\n> k\n[1] 1.123457\n> k <- 123456789.123456789\n> k\n[1] 123456789\n> k <- 1234567.123456789\n> k\n[1] 1234567\n> k <- 123456.123456789\n> k\n[1] 123456.1</code></pre>\n<h3 id=\"3-整数型-integer\"><a href=\"#3-整数型-integer\" class=\"headerlink\" title=\"3. 整数型(integer)\"></a>3. 整数型(integer)</h3><p><code>R</code> 语言中，整数型需要使用数字+L来表示，如：<code>2L</code>、<code>11L</code>、<code>-10L</code>。</p>\n<pre class=\" language-R\"><code class=\"language-R\">> i <- 1L\n> class(i)\n[1] \"integer\"\n> j <- 22L\n> class(j)\n[1] \"integer\"\n> k <- -10L\n> class(k)\n[1] \"integer\"</code></pre>\n<h3 id=\"4-字符型-character\"><a href=\"#4-字符型-character\" class=\"headerlink\" title=\"4. 字符型(character)\"></a>4. 字符型(character)</h3><p><code>R</code> 语言中字符型即字符串类型，通常为用单引号或双引号包围的字符串。</p>\n<pre class=\" language-R\"><code class=\"language-R\">> name <- \"Frank\"\n> class(name)\n[1] \"character\"\n> doc_name <- \"study.mp4\"\n> class(doc_name)\n[1] \"character\"</code></pre>\n<h3 id=\"5-复数型-Complex\"><a href=\"#5-复数型-Complex\" class=\"headerlink\" title=\"5. 复数型(Complex)\"></a>5. 复数型(Complex)</h3><p><code>R</code> 语言是支持复数计算的，复数也是 <code>R</code> 语言的基本类型之一。</p>\n<pre class=\" language-R\"><code class=\"language-R\">> c1 <- 3 + 2i\n> class(c1)\n[1] \"complex\"\n> c2 <-6 - 3i\n> class(c2)\n[1] \"complex\"</code></pre>\n<h3 id=\"6-原型-Raw\"><a href=\"#6-原型-Raw\" class=\"headerlink\" title=\"6. 原型(Raw)\"></a>6. 原型(Raw)</h3><p><code>R</code> 语言还有一种不太常见的基本数据类型，叫原型(<code>raw</code>)。<code>raw</code> 类型是直接使用其二进制内容来进行保存和使用的类型。</p>\n<pre class=\" language-R\"><code class=\"language-R\">> v <- charToRaw(\"Hello\")\n> class(v)\n[1] \"raw\"\n> v\n[1] 48 65 6c 6c 6f</code></pre>\n<h3 id=\"如何判断变量的类型\"><a href=\"#如何判断变量的类型\" class=\"headerlink\" title=\"如何判断变量的类型\"></a>如何判断变量的类型</h3><p>当我们拿到一个变量之后，如何判断它的数据类型呢？上面的例子中，其实已经有所提及，使用 <code>class()</code> 函数可以简单方便的查看变量的类型，但还有更简单的方式，为了判断某个变量<code>x</code> 保存的基本类型，可以用 <code>is.xxx()</code> 类函数，如<code>is.integer(x)</code>, <code>is.double(x)</code>, <code>is.numeric(x)</code>, <code>is.logical(x)</code>, <code>is.character(x)</code>, <code>is.complex(x)</code>, <code>is.raw(x)</code>。 其中 <code>is.numeric(x)</code> 对 <code>integer</code> 和 <code>double</code> 内容都返回真值。</p>\n<pre class=\" language-R\"><code class=\"language-R\">> is.character(s)\n[1] TRUE\n> is.character(v)\n[1] FALSE\n> is.raw(v)\n[1] TRUE\n> is.integer(i)\n[1] TRUE\n> is.numeric(i)\n[1] TRUE\n> is.complex(c1)\n[1] TRUE\n> is.integer(c1)\n[1] FALSE</code></pre>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>至此，本篇就告一段落了，相信通过本篇的学习，对 <code>R</code> 语言的基本数据类型能有一个整体的掌握，别忘了回顾一下之前的问题，这些你都了解了吗：</p>\n<ol>\n<li><code>R</code> 语言有哪些基本操作</li>\n<li>什么是变量，以及如何给变量赋值</li>\n<li><code>R</code> 语言有哪些基本数据类型，如何确定变量的数据类型</li>\n</ol>\n<p>之后的篇章中，将会继续介绍 <code>R</code> 语言的各方各面，让 <code>R</code> 语言能为我们的数据分析提供更强力的支持！</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>在前一篇中，我们介绍了 <code>R</code> 语言和 <code>R Studio</code> 的安装，并简单的介绍了一个示例，接下来让我们由浅入深的学习 <code>R</code> 语言的相关知识。</p>\n<p>本篇将主要介绍 <code>R</code> 语言的基本操作、变量和几种基本数据类型，好对 <code>R</code> 语言的使用方法有一个基本的概念。通过本篇的学习，你将了解到：</p>\n<ol>\n<li><code>R</code> 语言有哪些基本操作</li>\n<li>什么是变量，以及如何给变量赋值</li>\n<li><code>R</code> 语言有哪些基本数据类型，如何确定变量的数据类型</li>\n</ol>\n<h2 id=\"R-语言的基本操作\"><a href=\"#R-语言的基本操作\" class=\"headerlink\" title=\"R 语言的基本操作\"></a>R 语言的基本操作</h2><p><code>R</code> 语言的默认提示符是 <code>&gt;</code> ，它表示正在等待输入命令，每次输入命令后敲击回车即可执行当前命令。</p>\n<p><img src=\"1.png\" alt=\"\"></p>\n<p><code>R</code> 语言支持的基本操作主要有加、减、乘、除、取余和幂运算，对应的运算符分别为：+、-、*、/、%%、^。</p>\n<p>加减乘除就不必多说了，但有一点需要提一下，跟许多语言不一样的是，<code>R</code> 语言中，除法运算得到的不是整数部分，而是包含小数部分的结果。</p>\n<pre><code class=\"R\">&gt; 9/2\n[1] 4.5\n&gt; 9/4\n[1] 2.25\n&gt; 11/3\n[1] 3.666667</code></pre>\n<p>取余运算的含义是计算整除后的余数：</p>\n<pre><code class=\"R\">&gt; 9 %% 2\n[1] 1\n&gt; 9 %% 4\n[1] 1\n&gt; 9 %% 3\n[1] 0\n&gt; 11 % 4\n错误: unexpected input in &quot;11 % 4&quot;</code></pre>\n<p>在使用时需要注意的是有两个百分号组成，输入错误则会得上上述错误提示。</p>\n<p>幂运算跟数学中的幂运算含义一致，<code>2^3</code> 代表的是2的3次幂：</p>\n<pre><code class=\"R\">&gt; 2 ^ 3\n[1] 8\n&gt; 3 ^ 2\n[1] 9\n&gt; 2 ^ 10\n[1] 1024\n&gt; 2 ^ 100\n[1] 1.267651e+30</code></pre>\n<h2 id=\"R-语言中的变量\"><a href=\"#R-语言中的变量\" class=\"headerlink\" title=\"R 语言中的变量\"></a>R 语言中的变量</h2><p>在使用 <code>R</code> 语言时，我们通常很难一步到位得到最终的结果，需要进行一些复杂的计算。这时我们便需要使用变量来存放计算得到的中间结果。</p>\n<p><code>R</code> 语言中，可以将变量想象成一个盒子，我们可以将任何数据暂存到这个盒子里，但同一时刻，这个盒子只能保存一个数据，如果被多次赋值，则只会保存最后一次放入的数据。</p>\n<p><code>R</code> 语言中的赋值符号是 <code>-&gt;</code>，虽然也可以使用 <code>=</code> 进行赋值，但强烈建议不要这样做，这样不仅显得不专业，而且在一些情况下会出现问题。</p>\n<pre><code class=\"R\">&gt; x &lt;- 3\n&gt; x &lt;- 4\n&gt; x &lt;- 9\n&gt; x\n[1] 9</code></pre>\n<p><code>R</code> 语言中的变量不需要事先声明，直接使用即可。如果使用了一个之前没有出现过的变量，则会创建一个新的变量。<code>R</code> 语言中变量是区分大小写的，<code>x</code> 与 <code>X</code> 是两个不同的变量。</p>\n<pre><code class=\"R\">&gt; X\n错误: 找不到对象&#39;X&#39;\n&gt; X &lt;- 1\n&gt; X &lt;- 3\n&gt; X\n[1] 3\n&gt; x\n[1] 9</code></pre>\n<p>变量都是有名字的，比如<code>x</code>、<code>y</code>、<code>stu_score</code>，变量的命名必须满足以下规则：</p>\n<ol>\n<li>只能使用字母（区分大小写）、数字、“_”（下划线）、“.”（英文句号），不能有中文、空格和其它特殊字符存在</li>\n<li>不能以数字、下划线开头，开头必须是英文字母或者点</li>\n<li>可以以点号开头，但点号后面的符号不能是数字</li>\n</ol>\n<p>在 <code>R</code> 语言中，如果非要搞一些骚操作，用一些奇怪的变量名，也不是不可以，需要用反引号来包裹。</p>\n<pre><code class=\"R\">&gt; `* 90` &lt;- 10\n&gt; `* 90`\n[1] 10\n&gt; `变量` &lt;- 20\n&gt; `变量`\n[1] 20</code></pre>\n<p>当然，不建议这样做，变量取名最好简单且有意义，这样可以减少与其他人的沟通成本以及日后的理解成本。</p>\n<h2 id=\"R-语言中的基本数据类型\"><a href=\"#R-语言中的基本数据类型\" class=\"headerlink\" title=\"R 语言中的基本数据类型\"></a>R 语言中的基本数据类型</h2><p><code>R</code> 语言中主要数据类型有：向量、列表、矩阵、因子、数据框、数组。这些会在后面的文章中进行介绍，本篇只介绍基本的几种数据类型。</p>\n<h3 id=\"1-逻辑型-logical\"><a href=\"#1-逻辑型-logical\" class=\"headerlink\" title=\"1. 逻辑型(logical)\"></a>1. 逻辑型(logical)</h3><p>逻辑型数据有两种可能的值，<code>TRUE</code> 或 <code>FALSE</code> 。</p>\n<pre><code class=\"R\">&gt; v &lt;- TRUE\n&gt; class(v)\n[1] &quot;logical&quot;\n&gt; y &lt;- FALSE\n&gt; class(v)\n[1] &quot;logical&quot;\n&gt; y &lt;- false\n错误: 找不到对象&#39;false&#39;</code></pre>\n<p><code>class</code> 函数可以获取变量的类型信息，可以看到，变量 <code>v</code> 和 <code>y</code> 都是 <code>logical</code> 类型。需要注意的是 <code>TRUE</code> 和 <code>FALSE</code> 必须全部大写，否则会出现上面的错误提示。</p>\n<h3 id=\"2-数值型-numeric\"><a href=\"#2-数值型-numeric\" class=\"headerlink\" title=\"2. 数值型(numeric)\"></a>2. 数值型(numeric)</h3><p><code>R</code> 语言中数字的默认类型为数值型，在运算时需要注意其精度问题，当整数部分大于等于7位时，将舍弃小数部分，当整数部分小于7位时，与小数部分一起最多保留7位数字。</p>\n<pre><code class=\"R\">&gt; i &lt;- 10\n&gt; class(i)\n[1] &quot;numeric&quot;\n&gt; j &lt;- 11.1\n&gt; class(j)\n[1] &quot;numeric&quot;\n&gt; k &lt;- 1.1234567890\n&gt; class(k)\n[1] &quot;numeric&quot;\n&gt; k\n[1] 1.123457\n&gt; k &lt;- 123456789.123456789\n&gt; k\n[1] 123456789\n&gt; k &lt;- 1234567.123456789\n&gt; k\n[1] 1234567\n&gt; k &lt;- 123456.123456789\n&gt; k\n[1] 123456.1</code></pre>\n<h3 id=\"3-整数型-integer\"><a href=\"#3-整数型-integer\" class=\"headerlink\" title=\"3. 整数型(integer)\"></a>3. 整数型(integer)</h3><p><code>R</code> 语言中，整数型需要使用数字+L来表示，如：<code>2L</code>、<code>11L</code>、<code>-10L</code>。</p>\n<pre><code class=\"R\">&gt; i &lt;- 1L\n&gt; class(i)\n[1] &quot;integer&quot;\n&gt; j &lt;- 22L\n&gt; class(j)\n[1] &quot;integer&quot;\n&gt; k &lt;- -10L\n&gt; class(k)\n[1] &quot;integer&quot;</code></pre>\n<h3 id=\"4-字符型-character\"><a href=\"#4-字符型-character\" class=\"headerlink\" title=\"4. 字符型(character)\"></a>4. 字符型(character)</h3><p><code>R</code> 语言中字符型即字符串类型，通常为用单引号或双引号包围的字符串。</p>\n<pre><code class=\"R\">&gt; name &lt;- &quot;Frank&quot;\n&gt; class(name)\n[1] &quot;character&quot;\n&gt; doc_name &lt;- &quot;study.mp4&quot;\n&gt; class(doc_name)\n[1] &quot;character&quot;</code></pre>\n<h3 id=\"5-复数型-Complex\"><a href=\"#5-复数型-Complex\" class=\"headerlink\" title=\"5. 复数型(Complex)\"></a>5. 复数型(Complex)</h3><p><code>R</code> 语言是支持复数计算的，复数也是 <code>R</code> 语言的基本类型之一。</p>\n<pre><code class=\"R\">&gt; c1 &lt;- 3 + 2i\n&gt; class(c1)\n[1] &quot;complex&quot;\n&gt; c2 &lt;-6 - 3i\n&gt; class(c2)\n[1] &quot;complex&quot;</code></pre>\n<h3 id=\"6-原型-Raw\"><a href=\"#6-原型-Raw\" class=\"headerlink\" title=\"6. 原型(Raw)\"></a>6. 原型(Raw)</h3><p><code>R</code> 语言还有一种不太常见的基本数据类型，叫原型(<code>raw</code>)。<code>raw</code> 类型是直接使用其二进制内容来进行保存和使用的类型。</p>\n<pre><code class=\"R\">&gt; v &lt;- charToRaw(&quot;Hello&quot;)\n&gt; class(v)\n[1] &quot;raw&quot;\n&gt; v\n[1] 48 65 6c 6c 6f</code></pre>\n<h3 id=\"如何判断变量的类型\"><a href=\"#如何判断变量的类型\" class=\"headerlink\" title=\"如何判断变量的类型\"></a>如何判断变量的类型</h3><p>当我们拿到一个变量之后，如何判断它的数据类型呢？上面的例子中，其实已经有所提及，使用 <code>class()</code> 函数可以简单方便的查看变量的类型，但还有更简单的方式，为了判断某个变量<code>x</code> 保存的基本类型，可以用 <code>is.xxx()</code> 类函数，如<code>is.integer(x)</code>, <code>is.double(x)</code>, <code>is.numeric(x)</code>, <code>is.logical(x)</code>, <code>is.character(x)</code>, <code>is.complex(x)</code>, <code>is.raw(x)</code>。 其中 <code>is.numeric(x)</code> 对 <code>integer</code> 和 <code>double</code> 内容都返回真值。</p>\n<pre><code class=\"R\">&gt; is.character(s)\n[1] TRUE\n&gt; is.character(v)\n[1] FALSE\n&gt; is.raw(v)\n[1] TRUE\n&gt; is.integer(i)\n[1] TRUE\n&gt; is.numeric(i)\n[1] TRUE\n&gt; is.complex(c1)\n[1] TRUE\n&gt; is.integer(c1)\n[1] FALSE</code></pre>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>至此，本篇就告一段落了，相信通过本篇的学习，对 <code>R</code> 语言的基本数据类型能有一个整体的掌握，别忘了回顾一下之前的问题，这些你都了解了吗：</p>\n<ol>\n<li><code>R</code> 语言有哪些基本操作</li>\n<li>什么是变量，以及如何给变量赋值</li>\n<li><code>R</code> 语言有哪些基本数据类型，如何确定变量的数据类型</li>\n</ol>\n<p>之后的篇章中，将会继续介绍 <code>R</code> 语言的各方各面，让 <code>R</code> 语言能为我们的数据分析提供更强力的支持！</p>\n"},{"title":"【R语言入门】R语言环境搭建","toc":true,"date":"2020-11-28T00:47:35.000Z","_content":"\n## 说明\n\n`R` 语言是一个功能十分强大的工具，几乎绝大多数的数据分析工作都可以在 `R` 中完成，并且拥有很极强的绘图功能支持，能让你手中的数据以各种姿势进行可视化呈现，而且支持 `Windows`、`Mac OS`、`Linux` 系统，而且使用起来也比较简单方便。\n\n如果想要开始学习数据分析，或者仅仅是想做出狂拽炫酷屌的数据分析图，那么 `R` 语言会是个不错的选择。\n\n## R 下载与安装\n\n打开 `https://cran.r-project.org/mirrors.html` ，根据自己所在的位置选择对应的镜像站，通常选择 `China` 下的镜像站。\n\n![](2.png)\n\n根据自己使用的平台，选择对应安装包进行下载安装即可。\n\n如果是 `Windows` 选择 `base` 版本进行下载安装即可。安装过程全部选择默认选项即可。\n\n![](3.png)\n![](4.png)\n![](5.png)\n\n如果用的是 `Mac` ，则选择 `Download R for (Mac) OS X`，下载最新版本的安装包后进行默认安装即可。\n\n![](6.png)\n\n安装完成之后，你将会看到一个朴实无华的图标，没错，这就是 `R` 语言本尊了。\n\n![](7.png)\n\n## R studio 下载与安装\n\n打开 `https://www.rstudio.com/products/rstudio/download/` ，选择 `Free` 版本进行下载。\n\n![](8.png)\n\n这里会根据你所在平台显示对应的下载链接，点击下载即可。\n\n![](9.png)\n\n安装时，除了安装位置，其余均选择默认选项即可。\n\n安装好之后，你又能收获一个新图标，这次要更加圆润一点。\n\n![](10.png)\n\n## R 语言简单实例\n\n主要工作已经完成，让我们动动小手，优雅的单击（或双击）`R Studio` 图标，来感受一下R 语言的魅力。\n\n打开 `RStudio`，会在 `Consule` 面板看到 `R` 语言的版本、版权信息和一些有用的提示。\n\n```\nR version 4.0.3 (2020-10-10) -- \"Bunny-Wunnies Freak Out\"\nCopyright (C) 2020 The R Foundation for Statistical Computing\nPlatform: x86_64-apple-darwin17.0 (64-bit)\n\nR是自由软件，不带任何担保。\n在某些条件下你可以将其自由散布。\n用'license()'或'licence()'来看散布的详细条件。\n\nR是个合作计划，有许多人为之做出了贡献.\n用'contributors()'来看合作者的详细情况\n用'citation()'会告诉你如何在出版物中正确地引用R或R程序包。\n\n用'demo()'来看一些示范程序，用'help()'来阅读在线帮助文件，或\n用'help.start()'通过HTML浏览器来看帮助文件。\n用'q()'退出R.\n```\n\n整体界面如下图：\n\n![](11.png)\n\n在 `consule` 面板中输入：`example(plot)`，轻轻敲击几次回车，就能看到 `plot` 函数的一些实例了。\n\n```R\n> example(plot)\n\nplot> Speed <- cars$speed\n\nplot> Distance <- cars$dist\n\nplot> plot(Speed, Distance, panel.first = grid(8, 8),\nplot+      pch = 0, cex = 1.2, col = \"blue\")\n按<Return>键来看下一个图: \n\nplot> plot(Speed, Distance,\nplot+      panel.first = lines(stats::lowess(Speed, Distance), lty = \"dashed\"),\nplot+      pch = 0, cex = 1.2, col = \"blue\")\n按<Return>键来看下一个图: \n\nplot> ## Show the different plot types\nplot> x <- 0:12\n\nplot> y <- sin(pi/5 * x)\n\nplot> op <- par(mfrow = c(3,3), mar = .1+ c(2,2,3,1))\n\nplot> for (tp in c(\"p\",\"l\",\"b\",  \"c\",\"o\",\"h\",  \"s\",\"S\",\"n\")) {\nplot+    plot(y ~ x, type = tp, main = paste0(\"plot(*, type = \\\"\", tp, \"\\\")\"))\nplot+    if(tp == \"S\") {\nplot+       lines(x, y, type = \"s\", col = \"red\", lty = 2)\nplot+       mtext(\"lines(*, type = \\\"s\\\", ...)\", col = \"red\", cex = 0.8)\nplot+    }\nplot+ }\n按<Return>键来看下一个图: \n\nplot> par(op)\n\nplot> ##--- Log-Log Plot  with  custom axes\nplot> lx <- seq(1, 5, length = 41)\n\nplot> yl <- expression(e^{-frac(1,2) * {log[10](x)}^2})\n\nplot> y <- exp(-.5*lx^2)\n\nplot> op <- par(mfrow = c(2,1), mar = par(\"mar\")-c(1,0,2,0), mgp = c(2, .7, 0))\n\nplot> plot(10^lx, y, log = \"xy\", type = \"l\", col = \"purple\",\nplot+      main = \"Log-Log plot\", ylab = yl, xlab = \"x\")\n按<Return>键来看下一个图: \n\nplot> plot(10^lx, y, log = \"xy\", type = \"o\", pch = \".\", col = \"forestgreen\",\nplot+      main = \"Log-Log plot with custom axes\", ylab = yl, xlab = \"x\",\nplot+      axes = FALSE, frame.plot = TRUE)\n\nplot> my.at <- 10^(1:5)\n\nplot> axis(1, at = my.at, labels = formatC(my.at, format = \"fg\"))\n\nplot> e.y <- -5:-1 ; at.y <- 10^e.y\n\nplot> axis(2, at = at.y, col.axis = \"red\", las = 1,\nplot+      labels = as.expression(lapply(e.y, function(E) bquote(10^.(E)))))\n\nplot> par(op)\n> \n```\n\n下面是输出的图片：\n\n![](12.png)\n![](13.png)\n![](14.png)\n![](15.png)\n\n这是基础绘图函数 `plot` 的几个示例，可以看出它能支持的图形已经有许多了，后面会有专门的文章来介绍 `plot` 函数的详细使用方法。\n\n## 小结\n\n到此为止，`R` 语言就已经顺利的收入囊中了，恭喜你，又掌握了一门语言（的 `Hello world`）了。【此处应有掌声】\n\n接下来，会继续介绍 `R` 语言的基本用法和其中比较重要的函数使用方法，目标是能使用 `R` 语言对数据进行初步分析，以便能在生活和工作之中有所应用。\n\n之所以开始写 `R` 语言相关的文章，是因为在工作中察觉到了数据的重要性，虽说应该让专业的人来做专业的事情，但如果对此一无所知，又怎么知道专业的人能够做什么事情呢，何况如果一点点小事情就要找数据的同学提需求未免不太合适，自己先有头绪和初步验证后也许会更有效率。而且技多不压身嘛。加之在大学时就对数据分析感兴趣，也曾经学过 `R` 语言，现在算是重温和复习吧。\n\n","source":"_posts/data-analysis/r-study-install.md","raw":"---\ntitle: 【R语言入门】R语言环境搭建\ntags:\n  - R\ncategories:\n  - 编程\n  - 数据分析\ntoc: true\ndate: 2020-11-28 08:47:35\n---\n\n## 说明\n\n`R` 语言是一个功能十分强大的工具，几乎绝大多数的数据分析工作都可以在 `R` 中完成，并且拥有很极强的绘图功能支持，能让你手中的数据以各种姿势进行可视化呈现，而且支持 `Windows`、`Mac OS`、`Linux` 系统，而且使用起来也比较简单方便。\n\n如果想要开始学习数据分析，或者仅仅是想做出狂拽炫酷屌的数据分析图，那么 `R` 语言会是个不错的选择。\n\n## R 下载与安装\n\n打开 `https://cran.r-project.org/mirrors.html` ，根据自己所在的位置选择对应的镜像站，通常选择 `China` 下的镜像站。\n\n![](2.png)\n\n根据自己使用的平台，选择对应安装包进行下载安装即可。\n\n如果是 `Windows` 选择 `base` 版本进行下载安装即可。安装过程全部选择默认选项即可。\n\n![](3.png)\n![](4.png)\n![](5.png)\n\n如果用的是 `Mac` ，则选择 `Download R for (Mac) OS X`，下载最新版本的安装包后进行默认安装即可。\n\n![](6.png)\n\n安装完成之后，你将会看到一个朴实无华的图标，没错，这就是 `R` 语言本尊了。\n\n![](7.png)\n\n## R studio 下载与安装\n\n打开 `https://www.rstudio.com/products/rstudio/download/` ，选择 `Free` 版本进行下载。\n\n![](8.png)\n\n这里会根据你所在平台显示对应的下载链接，点击下载即可。\n\n![](9.png)\n\n安装时，除了安装位置，其余均选择默认选项即可。\n\n安装好之后，你又能收获一个新图标，这次要更加圆润一点。\n\n![](10.png)\n\n## R 语言简单实例\n\n主要工作已经完成，让我们动动小手，优雅的单击（或双击）`R Studio` 图标，来感受一下R 语言的魅力。\n\n打开 `RStudio`，会在 `Consule` 面板看到 `R` 语言的版本、版权信息和一些有用的提示。\n\n```\nR version 4.0.3 (2020-10-10) -- \"Bunny-Wunnies Freak Out\"\nCopyright (C) 2020 The R Foundation for Statistical Computing\nPlatform: x86_64-apple-darwin17.0 (64-bit)\n\nR是自由软件，不带任何担保。\n在某些条件下你可以将其自由散布。\n用'license()'或'licence()'来看散布的详细条件。\n\nR是个合作计划，有许多人为之做出了贡献.\n用'contributors()'来看合作者的详细情况\n用'citation()'会告诉你如何在出版物中正确地引用R或R程序包。\n\n用'demo()'来看一些示范程序，用'help()'来阅读在线帮助文件，或\n用'help.start()'通过HTML浏览器来看帮助文件。\n用'q()'退出R.\n```\n\n整体界面如下图：\n\n![](11.png)\n\n在 `consule` 面板中输入：`example(plot)`，轻轻敲击几次回车，就能看到 `plot` 函数的一些实例了。\n\n```R\n> example(plot)\n\nplot> Speed <- cars$speed\n\nplot> Distance <- cars$dist\n\nplot> plot(Speed, Distance, panel.first = grid(8, 8),\nplot+      pch = 0, cex = 1.2, col = \"blue\")\n按<Return>键来看下一个图: \n\nplot> plot(Speed, Distance,\nplot+      panel.first = lines(stats::lowess(Speed, Distance), lty = \"dashed\"),\nplot+      pch = 0, cex = 1.2, col = \"blue\")\n按<Return>键来看下一个图: \n\nplot> ## Show the different plot types\nplot> x <- 0:12\n\nplot> y <- sin(pi/5 * x)\n\nplot> op <- par(mfrow = c(3,3), mar = .1+ c(2,2,3,1))\n\nplot> for (tp in c(\"p\",\"l\",\"b\",  \"c\",\"o\",\"h\",  \"s\",\"S\",\"n\")) {\nplot+    plot(y ~ x, type = tp, main = paste0(\"plot(*, type = \\\"\", tp, \"\\\")\"))\nplot+    if(tp == \"S\") {\nplot+       lines(x, y, type = \"s\", col = \"red\", lty = 2)\nplot+       mtext(\"lines(*, type = \\\"s\\\", ...)\", col = \"red\", cex = 0.8)\nplot+    }\nplot+ }\n按<Return>键来看下一个图: \n\nplot> par(op)\n\nplot> ##--- Log-Log Plot  with  custom axes\nplot> lx <- seq(1, 5, length = 41)\n\nplot> yl <- expression(e^{-frac(1,2) * {log[10](x)}^2})\n\nplot> y <- exp(-.5*lx^2)\n\nplot> op <- par(mfrow = c(2,1), mar = par(\"mar\")-c(1,0,2,0), mgp = c(2, .7, 0))\n\nplot> plot(10^lx, y, log = \"xy\", type = \"l\", col = \"purple\",\nplot+      main = \"Log-Log plot\", ylab = yl, xlab = \"x\")\n按<Return>键来看下一个图: \n\nplot> plot(10^lx, y, log = \"xy\", type = \"o\", pch = \".\", col = \"forestgreen\",\nplot+      main = \"Log-Log plot with custom axes\", ylab = yl, xlab = \"x\",\nplot+      axes = FALSE, frame.plot = TRUE)\n\nplot> my.at <- 10^(1:5)\n\nplot> axis(1, at = my.at, labels = formatC(my.at, format = \"fg\"))\n\nplot> e.y <- -5:-1 ; at.y <- 10^e.y\n\nplot> axis(2, at = at.y, col.axis = \"red\", las = 1,\nplot+      labels = as.expression(lapply(e.y, function(E) bquote(10^.(E)))))\n\nplot> par(op)\n> \n```\n\n下面是输出的图片：\n\n![](12.png)\n![](13.png)\n![](14.png)\n![](15.png)\n\n这是基础绘图函数 `plot` 的几个示例，可以看出它能支持的图形已经有许多了，后面会有专门的文章来介绍 `plot` 函数的详细使用方法。\n\n## 小结\n\n到此为止，`R` 语言就已经顺利的收入囊中了，恭喜你，又掌握了一门语言（的 `Hello world`）了。【此处应有掌声】\n\n接下来，会继续介绍 `R` 语言的基本用法和其中比较重要的函数使用方法，目标是能使用 `R` 语言对数据进行初步分析，以便能在生活和工作之中有所应用。\n\n之所以开始写 `R` 语言相关的文章，是因为在工作中察觉到了数据的重要性，虽说应该让专业的人来做专业的事情，但如果对此一无所知，又怎么知道专业的人能够做什么事情呢，何况如果一点点小事情就要找数据的同学提需求未免不太合适，自己先有头绪和初步验证后也许会更有效率。而且技多不压身嘛。加之在大学时就对数据分析感兴趣，也曾经学过 `R` 语言，现在算是重温和复习吧。\n\n","slug":"data-analysis/r-study-install","published":1,"updated":"2020-11-28T00:47:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfb7000b5ohuhon4f38o","content":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p><code>R</code> 语言是一个功能十分强大的工具，几乎绝大多数的数据分析工作都可以在 <code>R</code> 中完成，并且拥有很极强的绘图功能支持，能让你手中的数据以各种姿势进行可视化呈现，而且支持 <code>Windows</code>、<code>Mac OS</code>、<code>Linux</code> 系统，而且使用起来也比较简单方便。</p>\n<p>如果想要开始学习数据分析，或者仅仅是想做出狂拽炫酷屌的数据分析图，那么 <code>R</code> 语言会是个不错的选择。</p>\n<h2 id=\"R-下载与安装\"><a href=\"#R-下载与安装\" class=\"headerlink\" title=\"R 下载与安装\"></a>R 下载与安装</h2><p>打开 <code>https://cran.r-project.org/mirrors.html</code> ，根据自己所在的位置选择对应的镜像站，通常选择 <code>China</code> 下的镜像站。</p>\n<p><img src=\"2.png\" alt=\"\"></p>\n<p>根据自己使用的平台，选择对应安装包进行下载安装即可。</p>\n<p>如果是 <code>Windows</code> 选择 <code>base</code> 版本进行下载安装即可。安装过程全部选择默认选项即可。</p>\n<p><img src=\"3.png\" alt=\"\"><br><img src=\"4.png\" alt=\"\"><br><img src=\"5.png\" alt=\"\"></p>\n<p>如果用的是 <code>Mac</code> ，则选择 <code>Download R for (Mac) OS X</code>，下载最新版本的安装包后进行默认安装即可。</p>\n<p><img src=\"6.png\" alt=\"\"></p>\n<p>安装完成之后，你将会看到一个朴实无华的图标，没错，这就是 <code>R</code> 语言本尊了。</p>\n<p><img src=\"7.png\" alt=\"\"></p>\n<h2 id=\"R-studio-下载与安装\"><a href=\"#R-studio-下载与安装\" class=\"headerlink\" title=\"R studio 下载与安装\"></a>R studio 下载与安装</h2><p>打开 <code>https://www.rstudio.com/products/rstudio/download/</code> ，选择 <code>Free</code> 版本进行下载。</p>\n<p><img src=\"8.png\" alt=\"\"></p>\n<p>这里会根据你所在平台显示对应的下载链接，点击下载即可。</p>\n<p><img src=\"9.png\" alt=\"\"></p>\n<p>安装时，除了安装位置，其余均选择默认选项即可。</p>\n<p>安装好之后，你又能收获一个新图标，这次要更加圆润一点。</p>\n<p><img src=\"10.png\" alt=\"\"></p>\n<h2 id=\"R-语言简单实例\"><a href=\"#R-语言简单实例\" class=\"headerlink\" title=\"R 语言简单实例\"></a>R 语言简单实例</h2><p>主要工作已经完成，让我们动动小手，优雅的单击（或双击）<code>R Studio</code> 图标，来感受一下R 语言的魅力。</p>\n<p>打开 <code>RStudio</code>，会在 <code>Consule</code> 面板看到 <code>R</code> 语言的版本、版权信息和一些有用的提示。</p>\n<pre><code>R version 4.0.3 (2020-10-10) -- \"Bunny-Wunnies Freak Out\"\nCopyright (C) 2020 The R Foundation for Statistical Computing\nPlatform: x86_64-apple-darwin17.0 (64-bit)\n\nR是自由软件，不带任何担保。\n在某些条件下你可以将其自由散布。\n用'license()'或'licence()'来看散布的详细条件。\n\nR是个合作计划，有许多人为之做出了贡献.\n用'contributors()'来看合作者的详细情况\n用'citation()'会告诉你如何在出版物中正确地引用R或R程序包。\n\n用'demo()'来看一些示范程序，用'help()'来阅读在线帮助文件，或\n用'help.start()'通过HTML浏览器来看帮助文件。\n用'q()'退出R.</code></pre><p>整体界面如下图：</p>\n<p><img src=\"11.png\" alt=\"\"></p>\n<p>在 <code>consule</code> 面板中输入：<code>example(plot)</code>，轻轻敲击几次回车，就能看到 <code>plot</code> 函数的一些实例了。</p>\n<pre class=\" language-R\"><code class=\"language-R\">> example(plot)\n\nplot> Speed <- cars$speed\n\nplot> Distance <- cars$dist\n\nplot> plot(Speed, Distance, panel.first = grid(8, 8),\nplot+      pch = 0, cex = 1.2, col = \"blue\")\n按<Return>键来看下一个图: \n\nplot> plot(Speed, Distance,\nplot+      panel.first = lines(stats::lowess(Speed, Distance), lty = \"dashed\"),\nplot+      pch = 0, cex = 1.2, col = \"blue\")\n按<Return>键来看下一个图: \n\nplot> ## Show the different plot types\nplot> x <- 0:12\n\nplot> y <- sin(pi/5 * x)\n\nplot> op <- par(mfrow = c(3,3), mar = .1+ c(2,2,3,1))\n\nplot> for (tp in c(\"p\",\"l\",\"b\",  \"c\",\"o\",\"h\",  \"s\",\"S\",\"n\")) {\nplot+    plot(y ~ x, type = tp, main = paste0(\"plot(*, type = \\\"\", tp, \"\\\")\"))\nplot+    if(tp == \"S\") {\nplot+       lines(x, y, type = \"s\", col = \"red\", lty = 2)\nplot+       mtext(\"lines(*, type = \\\"s\\\", ...)\", col = \"red\", cex = 0.8)\nplot+    }\nplot+ }\n按<Return>键来看下一个图: \n\nplot> par(op)\n\nplot> ##--- Log-Log Plot  with  custom axes\nplot> lx <- seq(1, 5, length = 41)\n\nplot> yl <- expression(e^{-frac(1,2) * {log[10](x)}^2})\n\nplot> y <- exp(-.5*lx^2)\n\nplot> op <- par(mfrow = c(2,1), mar = par(\"mar\")-c(1,0,2,0), mgp = c(2, .7, 0))\n\nplot> plot(10^lx, y, log = \"xy\", type = \"l\", col = \"purple\",\nplot+      main = \"Log-Log plot\", ylab = yl, xlab = \"x\")\n按<Return>键来看下一个图: \n\nplot> plot(10^lx, y, log = \"xy\", type = \"o\", pch = \".\", col = \"forestgreen\",\nplot+      main = \"Log-Log plot with custom axes\", ylab = yl, xlab = \"x\",\nplot+      axes = FALSE, frame.plot = TRUE)\n\nplot> my.at <- 10^(1:5)\n\nplot> axis(1, at = my.at, labels = formatC(my.at, format = \"fg\"))\n\nplot> e.y <- -5:-1 ; at.y <- 10^e.y\n\nplot> axis(2, at = at.y, col.axis = \"red\", las = 1,\nplot+      labels = as.expression(lapply(e.y, function(E) bquote(10^.(E)))))\n\nplot> par(op)\n> </code></pre>\n<p>下面是输出的图片：</p>\n<p><img src=\"12.png\" alt=\"\"><br><img src=\"13.png\" alt=\"\"><br><img src=\"14.png\" alt=\"\"><br><img src=\"15.png\" alt=\"\"></p>\n<p>这是基础绘图函数 <code>plot</code> 的几个示例，可以看出它能支持的图形已经有许多了，后面会有专门的文章来介绍 <code>plot</code> 函数的详细使用方法。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>到此为止，<code>R</code> 语言就已经顺利的收入囊中了，恭喜你，又掌握了一门语言（的 <code>Hello world</code>）了。【此处应有掌声】</p>\n<p>接下来，会继续介绍 <code>R</code> 语言的基本用法和其中比较重要的函数使用方法，目标是能使用 <code>R</code> 语言对数据进行初步分析，以便能在生活和工作之中有所应用。</p>\n<p>之所以开始写 <code>R</code> 语言相关的文章，是因为在工作中察觉到了数据的重要性，虽说应该让专业的人来做专业的事情，但如果对此一无所知，又怎么知道专业的人能够做什么事情呢，何况如果一点点小事情就要找数据的同学提需求未免不太合适，自己先有头绪和初步验证后也许会更有效率。而且技多不压身嘛。加之在大学时就对数据分析感兴趣，也曾经学过 <code>R</code> 语言，现在算是重温和复习吧。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p><code>R</code> 语言是一个功能十分强大的工具，几乎绝大多数的数据分析工作都可以在 <code>R</code> 中完成，并且拥有很极强的绘图功能支持，能让你手中的数据以各种姿势进行可视化呈现，而且支持 <code>Windows</code>、<code>Mac OS</code>、<code>Linux</code> 系统，而且使用起来也比较简单方便。</p>\n<p>如果想要开始学习数据分析，或者仅仅是想做出狂拽炫酷屌的数据分析图，那么 <code>R</code> 语言会是个不错的选择。</p>\n<h2 id=\"R-下载与安装\"><a href=\"#R-下载与安装\" class=\"headerlink\" title=\"R 下载与安装\"></a>R 下载与安装</h2><p>打开 <code>https://cran.r-project.org/mirrors.html</code> ，根据自己所在的位置选择对应的镜像站，通常选择 <code>China</code> 下的镜像站。</p>\n<p><img src=\"2.png\" alt=\"\"></p>\n<p>根据自己使用的平台，选择对应安装包进行下载安装即可。</p>\n<p>如果是 <code>Windows</code> 选择 <code>base</code> 版本进行下载安装即可。安装过程全部选择默认选项即可。</p>\n<p><img src=\"3.png\" alt=\"\"><br><img src=\"4.png\" alt=\"\"><br><img src=\"5.png\" alt=\"\"></p>\n<p>如果用的是 <code>Mac</code> ，则选择 <code>Download R for (Mac) OS X</code>，下载最新版本的安装包后进行默认安装即可。</p>\n<p><img src=\"6.png\" alt=\"\"></p>\n<p>安装完成之后，你将会看到一个朴实无华的图标，没错，这就是 <code>R</code> 语言本尊了。</p>\n<p><img src=\"7.png\" alt=\"\"></p>\n<h2 id=\"R-studio-下载与安装\"><a href=\"#R-studio-下载与安装\" class=\"headerlink\" title=\"R studio 下载与安装\"></a>R studio 下载与安装</h2><p>打开 <code>https://www.rstudio.com/products/rstudio/download/</code> ，选择 <code>Free</code> 版本进行下载。</p>\n<p><img src=\"8.png\" alt=\"\"></p>\n<p>这里会根据你所在平台显示对应的下载链接，点击下载即可。</p>\n<p><img src=\"9.png\" alt=\"\"></p>\n<p>安装时，除了安装位置，其余均选择默认选项即可。</p>\n<p>安装好之后，你又能收获一个新图标，这次要更加圆润一点。</p>\n<p><img src=\"10.png\" alt=\"\"></p>\n<h2 id=\"R-语言简单实例\"><a href=\"#R-语言简单实例\" class=\"headerlink\" title=\"R 语言简单实例\"></a>R 语言简单实例</h2><p>主要工作已经完成，让我们动动小手，优雅的单击（或双击）<code>R Studio</code> 图标，来感受一下R 语言的魅力。</p>\n<p>打开 <code>RStudio</code>，会在 <code>Consule</code> 面板看到 <code>R</code> 语言的版本、版权信息和一些有用的提示。</p>\n<pre><code>R version 4.0.3 (2020-10-10) -- &quot;Bunny-Wunnies Freak Out&quot;\nCopyright (C) 2020 The R Foundation for Statistical Computing\nPlatform: x86_64-apple-darwin17.0 (64-bit)\n\nR是自由软件，不带任何担保。\n在某些条件下你可以将其自由散布。\n用&#39;license()&#39;或&#39;licence()&#39;来看散布的详细条件。\n\nR是个合作计划，有许多人为之做出了贡献.\n用&#39;contributors()&#39;来看合作者的详细情况\n用&#39;citation()&#39;会告诉你如何在出版物中正确地引用R或R程序包。\n\n用&#39;demo()&#39;来看一些示范程序，用&#39;help()&#39;来阅读在线帮助文件，或\n用&#39;help.start()&#39;通过HTML浏览器来看帮助文件。\n用&#39;q()&#39;退出R.</code></pre><p>整体界面如下图：</p>\n<p><img src=\"11.png\" alt=\"\"></p>\n<p>在 <code>consule</code> 面板中输入：<code>example(plot)</code>，轻轻敲击几次回车，就能看到 <code>plot</code> 函数的一些实例了。</p>\n<pre><code class=\"R\">&gt; example(plot)\n\nplot&gt; Speed &lt;- cars$speed\n\nplot&gt; Distance &lt;- cars$dist\n\nplot&gt; plot(Speed, Distance, panel.first = grid(8, 8),\nplot+      pch = 0, cex = 1.2, col = &quot;blue&quot;)\n按&lt;Return&gt;键来看下一个图: \n\nplot&gt; plot(Speed, Distance,\nplot+      panel.first = lines(stats::lowess(Speed, Distance), lty = &quot;dashed&quot;),\nplot+      pch = 0, cex = 1.2, col = &quot;blue&quot;)\n按&lt;Return&gt;键来看下一个图: \n\nplot&gt; ## Show the different plot types\nplot&gt; x &lt;- 0:12\n\nplot&gt; y &lt;- sin(pi/5 * x)\n\nplot&gt; op &lt;- par(mfrow = c(3,3), mar = .1+ c(2,2,3,1))\n\nplot&gt; for (tp in c(&quot;p&quot;,&quot;l&quot;,&quot;b&quot;,  &quot;c&quot;,&quot;o&quot;,&quot;h&quot;,  &quot;s&quot;,&quot;S&quot;,&quot;n&quot;)) {\nplot+    plot(y ~ x, type = tp, main = paste0(&quot;plot(*, type = \\&quot;&quot;, tp, &quot;\\&quot;)&quot;))\nplot+    if(tp == &quot;S&quot;) {\nplot+       lines(x, y, type = &quot;s&quot;, col = &quot;red&quot;, lty = 2)\nplot+       mtext(&quot;lines(*, type = \\&quot;s\\&quot;, ...)&quot;, col = &quot;red&quot;, cex = 0.8)\nplot+    }\nplot+ }\n按&lt;Return&gt;键来看下一个图: \n\nplot&gt; par(op)\n\nplot&gt; ##--- Log-Log Plot  with  custom axes\nplot&gt; lx &lt;- seq(1, 5, length = 41)\n\nplot&gt; yl &lt;- expression(e^{-frac(1,2) * {log[10](x)}^2})\n\nplot&gt; y &lt;- exp(-.5*lx^2)\n\nplot&gt; op &lt;- par(mfrow = c(2,1), mar = par(&quot;mar&quot;)-c(1,0,2,0), mgp = c(2, .7, 0))\n\nplot&gt; plot(10^lx, y, log = &quot;xy&quot;, type = &quot;l&quot;, col = &quot;purple&quot;,\nplot+      main = &quot;Log-Log plot&quot;, ylab = yl, xlab = &quot;x&quot;)\n按&lt;Return&gt;键来看下一个图: \n\nplot&gt; plot(10^lx, y, log = &quot;xy&quot;, type = &quot;o&quot;, pch = &quot;.&quot;, col = &quot;forestgreen&quot;,\nplot+      main = &quot;Log-Log plot with custom axes&quot;, ylab = yl, xlab = &quot;x&quot;,\nplot+      axes = FALSE, frame.plot = TRUE)\n\nplot&gt; my.at &lt;- 10^(1:5)\n\nplot&gt; axis(1, at = my.at, labels = formatC(my.at, format = &quot;fg&quot;))\n\nplot&gt; e.y &lt;- -5:-1 ; at.y &lt;- 10^e.y\n\nplot&gt; axis(2, at = at.y, col.axis = &quot;red&quot;, las = 1,\nplot+      labels = as.expression(lapply(e.y, function(E) bquote(10^.(E)))))\n\nplot&gt; par(op)\n&gt; </code></pre>\n<p>下面是输出的图片：</p>\n<p><img src=\"12.png\" alt=\"\"><br><img src=\"13.png\" alt=\"\"><br><img src=\"14.png\" alt=\"\"><br><img src=\"15.png\" alt=\"\"></p>\n<p>这是基础绘图函数 <code>plot</code> 的几个示例，可以看出它能支持的图形已经有许多了，后面会有专门的文章来介绍 <code>plot</code> 函数的详细使用方法。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>到此为止，<code>R</code> 语言就已经顺利的收入囊中了，恭喜你，又掌握了一门语言（的 <code>Hello world</code>）了。【此处应有掌声】</p>\n<p>接下来，会继续介绍 <code>R</code> 语言的基本用法和其中比较重要的函数使用方法，目标是能使用 <code>R</code> 语言对数据进行初步分析，以便能在生活和工作之中有所应用。</p>\n<p>之所以开始写 <code>R</code> 语言相关的文章，是因为在工作中察觉到了数据的重要性，虽说应该让专业的人来做专业的事情，但如果对此一无所知，又怎么知道专业的人能够做什么事情呢，何况如果一点点小事情就要找数据的同学提需求未免不太合适，自己先有头绪和初步验证后也许会更有效率。而且技多不压身嘛。加之在大学时就对数据分析感兴趣，也曾经学过 <code>R</code> 语言，现在算是重温和复习吧。</p>\n"},{"title":"【Hexo】使用Hexo+github pages+travis ci搭建好看的个人博客（二）","toc":true,"date":"2020-05-03T13:29:17.000Z","_content":"\n## 说明\n\n上一篇里，介绍了使用 `Hexo` + `github pages` + `travis ci` 实现自动化博客部署，我们已经收获了一个属于自己的博客，但现在还比较简陋，里面的设置信息都是默认的数据，所以我们需要把它们改成我们想要的内容。\n\n所以这一篇里，主要介绍 `Hexo` 的配置文件如何设置。通过本篇的学习，你将知道 `Hexo` 配置文件的各个属性是什么意思，并给出我使用的配置，这样你就能随心所欲的进行配置了。\n\n## 站点信息\n\n先来看第一部分，站点信息的配置。先说明一下各个字段的含义：\n\n|参数|\t描述|\n|--|--|\n|title|\t网站标题|\n|subtitle|\t网站副标题|\n|description|\t网站描述，主要用于 SEO，告诉搜索引擎关于站点的简要信息|\n|keywords|\t网站的关键词。使用半角逗号, 分隔多个关键词。|\n|author|\t你的名字|\n|language|\t网站使用的语言，常见的有 zh-Hans 、zh-CN 、 en|\n|timezone|\t网站时区。默认使用本地时区。也可以指定其它时区，如 America/New_York, Japan, 和 UTC 。一般的，对于中国大陆地区可以使用 Asia/Shanghai。|\n\n下面是我的配置，可以作为参考：\n\n```yml\n# Site\ntitle: 张征的博客\nsubtitle: '永远年轻，永远热泪盈眶'\ndescription: '铭记过去，拥抱未来，心中有梦，眼里有光'\nkeywords: 生活,编程,阅读,音乐,电影\nauthor: 张征\nlanguage: zh-CN\ntimezone: ''\n```\n\n## 网址信息\n\n网址信息配置主要是设置网站的地址和文章链接格式。\n\n|参数\t|描述|\t默认值|\n|--|--|--|\n|url\t|网址|\t|\n|root\t|网站根目录|\t|\n|permalink\t|文章的永久链接 |格式\t:year/:month/:day/:title/|\n|permalink_defaults\t|永久链接中各部分的默认值|\t|\n|pretty_urls\t|改写 permalink 的值来美化 URL|\t\n|pretty_urls.trailing_index\t|是否在永久链接中保留尾部的 index.html，设置为 false 时去除|\ttrue|\n|pretty_urls.trailing_html\t|是否在永久链接中保留尾部的 .html, 设置为 false 时去除 (对尾部的 index.html无效)\t|true|\n\n例如：\n\n```yml\n# 比如，一个页面的永久链接是 http://example.com/foo/bar/index.html\npretty_urls:\n  trailing_index: false\n# 此时页面的永久链接会变为 http://example.com/foo/bar/\n```\n\n这里通常只需要修改 `url` 和 `root`，如果博客是使用 `github pages` 进行部署的，`url` 配置成对应的博客地址即可。这里需要注意的是 `root` 的值，如果是按照我们上一篇中的方式进行部署的，则需要把 `root` 的值设置为 `/项目名/`。\n\n下面是我的配置：\n\n```yml\n# URL\n## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'\nurl: https://mfrank2016.github.io/\nroot: /breeze-blog/\npermalink: :year/:month/:day/:title/\npermalink_defaults:\npretty_urls:\n  trailing_index: true # Set to false to remove trailing 'index.html' from permalinks\n  trailing_html: true # Set to false to remove trailing '.html' from permalinks\n```\n\n## 目录信息\n\n目录信息是指定各类目录对应的位置，通常不需要修改。\n\n|参数\t|描述\t|默认值|\n|--|--|--|\n|source_dir|\t资源文件夹，这个文件夹用来存放博客 `md` 等文件。|\tsource|\n|public_dir|\t公共文件夹，这个文件夹用于存放生成的站点静态文件。\t|public|\n|tag_dir|\t标签文件夹\t|tags|\n|archive_dir|\t归档文件夹\t|archives|\n|category_dir|\t分类文件夹\t|categories|\n|code_dir|\t`Include code` 文件夹，`source_dir` 下的子目录\t|downloads/code|\n|i18n_dir|\t国际化（i18n）文件夹\t|:lang|\n|skip_render|\t跳过指定文件的渲染。匹配到的文件将会被不做改动地复制到 `public` 目录中。您可使用 `glob` 表达式来匹配路径。\t| |\n\n例如：\n\n```yml\nskip_render: \"mypage/**/*\"\n# 将会直接将 `source/mypage/index.html` 和 `source/mypage/code.js` 不做改动地输出到 'public' 目录\n# 你也可以用这种方法来跳过对指定文章文件的渲染\nskip_render: \"_posts/test-post.md\"\n# 这将会忽略对 'test-post.md' 的渲染\n```\n\n我的配置如下：\n\n```yml\n# Directory\nsource_dir: source\npublic_dir: public\ntag_dir: tags\narchive_dir: archives\ncategory_dir: categories\ncode_dir: downloads/code\ni18n_dir: :lang\nskip_render:\n```\n\n## 文章配置\n\n这一部分是配置与文章相关的各类属性。\n\n| 参数                    | 描述                                                         | 默认值    |\n| :---------------------- | :----------------------------------------------------------- | :-------- |\n| `new_post_name`         | 新文章的文件名称                                             | :title.md |\n| `default_layout`        | 预设布局                                                     | post      |\n| `auto_spacing`          | 在中文和英文之间加入空格                                     | false     |\n| `titlecase`             | 把标题转换为 `title case`                                      | false     |\n| `external_link`         | 在新标签中打开链接                                           | true      |\n| `external_link.enable`  | 在新标签中打开链接                                           | `true`    |\n| `external_link.field`   | 对整个网站（`site`）生效或仅对文章（`post`）生效             | `site`    |\n| `external_link.exclude` | 需要排除的域名。主域名和子域名如 `www` 需分别配置            | `[]`      |\n| `filename_case`         | 把文件名称转换为 (1) 小写或 (2) 大写                         | 0         |\n| `render_drafts`         | 显示草稿                                                     | false     |\n| `post_asset_folder`     | 启动 `Asset` 文件夹| false     |\n| `relative_link`         | 把链接改为与根目录的相对位址                                 | false     |\n| `future`                | 显示未来的文章                                               | true      |\n| `highlight`             | 代码块的设置                                                 |           |\n| `highlight.enable`      | 开启代码块高亮                                               | `true`    |\n| `highlight.auto_detect` | 如果未指定语言，则启用自动检测                               | `false`   |\n| `highlight.line_number` | 显示行数 | `true`    |\n| `highlight.tab_replace` | 用 n 个空格替换 `tabs`；如果值为空，则不会替换 `tabs`            | `''`      |\n| `highlight.wrap`        | 把代码块用 `` 包裹 | `true`    |\n| `highlight.hljs`        | 为 highlight 的 css 文件中的类添加 `hljs-*` 前缀                      | `false`   |\n\n`auto_spacing` 建议开启，这样的话看起来更美观，`titlecase` 是指关键单词首字母大写，如果不太清楚，可以看下面的说明：\n\n> Titles should be written in title case. This means only using capital letters for the principal words. Articles, conjunctions, and prepositions do not get capital letters unless they start the title. For example:\n> The Last of the Mohicans \n\n`post_asset_folder` 建议开启，这样会在生成新的文章时，同时会同一目录下生成同名文件夹，这样可以把该文章相关的图片等资源放进去，方便引用和管理。\n\n下面是我的配置：\n\n```yml\nnew_post_name: :title.md # File name of new posts\ndefault_layout: post\nauto_spacing: true\ntitlecase: false # Transform title into titlecase\nexternal_link:\n  enable: true # Open external links in new tab\n  field: post # Apply to the whole site\n  exclude: ''\nfilename_case: 0\nrender_drafts: false\npost_asset_folder: true\nrelative_link: false\nfuture: true\n# highlight:\n#   enable: true\n#   line_number: true\n#   auto_detect: false\n#   tab_replace: ''\n#   wrap: true\n#   hljs: false\nhighlight:\n  enable: false\n\n# 代码高亮\nprism_plugin:\n  mode: 'preprocess'    # realtime/preprocess\n  theme: 'tomorrow'\n  line_number: false    # default false\n  custom_css:\n```\n\n这里我使用了另一个代码高亮插件，如果通常使用默认的 `hljs` 高亮即可。如果也想要使用这个插件，可以查看[这里](https://github.com/ele828/hexo-prism-plugin)，需要先进行安装：\n\n```bash\nnpm i -S hexo-prism-plugin\n```\n\n## 分类和标签信息\n\n这里配置的是别名，即映射信息，如果文章使用的是英文名分类，这里可以不用设置，如果使用了中文名分类，最好配置一些对应的英文名，否则在对应的分类链接中就会出现 `URL` 编码的中文，比如这样：\n\n```\nhttp://localhost:4000/breeze-blog/categories/programming/life/%E6%B5%8B%E8%AF%95/\n```\n\n| 参数               | 描述     | 默认值          |\n| :----------------- | :------- | :-------------- |\n| `default_category` | 默认分类 | `uncategorized` |\n| `category_map`     | 分类别名 |                 |\n| `tag_map`          | 标签别名 |                 |\n\n我的配置如下：\n\n```yml\n# Category & Tag\ndefault_category: uncategorized\ncategory_map:\n  编程: programming\n  生活: life\n  阅读: reading\n  随想: thoughts\n  理财: finance\ntag_map:\n  敏捷开发: agile-development\n  环境搭建: environment-building\n```\n\n## 日期 / 时间格式\n\n`Hexo` 使用 [Moment.js](http://momentjs.com/) 来解析和显示时间。\n\n| 参数                   | 描述                                                         | 默认值       |\n| :--------------------- | :----------------------------------------------------------- | :----------- |\n| `date_format`          | 日期格式                                                     | `YYYY-MM-DD` |\n| `time_format`          | 时间格式                                                     | `HH:mm:ss`   |\n| `use_date_for_updated` | 启用以后，如果 Front Matter 中没有指定 `updated`， `post.updated` 将会使用 `date` 的值而不是文件的创建时间。在 Git 工作流中这个选项会很有用 | `true`       |\n\n我的配置如下：\n\n```yml\n# Date / Time format\n## Hexo uses Moment.js to parse and display date\n## You can customize the date format as defined in\n## http://momentjs.com/docs/#/displaying/format/\ndate_format: YYYY-MM-DD\ntime_format: HH:mm:ss\n## Use post's date for updated date unless set in front-matter\nuse_date_for_updated: true\n```\n\n## 分页信息\n\n| 参数             | 描述                                | 默认值 |\n| :--------------- | :---------------------------------- | :----- |\n| `per_page`       | 每页显示的文章量 (0 = 关闭分页功能) | `10`   |\n| `pagination_dir` | 分页目录                            | `page` |\n\n\n我的配置如下：\n\n```yml\n# Pagination\n## Set per_page to 0 to disable pagination\nper_page: 12\npagination_dir: page\n```\n\n## 扩展信息\n\n| 参数             | 描述                                                         |\n| :--------------- | :----------------------------------------------------------- |\n| `theme`          | 当前主题名称。值为`false`时禁用主题                          |\n| `theme_config`   | 主题的配置文件。在这里放置的配置会覆盖主题目录下的 `_config.yml` 中的配置 |\n| `deploy`         | 部署部分的设置                                               |\n| `meta_generator` | [Meta generator](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/meta#属性) 标签。 值为 `false` 时 Hexo 不会在头部插入该标签 |\n\n这里设置 `theme` 即可开启对应的主题，具体如何设置会在后面的文章进行详细说明。\n\n`theme_config` 可以在这里配置主题文件里的各个参数进行覆盖，这样就不用维护两份 `config` 文件了，不过个人觉得还是不同主题文件使用不同配置文件比较好。\n\n`deploy` 是部署相关的配置，比如 `git` 部署，除此之外，还有很多其它部署姿势，比如：`Heroku`、`Netlify` 等，但都需要先安装对应的插件。\n\n我的配置如下：\n\n```yml\n# Extensions\ntheme: hexo-theme-matery\n\n# Deployment\ndeploy:\n  type: 'git'\n  repo: git@github.com:MFrank2016/breeze-blog\n  branch: gh-pages\n```\n\n## 包括或不包括目录和文件\n\n在 `Hexo` 配置文件中，通过设置 `include/exclude` 可以让 `Hexo` 进行处理或忽略某些目录和文件夹。可以使用 [glob 表达式](https://github.com/isaacs/minimatch) 对目录和文件进行匹配。\n\n`include` 和 `exclude` 选项都只能应用于 `source/` 文件夹, 但 `ignore` 选项可以应用于所有文件夹。\n\n| 参数      | 描述                                                         |\n| :-------- | :----------------------------------------------------------- |\n| `include` | `Hexo` 默认会忽略隐藏文件和文件夹（包括名称以下划线和 `.` 开头的文件和文件夹，`Hexo` 的 `_posts` 和 `_data` 等目录除外）。通过设置此字段将使 Hexo 处理他们并将它们复制到 `source` 目录下。 |\n| `exclude` | `Hexo` 会忽略这些文件和目录                                    |\n| `ignore`  | 忽略文件或文件夹                                         |\n\n举例：\n\n```yml\n# Include/Exclude Files/Folders\ninclude:\n  - \".nojekyll\"\n  # 包括 'source/css/_typing.css'\n  - \"css/_typing.css\"\n  # 包括 'source/_css/' 中的任何文件，但不包括子目录及其其中的文件。\n  - \"_css/*\"\n  # 包含 'source/_css/' 中的任何文件和子目录下的任何文件\n  - \"_css/**/*\"\n\nexclude:\n  # 不包括 'source/js/test.js'\n  - \"js/test.js\"\n  # 不包括 'source/js/' 中的文件、但包括子目录下的所有目录和文件\n  - \"js/*\"\n  # 不包括 'source/js/' 中的文件和子目录下的任何文件\n  - \"js/**/*\"\n  # 不包括 'source/js/' 目录下的所有文件名以 'test' 开头的文件，但包括其它文件和子目录下的单文件\n  - \"js/test*\"\n  # 不包括 'source/js/' 及其子目录中任何以 'test' 开头的文件\n  - \"js/**/test*\"\n  # 不要用 exclude 来忽略 'source/_posts/' 中的文件。你应该使用 'skip_render'，或者在要忽略的文件的文件名之前加一个下划线 '_'\n  # 在这里配置一个 - \"_posts/hello-world.md\" 是没有用的。\n\nignore:\n  # Ignore any folder named 'foo'.\n  - \"**/foo\"\n  # Ignore 'foo' folder in 'themes/' only.\n  - \"**/themes/*/foo\"\n  # Same as above, but applies to every subfolders of 'themes/'.\n  - \"**/themes/**/foo\"\n```\n\n列表中的每一项都必须用单引号或双引号包裹起来。\n\n`include` 和 `exclude` 并不适用于 `themes/` 目录下的文件。如果需要忽略 `themes/` 目录下的部分文件或文件夹，可以使用 `ignore` 或在文件名之前添加下划线 `_`。\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/hexo/hexo-config.md","raw":"---\ntitle: 【Hexo】使用Hexo+github pages+travis ci搭建好看的个人博客（二）\ntags:\n  - 环境搭建\n  - Hexo\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-03 21:29:17\n---\n\n## 说明\n\n上一篇里，介绍了使用 `Hexo` + `github pages` + `travis ci` 实现自动化博客部署，我们已经收获了一个属于自己的博客，但现在还比较简陋，里面的设置信息都是默认的数据，所以我们需要把它们改成我们想要的内容。\n\n所以这一篇里，主要介绍 `Hexo` 的配置文件如何设置。通过本篇的学习，你将知道 `Hexo` 配置文件的各个属性是什么意思，并给出我使用的配置，这样你就能随心所欲的进行配置了。\n\n## 站点信息\n\n先来看第一部分，站点信息的配置。先说明一下各个字段的含义：\n\n|参数|\t描述|\n|--|--|\n|title|\t网站标题|\n|subtitle|\t网站副标题|\n|description|\t网站描述，主要用于 SEO，告诉搜索引擎关于站点的简要信息|\n|keywords|\t网站的关键词。使用半角逗号, 分隔多个关键词。|\n|author|\t你的名字|\n|language|\t网站使用的语言，常见的有 zh-Hans 、zh-CN 、 en|\n|timezone|\t网站时区。默认使用本地时区。也可以指定其它时区，如 America/New_York, Japan, 和 UTC 。一般的，对于中国大陆地区可以使用 Asia/Shanghai。|\n\n下面是我的配置，可以作为参考：\n\n```yml\n# Site\ntitle: 张征的博客\nsubtitle: '永远年轻，永远热泪盈眶'\ndescription: '铭记过去，拥抱未来，心中有梦，眼里有光'\nkeywords: 生活,编程,阅读,音乐,电影\nauthor: 张征\nlanguage: zh-CN\ntimezone: ''\n```\n\n## 网址信息\n\n网址信息配置主要是设置网站的地址和文章链接格式。\n\n|参数\t|描述|\t默认值|\n|--|--|--|\n|url\t|网址|\t|\n|root\t|网站根目录|\t|\n|permalink\t|文章的永久链接 |格式\t:year/:month/:day/:title/|\n|permalink_defaults\t|永久链接中各部分的默认值|\t|\n|pretty_urls\t|改写 permalink 的值来美化 URL|\t\n|pretty_urls.trailing_index\t|是否在永久链接中保留尾部的 index.html，设置为 false 时去除|\ttrue|\n|pretty_urls.trailing_html\t|是否在永久链接中保留尾部的 .html, 设置为 false 时去除 (对尾部的 index.html无效)\t|true|\n\n例如：\n\n```yml\n# 比如，一个页面的永久链接是 http://example.com/foo/bar/index.html\npretty_urls:\n  trailing_index: false\n# 此时页面的永久链接会变为 http://example.com/foo/bar/\n```\n\n这里通常只需要修改 `url` 和 `root`，如果博客是使用 `github pages` 进行部署的，`url` 配置成对应的博客地址即可。这里需要注意的是 `root` 的值，如果是按照我们上一篇中的方式进行部署的，则需要把 `root` 的值设置为 `/项目名/`。\n\n下面是我的配置：\n\n```yml\n# URL\n## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'\nurl: https://mfrank2016.github.io/\nroot: /breeze-blog/\npermalink: :year/:month/:day/:title/\npermalink_defaults:\npretty_urls:\n  trailing_index: true # Set to false to remove trailing 'index.html' from permalinks\n  trailing_html: true # Set to false to remove trailing '.html' from permalinks\n```\n\n## 目录信息\n\n目录信息是指定各类目录对应的位置，通常不需要修改。\n\n|参数\t|描述\t|默认值|\n|--|--|--|\n|source_dir|\t资源文件夹，这个文件夹用来存放博客 `md` 等文件。|\tsource|\n|public_dir|\t公共文件夹，这个文件夹用于存放生成的站点静态文件。\t|public|\n|tag_dir|\t标签文件夹\t|tags|\n|archive_dir|\t归档文件夹\t|archives|\n|category_dir|\t分类文件夹\t|categories|\n|code_dir|\t`Include code` 文件夹，`source_dir` 下的子目录\t|downloads/code|\n|i18n_dir|\t国际化（i18n）文件夹\t|:lang|\n|skip_render|\t跳过指定文件的渲染。匹配到的文件将会被不做改动地复制到 `public` 目录中。您可使用 `glob` 表达式来匹配路径。\t| |\n\n例如：\n\n```yml\nskip_render: \"mypage/**/*\"\n# 将会直接将 `source/mypage/index.html` 和 `source/mypage/code.js` 不做改动地输出到 'public' 目录\n# 你也可以用这种方法来跳过对指定文章文件的渲染\nskip_render: \"_posts/test-post.md\"\n# 这将会忽略对 'test-post.md' 的渲染\n```\n\n我的配置如下：\n\n```yml\n# Directory\nsource_dir: source\npublic_dir: public\ntag_dir: tags\narchive_dir: archives\ncategory_dir: categories\ncode_dir: downloads/code\ni18n_dir: :lang\nskip_render:\n```\n\n## 文章配置\n\n这一部分是配置与文章相关的各类属性。\n\n| 参数                    | 描述                                                         | 默认值    |\n| :---------------------- | :----------------------------------------------------------- | :-------- |\n| `new_post_name`         | 新文章的文件名称                                             | :title.md |\n| `default_layout`        | 预设布局                                                     | post      |\n| `auto_spacing`          | 在中文和英文之间加入空格                                     | false     |\n| `titlecase`             | 把标题转换为 `title case`                                      | false     |\n| `external_link`         | 在新标签中打开链接                                           | true      |\n| `external_link.enable`  | 在新标签中打开链接                                           | `true`    |\n| `external_link.field`   | 对整个网站（`site`）生效或仅对文章（`post`）生效             | `site`    |\n| `external_link.exclude` | 需要排除的域名。主域名和子域名如 `www` 需分别配置            | `[]`      |\n| `filename_case`         | 把文件名称转换为 (1) 小写或 (2) 大写                         | 0         |\n| `render_drafts`         | 显示草稿                                                     | false     |\n| `post_asset_folder`     | 启动 `Asset` 文件夹| false     |\n| `relative_link`         | 把链接改为与根目录的相对位址                                 | false     |\n| `future`                | 显示未来的文章                                               | true      |\n| `highlight`             | 代码块的设置                                                 |           |\n| `highlight.enable`      | 开启代码块高亮                                               | `true`    |\n| `highlight.auto_detect` | 如果未指定语言，则启用自动检测                               | `false`   |\n| `highlight.line_number` | 显示行数 | `true`    |\n| `highlight.tab_replace` | 用 n 个空格替换 `tabs`；如果值为空，则不会替换 `tabs`            | `''`      |\n| `highlight.wrap`        | 把代码块用 `` 包裹 | `true`    |\n| `highlight.hljs`        | 为 highlight 的 css 文件中的类添加 `hljs-*` 前缀                      | `false`   |\n\n`auto_spacing` 建议开启，这样的话看起来更美观，`titlecase` 是指关键单词首字母大写，如果不太清楚，可以看下面的说明：\n\n> Titles should be written in title case. This means only using capital letters for the principal words. Articles, conjunctions, and prepositions do not get capital letters unless they start the title. For example:\n> The Last of the Mohicans \n\n`post_asset_folder` 建议开启，这样会在生成新的文章时，同时会同一目录下生成同名文件夹，这样可以把该文章相关的图片等资源放进去，方便引用和管理。\n\n下面是我的配置：\n\n```yml\nnew_post_name: :title.md # File name of new posts\ndefault_layout: post\nauto_spacing: true\ntitlecase: false # Transform title into titlecase\nexternal_link:\n  enable: true # Open external links in new tab\n  field: post # Apply to the whole site\n  exclude: ''\nfilename_case: 0\nrender_drafts: false\npost_asset_folder: true\nrelative_link: false\nfuture: true\n# highlight:\n#   enable: true\n#   line_number: true\n#   auto_detect: false\n#   tab_replace: ''\n#   wrap: true\n#   hljs: false\nhighlight:\n  enable: false\n\n# 代码高亮\nprism_plugin:\n  mode: 'preprocess'    # realtime/preprocess\n  theme: 'tomorrow'\n  line_number: false    # default false\n  custom_css:\n```\n\n这里我使用了另一个代码高亮插件，如果通常使用默认的 `hljs` 高亮即可。如果也想要使用这个插件，可以查看[这里](https://github.com/ele828/hexo-prism-plugin)，需要先进行安装：\n\n```bash\nnpm i -S hexo-prism-plugin\n```\n\n## 分类和标签信息\n\n这里配置的是别名，即映射信息，如果文章使用的是英文名分类，这里可以不用设置，如果使用了中文名分类，最好配置一些对应的英文名，否则在对应的分类链接中就会出现 `URL` 编码的中文，比如这样：\n\n```\nhttp://localhost:4000/breeze-blog/categories/programming/life/%E6%B5%8B%E8%AF%95/\n```\n\n| 参数               | 描述     | 默认值          |\n| :----------------- | :------- | :-------------- |\n| `default_category` | 默认分类 | `uncategorized` |\n| `category_map`     | 分类别名 |                 |\n| `tag_map`          | 标签别名 |                 |\n\n我的配置如下：\n\n```yml\n# Category & Tag\ndefault_category: uncategorized\ncategory_map:\n  编程: programming\n  生活: life\n  阅读: reading\n  随想: thoughts\n  理财: finance\ntag_map:\n  敏捷开发: agile-development\n  环境搭建: environment-building\n```\n\n## 日期 / 时间格式\n\n`Hexo` 使用 [Moment.js](http://momentjs.com/) 来解析和显示时间。\n\n| 参数                   | 描述                                                         | 默认值       |\n| :--------------------- | :----------------------------------------------------------- | :----------- |\n| `date_format`          | 日期格式                                                     | `YYYY-MM-DD` |\n| `time_format`          | 时间格式                                                     | `HH:mm:ss`   |\n| `use_date_for_updated` | 启用以后，如果 Front Matter 中没有指定 `updated`， `post.updated` 将会使用 `date` 的值而不是文件的创建时间。在 Git 工作流中这个选项会很有用 | `true`       |\n\n我的配置如下：\n\n```yml\n# Date / Time format\n## Hexo uses Moment.js to parse and display date\n## You can customize the date format as defined in\n## http://momentjs.com/docs/#/displaying/format/\ndate_format: YYYY-MM-DD\ntime_format: HH:mm:ss\n## Use post's date for updated date unless set in front-matter\nuse_date_for_updated: true\n```\n\n## 分页信息\n\n| 参数             | 描述                                | 默认值 |\n| :--------------- | :---------------------------------- | :----- |\n| `per_page`       | 每页显示的文章量 (0 = 关闭分页功能) | `10`   |\n| `pagination_dir` | 分页目录                            | `page` |\n\n\n我的配置如下：\n\n```yml\n# Pagination\n## Set per_page to 0 to disable pagination\nper_page: 12\npagination_dir: page\n```\n\n## 扩展信息\n\n| 参数             | 描述                                                         |\n| :--------------- | :----------------------------------------------------------- |\n| `theme`          | 当前主题名称。值为`false`时禁用主题                          |\n| `theme_config`   | 主题的配置文件。在这里放置的配置会覆盖主题目录下的 `_config.yml` 中的配置 |\n| `deploy`         | 部署部分的设置                                               |\n| `meta_generator` | [Meta generator](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/meta#属性) 标签。 值为 `false` 时 Hexo 不会在头部插入该标签 |\n\n这里设置 `theme` 即可开启对应的主题，具体如何设置会在后面的文章进行详细说明。\n\n`theme_config` 可以在这里配置主题文件里的各个参数进行覆盖，这样就不用维护两份 `config` 文件了，不过个人觉得还是不同主题文件使用不同配置文件比较好。\n\n`deploy` 是部署相关的配置，比如 `git` 部署，除此之外，还有很多其它部署姿势，比如：`Heroku`、`Netlify` 等，但都需要先安装对应的插件。\n\n我的配置如下：\n\n```yml\n# Extensions\ntheme: hexo-theme-matery\n\n# Deployment\ndeploy:\n  type: 'git'\n  repo: git@github.com:MFrank2016/breeze-blog\n  branch: gh-pages\n```\n\n## 包括或不包括目录和文件\n\n在 `Hexo` 配置文件中，通过设置 `include/exclude` 可以让 `Hexo` 进行处理或忽略某些目录和文件夹。可以使用 [glob 表达式](https://github.com/isaacs/minimatch) 对目录和文件进行匹配。\n\n`include` 和 `exclude` 选项都只能应用于 `source/` 文件夹, 但 `ignore` 选项可以应用于所有文件夹。\n\n| 参数      | 描述                                                         |\n| :-------- | :----------------------------------------------------------- |\n| `include` | `Hexo` 默认会忽略隐藏文件和文件夹（包括名称以下划线和 `.` 开头的文件和文件夹，`Hexo` 的 `_posts` 和 `_data` 等目录除外）。通过设置此字段将使 Hexo 处理他们并将它们复制到 `source` 目录下。 |\n| `exclude` | `Hexo` 会忽略这些文件和目录                                    |\n| `ignore`  | 忽略文件或文件夹                                         |\n\n举例：\n\n```yml\n# Include/Exclude Files/Folders\ninclude:\n  - \".nojekyll\"\n  # 包括 'source/css/_typing.css'\n  - \"css/_typing.css\"\n  # 包括 'source/_css/' 中的任何文件，但不包括子目录及其其中的文件。\n  - \"_css/*\"\n  # 包含 'source/_css/' 中的任何文件和子目录下的任何文件\n  - \"_css/**/*\"\n\nexclude:\n  # 不包括 'source/js/test.js'\n  - \"js/test.js\"\n  # 不包括 'source/js/' 中的文件、但包括子目录下的所有目录和文件\n  - \"js/*\"\n  # 不包括 'source/js/' 中的文件和子目录下的任何文件\n  - \"js/**/*\"\n  # 不包括 'source/js/' 目录下的所有文件名以 'test' 开头的文件，但包括其它文件和子目录下的单文件\n  - \"js/test*\"\n  # 不包括 'source/js/' 及其子目录中任何以 'test' 开头的文件\n  - \"js/**/test*\"\n  # 不要用 exclude 来忽略 'source/_posts/' 中的文件。你应该使用 'skip_render'，或者在要忽略的文件的文件名之前加一个下划线 '_'\n  # 在这里配置一个 - \"_posts/hello-world.md\" 是没有用的。\n\nignore:\n  # Ignore any folder named 'foo'.\n  - \"**/foo\"\n  # Ignore 'foo' folder in 'themes/' only.\n  - \"**/themes/*/foo\"\n  # Same as above, but applies to every subfolders of 'themes/'.\n  - \"**/themes/**/foo\"\n```\n\n列表中的每一项都必须用单引号或双引号包裹起来。\n\n`include` 和 `exclude` 并不适用于 `themes/` 目录下的文件。如果需要忽略 `themes/` 目录下的部分文件或文件夹，可以使用 `ignore` 或在文件名之前添加下划线 `_`。\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n\n\n\n\n\n\n\n\n\n\n\n","slug":"hexo/hexo-config","published":1,"updated":"2020-05-03T13:29:17.000Z","_id":"cl70rsfb8000c5ohu7ah576ex","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>上一篇里，介绍了使用 <code>Hexo</code> + <code>github pages</code> + <code>travis ci</code> 实现自动化博客部署，我们已经收获了一个属于自己的博客，但现在还比较简陋，里面的设置信息都是默认的数据，所以我们需要把它们改成我们想要的内容。</p>\n<p>所以这一篇里，主要介绍 <code>Hexo</code> 的配置文件如何设置。通过本篇的学习，你将知道 <code>Hexo</code> 配置文件的各个属性是什么意思，并给出我使用的配置，这样你就能随心所欲的进行配置了。</p>\n<h2 id=\"站点信息\"><a href=\"#站点信息\" class=\"headerlink\" title=\"站点信息\"></a>站点信息</h2><p>先来看第一部分，站点信息的配置。先说明一下各个字段的含义：</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>title</td>\n<td>网站标题</td>\n</tr>\n<tr>\n<td>subtitle</td>\n<td>网站副标题</td>\n</tr>\n<tr>\n<td>description</td>\n<td>网站描述，主要用于 SEO，告诉搜索引擎关于站点的简要信息</td>\n</tr>\n<tr>\n<td>keywords</td>\n<td>网站的关键词。使用半角逗号, 分隔多个关键词。</td>\n</tr>\n<tr>\n<td>author</td>\n<td>你的名字</td>\n</tr>\n<tr>\n<td>language</td>\n<td>网站使用的语言，常见的有 zh-Hans 、zh-CN 、 en</td>\n</tr>\n<tr>\n<td>timezone</td>\n<td>网站时区。默认使用本地时区。也可以指定其它时区，如 America/New_York, Japan, 和 UTC 。一般的，对于中国大陆地区可以使用 Asia/Shanghai。</td>\n</tr>\n</tbody></table>\n<p>下面是我的配置，可以作为参考：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\"># Site\ntitle: 张征的博客\nsubtitle: '永远年轻，永远热泪盈眶'\ndescription: '铭记过去，拥抱未来，心中有梦，眼里有光'\nkeywords: 生活,编程,阅读,音乐,电影\nauthor: 张征\nlanguage: zh-CN\ntimezone: ''</code></pre>\n<h2 id=\"网址信息\"><a href=\"#网址信息\" class=\"headerlink\" title=\"网址信息\"></a>网址信息</h2><p>网址信息配置主要是设置网站的地址和文章链接格式。</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n<th>默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>url</td>\n<td>网址</td>\n<td></td>\n</tr>\n<tr>\n<td>root</td>\n<td>网站根目录</td>\n<td></td>\n</tr>\n<tr>\n<td>permalink</td>\n<td>文章的永久链接</td>\n<td>格式    :year/:month/:day/:title/</td>\n</tr>\n<tr>\n<td>permalink_defaults</td>\n<td>永久链接中各部分的默认值</td>\n<td></td>\n</tr>\n<tr>\n<td>pretty_urls</td>\n<td>改写 permalink 的值来美化 URL</td>\n<td></td>\n</tr>\n<tr>\n<td>pretty_urls.trailing_index</td>\n<td>是否在永久链接中保留尾部的 index.html，设置为 false 时去除</td>\n<td>true</td>\n</tr>\n<tr>\n<td>pretty_urls.trailing_html</td>\n<td>是否在永久链接中保留尾部的 .html, 设置为 false 时去除 (对尾部的 index.html无效)</td>\n<td>true</td>\n</tr>\n</tbody></table>\n<p>例如：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\"># 比如，一个页面的永久链接是 http://example.com/foo/bar/index.html\npretty_urls:\n  trailing_index: false\n# 此时页面的永久链接会变为 http://example.com/foo/bar/</code></pre>\n<p>这里通常只需要修改 <code>url</code> 和 <code>root</code>，如果博客是使用 <code>github pages</code> 进行部署的，<code>url</code> 配置成对应的博客地址即可。这里需要注意的是 <code>root</code> 的值，如果是按照我们上一篇中的方式进行部署的，则需要把 <code>root</code> 的值设置为 <code>/项目名/</code>。</p>\n<p>下面是我的配置：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\"># URL\n## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'\nurl: https://mfrank2016.github.io/\nroot: /breeze-blog/\npermalink: :year/:month/:day/:title/\npermalink_defaults:\npretty_urls:\n  trailing_index: true # Set to false to remove trailing 'index.html' from permalinks\n  trailing_html: true # Set to false to remove trailing '.html' from permalinks</code></pre>\n<h2 id=\"目录信息\"><a href=\"#目录信息\" class=\"headerlink\" title=\"目录信息\"></a>目录信息</h2><p>目录信息是指定各类目录对应的位置，通常不需要修改。</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n<th>默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>source_dir</td>\n<td>资源文件夹，这个文件夹用来存放博客 <code>md</code> 等文件。</td>\n<td>source</td>\n</tr>\n<tr>\n<td>public_dir</td>\n<td>公共文件夹，这个文件夹用于存放生成的站点静态文件。</td>\n<td>public</td>\n</tr>\n<tr>\n<td>tag_dir</td>\n<td>标签文件夹</td>\n<td>tags</td>\n</tr>\n<tr>\n<td>archive_dir</td>\n<td>归档文件夹</td>\n<td>archives</td>\n</tr>\n<tr>\n<td>category_dir</td>\n<td>分类文件夹</td>\n<td>categories</td>\n</tr>\n<tr>\n<td>code_dir</td>\n<td><code>Include code</code> 文件夹，<code>source_dir</code> 下的子目录</td>\n<td>downloads/code</td>\n</tr>\n<tr>\n<td>i18n_dir</td>\n<td>国际化（i18n）文件夹</td>\n<td>:lang</td>\n</tr>\n<tr>\n<td>skip_render</td>\n<td>跳过指定文件的渲染。匹配到的文件将会被不做改动地复制到 <code>public</code> 目录中。您可使用 <code>glob</code> 表达式来匹配路径。</td>\n<td></td>\n</tr>\n</tbody></table>\n<p>例如：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">skip_render: \"mypage/**/*\"\n# 将会直接将 `source/mypage/index.html` 和 `source/mypage/code.js` 不做改动地输出到 'public' 目录\n# 你也可以用这种方法来跳过对指定文章文件的渲染\nskip_render: \"_posts/test-post.md\"\n# 这将会忽略对 'test-post.md' 的渲染</code></pre>\n<p>我的配置如下：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\"># Directory\nsource_dir: source\npublic_dir: public\ntag_dir: tags\narchive_dir: archives\ncategory_dir: categories\ncode_dir: downloads/code\ni18n_dir: :lang\nskip_render:</code></pre>\n<h2 id=\"文章配置\"><a href=\"#文章配置\" class=\"headerlink\" title=\"文章配置\"></a>文章配置</h2><p>这一部分是配置与文章相关的各类属性。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">描述</th>\n<th align=\"left\">默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>new_post_name</code></td>\n<td align=\"left\">新文章的文件名称</td>\n<td align=\"left\">:title.md</td>\n</tr>\n<tr>\n<td align=\"left\"><code>default_layout</code></td>\n<td align=\"left\">预设布局</td>\n<td align=\"left\">post</td>\n</tr>\n<tr>\n<td align=\"left\"><code>auto_spacing</code></td>\n<td align=\"left\">在中文和英文之间加入空格</td>\n<td align=\"left\">false</td>\n</tr>\n<tr>\n<td align=\"left\"><code>titlecase</code></td>\n<td align=\"left\">把标题转换为 <code>title case</code></td>\n<td align=\"left\">false</td>\n</tr>\n<tr>\n<td align=\"left\"><code>external_link</code></td>\n<td align=\"left\">在新标签中打开链接</td>\n<td align=\"left\">true</td>\n</tr>\n<tr>\n<td align=\"left\"><code>external_link.enable</code></td>\n<td align=\"left\">在新标签中打开链接</td>\n<td align=\"left\"><code>true</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>external_link.field</code></td>\n<td align=\"left\">对整个网站（<code>site</code>）生效或仅对文章（<code>post</code>）生效</td>\n<td align=\"left\"><code>site</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>external_link.exclude</code></td>\n<td align=\"left\">需要排除的域名。主域名和子域名如 <code>www</code> 需分别配置</td>\n<td align=\"left\"><code>[]</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>filename_case</code></td>\n<td align=\"left\">把文件名称转换为 (1) 小写或 (2) 大写</td>\n<td align=\"left\">0</td>\n</tr>\n<tr>\n<td align=\"left\"><code>render_drafts</code></td>\n<td align=\"left\">显示草稿</td>\n<td align=\"left\">false</td>\n</tr>\n<tr>\n<td align=\"left\"><code>post_asset_folder</code></td>\n<td align=\"left\">启动 <code>Asset</code> 文件夹</td>\n<td align=\"left\">false</td>\n</tr>\n<tr>\n<td align=\"left\"><code>relative_link</code></td>\n<td align=\"left\">把链接改为与根目录的相对位址</td>\n<td align=\"left\">false</td>\n</tr>\n<tr>\n<td align=\"left\"><code>future</code></td>\n<td align=\"left\">显示未来的文章</td>\n<td align=\"left\">true</td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight</code></td>\n<td align=\"left\">代码块的设置</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight.enable</code></td>\n<td align=\"left\">开启代码块高亮</td>\n<td align=\"left\"><code>true</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight.auto_detect</code></td>\n<td align=\"left\">如果未指定语言，则启用自动检测</td>\n<td align=\"left\"><code>false</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight.line_number</code></td>\n<td align=\"left\">显示行数</td>\n<td align=\"left\"><code>true</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight.tab_replace</code></td>\n<td align=\"left\">用 n 个空格替换 <code>tabs</code>；如果值为空，则不会替换 <code>tabs</code></td>\n<td align=\"left\"><code>''</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight.wrap</code></td>\n<td align=\"left\">把代码块用 `` 包裹</td>\n<td align=\"left\"><code>true</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight.hljs</code></td>\n<td align=\"left\">为 highlight 的 css 文件中的类添加 <code>hljs-*</code> 前缀</td>\n<td align=\"left\"><code>false</code></td>\n</tr>\n</tbody></table>\n<p><code>auto_spacing</code> 建议开启，这样的话看起来更美观，<code>titlecase</code> 是指关键单词首字母大写，如果不太清楚，可以看下面的说明：</p>\n<blockquote>\n<p>Titles should be written in title case. This means only using capital letters for the principal words. Articles, conjunctions, and prepositions do not get capital letters unless they start the title. For example:<br>The Last of the Mohicans </p>\n</blockquote>\n<p><code>post_asset_folder</code> 建议开启，这样会在生成新的文章时，同时会同一目录下生成同名文件夹，这样可以把该文章相关的图片等资源放进去，方便引用和管理。</p>\n<p>下面是我的配置：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">new_post_name: :title.md # File name of new posts\ndefault_layout: post\nauto_spacing: true\ntitlecase: false # Transform title into titlecase\nexternal_link:\n  enable: true # Open external links in new tab\n  field: post # Apply to the whole site\n  exclude: ''\nfilename_case: 0\nrender_drafts: false\npost_asset_folder: true\nrelative_link: false\nfuture: true\n# highlight:\n#   enable: true\n#   line_number: true\n#   auto_detect: false\n#   tab_replace: ''\n#   wrap: true\n#   hljs: false\nhighlight:\n  enable: false\n\n# 代码高亮\nprism_plugin:\n  mode: 'preprocess'    # realtime/preprocess\n  theme: 'tomorrow'\n  line_number: false    # default false\n  custom_css:</code></pre>\n<p>这里我使用了另一个代码高亮插件，如果通常使用默认的 <code>hljs</code> 高亮即可。如果也想要使用这个插件，可以查看<a href=\"https://github.com/ele828/hexo-prism-plugin\" target=\"_blank\" rel=\"noopener\">这里</a>，需要先进行安装：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i -S hexo-prism-plugin</code></pre>\n<h2 id=\"分类和标签信息\"><a href=\"#分类和标签信息\" class=\"headerlink\" title=\"分类和标签信息\"></a>分类和标签信息</h2><p>这里配置的是别名，即映射信息，如果文章使用的是英文名分类，这里可以不用设置，如果使用了中文名分类，最好配置一些对应的英文名，否则在对应的分类链接中就会出现 <code>URL</code> 编码的中文，比如这样：</p>\n<pre><code>http://localhost:4000/breeze-blog/categories/programming/life/%E6%B5%8B%E8%AF%95/</code></pre><table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">描述</th>\n<th align=\"left\">默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>default_category</code></td>\n<td align=\"left\">默认分类</td>\n<td align=\"left\"><code>uncategorized</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>category_map</code></td>\n<td align=\"left\">分类别名</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"><code>tag_map</code></td>\n<td align=\"left\">标签别名</td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>我的配置如下：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\"># Category & Tag\ndefault_category: uncategorized\ncategory_map:\n  编程: programming\n  生活: life\n  阅读: reading\n  随想: thoughts\n  理财: finance\ntag_map:\n  敏捷开发: agile-development\n  环境搭建: environment-building</code></pre>\n<h2 id=\"日期-时间格式\"><a href=\"#日期-时间格式\" class=\"headerlink\" title=\"日期 / 时间格式\"></a>日期 / 时间格式</h2><p><code>Hexo</code> 使用 <a href=\"http://momentjs.com/\" target=\"_blank\" rel=\"noopener\">Moment.js</a> 来解析和显示时间。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">描述</th>\n<th align=\"left\">默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>date_format</code></td>\n<td align=\"left\">日期格式</td>\n<td align=\"left\"><code>YYYY-MM-DD</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>time_format</code></td>\n<td align=\"left\">时间格式</td>\n<td align=\"left\"><code>HH:mm:ss</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>use_date_for_updated</code></td>\n<td align=\"left\">启用以后，如果 Front Matter 中没有指定 <code>updated</code>， <code>post.updated</code> 将会使用 <code>date</code> 的值而不是文件的创建时间。在 Git 工作流中这个选项会很有用</td>\n<td align=\"left\"><code>true</code></td>\n</tr>\n</tbody></table>\n<p>我的配置如下：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\"># Date / Time format\n## Hexo uses Moment.js to parse and display date\n## You can customize the date format as defined in\n## http://momentjs.com/docs/#/displaying/format/\ndate_format: YYYY-MM-DD\ntime_format: HH:mm:ss\n## Use post's date for updated date unless set in front-matter\nuse_date_for_updated: true</code></pre>\n<h2 id=\"分页信息\"><a href=\"#分页信息\" class=\"headerlink\" title=\"分页信息\"></a>分页信息</h2><table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">描述</th>\n<th align=\"left\">默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>per_page</code></td>\n<td align=\"left\">每页显示的文章量 (0 = 关闭分页功能)</td>\n<td align=\"left\"><code>10</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>pagination_dir</code></td>\n<td align=\"left\">分页目录</td>\n<td align=\"left\"><code>page</code></td>\n</tr>\n</tbody></table>\n<p>我的配置如下：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\"># Pagination\n## Set per_page to 0 to disable pagination\nper_page: 12\npagination_dir: page</code></pre>\n<h2 id=\"扩展信息\"><a href=\"#扩展信息\" class=\"headerlink\" title=\"扩展信息\"></a>扩展信息</h2><table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>theme</code></td>\n<td align=\"left\">当前主题名称。值为<code>false</code>时禁用主题</td>\n</tr>\n<tr>\n<td align=\"left\"><code>theme_config</code></td>\n<td align=\"left\">主题的配置文件。在这里放置的配置会覆盖主题目录下的 <code>_config.yml</code> 中的配置</td>\n</tr>\n<tr>\n<td align=\"left\"><code>deploy</code></td>\n<td align=\"left\">部署部分的设置</td>\n</tr>\n<tr>\n<td align=\"left\"><code>meta_generator</code></td>\n<td align=\"left\"><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/meta#属性\" target=\"_blank\" rel=\"noopener\">Meta generator</a> 标签。 值为 <code>false</code> 时 Hexo 不会在头部插入该标签</td>\n</tr>\n</tbody></table>\n<p>这里设置 <code>theme</code> 即可开启对应的主题，具体如何设置会在后面的文章进行详细说明。</p>\n<p><code>theme_config</code> 可以在这里配置主题文件里的各个参数进行覆盖，这样就不用维护两份 <code>config</code> 文件了，不过个人觉得还是不同主题文件使用不同配置文件比较好。</p>\n<p><code>deploy</code> 是部署相关的配置，比如 <code>git</code> 部署，除此之外，还有很多其它部署姿势，比如：<code>Heroku</code>、<code>Netlify</code> 等，但都需要先安装对应的插件。</p>\n<p>我的配置如下：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\"># Extensions\ntheme: hexo-theme-matery\n\n# Deployment\ndeploy:\n  type: 'git'\n  repo: git@github.com:MFrank2016/breeze-blog\n  branch: gh-pages</code></pre>\n<h2 id=\"包括或不包括目录和文件\"><a href=\"#包括或不包括目录和文件\" class=\"headerlink\" title=\"包括或不包括目录和文件\"></a>包括或不包括目录和文件</h2><p>在 <code>Hexo</code> 配置文件中，通过设置 <code>include/exclude</code> 可以让 <code>Hexo</code> 进行处理或忽略某些目录和文件夹。可以使用 <a href=\"https://github.com/isaacs/minimatch\" target=\"_blank\" rel=\"noopener\">glob 表达式</a> 对目录和文件进行匹配。</p>\n<p><code>include</code> 和 <code>exclude</code> 选项都只能应用于 <code>source/</code> 文件夹, 但 <code>ignore</code> 选项可以应用于所有文件夹。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>include</code></td>\n<td align=\"left\"><code>Hexo</code> 默认会忽略隐藏文件和文件夹（包括名称以下划线和 <code>.</code> 开头的文件和文件夹，<code>Hexo</code> 的 <code>_posts</code> 和 <code>_data</code> 等目录除外）。通过设置此字段将使 Hexo 处理他们并将它们复制到 <code>source</code> 目录下。</td>\n</tr>\n<tr>\n<td align=\"left\"><code>exclude</code></td>\n<td align=\"left\"><code>Hexo</code> 会忽略这些文件和目录</td>\n</tr>\n<tr>\n<td align=\"left\"><code>ignore</code></td>\n<td align=\"left\">忽略文件或文件夹</td>\n</tr>\n</tbody></table>\n<p>举例：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\"># Include/Exclude Files/Folders\ninclude:\n  - \".nojekyll\"\n  # 包括 'source/css/_typing.css'\n  - \"css/_typing.css\"\n  # 包括 'source/_css/' 中的任何文件，但不包括子目录及其其中的文件。\n  - \"_css/*\"\n  # 包含 'source/_css/' 中的任何文件和子目录下的任何文件\n  - \"_css/**/*\"\n\nexclude:\n  # 不包括 'source/js/test.js'\n  - \"js/test.js\"\n  # 不包括 'source/js/' 中的文件、但包括子目录下的所有目录和文件\n  - \"js/*\"\n  # 不包括 'source/js/' 中的文件和子目录下的任何文件\n  - \"js/**/*\"\n  # 不包括 'source/js/' 目录下的所有文件名以 'test' 开头的文件，但包括其它文件和子目录下的单文件\n  - \"js/test*\"\n  # 不包括 'source/js/' 及其子目录中任何以 'test' 开头的文件\n  - \"js/**/test*\"\n  # 不要用 exclude 来忽略 'source/_posts/' 中的文件。你应该使用 'skip_render'，或者在要忽略的文件的文件名之前加一个下划线 '_'\n  # 在这里配置一个 - \"_posts/hello-world.md\" 是没有用的。\n\nignore:\n  # Ignore any folder named 'foo'.\n  - \"**/foo\"\n  # Ignore 'foo' folder in 'themes/' only.\n  - \"**/themes/*/foo\"\n  # Same as above, but applies to every subfolders of 'themes/'.\n  - \"**/themes/**/foo\"</code></pre>\n<p>列表中的每一项都必须用单引号或双引号包裹起来。</p>\n<p><code>include</code> 和 <code>exclude</code> 并不适用于 <code>themes/</code> 目录下的文件。如果需要忽略 <code>themes/</code> 目录下的部分文件或文件夹，可以使用 <code>ignore</code> 或在文件名之前添加下划线 <code>_</code>。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>上一篇里，介绍了使用 <code>Hexo</code> + <code>github pages</code> + <code>travis ci</code> 实现自动化博客部署，我们已经收获了一个属于自己的博客，但现在还比较简陋，里面的设置信息都是默认的数据，所以我们需要把它们改成我们想要的内容。</p>\n<p>所以这一篇里，主要介绍 <code>Hexo</code> 的配置文件如何设置。通过本篇的学习，你将知道 <code>Hexo</code> 配置文件的各个属性是什么意思，并给出我使用的配置，这样你就能随心所欲的进行配置了。</p>\n<h2 id=\"站点信息\"><a href=\"#站点信息\" class=\"headerlink\" title=\"站点信息\"></a>站点信息</h2><p>先来看第一部分，站点信息的配置。先说明一下各个字段的含义：</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>title</td>\n<td>网站标题</td>\n</tr>\n<tr>\n<td>subtitle</td>\n<td>网站副标题</td>\n</tr>\n<tr>\n<td>description</td>\n<td>网站描述，主要用于 SEO，告诉搜索引擎关于站点的简要信息</td>\n</tr>\n<tr>\n<td>keywords</td>\n<td>网站的关键词。使用半角逗号, 分隔多个关键词。</td>\n</tr>\n<tr>\n<td>author</td>\n<td>你的名字</td>\n</tr>\n<tr>\n<td>language</td>\n<td>网站使用的语言，常见的有 zh-Hans 、zh-CN 、 en</td>\n</tr>\n<tr>\n<td>timezone</td>\n<td>网站时区。默认使用本地时区。也可以指定其它时区，如 America/New_York, Japan, 和 UTC 。一般的，对于中国大陆地区可以使用 Asia/Shanghai。</td>\n</tr>\n</tbody></table>\n<p>下面是我的配置，可以作为参考：</p>\n<pre><code class=\"yml\"># Site\ntitle: 张征的博客\nsubtitle: &#39;永远年轻，永远热泪盈眶&#39;\ndescription: &#39;铭记过去，拥抱未来，心中有梦，眼里有光&#39;\nkeywords: 生活,编程,阅读,音乐,电影\nauthor: 张征\nlanguage: zh-CN\ntimezone: &#39;&#39;</code></pre>\n<h2 id=\"网址信息\"><a href=\"#网址信息\" class=\"headerlink\" title=\"网址信息\"></a>网址信息</h2><p>网址信息配置主要是设置网站的地址和文章链接格式。</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n<th>默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>url</td>\n<td>网址</td>\n<td></td>\n</tr>\n<tr>\n<td>root</td>\n<td>网站根目录</td>\n<td></td>\n</tr>\n<tr>\n<td>permalink</td>\n<td>文章的永久链接</td>\n<td>格式    :year/:month/:day/:title/</td>\n</tr>\n<tr>\n<td>permalink_defaults</td>\n<td>永久链接中各部分的默认值</td>\n<td></td>\n</tr>\n<tr>\n<td>pretty_urls</td>\n<td>改写 permalink 的值来美化 URL</td>\n<td></td>\n</tr>\n<tr>\n<td>pretty_urls.trailing_index</td>\n<td>是否在永久链接中保留尾部的 index.html，设置为 false 时去除</td>\n<td>true</td>\n</tr>\n<tr>\n<td>pretty_urls.trailing_html</td>\n<td>是否在永久链接中保留尾部的 .html, 设置为 false 时去除 (对尾部的 index.html无效)</td>\n<td>true</td>\n</tr>\n</tbody></table>\n<p>例如：</p>\n<pre><code class=\"yml\"># 比如，一个页面的永久链接是 http://example.com/foo/bar/index.html\npretty_urls:\n  trailing_index: false\n# 此时页面的永久链接会变为 http://example.com/foo/bar/</code></pre>\n<p>这里通常只需要修改 <code>url</code> 和 <code>root</code>，如果博客是使用 <code>github pages</code> 进行部署的，<code>url</code> 配置成对应的博客地址即可。这里需要注意的是 <code>root</code> 的值，如果是按照我们上一篇中的方式进行部署的，则需要把 <code>root</code> 的值设置为 <code>/项目名/</code>。</p>\n<p>下面是我的配置：</p>\n<pre><code class=\"yml\"># URL\n## If your site is put in a subdirectory, set url as &#39;http://yoursite.com/child&#39; and root as &#39;/child/&#39;\nurl: https://mfrank2016.github.io/\nroot: /breeze-blog/\npermalink: :year/:month/:day/:title/\npermalink_defaults:\npretty_urls:\n  trailing_index: true # Set to false to remove trailing &#39;index.html&#39; from permalinks\n  trailing_html: true # Set to false to remove trailing &#39;.html&#39; from permalinks</code></pre>\n<h2 id=\"目录信息\"><a href=\"#目录信息\" class=\"headerlink\" title=\"目录信息\"></a>目录信息</h2><p>目录信息是指定各类目录对应的位置，通常不需要修改。</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n<th>默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>source_dir</td>\n<td>资源文件夹，这个文件夹用来存放博客 <code>md</code> 等文件。</td>\n<td>source</td>\n</tr>\n<tr>\n<td>public_dir</td>\n<td>公共文件夹，这个文件夹用于存放生成的站点静态文件。</td>\n<td>public</td>\n</tr>\n<tr>\n<td>tag_dir</td>\n<td>标签文件夹</td>\n<td>tags</td>\n</tr>\n<tr>\n<td>archive_dir</td>\n<td>归档文件夹</td>\n<td>archives</td>\n</tr>\n<tr>\n<td>category_dir</td>\n<td>分类文件夹</td>\n<td>categories</td>\n</tr>\n<tr>\n<td>code_dir</td>\n<td><code>Include code</code> 文件夹，<code>source_dir</code> 下的子目录</td>\n<td>downloads/code</td>\n</tr>\n<tr>\n<td>i18n_dir</td>\n<td>国际化（i18n）文件夹</td>\n<td>:lang</td>\n</tr>\n<tr>\n<td>skip_render</td>\n<td>跳过指定文件的渲染。匹配到的文件将会被不做改动地复制到 <code>public</code> 目录中。您可使用 <code>glob</code> 表达式来匹配路径。</td>\n<td></td>\n</tr>\n</tbody></table>\n<p>例如：</p>\n<pre><code class=\"yml\">skip_render: &quot;mypage/**/*&quot;\n# 将会直接将 `source/mypage/index.html` 和 `source/mypage/code.js` 不做改动地输出到 &#39;public&#39; 目录\n# 你也可以用这种方法来跳过对指定文章文件的渲染\nskip_render: &quot;_posts/test-post.md&quot;\n# 这将会忽略对 &#39;test-post.md&#39; 的渲染</code></pre>\n<p>我的配置如下：</p>\n<pre><code class=\"yml\"># Directory\nsource_dir: source\npublic_dir: public\ntag_dir: tags\narchive_dir: archives\ncategory_dir: categories\ncode_dir: downloads/code\ni18n_dir: :lang\nskip_render:</code></pre>\n<h2 id=\"文章配置\"><a href=\"#文章配置\" class=\"headerlink\" title=\"文章配置\"></a>文章配置</h2><p>这一部分是配置与文章相关的各类属性。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">描述</th>\n<th align=\"left\">默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>new_post_name</code></td>\n<td align=\"left\">新文章的文件名称</td>\n<td align=\"left\">:title.md</td>\n</tr>\n<tr>\n<td align=\"left\"><code>default_layout</code></td>\n<td align=\"left\">预设布局</td>\n<td align=\"left\">post</td>\n</tr>\n<tr>\n<td align=\"left\"><code>auto_spacing</code></td>\n<td align=\"left\">在中文和英文之间加入空格</td>\n<td align=\"left\">false</td>\n</tr>\n<tr>\n<td align=\"left\"><code>titlecase</code></td>\n<td align=\"left\">把标题转换为 <code>title case</code></td>\n<td align=\"left\">false</td>\n</tr>\n<tr>\n<td align=\"left\"><code>external_link</code></td>\n<td align=\"left\">在新标签中打开链接</td>\n<td align=\"left\">true</td>\n</tr>\n<tr>\n<td align=\"left\"><code>external_link.enable</code></td>\n<td align=\"left\">在新标签中打开链接</td>\n<td align=\"left\"><code>true</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>external_link.field</code></td>\n<td align=\"left\">对整个网站（<code>site</code>）生效或仅对文章（<code>post</code>）生效</td>\n<td align=\"left\"><code>site</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>external_link.exclude</code></td>\n<td align=\"left\">需要排除的域名。主域名和子域名如 <code>www</code> 需分别配置</td>\n<td align=\"left\"><code>[]</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>filename_case</code></td>\n<td align=\"left\">把文件名称转换为 (1) 小写或 (2) 大写</td>\n<td align=\"left\">0</td>\n</tr>\n<tr>\n<td align=\"left\"><code>render_drafts</code></td>\n<td align=\"left\">显示草稿</td>\n<td align=\"left\">false</td>\n</tr>\n<tr>\n<td align=\"left\"><code>post_asset_folder</code></td>\n<td align=\"left\">启动 <code>Asset</code> 文件夹</td>\n<td align=\"left\">false</td>\n</tr>\n<tr>\n<td align=\"left\"><code>relative_link</code></td>\n<td align=\"left\">把链接改为与根目录的相对位址</td>\n<td align=\"left\">false</td>\n</tr>\n<tr>\n<td align=\"left\"><code>future</code></td>\n<td align=\"left\">显示未来的文章</td>\n<td align=\"left\">true</td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight</code></td>\n<td align=\"left\">代码块的设置</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight.enable</code></td>\n<td align=\"left\">开启代码块高亮</td>\n<td align=\"left\"><code>true</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight.auto_detect</code></td>\n<td align=\"left\">如果未指定语言，则启用自动检测</td>\n<td align=\"left\"><code>false</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight.line_number</code></td>\n<td align=\"left\">显示行数</td>\n<td align=\"left\"><code>true</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight.tab_replace</code></td>\n<td align=\"left\">用 n 个空格替换 <code>tabs</code>；如果值为空，则不会替换 <code>tabs</code></td>\n<td align=\"left\"><code>&#39;&#39;</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight.wrap</code></td>\n<td align=\"left\">把代码块用 `` 包裹</td>\n<td align=\"left\"><code>true</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>highlight.hljs</code></td>\n<td align=\"left\">为 highlight 的 css 文件中的类添加 <code>hljs-*</code> 前缀</td>\n<td align=\"left\"><code>false</code></td>\n</tr>\n</tbody></table>\n<p><code>auto_spacing</code> 建议开启，这样的话看起来更美观，<code>titlecase</code> 是指关键单词首字母大写，如果不太清楚，可以看下面的说明：</p>\n<blockquote>\n<p>Titles should be written in title case. This means only using capital letters for the principal words. Articles, conjunctions, and prepositions do not get capital letters unless they start the title. For example:<br>The Last of the Mohicans </p>\n</blockquote>\n<p><code>post_asset_folder</code> 建议开启，这样会在生成新的文章时，同时会同一目录下生成同名文件夹，这样可以把该文章相关的图片等资源放进去，方便引用和管理。</p>\n<p>下面是我的配置：</p>\n<pre><code class=\"yml\">new_post_name: :title.md # File name of new posts\ndefault_layout: post\nauto_spacing: true\ntitlecase: false # Transform title into titlecase\nexternal_link:\n  enable: true # Open external links in new tab\n  field: post # Apply to the whole site\n  exclude: &#39;&#39;\nfilename_case: 0\nrender_drafts: false\npost_asset_folder: true\nrelative_link: false\nfuture: true\n# highlight:\n#   enable: true\n#   line_number: true\n#   auto_detect: false\n#   tab_replace: &#39;&#39;\n#   wrap: true\n#   hljs: false\nhighlight:\n  enable: false\n\n# 代码高亮\nprism_plugin:\n  mode: &#39;preprocess&#39;    # realtime/preprocess\n  theme: &#39;tomorrow&#39;\n  line_number: false    # default false\n  custom_css:</code></pre>\n<p>这里我使用了另一个代码高亮插件，如果通常使用默认的 <code>hljs</code> 高亮即可。如果也想要使用这个插件，可以查看<a href=\"https://github.com/ele828/hexo-prism-plugin\" target=\"_blank\" rel=\"noopener\">这里</a>，需要先进行安装：</p>\n<pre><code class=\"bash\">npm i -S hexo-prism-plugin</code></pre>\n<h2 id=\"分类和标签信息\"><a href=\"#分类和标签信息\" class=\"headerlink\" title=\"分类和标签信息\"></a>分类和标签信息</h2><p>这里配置的是别名，即映射信息，如果文章使用的是英文名分类，这里可以不用设置，如果使用了中文名分类，最好配置一些对应的英文名，否则在对应的分类链接中就会出现 <code>URL</code> 编码的中文，比如这样：</p>\n<pre><code>http://localhost:4000/breeze-blog/categories/programming/life/%E6%B5%8B%E8%AF%95/</code></pre><table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">描述</th>\n<th align=\"left\">默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>default_category</code></td>\n<td align=\"left\">默认分类</td>\n<td align=\"left\"><code>uncategorized</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>category_map</code></td>\n<td align=\"left\">分类别名</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"><code>tag_map</code></td>\n<td align=\"left\">标签别名</td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>我的配置如下：</p>\n<pre><code class=\"yml\"># Category &amp; Tag\ndefault_category: uncategorized\ncategory_map:\n  编程: programming\n  生活: life\n  阅读: reading\n  随想: thoughts\n  理财: finance\ntag_map:\n  敏捷开发: agile-development\n  环境搭建: environment-building</code></pre>\n<h2 id=\"日期-时间格式\"><a href=\"#日期-时间格式\" class=\"headerlink\" title=\"日期 / 时间格式\"></a>日期 / 时间格式</h2><p><code>Hexo</code> 使用 <a href=\"http://momentjs.com/\" target=\"_blank\" rel=\"noopener\">Moment.js</a> 来解析和显示时间。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">描述</th>\n<th align=\"left\">默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>date_format</code></td>\n<td align=\"left\">日期格式</td>\n<td align=\"left\"><code>YYYY-MM-DD</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>time_format</code></td>\n<td align=\"left\">时间格式</td>\n<td align=\"left\"><code>HH:mm:ss</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>use_date_for_updated</code></td>\n<td align=\"left\">启用以后，如果 Front Matter 中没有指定 <code>updated</code>， <code>post.updated</code> 将会使用 <code>date</code> 的值而不是文件的创建时间。在 Git 工作流中这个选项会很有用</td>\n<td align=\"left\"><code>true</code></td>\n</tr>\n</tbody></table>\n<p>我的配置如下：</p>\n<pre><code class=\"yml\"># Date / Time format\n## Hexo uses Moment.js to parse and display date\n## You can customize the date format as defined in\n## http://momentjs.com/docs/#/displaying/format/\ndate_format: YYYY-MM-DD\ntime_format: HH:mm:ss\n## Use post&#39;s date for updated date unless set in front-matter\nuse_date_for_updated: true</code></pre>\n<h2 id=\"分页信息\"><a href=\"#分页信息\" class=\"headerlink\" title=\"分页信息\"></a>分页信息</h2><table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">描述</th>\n<th align=\"left\">默认值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>per_page</code></td>\n<td align=\"left\">每页显示的文章量 (0 = 关闭分页功能)</td>\n<td align=\"left\"><code>10</code></td>\n</tr>\n<tr>\n<td align=\"left\"><code>pagination_dir</code></td>\n<td align=\"left\">分页目录</td>\n<td align=\"left\"><code>page</code></td>\n</tr>\n</tbody></table>\n<p>我的配置如下：</p>\n<pre><code class=\"yml\"># Pagination\n## Set per_page to 0 to disable pagination\nper_page: 12\npagination_dir: page</code></pre>\n<h2 id=\"扩展信息\"><a href=\"#扩展信息\" class=\"headerlink\" title=\"扩展信息\"></a>扩展信息</h2><table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>theme</code></td>\n<td align=\"left\">当前主题名称。值为<code>false</code>时禁用主题</td>\n</tr>\n<tr>\n<td align=\"left\"><code>theme_config</code></td>\n<td align=\"left\">主题的配置文件。在这里放置的配置会覆盖主题目录下的 <code>_config.yml</code> 中的配置</td>\n</tr>\n<tr>\n<td align=\"left\"><code>deploy</code></td>\n<td align=\"left\">部署部分的设置</td>\n</tr>\n<tr>\n<td align=\"left\"><code>meta_generator</code></td>\n<td align=\"left\"><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/meta#属性\" target=\"_blank\" rel=\"noopener\">Meta generator</a> 标签。 值为 <code>false</code> 时 Hexo 不会在头部插入该标签</td>\n</tr>\n</tbody></table>\n<p>这里设置 <code>theme</code> 即可开启对应的主题，具体如何设置会在后面的文章进行详细说明。</p>\n<p><code>theme_config</code> 可以在这里配置主题文件里的各个参数进行覆盖，这样就不用维护两份 <code>config</code> 文件了，不过个人觉得还是不同主题文件使用不同配置文件比较好。</p>\n<p><code>deploy</code> 是部署相关的配置，比如 <code>git</code> 部署，除此之外，还有很多其它部署姿势，比如：<code>Heroku</code>、<code>Netlify</code> 等，但都需要先安装对应的插件。</p>\n<p>我的配置如下：</p>\n<pre><code class=\"yml\"># Extensions\ntheme: hexo-theme-matery\n\n# Deployment\ndeploy:\n  type: &#39;git&#39;\n  repo: git@github.com:MFrank2016/breeze-blog\n  branch: gh-pages</code></pre>\n<h2 id=\"包括或不包括目录和文件\"><a href=\"#包括或不包括目录和文件\" class=\"headerlink\" title=\"包括或不包括目录和文件\"></a>包括或不包括目录和文件</h2><p>在 <code>Hexo</code> 配置文件中，通过设置 <code>include/exclude</code> 可以让 <code>Hexo</code> 进行处理或忽略某些目录和文件夹。可以使用 <a href=\"https://github.com/isaacs/minimatch\" target=\"_blank\" rel=\"noopener\">glob 表达式</a> 对目录和文件进行匹配。</p>\n<p><code>include</code> 和 <code>exclude</code> 选项都只能应用于 <code>source/</code> 文件夹, 但 <code>ignore</code> 选项可以应用于所有文件夹。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>include</code></td>\n<td align=\"left\"><code>Hexo</code> 默认会忽略隐藏文件和文件夹（包括名称以下划线和 <code>.</code> 开头的文件和文件夹，<code>Hexo</code> 的 <code>_posts</code> 和 <code>_data</code> 等目录除外）。通过设置此字段将使 Hexo 处理他们并将它们复制到 <code>source</code> 目录下。</td>\n</tr>\n<tr>\n<td align=\"left\"><code>exclude</code></td>\n<td align=\"left\"><code>Hexo</code> 会忽略这些文件和目录</td>\n</tr>\n<tr>\n<td align=\"left\"><code>ignore</code></td>\n<td align=\"left\">忽略文件或文件夹</td>\n</tr>\n</tbody></table>\n<p>举例：</p>\n<pre><code class=\"yml\"># Include/Exclude Files/Folders\ninclude:\n  - &quot;.nojekyll&quot;\n  # 包括 &#39;source/css/_typing.css&#39;\n  - &quot;css/_typing.css&quot;\n  # 包括 &#39;source/_css/&#39; 中的任何文件，但不包括子目录及其其中的文件。\n  - &quot;_css/*&quot;\n  # 包含 &#39;source/_css/&#39; 中的任何文件和子目录下的任何文件\n  - &quot;_css/**/*&quot;\n\nexclude:\n  # 不包括 &#39;source/js/test.js&#39;\n  - &quot;js/test.js&quot;\n  # 不包括 &#39;source/js/&#39; 中的文件、但包括子目录下的所有目录和文件\n  - &quot;js/*&quot;\n  # 不包括 &#39;source/js/&#39; 中的文件和子目录下的任何文件\n  - &quot;js/**/*&quot;\n  # 不包括 &#39;source/js/&#39; 目录下的所有文件名以 &#39;test&#39; 开头的文件，但包括其它文件和子目录下的单文件\n  - &quot;js/test*&quot;\n  # 不包括 &#39;source/js/&#39; 及其子目录中任何以 &#39;test&#39; 开头的文件\n  - &quot;js/**/test*&quot;\n  # 不要用 exclude 来忽略 &#39;source/_posts/&#39; 中的文件。你应该使用 &#39;skip_render&#39;，或者在要忽略的文件的文件名之前加一个下划线 &#39;_&#39;\n  # 在这里配置一个 - &quot;_posts/hello-world.md&quot; 是没有用的。\n\nignore:\n  # Ignore any folder named &#39;foo&#39;.\n  - &quot;**/foo&quot;\n  # Ignore &#39;foo&#39; folder in &#39;themes/&#39; only.\n  - &quot;**/themes/*/foo&quot;\n  # Same as above, but applies to every subfolders of &#39;themes/&#39;.\n  - &quot;**/themes/**/foo&quot;</code></pre>\n<p>列表中的每一项都必须用单引号或双引号包裹起来。</p>\n<p><code>include</code> 和 <code>exclude</code> 并不适用于 <code>themes/</code> 目录下的文件。如果需要忽略 <code>themes/</code> 目录下的部分文件或文件夹，可以使用 <code>ignore</code> 或在文件名之前添加下划线 <code>_</code>。</p>\n"},{"title":"【Go语言绘图】gg 库的基本使用","toc":true,"top":true,"cover":true,"date":"2020-11-29T14:45:35.000Z","_content":"\n最近接了个比较大的需求，需要做很多图片处理的事情，比如图片的旋转裁截拼接，各种渐变处理，文字排列，一开始光是想想就头疼。但没有办法，既然已经需求已经到手上了，那就得把它做好才行，于是便开始被迫营业，无证上岗了。\n\n经过一番查找，找到了一个Go语言图片处理的库，经过调研发现还挺强的，能满足需求，于是决定写点文章，记录一下使用心得，以便日后不时之需。\n\n## gg 库的安装和简单使用\n\n使用之前，我们当然得先来安装一下这个库：\n\n```go\ngo get -u github.com/fogleman/gg\n```\n\n这个库的一个好处是有很多测试代码，可以拿来跑跑看，就知道它大概能实现什么样的效果了。\n\n![](1.png)\n\n这是它例子的大概效果图，可以看到，能实现的图形效果还是挺多的。\n\n![](2.png)\n\n我们拿其中的一个代码来简单体验一下：\n\n```go\npackage main\n\nimport \"github.com/fogleman/gg\"\n\nfunc main() {\n    dc := gg.NewContext(1000, 1000)\n    dc.DrawCircle(500, 500, 400)\n    dc.SetRGB(0, 0, 0)\n    dc.Fill()\n    dc.SavePNG(\"out.png\")\n}\n```\n\nduang 的一下，一张黑不溜秋的圆形图就生成了。\n\n![](3.png)\n\n关于上面的代码，下面会进行逐一说明。\n\n## 调整生成图片的大小\n\n```go\ndc := gg.NewContext(1000, 1000)\n```\n\n这是先初始化一个 `Context` 对象，使用库之前都需要先初始化一个 `Context` 对象，后面的两个 `1000`，分别对应着最终生成图片的宽度和高度。我们可以修改一下高度为 `500` 看看效果。\n\n```go\ndc := gg.NewContext(1000, 500)\n```\n\n![](4.png)\n\n可以看到图片被腰斩了，高度矮了一半，同样修改宽度参数也可以得到类似的效果，这里就不演示了。\n\n## 调整圆形参数\n\n```go\ndc.DrawCircle(500, 500, 400)\n```\n\n这里是画一个圆心位置在 `(500,500)`，半径为 `400` 的圆形。需要说明的一点是，这里的坐标轴是以左上角为原点的，水平向右是横轴正方向，竖直向下是纵轴正方向，所以`(500,500)`正是中心位置。我们可以调整一下参数值来看下效果。\n\n```go\ndc := gg.NewContext(1000, 1000)\ndc.DrawCircle(300, 300, 400)\n```\n\n![](5.png)\n\n可以看到，圆心往左上角移动了。还可以调整一下半径参数试试：\n\n```go\ndc := gg.NewContext(1000, 1000)\ndc.DrawCircle(300, 300, 300)\n```\n\n![](6.png)\n\n这样我们又得到了一个完整的圆。\n\n## 调整颜色\n\n```go\ndc.SetRGB(0, 0, 0)\ndc.Fill()\n```\n\n这两句的意思是先设置颜色值为 `(0,0,0)`，也就是黑色，乍眼一看这三个值分别对应的是颜色的 `R、G、B`值，但实际上完全不是这么回事，这里需要注意的是，这三个值分别代表红色、绿色、蓝色的程度，所以如果分别设置为，会得到下面的三张图。\n\n![](7.png)\n![](8.png)\n![](9.png)\n\n那如果想要根据RGB值来设置颜色该怎么处理呢？其实也很简单，做一个压缩映射即可，`RGB`值的范围是0～255，表示的含义也是对应色值的程度，这里不过将范围变成了0～1，那我们将需要使用到的值除以255就可以得到对应的映射值了。具体的颜色RGB值跟颜色的对应关系可以在网上搜到。\n\nhttps://tool.oschina.net/commons?type=3\n\n下面我们用淡黄色做一个例子，对应的 `RGB` 值是 `(255,222,173)` ，我们添加一下映射转换的代码即可：\n\n```go\nvar rbgConverter = func(r []float64) []float64 {\n\tresult := make([]float64, 0)\n\tfor i := 0; i < len(r); i++ {\n\t\tresult = append(result, r[i] / 255)\n\t}\n\treturn result\n}\n\nfunc main() {\n\tdc := gg.NewContext(1000, 1000)\n\n\tdc.DrawCircle(500, 500, 400)\n\n\trgb := []float64{255,222,173}\n\tnewRgb := rbgConverter(rgb)\n\n\tdc.SetRGB(newRgb[0], newRgb[1], newRgb[2])\n\tdc.Fill()\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n这样我们就得到了一张黄图。\n\n![](10.png)\n\n## 保存图片\n\n```go\ndc.SavePNG(\"out.png\")\n```\n\n`SavePNG()` 方法可以将当前图形保存成 `PNG` 格式文件，路径可以是相对路径，也可以是绝对路径。\n\n`SaveJPG()` 方法可以将当前图形保存成 `JPG` 格式文件。\n\n当然，这里的两个方法其实也只是包装了一下，点进代码可以看到，里面并没有什么奇奇怪怪的逻辑。\n\n```go\n// SavePNG encodes the image as a PNG and writes it to disk.\nfunc (dc *Context) SavePNG(path string) error {\n\treturn SavePNG(path, dc.im)\n}\n\nfunc SavePNG(path string, im image.Image) error {\n\tfile, err := os.Create(path)\n\tif err != nil {\n\t\treturn err\n\t}\n\tdefer file.Close()\n\treturn png.Encode(file, im)\n}\n```\n\n所以，我们也可以根据自己的需要将图片保存成其它格式或者存到其它地方。\n\n## 加载图片\n\n加载图片有三个方法可以实现，`LoadPNG()` 用来加载 `PNG` 格式的图片，`LoadJPG()` 用来加载 `JPG` 格式的图片，如果不清楚该用什么方法，可以直接使用 `LoadImage()` 方法来加载图片。\n\n加载图片后，得到的是一个 `image.Image` 对象，可以通过该对象来获取图片的一些基本信息，如：图片的长和宽、图片某一点的颜色RGB值。\n\n加载图片之后，可以使用 `DrawImage()` 方法来将图片绘制出来，以便用于后续操作。\n\n```go\nim, err := gg.LoadImage(\"/Users/bytedance/Desktop/test.jpg\")\nif err != nil {\n    panic(err)\n}\nw := im.Bounds().Size().X\nh := im.Bounds().Size().Y\n\ndc := gg.NewContext(h, w)\ndc.DrawImage(im, 0, 0)\n```\n\n## 裁剪\n\n有一个经常使用到的方法叫 `Clip()` ，该方法可以将图像进行裁剪，裁剪的形状取决于之前画的图形。\n\n下面来举个例子，这是我们要裁剪的图，我们用一个圆形来对它进行裁剪。\n\n![](11.png)\n\n```go\nfunc main() {\n    // 加载图片，这里路径换成自己的\n\tim, err := gg.LoadImage(\"test.jpg\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n    // 获取图片的宽度和高度\n\tw := im.Bounds().Size().X\n\th := im.Bounds().Size().Y\n\n\tdc := gg.NewContext(h, w)\n    \n    \n    // 取宽度和高度的最小值作为直径\n\tradius := math.Min(float64(w), float64(h)) / 2\n    // 画圆形\n\tdc.DrawCircle(float64(w/2), float64(h/2), radius)\n    // 对画布进行裁剪\n\tdc.Clip()\n    // 加载图片\n\tdc.DrawImage(im, 0, 0)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n![](12.png)\n\n这样一来，头像就做好了【手动狗头】。\n\n## 小结\n\nGo 语言也可以实现对图片进行很多类型的操作，今天主要介绍了图片的加载、保存、绘制圆形、调整大小和颜色以及裁剪。之后还会进一步介绍其它功能。\n\n我觉得如果不是需要使用并没有熟悉它的必要，但知道有这么个东西，知道它能实现什么样的效果，可以让你手上的牌又多了一张，以后有需要的时候便不至于捉襟见肘了。所以还在等什么，赶紧点赞收藏加关注吧～\n","source":"_posts/picture/go-basic-usage-of-gg-package.md","raw":"---\ntitle: 【Go语言绘图】gg 库的基本使用\ntags:\n  - go\ncategories:\n  - 编程\ntoc: true\ntop: true\ncover: true\ndate: 2020-11-29 22:45:35\n---\n\n最近接了个比较大的需求，需要做很多图片处理的事情，比如图片的旋转裁截拼接，各种渐变处理，文字排列，一开始光是想想就头疼。但没有办法，既然已经需求已经到手上了，那就得把它做好才行，于是便开始被迫营业，无证上岗了。\n\n经过一番查找，找到了一个Go语言图片处理的库，经过调研发现还挺强的，能满足需求，于是决定写点文章，记录一下使用心得，以便日后不时之需。\n\n## gg 库的安装和简单使用\n\n使用之前，我们当然得先来安装一下这个库：\n\n```go\ngo get -u github.com/fogleman/gg\n```\n\n这个库的一个好处是有很多测试代码，可以拿来跑跑看，就知道它大概能实现什么样的效果了。\n\n![](1.png)\n\n这是它例子的大概效果图，可以看到，能实现的图形效果还是挺多的。\n\n![](2.png)\n\n我们拿其中的一个代码来简单体验一下：\n\n```go\npackage main\n\nimport \"github.com/fogleman/gg\"\n\nfunc main() {\n    dc := gg.NewContext(1000, 1000)\n    dc.DrawCircle(500, 500, 400)\n    dc.SetRGB(0, 0, 0)\n    dc.Fill()\n    dc.SavePNG(\"out.png\")\n}\n```\n\nduang 的一下，一张黑不溜秋的圆形图就生成了。\n\n![](3.png)\n\n关于上面的代码，下面会进行逐一说明。\n\n## 调整生成图片的大小\n\n```go\ndc := gg.NewContext(1000, 1000)\n```\n\n这是先初始化一个 `Context` 对象，使用库之前都需要先初始化一个 `Context` 对象，后面的两个 `1000`，分别对应着最终生成图片的宽度和高度。我们可以修改一下高度为 `500` 看看效果。\n\n```go\ndc := gg.NewContext(1000, 500)\n```\n\n![](4.png)\n\n可以看到图片被腰斩了，高度矮了一半，同样修改宽度参数也可以得到类似的效果，这里就不演示了。\n\n## 调整圆形参数\n\n```go\ndc.DrawCircle(500, 500, 400)\n```\n\n这里是画一个圆心位置在 `(500,500)`，半径为 `400` 的圆形。需要说明的一点是，这里的坐标轴是以左上角为原点的，水平向右是横轴正方向，竖直向下是纵轴正方向，所以`(500,500)`正是中心位置。我们可以调整一下参数值来看下效果。\n\n```go\ndc := gg.NewContext(1000, 1000)\ndc.DrawCircle(300, 300, 400)\n```\n\n![](5.png)\n\n可以看到，圆心往左上角移动了。还可以调整一下半径参数试试：\n\n```go\ndc := gg.NewContext(1000, 1000)\ndc.DrawCircle(300, 300, 300)\n```\n\n![](6.png)\n\n这样我们又得到了一个完整的圆。\n\n## 调整颜色\n\n```go\ndc.SetRGB(0, 0, 0)\ndc.Fill()\n```\n\n这两句的意思是先设置颜色值为 `(0,0,0)`，也就是黑色，乍眼一看这三个值分别对应的是颜色的 `R、G、B`值，但实际上完全不是这么回事，这里需要注意的是，这三个值分别代表红色、绿色、蓝色的程度，所以如果分别设置为，会得到下面的三张图。\n\n![](7.png)\n![](8.png)\n![](9.png)\n\n那如果想要根据RGB值来设置颜色该怎么处理呢？其实也很简单，做一个压缩映射即可，`RGB`值的范围是0～255，表示的含义也是对应色值的程度，这里不过将范围变成了0～1，那我们将需要使用到的值除以255就可以得到对应的映射值了。具体的颜色RGB值跟颜色的对应关系可以在网上搜到。\n\nhttps://tool.oschina.net/commons?type=3\n\n下面我们用淡黄色做一个例子，对应的 `RGB` 值是 `(255,222,173)` ，我们添加一下映射转换的代码即可：\n\n```go\nvar rbgConverter = func(r []float64) []float64 {\n\tresult := make([]float64, 0)\n\tfor i := 0; i < len(r); i++ {\n\t\tresult = append(result, r[i] / 255)\n\t}\n\treturn result\n}\n\nfunc main() {\n\tdc := gg.NewContext(1000, 1000)\n\n\tdc.DrawCircle(500, 500, 400)\n\n\trgb := []float64{255,222,173}\n\tnewRgb := rbgConverter(rgb)\n\n\tdc.SetRGB(newRgb[0], newRgb[1], newRgb[2])\n\tdc.Fill()\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n这样我们就得到了一张黄图。\n\n![](10.png)\n\n## 保存图片\n\n```go\ndc.SavePNG(\"out.png\")\n```\n\n`SavePNG()` 方法可以将当前图形保存成 `PNG` 格式文件，路径可以是相对路径，也可以是绝对路径。\n\n`SaveJPG()` 方法可以将当前图形保存成 `JPG` 格式文件。\n\n当然，这里的两个方法其实也只是包装了一下，点进代码可以看到，里面并没有什么奇奇怪怪的逻辑。\n\n```go\n// SavePNG encodes the image as a PNG and writes it to disk.\nfunc (dc *Context) SavePNG(path string) error {\n\treturn SavePNG(path, dc.im)\n}\n\nfunc SavePNG(path string, im image.Image) error {\n\tfile, err := os.Create(path)\n\tif err != nil {\n\t\treturn err\n\t}\n\tdefer file.Close()\n\treturn png.Encode(file, im)\n}\n```\n\n所以，我们也可以根据自己的需要将图片保存成其它格式或者存到其它地方。\n\n## 加载图片\n\n加载图片有三个方法可以实现，`LoadPNG()` 用来加载 `PNG` 格式的图片，`LoadJPG()` 用来加载 `JPG` 格式的图片，如果不清楚该用什么方法，可以直接使用 `LoadImage()` 方法来加载图片。\n\n加载图片后，得到的是一个 `image.Image` 对象，可以通过该对象来获取图片的一些基本信息，如：图片的长和宽、图片某一点的颜色RGB值。\n\n加载图片之后，可以使用 `DrawImage()` 方法来将图片绘制出来，以便用于后续操作。\n\n```go\nim, err := gg.LoadImage(\"/Users/bytedance/Desktop/test.jpg\")\nif err != nil {\n    panic(err)\n}\nw := im.Bounds().Size().X\nh := im.Bounds().Size().Y\n\ndc := gg.NewContext(h, w)\ndc.DrawImage(im, 0, 0)\n```\n\n## 裁剪\n\n有一个经常使用到的方法叫 `Clip()` ，该方法可以将图像进行裁剪，裁剪的形状取决于之前画的图形。\n\n下面来举个例子，这是我们要裁剪的图，我们用一个圆形来对它进行裁剪。\n\n![](11.png)\n\n```go\nfunc main() {\n    // 加载图片，这里路径换成自己的\n\tim, err := gg.LoadImage(\"test.jpg\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n    // 获取图片的宽度和高度\n\tw := im.Bounds().Size().X\n\th := im.Bounds().Size().Y\n\n\tdc := gg.NewContext(h, w)\n    \n    \n    // 取宽度和高度的最小值作为直径\n\tradius := math.Min(float64(w), float64(h)) / 2\n    // 画圆形\n\tdc.DrawCircle(float64(w/2), float64(h/2), radius)\n    // 对画布进行裁剪\n\tdc.Clip()\n    // 加载图片\n\tdc.DrawImage(im, 0, 0)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n![](12.png)\n\n这样一来，头像就做好了【手动狗头】。\n\n## 小结\n\nGo 语言也可以实现对图片进行很多类型的操作，今天主要介绍了图片的加载、保存、绘制圆形、调整大小和颜色以及裁剪。之后还会进一步介绍其它功能。\n\n我觉得如果不是需要使用并没有熟悉它的必要，但知道有这么个东西，知道它能实现什么样的效果，可以让你手上的牌又多了一张，以后有需要的时候便不至于捉襟见肘了。所以还在等什么，赶紧点赞收藏加关注吧～\n","slug":"picture/go-basic-usage-of-gg-package","published":1,"updated":"2020-11-29T14:45:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfb9000f5ohuak0a9el4","content":"<p>最近接了个比较大的需求，需要做很多图片处理的事情，比如图片的旋转裁截拼接，各种渐变处理，文字排列，一开始光是想想就头疼。但没有办法，既然已经需求已经到手上了，那就得把它做好才行，于是便开始被迫营业，无证上岗了。</p>\n<p>经过一番查找，找到了一个Go语言图片处理的库，经过调研发现还挺强的，能满足需求，于是决定写点文章，记录一下使用心得，以便日后不时之需。</p>\n<h2 id=\"gg-库的安装和简单使用\"><a href=\"#gg-库的安装和简单使用\" class=\"headerlink\" title=\"gg 库的安装和简单使用\"></a>gg 库的安装和简单使用</h2><p>使用之前，我们当然得先来安装一下这个库：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">go</span> get <span class=\"token operator\">-</span>u github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>fogleman<span class=\"token operator\">/</span>gg</code></pre>\n<p>这个库的一个好处是有很多测试代码，可以拿来跑跑看，就知道它大概能实现什么样的效果了。</p>\n<p><img src=\"1.png\" alt=\"\"></p>\n<p>这是它例子的大概效果图，可以看到，能实现的图形效果还是挺多的。</p>\n<p><img src=\"2.png\" alt=\"\"></p>\n<p>我们拿其中的一个代码来简单体验一下：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"github.com/fogleman/gg\"</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawCircle</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>duang 的一下，一张黑不溜秋的圆形图就生成了。</p>\n<p><img src=\"3.png\" alt=\"\"></p>\n<p>关于上面的代码，下面会进行逐一说明。</p>\n<h2 id=\"调整生成图片的大小\"><a href=\"#调整生成图片的大小\" class=\"headerlink\" title=\"调整生成图片的大小\"></a>调整生成图片的大小</h2><pre class=\" language-go\"><code class=\"language-go\">dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span></code></pre>\n<p>这是先初始化一个 <code>Context</code> 对象，使用库之前都需要先初始化一个 <code>Context</code> 对象，后面的两个 <code>1000</code>，分别对应着最终生成图片的宽度和高度。我们可以修改一下高度为 <code>500</code> 看看效果。</p>\n<pre class=\" language-go\"><code class=\"language-go\">dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span></code></pre>\n<p><img src=\"4.png\" alt=\"\"></p>\n<p>可以看到图片被腰斩了，高度矮了一半，同样修改宽度参数也可以得到类似的效果，这里就不演示了。</p>\n<h2 id=\"调整圆形参数\"><a href=\"#调整圆形参数\" class=\"headerlink\" title=\"调整圆形参数\"></a>调整圆形参数</h2><pre class=\" language-go\"><code class=\"language-go\">dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawCircle</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span></code></pre>\n<p>这里是画一个圆心位置在 <code>(500,500)</code>，半径为 <code>400</code> 的圆形。需要说明的一点是，这里的坐标轴是以左上角为原点的，水平向右是横轴正方向，竖直向下是纵轴正方向，所以<code>(500,500)</code>正是中心位置。我们可以调整一下参数值来看下效果。</p>\n<pre class=\" language-go\"><code class=\"language-go\">dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\ndc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawCircle</span><span class=\"token punctuation\">(</span><span class=\"token number\">300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span></code></pre>\n<p><img src=\"5.png\" alt=\"\"></p>\n<p>可以看到，圆心往左上角移动了。还可以调整一下半径参数试试：</p>\n<pre class=\" language-go\"><code class=\"language-go\">dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\ndc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawCircle</span><span class=\"token punctuation\">(</span><span class=\"token number\">300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span></code></pre>\n<p><img src=\"6.png\" alt=\"\"></p>\n<p>这样我们又得到了一个完整的圆。</p>\n<h2 id=\"调整颜色\"><a href=\"#调整颜色\" class=\"headerlink\" title=\"调整颜色\"></a>调整颜色</h2><pre class=\" language-go\"><code class=\"language-go\">dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\ndc<span class=\"token punctuation\">.</span><span class=\"token function\">Fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre>\n<p>这两句的意思是先设置颜色值为 <code>(0,0,0)</code>，也就是黑色，乍眼一看这三个值分别对应的是颜色的 <code>R、G、B</code>值，但实际上完全不是这么回事，这里需要注意的是，这三个值分别代表红色、绿色、蓝色的程度，所以如果分别设置为，会得到下面的三张图。</p>\n<p><img src=\"7.png\" alt=\"\"><br><img src=\"8.png\" alt=\"\"><br><img src=\"9.png\" alt=\"\"></p>\n<p>那如果想要根据RGB值来设置颜色该怎么处理呢？其实也很简单，做一个压缩映射即可，<code>RGB</code>值的范围是0～255，表示的含义也是对应色值的程度，这里不过将范围变成了0～1，那我们将需要使用到的值除以255就可以得到对应的映射值了。具体的颜色RGB值跟颜色的对应关系可以在网上搜到。</p>\n<p><a href=\"https://tool.oschina.net/commons?type=3\" target=\"_blank\" rel=\"noopener\">https://tool.oschina.net/commons?type=3</a></p>\n<p>下面我们用淡黄色做一个例子，对应的 <code>RGB</code> 值是 <code>(255,222,173)</code> ，我们添加一下映射转换的代码即可：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">var</span> rbgConverter <span class=\"token operator\">=</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>r <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">float64</span> <span class=\"token punctuation\">{</span>\n    result <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">float64</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token operator\">:=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span> <span class=\"token punctuation\">{</span>\n        result <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">/</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> result\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawCircle</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span>\n\n    rgb <span class=\"token operator\">:=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">float64</span><span class=\"token punctuation\">{</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">222</span><span class=\"token punctuation\">,</span><span class=\"token number\">173</span><span class=\"token punctuation\">}</span>\n    newRgb <span class=\"token operator\">:=</span> <span class=\"token function\">rbgConverter</span><span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">)</span>\n\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span>newRgb<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> newRgb<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> newRgb<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这样我们就得到了一张黄图。</p>\n<p><img src=\"10.png\" alt=\"\"></p>\n<h2 id=\"保存图片\"><a href=\"#保存图片\" class=\"headerlink\" title=\"保存图片\"></a>保存图片</h2><pre class=\" language-go\"><code class=\"language-go\">dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span></code></pre>\n<p><code>SavePNG()</code> 方法可以将当前图形保存成 <code>PNG</code> 格式文件，路径可以是相对路径，也可以是绝对路径。</p>\n<p><code>SaveJPG()</code> 方法可以将当前图形保存成 <code>JPG</code> 格式文件。</p>\n<p>当然，这里的两个方法其实也只是包装了一下，点进代码可以看到，里面并没有什么奇奇怪怪的逻辑。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token comment\" spellcheck=\"true\">// SavePNG encodes the image as a PNG and writes it to disk.</span>\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>Context<span class=\"token punctuation\">)</span> <span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span>path <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">error</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> dc<span class=\"token punctuation\">.</span>im<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span>path <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> im image<span class=\"token punctuation\">.</span>Image<span class=\"token punctuation\">)</span> <span class=\"token builtin\">error</span> <span class=\"token punctuation\">{</span>\n    file<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> os<span class=\"token punctuation\">.</span><span class=\"token function\">Create</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> err\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">defer</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> png<span class=\"token punctuation\">.</span><span class=\"token function\">Encode</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> im<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>所以，我们也可以根据自己的需要将图片保存成其它格式或者存到其它地方。</p>\n<h2 id=\"加载图片\"><a href=\"#加载图片\" class=\"headerlink\" title=\"加载图片\"></a>加载图片</h2><p>加载图片有三个方法可以实现，<code>LoadPNG()</code> 用来加载 <code>PNG</code> 格式的图片，<code>LoadJPG()</code> 用来加载 <code>JPG</code> 格式的图片，如果不清楚该用什么方法，可以直接使用 <code>LoadImage()</code> 方法来加载图片。</p>\n<p>加载图片后，得到的是一个 <code>image.Image</code> 对象，可以通过该对象来获取图片的一些基本信息，如：图片的长和宽、图片某一点的颜色RGB值。</p>\n<p>加载图片之后，可以使用 <code>DrawImage()</code> 方法来将图片绘制出来，以便用于后续操作。</p>\n<pre class=\" language-go\"><code class=\"language-go\">im<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">LoadImage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/Users/bytedance/Desktop/test.jpg\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\nw <span class=\"token operator\">:=</span> im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>X\nh <span class=\"token operator\">:=</span> im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Y\n\ndc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">)</span>\ndc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawImage</span><span class=\"token punctuation\">(</span>im<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></code></pre>\n<h2 id=\"裁剪\"><a href=\"#裁剪\" class=\"headerlink\" title=\"裁剪\"></a>裁剪</h2><p>有一个经常使用到的方法叫 <code>Clip()</code> ，该方法可以将图像进行裁剪，裁剪的形状取决于之前画的图形。</p>\n<p>下面来举个例子，这是我们要裁剪的图，我们用一个圆形来对它进行裁剪。</p>\n<p><img src=\"11.png\" alt=\"\"></p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\" spellcheck=\"true\">// 加载图片，这里路径换成自己的</span>\n    im<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">LoadImage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.jpg\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 获取图片的宽度和高度</span>\n    w <span class=\"token operator\">:=</span> im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>X\n    h <span class=\"token operator\">:=</span> im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Y\n\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">)</span>\n\n\n    <span class=\"token comment\" spellcheck=\"true\">// 取宽度和高度的最小值作为直径</span>\n    radius <span class=\"token operator\">:=</span> math<span class=\"token punctuation\">.</span><span class=\"token function\">Min</span><span class=\"token punctuation\">(</span><span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n    <span class=\"token comment\" spellcheck=\"true\">// 画圆形</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawCircle</span><span class=\"token punctuation\">(</span><span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>w<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>h<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> radius<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\" spellcheck=\"true\">// 对画布进行裁剪</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Clip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\" spellcheck=\"true\">// 加载图片</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawImage</span><span class=\"token punctuation\">(</span>im<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><img src=\"12.png\" alt=\"\"></p>\n<p>这样一来，头像就做好了【手动狗头】。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>Go 语言也可以实现对图片进行很多类型的操作，今天主要介绍了图片的加载、保存、绘制圆形、调整大小和颜色以及裁剪。之后还会进一步介绍其它功能。</p>\n<p>我觉得如果不是需要使用并没有熟悉它的必要，但知道有这么个东西，知道它能实现什么样的效果，可以让你手上的牌又多了一张，以后有需要的时候便不至于捉襟见肘了。所以还在等什么，赶紧点赞收藏加关注吧～</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<p>最近接了个比较大的需求，需要做很多图片处理的事情，比如图片的旋转裁截拼接，各种渐变处理，文字排列，一开始光是想想就头疼。但没有办法，既然已经需求已经到手上了，那就得把它做好才行，于是便开始被迫营业，无证上岗了。</p>\n<p>经过一番查找，找到了一个Go语言图片处理的库，经过调研发现还挺强的，能满足需求，于是决定写点文章，记录一下使用心得，以便日后不时之需。</p>\n<h2 id=\"gg-库的安装和简单使用\"><a href=\"#gg-库的安装和简单使用\" class=\"headerlink\" title=\"gg 库的安装和简单使用\"></a>gg 库的安装和简单使用</h2><p>使用之前，我们当然得先来安装一下这个库：</p>\n<pre><code class=\"go\">go get -u github.com/fogleman/gg</code></pre>\n<p>这个库的一个好处是有很多测试代码，可以拿来跑跑看，就知道它大概能实现什么样的效果了。</p>\n<p><img src=\"1.png\" alt=\"\"></p>\n<p>这是它例子的大概效果图，可以看到，能实现的图形效果还是挺多的。</p>\n<p><img src=\"2.png\" alt=\"\"></p>\n<p>我们拿其中的一个代码来简单体验一下：</p>\n<pre><code class=\"go\">package main\n\nimport &quot;github.com/fogleman/gg&quot;\n\nfunc main() {\n    dc := gg.NewContext(1000, 1000)\n    dc.DrawCircle(500, 500, 400)\n    dc.SetRGB(0, 0, 0)\n    dc.Fill()\n    dc.SavePNG(&quot;out.png&quot;)\n}</code></pre>\n<p>duang 的一下，一张黑不溜秋的圆形图就生成了。</p>\n<p><img src=\"3.png\" alt=\"\"></p>\n<p>关于上面的代码，下面会进行逐一说明。</p>\n<h2 id=\"调整生成图片的大小\"><a href=\"#调整生成图片的大小\" class=\"headerlink\" title=\"调整生成图片的大小\"></a>调整生成图片的大小</h2><pre><code class=\"go\">dc := gg.NewContext(1000, 1000)</code></pre>\n<p>这是先初始化一个 <code>Context</code> 对象，使用库之前都需要先初始化一个 <code>Context</code> 对象，后面的两个 <code>1000</code>，分别对应着最终生成图片的宽度和高度。我们可以修改一下高度为 <code>500</code> 看看效果。</p>\n<pre><code class=\"go\">dc := gg.NewContext(1000, 500)</code></pre>\n<p><img src=\"4.png\" alt=\"\"></p>\n<p>可以看到图片被腰斩了，高度矮了一半，同样修改宽度参数也可以得到类似的效果，这里就不演示了。</p>\n<h2 id=\"调整圆形参数\"><a href=\"#调整圆形参数\" class=\"headerlink\" title=\"调整圆形参数\"></a>调整圆形参数</h2><pre><code class=\"go\">dc.DrawCircle(500, 500, 400)</code></pre>\n<p>这里是画一个圆心位置在 <code>(500,500)</code>，半径为 <code>400</code> 的圆形。需要说明的一点是，这里的坐标轴是以左上角为原点的，水平向右是横轴正方向，竖直向下是纵轴正方向，所以<code>(500,500)</code>正是中心位置。我们可以调整一下参数值来看下效果。</p>\n<pre><code class=\"go\">dc := gg.NewContext(1000, 1000)\ndc.DrawCircle(300, 300, 400)</code></pre>\n<p><img src=\"5.png\" alt=\"\"></p>\n<p>可以看到，圆心往左上角移动了。还可以调整一下半径参数试试：</p>\n<pre><code class=\"go\">dc := gg.NewContext(1000, 1000)\ndc.DrawCircle(300, 300, 300)</code></pre>\n<p><img src=\"6.png\" alt=\"\"></p>\n<p>这样我们又得到了一个完整的圆。</p>\n<h2 id=\"调整颜色\"><a href=\"#调整颜色\" class=\"headerlink\" title=\"调整颜色\"></a>调整颜色</h2><pre><code class=\"go\">dc.SetRGB(0, 0, 0)\ndc.Fill()</code></pre>\n<p>这两句的意思是先设置颜色值为 <code>(0,0,0)</code>，也就是黑色，乍眼一看这三个值分别对应的是颜色的 <code>R、G、B</code>值，但实际上完全不是这么回事，这里需要注意的是，这三个值分别代表红色、绿色、蓝色的程度，所以如果分别设置为，会得到下面的三张图。</p>\n<p><img src=\"7.png\" alt=\"\"><br><img src=\"8.png\" alt=\"\"><br><img src=\"9.png\" alt=\"\"></p>\n<p>那如果想要根据RGB值来设置颜色该怎么处理呢？其实也很简单，做一个压缩映射即可，<code>RGB</code>值的范围是0～255，表示的含义也是对应色值的程度，这里不过将范围变成了0～1，那我们将需要使用到的值除以255就可以得到对应的映射值了。具体的颜色RGB值跟颜色的对应关系可以在网上搜到。</p>\n<p><a href=\"https://tool.oschina.net/commons?type=3\" target=\"_blank\" rel=\"noopener\">https://tool.oschina.net/commons?type=3</a></p>\n<p>下面我们用淡黄色做一个例子，对应的 <code>RGB</code> 值是 <code>(255,222,173)</code> ，我们添加一下映射转换的代码即可：</p>\n<pre><code class=\"go\">var rbgConverter = func(r []float64) []float64 {\n    result := make([]float64, 0)\n    for i := 0; i &lt; len(r); i++ {\n        result = append(result, r[i] / 255)\n    }\n    return result\n}\n\nfunc main() {\n    dc := gg.NewContext(1000, 1000)\n\n    dc.DrawCircle(500, 500, 400)\n\n    rgb := []float64{255,222,173}\n    newRgb := rbgConverter(rgb)\n\n    dc.SetRGB(newRgb[0], newRgb[1], newRgb[2])\n    dc.Fill()\n    dc.SavePNG(&quot;out.png&quot;)\n}</code></pre>\n<p>这样我们就得到了一张黄图。</p>\n<p><img src=\"10.png\" alt=\"\"></p>\n<h2 id=\"保存图片\"><a href=\"#保存图片\" class=\"headerlink\" title=\"保存图片\"></a>保存图片</h2><pre><code class=\"go\">dc.SavePNG(&quot;out.png&quot;)</code></pre>\n<p><code>SavePNG()</code> 方法可以将当前图形保存成 <code>PNG</code> 格式文件，路径可以是相对路径，也可以是绝对路径。</p>\n<p><code>SaveJPG()</code> 方法可以将当前图形保存成 <code>JPG</code> 格式文件。</p>\n<p>当然，这里的两个方法其实也只是包装了一下，点进代码可以看到，里面并没有什么奇奇怪怪的逻辑。</p>\n<pre><code class=\"go\">// SavePNG encodes the image as a PNG and writes it to disk.\nfunc (dc *Context) SavePNG(path string) error {\n    return SavePNG(path, dc.im)\n}\n\nfunc SavePNG(path string, im image.Image) error {\n    file, err := os.Create(path)\n    if err != nil {\n        return err\n    }\n    defer file.Close()\n    return png.Encode(file, im)\n}</code></pre>\n<p>所以，我们也可以根据自己的需要将图片保存成其它格式或者存到其它地方。</p>\n<h2 id=\"加载图片\"><a href=\"#加载图片\" class=\"headerlink\" title=\"加载图片\"></a>加载图片</h2><p>加载图片有三个方法可以实现，<code>LoadPNG()</code> 用来加载 <code>PNG</code> 格式的图片，<code>LoadJPG()</code> 用来加载 <code>JPG</code> 格式的图片，如果不清楚该用什么方法，可以直接使用 <code>LoadImage()</code> 方法来加载图片。</p>\n<p>加载图片后，得到的是一个 <code>image.Image</code> 对象，可以通过该对象来获取图片的一些基本信息，如：图片的长和宽、图片某一点的颜色RGB值。</p>\n<p>加载图片之后，可以使用 <code>DrawImage()</code> 方法来将图片绘制出来，以便用于后续操作。</p>\n<pre><code class=\"go\">im, err := gg.LoadImage(&quot;/Users/bytedance/Desktop/test.jpg&quot;)\nif err != nil {\n    panic(err)\n}\nw := im.Bounds().Size().X\nh := im.Bounds().Size().Y\n\ndc := gg.NewContext(h, w)\ndc.DrawImage(im, 0, 0)</code></pre>\n<h2 id=\"裁剪\"><a href=\"#裁剪\" class=\"headerlink\" title=\"裁剪\"></a>裁剪</h2><p>有一个经常使用到的方法叫 <code>Clip()</code> ，该方法可以将图像进行裁剪，裁剪的形状取决于之前画的图形。</p>\n<p>下面来举个例子，这是我们要裁剪的图，我们用一个圆形来对它进行裁剪。</p>\n<p><img src=\"11.png\" alt=\"\"></p>\n<pre><code class=\"go\">func main() {\n    // 加载图片，这里路径换成自己的\n    im, err := gg.LoadImage(&quot;test.jpg&quot;)\n    if err != nil {\n        panic(err)\n    }\n\n    // 获取图片的宽度和高度\n    w := im.Bounds().Size().X\n    h := im.Bounds().Size().Y\n\n    dc := gg.NewContext(h, w)\n\n\n    // 取宽度和高度的最小值作为直径\n    radius := math.Min(float64(w), float64(h)) / 2\n    // 画圆形\n    dc.DrawCircle(float64(w/2), float64(h/2), radius)\n    // 对画布进行裁剪\n    dc.Clip()\n    // 加载图片\n    dc.DrawImage(im, 0, 0)\n    dc.SavePNG(&quot;out.png&quot;)\n}</code></pre>\n<p><img src=\"12.png\" alt=\"\"></p>\n<p>这样一来，头像就做好了【手动狗头】。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>Go 语言也可以实现对图片进行很多类型的操作，今天主要介绍了图片的加载、保存、绘制圆形、调整大小和颜色以及裁剪。之后还会进一步介绍其它功能。</p>\n<p>我觉得如果不是需要使用并没有熟悉它的必要，但知道有这么个东西，知道它能实现什么样的效果，可以让你手上的牌又多了一张，以后有需要的时候便不至于捉襟见肘了。所以还在等什么，赶紧点赞收藏加关注吧～</p>\n"},{"title":"【Hexo】使用Hexo+github pages+travis ci搭建好看的个人博客（三）","toc":true,"date":"2020-05-04T02:40:14.000Z","_content":"\n## 说明\n\n前两篇文章介绍了 `Hexo` + `github pages` + `travis ci` 进行自动化部署，并介绍了 `Hexo` 的配置文件中的各个属性，相信通过前两篇文章的学习，你已经学会了如何搭建自己的博客，并能够根据自己的需要进行个性化配置。\n\n这一篇将以 `Matery` 这款主题为例，说明一下主题应该如何配置。包括主题配置、插件设置、注意事项等。\n\n## 设置博客主题\n\n先到[这里](https://hexo.io/themes/) 选择你喜欢的主题，点击它的标题（注意，点图片是进去 *demo* 站点，点标题才是跳转到对应到 *github* 仓库），跳转到 *github* 仓库，复制其仓库地址。\n\n比如我使用到主题是 `Matery` ，其项目地址为：`git@github.com:blinkfox/hexo-theme-matery.git`。\n\n打开本地目录，来到与我们的博客项目同级的目录（注意是同级，不是在博客项目内部），将主题项目克隆到本地。\n\n```bash\ngit clone git@github.com:blinkfox/hexo-theme-matery.git\n```\n\n在博客项目下的 *themes* 文件夹里新建一个叫 *matery* 的文件夹，然后将主题文件复制到这个文件夹里：\n\n```bash\nmkdir breeze-blog/themes/matery\ncp -r hexo-theme-matery/* breeze-blog/themes/matery\n```\n\n这里的 *breeze-blog* 是我的博客项目所在的文件夹，这里替换成你的即可。\n\n再次打开我们的配置文件(*_config.yml*)，修改 *theme* 属性，设置为博客主题所在的文件夹名，这里即为 *matery*，注意要与文件夹名称完全一致。\n\n然后我们重新生成一下博客静态文件：\n\n```bash\ncd breeze-blog\nhexo clean && hexo generate\nhexo server\n```\n\n然后再打开我们的博客地址：`localhost:4000`，我们的主题便设置好了。\n\n![hexo-theme-1.jpg](https://i.loli.net/2020/05/04/YKwFax1NrtVL6Zo.jpg)\n\n但现在大部分信息都是默认数据，所以我们需要根据需要进行自定义设置，不同主题的配置文件都不太一样，因此设置方法也有所不同，这里仅介绍 `Matery` 主题的设置方法。\n\n## 主题内容自定义\n\n### 新建页面\n\n如果你点击首页最上面的那一栏，会发现很多页面打开是没有的，因为我们还没有创建对应的页面，所以需要先创建对应的页面。\n\n![hexo-theme-2.jpg](https://i.loli.net/2020/05/04/9o7sjVdBMcm24TP.jpg)\n\n先新建分类 `categories` 页，`categories` 页是用来展示所有分类的页面，命令如下：\n\n```bash\nhexo new page \"categories\"\n```\n\n编辑新建的页面文件 */source/categories/index.md*，写入以下内容：\n\n```\n---\ntitle: categories\ndate: 2020-05-04 10:40:13\ntype: \"categories\"\nlayout: \"categories\"\n---\n```\n\n然后新建标签 `tags` 页，`tags` 页是用来展示所有标签的页面，命令如下：\n\n```bash\nhexo new page \"tags\"\n```\n\n编辑新建的页面文件 */source/tags/index.md*，写入以下内容：\n\n```\n---\ntitle: tags\ndate: 2020-05-04 10:40:14\ntype: \"tags\"\nlayout: \"tags\"\n---\n```\n\n接下来是新建 `about` 页，`about` 页是用来展示关于我和我的博客信息的页面，命令如下：\n\n```bash\nhexo new page \"about\"\n```\n\n编辑新建的页面文件 `/source/about/index.md`，写入以下内容：\n\n```\n---\ntitle: about\ndate: 2020-05-04 10:40:15\ntype: \"about\"\nlayout: \"about\"\n---\n```\n\n然后新建留言板 `contact` 页，`contact` 页是用来展示留言板信息的页面，方便其他人进行统一留言，命令如下：\n\n```bash\nhexo new page \"contact\"\n```\n\n编辑新建的页面文件 */source/contact/index.md*，写入以下内容：\n\n```\n---\ntitle: contact\ndate: 2020-05-04 10:40:16\ntype: \"contact\"\nlayout: \"contact\"\n---\n```\n\n注意，留言板功能依赖于第三方评论系统，需要先激活评论系统才有效果，如果嫌麻烦不想使用，也可以不处理，后面在菜单栏里去掉这一选项即可。\n\n最后，新建友情链接 `friends` 页，`friends` 页是用来展示友情链接信息的页面，命令如下：\n\n```bash\nhexo new page \"friends\"\n```\n\n编辑新建的页面文件 */source/friends/index.md*，写入以下内容：\n\n```\n---\ntitle: friends\ndate: 2020-05-04 10:40:17\ntype: \"friends\"\nlayout: \"friends\"\n---\n```\n\n同时，在你的博客 `source` 目录下新建 *_data* 目录，在 *_data* 目录中新建 *friends.json* 文件，文件内容如下所示：\n\n```json\n[{\n  \"avatar\": \"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png\",\n  \"name\": \"电商\",\n  \"introduction\": \"面向谷歌编程\",\n  \"url\": \"http://43.142.191.46:9527/\",\n  \"title\": \"前去学习\"\n},{\n  \"avatar\": \"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png\",\n  \"name\": \"RabbitMQ\",\n  \"introduction\": \"消息列队\",\n  \"url\": \"http://43.142.191.46:15672/\",\n  \"title\": \"前去学习\"\n}]\n```\n\n这里可以根据需要进行删减，当然，要看效果可以先这样设置，之后再来修改也不迟。\n\n新建完页面后，我们再重新生成一下博客静态页，然后运行一下项目，便能看到效果了。这里标签页和分类页都只会展示现有博客的标签和分类数据，所以如果还没有文章设置标题或者分类，那么对应页面是没有数据的。要想看到效果，就得先写几篇文章。\n\n### 菜单导航配置\n\n#### 配置基本菜单导航的名称、路径url和图标icon.\n\n1.菜单导航名称可以是中文也可以是英文(如：`Index`或`主页`) 2.图标icon 可以在[Font Awesome](https://fontawesome.com/icons) 中查找\n\n```yml\nmenu:\n  Index:\n    url: /\n    icon: fas fa-home\n  Tags:\n    url: /tags\n    icon: fas fa-tags\n  Categories:\n    url: /categories\n    icon: fas fa-bookmark\n  Archives:\n    url: /archives\n    icon: fas fa-archive\n  About:\n    url: /about\n    icon: fas fa-user-circle\n  Friends:\n    url: /friends\n    icon: fas fa-address-book\n```\n\n#### 二级菜单配置方法\n\n如果你需要二级菜单则可以在原基本菜单导航的基础上如下操作\n1.在需要添加二级菜单的一级菜单下添加`children`关键字(如:`About`菜单下添加`children`)\n2.在`children`下创建二级菜单的 名称name,路径url和图标icon.\n3.注意每个二级菜单模块前要加 `-`.\n4.注意缩进格式\n\n```yml\nmenu:\n  Index:\n    url: /\n    icon: fas fa-home\n  Tags:\n    url: /tags\n    icon: fas fa-tags\n  Categories:\n    url: /categories\n    icon: fas fa-bookmark\n  Archives:\n    url: /archives\n    icon: fas fa-archive\n  About:\n    url: /about\n    icon: fas fa-user-circle-o\n  Friends:\n    url: /friends\n    icon: fas fa-address-book\n  Medias:\n    icon: fas fa-list\n    children:\n      - name: Musics\n        url: /musics\n        icon: fas fa-music\n      - name: Movies\n        url: /movies\n        icon: fas fa-film\n      - name: Books\n        url: /books\n        icon: fas fa-book\n      - name: Galleries\n        url: /galleries\n        icon: fas fa-image\n```\n\n执行 `hexo clean && hexo g` 重新生成博客文件，然后就可以在文章中对应位置看到你用`emoji`语法写的表情了。\n\n### 代码高亮\n\n由于 Hexo 自带的代码高亮主题显示不好看，所以主题中使用到了 [hexo-prism-plugin](https://github.com/ele828/hexo-prism-plugin) 的 Hexo 插件来做代码高亮，安装命令如下：\n\n```bash\nnpm i -S hexo-prism-plugin\n```\n\n然后，修改 Hexo 根目录下 `_config.yml` 文件中 `highlight.enable` 的值为 `false`，并新增 `prism` 插件相关的配置，主要配置如下：\n\n```yml\nhighlight:\n  enable: false\n\nprism_plugin:\n  mode: 'preprocess'    # realtime/preprocess\n  theme: 'tomorrow'\n  line_number: false    # default false\n  custom_css:\n```\n\n### 搜索\n\n主题中还使用到了 [hexo-generator-search](https://github.com/wzpan/hexo-generator-search) 的 Hexo 插件来做内容搜索，安装命令如下：\n\n```bash\nnpm install hexo-generator-search --save\n```\n\n在 Hexo 根目录下的 `_config.yml` 文件中，新增以下的配置项：\n\n```yml\nsearch:\n  path: search.xml\n  field: post\n```\n\n效果图如下：\n\n![hexo-theme-3.jpg](https://i.loli.net/2020/05/04/RrE3pQdq9CmtcTP.jpg)\n\n### 中文链接转拼音（建议安装）\n\n如果你的文章名称是中文的，那么 *Hexo* 默认生成的永久链接也会有中文，这样不利于 `SEO`，且 `gitment` 评论对中文链接也不支持。我们可以用 [hexo-permalink-pinyin](https://github.com/viko16/hexo-permalink-pinyin) *Hexo* 插件使在生成文章时生成中文拼音的永久链接。\n\n安装命令如下：\n\n```bash\nnpm i hexo-permalink-pinyin --save\n```\n\n在 *Hexo* 根目录下的 `_config.yml` 文件中，新增以下的配置项：\n\n```yml\npermalink_pinyin:\n  enable: true\n  separator: '-' # default: '-'\n```\n\n### 文章字数统计插件（建议安装）\n\n如果你想要在文章中显示文章字数、阅读时长信息，可以安装 [hexo-wordcount](https://github.com/willin/hexo-wordcount)插件。\n\n安装命令如下：\n\n```bash\nnpm i --save hexo-wordcount\n```\n\n然后只需在本主题下的 `_config.yml` 文件中，将各个文章字数相关的配置激活即可：\n\n```yml\npostInfo:\n  date: true\n  update: true\n  wordCount: true # 设置文章字数统计为 true.\n  totalCount: true # 设置站点文章总字数统计为 true.\n  min2read: true # 阅读时长.\n  readCount: true # 阅读次数.\n```\n\n### 添加emoji表情支持（可选的）\n\n*Matery* 主题新增了对`emoji`表情的支持，使用到了 [hexo-filter-github-emojis](https://npm.taobao.org/package/hexo-filter-github-emojis) 的 Hexo 插件来支持 `emoji`表情的生成，把对应的`markdown emoji`语法（`::`,例如：`:smile:`）转变成会跳跃的`emoji`表情，安装命令如下：\n\n```bash\nnpm install hexo-filter-github-emojis --save\n```\n\n在 *Hexo* 根目录下的 `_config.yml` 文件中，新增以下的配置项：\n\n```yml\ngithubEmojis:\n  enable: true\n  className: github-emoji\n  inject: true\n  styles:\n  customEmojis:\n```\n\n### 添加 RSS 订阅支持（可选的）\n\n主题中还使用到了 [hexo-generator-feed](https://github.com/hexojs/hexo-generator-feed) 的 Hexo 插件来做 `RSS`，安装命令如下：\n\n```\nnpm install hexo-generator-feed --save\n```\n\n在 *Hexo* 根目录下的 `_config.yml` 文件中，新增以下的配置项：\n\n```yml\nfeed:\n  type: atom\n  path: atom.xml\n  limit: 20\n  hub:\n  content:\n  content_limit: 140\n  content_limit_delim: ' '\n  order_by: -date\n```\n\n执行 `hexo clean && hexo g` 重新生成博客文件，然后在 `public` 文件夹中即可看到 `atom.xml` 文件，说明你已经安装成功了。\n\n### 添加 [DaoVoice](http://www.daovoice.io/) 在线聊天功能（可选的）\n\n前往 [DaoVoice](http://www.daovoice.io/) 官网注册并且获取 `app_id`，并将 `app_id` 填入主题的 `_config.yml` 文件中。\n\n### 添加 [Tidio](https://www.tidio.com/) 在线聊天功能（可选的）\n\n前往 [Tidio](https://www.tidio.com/) 官网注册并且获取 `Public Key`，并将 `Public Key` 填入主题的 `_config.yml` 文件中。\n\n### 修改社交链接\n\n在主题的 `_config.yml` 文件中，默认支持 `QQ`、`GitHub` 和邮箱等的配置，你可以在主题文件的 `/layout/_partial/social-link.ejs` 文件中，新增、修改你需要的社交链接地址，增加链接可参考如下代码：\n\n```\n<% if (theme.socialLink.github) { %>\n    <a href=\"<%= theme.socialLink.github %>\" class=\"tooltipped\" target=\"_blank\" data-tooltip=\"访问我的GitHub\" data-position=\"top\" data-delay=\"50\">\n        <i class=\"fab fa-github\"></i>\n    </a>\n<% } %>\n```\n\n其中，社交图标（如：`fa-github`）你可以在 [Font Awesome](https://fontawesome.com/icons) 中搜索找到。以下是常用社交图标的标识，供你参考：\n\n- Facebook: `fab fa-facebook`\n- Twitter: `fab fa-twitter`\n- Google-plus: `fab fa-google-plus`\n- Linkedin: `fab fa-linkedin`\n- Tumblr: `fab fa-tumblr`\n- Medium: `fab fa-medium`\n- Slack: `fab fa-slack`\n- Sina Weibo: `fab fa-weibo`\n- Wechat: `fab fa-weixin`\n- QQ: `fab fa-qq`\n- Zhihu: `fab fa-zhihu`\n\n### 修改打赏的二维码图片\n\n在主题文件的 `source/medias/reward` 文件中，可以替换成你的微信和支付宝的打赏二维码图片。\n\n### 配置音乐播放器（可选的）\n\n要支持音乐播放，在主题的 `_config.yml` 配置文件中激活music配置即可：\n\n```yml\n# 是否在首页显示音乐\nmusic:\n  enable: true\n  title:     \t    #非吸底模式有效\n    enable: true\n    show: 听听音乐\n  server: netease   #require music platform: netease, tencent, kugou, xiami, baidu\n  type: playlist    #require song, playlist, album, search, artist\n  id: 503838841     #require song id / playlist id / album id / search keyword\n  fixed: false      # 开启吸底模式\n  autoplay: false   # 是否自动播放\n  theme: '#42b983'\n  loop: 'all'       # 音频循环播放, 可选值: 'all', 'one', 'none'\n  order: 'random'   # 音频循环顺序, 可选值: 'list', 'random'\n  preload: 'auto'   # 预加载，可选值: 'none', 'metadata', 'auto'\n  volume: 0.7       # 默认音量，请注意播放器会记忆用户设置，用户手动设置音量后默认音量即失效\n  listFolded: true  # 列表默认折叠\n```\n\n> `server`可选`netease`（网易云音乐），`tencent`（QQ音乐），`kugou`（酷狗音乐），`xiami`（虾米音乐），\n>\n> `baidu`（百度音乐）。\n>\n> `type`可选`song`（歌曲），`playlist`（歌单），`album`（专辑），`search`（搜索关键字），`artist`（歌手）\n>\n> `id`获取示例: 打开手机版网易云音乐，选择喜欢的歌单，然后点击分享\n\n我这里随便选了一个歌单，分享后的文字长这样：\n\n> 分享真咸鱼饼干的歌单《青年节：致逐梦人，有志者事竟成》http://music.163.com/playlist/4965675848/1548006936/?userid=120124365 (@网易云音乐)\n\n`4965675848` 这就是歌单的id，文件里默认设置的歌单其实也还不错，歌挺多的，所以如果没什么特殊要求，使用默认歌单也不错。\n\n⚠️这里需要注意一点，如果你想要替换成自己的歌单时，会发现，后续歌单的更新是不会影响到它的，这也是我捣鼓半天才发现的，音乐插件使用的是 *Aplayer* 播放器，在 *https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js* 这个文件里可以看到，数据是从这个接口获取的：*https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r*，猜测服务端是直接将获取到的榜单列表写进里数据库，但后续不会进行更新，所以导致无论多少次刷新，都只能获取第一次取到的数据。\n\n所以有两种解决办法，第一种是创建新歌单，然后一次性添加足够多的歌，然后在配置文件中替换成你的歌单id，另一种是自己写一个网易云音乐歌单解析接口，来获取网易云音乐数据。我比较懒，所以选择了第一种方案，23333，还在充实歌单中。\n\n## 文章 Front-matter 介绍\n\n### Front-matter 选项详解\n\n`Front-matter` 选项中的所有内容均为**非必填**的。但建议至少填写 `title` 和 `date` 的值。\n\n| 配置选项      | 默认值                         | 描述                                                         |\n| ------------- | ------------------------------ | ------------------------------------------------------------ |\n| title         | `Markdown` 的文件标题          | 文章标题，强烈建议填写此选项                                 |\n| date          | 文件创建时的日期时间           | 发布时间，强烈建议填写此选项，且最好保证全局唯一             |\n| author        | 根 `_config.yml` 中的 `author` | 文章作者                                                     |\n| img           | `featureImages` 中的某个值     | 文章特征图，推荐使用图床(腾讯云、七牛云、又拍云等)来做图片的路径.如: `http://xxx.com/xxx.jpg` |\n| top           | `true`                         | 推荐文章（文章是否置顶），如果 `top` 值为 `true`，则会作为首页推荐文章 |\n| cover         | `false`                        | `v1.0.2`版本新增，表示该文章是否需要加入到首页轮播封面中     |\n| coverImg      | 无                             | `v1.0.2`版本新增，表示该文章在首页轮播封面需要显示的图片路径，如果没有，则默认使用文章的特色图片 |\n| password      | 无                             | 文章阅读密码，如果要对文章设置阅读验证密码的话，就可以设置 `password` 的值，该值必须是用 `SHA256` 加密后的密码，防止被他人识破。前提是在主题的 `config.yml` 中激活了 `verifyPassword` 选项 |\n| toc           | `true`                         | 是否开启 TOC，可以针对某篇文章单独关闭 TOC 的功能。前提是在主题的 `config.yml` 中激活了 `toc` 选项 |\n| mathjax       | `false`                        | 是否开启数学公式支持 ，本文章是否开启 `mathjax`，且需要在主题的 `_config.yml` 文件中也需要开启才行 |\n| summary       | 无                             | 文章摘要，自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要 |\n| categories    | 无                             | 文章分类，本主题的分类表示宏观上大的分类，只建议一篇文章一个分类 |\n| tags          | 无                             | 文章标签，一篇文章可以多个标签                               |\n| keywords      | 文章标题                       | 文章关键字，SEO 时需要                                       |\n| reprintPolicy | cc_by                          | 文章转载规则， 可以是 cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint 或 pay 中的一个 |\n\n> **注意**:\n>\n> 1. 如果 `img` 属性不填写的话，文章特色图会根据文章标题的 `hashcode` 的值取余，然后选取主题中对应的特色图片，从而达到让所有文章都的特色图**各有特色**。\n> 2. `date` 的值尽量保证每篇文章是唯一的，因为本主题中 `Gitalk` 和 `Gitment` 识别 `id` 是通过 `date` 的值来作为唯一标识的。\n> 3. 如果要对文章设置阅读验证密码的功能，不仅要在 Front-matter 中设置采用了 SHA256 加密的 password 的值，还需要在主题的 `_config.yml` 中激活了配置。有些在线的 SHA256 加密的地址，可供你使用：[开源中国在线工具](http://tool.oschina.net/encrypt?type=2)、[chahuo](http://encode.chahuo.com/)、[站长工具](http://tool.chinaz.com/tools/hash.aspx)。\n> 4. 您可以在文章md文件的 front-matter 中指定 reprintPolicy 来给单个文章配置转载规则\n\n以下为文章的 `Front-matter` 示例。\n\n最简示例\n\n```\n---\ntitle: typora-vue-theme主题介绍\ndate: 2018-09-07 09:25:00\n---\n```\n\n最全示例\n\n```\n---\ntitle: typora-vue-theme主题介绍\ndate: 2018-09-07 09:25:00\nauthor: 赵奇\nimg: /source/images/xxx.jpg\ntop: true\ncover: true\ncoverImg: /images/1.jpg\npassword: 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92\ntoc: false\nmathjax: false\nsummary: 这是你自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要\ncategories: Markdown\ntags:\n  - Typora\n  - Markdown\n---\n```\n\n上述大部分内容都来自主题说明文档，只是添加了一下我觉得需要注意的地方。这里还有一些没有说到到的属性，这配置文件里都有详细的介绍，确实不需要过多解释。\n\n最后再介绍一下我折腾比较久的插件，valine 评价插件。\n\n## Valine 评价插件\n\n插件主页：*https://valine.js.org/* ，上面有详细的介绍，可以查看[这里](https://valine.js.org/quickstart.html)，注册后，验证邮箱，绑定手机号，然后新建一个应用，获取到对应的 `AppId` 和 `AppKey`，然后写回到主题文件下到 `_config.yml` 文件里，但是要**注意一点，不要直接使用国内版进行注册，而要用国际版，否则无法申请二级域名**。\n\n```yml\nvaline:\n  enable: true\n  appId: XXX\n  appKey: XXX\n  notify: true\n  verify: false\n  visitor: true\n  avatar: 'retro' # Gravatar style : mm/identicon/monsterid/wavatar/retro/hide\n  pageSize: 10\n  placeholder: 'Comment here' # Comment Box placeholder\n  background: /medias/comment_bg.png\n```\n\n最新版的 `Valine` 已经移除了邮件通知功能。如果没有邮件通知，很可能别人评价之后，你却毫不知情，后续回复对方也收不到。因此，需要再配置一个插件来实现， ++https://github.com/zhaojun1998/Valine-Admin++ 。在配置这个插件之前，需要确保 `Valine` 可以正常工作，可以自己给自己评论一下进行测试。\n\n配置好之后，别人在你的文章下评论后你便能收到邮件通知了。\n\n至此，`Matery` 主题就搭建配置完成了，接下来就只需要安心写博客了～\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","source":"_posts/hexo/hexo-theme.md","raw":"---\ntitle: 【Hexo】使用Hexo+github pages+travis ci搭建好看的个人博客（三）\ntags:\n  - 环境搭建\n  - Hexo\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-04 10:40:14\n---\n\n## 说明\n\n前两篇文章介绍了 `Hexo` + `github pages` + `travis ci` 进行自动化部署，并介绍了 `Hexo` 的配置文件中的各个属性，相信通过前两篇文章的学习，你已经学会了如何搭建自己的博客，并能够根据自己的需要进行个性化配置。\n\n这一篇将以 `Matery` 这款主题为例，说明一下主题应该如何配置。包括主题配置、插件设置、注意事项等。\n\n## 设置博客主题\n\n先到[这里](https://hexo.io/themes/) 选择你喜欢的主题，点击它的标题（注意，点图片是进去 *demo* 站点，点标题才是跳转到对应到 *github* 仓库），跳转到 *github* 仓库，复制其仓库地址。\n\n比如我使用到主题是 `Matery` ，其项目地址为：`git@github.com:blinkfox/hexo-theme-matery.git`。\n\n打开本地目录，来到与我们的博客项目同级的目录（注意是同级，不是在博客项目内部），将主题项目克隆到本地。\n\n```bash\ngit clone git@github.com:blinkfox/hexo-theme-matery.git\n```\n\n在博客项目下的 *themes* 文件夹里新建一个叫 *matery* 的文件夹，然后将主题文件复制到这个文件夹里：\n\n```bash\nmkdir breeze-blog/themes/matery\ncp -r hexo-theme-matery/* breeze-blog/themes/matery\n```\n\n这里的 *breeze-blog* 是我的博客项目所在的文件夹，这里替换成你的即可。\n\n再次打开我们的配置文件(*_config.yml*)，修改 *theme* 属性，设置为博客主题所在的文件夹名，这里即为 *matery*，注意要与文件夹名称完全一致。\n\n然后我们重新生成一下博客静态文件：\n\n```bash\ncd breeze-blog\nhexo clean && hexo generate\nhexo server\n```\n\n然后再打开我们的博客地址：`localhost:4000`，我们的主题便设置好了。\n\n![hexo-theme-1.jpg](https://i.loli.net/2020/05/04/YKwFax1NrtVL6Zo.jpg)\n\n但现在大部分信息都是默认数据，所以我们需要根据需要进行自定义设置，不同主题的配置文件都不太一样，因此设置方法也有所不同，这里仅介绍 `Matery` 主题的设置方法。\n\n## 主题内容自定义\n\n### 新建页面\n\n如果你点击首页最上面的那一栏，会发现很多页面打开是没有的，因为我们还没有创建对应的页面，所以需要先创建对应的页面。\n\n![hexo-theme-2.jpg](https://i.loli.net/2020/05/04/9o7sjVdBMcm24TP.jpg)\n\n先新建分类 `categories` 页，`categories` 页是用来展示所有分类的页面，命令如下：\n\n```bash\nhexo new page \"categories\"\n```\n\n编辑新建的页面文件 */source/categories/index.md*，写入以下内容：\n\n```\n---\ntitle: categories\ndate: 2020-05-04 10:40:13\ntype: \"categories\"\nlayout: \"categories\"\n---\n```\n\n然后新建标签 `tags` 页，`tags` 页是用来展示所有标签的页面，命令如下：\n\n```bash\nhexo new page \"tags\"\n```\n\n编辑新建的页面文件 */source/tags/index.md*，写入以下内容：\n\n```\n---\ntitle: tags\ndate: 2020-05-04 10:40:14\ntype: \"tags\"\nlayout: \"tags\"\n---\n```\n\n接下来是新建 `about` 页，`about` 页是用来展示关于我和我的博客信息的页面，命令如下：\n\n```bash\nhexo new page \"about\"\n```\n\n编辑新建的页面文件 `/source/about/index.md`，写入以下内容：\n\n```\n---\ntitle: about\ndate: 2020-05-04 10:40:15\ntype: \"about\"\nlayout: \"about\"\n---\n```\n\n然后新建留言板 `contact` 页，`contact` 页是用来展示留言板信息的页面，方便其他人进行统一留言，命令如下：\n\n```bash\nhexo new page \"contact\"\n```\n\n编辑新建的页面文件 */source/contact/index.md*，写入以下内容：\n\n```\n---\ntitle: contact\ndate: 2020-05-04 10:40:16\ntype: \"contact\"\nlayout: \"contact\"\n---\n```\n\n注意，留言板功能依赖于第三方评论系统，需要先激活评论系统才有效果，如果嫌麻烦不想使用，也可以不处理，后面在菜单栏里去掉这一选项即可。\n\n最后，新建友情链接 `friends` 页，`friends` 页是用来展示友情链接信息的页面，命令如下：\n\n```bash\nhexo new page \"friends\"\n```\n\n编辑新建的页面文件 */source/friends/index.md*，写入以下内容：\n\n```\n---\ntitle: friends\ndate: 2020-05-04 10:40:17\ntype: \"friends\"\nlayout: \"friends\"\n---\n```\n\n同时，在你的博客 `source` 目录下新建 *_data* 目录，在 *_data* 目录中新建 *friends.json* 文件，文件内容如下所示：\n\n```json\n[{\n  \"avatar\": \"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png\",\n  \"name\": \"电商\",\n  \"introduction\": \"面向谷歌编程\",\n  \"url\": \"http://43.142.191.46:9527/\",\n  \"title\": \"前去学习\"\n},{\n  \"avatar\": \"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png\",\n  \"name\": \"RabbitMQ\",\n  \"introduction\": \"消息列队\",\n  \"url\": \"http://43.142.191.46:15672/\",\n  \"title\": \"前去学习\"\n}]\n```\n\n这里可以根据需要进行删减，当然，要看效果可以先这样设置，之后再来修改也不迟。\n\n新建完页面后，我们再重新生成一下博客静态页，然后运行一下项目，便能看到效果了。这里标签页和分类页都只会展示现有博客的标签和分类数据，所以如果还没有文章设置标题或者分类，那么对应页面是没有数据的。要想看到效果，就得先写几篇文章。\n\n### 菜单导航配置\n\n#### 配置基本菜单导航的名称、路径url和图标icon.\n\n1.菜单导航名称可以是中文也可以是英文(如：`Index`或`主页`) 2.图标icon 可以在[Font Awesome](https://fontawesome.com/icons) 中查找\n\n```yml\nmenu:\n  Index:\n    url: /\n    icon: fas fa-home\n  Tags:\n    url: /tags\n    icon: fas fa-tags\n  Categories:\n    url: /categories\n    icon: fas fa-bookmark\n  Archives:\n    url: /archives\n    icon: fas fa-archive\n  About:\n    url: /about\n    icon: fas fa-user-circle\n  Friends:\n    url: /friends\n    icon: fas fa-address-book\n```\n\n#### 二级菜单配置方法\n\n如果你需要二级菜单则可以在原基本菜单导航的基础上如下操作\n1.在需要添加二级菜单的一级菜单下添加`children`关键字(如:`About`菜单下添加`children`)\n2.在`children`下创建二级菜单的 名称name,路径url和图标icon.\n3.注意每个二级菜单模块前要加 `-`.\n4.注意缩进格式\n\n```yml\nmenu:\n  Index:\n    url: /\n    icon: fas fa-home\n  Tags:\n    url: /tags\n    icon: fas fa-tags\n  Categories:\n    url: /categories\n    icon: fas fa-bookmark\n  Archives:\n    url: /archives\n    icon: fas fa-archive\n  About:\n    url: /about\n    icon: fas fa-user-circle-o\n  Friends:\n    url: /friends\n    icon: fas fa-address-book\n  Medias:\n    icon: fas fa-list\n    children:\n      - name: Musics\n        url: /musics\n        icon: fas fa-music\n      - name: Movies\n        url: /movies\n        icon: fas fa-film\n      - name: Books\n        url: /books\n        icon: fas fa-book\n      - name: Galleries\n        url: /galleries\n        icon: fas fa-image\n```\n\n执行 `hexo clean && hexo g` 重新生成博客文件，然后就可以在文章中对应位置看到你用`emoji`语法写的表情了。\n\n### 代码高亮\n\n由于 Hexo 自带的代码高亮主题显示不好看，所以主题中使用到了 [hexo-prism-plugin](https://github.com/ele828/hexo-prism-plugin) 的 Hexo 插件来做代码高亮，安装命令如下：\n\n```bash\nnpm i -S hexo-prism-plugin\n```\n\n然后，修改 Hexo 根目录下 `_config.yml` 文件中 `highlight.enable` 的值为 `false`，并新增 `prism` 插件相关的配置，主要配置如下：\n\n```yml\nhighlight:\n  enable: false\n\nprism_plugin:\n  mode: 'preprocess'    # realtime/preprocess\n  theme: 'tomorrow'\n  line_number: false    # default false\n  custom_css:\n```\n\n### 搜索\n\n主题中还使用到了 [hexo-generator-search](https://github.com/wzpan/hexo-generator-search) 的 Hexo 插件来做内容搜索，安装命令如下：\n\n```bash\nnpm install hexo-generator-search --save\n```\n\n在 Hexo 根目录下的 `_config.yml` 文件中，新增以下的配置项：\n\n```yml\nsearch:\n  path: search.xml\n  field: post\n```\n\n效果图如下：\n\n![hexo-theme-3.jpg](https://i.loli.net/2020/05/04/RrE3pQdq9CmtcTP.jpg)\n\n### 中文链接转拼音（建议安装）\n\n如果你的文章名称是中文的，那么 *Hexo* 默认生成的永久链接也会有中文，这样不利于 `SEO`，且 `gitment` 评论对中文链接也不支持。我们可以用 [hexo-permalink-pinyin](https://github.com/viko16/hexo-permalink-pinyin) *Hexo* 插件使在生成文章时生成中文拼音的永久链接。\n\n安装命令如下：\n\n```bash\nnpm i hexo-permalink-pinyin --save\n```\n\n在 *Hexo* 根目录下的 `_config.yml` 文件中，新增以下的配置项：\n\n```yml\npermalink_pinyin:\n  enable: true\n  separator: '-' # default: '-'\n```\n\n### 文章字数统计插件（建议安装）\n\n如果你想要在文章中显示文章字数、阅读时长信息，可以安装 [hexo-wordcount](https://github.com/willin/hexo-wordcount)插件。\n\n安装命令如下：\n\n```bash\nnpm i --save hexo-wordcount\n```\n\n然后只需在本主题下的 `_config.yml` 文件中，将各个文章字数相关的配置激活即可：\n\n```yml\npostInfo:\n  date: true\n  update: true\n  wordCount: true # 设置文章字数统计为 true.\n  totalCount: true # 设置站点文章总字数统计为 true.\n  min2read: true # 阅读时长.\n  readCount: true # 阅读次数.\n```\n\n### 添加emoji表情支持（可选的）\n\n*Matery* 主题新增了对`emoji`表情的支持，使用到了 [hexo-filter-github-emojis](https://npm.taobao.org/package/hexo-filter-github-emojis) 的 Hexo 插件来支持 `emoji`表情的生成，把对应的`markdown emoji`语法（`::`,例如：`:smile:`）转变成会跳跃的`emoji`表情，安装命令如下：\n\n```bash\nnpm install hexo-filter-github-emojis --save\n```\n\n在 *Hexo* 根目录下的 `_config.yml` 文件中，新增以下的配置项：\n\n```yml\ngithubEmojis:\n  enable: true\n  className: github-emoji\n  inject: true\n  styles:\n  customEmojis:\n```\n\n### 添加 RSS 订阅支持（可选的）\n\n主题中还使用到了 [hexo-generator-feed](https://github.com/hexojs/hexo-generator-feed) 的 Hexo 插件来做 `RSS`，安装命令如下：\n\n```\nnpm install hexo-generator-feed --save\n```\n\n在 *Hexo* 根目录下的 `_config.yml` 文件中，新增以下的配置项：\n\n```yml\nfeed:\n  type: atom\n  path: atom.xml\n  limit: 20\n  hub:\n  content:\n  content_limit: 140\n  content_limit_delim: ' '\n  order_by: -date\n```\n\n执行 `hexo clean && hexo g` 重新生成博客文件，然后在 `public` 文件夹中即可看到 `atom.xml` 文件，说明你已经安装成功了。\n\n### 添加 [DaoVoice](http://www.daovoice.io/) 在线聊天功能（可选的）\n\n前往 [DaoVoice](http://www.daovoice.io/) 官网注册并且获取 `app_id`，并将 `app_id` 填入主题的 `_config.yml` 文件中。\n\n### 添加 [Tidio](https://www.tidio.com/) 在线聊天功能（可选的）\n\n前往 [Tidio](https://www.tidio.com/) 官网注册并且获取 `Public Key`，并将 `Public Key` 填入主题的 `_config.yml` 文件中。\n\n### 修改社交链接\n\n在主题的 `_config.yml` 文件中，默认支持 `QQ`、`GitHub` 和邮箱等的配置，你可以在主题文件的 `/layout/_partial/social-link.ejs` 文件中，新增、修改你需要的社交链接地址，增加链接可参考如下代码：\n\n```\n<% if (theme.socialLink.github) { %>\n    <a href=\"<%= theme.socialLink.github %>\" class=\"tooltipped\" target=\"_blank\" data-tooltip=\"访问我的GitHub\" data-position=\"top\" data-delay=\"50\">\n        <i class=\"fab fa-github\"></i>\n    </a>\n<% } %>\n```\n\n其中，社交图标（如：`fa-github`）你可以在 [Font Awesome](https://fontawesome.com/icons) 中搜索找到。以下是常用社交图标的标识，供你参考：\n\n- Facebook: `fab fa-facebook`\n- Twitter: `fab fa-twitter`\n- Google-plus: `fab fa-google-plus`\n- Linkedin: `fab fa-linkedin`\n- Tumblr: `fab fa-tumblr`\n- Medium: `fab fa-medium`\n- Slack: `fab fa-slack`\n- Sina Weibo: `fab fa-weibo`\n- Wechat: `fab fa-weixin`\n- QQ: `fab fa-qq`\n- Zhihu: `fab fa-zhihu`\n\n### 修改打赏的二维码图片\n\n在主题文件的 `source/medias/reward` 文件中，可以替换成你的微信和支付宝的打赏二维码图片。\n\n### 配置音乐播放器（可选的）\n\n要支持音乐播放，在主题的 `_config.yml` 配置文件中激活music配置即可：\n\n```yml\n# 是否在首页显示音乐\nmusic:\n  enable: true\n  title:     \t    #非吸底模式有效\n    enable: true\n    show: 听听音乐\n  server: netease   #require music platform: netease, tencent, kugou, xiami, baidu\n  type: playlist    #require song, playlist, album, search, artist\n  id: 503838841     #require song id / playlist id / album id / search keyword\n  fixed: false      # 开启吸底模式\n  autoplay: false   # 是否自动播放\n  theme: '#42b983'\n  loop: 'all'       # 音频循环播放, 可选值: 'all', 'one', 'none'\n  order: 'random'   # 音频循环顺序, 可选值: 'list', 'random'\n  preload: 'auto'   # 预加载，可选值: 'none', 'metadata', 'auto'\n  volume: 0.7       # 默认音量，请注意播放器会记忆用户设置，用户手动设置音量后默认音量即失效\n  listFolded: true  # 列表默认折叠\n```\n\n> `server`可选`netease`（网易云音乐），`tencent`（QQ音乐），`kugou`（酷狗音乐），`xiami`（虾米音乐），\n>\n> `baidu`（百度音乐）。\n>\n> `type`可选`song`（歌曲），`playlist`（歌单），`album`（专辑），`search`（搜索关键字），`artist`（歌手）\n>\n> `id`获取示例: 打开手机版网易云音乐，选择喜欢的歌单，然后点击分享\n\n我这里随便选了一个歌单，分享后的文字长这样：\n\n> 分享真咸鱼饼干的歌单《青年节：致逐梦人，有志者事竟成》http://music.163.com/playlist/4965675848/1548006936/?userid=120124365 (@网易云音乐)\n\n`4965675848` 这就是歌单的id，文件里默认设置的歌单其实也还不错，歌挺多的，所以如果没什么特殊要求，使用默认歌单也不错。\n\n⚠️这里需要注意一点，如果你想要替换成自己的歌单时，会发现，后续歌单的更新是不会影响到它的，这也是我捣鼓半天才发现的，音乐插件使用的是 *Aplayer* 播放器，在 *https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js* 这个文件里可以看到，数据是从这个接口获取的：*https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r*，猜测服务端是直接将获取到的榜单列表写进里数据库，但后续不会进行更新，所以导致无论多少次刷新，都只能获取第一次取到的数据。\n\n所以有两种解决办法，第一种是创建新歌单，然后一次性添加足够多的歌，然后在配置文件中替换成你的歌单id，另一种是自己写一个网易云音乐歌单解析接口，来获取网易云音乐数据。我比较懒，所以选择了第一种方案，23333，还在充实歌单中。\n\n## 文章 Front-matter 介绍\n\n### Front-matter 选项详解\n\n`Front-matter` 选项中的所有内容均为**非必填**的。但建议至少填写 `title` 和 `date` 的值。\n\n| 配置选项      | 默认值                         | 描述                                                         |\n| ------------- | ------------------------------ | ------------------------------------------------------------ |\n| title         | `Markdown` 的文件标题          | 文章标题，强烈建议填写此选项                                 |\n| date          | 文件创建时的日期时间           | 发布时间，强烈建议填写此选项，且最好保证全局唯一             |\n| author        | 根 `_config.yml` 中的 `author` | 文章作者                                                     |\n| img           | `featureImages` 中的某个值     | 文章特征图，推荐使用图床(腾讯云、七牛云、又拍云等)来做图片的路径.如: `http://xxx.com/xxx.jpg` |\n| top           | `true`                         | 推荐文章（文章是否置顶），如果 `top` 值为 `true`，则会作为首页推荐文章 |\n| cover         | `false`                        | `v1.0.2`版本新增，表示该文章是否需要加入到首页轮播封面中     |\n| coverImg      | 无                             | `v1.0.2`版本新增，表示该文章在首页轮播封面需要显示的图片路径，如果没有，则默认使用文章的特色图片 |\n| password      | 无                             | 文章阅读密码，如果要对文章设置阅读验证密码的话，就可以设置 `password` 的值，该值必须是用 `SHA256` 加密后的密码，防止被他人识破。前提是在主题的 `config.yml` 中激活了 `verifyPassword` 选项 |\n| toc           | `true`                         | 是否开启 TOC，可以针对某篇文章单独关闭 TOC 的功能。前提是在主题的 `config.yml` 中激活了 `toc` 选项 |\n| mathjax       | `false`                        | 是否开启数学公式支持 ，本文章是否开启 `mathjax`，且需要在主题的 `_config.yml` 文件中也需要开启才行 |\n| summary       | 无                             | 文章摘要，自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要 |\n| categories    | 无                             | 文章分类，本主题的分类表示宏观上大的分类，只建议一篇文章一个分类 |\n| tags          | 无                             | 文章标签，一篇文章可以多个标签                               |\n| keywords      | 文章标题                       | 文章关键字，SEO 时需要                                       |\n| reprintPolicy | cc_by                          | 文章转载规则， 可以是 cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint 或 pay 中的一个 |\n\n> **注意**:\n>\n> 1. 如果 `img` 属性不填写的话，文章特色图会根据文章标题的 `hashcode` 的值取余，然后选取主题中对应的特色图片，从而达到让所有文章都的特色图**各有特色**。\n> 2. `date` 的值尽量保证每篇文章是唯一的，因为本主题中 `Gitalk` 和 `Gitment` 识别 `id` 是通过 `date` 的值来作为唯一标识的。\n> 3. 如果要对文章设置阅读验证密码的功能，不仅要在 Front-matter 中设置采用了 SHA256 加密的 password 的值，还需要在主题的 `_config.yml` 中激活了配置。有些在线的 SHA256 加密的地址，可供你使用：[开源中国在线工具](http://tool.oschina.net/encrypt?type=2)、[chahuo](http://encode.chahuo.com/)、[站长工具](http://tool.chinaz.com/tools/hash.aspx)。\n> 4. 您可以在文章md文件的 front-matter 中指定 reprintPolicy 来给单个文章配置转载规则\n\n以下为文章的 `Front-matter` 示例。\n\n最简示例\n\n```\n---\ntitle: typora-vue-theme主题介绍\ndate: 2018-09-07 09:25:00\n---\n```\n\n最全示例\n\n```\n---\ntitle: typora-vue-theme主题介绍\ndate: 2018-09-07 09:25:00\nauthor: 赵奇\nimg: /source/images/xxx.jpg\ntop: true\ncover: true\ncoverImg: /images/1.jpg\npassword: 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92\ntoc: false\nmathjax: false\nsummary: 这是你自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要\ncategories: Markdown\ntags:\n  - Typora\n  - Markdown\n---\n```\n\n上述大部分内容都来自主题说明文档，只是添加了一下我觉得需要注意的地方。这里还有一些没有说到到的属性，这配置文件里都有详细的介绍，确实不需要过多解释。\n\n最后再介绍一下我折腾比较久的插件，valine 评价插件。\n\n## Valine 评价插件\n\n插件主页：*https://valine.js.org/* ，上面有详细的介绍，可以查看[这里](https://valine.js.org/quickstart.html)，注册后，验证邮箱，绑定手机号，然后新建一个应用，获取到对应的 `AppId` 和 `AppKey`，然后写回到主题文件下到 `_config.yml` 文件里，但是要**注意一点，不要直接使用国内版进行注册，而要用国际版，否则无法申请二级域名**。\n\n```yml\nvaline:\n  enable: true\n  appId: XXX\n  appKey: XXX\n  notify: true\n  verify: false\n  visitor: true\n  avatar: 'retro' # Gravatar style : mm/identicon/monsterid/wavatar/retro/hide\n  pageSize: 10\n  placeholder: 'Comment here' # Comment Box placeholder\n  background: /medias/comment_bg.png\n```\n\n最新版的 `Valine` 已经移除了邮件通知功能。如果没有邮件通知，很可能别人评价之后，你却毫不知情，后续回复对方也收不到。因此，需要再配置一个插件来实现， ++https://github.com/zhaojun1998/Valine-Admin++ 。在配置这个插件之前，需要确保 `Valine` 可以正常工作，可以自己给自己评论一下进行测试。\n\n配置好之后，别人在你的文章下评论后你便能收到邮件通知了。\n\n至此，`Matery` 主题就搭建配置完成了，接下来就只需要安心写博客了～\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","slug":"hexo/hexo-theme","published":1,"updated":"2020-05-04T02:40:14.000Z","_id":"cl70rsfba000g5ohu5ho9b02j","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>前两篇文章介绍了 <code>Hexo</code> + <code>github pages</code> + <code>travis ci</code> 进行自动化部署，并介绍了 <code>Hexo</code> 的配置文件中的各个属性，相信通过前两篇文章的学习，你已经学会了如何搭建自己的博客，并能够根据自己的需要进行个性化配置。</p>\n<p>这一篇将以 <code>Matery</code> 这款主题为例，说明一下主题应该如何配置。包括主题配置、插件设置、注意事项等。</p>\n<h2 id=\"设置博客主题\"><a href=\"#设置博客主题\" class=\"headerlink\" title=\"设置博客主题\"></a>设置博客主题</h2><p>先到<a href=\"https://hexo.io/themes/\" target=\"_blank\" rel=\"noopener\">这里</a> 选择你喜欢的主题，点击它的标题（注意，点图片是进去 <em>demo</em> 站点，点标题才是跳转到对应到 <em>github</em> 仓库），跳转到 <em>github</em> 仓库，复制其仓库地址。</p>\n<p>比如我使用到主题是 <code>Matery</code> ，其项目地址为：<code>git@github.com:blinkfox/hexo-theme-matery.git</code>。</p>\n<p>打开本地目录，来到与我们的博客项目同级的目录（注意是同级，不是在博客项目内部），将主题项目克隆到本地。</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone git@github.com:blinkfox/hexo-theme-matery.git</code></pre>\n<p>在博客项目下的 <em>themes</em> 文件夹里新建一个叫 <em>matery</em> 的文件夹，然后将主题文件复制到这个文件夹里：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> breeze-blog/themes/matery\n<span class=\"token function\">cp</span> -r hexo-theme-matery/* breeze-blog/themes/matery</code></pre>\n<p>这里的 <em>breeze-blog</em> 是我的博客项目所在的文件夹，这里替换成你的即可。</p>\n<p>再次打开我们的配置文件(<em>_config.yml</em>)，修改 <em>theme</em> 属性，设置为博客主题所在的文件夹名，这里即为 <em>matery</em>，注意要与文件夹名称完全一致。</p>\n<p>然后我们重新生成一下博客静态文件：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">cd</span> breeze-blog\nhexo clean <span class=\"token operator\">&amp;&amp;</span> hexo generate\nhexo server</code></pre>\n<p>然后再打开我们的博客地址：<code>localhost:4000</code>，我们的主题便设置好了。</p>\n<p><img src=\"https://i.loli.net/2020/05/04/YKwFax1NrtVL6Zo.jpg\" alt=\"hexo-theme-1.jpg\"></p>\n<p>但现在大部分信息都是默认数据，所以我们需要根据需要进行自定义设置，不同主题的配置文件都不太一样，因此设置方法也有所不同，这里仅介绍 <code>Matery</code> 主题的设置方法。</p>\n<h2 id=\"主题内容自定义\"><a href=\"#主题内容自定义\" class=\"headerlink\" title=\"主题内容自定义\"></a>主题内容自定义</h2><h3 id=\"新建页面\"><a href=\"#新建页面\" class=\"headerlink\" title=\"新建页面\"></a>新建页面</h3><p>如果你点击首页最上面的那一栏，会发现很多页面打开是没有的，因为我们还没有创建对应的页面，所以需要先创建对应的页面。</p>\n<p><img src=\"https://i.loli.net/2020/05/04/9o7sjVdBMcm24TP.jpg\" alt=\"hexo-theme-2.jpg\"></p>\n<p>先新建分类 <code>categories</code> 页，<code>categories</code> 页是用来展示所有分类的页面，命令如下：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">hexo new page <span class=\"token string\">\"categories\"</span></code></pre>\n<p>编辑新建的页面文件 <em>/source/categories/index.md</em>，写入以下内容：</p>\n<pre><code>---\ntitle: categories\ndate: 2020-05-04 10:40:13\ntype: \"categories\"\nlayout: \"categories\"\n---</code></pre><p>然后新建标签 <code>tags</code> 页，<code>tags</code> 页是用来展示所有标签的页面，命令如下：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">hexo new page <span class=\"token string\">\"tags\"</span></code></pre>\n<p>编辑新建的页面文件 <em>/source/tags/index.md</em>，写入以下内容：</p>\n<pre><code>---\ntitle: tags\ndate: 2020-05-04 10:40:14\ntype: \"tags\"\nlayout: \"tags\"\n---</code></pre><p>接下来是新建 <code>about</code> 页，<code>about</code> 页是用来展示关于我和我的博客信息的页面，命令如下：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">hexo new page <span class=\"token string\">\"about\"</span></code></pre>\n<p>编辑新建的页面文件 <code>/source/about/index.md</code>，写入以下内容：</p>\n<pre><code>---\ntitle: about\ndate: 2020-05-04 10:40:15\ntype: \"about\"\nlayout: \"about\"\n---</code></pre><p>然后新建留言板 <code>contact</code> 页，<code>contact</code> 页是用来展示留言板信息的页面，方便其他人进行统一留言，命令如下：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">hexo new page <span class=\"token string\">\"contact\"</span></code></pre>\n<p>编辑新建的页面文件 <em>/source/contact/index.md</em>，写入以下内容：</p>\n<pre><code>---\ntitle: contact\ndate: 2020-05-04 10:40:16\ntype: \"contact\"\nlayout: \"contact\"\n---</code></pre><p>注意，留言板功能依赖于第三方评论系统，需要先激活评论系统才有效果，如果嫌麻烦不想使用，也可以不处理，后面在菜单栏里去掉这一选项即可。</p>\n<p>最后，新建友情链接 <code>friends</code> 页，<code>friends</code> 页是用来展示友情链接信息的页面，命令如下：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">hexo new page <span class=\"token string\">\"friends\"</span></code></pre>\n<p>编辑新建的页面文件 <em>/source/friends/index.md</em>，写入以下内容：</p>\n<pre><code>---\ntitle: friends\ndate: 2020-05-04 10:40:17\ntype: \"friends\"\nlayout: \"friends\"\n---</code></pre><p>同时，在你的博客 <code>source</code> 目录下新建 <em>_data</em> 目录，在 <em>_data</em> 目录中新建 <em>friends.json</em> 文件，文件内容如下所示：</p>\n<pre class=\" language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"avatar\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"电商\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"introduction\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"面向谷歌编程\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://43.142.191.46:9527/\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"前去学习\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"avatar\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"RabbitMQ\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"introduction\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"消息列队\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://43.142.191.46:15672/\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"前去学习\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span></code></pre>\n<p>这里可以根据需要进行删减，当然，要看效果可以先这样设置，之后再来修改也不迟。</p>\n<p>新建完页面后，我们再重新生成一下博客静态页，然后运行一下项目，便能看到效果了。这里标签页和分类页都只会展示现有博客的标签和分类数据，所以如果还没有文章设置标题或者分类，那么对应页面是没有数据的。要想看到效果，就得先写几篇文章。</p>\n<h3 id=\"菜单导航配置\"><a href=\"#菜单导航配置\" class=\"headerlink\" title=\"菜单导航配置\"></a>菜单导航配置</h3><h4 id=\"配置基本菜单导航的名称、路径url和图标icon\"><a href=\"#配置基本菜单导航的名称、路径url和图标icon\" class=\"headerlink\" title=\"配置基本菜单导航的名称、路径url和图标icon.\"></a>配置基本菜单导航的名称、路径url和图标icon.</h4><p>1.菜单导航名称可以是中文也可以是英文(如：<code>Index</code>或<code>主页</code>) 2.图标icon 可以在<a href=\"https://fontawesome.com/icons\" target=\"_blank\" rel=\"noopener\">Font Awesome</a> 中查找</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">menu:\n  Index:\n    url: /\n    icon: fas fa-home\n  Tags:\n    url: /tags\n    icon: fas fa-tags\n  Categories:\n    url: /categories\n    icon: fas fa-bookmark\n  Archives:\n    url: /archives\n    icon: fas fa-archive\n  About:\n    url: /about\n    icon: fas fa-user-circle\n  Friends:\n    url: /friends\n    icon: fas fa-address-book</code></pre>\n<h4 id=\"二级菜单配置方法\"><a href=\"#二级菜单配置方法\" class=\"headerlink\" title=\"二级菜单配置方法\"></a>二级菜单配置方法</h4><p>如果你需要二级菜单则可以在原基本菜单导航的基础上如下操作<br>1.在需要添加二级菜单的一级菜单下添加<code>children</code>关键字(如:<code>About</code>菜单下添加<code>children</code>)<br>2.在<code>children</code>下创建二级菜单的 名称name,路径url和图标icon.<br>3.注意每个二级菜单模块前要加 <code>-</code>.<br>4.注意缩进格式</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">menu:\n  Index:\n    url: /\n    icon: fas fa-home\n  Tags:\n    url: /tags\n    icon: fas fa-tags\n  Categories:\n    url: /categories\n    icon: fas fa-bookmark\n  Archives:\n    url: /archives\n    icon: fas fa-archive\n  About:\n    url: /about\n    icon: fas fa-user-circle-o\n  Friends:\n    url: /friends\n    icon: fas fa-address-book\n  Medias:\n    icon: fas fa-list\n    children:\n      - name: Musics\n        url: /musics\n        icon: fas fa-music\n      - name: Movies\n        url: /movies\n        icon: fas fa-film\n      - name: Books\n        url: /books\n        icon: fas fa-book\n      - name: Galleries\n        url: /galleries\n        icon: fas fa-image</code></pre>\n<p>执行 <code>hexo clean &amp;&amp; hexo g</code> 重新生成博客文件，然后就可以在文章中对应位置看到你用<code>emoji</code>语法写的表情了。</p>\n<h3 id=\"代码高亮\"><a href=\"#代码高亮\" class=\"headerlink\" title=\"代码高亮\"></a>代码高亮</h3><p>由于 Hexo 自带的代码高亮主题显示不好看，所以主题中使用到了 <a href=\"https://github.com/ele828/hexo-prism-plugin\" target=\"_blank\" rel=\"noopener\">hexo-prism-plugin</a> 的 Hexo 插件来做代码高亮，安装命令如下：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i -S hexo-prism-plugin</code></pre>\n<p>然后，修改 Hexo 根目录下 <code>_config.yml</code> 文件中 <code>highlight.enable</code> 的值为 <code>false</code>，并新增 <code>prism</code> 插件相关的配置，主要配置如下：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">highlight:\n  enable: false\n\nprism_plugin:\n  mode: 'preprocess'    # realtime/preprocess\n  theme: 'tomorrow'\n  line_number: false    # default false\n  custom_css:</code></pre>\n<h3 id=\"搜索\"><a href=\"#搜索\" class=\"headerlink\" title=\"搜索\"></a>搜索</h3><p>主题中还使用到了 <a href=\"https://github.com/wzpan/hexo-generator-search\" target=\"_blank\" rel=\"noopener\">hexo-generator-search</a> 的 Hexo 插件来做内容搜索，安装命令如下：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-generator-search --save</code></pre>\n<p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">search:\n  path: search.xml\n  field: post</code></pre>\n<p>效果图如下：</p>\n<p><img src=\"https://i.loli.net/2020/05/04/RrE3pQdq9CmtcTP.jpg\" alt=\"hexo-theme-3.jpg\"></p>\n<h3 id=\"中文链接转拼音（建议安装）\"><a href=\"#中文链接转拼音（建议安装）\" class=\"headerlink\" title=\"中文链接转拼音（建议安装）\"></a>中文链接转拼音（建议安装）</h3><p>如果你的文章名称是中文的，那么 <em>Hexo</em> 默认生成的永久链接也会有中文，这样不利于 <code>SEO</code>，且 <code>gitment</code> 评论对中文链接也不支持。我们可以用 <a href=\"https://github.com/viko16/hexo-permalink-pinyin\" target=\"_blank\" rel=\"noopener\">hexo-permalink-pinyin</a> <em>Hexo</em> 插件使在生成文章时生成中文拼音的永久链接。</p>\n<p>安装命令如下：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i hexo-permalink-pinyin --save</code></pre>\n<p>在 <em>Hexo</em> 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">permalink_pinyin:\n  enable: true\n  separator: '-' # default: '-'</code></pre>\n<h3 id=\"文章字数统计插件（建议安装）\"><a href=\"#文章字数统计插件（建议安装）\" class=\"headerlink\" title=\"文章字数统计插件（建议安装）\"></a>文章字数统计插件（建议安装）</h3><p>如果你想要在文章中显示文章字数、阅读时长信息，可以安装 <a href=\"https://github.com/willin/hexo-wordcount\" target=\"_blank\" rel=\"noopener\">hexo-wordcount</a>插件。</p>\n<p>安装命令如下：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i --save hexo-wordcount</code></pre>\n<p>然后只需在本主题下的 <code>_config.yml</code> 文件中，将各个文章字数相关的配置激活即可：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">postInfo:\n  date: true\n  update: true\n  wordCount: true # 设置文章字数统计为 true.\n  totalCount: true # 设置站点文章总字数统计为 true.\n  min2read: true # 阅读时长.\n  readCount: true # 阅读次数.</code></pre>\n<h3 id=\"添加emoji表情支持（可选的）\"><a href=\"#添加emoji表情支持（可选的）\" class=\"headerlink\" title=\"添加emoji表情支持（可选的）\"></a>添加emoji表情支持（可选的）</h3><p><em>Matery</em> 主题新增了对<code>emoji</code>表情的支持，使用到了 <a href=\"https://npm.taobao.org/package/hexo-filter-github-emojis\" target=\"_blank\" rel=\"noopener\">hexo-filter-github-emojis</a> 的 Hexo 插件来支持 <code>emoji</code>表情的生成，把对应的<code>markdown emoji</code>语法（<code>::</code>,例如：<code>:smile:</code>）转变成会跳跃的<code>emoji</code>表情，安装命令如下：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-filter-github-emojis --save</code></pre>\n<p>在 <em>Hexo</em> 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">githubEmojis:\n  enable: true\n  className: github-emoji\n  inject: true\n  styles:\n  customEmojis:</code></pre>\n<h3 id=\"添加-RSS-订阅支持（可选的）\"><a href=\"#添加-RSS-订阅支持（可选的）\" class=\"headerlink\" title=\"添加 RSS 订阅支持（可选的）\"></a>添加 RSS 订阅支持（可选的）</h3><p>主题中还使用到了 <a href=\"https://github.com/hexojs/hexo-generator-feed\" target=\"_blank\" rel=\"noopener\">hexo-generator-feed</a> 的 Hexo 插件来做 <code>RSS</code>，安装命令如下：</p>\n<pre><code>npm install hexo-generator-feed --save</code></pre><p>在 <em>Hexo</em> 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">feed:\n  type: atom\n  path: atom.xml\n  limit: 20\n  hub:\n  content:\n  content_limit: 140\n  content_limit_delim: ' '\n  order_by: -date</code></pre>\n<p>执行 <code>hexo clean &amp;&amp; hexo g</code> 重新生成博客文件，然后在 <code>public</code> 文件夹中即可看到 <code>atom.xml</code> 文件，说明你已经安装成功了。</p>\n<h3 id=\"添加-DaoVoice-在线聊天功能（可选的）\"><a href=\"#添加-DaoVoice-在线聊天功能（可选的）\" class=\"headerlink\" title=\"添加 DaoVoice 在线聊天功能（可选的）\"></a>添加 <a href=\"http://www.daovoice.io/\" target=\"_blank\" rel=\"noopener\">DaoVoice</a> 在线聊天功能（可选的）</h3><p>前往 <a href=\"http://www.daovoice.io/\" target=\"_blank\" rel=\"noopener\">DaoVoice</a> 官网注册并且获取 <code>app_id</code>，并将 <code>app_id</code> 填入主题的 <code>_config.yml</code> 文件中。</p>\n<h3 id=\"添加-Tidio-在线聊天功能（可选的）\"><a href=\"#添加-Tidio-在线聊天功能（可选的）\" class=\"headerlink\" title=\"添加 Tidio 在线聊天功能（可选的）\"></a>添加 <a href=\"https://www.tidio.com/\" target=\"_blank\" rel=\"noopener\">Tidio</a> 在线聊天功能（可选的）</h3><p>前往 <a href=\"https://www.tidio.com/\" target=\"_blank\" rel=\"noopener\">Tidio</a> 官网注册并且获取 <code>Public Key</code>，并将 <code>Public Key</code> 填入主题的 <code>_config.yml</code> 文件中。</p>\n<h3 id=\"修改社交链接\"><a href=\"#修改社交链接\" class=\"headerlink\" title=\"修改社交链接\"></a>修改社交链接</h3><p>在主题的 <code>_config.yml</code> 文件中，默认支持 <code>QQ</code>、<code>GitHub</code> 和邮箱等的配置，你可以在主题文件的 <code>/layout/_partial/social-link.ejs</code> 文件中，新增、修改你需要的社交链接地址，增加链接可参考如下代码：</p>\n<pre><code>&lt;% if (theme.socialLink.github) { %&gt;\n    &lt;a href=\"&lt;%= theme.socialLink.github %&gt;\" class=\"tooltipped\" target=\"_blank\" data-tooltip=\"访问我的GitHub\" data-position=\"top\" data-delay=\"50\"&gt;\n        &lt;i class=\"fab fa-github\"&gt;&lt;/i&gt;\n    &lt;/a&gt;\n&lt;% } %&gt;</code></pre><p>其中，社交图标（如：<code>fa-github</code>）你可以在 <a href=\"https://fontawesome.com/icons\" target=\"_blank\" rel=\"noopener\">Font Awesome</a> 中搜索找到。以下是常用社交图标的标识，供你参考：</p>\n<ul>\n<li>Facebook: <code>fab fa-facebook</code></li>\n<li>Twitter: <code>fab fa-twitter</code></li>\n<li>Google-plus: <code>fab fa-google-plus</code></li>\n<li>Linkedin: <code>fab fa-linkedin</code></li>\n<li>Tumblr: <code>fab fa-tumblr</code></li>\n<li>Medium: <code>fab fa-medium</code></li>\n<li>Slack: <code>fab fa-slack</code></li>\n<li>Sina Weibo: <code>fab fa-weibo</code></li>\n<li>Wechat: <code>fab fa-weixin</code></li>\n<li>QQ: <code>fab fa-qq</code></li>\n<li>Zhihu: <code>fab fa-zhihu</code></li>\n</ul>\n<h3 id=\"修改打赏的二维码图片\"><a href=\"#修改打赏的二维码图片\" class=\"headerlink\" title=\"修改打赏的二维码图片\"></a>修改打赏的二维码图片</h3><p>在主题文件的 <code>source/medias/reward</code> 文件中，可以替换成你的微信和支付宝的打赏二维码图片。</p>\n<h3 id=\"配置音乐播放器（可选的）\"><a href=\"#配置音乐播放器（可选的）\" class=\"headerlink\" title=\"配置音乐播放器（可选的）\"></a>配置音乐播放器（可选的）</h3><p>要支持音乐播放，在主题的 <code>_config.yml</code> 配置文件中激活music配置即可：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\"># 是否在首页显示音乐\nmusic:\n  enable: true\n  title:             #非吸底模式有效\n    enable: true\n    show: 听听音乐\n  server: netease   #require music platform: netease, tencent, kugou, xiami, baidu\n  type: playlist    #require song, playlist, album, search, artist\n  id: 503838841     #require song id / playlist id / album id / search keyword\n  fixed: false      # 开启吸底模式\n  autoplay: false   # 是否自动播放\n  theme: '#42b983'\n  loop: 'all'       # 音频循环播放, 可选值: 'all', 'one', 'none'\n  order: 'random'   # 音频循环顺序, 可选值: 'list', 'random'\n  preload: 'auto'   # 预加载，可选值: 'none', 'metadata', 'auto'\n  volume: 0.7       # 默认音量，请注意播放器会记忆用户设置，用户手动设置音量后默认音量即失效\n  listFolded: true  # 列表默认折叠</code></pre>\n<blockquote>\n<p><code>server</code>可选<code>netease</code>（网易云音乐），<code>tencent</code>（QQ音乐），<code>kugou</code>（酷狗音乐），<code>xiami</code>（虾米音乐），</p>\n<p><code>baidu</code>（百度音乐）。</p>\n<p><code>type</code>可选<code>song</code>（歌曲），<code>playlist</code>（歌单），<code>album</code>（专辑），<code>search</code>（搜索关键字），<code>artist</code>（歌手）</p>\n<p><code>id</code>获取示例: 打开手机版网易云音乐，选择喜欢的歌单，然后点击分享</p>\n</blockquote>\n<p>我这里随便选了一个歌单，分享后的文字长这样：</p>\n<blockquote>\n<p>分享真咸鱼饼干的歌单《青年节：致逐梦人，有志者事竟成》<a href=\"http://music.163.com/playlist/4965675848/1548006936/?userid=120124365\" target=\"_blank\" rel=\"noopener\">http://music.163.com/playlist/4965675848/1548006936/?userid=120124365</a> (@网易云音乐)</p>\n</blockquote>\n<p><code>4965675848</code> 这就是歌单的id，文件里默认设置的歌单其实也还不错，歌挺多的，所以如果没什么特殊要求，使用默认歌单也不错。</p>\n<p>⚠️这里需要注意一点，如果你想要替换成自己的歌单时，会发现，后续歌单的更新是不会影响到它的，这也是我捣鼓半天才发现的，音乐插件使用的是 <em>Aplayer</em> 播放器，在 <em><a href=\"https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js\" target=\"_blank\" rel=\"noopener\">https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js</a></em> 这个文件里可以看到，数据是从这个接口获取的：<em><a href=\"https://api.i-meto.com/meting/api?server=:server&amp;type=:type&amp;id=:id&amp;r=:r\" target=\"_blank\" rel=\"noopener\">https://api.i-meto.com/meting/api?server=:server&amp;type=:type&amp;id=:id&amp;r=:r</a></em>，猜测服务端是直接将获取到的榜单列表写进里数据库，但后续不会进行更新，所以导致无论多少次刷新，都只能获取第一次取到的数据。</p>\n<p>所以有两种解决办法，第一种是创建新歌单，然后一次性添加足够多的歌，然后在配置文件中替换成你的歌单id，另一种是自己写一个网易云音乐歌单解析接口，来获取网易云音乐数据。我比较懒，所以选择了第一种方案，23333，还在充实歌单中。</p>\n<h2 id=\"文章-Front-matter-介绍\"><a href=\"#文章-Front-matter-介绍\" class=\"headerlink\" title=\"文章 Front-matter 介绍\"></a>文章 Front-matter 介绍</h2><h3 id=\"Front-matter-选项详解\"><a href=\"#Front-matter-选项详解\" class=\"headerlink\" title=\"Front-matter 选项详解\"></a>Front-matter 选项详解</h3><p><code>Front-matter</code> 选项中的所有内容均为<strong>非必填</strong>的。但建议至少填写 <code>title</code> 和 <code>date</code> 的值。</p>\n<table>\n<thead>\n<tr>\n<th>配置选项</th>\n<th>默认值</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>title</td>\n<td><code>Markdown</code> 的文件标题</td>\n<td>文章标题，强烈建议填写此选项</td>\n</tr>\n<tr>\n<td>date</td>\n<td>文件创建时的日期时间</td>\n<td>发布时间，强烈建议填写此选项，且最好保证全局唯一</td>\n</tr>\n<tr>\n<td>author</td>\n<td>根 <code>_config.yml</code> 中的 <code>author</code></td>\n<td>文章作者</td>\n</tr>\n<tr>\n<td>img</td>\n<td><code>featureImages</code> 中的某个值</td>\n<td>文章特征图，推荐使用图床(腾讯云、七牛云、又拍云等)来做图片的路径.如: <code>http://xxx.com/xxx.jpg</code></td>\n</tr>\n<tr>\n<td>top</td>\n<td><code>true</code></td>\n<td>推荐文章（文章是否置顶），如果 <code>top</code> 值为 <code>true</code>，则会作为首页推荐文章</td>\n</tr>\n<tr>\n<td>cover</td>\n<td><code>false</code></td>\n<td><code>v1.0.2</code>版本新增，表示该文章是否需要加入到首页轮播封面中</td>\n</tr>\n<tr>\n<td>coverImg</td>\n<td>无</td>\n<td><code>v1.0.2</code>版本新增，表示该文章在首页轮播封面需要显示的图片路径，如果没有，则默认使用文章的特色图片</td>\n</tr>\n<tr>\n<td>password</td>\n<td>无</td>\n<td>文章阅读密码，如果要对文章设置阅读验证密码的话，就可以设置 <code>password</code> 的值，该值必须是用 <code>SHA256</code> 加密后的密码，防止被他人识破。前提是在主题的 <code>config.yml</code> 中激活了 <code>verifyPassword</code> 选项</td>\n</tr>\n<tr>\n<td>toc</td>\n<td><code>true</code></td>\n<td>是否开启 TOC，可以针对某篇文章单独关闭 TOC 的功能。前提是在主题的 <code>config.yml</code> 中激活了 <code>toc</code> 选项</td>\n</tr>\n<tr>\n<td>mathjax</td>\n<td><code>false</code></td>\n<td>是否开启数学公式支持 ，本文章是否开启 <code>mathjax</code>，且需要在主题的 <code>_config.yml</code> 文件中也需要开启才行</td>\n</tr>\n<tr>\n<td>summary</td>\n<td>无</td>\n<td>文章摘要，自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要</td>\n</tr>\n<tr>\n<td>categories</td>\n<td>无</td>\n<td>文章分类，本主题的分类表示宏观上大的分类，只建议一篇文章一个分类</td>\n</tr>\n<tr>\n<td>tags</td>\n<td>无</td>\n<td>文章标签，一篇文章可以多个标签</td>\n</tr>\n<tr>\n<td>keywords</td>\n<td>文章标题</td>\n<td>文章关键字，SEO 时需要</td>\n</tr>\n<tr>\n<td>reprintPolicy</td>\n<td>cc_by</td>\n<td>文章转载规则， 可以是 cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint 或 pay 中的一个</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p><strong>注意</strong>:</p>\n<ol>\n<li>如果 <code>img</code> 属性不填写的话，文章特色图会根据文章标题的 <code>hashcode</code> 的值取余，然后选取主题中对应的特色图片，从而达到让所有文章都的特色图<strong>各有特色</strong>。</li>\n<li><code>date</code> 的值尽量保证每篇文章是唯一的，因为本主题中 <code>Gitalk</code> 和 <code>Gitment</code> 识别 <code>id</code> 是通过 <code>date</code> 的值来作为唯一标识的。</li>\n<li>如果要对文章设置阅读验证密码的功能，不仅要在 Front-matter 中设置采用了 SHA256 加密的 password 的值，还需要在主题的 <code>_config.yml</code> 中激活了配置。有些在线的 SHA256 加密的地址，可供你使用：<a href=\"http://tool.oschina.net/encrypt?type=2\" target=\"_blank\" rel=\"noopener\">开源中国在线工具</a>、<a href=\"http://encode.chahuo.com/\" target=\"_blank\" rel=\"noopener\">chahuo</a>、<a href=\"http://tool.chinaz.com/tools/hash.aspx\" target=\"_blank\" rel=\"noopener\">站长工具</a>。</li>\n<li>您可以在文章md文件的 front-matter 中指定 reprintPolicy 来给单个文章配置转载规则</li>\n</ol>\n</blockquote>\n<p>以下为文章的 <code>Front-matter</code> 示例。</p>\n<p>最简示例</p>\n<pre><code>---\ntitle: typora-vue-theme主题介绍\ndate: 2018-09-07 09:25:00\n---</code></pre><p>最全示例</p>\n<pre><code>---\ntitle: typora-vue-theme主题介绍\ndate: 2018-09-07 09:25:00\nauthor: 赵奇\nimg: /source/images/xxx.jpg\ntop: true\ncover: true\ncoverImg: /images/1.jpg\npassword: 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92\ntoc: false\nmathjax: false\nsummary: 这是你自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要\ncategories: Markdown\ntags:\n  - Typora\n  - Markdown\n---</code></pre><p>上述大部分内容都来自主题说明文档，只是添加了一下我觉得需要注意的地方。这里还有一些没有说到到的属性，这配置文件里都有详细的介绍，确实不需要过多解释。</p>\n<p>最后再介绍一下我折腾比较久的插件，valine 评价插件。</p>\n<h2 id=\"Valine-评价插件\"><a href=\"#Valine-评价插件\" class=\"headerlink\" title=\"Valine 评价插件\"></a>Valine 评价插件</h2><p>插件主页：<em><a href=\"https://valine.js.org/\" target=\"_blank\" rel=\"noopener\">https://valine.js.org/</a></em> ，上面有详细的介绍，可以查看<a href=\"https://valine.js.org/quickstart.html\" target=\"_blank\" rel=\"noopener\">这里</a>，注册后，验证邮箱，绑定手机号，然后新建一个应用，获取到对应的 <code>AppId</code> 和 <code>AppKey</code>，然后写回到主题文件下到 <code>_config.yml</code> 文件里，但是要<strong>注意一点，不要直接使用国内版进行注册，而要用国际版，否则无法申请二级域名</strong>。</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">valine:\n  enable: true\n  appId: XXX\n  appKey: XXX\n  notify: true\n  verify: false\n  visitor: true\n  avatar: 'retro' # Gravatar style : mm/identicon/monsterid/wavatar/retro/hide\n  pageSize: 10\n  placeholder: 'Comment here' # Comment Box placeholder\n  background: /medias/comment_bg.png</code></pre>\n<p>最新版的 <code>Valine</code> 已经移除了邮件通知功能。如果没有邮件通知，很可能别人评价之后，你却毫不知情，后续回复对方也收不到。因此，需要再配置一个插件来实现， ++<a href=\"https://github.com/zhaojun1998/Valine-Admin++\" target=\"_blank\" rel=\"noopener\">https://github.com/zhaojun1998/Valine-Admin++</a> 。在配置这个插件之前，需要确保 <code>Valine</code> 可以正常工作，可以自己给自己评论一下进行测试。</p>\n<p>配置好之后，别人在你的文章下评论后你便能收到邮件通知了。</p>\n<p>至此，<code>Matery</code> 主题就搭建配置完成了，接下来就只需要安心写博客了～</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>前两篇文章介绍了 <code>Hexo</code> + <code>github pages</code> + <code>travis ci</code> 进行自动化部署，并介绍了 <code>Hexo</code> 的配置文件中的各个属性，相信通过前两篇文章的学习，你已经学会了如何搭建自己的博客，并能够根据自己的需要进行个性化配置。</p>\n<p>这一篇将以 <code>Matery</code> 这款主题为例，说明一下主题应该如何配置。包括主题配置、插件设置、注意事项等。</p>\n<h2 id=\"设置博客主题\"><a href=\"#设置博客主题\" class=\"headerlink\" title=\"设置博客主题\"></a>设置博客主题</h2><p>先到<a href=\"https://hexo.io/themes/\" target=\"_blank\" rel=\"noopener\">这里</a> 选择你喜欢的主题，点击它的标题（注意，点图片是进去 <em>demo</em> 站点，点标题才是跳转到对应到 <em>github</em> 仓库），跳转到 <em>github</em> 仓库，复制其仓库地址。</p>\n<p>比如我使用到主题是 <code>Matery</code> ，其项目地址为：<code>git@github.com:blinkfox/hexo-theme-matery.git</code>。</p>\n<p>打开本地目录，来到与我们的博客项目同级的目录（注意是同级，不是在博客项目内部），将主题项目克隆到本地。</p>\n<pre><code class=\"bash\">git clone git@github.com:blinkfox/hexo-theme-matery.git</code></pre>\n<p>在博客项目下的 <em>themes</em> 文件夹里新建一个叫 <em>matery</em> 的文件夹，然后将主题文件复制到这个文件夹里：</p>\n<pre><code class=\"bash\">mkdir breeze-blog/themes/matery\ncp -r hexo-theme-matery/* breeze-blog/themes/matery</code></pre>\n<p>这里的 <em>breeze-blog</em> 是我的博客项目所在的文件夹，这里替换成你的即可。</p>\n<p>再次打开我们的配置文件(<em>_config.yml</em>)，修改 <em>theme</em> 属性，设置为博客主题所在的文件夹名，这里即为 <em>matery</em>，注意要与文件夹名称完全一致。</p>\n<p>然后我们重新生成一下博客静态文件：</p>\n<pre><code class=\"bash\">cd breeze-blog\nhexo clean &amp;&amp; hexo generate\nhexo server</code></pre>\n<p>然后再打开我们的博客地址：<code>localhost:4000</code>，我们的主题便设置好了。</p>\n<p><img src=\"https://i.loli.net/2020/05/04/YKwFax1NrtVL6Zo.jpg\" alt=\"hexo-theme-1.jpg\"></p>\n<p>但现在大部分信息都是默认数据，所以我们需要根据需要进行自定义设置，不同主题的配置文件都不太一样，因此设置方法也有所不同，这里仅介绍 <code>Matery</code> 主题的设置方法。</p>\n<h2 id=\"主题内容自定义\"><a href=\"#主题内容自定义\" class=\"headerlink\" title=\"主题内容自定义\"></a>主题内容自定义</h2><h3 id=\"新建页面\"><a href=\"#新建页面\" class=\"headerlink\" title=\"新建页面\"></a>新建页面</h3><p>如果你点击首页最上面的那一栏，会发现很多页面打开是没有的，因为我们还没有创建对应的页面，所以需要先创建对应的页面。</p>\n<p><img src=\"https://i.loli.net/2020/05/04/9o7sjVdBMcm24TP.jpg\" alt=\"hexo-theme-2.jpg\"></p>\n<p>先新建分类 <code>categories</code> 页，<code>categories</code> 页是用来展示所有分类的页面，命令如下：</p>\n<pre><code class=\"bash\">hexo new page &quot;categories&quot;</code></pre>\n<p>编辑新建的页面文件 <em>/source/categories/index.md</em>，写入以下内容：</p>\n<pre><code>---\ntitle: categories\ndate: 2020-05-04 10:40:13\ntype: &quot;categories&quot;\nlayout: &quot;categories&quot;\n---</code></pre><p>然后新建标签 <code>tags</code> 页，<code>tags</code> 页是用来展示所有标签的页面，命令如下：</p>\n<pre><code class=\"bash\">hexo new page &quot;tags&quot;</code></pre>\n<p>编辑新建的页面文件 <em>/source/tags/index.md</em>，写入以下内容：</p>\n<pre><code>---\ntitle: tags\ndate: 2020-05-04 10:40:14\ntype: &quot;tags&quot;\nlayout: &quot;tags&quot;\n---</code></pre><p>接下来是新建 <code>about</code> 页，<code>about</code> 页是用来展示关于我和我的博客信息的页面，命令如下：</p>\n<pre><code class=\"bash\">hexo new page &quot;about&quot;</code></pre>\n<p>编辑新建的页面文件 <code>/source/about/index.md</code>，写入以下内容：</p>\n<pre><code>---\ntitle: about\ndate: 2020-05-04 10:40:15\ntype: &quot;about&quot;\nlayout: &quot;about&quot;\n---</code></pre><p>然后新建留言板 <code>contact</code> 页，<code>contact</code> 页是用来展示留言板信息的页面，方便其他人进行统一留言，命令如下：</p>\n<pre><code class=\"bash\">hexo new page &quot;contact&quot;</code></pre>\n<p>编辑新建的页面文件 <em>/source/contact/index.md</em>，写入以下内容：</p>\n<pre><code>---\ntitle: contact\ndate: 2020-05-04 10:40:16\ntype: &quot;contact&quot;\nlayout: &quot;contact&quot;\n---</code></pre><p>注意，留言板功能依赖于第三方评论系统，需要先激活评论系统才有效果，如果嫌麻烦不想使用，也可以不处理，后面在菜单栏里去掉这一选项即可。</p>\n<p>最后，新建友情链接 <code>friends</code> 页，<code>friends</code> 页是用来展示友情链接信息的页面，命令如下：</p>\n<pre><code class=\"bash\">hexo new page &quot;friends&quot;</code></pre>\n<p>编辑新建的页面文件 <em>/source/friends/index.md</em>，写入以下内容：</p>\n<pre><code>---\ntitle: friends\ndate: 2020-05-04 10:40:17\ntype: &quot;friends&quot;\nlayout: &quot;friends&quot;\n---</code></pre><p>同时，在你的博客 <code>source</code> 目录下新建 <em>_data</em> 目录，在 <em>_data</em> 目录中新建 <em>friends.json</em> 文件，文件内容如下所示：</p>\n<pre><code class=\"json\">[{\n  &quot;avatar&quot;: &quot;http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png&quot;,\n  &quot;name&quot;: &quot;电商&quot;,\n  &quot;introduction&quot;: &quot;面向谷歌编程&quot;,\n  &quot;url&quot;: &quot;http://43.142.191.46:9527/&quot;,\n  &quot;title&quot;: &quot;前去学习&quot;\n},{\n  &quot;avatar&quot;: &quot;http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png&quot;,\n  &quot;name&quot;: &quot;RabbitMQ&quot;,\n  &quot;introduction&quot;: &quot;消息列队&quot;,\n  &quot;url&quot;: &quot;http://43.142.191.46:15672/&quot;,\n  &quot;title&quot;: &quot;前去学习&quot;\n}]</code></pre>\n<p>这里可以根据需要进行删减，当然，要看效果可以先这样设置，之后再来修改也不迟。</p>\n<p>新建完页面后，我们再重新生成一下博客静态页，然后运行一下项目，便能看到效果了。这里标签页和分类页都只会展示现有博客的标签和分类数据，所以如果还没有文章设置标题或者分类，那么对应页面是没有数据的。要想看到效果，就得先写几篇文章。</p>\n<h3 id=\"菜单导航配置\"><a href=\"#菜单导航配置\" class=\"headerlink\" title=\"菜单导航配置\"></a>菜单导航配置</h3><h4 id=\"配置基本菜单导航的名称、路径url和图标icon\"><a href=\"#配置基本菜单导航的名称、路径url和图标icon\" class=\"headerlink\" title=\"配置基本菜单导航的名称、路径url和图标icon.\"></a>配置基本菜单导航的名称、路径url和图标icon.</h4><p>1.菜单导航名称可以是中文也可以是英文(如：<code>Index</code>或<code>主页</code>) 2.图标icon 可以在<a href=\"https://fontawesome.com/icons\" target=\"_blank\" rel=\"noopener\">Font Awesome</a> 中查找</p>\n<pre><code class=\"yml\">menu:\n  Index:\n    url: /\n    icon: fas fa-home\n  Tags:\n    url: /tags\n    icon: fas fa-tags\n  Categories:\n    url: /categories\n    icon: fas fa-bookmark\n  Archives:\n    url: /archives\n    icon: fas fa-archive\n  About:\n    url: /about\n    icon: fas fa-user-circle\n  Friends:\n    url: /friends\n    icon: fas fa-address-book</code></pre>\n<h4 id=\"二级菜单配置方法\"><a href=\"#二级菜单配置方法\" class=\"headerlink\" title=\"二级菜单配置方法\"></a>二级菜单配置方法</h4><p>如果你需要二级菜单则可以在原基本菜单导航的基础上如下操作<br>1.在需要添加二级菜单的一级菜单下添加<code>children</code>关键字(如:<code>About</code>菜单下添加<code>children</code>)<br>2.在<code>children</code>下创建二级菜单的 名称name,路径url和图标icon.<br>3.注意每个二级菜单模块前要加 <code>-</code>.<br>4.注意缩进格式</p>\n<pre><code class=\"yml\">menu:\n  Index:\n    url: /\n    icon: fas fa-home\n  Tags:\n    url: /tags\n    icon: fas fa-tags\n  Categories:\n    url: /categories\n    icon: fas fa-bookmark\n  Archives:\n    url: /archives\n    icon: fas fa-archive\n  About:\n    url: /about\n    icon: fas fa-user-circle-o\n  Friends:\n    url: /friends\n    icon: fas fa-address-book\n  Medias:\n    icon: fas fa-list\n    children:\n      - name: Musics\n        url: /musics\n        icon: fas fa-music\n      - name: Movies\n        url: /movies\n        icon: fas fa-film\n      - name: Books\n        url: /books\n        icon: fas fa-book\n      - name: Galleries\n        url: /galleries\n        icon: fas fa-image</code></pre>\n<p>执行 <code>hexo clean &amp;&amp; hexo g</code> 重新生成博客文件，然后就可以在文章中对应位置看到你用<code>emoji</code>语法写的表情了。</p>\n<h3 id=\"代码高亮\"><a href=\"#代码高亮\" class=\"headerlink\" title=\"代码高亮\"></a>代码高亮</h3><p>由于 Hexo 自带的代码高亮主题显示不好看，所以主题中使用到了 <a href=\"https://github.com/ele828/hexo-prism-plugin\" target=\"_blank\" rel=\"noopener\">hexo-prism-plugin</a> 的 Hexo 插件来做代码高亮，安装命令如下：</p>\n<pre><code class=\"bash\">npm i -S hexo-prism-plugin</code></pre>\n<p>然后，修改 Hexo 根目录下 <code>_config.yml</code> 文件中 <code>highlight.enable</code> 的值为 <code>false</code>，并新增 <code>prism</code> 插件相关的配置，主要配置如下：</p>\n<pre><code class=\"yml\">highlight:\n  enable: false\n\nprism_plugin:\n  mode: &#39;preprocess&#39;    # realtime/preprocess\n  theme: &#39;tomorrow&#39;\n  line_number: false    # default false\n  custom_css:</code></pre>\n<h3 id=\"搜索\"><a href=\"#搜索\" class=\"headerlink\" title=\"搜索\"></a>搜索</h3><p>主题中还使用到了 <a href=\"https://github.com/wzpan/hexo-generator-search\" target=\"_blank\" rel=\"noopener\">hexo-generator-search</a> 的 Hexo 插件来做内容搜索，安装命令如下：</p>\n<pre><code class=\"bash\">npm install hexo-generator-search --save</code></pre>\n<p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p>\n<pre><code class=\"yml\">search:\n  path: search.xml\n  field: post</code></pre>\n<p>效果图如下：</p>\n<p><img src=\"https://i.loli.net/2020/05/04/RrE3pQdq9CmtcTP.jpg\" alt=\"hexo-theme-3.jpg\"></p>\n<h3 id=\"中文链接转拼音（建议安装）\"><a href=\"#中文链接转拼音（建议安装）\" class=\"headerlink\" title=\"中文链接转拼音（建议安装）\"></a>中文链接转拼音（建议安装）</h3><p>如果你的文章名称是中文的，那么 <em>Hexo</em> 默认生成的永久链接也会有中文，这样不利于 <code>SEO</code>，且 <code>gitment</code> 评论对中文链接也不支持。我们可以用 <a href=\"https://github.com/viko16/hexo-permalink-pinyin\" target=\"_blank\" rel=\"noopener\">hexo-permalink-pinyin</a> <em>Hexo</em> 插件使在生成文章时生成中文拼音的永久链接。</p>\n<p>安装命令如下：</p>\n<pre><code class=\"bash\">npm i hexo-permalink-pinyin --save</code></pre>\n<p>在 <em>Hexo</em> 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p>\n<pre><code class=\"yml\">permalink_pinyin:\n  enable: true\n  separator: &#39;-&#39; # default: &#39;-&#39;</code></pre>\n<h3 id=\"文章字数统计插件（建议安装）\"><a href=\"#文章字数统计插件（建议安装）\" class=\"headerlink\" title=\"文章字数统计插件（建议安装）\"></a>文章字数统计插件（建议安装）</h3><p>如果你想要在文章中显示文章字数、阅读时长信息，可以安装 <a href=\"https://github.com/willin/hexo-wordcount\" target=\"_blank\" rel=\"noopener\">hexo-wordcount</a>插件。</p>\n<p>安装命令如下：</p>\n<pre><code class=\"bash\">npm i --save hexo-wordcount</code></pre>\n<p>然后只需在本主题下的 <code>_config.yml</code> 文件中，将各个文章字数相关的配置激活即可：</p>\n<pre><code class=\"yml\">postInfo:\n  date: true\n  update: true\n  wordCount: true # 设置文章字数统计为 true.\n  totalCount: true # 设置站点文章总字数统计为 true.\n  min2read: true # 阅读时长.\n  readCount: true # 阅读次数.</code></pre>\n<h3 id=\"添加emoji表情支持（可选的）\"><a href=\"#添加emoji表情支持（可选的）\" class=\"headerlink\" title=\"添加emoji表情支持（可选的）\"></a>添加emoji表情支持（可选的）</h3><p><em>Matery</em> 主题新增了对<code>emoji</code>表情的支持，使用到了 <a href=\"https://npm.taobao.org/package/hexo-filter-github-emojis\" target=\"_blank\" rel=\"noopener\">hexo-filter-github-emojis</a> 的 Hexo 插件来支持 <code>emoji</code>表情的生成，把对应的<code>markdown emoji</code>语法（<code>::</code>,例如：<code>:smile:</code>）转变成会跳跃的<code>emoji</code>表情，安装命令如下：</p>\n<pre><code class=\"bash\">npm install hexo-filter-github-emojis --save</code></pre>\n<p>在 <em>Hexo</em> 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p>\n<pre><code class=\"yml\">githubEmojis:\n  enable: true\n  className: github-emoji\n  inject: true\n  styles:\n  customEmojis:</code></pre>\n<h3 id=\"添加-RSS-订阅支持（可选的）\"><a href=\"#添加-RSS-订阅支持（可选的）\" class=\"headerlink\" title=\"添加 RSS 订阅支持（可选的）\"></a>添加 RSS 订阅支持（可选的）</h3><p>主题中还使用到了 <a href=\"https://github.com/hexojs/hexo-generator-feed\" target=\"_blank\" rel=\"noopener\">hexo-generator-feed</a> 的 Hexo 插件来做 <code>RSS</code>，安装命令如下：</p>\n<pre><code>npm install hexo-generator-feed --save</code></pre><p>在 <em>Hexo</em> 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p>\n<pre><code class=\"yml\">feed:\n  type: atom\n  path: atom.xml\n  limit: 20\n  hub:\n  content:\n  content_limit: 140\n  content_limit_delim: &#39; &#39;\n  order_by: -date</code></pre>\n<p>执行 <code>hexo clean &amp;&amp; hexo g</code> 重新生成博客文件，然后在 <code>public</code> 文件夹中即可看到 <code>atom.xml</code> 文件，说明你已经安装成功了。</p>\n<h3 id=\"添加-DaoVoice-在线聊天功能（可选的）\"><a href=\"#添加-DaoVoice-在线聊天功能（可选的）\" class=\"headerlink\" title=\"添加 DaoVoice 在线聊天功能（可选的）\"></a>添加 <a href=\"http://www.daovoice.io/\" target=\"_blank\" rel=\"noopener\">DaoVoice</a> 在线聊天功能（可选的）</h3><p>前往 <a href=\"http://www.daovoice.io/\" target=\"_blank\" rel=\"noopener\">DaoVoice</a> 官网注册并且获取 <code>app_id</code>，并将 <code>app_id</code> 填入主题的 <code>_config.yml</code> 文件中。</p>\n<h3 id=\"添加-Tidio-在线聊天功能（可选的）\"><a href=\"#添加-Tidio-在线聊天功能（可选的）\" class=\"headerlink\" title=\"添加 Tidio 在线聊天功能（可选的）\"></a>添加 <a href=\"https://www.tidio.com/\" target=\"_blank\" rel=\"noopener\">Tidio</a> 在线聊天功能（可选的）</h3><p>前往 <a href=\"https://www.tidio.com/\" target=\"_blank\" rel=\"noopener\">Tidio</a> 官网注册并且获取 <code>Public Key</code>，并将 <code>Public Key</code> 填入主题的 <code>_config.yml</code> 文件中。</p>\n<h3 id=\"修改社交链接\"><a href=\"#修改社交链接\" class=\"headerlink\" title=\"修改社交链接\"></a>修改社交链接</h3><p>在主题的 <code>_config.yml</code> 文件中，默认支持 <code>QQ</code>、<code>GitHub</code> 和邮箱等的配置，你可以在主题文件的 <code>/layout/_partial/social-link.ejs</code> 文件中，新增、修改你需要的社交链接地址，增加链接可参考如下代码：</p>\n<pre><code>&lt;% if (theme.socialLink.github) { %&gt;\n    &lt;a href=&quot;&lt;%= theme.socialLink.github %&gt;&quot; class=&quot;tooltipped&quot; target=&quot;_blank&quot; data-tooltip=&quot;访问我的GitHub&quot; data-position=&quot;top&quot; data-delay=&quot;50&quot;&gt;\n        &lt;i class=&quot;fab fa-github&quot;&gt;&lt;/i&gt;\n    &lt;/a&gt;\n&lt;% } %&gt;</code></pre><p>其中，社交图标（如：<code>fa-github</code>）你可以在 <a href=\"https://fontawesome.com/icons\" target=\"_blank\" rel=\"noopener\">Font Awesome</a> 中搜索找到。以下是常用社交图标的标识，供你参考：</p>\n<ul>\n<li>Facebook: <code>fab fa-facebook</code></li>\n<li>Twitter: <code>fab fa-twitter</code></li>\n<li>Google-plus: <code>fab fa-google-plus</code></li>\n<li>Linkedin: <code>fab fa-linkedin</code></li>\n<li>Tumblr: <code>fab fa-tumblr</code></li>\n<li>Medium: <code>fab fa-medium</code></li>\n<li>Slack: <code>fab fa-slack</code></li>\n<li>Sina Weibo: <code>fab fa-weibo</code></li>\n<li>Wechat: <code>fab fa-weixin</code></li>\n<li>QQ: <code>fab fa-qq</code></li>\n<li>Zhihu: <code>fab fa-zhihu</code></li>\n</ul>\n<h3 id=\"修改打赏的二维码图片\"><a href=\"#修改打赏的二维码图片\" class=\"headerlink\" title=\"修改打赏的二维码图片\"></a>修改打赏的二维码图片</h3><p>在主题文件的 <code>source/medias/reward</code> 文件中，可以替换成你的微信和支付宝的打赏二维码图片。</p>\n<h3 id=\"配置音乐播放器（可选的）\"><a href=\"#配置音乐播放器（可选的）\" class=\"headerlink\" title=\"配置音乐播放器（可选的）\"></a>配置音乐播放器（可选的）</h3><p>要支持音乐播放，在主题的 <code>_config.yml</code> 配置文件中激活music配置即可：</p>\n<pre><code class=\"yml\"># 是否在首页显示音乐\nmusic:\n  enable: true\n  title:             #非吸底模式有效\n    enable: true\n    show: 听听音乐\n  server: netease   #require music platform: netease, tencent, kugou, xiami, baidu\n  type: playlist    #require song, playlist, album, search, artist\n  id: 503838841     #require song id / playlist id / album id / search keyword\n  fixed: false      # 开启吸底模式\n  autoplay: false   # 是否自动播放\n  theme: &#39;#42b983&#39;\n  loop: &#39;all&#39;       # 音频循环播放, 可选值: &#39;all&#39;, &#39;one&#39;, &#39;none&#39;\n  order: &#39;random&#39;   # 音频循环顺序, 可选值: &#39;list&#39;, &#39;random&#39;\n  preload: &#39;auto&#39;   # 预加载，可选值: &#39;none&#39;, &#39;metadata&#39;, &#39;auto&#39;\n  volume: 0.7       # 默认音量，请注意播放器会记忆用户设置，用户手动设置音量后默认音量即失效\n  listFolded: true  # 列表默认折叠</code></pre>\n<blockquote>\n<p><code>server</code>可选<code>netease</code>（网易云音乐），<code>tencent</code>（QQ音乐），<code>kugou</code>（酷狗音乐），<code>xiami</code>（虾米音乐），</p>\n<p><code>baidu</code>（百度音乐）。</p>\n<p><code>type</code>可选<code>song</code>（歌曲），<code>playlist</code>（歌单），<code>album</code>（专辑），<code>search</code>（搜索关键字），<code>artist</code>（歌手）</p>\n<p><code>id</code>获取示例: 打开手机版网易云音乐，选择喜欢的歌单，然后点击分享</p>\n</blockquote>\n<p>我这里随便选了一个歌单，分享后的文字长这样：</p>\n<blockquote>\n<p>分享真咸鱼饼干的歌单《青年节：致逐梦人，有志者事竟成》<a href=\"http://music.163.com/playlist/4965675848/1548006936/?userid=120124365\" target=\"_blank\" rel=\"noopener\">http://music.163.com/playlist/4965675848/1548006936/?userid=120124365</a> (@网易云音乐)</p>\n</blockquote>\n<p><code>4965675848</code> 这就是歌单的id，文件里默认设置的歌单其实也还不错，歌挺多的，所以如果没什么特殊要求，使用默认歌单也不错。</p>\n<p>⚠️这里需要注意一点，如果你想要替换成自己的歌单时，会发现，后续歌单的更新是不会影响到它的，这也是我捣鼓半天才发现的，音乐插件使用的是 <em>Aplayer</em> 播放器，在 <em><a href=\"https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js\" target=\"_blank\" rel=\"noopener\">https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js</a></em> 这个文件里可以看到，数据是从这个接口获取的：<em><a href=\"https://api.i-meto.com/meting/api?server=:server&amp;type=:type&amp;id=:id&amp;r=:r\" target=\"_blank\" rel=\"noopener\">https://api.i-meto.com/meting/api?server=:server&amp;type=:type&amp;id=:id&amp;r=:r</a></em>，猜测服务端是直接将获取到的榜单列表写进里数据库，但后续不会进行更新，所以导致无论多少次刷新，都只能获取第一次取到的数据。</p>\n<p>所以有两种解决办法，第一种是创建新歌单，然后一次性添加足够多的歌，然后在配置文件中替换成你的歌单id，另一种是自己写一个网易云音乐歌单解析接口，来获取网易云音乐数据。我比较懒，所以选择了第一种方案，23333，还在充实歌单中。</p>\n<h2 id=\"文章-Front-matter-介绍\"><a href=\"#文章-Front-matter-介绍\" class=\"headerlink\" title=\"文章 Front-matter 介绍\"></a>文章 Front-matter 介绍</h2><h3 id=\"Front-matter-选项详解\"><a href=\"#Front-matter-选项详解\" class=\"headerlink\" title=\"Front-matter 选项详解\"></a>Front-matter 选项详解</h3><p><code>Front-matter</code> 选项中的所有内容均为<strong>非必填</strong>的。但建议至少填写 <code>title</code> 和 <code>date</code> 的值。</p>\n<table>\n<thead>\n<tr>\n<th>配置选项</th>\n<th>默认值</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>title</td>\n<td><code>Markdown</code> 的文件标题</td>\n<td>文章标题，强烈建议填写此选项</td>\n</tr>\n<tr>\n<td>date</td>\n<td>文件创建时的日期时间</td>\n<td>发布时间，强烈建议填写此选项，且最好保证全局唯一</td>\n</tr>\n<tr>\n<td>author</td>\n<td>根 <code>_config.yml</code> 中的 <code>author</code></td>\n<td>文章作者</td>\n</tr>\n<tr>\n<td>img</td>\n<td><code>featureImages</code> 中的某个值</td>\n<td>文章特征图，推荐使用图床(腾讯云、七牛云、又拍云等)来做图片的路径.如: <code>http://xxx.com/xxx.jpg</code></td>\n</tr>\n<tr>\n<td>top</td>\n<td><code>true</code></td>\n<td>推荐文章（文章是否置顶），如果 <code>top</code> 值为 <code>true</code>，则会作为首页推荐文章</td>\n</tr>\n<tr>\n<td>cover</td>\n<td><code>false</code></td>\n<td><code>v1.0.2</code>版本新增，表示该文章是否需要加入到首页轮播封面中</td>\n</tr>\n<tr>\n<td>coverImg</td>\n<td>无</td>\n<td><code>v1.0.2</code>版本新增，表示该文章在首页轮播封面需要显示的图片路径，如果没有，则默认使用文章的特色图片</td>\n</tr>\n<tr>\n<td>password</td>\n<td>无</td>\n<td>文章阅读密码，如果要对文章设置阅读验证密码的话，就可以设置 <code>password</code> 的值，该值必须是用 <code>SHA256</code> 加密后的密码，防止被他人识破。前提是在主题的 <code>config.yml</code> 中激活了 <code>verifyPassword</code> 选项</td>\n</tr>\n<tr>\n<td>toc</td>\n<td><code>true</code></td>\n<td>是否开启 TOC，可以针对某篇文章单独关闭 TOC 的功能。前提是在主题的 <code>config.yml</code> 中激活了 <code>toc</code> 选项</td>\n</tr>\n<tr>\n<td>mathjax</td>\n<td><code>false</code></td>\n<td>是否开启数学公式支持 ，本文章是否开启 <code>mathjax</code>，且需要在主题的 <code>_config.yml</code> 文件中也需要开启才行</td>\n</tr>\n<tr>\n<td>summary</td>\n<td>无</td>\n<td>文章摘要，自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要</td>\n</tr>\n<tr>\n<td>categories</td>\n<td>无</td>\n<td>文章分类，本主题的分类表示宏观上大的分类，只建议一篇文章一个分类</td>\n</tr>\n<tr>\n<td>tags</td>\n<td>无</td>\n<td>文章标签，一篇文章可以多个标签</td>\n</tr>\n<tr>\n<td>keywords</td>\n<td>文章标题</td>\n<td>文章关键字，SEO 时需要</td>\n</tr>\n<tr>\n<td>reprintPolicy</td>\n<td>cc_by</td>\n<td>文章转载规则， 可以是 cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint 或 pay 中的一个</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p><strong>注意</strong>:</p>\n<ol>\n<li>如果 <code>img</code> 属性不填写的话，文章特色图会根据文章标题的 <code>hashcode</code> 的值取余，然后选取主题中对应的特色图片，从而达到让所有文章都的特色图<strong>各有特色</strong>。</li>\n<li><code>date</code> 的值尽量保证每篇文章是唯一的，因为本主题中 <code>Gitalk</code> 和 <code>Gitment</code> 识别 <code>id</code> 是通过 <code>date</code> 的值来作为唯一标识的。</li>\n<li>如果要对文章设置阅读验证密码的功能，不仅要在 Front-matter 中设置采用了 SHA256 加密的 password 的值，还需要在主题的 <code>_config.yml</code> 中激活了配置。有些在线的 SHA256 加密的地址，可供你使用：<a href=\"http://tool.oschina.net/encrypt?type=2\" target=\"_blank\" rel=\"noopener\">开源中国在线工具</a>、<a href=\"http://encode.chahuo.com/\" target=\"_blank\" rel=\"noopener\">chahuo</a>、<a href=\"http://tool.chinaz.com/tools/hash.aspx\" target=\"_blank\" rel=\"noopener\">站长工具</a>。</li>\n<li>您可以在文章md文件的 front-matter 中指定 reprintPolicy 来给单个文章配置转载规则</li>\n</ol>\n</blockquote>\n<p>以下为文章的 <code>Front-matter</code> 示例。</p>\n<p>最简示例</p>\n<pre><code>---\ntitle: typora-vue-theme主题介绍\ndate: 2018-09-07 09:25:00\n---</code></pre><p>最全示例</p>\n<pre><code>---\ntitle: typora-vue-theme主题介绍\ndate: 2018-09-07 09:25:00\nauthor: 赵奇\nimg: /source/images/xxx.jpg\ntop: true\ncover: true\ncoverImg: /images/1.jpg\npassword: 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92\ntoc: false\nmathjax: false\nsummary: 这是你自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要\ncategories: Markdown\ntags:\n  - Typora\n  - Markdown\n---</code></pre><p>上述大部分内容都来自主题说明文档，只是添加了一下我觉得需要注意的地方。这里还有一些没有说到到的属性，这配置文件里都有详细的介绍，确实不需要过多解释。</p>\n<p>最后再介绍一下我折腾比较久的插件，valine 评价插件。</p>\n<h2 id=\"Valine-评价插件\"><a href=\"#Valine-评价插件\" class=\"headerlink\" title=\"Valine 评价插件\"></a>Valine 评价插件</h2><p>插件主页：<em><a href=\"https://valine.js.org/\" target=\"_blank\" rel=\"noopener\">https://valine.js.org/</a></em> ，上面有详细的介绍，可以查看<a href=\"https://valine.js.org/quickstart.html\" target=\"_blank\" rel=\"noopener\">这里</a>，注册后，验证邮箱，绑定手机号，然后新建一个应用，获取到对应的 <code>AppId</code> 和 <code>AppKey</code>，然后写回到主题文件下到 <code>_config.yml</code> 文件里，但是要<strong>注意一点，不要直接使用国内版进行注册，而要用国际版，否则无法申请二级域名</strong>。</p>\n<pre><code class=\"yml\">valine:\n  enable: true\n  appId: XXX\n  appKey: XXX\n  notify: true\n  verify: false\n  visitor: true\n  avatar: &#39;retro&#39; # Gravatar style : mm/identicon/monsterid/wavatar/retro/hide\n  pageSize: 10\n  placeholder: &#39;Comment here&#39; # Comment Box placeholder\n  background: /medias/comment_bg.png</code></pre>\n<p>最新版的 <code>Valine</code> 已经移除了邮件通知功能。如果没有邮件通知，很可能别人评价之后，你却毫不知情，后续回复对方也收不到。因此，需要再配置一个插件来实现， ++<a href=\"https://github.com/zhaojun1998/Valine-Admin++\" target=\"_blank\" rel=\"noopener\">https://github.com/zhaojun1998/Valine-Admin++</a> 。在配置这个插件之前，需要确保 <code>Valine</code> 可以正常工作，可以自己给自己评论一下进行测试。</p>\n<p>配置好之后，别人在你的文章下评论后你便能收到邮件通知了。</p>\n<p>至此，<code>Matery</code> 主题就搭建配置完成了，接下来就只需要安心写博客了～</p>\n"},{"title":"【Hexo】使用Hexo+github pages+travis ci搭建好看的个人博客（一）","toc":true,"date":"2020-05-02T03:51:35.000Z","_content":"\n## 一、说明\n\n本系列文章将会详细说明使用 `Hexo` + `github pages` 来搭建个人博客，并对主题进行配置，然后使用 `travis ci` 来进行自动化部署的全过程。\n\n搭建一个赏心悦目的博客，写文章和阅读也会更加舒适，一次搭建，终生使用，而且还全程免费，何乐而不为呢。\n\n通过本系列文章的学习，你将收获一个免费且漂亮的个人博客，并熟悉搭建、写作、部署的全流程以及其中一些很好用的工具。\n\n## 二、成品展示\n\n[//]: # ([在线 Demo]&#40;https://mfrank2016.github.io/breeze-blog/&#41;)\n\n[//]: # ()\n[//]: # (![hexo-1.jpg]&#40;https://i.loli.net/2020/05/02/j6fIGtNmqB9Vlgi.jpg&#41;)\n\n[//]: # (![hexo-2.jpg]&#40;https://i.loli.net/2020/05/02/Eko6AGPpxIfrUMX.jpg&#41;)\n\n[//]: # (![hexo-3.jpg]&#40;https://i.loli.net/2020/05/02/g8FYkmlAK7dX2qc.jpg&#41;)\n\n[//]: # (![hexo-4.jpg]&#40;https://i.loli.net/2020/05/02/pcWruwXdm3aO7VZ.jpg&#41;)\n\n[//]: # (![hexo-5.jpg]&#40;https://i.loli.net/2020/05/02/OCNwnEh3SdvBUe4.jpg&#41;)\n\n这只是其中的一个主题，如果不喜欢，也可以很方便的切换其它主题。\n\n`hexo` 主题相当丰富，可以在[这里](https://hexo.io/themes/)选择喜欢的主题进行切换即可。\n\n## 三、前期准备\n\n在开始搭建之前，需要准备以下几样东西：\n\n* 本地安装 `node.js`\n* 本地安装 `git`\n* 一个 `github` 账号\n* 创建一个 `github` 仓库\n* 一个 `travis ci` 账号\n\n已经有过安装经验的同学，可以根据自己情况选择性的跳过部分章节。\n\n### 本地安装 node.js\n\n`windows` 系统可以在[这里](https://nodejs.org/zh-cn/download/)下载 `installer` 安装包进行安装。\n\n`mac` 系统可以在[这里](https://nodejs.org/zh-cn/download/)下载 `pkg` 安装包，也可以使用 `homebrew` 进行安装：\n\n```bash\nbrew install node\n```\n\n然后在命令行输入以下命令来验证是否正确安装:\n\n```bash\nnode -v\n```\n\n### 本地安装 git\n\n`windows` 系统可以从[这里](https://gitforwindows.org/)下载安装包后进行安装。\n\n`mac` 系统可以从[这里](https://sourceforge.net/projects/git-osx-installer/)下载安装包进行安装。\n\n也可以使用 `homebrew` 进行安装：\n\n```bash\nbrew install git\n```\n\n输入以下命令来查看是否正确安装好了 `git` ：\n\n```bash\ngit --version\n```\n\n然后设置自己的用户名和邮箱：\n\n```bash\ngit config --global user.name \"你的用户名\"\ngit config --global user.email \"你的公司或个人邮箱\"\n```\n\n### github 账号\n\n首先，需要注册一个 `github` 账号，[点击这里](https://github.com/join?source=header-home)。\n\n填写好用户名和密码，验证完成后，便可以将一个 `github` 账号收入囊中。\n\n创建好账号之后，我们还需要把我们本地的 `SSH Key` 添加到 `github` 中去，这样我们之后才能有权限将本地代码推送到 `github` 中。\n\n先本地生成一对 `RSA` 密钥：\n\n```bash\nssh-keygen -t rsa -b 4096 -C \"你的邮箱\"\n```\n\n然后用食指敲击你的回车键三次，记住，要用食指，但别问为什么。\n\n找到你刚才创建的密钥，`windows` 用户可以在 `C://用户//admin//.ssh` 目录下查找，mac 用户可以在 `~/.ssh` 目录下找到。复制 `id_rsa.pub` 文件里的信息，然后到[这里](https://github.com/settings/keys)添加新的 `SSHKEY` 。\n\n![hexo-10.jpg](https://i.loli.net/2020/05/02/k3uVFawNbvL84eB.jpg)\n\n![hexo-11.jpg](https://i.loli.net/2020/05/02/ijrXcU1ZT96QqsP.jpg)\n\n把我们刚才的 `key` 复制进行后保存即可。\n\n### 创建仓库\n\n点击[这里](https://github.com/new)，创建一个新的仓库。\n\n![hexo-5.jpg](https://i.loli.net/2020/05/02/zoDx4HQrACMSYbI.png)\n\n仓库名称可以随便取，比如：`blog`、`my-blog`，随便取一个就好。仓库说明也可以随便写，可以大概描述一下你这个仓库是做什么的。可以参考一下[我的仓库](https://github.com/MFrank2016/breeze-blog)\n\n然后把仓库地址记下来，是下图中箭头标示的 `git` 开头的地址，后面需要用到。\n\n![hexo-12.jpg](https://i.loli.net/2020/05/02/e36Vp8isyRfYvaw.jpg)\n\n创建好仓库之后，就可以进行下一步了。\n\n### travis ci 账号\n\n`travis ci` 账号是跟 `github` 账号关联的，所以需要先创建好 `github` 账号，创建好之后，点击[这里](https://travis-ci.org/signin)进行账号关联登陆。\n\n在设置里进行一次[账户同步](https://travis-ci.org/account/repositories)：\n\n![hexo-7.jpg](https://i.loli.net/2020/05/02/Th5tdWvNYlXbz3D.jpg)\n\n同步完后刷新一下页面，刚才创建的仓库应该就会出现在这里：\n\n![hexo-8.jpg](https://i.loli.net/2020/05/02/vznkDHh9frOMlIX.jpg)\n\n## 四、安装 Hexo\n\n`hexo` 是一款静态网站生成工具，可以根据设置的主题样式和配置文件，来生成丰富多彩的网页，通常配置文件设置好之后不需要经常修改，我们只需要负责写好我们的博文，写好之后就能使用命令一键生成网站，而且还可以为所欲为的切换主题，可以说是写博客的一大利器。\n\n`hexo` 的安装其实很简单，只需要输入以下咒语：\n\n```bash\nnpm install -g hexo-cli\n```\n\n然后轻轻的敲击你的回车键，`hexo` 便能成功的安装在你的电脑中。\n\n可以使用以下命令进行验证：\n\n```bash\nhexo -v\n```\n\n## 五、使用 hexo 搭建博客\n\n选择一个准备放置博客网站的目录，然后使用以下命令来初始化一个项目：\n\n```bash\nhexo init breeze-blog\ncd breeze-blog\nnpm install\n```\n\n该命令将会在当前目录下，生成一个名为 `breeze-blog` 的新目录，当然，你可以把这个名字换成任何你想要的名字，并将 `hexo` 的初始化文件写入其中。\n\n新建完成后，`breeze-blog` 文件夹的目录如下：\n\n```bash\n.\n├── _config.yml\n├── package.json\n├── node_modules\n├── scaffolds\n├── source\n|   ├── _drafts\n|   └── _posts\n└── themes\n```\n\n`_config.yml` 是配置文件，里面有很多可以配置的数据，这里暂时不多介绍，后面的文章里会进行详细说明。\n\n`package.json` 是应用程序信息，通常不需要关心。\n\n`node_modules` 用来存放 `node` 相关的模块，通常不需要关心。\n\n`scaffolds` 里面是模版文件，也就是每次新建文章时，都会根据模版文件来创建对应的 `md` 文件，这一点也会在后续的文章里进行详细介绍。\n\n`source` 是资源文件夹，用来存放用户资源的地方。除 `_posts` 文件夹之外，开头命名为 _ (下划线)的文件 / 文件夹和隐藏的文件将会被忽略。\n\n`theme` 是主题文件夹，每个主题的配置都会有些不一样，需要根据具体主题情况来定，后续介绍主题的文章里会有说明。\n\n在 `breeze-blog` 目录下使用以下命令来运行我们的博客：\n\n```bash\nhexo server\n```\n\n在默认情况下，服务会使用 `4000` 端口，如果已经被占用，也可以添加 `-p` 参数来换用其它端口：\n\n```bash\nhexo server -p 8080\n```\n\n打开 `http://localhost:4000` 即可访问我们生成的网站了。\n\n![hexo-9.jpg](https://i.loli.net/2020/05/02/ntX31VrhMTjFozQ.jpg)\n\n这样，我们的博客就搭建起来了。\n\n## 六、部署到 github pages\n\n`github pages` 可以理解为 ~~gayhub~~ `github` 提供的免费网页空间，可以用来存放你的静态网页文件，并通过 `https://用户名.github.io/项目名/` 的方式来访问，比如我新创建的 `blog` 地址就是：`https://mfrank2016.github.io/breeze-blog/`。\n\n利用 `github pages` 就能创建我们的免费博客站点了，至于为什么要使用免费站点，而不选择购买服务器来搭建，是因为根据之前使用服务器经常忘记续费，导致博客数据丢失，损失惨重。`github` 已经稳定运行了很多年，是全球最大的 ~~同性交友网站~~ 开发者网站，他们的服务值得信赖。而且是免费的。\n\n我们之前已经注册好 `github` 的账号并创建好了对应的仓库，本地也安装好了 `git` ，现在让我们来把他们利用起来。（如果还没有完成的同学可以往上面翻翻，先完成前面的步骤）\n\n> 注意：有两种类型的 `github pages`，一种是使用 `用户名.github.io` 作为项目名，一种是使用其它名称。虽然看起来只是名字不一样，但两种方式其实是有差异的，前一种方式里，网页静态文件只能存放在 master 分支，所以如果想要把博客源文件也存到同一个仓库，必须使用其它分支来存放，相应的 travis ci 监听和推送的分支也需要修改，当然也可以使用另一个新的仓库来存放。后一种方式则没这个限制，通常使用名为 `gh-pages` 作为分支名，`Hexo` 内默认设置的分支也是叫这个名字。这里我们使用的是后一种方案，即源文件和生成的网页静态文件存放在同一个仓库，源文件在 `master` 分支，静态文件在 `gh-pages` 分支。\n\n首先，我们将本地的文件推送到 `github` 上。\n\n在 `breeze-blog` 目录下，初始化 `git` 仓库，将现有文件添加到 `git` 仓库中，并创建 `gh-pages` 分支：\n\n```bash\ncd breeze-blog\ngit init\ngit add .\ngit commit -am\"init blog\"\ngit remote add origin 仓库地址\n```\n\n仓库地址是前面我们创建仓库时说过的地址，比如我的地址是： `git@github.com:MFrank2016/breeze-blog.git` ，把它复制到这里来替换即可。\n\n然后我们使用最后一句咒语，把代码推送到仓库中去。\n\n```bash\ngit push -u origin master\n```\n\n如果你的仓库原来已经有数据了，可以添加 -f 参数来强制推送，但这样会使得你原来的数据丢失，所以慎用。\n\n```bash\ngit push -f -u origin master\n```\n\n然后创建一个新的本地分支 `gh-pages`，并关联远程分支：\n\n```bash\ngit checkout -b gh-pages\ngit push -u origin gh-pages\n```\n\n⚠️不要改用其它分支名。\n\n然后在项目 `settings` 页面里开启 `github pages`：\n\n![hexo-13.jpg](https://i.loli.net/2020/05/02/bQWKGwMsAVYk5hp.jpg)\n\n![hexo-14.jpg](https://i.loli.net/2020/05/02/HqpxGos7J9mLRkC.jpg)\n\n这里要选择 `gh-pages` 分支，不要选 `master` 分支。\n\n然后我们修改一下 `hexo` 的配置文件(`_config.yml`)，找到对应的地方进行修改，指定我们的仓库信息，并修改 `root` 和 `url` 信息。\n\n```bash\nurl: https://mfrank2016.github.io/\nroot: /breeze-blog/\n\ndeploy:\n  type: 'git'\n  repo: git@github.com:MFrank2016/breeze-blog\n  branch: gh-pages\n```\n\n把这里的 `repo` 地址修改为你的仓库地址即可。\n\n安装 `hexo-deployer-git`：\n\n```bash\ncd breeze-blog\nnpm install hexo-deployer-git --save\n```\n\n万事具备，发车！\n\n```bash\nhexo clean && hexo generate\nhexo deploy\n```\n\n运行完成后，我们的博客文件就顺利部署到 `github pages` 上了，现在我们打开下面网址来查看我们的博客效果：\n\n```bash\nhttps://用户名.github.io/项目名/\n```\n\n之后每次我们添加或修改完本地文件后，使用：\n\n```bash\nhexo clean && hexo g -d\n```\n\n即可重新生成项目文件，并推送到 `github` 项目的 `gh-pages` 分支，为了备份数据，也方便我们在不同设备上进行编辑，最好将我们修改的文件推送到 `master` 分支进行保存：\n\n```bash\ngit checkout master\ngit add .\ngit commit -am \"这里可以写一下修改的备注信息\"\ngit push\n```\n\n## 七、使用 travis ci 进行自动化部署\n\n如果我们每次都按前面的方式进行操作，也会略显麻烦，使用 `travis ci` 后，可以将前面部署的步骤自动化，我们只需要将本地修改的文件推送到 `github` 仓库，就会触发 `travis ci` 的自动部署。\n\n`travis ci` 的配置也很简单，而且只需要配置一次，之后就不需要修改了。\n\n首先，我们需要把*_config.yml*文件里的*repo*信息注释一下，不需要在配置文件里指定仓库地址，`travis ci` 会直接在其监听项目上进行部署。\n\n```yml\ndeploy:\n  type: 'git'\n#  repo: git@github.com:MFrank2016/breeze-blog\n  branch: gh-pages\n```\n\n在本地博客目录下创建一个名为 `.travis.yml` 的文件，与 `_config.yml` 要在同级目录。\n\n然后在文件中写入以下内容：\n\n```yml\nsudo: false\nlanguage: node_js\nnode_js:\n  - 12\ncache: npm\nbranches:\n  only:\n    - master # build master branch only\nscript:\n  - hexo generate\ndeploy:\n  provider: pages\n  skip-cleanup: true\n  github-token: $GH_TOKEN\n  keep-history: true\n  on:\n    branch: master\n  local-dir: public\n```\n\n这里没有任何东西需要修改，直接复制粘贴即可。\n\n接下来，需要在 `travis` 里配置一个环境变量，`GH_TOKEN` 。\n\n前面我们已经将 `travis` 关联了 `github` 账号，并同步了项目，如果操作正确，[这里](https://travis-ci.org/dashboard)应该会出现我们的仓库信息。\n\n![hexo-15.jpg](https://i.loli.net/2020/05/02/Xc2OGJvDNFbhYPs.jpg)\n\n![hexo-16.jpg](https://i.loli.net/2020/05/02/E7QyHTNMdjJWP26.jpg)\n\n![hexo-17.jpg](https://i.loli.net/2020/05/02/qjJkhAgErKL5tUR.jpg)\n\n这里的 `access token` 是指 `github token`，可以在[这里](https://github.com/settings/tokens)获取：\n\n![hexo-18.jpg](https://i.loli.net/2020/05/02/K35fhMCGLJ7xiUw.jpg)\n\n![hexo-19.jpg](https://i.loli.net/2020/05/02/7wNrX19YqGZKLOs.jpg)\n\n选好后，点击 `generate` 即可生成一个新的 `access token`，这个 `token` 即是用于权限验证的，好好保存，不要泄露，千万不要直接写到 `config` 文件里，而且之后是无法进行查看的，所以需要记录在一个安全的地方。\n\n创建好之后，把这个 `token` 填写到前面的 `travis ci` 的项目环境变量中保存，这样一切就准备好了。\n\n现在让我们在本地创建一篇新的博客，然后推送到远程仓库：\n\n```bash\ncd breeze-blog\ngit checkout master\nhexo new \"my first blog\"\ngit add .\ngit commit -am\"add a new blog\"\ngit push\n```\n\n然后我们可以在 `travis ci` 中看到构建过程被触发了，等待一会即可完成部署，然后再打开我们的博客，查看一下我们新生成的文章是否已经在上面了。（浏览器有缓存，所以可能需要刷新几次才有效果）\n\n## 小结\n\n整个过程看起来有些麻烦，距上次部署博客已经有很长时间了，我也是摸索了几次后才大致掌握，因为不想每次都重新来一遍，所以还是记录一下为好，利人利己。\n\n写博客是一种生活态度，记录并整理生活和编程中的心得和经验并分享，在漫漫人生路上留下自己一路走来的印记，这样以后再回过头来看时，就不会感慨时间都去哪了。如果能因此遇到有共同兴趣爱好的人，那也将会是人生里的不错点缀。\n\n这里只是完成了博客搭建和自动化部署的过程，关于博客的配置和主题的配置以及博客写作的一些技巧会在后面的文章中进行说明，敬请关注～\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","source":"_posts/hexo/hexo-start.md","raw":"---\ntitle: 【Hexo】使用Hexo+github pages+travis ci搭建好看的个人博客（一）\ntags:\n  - 环境搭建\n  - Hexo\n  - github pages\n  - travis ci\ncategories:\n  - 编程\n  - 生活\ntoc: true\ndate: 2020-05-02 11:51:35\n---\n\n## 一、说明\n\n本系列文章将会详细说明使用 `Hexo` + `github pages` 来搭建个人博客，并对主题进行配置，然后使用 `travis ci` 来进行自动化部署的全过程。\n\n搭建一个赏心悦目的博客，写文章和阅读也会更加舒适，一次搭建，终生使用，而且还全程免费，何乐而不为呢。\n\n通过本系列文章的学习，你将收获一个免费且漂亮的个人博客，并熟悉搭建、写作、部署的全流程以及其中一些很好用的工具。\n\n## 二、成品展示\n\n[//]: # ([在线 Demo]&#40;https://mfrank2016.github.io/breeze-blog/&#41;)\n\n[//]: # ()\n[//]: # (![hexo-1.jpg]&#40;https://i.loli.net/2020/05/02/j6fIGtNmqB9Vlgi.jpg&#41;)\n\n[//]: # (![hexo-2.jpg]&#40;https://i.loli.net/2020/05/02/Eko6AGPpxIfrUMX.jpg&#41;)\n\n[//]: # (![hexo-3.jpg]&#40;https://i.loli.net/2020/05/02/g8FYkmlAK7dX2qc.jpg&#41;)\n\n[//]: # (![hexo-4.jpg]&#40;https://i.loli.net/2020/05/02/pcWruwXdm3aO7VZ.jpg&#41;)\n\n[//]: # (![hexo-5.jpg]&#40;https://i.loli.net/2020/05/02/OCNwnEh3SdvBUe4.jpg&#41;)\n\n这只是其中的一个主题，如果不喜欢，也可以很方便的切换其它主题。\n\n`hexo` 主题相当丰富，可以在[这里](https://hexo.io/themes/)选择喜欢的主题进行切换即可。\n\n## 三、前期准备\n\n在开始搭建之前，需要准备以下几样东西：\n\n* 本地安装 `node.js`\n* 本地安装 `git`\n* 一个 `github` 账号\n* 创建一个 `github` 仓库\n* 一个 `travis ci` 账号\n\n已经有过安装经验的同学，可以根据自己情况选择性的跳过部分章节。\n\n### 本地安装 node.js\n\n`windows` 系统可以在[这里](https://nodejs.org/zh-cn/download/)下载 `installer` 安装包进行安装。\n\n`mac` 系统可以在[这里](https://nodejs.org/zh-cn/download/)下载 `pkg` 安装包，也可以使用 `homebrew` 进行安装：\n\n```bash\nbrew install node\n```\n\n然后在命令行输入以下命令来验证是否正确安装:\n\n```bash\nnode -v\n```\n\n### 本地安装 git\n\n`windows` 系统可以从[这里](https://gitforwindows.org/)下载安装包后进行安装。\n\n`mac` 系统可以从[这里](https://sourceforge.net/projects/git-osx-installer/)下载安装包进行安装。\n\n也可以使用 `homebrew` 进行安装：\n\n```bash\nbrew install git\n```\n\n输入以下命令来查看是否正确安装好了 `git` ：\n\n```bash\ngit --version\n```\n\n然后设置自己的用户名和邮箱：\n\n```bash\ngit config --global user.name \"你的用户名\"\ngit config --global user.email \"你的公司或个人邮箱\"\n```\n\n### github 账号\n\n首先，需要注册一个 `github` 账号，[点击这里](https://github.com/join?source=header-home)。\n\n填写好用户名和密码，验证完成后，便可以将一个 `github` 账号收入囊中。\n\n创建好账号之后，我们还需要把我们本地的 `SSH Key` 添加到 `github` 中去，这样我们之后才能有权限将本地代码推送到 `github` 中。\n\n先本地生成一对 `RSA` 密钥：\n\n```bash\nssh-keygen -t rsa -b 4096 -C \"你的邮箱\"\n```\n\n然后用食指敲击你的回车键三次，记住，要用食指，但别问为什么。\n\n找到你刚才创建的密钥，`windows` 用户可以在 `C://用户//admin//.ssh` 目录下查找，mac 用户可以在 `~/.ssh` 目录下找到。复制 `id_rsa.pub` 文件里的信息，然后到[这里](https://github.com/settings/keys)添加新的 `SSHKEY` 。\n\n![hexo-10.jpg](https://i.loli.net/2020/05/02/k3uVFawNbvL84eB.jpg)\n\n![hexo-11.jpg](https://i.loli.net/2020/05/02/ijrXcU1ZT96QqsP.jpg)\n\n把我们刚才的 `key` 复制进行后保存即可。\n\n### 创建仓库\n\n点击[这里](https://github.com/new)，创建一个新的仓库。\n\n![hexo-5.jpg](https://i.loli.net/2020/05/02/zoDx4HQrACMSYbI.png)\n\n仓库名称可以随便取，比如：`blog`、`my-blog`，随便取一个就好。仓库说明也可以随便写，可以大概描述一下你这个仓库是做什么的。可以参考一下[我的仓库](https://github.com/MFrank2016/breeze-blog)\n\n然后把仓库地址记下来，是下图中箭头标示的 `git` 开头的地址，后面需要用到。\n\n![hexo-12.jpg](https://i.loli.net/2020/05/02/e36Vp8isyRfYvaw.jpg)\n\n创建好仓库之后，就可以进行下一步了。\n\n### travis ci 账号\n\n`travis ci` 账号是跟 `github` 账号关联的，所以需要先创建好 `github` 账号，创建好之后，点击[这里](https://travis-ci.org/signin)进行账号关联登陆。\n\n在设置里进行一次[账户同步](https://travis-ci.org/account/repositories)：\n\n![hexo-7.jpg](https://i.loli.net/2020/05/02/Th5tdWvNYlXbz3D.jpg)\n\n同步完后刷新一下页面，刚才创建的仓库应该就会出现在这里：\n\n![hexo-8.jpg](https://i.loli.net/2020/05/02/vznkDHh9frOMlIX.jpg)\n\n## 四、安装 Hexo\n\n`hexo` 是一款静态网站生成工具，可以根据设置的主题样式和配置文件，来生成丰富多彩的网页，通常配置文件设置好之后不需要经常修改，我们只需要负责写好我们的博文，写好之后就能使用命令一键生成网站，而且还可以为所欲为的切换主题，可以说是写博客的一大利器。\n\n`hexo` 的安装其实很简单，只需要输入以下咒语：\n\n```bash\nnpm install -g hexo-cli\n```\n\n然后轻轻的敲击你的回车键，`hexo` 便能成功的安装在你的电脑中。\n\n可以使用以下命令进行验证：\n\n```bash\nhexo -v\n```\n\n## 五、使用 hexo 搭建博客\n\n选择一个准备放置博客网站的目录，然后使用以下命令来初始化一个项目：\n\n```bash\nhexo init breeze-blog\ncd breeze-blog\nnpm install\n```\n\n该命令将会在当前目录下，生成一个名为 `breeze-blog` 的新目录，当然，你可以把这个名字换成任何你想要的名字，并将 `hexo` 的初始化文件写入其中。\n\n新建完成后，`breeze-blog` 文件夹的目录如下：\n\n```bash\n.\n├── _config.yml\n├── package.json\n├── node_modules\n├── scaffolds\n├── source\n|   ├── _drafts\n|   └── _posts\n└── themes\n```\n\n`_config.yml` 是配置文件，里面有很多可以配置的数据，这里暂时不多介绍，后面的文章里会进行详细说明。\n\n`package.json` 是应用程序信息，通常不需要关心。\n\n`node_modules` 用来存放 `node` 相关的模块，通常不需要关心。\n\n`scaffolds` 里面是模版文件，也就是每次新建文章时，都会根据模版文件来创建对应的 `md` 文件，这一点也会在后续的文章里进行详细介绍。\n\n`source` 是资源文件夹，用来存放用户资源的地方。除 `_posts` 文件夹之外，开头命名为 _ (下划线)的文件 / 文件夹和隐藏的文件将会被忽略。\n\n`theme` 是主题文件夹，每个主题的配置都会有些不一样，需要根据具体主题情况来定，后续介绍主题的文章里会有说明。\n\n在 `breeze-blog` 目录下使用以下命令来运行我们的博客：\n\n```bash\nhexo server\n```\n\n在默认情况下，服务会使用 `4000` 端口，如果已经被占用，也可以添加 `-p` 参数来换用其它端口：\n\n```bash\nhexo server -p 8080\n```\n\n打开 `http://localhost:4000` 即可访问我们生成的网站了。\n\n![hexo-9.jpg](https://i.loli.net/2020/05/02/ntX31VrhMTjFozQ.jpg)\n\n这样，我们的博客就搭建起来了。\n\n## 六、部署到 github pages\n\n`github pages` 可以理解为 ~~gayhub~~ `github` 提供的免费网页空间，可以用来存放你的静态网页文件，并通过 `https://用户名.github.io/项目名/` 的方式来访问，比如我新创建的 `blog` 地址就是：`https://mfrank2016.github.io/breeze-blog/`。\n\n利用 `github pages` 就能创建我们的免费博客站点了，至于为什么要使用免费站点，而不选择购买服务器来搭建，是因为根据之前使用服务器经常忘记续费，导致博客数据丢失，损失惨重。`github` 已经稳定运行了很多年，是全球最大的 ~~同性交友网站~~ 开发者网站，他们的服务值得信赖。而且是免费的。\n\n我们之前已经注册好 `github` 的账号并创建好了对应的仓库，本地也安装好了 `git` ，现在让我们来把他们利用起来。（如果还没有完成的同学可以往上面翻翻，先完成前面的步骤）\n\n> 注意：有两种类型的 `github pages`，一种是使用 `用户名.github.io` 作为项目名，一种是使用其它名称。虽然看起来只是名字不一样，但两种方式其实是有差异的，前一种方式里，网页静态文件只能存放在 master 分支，所以如果想要把博客源文件也存到同一个仓库，必须使用其它分支来存放，相应的 travis ci 监听和推送的分支也需要修改，当然也可以使用另一个新的仓库来存放。后一种方式则没这个限制，通常使用名为 `gh-pages` 作为分支名，`Hexo` 内默认设置的分支也是叫这个名字。这里我们使用的是后一种方案，即源文件和生成的网页静态文件存放在同一个仓库，源文件在 `master` 分支，静态文件在 `gh-pages` 分支。\n\n首先，我们将本地的文件推送到 `github` 上。\n\n在 `breeze-blog` 目录下，初始化 `git` 仓库，将现有文件添加到 `git` 仓库中，并创建 `gh-pages` 分支：\n\n```bash\ncd breeze-blog\ngit init\ngit add .\ngit commit -am\"init blog\"\ngit remote add origin 仓库地址\n```\n\n仓库地址是前面我们创建仓库时说过的地址，比如我的地址是： `git@github.com:MFrank2016/breeze-blog.git` ，把它复制到这里来替换即可。\n\n然后我们使用最后一句咒语，把代码推送到仓库中去。\n\n```bash\ngit push -u origin master\n```\n\n如果你的仓库原来已经有数据了，可以添加 -f 参数来强制推送，但这样会使得你原来的数据丢失，所以慎用。\n\n```bash\ngit push -f -u origin master\n```\n\n然后创建一个新的本地分支 `gh-pages`，并关联远程分支：\n\n```bash\ngit checkout -b gh-pages\ngit push -u origin gh-pages\n```\n\n⚠️不要改用其它分支名。\n\n然后在项目 `settings` 页面里开启 `github pages`：\n\n![hexo-13.jpg](https://i.loli.net/2020/05/02/bQWKGwMsAVYk5hp.jpg)\n\n![hexo-14.jpg](https://i.loli.net/2020/05/02/HqpxGos7J9mLRkC.jpg)\n\n这里要选择 `gh-pages` 分支，不要选 `master` 分支。\n\n然后我们修改一下 `hexo` 的配置文件(`_config.yml`)，找到对应的地方进行修改，指定我们的仓库信息，并修改 `root` 和 `url` 信息。\n\n```bash\nurl: https://mfrank2016.github.io/\nroot: /breeze-blog/\n\ndeploy:\n  type: 'git'\n  repo: git@github.com:MFrank2016/breeze-blog\n  branch: gh-pages\n```\n\n把这里的 `repo` 地址修改为你的仓库地址即可。\n\n安装 `hexo-deployer-git`：\n\n```bash\ncd breeze-blog\nnpm install hexo-deployer-git --save\n```\n\n万事具备，发车！\n\n```bash\nhexo clean && hexo generate\nhexo deploy\n```\n\n运行完成后，我们的博客文件就顺利部署到 `github pages` 上了，现在我们打开下面网址来查看我们的博客效果：\n\n```bash\nhttps://用户名.github.io/项目名/\n```\n\n之后每次我们添加或修改完本地文件后，使用：\n\n```bash\nhexo clean && hexo g -d\n```\n\n即可重新生成项目文件，并推送到 `github` 项目的 `gh-pages` 分支，为了备份数据，也方便我们在不同设备上进行编辑，最好将我们修改的文件推送到 `master` 分支进行保存：\n\n```bash\ngit checkout master\ngit add .\ngit commit -am \"这里可以写一下修改的备注信息\"\ngit push\n```\n\n## 七、使用 travis ci 进行自动化部署\n\n如果我们每次都按前面的方式进行操作，也会略显麻烦，使用 `travis ci` 后，可以将前面部署的步骤自动化，我们只需要将本地修改的文件推送到 `github` 仓库，就会触发 `travis ci` 的自动部署。\n\n`travis ci` 的配置也很简单，而且只需要配置一次，之后就不需要修改了。\n\n首先，我们需要把*_config.yml*文件里的*repo*信息注释一下，不需要在配置文件里指定仓库地址，`travis ci` 会直接在其监听项目上进行部署。\n\n```yml\ndeploy:\n  type: 'git'\n#  repo: git@github.com:MFrank2016/breeze-blog\n  branch: gh-pages\n```\n\n在本地博客目录下创建一个名为 `.travis.yml` 的文件，与 `_config.yml` 要在同级目录。\n\n然后在文件中写入以下内容：\n\n```yml\nsudo: false\nlanguage: node_js\nnode_js:\n  - 12\ncache: npm\nbranches:\n  only:\n    - master # build master branch only\nscript:\n  - hexo generate\ndeploy:\n  provider: pages\n  skip-cleanup: true\n  github-token: $GH_TOKEN\n  keep-history: true\n  on:\n    branch: master\n  local-dir: public\n```\n\n这里没有任何东西需要修改，直接复制粘贴即可。\n\n接下来，需要在 `travis` 里配置一个环境变量，`GH_TOKEN` 。\n\n前面我们已经将 `travis` 关联了 `github` 账号，并同步了项目，如果操作正确，[这里](https://travis-ci.org/dashboard)应该会出现我们的仓库信息。\n\n![hexo-15.jpg](https://i.loli.net/2020/05/02/Xc2OGJvDNFbhYPs.jpg)\n\n![hexo-16.jpg](https://i.loli.net/2020/05/02/E7QyHTNMdjJWP26.jpg)\n\n![hexo-17.jpg](https://i.loli.net/2020/05/02/qjJkhAgErKL5tUR.jpg)\n\n这里的 `access token` 是指 `github token`，可以在[这里](https://github.com/settings/tokens)获取：\n\n![hexo-18.jpg](https://i.loli.net/2020/05/02/K35fhMCGLJ7xiUw.jpg)\n\n![hexo-19.jpg](https://i.loli.net/2020/05/02/7wNrX19YqGZKLOs.jpg)\n\n选好后，点击 `generate` 即可生成一个新的 `access token`，这个 `token` 即是用于权限验证的，好好保存，不要泄露，千万不要直接写到 `config` 文件里，而且之后是无法进行查看的，所以需要记录在一个安全的地方。\n\n创建好之后，把这个 `token` 填写到前面的 `travis ci` 的项目环境变量中保存，这样一切就准备好了。\n\n现在让我们在本地创建一篇新的博客，然后推送到远程仓库：\n\n```bash\ncd breeze-blog\ngit checkout master\nhexo new \"my first blog\"\ngit add .\ngit commit -am\"add a new blog\"\ngit push\n```\n\n然后我们可以在 `travis ci` 中看到构建过程被触发了，等待一会即可完成部署，然后再打开我们的博客，查看一下我们新生成的文章是否已经在上面了。（浏览器有缓存，所以可能需要刷新几次才有效果）\n\n## 小结\n\n整个过程看起来有些麻烦，距上次部署博客已经有很长时间了，我也是摸索了几次后才大致掌握，因为不想每次都重新来一遍，所以还是记录一下为好，利人利己。\n\n写博客是一种生活态度，记录并整理生活和编程中的心得和经验并分享，在漫漫人生路上留下自己一路走来的印记，这样以后再回过头来看时，就不会感慨时间都去哪了。如果能因此遇到有共同兴趣爱好的人，那也将会是人生里的不错点缀。\n\n这里只是完成了博客搭建和自动化部署的过程，关于博客的配置和主题的配置以及博客写作的一些技巧会在后面的文章中进行说明，敬请关注～\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","slug":"hexo/hexo-start","published":1,"updated":"2020-05-02T03:51:35.000Z","_id":"cl70rsfbc000k5ohu16oq97x0","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"一、说明\"><a href=\"#一、说明\" class=\"headerlink\" title=\"一、说明\"></a>一、说明</h2><p>本系列文章将会详细说明使用 <code>Hexo</code> + <code>github pages</code> 来搭建个人博客，并对主题进行配置，然后使用 <code>travis ci</code> 来进行自动化部署的全过程。</p>\n<p>搭建一个赏心悦目的博客，写文章和阅读也会更加舒适，一次搭建，终生使用，而且还全程免费，何乐而不为呢。</p>\n<p>通过本系列文章的学习，你将收获一个免费且漂亮的个人博客，并熟悉搭建、写作、部署的全流程以及其中一些很好用的工具。</p>\n<h2 id=\"二、成品展示\"><a href=\"#二、成品展示\" class=\"headerlink\" title=\"二、成品展示\"></a>二、成品展示</h2><p>这只是其中的一个主题，如果不喜欢，也可以很方便的切换其它主题。</p>\n<p><code>hexo</code> 主题相当丰富，可以在<a href=\"https://hexo.io/themes/\" target=\"_blank\" rel=\"noopener\">这里</a>选择喜欢的主题进行切换即可。</p>\n<h2 id=\"三、前期准备\"><a href=\"#三、前期准备\" class=\"headerlink\" title=\"三、前期准备\"></a>三、前期准备</h2><p>在开始搭建之前，需要准备以下几样东西：</p>\n<ul>\n<li>本地安装 <code>node.js</code></li>\n<li>本地安装 <code>git</code></li>\n<li>一个 <code>github</code> 账号</li>\n<li>创建一个 <code>github</code> 仓库</li>\n<li>一个 <code>travis ci</code> 账号</li>\n</ul>\n<p>已经有过安装经验的同学，可以根据自己情况选择性的跳过部分章节。</p>\n<h3 id=\"本地安装-node-js\"><a href=\"#本地安装-node-js\" class=\"headerlink\" title=\"本地安装 node.js\"></a>本地安装 node.js</h3><p><code>windows</code> 系统可以在<a href=\"https://nodejs.org/zh-cn/download/\" target=\"_blank\" rel=\"noopener\">这里</a>下载 <code>installer</code> 安装包进行安装。</p>\n<p><code>mac</code> 系统可以在<a href=\"https://nodejs.org/zh-cn/download/\" target=\"_blank\" rel=\"noopener\">这里</a>下载 <code>pkg</code> 安装包，也可以使用 <code>homebrew</code> 进行安装：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">brew <span class=\"token function\">install</span> node</code></pre>\n<p>然后在命令行输入以下命令来验证是否正确安装:</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">node -v</code></pre>\n<h3 id=\"本地安装-git\"><a href=\"#本地安装-git\" class=\"headerlink\" title=\"本地安装 git\"></a>本地安装 git</h3><p><code>windows</code> 系统可以从<a href=\"https://gitforwindows.org/\" target=\"_blank\" rel=\"noopener\">这里</a>下载安装包后进行安装。</p>\n<p><code>mac</code> 系统可以从<a href=\"https://sourceforge.net/projects/git-osx-installer/\" target=\"_blank\" rel=\"noopener\">这里</a>下载安装包进行安装。</p>\n<p>也可以使用 <code>homebrew</code> 进行安装：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">brew <span class=\"token function\">install</span> <span class=\"token function\">git</span></code></pre>\n<p>输入以下命令来查看是否正确安装好了 <code>git</code> ：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> --version</code></pre>\n<p>然后设置自己的用户名和邮箱：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> config --global user.name <span class=\"token string\">\"你的用户名\"</span>\n<span class=\"token function\">git</span> config --global user.email <span class=\"token string\">\"你的公司或个人邮箱\"</span></code></pre>\n<h3 id=\"github-账号\"><a href=\"#github-账号\" class=\"headerlink\" title=\"github 账号\"></a>github 账号</h3><p>首先，需要注册一个 <code>github</code> 账号，<a href=\"https://github.com/join?source=header-home\" target=\"_blank\" rel=\"noopener\">点击这里</a>。</p>\n<p>填写好用户名和密码，验证完成后，便可以将一个 <code>github</code> 账号收入囊中。</p>\n<p>创建好账号之后，我们还需要把我们本地的 <code>SSH Key</code> 添加到 <code>github</code> 中去，这样我们之后才能有权限将本地代码推送到 <code>github</code> 中。</p>\n<p>先本地生成一对 <code>RSA</code> 密钥：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">ssh-keygen -t rsa -b 4096 -C <span class=\"token string\">\"你的邮箱\"</span></code></pre>\n<p>然后用食指敲击你的回车键三次，记住，要用食指，但别问为什么。</p>\n<p>找到你刚才创建的密钥，<code>windows</code> 用户可以在 <code>C://用户//admin//.ssh</code> 目录下查找，mac 用户可以在 <code>~/.ssh</code> 目录下找到。复制 <code>id_rsa.pub</code> 文件里的信息，然后到<a href=\"https://github.com/settings/keys\" target=\"_blank\" rel=\"noopener\">这里</a>添加新的 <code>SSHKEY</code> 。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/k3uVFawNbvL84eB.jpg\" alt=\"hexo-10.jpg\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/ijrXcU1ZT96QqsP.jpg\" alt=\"hexo-11.jpg\"></p>\n<p>把我们刚才的 <code>key</code> 复制进行后保存即可。</p>\n<h3 id=\"创建仓库\"><a href=\"#创建仓库\" class=\"headerlink\" title=\"创建仓库\"></a>创建仓库</h3><p>点击<a href=\"https://github.com/new\" target=\"_blank\" rel=\"noopener\">这里</a>，创建一个新的仓库。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/zoDx4HQrACMSYbI.png\" alt=\"hexo-5.jpg\"></p>\n<p>仓库名称可以随便取，比如：<code>blog</code>、<code>my-blog</code>，随便取一个就好。仓库说明也可以随便写，可以大概描述一下你这个仓库是做什么的。可以参考一下<a href=\"https://github.com/MFrank2016/breeze-blog\" target=\"_blank\" rel=\"noopener\">我的仓库</a></p>\n<p>然后把仓库地址记下来，是下图中箭头标示的 <code>git</code> 开头的地址，后面需要用到。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/e36Vp8isyRfYvaw.jpg\" alt=\"hexo-12.jpg\"></p>\n<p>创建好仓库之后，就可以进行下一步了。</p>\n<h3 id=\"travis-ci-账号\"><a href=\"#travis-ci-账号\" class=\"headerlink\" title=\"travis ci 账号\"></a>travis ci 账号</h3><p><code>travis ci</code> 账号是跟 <code>github</code> 账号关联的，所以需要先创建好 <code>github</code> 账号，创建好之后，点击<a href=\"https://travis-ci.org/signin\" target=\"_blank\" rel=\"noopener\">这里</a>进行账号关联登陆。</p>\n<p>在设置里进行一次<a href=\"https://travis-ci.org/account/repositories\" target=\"_blank\" rel=\"noopener\">账户同步</a>：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/Th5tdWvNYlXbz3D.jpg\" alt=\"hexo-7.jpg\"></p>\n<p>同步完后刷新一下页面，刚才创建的仓库应该就会出现在这里：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/vznkDHh9frOMlIX.jpg\" alt=\"hexo-8.jpg\"></p>\n<h2 id=\"四、安装-Hexo\"><a href=\"#四、安装-Hexo\" class=\"headerlink\" title=\"四、安装 Hexo\"></a>四、安装 Hexo</h2><p><code>hexo</code> 是一款静态网站生成工具，可以根据设置的主题样式和配置文件，来生成丰富多彩的网页，通常配置文件设置好之后不需要经常修改，我们只需要负责写好我们的博文，写好之后就能使用命令一键生成网站，而且还可以为所欲为的切换主题，可以说是写博客的一大利器。</p>\n<p><code>hexo</code> 的安装其实很简单，只需要输入以下咒语：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g hexo-cli</code></pre>\n<p>然后轻轻的敲击你的回车键，<code>hexo</code> 便能成功的安装在你的电脑中。</p>\n<p>可以使用以下命令进行验证：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">hexo -v</code></pre>\n<h2 id=\"五、使用-hexo-搭建博客\"><a href=\"#五、使用-hexo-搭建博客\" class=\"headerlink\" title=\"五、使用 hexo 搭建博客\"></a>五、使用 hexo 搭建博客</h2><p>选择一个准备放置博客网站的目录，然后使用以下命令来初始化一个项目：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">hexo init breeze-blog\n<span class=\"token function\">cd</span> breeze-blog\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span></code></pre>\n<p>该命令将会在当前目录下，生成一个名为 <code>breeze-blog</code> 的新目录，当然，你可以把这个名字换成任何你想要的名字，并将 <code>hexo</code> 的初始化文件写入其中。</p>\n<p>新建完成后，<code>breeze-blog</code> 文件夹的目录如下：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token keyword\">.</span>\n├── _config.yml\n├── package.json\n├── node_modules\n├── scaffolds\n├── <span class=\"token function\">source</span>\n<span class=\"token operator\">|</span>   ├── _drafts\n<span class=\"token operator\">|</span>   └── _posts\n└── themes</code></pre>\n<p><code>_config.yml</code> 是配置文件，里面有很多可以配置的数据，这里暂时不多介绍，后面的文章里会进行详细说明。</p>\n<p><code>package.json</code> 是应用程序信息，通常不需要关心。</p>\n<p><code>node_modules</code> 用来存放 <code>node</code> 相关的模块，通常不需要关心。</p>\n<p><code>scaffolds</code> 里面是模版文件，也就是每次新建文章时，都会根据模版文件来创建对应的 <code>md</code> 文件，这一点也会在后续的文章里进行详细介绍。</p>\n<p><code>source</code> 是资源文件夹，用来存放用户资源的地方。除 <code>_posts</code> 文件夹之外，开头命名为 _ (下划线)的文件 / 文件夹和隐藏的文件将会被忽略。</p>\n<p><code>theme</code> 是主题文件夹，每个主题的配置都会有些不一样，需要根据具体主题情况来定，后续介绍主题的文章里会有说明。</p>\n<p>在 <code>breeze-blog</code> 目录下使用以下命令来运行我们的博客：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">hexo server</code></pre>\n<p>在默认情况下，服务会使用 <code>4000</code> 端口，如果已经被占用，也可以添加 <code>-p</code> 参数来换用其它端口：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">hexo server -p 8080</code></pre>\n<p>打开 <code>http://localhost:4000</code> 即可访问我们生成的网站了。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/ntX31VrhMTjFozQ.jpg\" alt=\"hexo-9.jpg\"></p>\n<p>这样，我们的博客就搭建起来了。</p>\n<h2 id=\"六、部署到-github-pages\"><a href=\"#六、部署到-github-pages\" class=\"headerlink\" title=\"六、部署到 github pages\"></a>六、部署到 github pages</h2><p><code>github pages</code> 可以理解为 <del>gayhub</del> <code>github</code> 提供的免费网页空间，可以用来存放你的静态网页文件，并通过 <code>https://用户名.github.io/项目名/</code> 的方式来访问，比如我新创建的 <code>blog</code> 地址就是：<code>https://mfrank2016.github.io/breeze-blog/</code>。</p>\n<p>利用 <code>github pages</code> 就能创建我们的免费博客站点了，至于为什么要使用免费站点，而不选择购买服务器来搭建，是因为根据之前使用服务器经常忘记续费，导致博客数据丢失，损失惨重。<code>github</code> 已经稳定运行了很多年，是全球最大的 <del>同性交友网站</del> 开发者网站，他们的服务值得信赖。而且是免费的。</p>\n<p>我们之前已经注册好 <code>github</code> 的账号并创建好了对应的仓库，本地也安装好了 <code>git</code> ，现在让我们来把他们利用起来。（如果还没有完成的同学可以往上面翻翻，先完成前面的步骤）</p>\n<blockquote>\n<p>注意：有两种类型的 <code>github pages</code>，一种是使用 <code>用户名.github.io</code> 作为项目名，一种是使用其它名称。虽然看起来只是名字不一样，但两种方式其实是有差异的，前一种方式里，网页静态文件只能存放在 master 分支，所以如果想要把博客源文件也存到同一个仓库，必须使用其它分支来存放，相应的 travis ci 监听和推送的分支也需要修改，当然也可以使用另一个新的仓库来存放。后一种方式则没这个限制，通常使用名为 <code>gh-pages</code> 作为分支名，<code>Hexo</code> 内默认设置的分支也是叫这个名字。这里我们使用的是后一种方案，即源文件和生成的网页静态文件存放在同一个仓库，源文件在 <code>master</code> 分支，静态文件在 <code>gh-pages</code> 分支。</p>\n</blockquote>\n<p>首先，我们将本地的文件推送到 <code>github</code> 上。</p>\n<p>在 <code>breeze-blog</code> 目录下，初始化 <code>git</code> 仓库，将现有文件添加到 <code>git</code> 仓库中，并创建 <code>gh-pages</code> 分支：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">cd</span> breeze-blog\n<span class=\"token function\">git</span> init\n<span class=\"token function\">git</span> add <span class=\"token keyword\">.</span>\n<span class=\"token function\">git</span> commit -am<span class=\"token string\">\"init blog\"</span>\n<span class=\"token function\">git</span> remote add origin 仓库地址</code></pre>\n<p>仓库地址是前面我们创建仓库时说过的地址，比如我的地址是： <code>git@github.com:MFrank2016/breeze-blog.git</code> ，把它复制到这里来替换即可。</p>\n<p>然后我们使用最后一句咒语，把代码推送到仓库中去。</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> push -u origin master</code></pre>\n<p>如果你的仓库原来已经有数据了，可以添加 -f 参数来强制推送，但这样会使得你原来的数据丢失，所以慎用。</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> push -f -u origin master</code></pre>\n<p>然后创建一个新的本地分支 <code>gh-pages</code>，并关联远程分支：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> checkout -b gh-pages\n<span class=\"token function\">git</span> push -u origin gh-pages</code></pre>\n<p>⚠️不要改用其它分支名。</p>\n<p>然后在项目 <code>settings</code> 页面里开启 <code>github pages</code>：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/bQWKGwMsAVYk5hp.jpg\" alt=\"hexo-13.jpg\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/HqpxGos7J9mLRkC.jpg\" alt=\"hexo-14.jpg\"></p>\n<p>这里要选择 <code>gh-pages</code> 分支，不要选 <code>master</code> 分支。</p>\n<p>然后我们修改一下 <code>hexo</code> 的配置文件(<code>_config.yml</code>)，找到对应的地方进行修改，指定我们的仓库信息，并修改 <code>root</code> 和 <code>url</code> 信息。</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">url: https://mfrank2016.github.io/\nroot: /breeze-blog/\n\ndeploy:\n  type: <span class=\"token string\">'git'</span>\n  repo: git@github.com:MFrank2016/breeze-blog\n  branch: gh-pages</code></pre>\n<p>把这里的 <code>repo</code> 地址修改为你的仓库地址即可。</p>\n<p>安装 <code>hexo-deployer-git</code>：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">cd</span> breeze-blog\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-deployer-git --save</code></pre>\n<p>万事具备，发车！</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">hexo clean <span class=\"token operator\">&amp;&amp;</span> hexo generate\nhexo deploy</code></pre>\n<p>运行完成后，我们的博客文件就顺利部署到 <code>github pages</code> 上了，现在我们打开下面网址来查看我们的博客效果：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">https://用户名.github.io/项目名/</code></pre>\n<p>之后每次我们添加或修改完本地文件后，使用：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">hexo clean <span class=\"token operator\">&amp;&amp;</span> hexo g -d</code></pre>\n<p>即可重新生成项目文件，并推送到 <code>github</code> 项目的 <code>gh-pages</code> 分支，为了备份数据，也方便我们在不同设备上进行编辑，最好将我们修改的文件推送到 <code>master</code> 分支进行保存：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> checkout master\n<span class=\"token function\">git</span> add <span class=\"token keyword\">.</span>\n<span class=\"token function\">git</span> commit -am <span class=\"token string\">\"这里可以写一下修改的备注信息\"</span>\n<span class=\"token function\">git</span> push</code></pre>\n<h2 id=\"七、使用-travis-ci-进行自动化部署\"><a href=\"#七、使用-travis-ci-进行自动化部署\" class=\"headerlink\" title=\"七、使用 travis ci 进行自动化部署\"></a>七、使用 travis ci 进行自动化部署</h2><p>如果我们每次都按前面的方式进行操作，也会略显麻烦，使用 <code>travis ci</code> 后，可以将前面部署的步骤自动化，我们只需要将本地修改的文件推送到 <code>github</code> 仓库，就会触发 <code>travis ci</code> 的自动部署。</p>\n<p><code>travis ci</code> 的配置也很简单，而且只需要配置一次，之后就不需要修改了。</p>\n<p>首先，我们需要把<em>_config.yml</em>文件里的<em>repo</em>信息注释一下，不需要在配置文件里指定仓库地址，<code>travis ci</code> 会直接在其监听项目上进行部署。</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">deploy:\n  type: 'git'\n#  repo: git@github.com:MFrank2016/breeze-blog\n  branch: gh-pages</code></pre>\n<p>在本地博客目录下创建一个名为 <code>.travis.yml</code> 的文件，与 <code>_config.yml</code> 要在同级目录。</p>\n<p>然后在文件中写入以下内容：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">sudo: false\nlanguage: node_js\nnode_js:\n  - 12\ncache: npm\nbranches:\n  only:\n    - master # build master branch only\nscript:\n  - hexo generate\ndeploy:\n  provider: pages\n  skip-cleanup: true\n  github-token: $GH_TOKEN\n  keep-history: true\n  on:\n    branch: master\n  local-dir: public</code></pre>\n<p>这里没有任何东西需要修改，直接复制粘贴即可。</p>\n<p>接下来，需要在 <code>travis</code> 里配置一个环境变量，<code>GH_TOKEN</code> 。</p>\n<p>前面我们已经将 <code>travis</code> 关联了 <code>github</code> 账号，并同步了项目，如果操作正确，<a href=\"https://travis-ci.org/dashboard\" target=\"_blank\" rel=\"noopener\">这里</a>应该会出现我们的仓库信息。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/Xc2OGJvDNFbhYPs.jpg\" alt=\"hexo-15.jpg\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/E7QyHTNMdjJWP26.jpg\" alt=\"hexo-16.jpg\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/qjJkhAgErKL5tUR.jpg\" alt=\"hexo-17.jpg\"></p>\n<p>这里的 <code>access token</code> 是指 <code>github token</code>，可以在<a href=\"https://github.com/settings/tokens\" target=\"_blank\" rel=\"noopener\">这里</a>获取：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/K35fhMCGLJ7xiUw.jpg\" alt=\"hexo-18.jpg\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/7wNrX19YqGZKLOs.jpg\" alt=\"hexo-19.jpg\"></p>\n<p>选好后，点击 <code>generate</code> 即可生成一个新的 <code>access token</code>，这个 <code>token</code> 即是用于权限验证的，好好保存，不要泄露，千万不要直接写到 <code>config</code> 文件里，而且之后是无法进行查看的，所以需要记录在一个安全的地方。</p>\n<p>创建好之后，把这个 <code>token</code> 填写到前面的 <code>travis ci</code> 的项目环境变量中保存，这样一切就准备好了。</p>\n<p>现在让我们在本地创建一篇新的博客，然后推送到远程仓库：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">cd</span> breeze-blog\n<span class=\"token function\">git</span> checkout master\nhexo new <span class=\"token string\">\"my first blog\"</span>\n<span class=\"token function\">git</span> add <span class=\"token keyword\">.</span>\n<span class=\"token function\">git</span> commit -am<span class=\"token string\">\"add a new blog\"</span>\n<span class=\"token function\">git</span> push</code></pre>\n<p>然后我们可以在 <code>travis ci</code> 中看到构建过程被触发了，等待一会即可完成部署，然后再打开我们的博客，查看一下我们新生成的文章是否已经在上面了。（浏览器有缓存，所以可能需要刷新几次才有效果）</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>整个过程看起来有些麻烦，距上次部署博客已经有很长时间了，我也是摸索了几次后才大致掌握，因为不想每次都重新来一遍，所以还是记录一下为好，利人利己。</p>\n<p>写博客是一种生活态度，记录并整理生活和编程中的心得和经验并分享，在漫漫人生路上留下自己一路走来的印记，这样以后再回过头来看时，就不会感慨时间都去哪了。如果能因此遇到有共同兴趣爱好的人，那也将会是人生里的不错点缀。</p>\n<p>这里只是完成了博客搭建和自动化部署的过程，关于博客的配置和主题的配置以及博客写作的一些技巧会在后面的文章中进行说明，敬请关注～</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<h2 id=\"一、说明\"><a href=\"#一、说明\" class=\"headerlink\" title=\"一、说明\"></a>一、说明</h2><p>本系列文章将会详细说明使用 <code>Hexo</code> + <code>github pages</code> 来搭建个人博客，并对主题进行配置，然后使用 <code>travis ci</code> 来进行自动化部署的全过程。</p>\n<p>搭建一个赏心悦目的博客，写文章和阅读也会更加舒适，一次搭建，终生使用，而且还全程免费，何乐而不为呢。</p>\n<p>通过本系列文章的学习，你将收获一个免费且漂亮的个人博客，并熟悉搭建、写作、部署的全流程以及其中一些很好用的工具。</p>\n<h2 id=\"二、成品展示\"><a href=\"#二、成品展示\" class=\"headerlink\" title=\"二、成品展示\"></a>二、成品展示</h2><p>这只是其中的一个主题，如果不喜欢，也可以很方便的切换其它主题。</p>\n<p><code>hexo</code> 主题相当丰富，可以在<a href=\"https://hexo.io/themes/\" target=\"_blank\" rel=\"noopener\">这里</a>选择喜欢的主题进行切换即可。</p>\n<h2 id=\"三、前期准备\"><a href=\"#三、前期准备\" class=\"headerlink\" title=\"三、前期准备\"></a>三、前期准备</h2><p>在开始搭建之前，需要准备以下几样东西：</p>\n<ul>\n<li>本地安装 <code>node.js</code></li>\n<li>本地安装 <code>git</code></li>\n<li>一个 <code>github</code> 账号</li>\n<li>创建一个 <code>github</code> 仓库</li>\n<li>一个 <code>travis ci</code> 账号</li>\n</ul>\n<p>已经有过安装经验的同学，可以根据自己情况选择性的跳过部分章节。</p>\n<h3 id=\"本地安装-node-js\"><a href=\"#本地安装-node-js\" class=\"headerlink\" title=\"本地安装 node.js\"></a>本地安装 node.js</h3><p><code>windows</code> 系统可以在<a href=\"https://nodejs.org/zh-cn/download/\" target=\"_blank\" rel=\"noopener\">这里</a>下载 <code>installer</code> 安装包进行安装。</p>\n<p><code>mac</code> 系统可以在<a href=\"https://nodejs.org/zh-cn/download/\" target=\"_blank\" rel=\"noopener\">这里</a>下载 <code>pkg</code> 安装包，也可以使用 <code>homebrew</code> 进行安装：</p>\n<pre><code class=\"bash\">brew install node</code></pre>\n<p>然后在命令行输入以下命令来验证是否正确安装:</p>\n<pre><code class=\"bash\">node -v</code></pre>\n<h3 id=\"本地安装-git\"><a href=\"#本地安装-git\" class=\"headerlink\" title=\"本地安装 git\"></a>本地安装 git</h3><p><code>windows</code> 系统可以从<a href=\"https://gitforwindows.org/\" target=\"_blank\" rel=\"noopener\">这里</a>下载安装包后进行安装。</p>\n<p><code>mac</code> 系统可以从<a href=\"https://sourceforge.net/projects/git-osx-installer/\" target=\"_blank\" rel=\"noopener\">这里</a>下载安装包进行安装。</p>\n<p>也可以使用 <code>homebrew</code> 进行安装：</p>\n<pre><code class=\"bash\">brew install git</code></pre>\n<p>输入以下命令来查看是否正确安装好了 <code>git</code> ：</p>\n<pre><code class=\"bash\">git --version</code></pre>\n<p>然后设置自己的用户名和邮箱：</p>\n<pre><code class=\"bash\">git config --global user.name &quot;你的用户名&quot;\ngit config --global user.email &quot;你的公司或个人邮箱&quot;</code></pre>\n<h3 id=\"github-账号\"><a href=\"#github-账号\" class=\"headerlink\" title=\"github 账号\"></a>github 账号</h3><p>首先，需要注册一个 <code>github</code> 账号，<a href=\"https://github.com/join?source=header-home\" target=\"_blank\" rel=\"noopener\">点击这里</a>。</p>\n<p>填写好用户名和密码，验证完成后，便可以将一个 <code>github</code> 账号收入囊中。</p>\n<p>创建好账号之后，我们还需要把我们本地的 <code>SSH Key</code> 添加到 <code>github</code> 中去，这样我们之后才能有权限将本地代码推送到 <code>github</code> 中。</p>\n<p>先本地生成一对 <code>RSA</code> 密钥：</p>\n<pre><code class=\"bash\">ssh-keygen -t rsa -b 4096 -C &quot;你的邮箱&quot;</code></pre>\n<p>然后用食指敲击你的回车键三次，记住，要用食指，但别问为什么。</p>\n<p>找到你刚才创建的密钥，<code>windows</code> 用户可以在 <code>C://用户//admin//.ssh</code> 目录下查找，mac 用户可以在 <code>~/.ssh</code> 目录下找到。复制 <code>id_rsa.pub</code> 文件里的信息，然后到<a href=\"https://github.com/settings/keys\" target=\"_blank\" rel=\"noopener\">这里</a>添加新的 <code>SSHKEY</code> 。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/k3uVFawNbvL84eB.jpg\" alt=\"hexo-10.jpg\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/ijrXcU1ZT96QqsP.jpg\" alt=\"hexo-11.jpg\"></p>\n<p>把我们刚才的 <code>key</code> 复制进行后保存即可。</p>\n<h3 id=\"创建仓库\"><a href=\"#创建仓库\" class=\"headerlink\" title=\"创建仓库\"></a>创建仓库</h3><p>点击<a href=\"https://github.com/new\" target=\"_blank\" rel=\"noopener\">这里</a>，创建一个新的仓库。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/zoDx4HQrACMSYbI.png\" alt=\"hexo-5.jpg\"></p>\n<p>仓库名称可以随便取，比如：<code>blog</code>、<code>my-blog</code>，随便取一个就好。仓库说明也可以随便写，可以大概描述一下你这个仓库是做什么的。可以参考一下<a href=\"https://github.com/MFrank2016/breeze-blog\" target=\"_blank\" rel=\"noopener\">我的仓库</a></p>\n<p>然后把仓库地址记下来，是下图中箭头标示的 <code>git</code> 开头的地址，后面需要用到。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/e36Vp8isyRfYvaw.jpg\" alt=\"hexo-12.jpg\"></p>\n<p>创建好仓库之后，就可以进行下一步了。</p>\n<h3 id=\"travis-ci-账号\"><a href=\"#travis-ci-账号\" class=\"headerlink\" title=\"travis ci 账号\"></a>travis ci 账号</h3><p><code>travis ci</code> 账号是跟 <code>github</code> 账号关联的，所以需要先创建好 <code>github</code> 账号，创建好之后，点击<a href=\"https://travis-ci.org/signin\" target=\"_blank\" rel=\"noopener\">这里</a>进行账号关联登陆。</p>\n<p>在设置里进行一次<a href=\"https://travis-ci.org/account/repositories\" target=\"_blank\" rel=\"noopener\">账户同步</a>：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/Th5tdWvNYlXbz3D.jpg\" alt=\"hexo-7.jpg\"></p>\n<p>同步完后刷新一下页面，刚才创建的仓库应该就会出现在这里：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/vznkDHh9frOMlIX.jpg\" alt=\"hexo-8.jpg\"></p>\n<h2 id=\"四、安装-Hexo\"><a href=\"#四、安装-Hexo\" class=\"headerlink\" title=\"四、安装 Hexo\"></a>四、安装 Hexo</h2><p><code>hexo</code> 是一款静态网站生成工具，可以根据设置的主题样式和配置文件，来生成丰富多彩的网页，通常配置文件设置好之后不需要经常修改，我们只需要负责写好我们的博文，写好之后就能使用命令一键生成网站，而且还可以为所欲为的切换主题，可以说是写博客的一大利器。</p>\n<p><code>hexo</code> 的安装其实很简单，只需要输入以下咒语：</p>\n<pre><code class=\"bash\">npm install -g hexo-cli</code></pre>\n<p>然后轻轻的敲击你的回车键，<code>hexo</code> 便能成功的安装在你的电脑中。</p>\n<p>可以使用以下命令进行验证：</p>\n<pre><code class=\"bash\">hexo -v</code></pre>\n<h2 id=\"五、使用-hexo-搭建博客\"><a href=\"#五、使用-hexo-搭建博客\" class=\"headerlink\" title=\"五、使用 hexo 搭建博客\"></a>五、使用 hexo 搭建博客</h2><p>选择一个准备放置博客网站的目录，然后使用以下命令来初始化一个项目：</p>\n<pre><code class=\"bash\">hexo init breeze-blog\ncd breeze-blog\nnpm install</code></pre>\n<p>该命令将会在当前目录下，生成一个名为 <code>breeze-blog</code> 的新目录，当然，你可以把这个名字换成任何你想要的名字，并将 <code>hexo</code> 的初始化文件写入其中。</p>\n<p>新建完成后，<code>breeze-blog</code> 文件夹的目录如下：</p>\n<pre><code class=\"bash\">.\n├── _config.yml\n├── package.json\n├── node_modules\n├── scaffolds\n├── source\n|   ├── _drafts\n|   └── _posts\n└── themes</code></pre>\n<p><code>_config.yml</code> 是配置文件，里面有很多可以配置的数据，这里暂时不多介绍，后面的文章里会进行详细说明。</p>\n<p><code>package.json</code> 是应用程序信息，通常不需要关心。</p>\n<p><code>node_modules</code> 用来存放 <code>node</code> 相关的模块，通常不需要关心。</p>\n<p><code>scaffolds</code> 里面是模版文件，也就是每次新建文章时，都会根据模版文件来创建对应的 <code>md</code> 文件，这一点也会在后续的文章里进行详细介绍。</p>\n<p><code>source</code> 是资源文件夹，用来存放用户资源的地方。除 <code>_posts</code> 文件夹之外，开头命名为 _ (下划线)的文件 / 文件夹和隐藏的文件将会被忽略。</p>\n<p><code>theme</code> 是主题文件夹，每个主题的配置都会有些不一样，需要根据具体主题情况来定，后续介绍主题的文章里会有说明。</p>\n<p>在 <code>breeze-blog</code> 目录下使用以下命令来运行我们的博客：</p>\n<pre><code class=\"bash\">hexo server</code></pre>\n<p>在默认情况下，服务会使用 <code>4000</code> 端口，如果已经被占用，也可以添加 <code>-p</code> 参数来换用其它端口：</p>\n<pre><code class=\"bash\">hexo server -p 8080</code></pre>\n<p>打开 <code>http://localhost:4000</code> 即可访问我们生成的网站了。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/ntX31VrhMTjFozQ.jpg\" alt=\"hexo-9.jpg\"></p>\n<p>这样，我们的博客就搭建起来了。</p>\n<h2 id=\"六、部署到-github-pages\"><a href=\"#六、部署到-github-pages\" class=\"headerlink\" title=\"六、部署到 github pages\"></a>六、部署到 github pages</h2><p><code>github pages</code> 可以理解为 <del>gayhub</del> <code>github</code> 提供的免费网页空间，可以用来存放你的静态网页文件，并通过 <code>https://用户名.github.io/项目名/</code> 的方式来访问，比如我新创建的 <code>blog</code> 地址就是：<code>https://mfrank2016.github.io/breeze-blog/</code>。</p>\n<p>利用 <code>github pages</code> 就能创建我们的免费博客站点了，至于为什么要使用免费站点，而不选择购买服务器来搭建，是因为根据之前使用服务器经常忘记续费，导致博客数据丢失，损失惨重。<code>github</code> 已经稳定运行了很多年，是全球最大的 <del>同性交友网站</del> 开发者网站，他们的服务值得信赖。而且是免费的。</p>\n<p>我们之前已经注册好 <code>github</code> 的账号并创建好了对应的仓库，本地也安装好了 <code>git</code> ，现在让我们来把他们利用起来。（如果还没有完成的同学可以往上面翻翻，先完成前面的步骤）</p>\n<blockquote>\n<p>注意：有两种类型的 <code>github pages</code>，一种是使用 <code>用户名.github.io</code> 作为项目名，一种是使用其它名称。虽然看起来只是名字不一样，但两种方式其实是有差异的，前一种方式里，网页静态文件只能存放在 master 分支，所以如果想要把博客源文件也存到同一个仓库，必须使用其它分支来存放，相应的 travis ci 监听和推送的分支也需要修改，当然也可以使用另一个新的仓库来存放。后一种方式则没这个限制，通常使用名为 <code>gh-pages</code> 作为分支名，<code>Hexo</code> 内默认设置的分支也是叫这个名字。这里我们使用的是后一种方案，即源文件和生成的网页静态文件存放在同一个仓库，源文件在 <code>master</code> 分支，静态文件在 <code>gh-pages</code> 分支。</p>\n</blockquote>\n<p>首先，我们将本地的文件推送到 <code>github</code> 上。</p>\n<p>在 <code>breeze-blog</code> 目录下，初始化 <code>git</code> 仓库，将现有文件添加到 <code>git</code> 仓库中，并创建 <code>gh-pages</code> 分支：</p>\n<pre><code class=\"bash\">cd breeze-blog\ngit init\ngit add .\ngit commit -am&quot;init blog&quot;\ngit remote add origin 仓库地址</code></pre>\n<p>仓库地址是前面我们创建仓库时说过的地址，比如我的地址是： <code>git@github.com:MFrank2016/breeze-blog.git</code> ，把它复制到这里来替换即可。</p>\n<p>然后我们使用最后一句咒语，把代码推送到仓库中去。</p>\n<pre><code class=\"bash\">git push -u origin master</code></pre>\n<p>如果你的仓库原来已经有数据了，可以添加 -f 参数来强制推送，但这样会使得你原来的数据丢失，所以慎用。</p>\n<pre><code class=\"bash\">git push -f -u origin master</code></pre>\n<p>然后创建一个新的本地分支 <code>gh-pages</code>，并关联远程分支：</p>\n<pre><code class=\"bash\">git checkout -b gh-pages\ngit push -u origin gh-pages</code></pre>\n<p>⚠️不要改用其它分支名。</p>\n<p>然后在项目 <code>settings</code> 页面里开启 <code>github pages</code>：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/bQWKGwMsAVYk5hp.jpg\" alt=\"hexo-13.jpg\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/HqpxGos7J9mLRkC.jpg\" alt=\"hexo-14.jpg\"></p>\n<p>这里要选择 <code>gh-pages</code> 分支，不要选 <code>master</code> 分支。</p>\n<p>然后我们修改一下 <code>hexo</code> 的配置文件(<code>_config.yml</code>)，找到对应的地方进行修改，指定我们的仓库信息，并修改 <code>root</code> 和 <code>url</code> 信息。</p>\n<pre><code class=\"bash\">url: https://mfrank2016.github.io/\nroot: /breeze-blog/\n\ndeploy:\n  type: &#39;git&#39;\n  repo: git@github.com:MFrank2016/breeze-blog\n  branch: gh-pages</code></pre>\n<p>把这里的 <code>repo</code> 地址修改为你的仓库地址即可。</p>\n<p>安装 <code>hexo-deployer-git</code>：</p>\n<pre><code class=\"bash\">cd breeze-blog\nnpm install hexo-deployer-git --save</code></pre>\n<p>万事具备，发车！</p>\n<pre><code class=\"bash\">hexo clean &amp;&amp; hexo generate\nhexo deploy</code></pre>\n<p>运行完成后，我们的博客文件就顺利部署到 <code>github pages</code> 上了，现在我们打开下面网址来查看我们的博客效果：</p>\n<pre><code class=\"bash\">https://用户名.github.io/项目名/</code></pre>\n<p>之后每次我们添加或修改完本地文件后，使用：</p>\n<pre><code class=\"bash\">hexo clean &amp;&amp; hexo g -d</code></pre>\n<p>即可重新生成项目文件，并推送到 <code>github</code> 项目的 <code>gh-pages</code> 分支，为了备份数据，也方便我们在不同设备上进行编辑，最好将我们修改的文件推送到 <code>master</code> 分支进行保存：</p>\n<pre><code class=\"bash\">git checkout master\ngit add .\ngit commit -am &quot;这里可以写一下修改的备注信息&quot;\ngit push</code></pre>\n<h2 id=\"七、使用-travis-ci-进行自动化部署\"><a href=\"#七、使用-travis-ci-进行自动化部署\" class=\"headerlink\" title=\"七、使用 travis ci 进行自动化部署\"></a>七、使用 travis ci 进行自动化部署</h2><p>如果我们每次都按前面的方式进行操作，也会略显麻烦，使用 <code>travis ci</code> 后，可以将前面部署的步骤自动化，我们只需要将本地修改的文件推送到 <code>github</code> 仓库，就会触发 <code>travis ci</code> 的自动部署。</p>\n<p><code>travis ci</code> 的配置也很简单，而且只需要配置一次，之后就不需要修改了。</p>\n<p>首先，我们需要把<em>_config.yml</em>文件里的<em>repo</em>信息注释一下，不需要在配置文件里指定仓库地址，<code>travis ci</code> 会直接在其监听项目上进行部署。</p>\n<pre><code class=\"yml\">deploy:\n  type: &#39;git&#39;\n#  repo: git@github.com:MFrank2016/breeze-blog\n  branch: gh-pages</code></pre>\n<p>在本地博客目录下创建一个名为 <code>.travis.yml</code> 的文件，与 <code>_config.yml</code> 要在同级目录。</p>\n<p>然后在文件中写入以下内容：</p>\n<pre><code class=\"yml\">sudo: false\nlanguage: node_js\nnode_js:\n  - 12\ncache: npm\nbranches:\n  only:\n    - master # build master branch only\nscript:\n  - hexo generate\ndeploy:\n  provider: pages\n  skip-cleanup: true\n  github-token: $GH_TOKEN\n  keep-history: true\n  on:\n    branch: master\n  local-dir: public</code></pre>\n<p>这里没有任何东西需要修改，直接复制粘贴即可。</p>\n<p>接下来，需要在 <code>travis</code> 里配置一个环境变量，<code>GH_TOKEN</code> 。</p>\n<p>前面我们已经将 <code>travis</code> 关联了 <code>github</code> 账号，并同步了项目，如果操作正确，<a href=\"https://travis-ci.org/dashboard\" target=\"_blank\" rel=\"noopener\">这里</a>应该会出现我们的仓库信息。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/Xc2OGJvDNFbhYPs.jpg\" alt=\"hexo-15.jpg\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/E7QyHTNMdjJWP26.jpg\" alt=\"hexo-16.jpg\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/qjJkhAgErKL5tUR.jpg\" alt=\"hexo-17.jpg\"></p>\n<p>这里的 <code>access token</code> 是指 <code>github token</code>，可以在<a href=\"https://github.com/settings/tokens\" target=\"_blank\" rel=\"noopener\">这里</a>获取：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/K35fhMCGLJ7xiUw.jpg\" alt=\"hexo-18.jpg\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/7wNrX19YqGZKLOs.jpg\" alt=\"hexo-19.jpg\"></p>\n<p>选好后，点击 <code>generate</code> 即可生成一个新的 <code>access token</code>，这个 <code>token</code> 即是用于权限验证的，好好保存，不要泄露，千万不要直接写到 <code>config</code> 文件里，而且之后是无法进行查看的，所以需要记录在一个安全的地方。</p>\n<p>创建好之后，把这个 <code>token</code> 填写到前面的 <code>travis ci</code> 的项目环境变量中保存，这样一切就准备好了。</p>\n<p>现在让我们在本地创建一篇新的博客，然后推送到远程仓库：</p>\n<pre><code class=\"bash\">cd breeze-blog\ngit checkout master\nhexo new &quot;my first blog&quot;\ngit add .\ngit commit -am&quot;add a new blog&quot;\ngit push</code></pre>\n<p>然后我们可以在 <code>travis ci</code> 中看到构建过程被触发了，等待一会即可完成部署，然后再打开我们的博客，查看一下我们新生成的文章是否已经在上面了。（浏览器有缓存，所以可能需要刷新几次才有效果）</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>整个过程看起来有些麻烦，距上次部署博客已经有很长时间了，我也是摸索了几次后才大致掌握，因为不想每次都重新来一遍，所以还是记录一下为好，利人利己。</p>\n<p>写博客是一种生活态度，记录并整理生活和编程中的心得和经验并分享，在漫漫人生路上留下自己一路走来的印记，这样以后再回过头来看时，就不会感慨时间都去哪了。如果能因此遇到有共同兴趣爱好的人，那也将会是人生里的不错点缀。</p>\n<p>这里只是完成了博客搭建和自动化部署的过程，关于博客的配置和主题的配置以及博客写作的一些技巧会在后面的文章中进行说明，敬请关注～</p>\n"},{"title":"【Go语言绘图】图片添加文字（二）","toc":true,"cover":true,"date":"2020-12-22T14:40:35.000Z","_content":"\n这一篇将继续介绍gg库中绘制文字相关的方法，主要包括：`DrawStringAnchored()`、`DrawStringWrapped()`、`MeasureMultilineString()`、`WordWrap()`下面来分别进行介绍。\n\n## DrawStringAnchored\n\n如果不细究，可能会觉得这个方法是 `DrawString()` 方法的一个封装，但看看里面的实现就能发现，实际情况正好相反。\n\n```go\n// DrawString draws the specified text at the specified point.\nfunc (dc *Context) DrawString(s string, x, y float64) {\n\tdc.DrawStringAnchored(s, x, y, 0, 0)\n}\n\n// DrawStringAnchored draws the specified text at the specified anchor point.\n// The anchor point is x - w * ax, y - h * ay, where w, h is the size of the\n// text. Use ax=0.5, ay=0.5 to center the text at the specified point.\nfunc (dc *Context) DrawStringAnchored(s string, x, y, ax, ay float64) {\n\tw, h := dc.MeasureString(s)\n\tx -= ax * w\n\ty += ay * h\n\tif dc.mask == nil {\n\t\tdc.drawString(dc.im, s, x, y)\n\t} else {\n\t\tim := image.NewRGBA(image.Rect(0, 0, dc.width, dc.height))\n\t\tdc.drawString(im, s, x, y)\n\t\tdraw.DrawMask(dc.im, dc.im.Bounds(), im, image.ZP, dc.mask, image.ZP, draw.Over)\n\t}\n}\n```\n\n`DrawStringAnchored()` 方法主要有5个参数，第一个参数是要绘制的字符串，后面四个参数共同决定了锚点的位置，具体计算逻辑是`(x - w * ax, y - h * ay)`，所以，当`ax`、`ay`设置为`0`时就是左对齐，此时锚点位置处于文字框左下角；设置为`0.5`时就是居中，此时锚点位置处于文字框正中央；设置为`1`时就是右对齐，此时锚点位置处于文字控右上角。\n\n我们来看下效果：\n\n```go\nfunc TestDrawStringAnchored(t *testing.T){\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(1, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 96); err != nil {\n\t\tpanic(err)\n\t}\n\tdc.DrawStringAnchored(\"Hello, world!\", 0, dc.FontHeight(), 0, 0)\n\tdc.DrawStringAnchored(\"Hello, world!\", S/2, S/2, 0.5, 0.5)\n\tdc.DrawStringAnchored(\"Hello, world!\", S, S-dc.FontHeight(), 1, 1)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n![](1.png)\n\n这里需要注意的就是锚点的位置，当左对齐时，锚点在左下角，所以设置的 `(0, dc.FontHeight())`  代表的是文字框左下角的位置，同理，当居中对齐时，`(S/2, S/2)` 代表的是文字框中心点的位置，右对齐时，`(S, S-dc.FontHeight())` 代表的是文字框右上顶点的位置。\n\n## DrawStringWrapped\n\n这个方法可以比较方便的绘制多行文字，还能自动折行，基本上相当于真正文字框的效果。\n\n先看个例子简单的熟悉一下：\n\n```go\nfunc TestDrawStringWrapped(t *testing.T){\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(1, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 96); err != nil {\n\t\tpanic(err)\n\t}\n\tdc.DrawStringWrapped(\"Hello world! Hello Frank! Hello Alice!\", S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n绘制的效果如下：\n\n![](2.png)\n\n可以看到，不仅自动换行，而且还保持了单词的完整性，没有将一个单词从中间分割开来。\n\n这个方法的参数有点多，一共有8个参数。\n\n第1个参数代表的是要绘制的字符串，比如这里的`Hello world! Hello Frank! Hello Alice!`。第6个参数代表文本框的宽度。第7个参数代表行间距。\n\n第2～5和第8个参数共同决定了锚点的位置。这里的计算比之前稍微复杂一点，让我们来看看里面的具体实现：\n\n```go\n// DrawStringWrapped word-wraps the specified string to the given max width\n// and then draws it at the specified anchor point using the given line\n// spacing and text alignment.\nfunc (dc *Context) DrawStringWrapped(s string, x, y, ax, ay, width, lineSpacing float64, align Align) {\n\tlines := dc.WordWrap(s, width)\n\n\t// sync h formula with MeasureMultilineString\n\th := float64(len(lines)) * dc.fontHeight * lineSpacing\n\th -= (lineSpacing - 1) * dc.fontHeight\n\n\tx -= ax * width\n\ty -= ay * h\n\tswitch align {\n\tcase AlignLeft:\n\t\tax = 0\n\tcase AlignCenter:\n\t\tax = 0.5\n\t\tx += width / 2\n\tcase AlignRight:\n\t\tax = 1\n\t\tx += width\n\t}\n\tay = 1\n\tfor _, line := range lines {\n\t\tdc.DrawStringAnchored(line, x, y, ax, ay)\n\t\ty += dc.fontHeight * lineSpacing\n\t}\n}\n```\n\n首先通过 `WordWrap()` 方法来得到根据指定宽度处理过后的每一行需要展示的字符串信息。\n\n```go\nlines := dc.WordWrap(s, width)\n```\n\n然后计算行高，这里计算的时候是用行数乘以字体高度再乘以行间距，得到结果后再减去一个行间距。所以这个 `lineSpacing` 的含义是行间距相对于字体高度的倍数，当 `lineSpacing` 设置为1时，也就是行间距为0，设置为1.1时，代表行间距为字体高度的0.1倍。\n\n```go\nh := float64(len(lines)) * dc.fontHeight * lineSpacing\nh -= (lineSpacing - 1) * dc.fontHeight\n```\n\n然后是有点绕的计算。\n\n```go\nx -= ax * width\ny -= ay * h\nswitch align {\ncase AlignLeft:\n    ax = 0\ncase AlignCenter:\n    ax = 0.5\n    x += width / 2\ncase AlignRight:\n    ax = 1\n    x += width\n}\nay = 1\nfor _, line := range lines {\n    dc.DrawStringAnchored(line, x, y, ax, ay)\n    y += dc.fontHeight * lineSpacing\n}\n```\n\n可以看到，整体逻辑是先计算好首行文字的锚点位置，然后对处理过的每个字符串调用 `DrawStringAnchored()` 方法进行最终文字绘制。我们可以从下往上看，在循环绘制之前，先设置了 `ay = 1`，也就是说锚点的偏移位置会在每一行的顶部，然后我们来看这个`ax`：\n\n```go\nswitch align {\ncase AlignLeft:\n    ax = 0\ncase AlignCenter:\n    ax = 0.5\n    x += width / 2\ncase AlignRight:\n    ax = 1\n    x += width\n}\n```\n\n根据传入的最后一个参数的不同值，`ax` 会设置为不同的值。当最后一个参数分别为 `AlignLeft`、`AlignCenter`、`AlignRight`时，`ax` 和 `ay` 的组合分别为：`(0,1)`、`(0.5,1)`、`(1,1)`，锚点相对于单行文字的位置分别为左上顶点、上中位置、右上顶点。\n\n然后我们再来看这个 `y` 的值：\n\n```go\ny -= ay * h\n```\n\n`y` 的初始位置为传入的 `y` 值减去 `ay` (y轴偏移) 乘以整体文本框高度，代表的含义是初始锚点`(x,y)`相对于文本框的位置，分别传入`0`、`0.5`、`1`时分别代表锚点处于文本框的上边线、正中线和下边线上。在循环绘制文字时，`y` 的值也会不断调整，代表单行文字的锚点位置也在不断变化。\n\n```go\ny += dc.fontHeight * lineSpacing\n```\n\n最后来看下 `x` 的值，初始值为初始锚点相对于传入的文本框宽度的相对位置，`ax` 分别为 `0`、`0.5`、`1` 时，分别代表初始锚点位于整体文本框的左边线、居中竖线和右边线上。\n\n```go\nx -= ax * width\n```\n\n根据传入的最后一个参数的不同，又会对x进行一次调整，这样调整之后，便能实现文字在文本框中左对齐、居中和右对齐的效果了。\n\n```go\nswitch align {\ncase AlignLeft:\n    ax = 0\ncase AlignCenter:\n    ax = 0.5\n    x += width / 2\ncase AlignRight:\n    ax = 1\n    x += width\n}\n```\n\n看起来确实挺好用，不用再操心换行的事情了。但别高兴的太早，有一点需要注意。这个方法只会根据空格来分割字符串，如果字符串没有空格，就会变成只有一行文字的效果。\n\n```go\ndc.DrawStringWrapped(\"HelloWorld!HelloFrank!HelloAlice!\", S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n```\n\n![](3.png)\n\n你可能会觉得，英文单词之间都会有空格的嘛，应该不用担心，但如果是中文呢？\n\n```go\nif err := dc.LoadFontFace(\"/Users/bytedance/Downloads/font/方正楷体简体.ttf\", 96); err != nil {\n    panic(err)\n}\ndc.DrawStringWrapped(\"如果我们把文字换成中文效果就没那么好了\", S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n```\n\n![](4.png)\n\n另外，这个方法不会限制文本框整体高度，所以如果文本很长，即使可能正确换行，仍旧会超出图片范围。\n\n```go\ndc.DrawStringWrapped(\"比如这是一段很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 的文字\", S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n```\n\n![](5.png)\n\n另外，它是按照空格进行词元素分割的，所以不会从单词的中间进行拆分，这既是优点，也是缺点。因为如果有长单词的话，可能会导致提前换行，让某些行看起来比其它行短很多。所以要想精确控制，还是得用笨办法。\n\n### MeasureMultilineString\n\n`MeasureMultilineString()` 方法可以测量多行文本的整体高度和宽度，需要传入用换行符分割好的文本行字符串和行间距，里面的计算逻辑也很简单。\n\n```go\nfunc (dc *Context) MeasureMultilineString(s string, lineSpacing float64) (width, height float64) {\n\tlines := strings.Split(s, \"\\n\")\n\n\t// sync h formula with DrawStringWrapped\n\theight = float64(len(lines)) * dc.fontHeight * lineSpacing\n\theight -= (lineSpacing - 1) * dc.fontHeight\n\n\td := &font.Drawer{\n\t\tFace: dc.fontFace,\n\t}\n\n\t// max width from lines\n\tfor _, line := range lines {\n\t\tadv := d.MeasureString(line)\n\t\tcurrentWidth := float64(adv >> 6) // from gg.Context.MeasureString\n\t\tif currentWidth > width {\n\t\t\twidth = currentWidth\n\t\t}\n\t}\n\n\treturn width, height\n}\n```\n\n行高的计算跟上面`DrawStringWrapped()`方法是一样的：\n\n```go\nh := float64(len(lines)) * dc.fontHeight * lineSpacing\nh -= (lineSpacing - 1) * dc.fontHeight\n```\n\n宽度则是取这些文本行中宽度最大的那个。\n\n### WordWrap\n\n这个方法是用来处理文本的，负责对文本根据指定宽度进行分行，在 `DrawStringWrapped()` 方法中已经有所调用。它内部是调用`wordWrap()`函数来实现的。\n\n```go\n// WordWrap wraps the specified string to the given max width and current\n// font face.\nfunc (dc *Context) WordWrap(s string, w float64) []string {\n\treturn wordWrap(dc, s, w)\n}\n```\n\n`wordWrap()` 函数做的事情便是先将文字按换行符分割，然后对每一个子字符串按空格进行分割，再通过一个元素一个元素的拼接来判断出适合当前行宽的最大字符串。\n\n```go\nfunc wordWrap(m measureStringer, s string, width float64) []string {\n\tvar result []string\n\tfor _, line := range strings.Split(s, \"\\n\") {\n\t\tfields := splitOnSpace(line)\n\t\tif len(fields)%2 == 1 {\n\t\t\tfields = append(fields, \"\")\n\t\t}\n\t\tx := \"\"\n\t\tfor i := 0; i < len(fields); i += 2 {\n\t\t\tw, _ := m.MeasureString(x + fields[i])\n\t\t\tif w > width {\n\t\t\t\tif x == \"\" {\n\t\t\t\t\tresult = append(result, fields[i])\n\t\t\t\t\tx = \"\"\n\t\t\t\t\tcontinue\n\t\t\t\t} else {\n\t\t\t\t\tresult = append(result, x)\n\t\t\t\t\tx = \"\"\n\t\t\t\t}\n\t\t\t}\n\t\t\tx += fields[i] + fields[i+1]\n\t\t}\n\t\tif x != \"\" {\n\t\t\tresult = append(result, x)\n\t\t}\n\t}\n\tfor i, line := range result {\n\t\tresult[i] = strings.TrimSpace(line)\n\t}\n\treturn result\n}\n```\n\n## 需要注意的点\n\n### otf 字体文件加载\n\n前面的内容中，加载字体文件都使用的是 `LoadFontFace()` 方法进行的，但需要注意的是，这个方法只能加载 `ttf` 字体文件，也就是 `true type font`，无法加载 `otf` 字体文件，也就是 `open type font`。 所以如果需要加载 `otf` 字体文件，则需要换一个姿势。\n\n```go\nfunc getOpenTypeFontFace(fontFilePath string, fontSize, dpi float64)(*font.Face, error){\n\tfontData, fontFileReadErr := ioutil.ReadFile(fontFilePath)\n\tif fontFileReadErr != nil {\n\t\treturn nil, fontFileReadErr\n\t}\n\totfFont, parseErr := opentype.Parse(fontData)\n\tif parseErr != nil {\n\t\treturn nil, parseErr\n\t}\n\totfFace, newFaceErr := opentype.NewFace(otfFont, &opentype.FaceOptions{\n\t\tSize: fontSize,\n\t\tDPI:  dpi,\n\t})\n\tif newFaceErr != nil {\n\t\treturn nil, newFaceErr\n\t}\n\treturn &otfFace, nil\n}\n```\n\n来测试一下：\n\n```go\nfunc TestUseOtfFile(t *testing.T){\n\tfilePath := \"SourceHanSansCN-Bold-2.otf\"\n\tfontFace, err := getOpenTypeFontFace(filePath, 100, 82)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(0, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tdc.SetFontFace(*fontFace)\n\tdc.DrawStringWrapped(\"比如这是一段 很长很长很长 很长很长很长 的文字\", S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n![](6.png)\n\n### 行高的问题\n\n还有一个需要注意的问题，之前在开发时也踩过坑。`SetFontFace` 与 `LoadFontFace` 计算 `fontHeight` 时姿势不一样，所以导致设置同样的字体大小时，最终的字体高度却不一致。\n\n```go\nfunc (dc *Context) SetFontFace(fontFace font.Face) {\n\tdc.fontFace = fontFace\n\tdc.fontHeight = float64(fontFace.Metrics().Height) / 64\n}\n\nfunc (dc *Context) LoadFontFace(path string, points float64) error {\n\tface, err := LoadFontFace(path, points)\n\tif err == nil {\n\t\tdc.fontFace = face\n\t\tdc.fontHeight = points * 72 / 96\n\t}\n\treturn err\n}\n```\n\n可以看到对于行高的计算逻辑有着较大区别，我们可以用一个例子来简单验证一下：\n\n```go\nfunc TestUseOtfFile(t *testing.T){\n\tfilePath := \"/Users/bytedance/Downloads/font/方正楷体简体.ttf\"\n\tfontFace1, err := getOpenTypeFontFace(filePath, 100, 82)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(0, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tdc.SetFontFace(*fontFace1)\n\tdc.DrawStringWrapped(\"比如这是一段文字\", S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n\tif err := dc.LoadFontFace(\"/Users/bytedance/Downloads/font/方正楷体简体.ttf\", 100); err != nil {\n\t\tpanic(err)\n\t}\n\tdc.DrawStringWrapped(\"比如这是一段文字\", S/2, S/2 + 100, 0.5, 0.5, S, 1, gg.AlignCenter)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n![](7.png)\n\n可以看到，两行文字大小明显不一样。\n\n## 小结\n\n至此，关于文字绘制的相关内容就说完了。这两篇讲解了gg库中关于文字绘制相关的内容，相信对于文字绘制已经有了比较好的掌握。实践出真知，还是需要多改改多用用才知道是怎么一回事。在之后的一篇里，会根据前面的内容进行一个小小的实战应用，让我们的知识真正应用起来～\n\n如果本篇内容对你有帮助，别忘了点赞关注加收藏～","source":"_posts/picture/go-draw-word-in-pic2.md","raw":"---\ntitle: 【Go语言绘图】图片添加文字（二）\ntags:\n  - go\ncategories:\n  - 编程\ntoc: true\ncover: true\ndate: 2020-12-22 22:40:35\n---\n\n这一篇将继续介绍gg库中绘制文字相关的方法，主要包括：`DrawStringAnchored()`、`DrawStringWrapped()`、`MeasureMultilineString()`、`WordWrap()`下面来分别进行介绍。\n\n## DrawStringAnchored\n\n如果不细究，可能会觉得这个方法是 `DrawString()` 方法的一个封装，但看看里面的实现就能发现，实际情况正好相反。\n\n```go\n// DrawString draws the specified text at the specified point.\nfunc (dc *Context) DrawString(s string, x, y float64) {\n\tdc.DrawStringAnchored(s, x, y, 0, 0)\n}\n\n// DrawStringAnchored draws the specified text at the specified anchor point.\n// The anchor point is x - w * ax, y - h * ay, where w, h is the size of the\n// text. Use ax=0.5, ay=0.5 to center the text at the specified point.\nfunc (dc *Context) DrawStringAnchored(s string, x, y, ax, ay float64) {\n\tw, h := dc.MeasureString(s)\n\tx -= ax * w\n\ty += ay * h\n\tif dc.mask == nil {\n\t\tdc.drawString(dc.im, s, x, y)\n\t} else {\n\t\tim := image.NewRGBA(image.Rect(0, 0, dc.width, dc.height))\n\t\tdc.drawString(im, s, x, y)\n\t\tdraw.DrawMask(dc.im, dc.im.Bounds(), im, image.ZP, dc.mask, image.ZP, draw.Over)\n\t}\n}\n```\n\n`DrawStringAnchored()` 方法主要有5个参数，第一个参数是要绘制的字符串，后面四个参数共同决定了锚点的位置，具体计算逻辑是`(x - w * ax, y - h * ay)`，所以，当`ax`、`ay`设置为`0`时就是左对齐，此时锚点位置处于文字框左下角；设置为`0.5`时就是居中，此时锚点位置处于文字框正中央；设置为`1`时就是右对齐，此时锚点位置处于文字控右上角。\n\n我们来看下效果：\n\n```go\nfunc TestDrawStringAnchored(t *testing.T){\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(1, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 96); err != nil {\n\t\tpanic(err)\n\t}\n\tdc.DrawStringAnchored(\"Hello, world!\", 0, dc.FontHeight(), 0, 0)\n\tdc.DrawStringAnchored(\"Hello, world!\", S/2, S/2, 0.5, 0.5)\n\tdc.DrawStringAnchored(\"Hello, world!\", S, S-dc.FontHeight(), 1, 1)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n![](1.png)\n\n这里需要注意的就是锚点的位置，当左对齐时，锚点在左下角，所以设置的 `(0, dc.FontHeight())`  代表的是文字框左下角的位置，同理，当居中对齐时，`(S/2, S/2)` 代表的是文字框中心点的位置，右对齐时，`(S, S-dc.FontHeight())` 代表的是文字框右上顶点的位置。\n\n## DrawStringWrapped\n\n这个方法可以比较方便的绘制多行文字，还能自动折行，基本上相当于真正文字框的效果。\n\n先看个例子简单的熟悉一下：\n\n```go\nfunc TestDrawStringWrapped(t *testing.T){\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(1, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 96); err != nil {\n\t\tpanic(err)\n\t}\n\tdc.DrawStringWrapped(\"Hello world! Hello Frank! Hello Alice!\", S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n绘制的效果如下：\n\n![](2.png)\n\n可以看到，不仅自动换行，而且还保持了单词的完整性，没有将一个单词从中间分割开来。\n\n这个方法的参数有点多，一共有8个参数。\n\n第1个参数代表的是要绘制的字符串，比如这里的`Hello world! Hello Frank! Hello Alice!`。第6个参数代表文本框的宽度。第7个参数代表行间距。\n\n第2～5和第8个参数共同决定了锚点的位置。这里的计算比之前稍微复杂一点，让我们来看看里面的具体实现：\n\n```go\n// DrawStringWrapped word-wraps the specified string to the given max width\n// and then draws it at the specified anchor point using the given line\n// spacing and text alignment.\nfunc (dc *Context) DrawStringWrapped(s string, x, y, ax, ay, width, lineSpacing float64, align Align) {\n\tlines := dc.WordWrap(s, width)\n\n\t// sync h formula with MeasureMultilineString\n\th := float64(len(lines)) * dc.fontHeight * lineSpacing\n\th -= (lineSpacing - 1) * dc.fontHeight\n\n\tx -= ax * width\n\ty -= ay * h\n\tswitch align {\n\tcase AlignLeft:\n\t\tax = 0\n\tcase AlignCenter:\n\t\tax = 0.5\n\t\tx += width / 2\n\tcase AlignRight:\n\t\tax = 1\n\t\tx += width\n\t}\n\tay = 1\n\tfor _, line := range lines {\n\t\tdc.DrawStringAnchored(line, x, y, ax, ay)\n\t\ty += dc.fontHeight * lineSpacing\n\t}\n}\n```\n\n首先通过 `WordWrap()` 方法来得到根据指定宽度处理过后的每一行需要展示的字符串信息。\n\n```go\nlines := dc.WordWrap(s, width)\n```\n\n然后计算行高，这里计算的时候是用行数乘以字体高度再乘以行间距，得到结果后再减去一个行间距。所以这个 `lineSpacing` 的含义是行间距相对于字体高度的倍数，当 `lineSpacing` 设置为1时，也就是行间距为0，设置为1.1时，代表行间距为字体高度的0.1倍。\n\n```go\nh := float64(len(lines)) * dc.fontHeight * lineSpacing\nh -= (lineSpacing - 1) * dc.fontHeight\n```\n\n然后是有点绕的计算。\n\n```go\nx -= ax * width\ny -= ay * h\nswitch align {\ncase AlignLeft:\n    ax = 0\ncase AlignCenter:\n    ax = 0.5\n    x += width / 2\ncase AlignRight:\n    ax = 1\n    x += width\n}\nay = 1\nfor _, line := range lines {\n    dc.DrawStringAnchored(line, x, y, ax, ay)\n    y += dc.fontHeight * lineSpacing\n}\n```\n\n可以看到，整体逻辑是先计算好首行文字的锚点位置，然后对处理过的每个字符串调用 `DrawStringAnchored()` 方法进行最终文字绘制。我们可以从下往上看，在循环绘制之前，先设置了 `ay = 1`，也就是说锚点的偏移位置会在每一行的顶部，然后我们来看这个`ax`：\n\n```go\nswitch align {\ncase AlignLeft:\n    ax = 0\ncase AlignCenter:\n    ax = 0.5\n    x += width / 2\ncase AlignRight:\n    ax = 1\n    x += width\n}\n```\n\n根据传入的最后一个参数的不同值，`ax` 会设置为不同的值。当最后一个参数分别为 `AlignLeft`、`AlignCenter`、`AlignRight`时，`ax` 和 `ay` 的组合分别为：`(0,1)`、`(0.5,1)`、`(1,1)`，锚点相对于单行文字的位置分别为左上顶点、上中位置、右上顶点。\n\n然后我们再来看这个 `y` 的值：\n\n```go\ny -= ay * h\n```\n\n`y` 的初始位置为传入的 `y` 值减去 `ay` (y轴偏移) 乘以整体文本框高度，代表的含义是初始锚点`(x,y)`相对于文本框的位置，分别传入`0`、`0.5`、`1`时分别代表锚点处于文本框的上边线、正中线和下边线上。在循环绘制文字时，`y` 的值也会不断调整，代表单行文字的锚点位置也在不断变化。\n\n```go\ny += dc.fontHeight * lineSpacing\n```\n\n最后来看下 `x` 的值，初始值为初始锚点相对于传入的文本框宽度的相对位置，`ax` 分别为 `0`、`0.5`、`1` 时，分别代表初始锚点位于整体文本框的左边线、居中竖线和右边线上。\n\n```go\nx -= ax * width\n```\n\n根据传入的最后一个参数的不同，又会对x进行一次调整，这样调整之后，便能实现文字在文本框中左对齐、居中和右对齐的效果了。\n\n```go\nswitch align {\ncase AlignLeft:\n    ax = 0\ncase AlignCenter:\n    ax = 0.5\n    x += width / 2\ncase AlignRight:\n    ax = 1\n    x += width\n}\n```\n\n看起来确实挺好用，不用再操心换行的事情了。但别高兴的太早，有一点需要注意。这个方法只会根据空格来分割字符串，如果字符串没有空格，就会变成只有一行文字的效果。\n\n```go\ndc.DrawStringWrapped(\"HelloWorld!HelloFrank!HelloAlice!\", S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n```\n\n![](3.png)\n\n你可能会觉得，英文单词之间都会有空格的嘛，应该不用担心，但如果是中文呢？\n\n```go\nif err := dc.LoadFontFace(\"/Users/bytedance/Downloads/font/方正楷体简体.ttf\", 96); err != nil {\n    panic(err)\n}\ndc.DrawStringWrapped(\"如果我们把文字换成中文效果就没那么好了\", S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n```\n\n![](4.png)\n\n另外，这个方法不会限制文本框整体高度，所以如果文本很长，即使可能正确换行，仍旧会超出图片范围。\n\n```go\ndc.DrawStringWrapped(\"比如这是一段很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 的文字\", S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n```\n\n![](5.png)\n\n另外，它是按照空格进行词元素分割的，所以不会从单词的中间进行拆分，这既是优点，也是缺点。因为如果有长单词的话，可能会导致提前换行，让某些行看起来比其它行短很多。所以要想精确控制，还是得用笨办法。\n\n### MeasureMultilineString\n\n`MeasureMultilineString()` 方法可以测量多行文本的整体高度和宽度，需要传入用换行符分割好的文本行字符串和行间距，里面的计算逻辑也很简单。\n\n```go\nfunc (dc *Context) MeasureMultilineString(s string, lineSpacing float64) (width, height float64) {\n\tlines := strings.Split(s, \"\\n\")\n\n\t// sync h formula with DrawStringWrapped\n\theight = float64(len(lines)) * dc.fontHeight * lineSpacing\n\theight -= (lineSpacing - 1) * dc.fontHeight\n\n\td := &font.Drawer{\n\t\tFace: dc.fontFace,\n\t}\n\n\t// max width from lines\n\tfor _, line := range lines {\n\t\tadv := d.MeasureString(line)\n\t\tcurrentWidth := float64(adv >> 6) // from gg.Context.MeasureString\n\t\tif currentWidth > width {\n\t\t\twidth = currentWidth\n\t\t}\n\t}\n\n\treturn width, height\n}\n```\n\n行高的计算跟上面`DrawStringWrapped()`方法是一样的：\n\n```go\nh := float64(len(lines)) * dc.fontHeight * lineSpacing\nh -= (lineSpacing - 1) * dc.fontHeight\n```\n\n宽度则是取这些文本行中宽度最大的那个。\n\n### WordWrap\n\n这个方法是用来处理文本的，负责对文本根据指定宽度进行分行，在 `DrawStringWrapped()` 方法中已经有所调用。它内部是调用`wordWrap()`函数来实现的。\n\n```go\n// WordWrap wraps the specified string to the given max width and current\n// font face.\nfunc (dc *Context) WordWrap(s string, w float64) []string {\n\treturn wordWrap(dc, s, w)\n}\n```\n\n`wordWrap()` 函数做的事情便是先将文字按换行符分割，然后对每一个子字符串按空格进行分割，再通过一个元素一个元素的拼接来判断出适合当前行宽的最大字符串。\n\n```go\nfunc wordWrap(m measureStringer, s string, width float64) []string {\n\tvar result []string\n\tfor _, line := range strings.Split(s, \"\\n\") {\n\t\tfields := splitOnSpace(line)\n\t\tif len(fields)%2 == 1 {\n\t\t\tfields = append(fields, \"\")\n\t\t}\n\t\tx := \"\"\n\t\tfor i := 0; i < len(fields); i += 2 {\n\t\t\tw, _ := m.MeasureString(x + fields[i])\n\t\t\tif w > width {\n\t\t\t\tif x == \"\" {\n\t\t\t\t\tresult = append(result, fields[i])\n\t\t\t\t\tx = \"\"\n\t\t\t\t\tcontinue\n\t\t\t\t} else {\n\t\t\t\t\tresult = append(result, x)\n\t\t\t\t\tx = \"\"\n\t\t\t\t}\n\t\t\t}\n\t\t\tx += fields[i] + fields[i+1]\n\t\t}\n\t\tif x != \"\" {\n\t\t\tresult = append(result, x)\n\t\t}\n\t}\n\tfor i, line := range result {\n\t\tresult[i] = strings.TrimSpace(line)\n\t}\n\treturn result\n}\n```\n\n## 需要注意的点\n\n### otf 字体文件加载\n\n前面的内容中，加载字体文件都使用的是 `LoadFontFace()` 方法进行的，但需要注意的是，这个方法只能加载 `ttf` 字体文件，也就是 `true type font`，无法加载 `otf` 字体文件，也就是 `open type font`。 所以如果需要加载 `otf` 字体文件，则需要换一个姿势。\n\n```go\nfunc getOpenTypeFontFace(fontFilePath string, fontSize, dpi float64)(*font.Face, error){\n\tfontData, fontFileReadErr := ioutil.ReadFile(fontFilePath)\n\tif fontFileReadErr != nil {\n\t\treturn nil, fontFileReadErr\n\t}\n\totfFont, parseErr := opentype.Parse(fontData)\n\tif parseErr != nil {\n\t\treturn nil, parseErr\n\t}\n\totfFace, newFaceErr := opentype.NewFace(otfFont, &opentype.FaceOptions{\n\t\tSize: fontSize,\n\t\tDPI:  dpi,\n\t})\n\tif newFaceErr != nil {\n\t\treturn nil, newFaceErr\n\t}\n\treturn &otfFace, nil\n}\n```\n\n来测试一下：\n\n```go\nfunc TestUseOtfFile(t *testing.T){\n\tfilePath := \"SourceHanSansCN-Bold-2.otf\"\n\tfontFace, err := getOpenTypeFontFace(filePath, 100, 82)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(0, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tdc.SetFontFace(*fontFace)\n\tdc.DrawStringWrapped(\"比如这是一段 很长很长很长 很长很长很长 的文字\", S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n![](6.png)\n\n### 行高的问题\n\n还有一个需要注意的问题，之前在开发时也踩过坑。`SetFontFace` 与 `LoadFontFace` 计算 `fontHeight` 时姿势不一样，所以导致设置同样的字体大小时，最终的字体高度却不一致。\n\n```go\nfunc (dc *Context) SetFontFace(fontFace font.Face) {\n\tdc.fontFace = fontFace\n\tdc.fontHeight = float64(fontFace.Metrics().Height) / 64\n}\n\nfunc (dc *Context) LoadFontFace(path string, points float64) error {\n\tface, err := LoadFontFace(path, points)\n\tif err == nil {\n\t\tdc.fontFace = face\n\t\tdc.fontHeight = points * 72 / 96\n\t}\n\treturn err\n}\n```\n\n可以看到对于行高的计算逻辑有着较大区别，我们可以用一个例子来简单验证一下：\n\n```go\nfunc TestUseOtfFile(t *testing.T){\n\tfilePath := \"/Users/bytedance/Downloads/font/方正楷体简体.ttf\"\n\tfontFace1, err := getOpenTypeFontFace(filePath, 100, 82)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(0, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tdc.SetFontFace(*fontFace1)\n\tdc.DrawStringWrapped(\"比如这是一段文字\", S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n\tif err := dc.LoadFontFace(\"/Users/bytedance/Downloads/font/方正楷体简体.ttf\", 100); err != nil {\n\t\tpanic(err)\n\t}\n\tdc.DrawStringWrapped(\"比如这是一段文字\", S/2, S/2 + 100, 0.5, 0.5, S, 1, gg.AlignCenter)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n![](7.png)\n\n可以看到，两行文字大小明显不一样。\n\n## 小结\n\n至此，关于文字绘制的相关内容就说完了。这两篇讲解了gg库中关于文字绘制相关的内容，相信对于文字绘制已经有了比较好的掌握。实践出真知，还是需要多改改多用用才知道是怎么一回事。在之后的一篇里，会根据前面的内容进行一个小小的实战应用，让我们的知识真正应用起来～\n\n如果本篇内容对你有帮助，别忘了点赞关注加收藏～","slug":"picture/go-draw-word-in-pic2","published":1,"updated":"2020-12-22T14:40:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfbd000m5ohu334rbmha","content":"<p>这一篇将继续介绍gg库中绘制文字相关的方法，主要包括：<code>DrawStringAnchored()</code>、<code>DrawStringWrapped()</code>、<code>MeasureMultilineString()</code>、<code>WordWrap()</code>下面来分别进行介绍。</p>\n<h2 id=\"DrawStringAnchored\"><a href=\"#DrawStringAnchored\" class=\"headerlink\" title=\"DrawStringAnchored\"></a>DrawStringAnchored</h2><p>如果不细究，可能会觉得这个方法是 <code>DrawString()</code> 方法的一个封装，但看看里面的实现就能发现，实际情况正好相反。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token comment\" spellcheck=\"true\">// DrawString draws the specified text at the specified point.</span>\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>Context<span class=\"token punctuation\">)</span> <span class=\"token function\">DrawString</span><span class=\"token punctuation\">(</span>s <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringAnchored</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">// DrawStringAnchored draws the specified text at the specified anchor point.</span>\n<span class=\"token comment\" spellcheck=\"true\">// The anchor point is x - w * ax, y - h * ay, where w, h is the size of the</span>\n<span class=\"token comment\" spellcheck=\"true\">// text. Use ax=0.5, ay=0.5 to center the text at the specified point.</span>\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>Context<span class=\"token punctuation\">)</span> <span class=\"token function\">DrawStringAnchored</span><span class=\"token punctuation\">(</span>s <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> ax<span class=\"token punctuation\">,</span> ay <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    w<span class=\"token punctuation\">,</span> h <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>\n    x <span class=\"token operator\">-=</span> ax <span class=\"token operator\">*</span> w\n    y <span class=\"token operator\">+=</span> ay <span class=\"token operator\">*</span> h\n    <span class=\"token keyword\">if</span> dc<span class=\"token punctuation\">.</span>mask <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        dc<span class=\"token punctuation\">.</span><span class=\"token function\">drawString</span><span class=\"token punctuation\">(</span>dc<span class=\"token punctuation\">.</span>im<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        im <span class=\"token operator\">:=</span> image<span class=\"token punctuation\">.</span><span class=\"token function\">NewRGBA</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span><span class=\"token function\">Rect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> dc<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> dc<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        dc<span class=\"token punctuation\">.</span><span class=\"token function\">drawString</span><span class=\"token punctuation\">(</span>im<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span>\n        draw<span class=\"token punctuation\">.</span><span class=\"token function\">DrawMask</span><span class=\"token punctuation\">(</span>dc<span class=\"token punctuation\">.</span>im<span class=\"token punctuation\">,</span> dc<span class=\"token punctuation\">.</span>im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> im<span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">.</span>ZP<span class=\"token punctuation\">,</span> dc<span class=\"token punctuation\">.</span>mask<span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">.</span>ZP<span class=\"token punctuation\">,</span> draw<span class=\"token punctuation\">.</span>Over<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><code>DrawStringAnchored()</code> 方法主要有5个参数，第一个参数是要绘制的字符串，后面四个参数共同决定了锚点的位置，具体计算逻辑是<code>(x - w * ax, y - h * ay)</code>，所以，当<code>ax</code>、<code>ay</code>设置为<code>0</code>时就是左对齐，此时锚点位置处于文字框左下角；设置为<code>0.5</code>时就是居中，此时锚点位置处于文字框正中央；设置为<code>1</code>时就是右对齐，此时锚点位置处于文字控右上角。</p>\n<p>我们来看下效果：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">TestDrawStringAnchored</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> S <span class=\"token operator\">=</span> <span class=\"token number\">1024</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gilmer-heavy.ttf\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">96</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringAnchored</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello, world!\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">FontHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringAnchored</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello, world!\"</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringAnchored</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello, world!\"</span><span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">,</span> S<span class=\"token operator\">-</span>dc<span class=\"token punctuation\">.</span><span class=\"token function\">FontHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><img src=\"1.png\" alt=\"\"></p>\n<p>这里需要注意的就是锚点的位置，当左对齐时，锚点在左下角，所以设置的 <code>(0, dc.FontHeight())</code>  代表的是文字框左下角的位置，同理，当居中对齐时，<code>(S/2, S/2)</code> 代表的是文字框中心点的位置，右对齐时，<code>(S, S-dc.FontHeight())</code> 代表的是文字框右上顶点的位置。</p>\n<h2 id=\"DrawStringWrapped\"><a href=\"#DrawStringWrapped\" class=\"headerlink\" title=\"DrawStringWrapped\"></a>DrawStringWrapped</h2><p>这个方法可以比较方便的绘制多行文字，还能自动折行，基本上相当于真正文字框的效果。</p>\n<p>先看个例子简单的熟悉一下：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">TestDrawStringWrapped</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> S <span class=\"token operator\">=</span> <span class=\"token number\">1024</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gilmer-heavy.ttf\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">96</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringWrapped</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello world! Hello Frank! Hello Alice!\"</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> gg<span class=\"token punctuation\">.</span>AlignCenter<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>绘制的效果如下：</p>\n<p><img src=\"2.png\" alt=\"\"></p>\n<p>可以看到，不仅自动换行，而且还保持了单词的完整性，没有将一个单词从中间分割开来。</p>\n<p>这个方法的参数有点多，一共有8个参数。</p>\n<p>第1个参数代表的是要绘制的字符串，比如这里的<code>Hello world! Hello Frank! Hello Alice!</code>。第6个参数代表文本框的宽度。第7个参数代表行间距。</p>\n<p>第2～5和第8个参数共同决定了锚点的位置。这里的计算比之前稍微复杂一点，让我们来看看里面的具体实现：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token comment\" spellcheck=\"true\">// DrawStringWrapped word-wraps the specified string to the given max width</span>\n<span class=\"token comment\" spellcheck=\"true\">// and then draws it at the specified anchor point using the given line</span>\n<span class=\"token comment\" spellcheck=\"true\">// spacing and text alignment.</span>\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>Context<span class=\"token punctuation\">)</span> <span class=\"token function\">DrawStringWrapped</span><span class=\"token punctuation\">(</span>s <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> ax<span class=\"token punctuation\">,</span> ay<span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> lineSpacing <span class=\"token builtin\">float64</span><span class=\"token punctuation\">,</span> align Align<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    lines <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">WordWrap</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// sync h formula with MeasureMultilineString</span>\n    h <span class=\"token operator\">:=</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>lines<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> dc<span class=\"token punctuation\">.</span>fontHeight <span class=\"token operator\">*</span> lineSpacing\n    h <span class=\"token operator\">-=</span> <span class=\"token punctuation\">(</span>lineSpacing <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> dc<span class=\"token punctuation\">.</span>fontHeight\n\n    x <span class=\"token operator\">-=</span> ax <span class=\"token operator\">*</span> width\n    y <span class=\"token operator\">-=</span> ay <span class=\"token operator\">*</span> h\n    <span class=\"token keyword\">switch</span> align <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> AlignLeft<span class=\"token punctuation\">:</span>\n        ax <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">case</span> AlignCenter<span class=\"token punctuation\">:</span>\n        ax <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span>\n        x <span class=\"token operator\">+=</span> width <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n    <span class=\"token keyword\">case</span> AlignRight<span class=\"token punctuation\">:</span>\n        ax <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n        x <span class=\"token operator\">+=</span> width\n    <span class=\"token punctuation\">}</span>\n    ay <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> line <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> lines <span class=\"token punctuation\">{</span>\n        dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringAnchored</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> ax<span class=\"token punctuation\">,</span> ay<span class=\"token punctuation\">)</span>\n        y <span class=\"token operator\">+=</span> dc<span class=\"token punctuation\">.</span>fontHeight <span class=\"token operator\">*</span> lineSpacing\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>首先通过 <code>WordWrap()</code> 方法来得到根据指定宽度处理过后的每一行需要展示的字符串信息。</p>\n<pre class=\" language-go\"><code class=\"language-go\">lines <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">WordWrap</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">)</span></code></pre>\n<p>然后计算行高，这里计算的时候是用行数乘以字体高度再乘以行间距，得到结果后再减去一个行间距。所以这个 <code>lineSpacing</code> 的含义是行间距相对于字体高度的倍数，当 <code>lineSpacing</code> 设置为1时，也就是行间距为0，设置为1.1时，代表行间距为字体高度的0.1倍。</p>\n<pre class=\" language-go\"><code class=\"language-go\">h <span class=\"token operator\">:=</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>lines<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> dc<span class=\"token punctuation\">.</span>fontHeight <span class=\"token operator\">*</span> lineSpacing\nh <span class=\"token operator\">-=</span> <span class=\"token punctuation\">(</span>lineSpacing <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> dc<span class=\"token punctuation\">.</span>fontHeight</code></pre>\n<p>然后是有点绕的计算。</p>\n<pre class=\" language-go\"><code class=\"language-go\">x <span class=\"token operator\">-=</span> ax <span class=\"token operator\">*</span> width\ny <span class=\"token operator\">-=</span> ay <span class=\"token operator\">*</span> h\n<span class=\"token keyword\">switch</span> align <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">case</span> AlignLeft<span class=\"token punctuation\">:</span>\n    ax <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">case</span> AlignCenter<span class=\"token punctuation\">:</span>\n    ax <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span>\n    x <span class=\"token operator\">+=</span> width <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n<span class=\"token keyword\">case</span> AlignRight<span class=\"token punctuation\">:</span>\n    ax <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    x <span class=\"token operator\">+=</span> width\n<span class=\"token punctuation\">}</span>\nay <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> line <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> lines <span class=\"token punctuation\">{</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringAnchored</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> ax<span class=\"token punctuation\">,</span> ay<span class=\"token punctuation\">)</span>\n    y <span class=\"token operator\">+=</span> dc<span class=\"token punctuation\">.</span>fontHeight <span class=\"token operator\">*</span> lineSpacing\n<span class=\"token punctuation\">}</span></code></pre>\n<p>可以看到，整体逻辑是先计算好首行文字的锚点位置，然后对处理过的每个字符串调用 <code>DrawStringAnchored()</code> 方法进行最终文字绘制。我们可以从下往上看，在循环绘制之前，先设置了 <code>ay = 1</code>，也就是说锚点的偏移位置会在每一行的顶部，然后我们来看这个<code>ax</code>：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">switch</span> align <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">case</span> AlignLeft<span class=\"token punctuation\">:</span>\n    ax <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">case</span> AlignCenter<span class=\"token punctuation\">:</span>\n    ax <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span>\n    x <span class=\"token operator\">+=</span> width <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n<span class=\"token keyword\">case</span> AlignRight<span class=\"token punctuation\">:</span>\n    ax <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    x <span class=\"token operator\">+=</span> width\n<span class=\"token punctuation\">}</span></code></pre>\n<p>根据传入的最后一个参数的不同值，<code>ax</code> 会设置为不同的值。当最后一个参数分别为 <code>AlignLeft</code>、<code>AlignCenter</code>、<code>AlignRight</code>时，<code>ax</code> 和 <code>ay</code> 的组合分别为：<code>(0,1)</code>、<code>(0.5,1)</code>、<code>(1,1)</code>，锚点相对于单行文字的位置分别为左上顶点、上中位置、右上顶点。</p>\n<p>然后我们再来看这个 <code>y</code> 的值：</p>\n<pre class=\" language-go\"><code class=\"language-go\">y <span class=\"token operator\">-=</span> ay <span class=\"token operator\">*</span> h</code></pre>\n<p><code>y</code> 的初始位置为传入的 <code>y</code> 值减去 <code>ay</code> (y轴偏移) 乘以整体文本框高度，代表的含义是初始锚点<code>(x,y)</code>相对于文本框的位置，分别传入<code>0</code>、<code>0.5</code>、<code>1</code>时分别代表锚点处于文本框的上边线、正中线和下边线上。在循环绘制文字时，<code>y</code> 的值也会不断调整，代表单行文字的锚点位置也在不断变化。</p>\n<pre class=\" language-go\"><code class=\"language-go\">y <span class=\"token operator\">+=</span> dc<span class=\"token punctuation\">.</span>fontHeight <span class=\"token operator\">*</span> lineSpacing</code></pre>\n<p>最后来看下 <code>x</code> 的值，初始值为初始锚点相对于传入的文本框宽度的相对位置，<code>ax</code> 分别为 <code>0</code>、<code>0.5</code>、<code>1</code> 时，分别代表初始锚点位于整体文本框的左边线、居中竖线和右边线上。</p>\n<pre class=\" language-go\"><code class=\"language-go\">x <span class=\"token operator\">-=</span> ax <span class=\"token operator\">*</span> width</code></pre>\n<p>根据传入的最后一个参数的不同，又会对x进行一次调整，这样调整之后，便能实现文字在文本框中左对齐、居中和右对齐的效果了。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">switch</span> align <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">case</span> AlignLeft<span class=\"token punctuation\">:</span>\n    ax <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">case</span> AlignCenter<span class=\"token punctuation\">:</span>\n    ax <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span>\n    x <span class=\"token operator\">+=</span> width <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n<span class=\"token keyword\">case</span> AlignRight<span class=\"token punctuation\">:</span>\n    ax <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    x <span class=\"token operator\">+=</span> width\n<span class=\"token punctuation\">}</span></code></pre>\n<p>看起来确实挺好用，不用再操心换行的事情了。但别高兴的太早，有一点需要注意。这个方法只会根据空格来分割字符串，如果字符串没有空格，就会变成只有一行文字的效果。</p>\n<pre class=\" language-go\"><code class=\"language-go\">dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringWrapped</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HelloWorld!HelloFrank!HelloAlice!\"</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> gg<span class=\"token punctuation\">.</span>AlignCenter<span class=\"token punctuation\">)</span></code></pre>\n<p><img src=\"3.png\" alt=\"\"></p>\n<p>你可能会觉得，英文单词之间都会有空格的嘛，应该不用担心，但如果是中文呢？</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/Users/bytedance/Downloads/font/方正楷体简体.ttf\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">96</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\ndc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringWrapped</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"如果我们把文字换成中文效果就没那么好了\"</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> gg<span class=\"token punctuation\">.</span>AlignCenter<span class=\"token punctuation\">)</span></code></pre>\n<p><img src=\"4.png\" alt=\"\"></p>\n<p>另外，这个方法不会限制文本框整体高度，所以如果文本很长，即使可能正确换行，仍旧会超出图片范围。</p>\n<pre class=\" language-go\"><code class=\"language-go\">dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringWrapped</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"比如这是一段很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 的文字\"</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> gg<span class=\"token punctuation\">.</span>AlignCenter<span class=\"token punctuation\">)</span></code></pre>\n<p><img src=\"5.png\" alt=\"\"></p>\n<p>另外，它是按照空格进行词元素分割的，所以不会从单词的中间进行拆分，这既是优点，也是缺点。因为如果有长单词的话，可能会导致提前换行，让某些行看起来比其它行短很多。所以要想精确控制，还是得用笨办法。</p>\n<h3 id=\"MeasureMultilineString\"><a href=\"#MeasureMultilineString\" class=\"headerlink\" title=\"MeasureMultilineString\"></a>MeasureMultilineString</h3><p><code>MeasureMultilineString()</code> 方法可以测量多行文本的整体高度和宽度，需要传入用换行符分割好的文本行字符串和行间距，里面的计算逻辑也很简单。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>Context<span class=\"token punctuation\">)</span> <span class=\"token function\">MeasureMultilineString</span><span class=\"token punctuation\">(</span>s <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> lineSpacing <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    lines <span class=\"token operator\">:=</span> strings<span class=\"token punctuation\">.</span><span class=\"token function\">Split</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// sync h formula with DrawStringWrapped</span>\n    height <span class=\"token operator\">=</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>lines<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> dc<span class=\"token punctuation\">.</span>fontHeight <span class=\"token operator\">*</span> lineSpacing\n    height <span class=\"token operator\">-=</span> <span class=\"token punctuation\">(</span>lineSpacing <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> dc<span class=\"token punctuation\">.</span>fontHeight\n\n    d <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>font<span class=\"token punctuation\">.</span>Drawer<span class=\"token punctuation\">{</span>\n        Face<span class=\"token punctuation\">:</span> dc<span class=\"token punctuation\">.</span>fontFace<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// max width from lines</span>\n    <span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> line <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> lines <span class=\"token punctuation\">{</span>\n        adv <span class=\"token operator\">:=</span> d<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n        currentWidth <span class=\"token operator\">:=</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>adv <span class=\"token operator\">>></span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token comment\" spellcheck=\"true\">// from gg.Context.MeasureString</span>\n        <span class=\"token keyword\">if</span> currentWidth <span class=\"token operator\">></span> width <span class=\"token punctuation\">{</span>\n            width <span class=\"token operator\">=</span> currentWidth\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> width<span class=\"token punctuation\">,</span> height\n<span class=\"token punctuation\">}</span></code></pre>\n<p>行高的计算跟上面<code>DrawStringWrapped()</code>方法是一样的：</p>\n<pre class=\" language-go\"><code class=\"language-go\">h <span class=\"token operator\">:=</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>lines<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> dc<span class=\"token punctuation\">.</span>fontHeight <span class=\"token operator\">*</span> lineSpacing\nh <span class=\"token operator\">-=</span> <span class=\"token punctuation\">(</span>lineSpacing <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> dc<span class=\"token punctuation\">.</span>fontHeight</code></pre>\n<p>宽度则是取这些文本行中宽度最大的那个。</p>\n<h3 id=\"WordWrap\"><a href=\"#WordWrap\" class=\"headerlink\" title=\"WordWrap\"></a>WordWrap</h3><p>这个方法是用来处理文本的，负责对文本根据指定宽度进行分行，在 <code>DrawStringWrapped()</code> 方法中已经有所调用。它内部是调用<code>wordWrap()</code>函数来实现的。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token comment\" spellcheck=\"true\">// WordWrap wraps the specified string to the given max width and current</span>\n<span class=\"token comment\" spellcheck=\"true\">// font face.</span>\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>Context<span class=\"token punctuation\">)</span> <span class=\"token function\">WordWrap</span><span class=\"token punctuation\">(</span>s <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> w <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">wordWrap</span><span class=\"token punctuation\">(</span>dc<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><code>wordWrap()</code> 函数做的事情便是先将文字按换行符分割，然后对每一个子字符串按空格进行分割，再通过一个元素一个元素的拼接来判断出适合当前行宽的最大字符串。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">wordWrap</span><span class=\"token punctuation\">(</span>m measureStringer<span class=\"token punctuation\">,</span> s <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> width <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> result <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">string</span>\n    <span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> line <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> strings<span class=\"token punctuation\">.</span><span class=\"token function\">Split</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        fields <span class=\"token operator\">:=</span> <span class=\"token function\">splitOnSpace</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>fields<span class=\"token punctuation\">)</span><span class=\"token operator\">%</span><span class=\"token number\">2</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">{</span>\n            fields <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>fields<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        x <span class=\"token operator\">:=</span> <span class=\"token string\">\"\"</span>\n        <span class=\"token keyword\">for</span> i <span class=\"token operator\">:=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>fields<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">{</span>\n            w<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> m<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">+</span> fields<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> w <span class=\"token operator\">></span> width <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> x <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">{</span>\n                    result <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> fields<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                    x <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\n                    <span class=\"token keyword\">continue</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                    result <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n                    x <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            x <span class=\"token operator\">+=</span> fields<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> fields<span class=\"token punctuation\">[</span>i<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> x <span class=\"token operator\">!=</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">{</span>\n            result <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> line <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> result <span class=\"token punctuation\">{</span>\n        result<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> strings<span class=\"token punctuation\">.</span><span class=\"token function\">TrimSpace</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> result\n<span class=\"token punctuation\">}</span></code></pre>\n<h2 id=\"需要注意的点\"><a href=\"#需要注意的点\" class=\"headerlink\" title=\"需要注意的点\"></a>需要注意的点</h2><h3 id=\"otf-字体文件加载\"><a href=\"#otf-字体文件加载\" class=\"headerlink\" title=\"otf 字体文件加载\"></a>otf 字体文件加载</h3><p>前面的内容中，加载字体文件都使用的是 <code>LoadFontFace()</code> 方法进行的，但需要注意的是，这个方法只能加载 <code>ttf</code> 字体文件，也就是 <code>true type font</code>，无法加载 <code>otf</code> 字体文件，也就是 <code>open type font</code>。 所以如果需要加载 <code>otf</code> 字体文件，则需要换一个姿势。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">getOpenTypeFontFace</span><span class=\"token punctuation\">(</span>fontFilePath <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> fontSize<span class=\"token punctuation\">,</span> dpi <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>font<span class=\"token punctuation\">.</span>Face<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    fontData<span class=\"token punctuation\">,</span> fontFileReadErr <span class=\"token operator\">:=</span> ioutil<span class=\"token punctuation\">.</span><span class=\"token function\">ReadFile</span><span class=\"token punctuation\">(</span>fontFilePath<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> fontFileReadErr <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> fontFileReadErr\n    <span class=\"token punctuation\">}</span>\n    otfFont<span class=\"token punctuation\">,</span> parseErr <span class=\"token operator\">:=</span> opentype<span class=\"token punctuation\">.</span><span class=\"token function\">Parse</span><span class=\"token punctuation\">(</span>fontData<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> parseErr <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> parseErr\n    <span class=\"token punctuation\">}</span>\n    otfFace<span class=\"token punctuation\">,</span> newFaceErr <span class=\"token operator\">:=</span> opentype<span class=\"token punctuation\">.</span><span class=\"token function\">NewFace</span><span class=\"token punctuation\">(</span>otfFont<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>opentype<span class=\"token punctuation\">.</span>FaceOptions<span class=\"token punctuation\">{</span>\n        Size<span class=\"token punctuation\">:</span> fontSize<span class=\"token punctuation\">,</span>\n        DPI<span class=\"token punctuation\">:</span>  dpi<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> newFaceErr <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> newFaceErr\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&amp;</span>otfFace<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>来测试一下：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">TestUseOtfFile</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    filePath <span class=\"token operator\">:=</span> <span class=\"token string\">\"SourceHanSansCN-Bold-2.otf\"</span>\n    fontFace<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> <span class=\"token function\">getOpenTypeFontFace</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">82</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> S <span class=\"token operator\">=</span> <span class=\"token number\">1024</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetFontFace</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>fontFace<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringWrapped</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"比如这是一段 很长很长很长 很长很长很长 的文字\"</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> gg<span class=\"token punctuation\">.</span>AlignCenter<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><img src=\"6.png\" alt=\"\"></p>\n<h3 id=\"行高的问题\"><a href=\"#行高的问题\" class=\"headerlink\" title=\"行高的问题\"></a>行高的问题</h3><p>还有一个需要注意的问题，之前在开发时也踩过坑。<code>SetFontFace</code> 与 <code>LoadFontFace</code> 计算 <code>fontHeight</code> 时姿势不一样，所以导致设置同样的字体大小时，最终的字体高度却不一致。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>Context<span class=\"token punctuation\">)</span> <span class=\"token function\">SetFontFace</span><span class=\"token punctuation\">(</span>fontFace font<span class=\"token punctuation\">.</span>Face<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    dc<span class=\"token punctuation\">.</span>fontFace <span class=\"token operator\">=</span> fontFace\n    dc<span class=\"token punctuation\">.</span>fontHeight <span class=\"token operator\">=</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>fontFace<span class=\"token punctuation\">.</span><span class=\"token function\">Metrics</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Height<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">64</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>Context<span class=\"token punctuation\">)</span> <span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span>path <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> points <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">error</span> <span class=\"token punctuation\">{</span>\n    face<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> <span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> points<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        dc<span class=\"token punctuation\">.</span>fontFace <span class=\"token operator\">=</span> face\n        dc<span class=\"token punctuation\">.</span>fontHeight <span class=\"token operator\">=</span> points <span class=\"token operator\">*</span> <span class=\"token number\">72</span> <span class=\"token operator\">/</span> <span class=\"token number\">96</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> err\n<span class=\"token punctuation\">}</span></code></pre>\n<p>可以看到对于行高的计算逻辑有着较大区别，我们可以用一个例子来简单验证一下：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">TestUseOtfFile</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    filePath <span class=\"token operator\">:=</span> <span class=\"token string\">\"/Users/bytedance/Downloads/font/方正楷体简体.ttf\"</span>\n    fontFace1<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> <span class=\"token function\">getOpenTypeFontFace</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">82</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> S <span class=\"token operator\">=</span> <span class=\"token number\">1024</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetFontFace</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>fontFace1<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringWrapped</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"比如这是一段文字\"</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> gg<span class=\"token punctuation\">.</span>AlignCenter<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/Users/bytedance/Downloads/font/方正楷体简体.ttf\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringWrapped</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"比如这是一段文字\"</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span> <span class=\"token operator\">+</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> gg<span class=\"token punctuation\">.</span>AlignCenter<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><img src=\"7.png\" alt=\"\"></p>\n<p>可以看到，两行文字大小明显不一样。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>至此，关于文字绘制的相关内容就说完了。这两篇讲解了gg库中关于文字绘制相关的内容，相信对于文字绘制已经有了比较好的掌握。实践出真知，还是需要多改改多用用才知道是怎么一回事。在之后的一篇里，会根据前面的内容进行一个小小的实战应用，让我们的知识真正应用起来～</p>\n<p>如果本篇内容对你有帮助，别忘了点赞关注加收藏～</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<p>这一篇将继续介绍gg库中绘制文字相关的方法，主要包括：<code>DrawStringAnchored()</code>、<code>DrawStringWrapped()</code>、<code>MeasureMultilineString()</code>、<code>WordWrap()</code>下面来分别进行介绍。</p>\n<h2 id=\"DrawStringAnchored\"><a href=\"#DrawStringAnchored\" class=\"headerlink\" title=\"DrawStringAnchored\"></a>DrawStringAnchored</h2><p>如果不细究，可能会觉得这个方法是 <code>DrawString()</code> 方法的一个封装，但看看里面的实现就能发现，实际情况正好相反。</p>\n<pre><code class=\"go\">// DrawString draws the specified text at the specified point.\nfunc (dc *Context) DrawString(s string, x, y float64) {\n    dc.DrawStringAnchored(s, x, y, 0, 0)\n}\n\n// DrawStringAnchored draws the specified text at the specified anchor point.\n// The anchor point is x - w * ax, y - h * ay, where w, h is the size of the\n// text. Use ax=0.5, ay=0.5 to center the text at the specified point.\nfunc (dc *Context) DrawStringAnchored(s string, x, y, ax, ay float64) {\n    w, h := dc.MeasureString(s)\n    x -= ax * w\n    y += ay * h\n    if dc.mask == nil {\n        dc.drawString(dc.im, s, x, y)\n    } else {\n        im := image.NewRGBA(image.Rect(0, 0, dc.width, dc.height))\n        dc.drawString(im, s, x, y)\n        draw.DrawMask(dc.im, dc.im.Bounds(), im, image.ZP, dc.mask, image.ZP, draw.Over)\n    }\n}</code></pre>\n<p><code>DrawStringAnchored()</code> 方法主要有5个参数，第一个参数是要绘制的字符串，后面四个参数共同决定了锚点的位置，具体计算逻辑是<code>(x - w * ax, y - h * ay)</code>，所以，当<code>ax</code>、<code>ay</code>设置为<code>0</code>时就是左对齐，此时锚点位置处于文字框左下角；设置为<code>0.5</code>时就是居中，此时锚点位置处于文字框正中央；设置为<code>1</code>时就是右对齐，此时锚点位置处于文字控右上角。</p>\n<p>我们来看下效果：</p>\n<pre><code class=\"go\">func TestDrawStringAnchored(t *testing.T){\n    const S = 1024\n    dc := gg.NewContext(S, S)\n    dc.SetRGB(1, 1, 1)\n    dc.Clear()\n    dc.SetRGB(0, 0, 0)\n    if err := dc.LoadFontFace(&quot;gilmer-heavy.ttf&quot;, 96); err != nil {\n        panic(err)\n    }\n    dc.DrawStringAnchored(&quot;Hello, world!&quot;, 0, dc.FontHeight(), 0, 0)\n    dc.DrawStringAnchored(&quot;Hello, world!&quot;, S/2, S/2, 0.5, 0.5)\n    dc.DrawStringAnchored(&quot;Hello, world!&quot;, S, S-dc.FontHeight(), 1, 1)\n    dc.SavePNG(&quot;out.png&quot;)\n}</code></pre>\n<p><img src=\"1.png\" alt=\"\"></p>\n<p>这里需要注意的就是锚点的位置，当左对齐时，锚点在左下角，所以设置的 <code>(0, dc.FontHeight())</code>  代表的是文字框左下角的位置，同理，当居中对齐时，<code>(S/2, S/2)</code> 代表的是文字框中心点的位置，右对齐时，<code>(S, S-dc.FontHeight())</code> 代表的是文字框右上顶点的位置。</p>\n<h2 id=\"DrawStringWrapped\"><a href=\"#DrawStringWrapped\" class=\"headerlink\" title=\"DrawStringWrapped\"></a>DrawStringWrapped</h2><p>这个方法可以比较方便的绘制多行文字，还能自动折行，基本上相当于真正文字框的效果。</p>\n<p>先看个例子简单的熟悉一下：</p>\n<pre><code class=\"go\">func TestDrawStringWrapped(t *testing.T){\n    const S = 1024\n    dc := gg.NewContext(S, S)\n    dc.SetRGB(1, 1, 1)\n    dc.Clear()\n    dc.SetRGB(0, 0, 0)\n    if err := dc.LoadFontFace(&quot;gilmer-heavy.ttf&quot;, 96); err != nil {\n        panic(err)\n    }\n    dc.DrawStringWrapped(&quot;Hello world! Hello Frank! Hello Alice!&quot;, S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n    dc.SavePNG(&quot;out.png&quot;)\n}</code></pre>\n<p>绘制的效果如下：</p>\n<p><img src=\"2.png\" alt=\"\"></p>\n<p>可以看到，不仅自动换行，而且还保持了单词的完整性，没有将一个单词从中间分割开来。</p>\n<p>这个方法的参数有点多，一共有8个参数。</p>\n<p>第1个参数代表的是要绘制的字符串，比如这里的<code>Hello world! Hello Frank! Hello Alice!</code>。第6个参数代表文本框的宽度。第7个参数代表行间距。</p>\n<p>第2～5和第8个参数共同决定了锚点的位置。这里的计算比之前稍微复杂一点，让我们来看看里面的具体实现：</p>\n<pre><code class=\"go\">// DrawStringWrapped word-wraps the specified string to the given max width\n// and then draws it at the specified anchor point using the given line\n// spacing and text alignment.\nfunc (dc *Context) DrawStringWrapped(s string, x, y, ax, ay, width, lineSpacing float64, align Align) {\n    lines := dc.WordWrap(s, width)\n\n    // sync h formula with MeasureMultilineString\n    h := float64(len(lines)) * dc.fontHeight * lineSpacing\n    h -= (lineSpacing - 1) * dc.fontHeight\n\n    x -= ax * width\n    y -= ay * h\n    switch align {\n    case AlignLeft:\n        ax = 0\n    case AlignCenter:\n        ax = 0.5\n        x += width / 2\n    case AlignRight:\n        ax = 1\n        x += width\n    }\n    ay = 1\n    for _, line := range lines {\n        dc.DrawStringAnchored(line, x, y, ax, ay)\n        y += dc.fontHeight * lineSpacing\n    }\n}</code></pre>\n<p>首先通过 <code>WordWrap()</code> 方法来得到根据指定宽度处理过后的每一行需要展示的字符串信息。</p>\n<pre><code class=\"go\">lines := dc.WordWrap(s, width)</code></pre>\n<p>然后计算行高，这里计算的时候是用行数乘以字体高度再乘以行间距，得到结果后再减去一个行间距。所以这个 <code>lineSpacing</code> 的含义是行间距相对于字体高度的倍数，当 <code>lineSpacing</code> 设置为1时，也就是行间距为0，设置为1.1时，代表行间距为字体高度的0.1倍。</p>\n<pre><code class=\"go\">h := float64(len(lines)) * dc.fontHeight * lineSpacing\nh -= (lineSpacing - 1) * dc.fontHeight</code></pre>\n<p>然后是有点绕的计算。</p>\n<pre><code class=\"go\">x -= ax * width\ny -= ay * h\nswitch align {\ncase AlignLeft:\n    ax = 0\ncase AlignCenter:\n    ax = 0.5\n    x += width / 2\ncase AlignRight:\n    ax = 1\n    x += width\n}\nay = 1\nfor _, line := range lines {\n    dc.DrawStringAnchored(line, x, y, ax, ay)\n    y += dc.fontHeight * lineSpacing\n}</code></pre>\n<p>可以看到，整体逻辑是先计算好首行文字的锚点位置，然后对处理过的每个字符串调用 <code>DrawStringAnchored()</code> 方法进行最终文字绘制。我们可以从下往上看，在循环绘制之前，先设置了 <code>ay = 1</code>，也就是说锚点的偏移位置会在每一行的顶部，然后我们来看这个<code>ax</code>：</p>\n<pre><code class=\"go\">switch align {\ncase AlignLeft:\n    ax = 0\ncase AlignCenter:\n    ax = 0.5\n    x += width / 2\ncase AlignRight:\n    ax = 1\n    x += width\n}</code></pre>\n<p>根据传入的最后一个参数的不同值，<code>ax</code> 会设置为不同的值。当最后一个参数分别为 <code>AlignLeft</code>、<code>AlignCenter</code>、<code>AlignRight</code>时，<code>ax</code> 和 <code>ay</code> 的组合分别为：<code>(0,1)</code>、<code>(0.5,1)</code>、<code>(1,1)</code>，锚点相对于单行文字的位置分别为左上顶点、上中位置、右上顶点。</p>\n<p>然后我们再来看这个 <code>y</code> 的值：</p>\n<pre><code class=\"go\">y -= ay * h</code></pre>\n<p><code>y</code> 的初始位置为传入的 <code>y</code> 值减去 <code>ay</code> (y轴偏移) 乘以整体文本框高度，代表的含义是初始锚点<code>(x,y)</code>相对于文本框的位置，分别传入<code>0</code>、<code>0.5</code>、<code>1</code>时分别代表锚点处于文本框的上边线、正中线和下边线上。在循环绘制文字时，<code>y</code> 的值也会不断调整，代表单行文字的锚点位置也在不断变化。</p>\n<pre><code class=\"go\">y += dc.fontHeight * lineSpacing</code></pre>\n<p>最后来看下 <code>x</code> 的值，初始值为初始锚点相对于传入的文本框宽度的相对位置，<code>ax</code> 分别为 <code>0</code>、<code>0.5</code>、<code>1</code> 时，分别代表初始锚点位于整体文本框的左边线、居中竖线和右边线上。</p>\n<pre><code class=\"go\">x -= ax * width</code></pre>\n<p>根据传入的最后一个参数的不同，又会对x进行一次调整，这样调整之后，便能实现文字在文本框中左对齐、居中和右对齐的效果了。</p>\n<pre><code class=\"go\">switch align {\ncase AlignLeft:\n    ax = 0\ncase AlignCenter:\n    ax = 0.5\n    x += width / 2\ncase AlignRight:\n    ax = 1\n    x += width\n}</code></pre>\n<p>看起来确实挺好用，不用再操心换行的事情了。但别高兴的太早，有一点需要注意。这个方法只会根据空格来分割字符串，如果字符串没有空格，就会变成只有一行文字的效果。</p>\n<pre><code class=\"go\">dc.DrawStringWrapped(&quot;HelloWorld!HelloFrank!HelloAlice!&quot;, S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)</code></pre>\n<p><img src=\"3.png\" alt=\"\"></p>\n<p>你可能会觉得，英文单词之间都会有空格的嘛，应该不用担心，但如果是中文呢？</p>\n<pre><code class=\"go\">if err := dc.LoadFontFace(&quot;/Users/bytedance/Downloads/font/方正楷体简体.ttf&quot;, 96); err != nil {\n    panic(err)\n}\ndc.DrawStringWrapped(&quot;如果我们把文字换成中文效果就没那么好了&quot;, S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)</code></pre>\n<p><img src=\"4.png\" alt=\"\"></p>\n<p>另外，这个方法不会限制文本框整体高度，所以如果文本很长，即使可能正确换行，仍旧会超出图片范围。</p>\n<pre><code class=\"go\">dc.DrawStringWrapped(&quot;比如这是一段很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 很长很长很长很长很长 的文字&quot;, S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)</code></pre>\n<p><img src=\"5.png\" alt=\"\"></p>\n<p>另外，它是按照空格进行词元素分割的，所以不会从单词的中间进行拆分，这既是优点，也是缺点。因为如果有长单词的话，可能会导致提前换行，让某些行看起来比其它行短很多。所以要想精确控制，还是得用笨办法。</p>\n<h3 id=\"MeasureMultilineString\"><a href=\"#MeasureMultilineString\" class=\"headerlink\" title=\"MeasureMultilineString\"></a>MeasureMultilineString</h3><p><code>MeasureMultilineString()</code> 方法可以测量多行文本的整体高度和宽度，需要传入用换行符分割好的文本行字符串和行间距，里面的计算逻辑也很简单。</p>\n<pre><code class=\"go\">func (dc *Context) MeasureMultilineString(s string, lineSpacing float64) (width, height float64) {\n    lines := strings.Split(s, &quot;\\n&quot;)\n\n    // sync h formula with DrawStringWrapped\n    height = float64(len(lines)) * dc.fontHeight * lineSpacing\n    height -= (lineSpacing - 1) * dc.fontHeight\n\n    d := &amp;font.Drawer{\n        Face: dc.fontFace,\n    }\n\n    // max width from lines\n    for _, line := range lines {\n        adv := d.MeasureString(line)\n        currentWidth := float64(adv &gt;&gt; 6) // from gg.Context.MeasureString\n        if currentWidth &gt; width {\n            width = currentWidth\n        }\n    }\n\n    return width, height\n}</code></pre>\n<p>行高的计算跟上面<code>DrawStringWrapped()</code>方法是一样的：</p>\n<pre><code class=\"go\">h := float64(len(lines)) * dc.fontHeight * lineSpacing\nh -= (lineSpacing - 1) * dc.fontHeight</code></pre>\n<p>宽度则是取这些文本行中宽度最大的那个。</p>\n<h3 id=\"WordWrap\"><a href=\"#WordWrap\" class=\"headerlink\" title=\"WordWrap\"></a>WordWrap</h3><p>这个方法是用来处理文本的，负责对文本根据指定宽度进行分行，在 <code>DrawStringWrapped()</code> 方法中已经有所调用。它内部是调用<code>wordWrap()</code>函数来实现的。</p>\n<pre><code class=\"go\">// WordWrap wraps the specified string to the given max width and current\n// font face.\nfunc (dc *Context) WordWrap(s string, w float64) []string {\n    return wordWrap(dc, s, w)\n}</code></pre>\n<p><code>wordWrap()</code> 函数做的事情便是先将文字按换行符分割，然后对每一个子字符串按空格进行分割，再通过一个元素一个元素的拼接来判断出适合当前行宽的最大字符串。</p>\n<pre><code class=\"go\">func wordWrap(m measureStringer, s string, width float64) []string {\n    var result []string\n    for _, line := range strings.Split(s, &quot;\\n&quot;) {\n        fields := splitOnSpace(line)\n        if len(fields)%2 == 1 {\n            fields = append(fields, &quot;&quot;)\n        }\n        x := &quot;&quot;\n        for i := 0; i &lt; len(fields); i += 2 {\n            w, _ := m.MeasureString(x + fields[i])\n            if w &gt; width {\n                if x == &quot;&quot; {\n                    result = append(result, fields[i])\n                    x = &quot;&quot;\n                    continue\n                } else {\n                    result = append(result, x)\n                    x = &quot;&quot;\n                }\n            }\n            x += fields[i] + fields[i+1]\n        }\n        if x != &quot;&quot; {\n            result = append(result, x)\n        }\n    }\n    for i, line := range result {\n        result[i] = strings.TrimSpace(line)\n    }\n    return result\n}</code></pre>\n<h2 id=\"需要注意的点\"><a href=\"#需要注意的点\" class=\"headerlink\" title=\"需要注意的点\"></a>需要注意的点</h2><h3 id=\"otf-字体文件加载\"><a href=\"#otf-字体文件加载\" class=\"headerlink\" title=\"otf 字体文件加载\"></a>otf 字体文件加载</h3><p>前面的内容中，加载字体文件都使用的是 <code>LoadFontFace()</code> 方法进行的，但需要注意的是，这个方法只能加载 <code>ttf</code> 字体文件，也就是 <code>true type font</code>，无法加载 <code>otf</code> 字体文件，也就是 <code>open type font</code>。 所以如果需要加载 <code>otf</code> 字体文件，则需要换一个姿势。</p>\n<pre><code class=\"go\">func getOpenTypeFontFace(fontFilePath string, fontSize, dpi float64)(*font.Face, error){\n    fontData, fontFileReadErr := ioutil.ReadFile(fontFilePath)\n    if fontFileReadErr != nil {\n        return nil, fontFileReadErr\n    }\n    otfFont, parseErr := opentype.Parse(fontData)\n    if parseErr != nil {\n        return nil, parseErr\n    }\n    otfFace, newFaceErr := opentype.NewFace(otfFont, &amp;opentype.FaceOptions{\n        Size: fontSize,\n        DPI:  dpi,\n    })\n    if newFaceErr != nil {\n        return nil, newFaceErr\n    }\n    return &amp;otfFace, nil\n}</code></pre>\n<p>来测试一下：</p>\n<pre><code class=\"go\">func TestUseOtfFile(t *testing.T){\n    filePath := &quot;SourceHanSansCN-Bold-2.otf&quot;\n    fontFace, err := getOpenTypeFontFace(filePath, 100, 82)\n    if err != nil {\n        panic(err)\n    }\n\n    const S = 1024\n    dc := gg.NewContext(S, S)\n    dc.SetRGB(0, 1, 1)\n    dc.Clear()\n    dc.SetRGB(0, 0, 0)\n    dc.SetFontFace(*fontFace)\n    dc.DrawStringWrapped(&quot;比如这是一段 很长很长很长 很长很长很长 的文字&quot;, S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n    dc.SavePNG(&quot;out.png&quot;)\n}</code></pre>\n<p><img src=\"6.png\" alt=\"\"></p>\n<h3 id=\"行高的问题\"><a href=\"#行高的问题\" class=\"headerlink\" title=\"行高的问题\"></a>行高的问题</h3><p>还有一个需要注意的问题，之前在开发时也踩过坑。<code>SetFontFace</code> 与 <code>LoadFontFace</code> 计算 <code>fontHeight</code> 时姿势不一样，所以导致设置同样的字体大小时，最终的字体高度却不一致。</p>\n<pre><code class=\"go\">func (dc *Context) SetFontFace(fontFace font.Face) {\n    dc.fontFace = fontFace\n    dc.fontHeight = float64(fontFace.Metrics().Height) / 64\n}\n\nfunc (dc *Context) LoadFontFace(path string, points float64) error {\n    face, err := LoadFontFace(path, points)\n    if err == nil {\n        dc.fontFace = face\n        dc.fontHeight = points * 72 / 96\n    }\n    return err\n}</code></pre>\n<p>可以看到对于行高的计算逻辑有着较大区别，我们可以用一个例子来简单验证一下：</p>\n<pre><code class=\"go\">func TestUseOtfFile(t *testing.T){\n    filePath := &quot;/Users/bytedance/Downloads/font/方正楷体简体.ttf&quot;\n    fontFace1, err := getOpenTypeFontFace(filePath, 100, 82)\n    if err != nil {\n        panic(err)\n    }\n\n    const S = 1024\n    dc := gg.NewContext(S, S)\n    dc.SetRGB(0, 1, 1)\n    dc.Clear()\n    dc.SetRGB(0, 0, 0)\n    dc.SetFontFace(*fontFace1)\n    dc.DrawStringWrapped(&quot;比如这是一段文字&quot;, S/2, S/2, 0.5, 0.5, S, 1, gg.AlignCenter)\n    if err := dc.LoadFontFace(&quot;/Users/bytedance/Downloads/font/方正楷体简体.ttf&quot;, 100); err != nil {\n        panic(err)\n    }\n    dc.DrawStringWrapped(&quot;比如这是一段文字&quot;, S/2, S/2 + 100, 0.5, 0.5, S, 1, gg.AlignCenter)\n    dc.SavePNG(&quot;out.png&quot;)\n}</code></pre>\n<p><img src=\"7.png\" alt=\"\"></p>\n<p>可以看到，两行文字大小明显不一样。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>至此，关于文字绘制的相关内容就说完了。这两篇讲解了gg库中关于文字绘制相关的内容，相信对于文字绘制已经有了比较好的掌握。实践出真知，还是需要多改改多用用才知道是怎么一回事。在之后的一篇里，会根据前面的内容进行一个小小的实战应用，让我们的知识真正应用起来～</p>\n<p>如果本篇内容对你有帮助，别忘了点赞关注加收藏～</p>\n"},{"title":"【Go语言绘图】图片添加文字（一）","toc":true,"cover":true,"date":"2020-12-20T14:45:35.000Z","_content":"\n前一篇讲解了利用gg包来进行图片旋转的操作，这一篇我们来看看怎么在图片上添加文字。\n\n## 绘制纯色背景\n\n首先，我们先绘制一个纯白色的背景，作为添加文字的背景板。\n\n```go\npackage main\n\nimport \"github.com/fogleman/gg\"\n\nfunc main() {\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(0, 1, 1)\n\tdc.Clear()\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n输出图片如下：\n\n![](1.png)\n\n这样我就得到了一张纯青色的背景图。回顾一下上一篇里绘制背景图的步骤：\n\n```go\nfunc TestRotateImage(t *testing.T) {\n\twidth := 1000\n\theight := 1000\n\n\tdc := gg.NewContext(width, height)\n\tdc.DrawRectangle(0, 0, float64(width), float64(width))\n\tdc.SetRGB255(255, 255, 0)\n\tdc.Fill()\n\tdc.SavePNG(\"test.png\")\n}\n```\n\n我们是通过先绘制跟画布同样大小的矩形，然后将它的颜色进行填充来实现纯色背景效果的，但实际上使用 `Clear()` 方法便能直接使用当前颜色对画布进行填充。\n\n查看一下 `Clear()` 方法便能发现，里面是通过调用 `draw.Draw()` 函数来实现的，这也是go语言自带的 `image` 包里很有用的一个函数，后面会有文章来做更详细的介绍。简单来说，`Clear()` 方法是通过调用`draw.Draw()` 函数，通过将纯色图片覆盖到原画布的方式来实现纯色背景的效果的。\n\n```go\n// Clear fills the entire image with the current color.\nfunc (dc *Context) Clear() {\n\tsrc := image.NewUniform(dc.color)\n\tdraw.Draw(dc.im, dc.im.Bounds(), src, image.ZP, draw.Src)\n}\n```\n\n## 添加文字\n\n背景板已经准备就绪，接下来，我们来添加一些文字。\n\n```go\npackage main\n\nimport \"github.com/fogleman/gg\"\n\nfunc main() {\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(0, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 120); err != nil {\n\t\tpanic(err)\n\t}\n\tdc.DrawString(\"Hello, world!\", 0, S/2)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n输出如下，一个硕大、黑色的“Hello, World!”就出现在了图片中央。\n\n![](2.png)\n\n这里我们添加了三个步骤，首先是设置了字体颜色为黑色。\n\n```go\ndc.SetRGB(0, 0, 0)\n```\n\n然后加载了字体文件，这里需要注意的是，通过 `LoadFontFace()` 方法加载的字体文件只支持 `ttf` 后缀的文件，也就是 `true type font`，\n\n```go\nif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 120); err != nil {\n    panic(err)\n}\n```\n\n里面的实现也比较简单：\n\n```go\nfunc (dc *Context) LoadFontFace(path string, points float64) error {\n\tface, err := LoadFontFace(path, points)\n\tif err == nil {\n\t\tdc.fontFace = face\n\t\tdc.fontHeight = points * 72 / 96\n\t}\n\treturn err\n}\n```\n\n内部调用了 `LoadFontFace()` 函数，在这个函数内部进行了字体文件读取，并用 `freetype` 包里的`Parse()`函数进行字体的加载，最后在调用 `NewFace()` 函数来创建一个 `font.Face` 对象，在外面的`LoadFontFace()`方法里，将这个对象保存在 `fontFace` 字段中，并且根据传入的`point`大小设置了一下字体高度。\n\n至于为什么是乘以`72`然后除以`96`，这个查了一下资料，简单的说，字体的大小单位磅(`points`) 是`1/72`逻辑英寸，屏幕的分辨率是`96DPI`（96点每逻辑英寸），那么屏幕每个点就是`72/96`=`0.75`磅。\n\n```go\nfunc LoadFontFace(path string, points float64) (font.Face, error) {\n\tfontBytes, err := ioutil.ReadFile(path)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tf, err := truetype.Parse(fontBytes)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tface := truetype.NewFace(f, &truetype.Options{\n\t\tSize: points,\n\t\t// Hinting: font.HintingFull,\n\t})\n\treturn face, nil\n}\n```\n\n### 调整字体大小\n\n如果想调整字体大小，也很简单，只需要调整`LoadFontFace()` 方法传入的值即可，让我们来调大一点字体看看效果。\n\n```go\nif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 240); err != nil {\n    panic(err)\n}\n```\n\n![](3.png)\n\n这样就大很多了。不知道聪明的你注意到了没有，在调用`dc.DrawString(\"Hello, world!\", 0, S/2)`时，我们设置的坐标是 `(0, S/2)` ，也就是左侧边的正中心点，**这个位置刚好是绘制出来的文字的左下角的坐标**，这是需要注意的一点。\n\n### 居中显示\n\n如果想要文字居中显示怎么办呢？比如我们想要这个 `Hello,World!` 显示在图片的正中央，要怎么处理呢？一个笨办法当然是通过调整字体位置来实现这个效果，让我们先来试试：\n\n```go\nif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 120); err != nil {\n    panic(err)\n}\ndc.DrawString(\"Hello, world!\", 130, S/2)\n```\n\n![](4.png)\n\n通过多次调整，字体大小设置为`120`时，`x`的位置设置为`130`，基本上可以看起来是居中的。但这样的话每次换文字都得反复调整位置，显然不科学。\n\n别慌，有一个方法可以得到文字的宽度，`MeasureString()` 可以得到在当前字体下指定字符串的宽度和高度，这个高度其实就是前面通过 `points * 72 / 96` 计算得到的，然后我们再将左下角的位置设置为`((S-sWidth)/2, (S+sHeight)/2)`即可实现文字居中的效果，注意y轴坐标是`(S+sHeight)/2`，因为文字的左上顶点位置y轴坐标应该是`(S-sHeight)/2`，左下顶点坐标只需要再加上字体高度即可得出。\n\n```go\ns := \"Hello, world!\"\nsWidth, sHeight := dc.MeasureString(s)\ndc.DrawString(s, (S-sWidth)/2, (S+sHeight)/2)\n```\n\n![](5.png)\n\n这样看来，居中显示也不过如此嘛。但别高兴的太早，有没有想过，如果文字过长该怎么处理？比如我们来调整一下文字内容，再看下生成的效果。\n\n```go\ns := \"Hello,world! Hello,ByteDancer!\"\n```\n\n![](6.png)\n\n文字已经超出边界了，显然不是理想的效果，这个时候有两种处理方法，一种是添加省略号，一种是换行。\n\n### 单行长文本处理\n\n先来说一下添加省略号的处理方案，听起来好像挺简单，但实际上处理起来也挺麻烦的。\n\n首先需要确定一个文字展示的最大宽度，因为如果满打满算整行都塞满文字显然不好看。其次是要逐个字符进行宽度计算，并判断是否会超过最大宽度，最后截取并保留刚好小于最大宽度时的字符串（需要考虑省略号的宽度）。\n\n我们来逐个处理。首先拍脑袋定一个文字最大宽度为图片宽度的`0.75`倍。\n\n```go\nmaxTextWidth := S * 0.75\n```\n\n然后来逐个字符计算宽度，直到刚好大于最大宽度为止。\n\n```go\nfunc TruncateText(dc *gg.Context, originalText string, maxTextWidth float64) string {\n\ttmpStr := \"\"\n\tfor i := 0; i < len(originalText); i++ {\n\t\ttmpStr = tmpStr + string(originalText[i])\n\t\tw, _ := dc.MeasureString(tmpStr)\n\t\tif w > maxTextWidth {\n\t\t\treturn tmpStr[0 : i-1]\n\t\t}\n\t}\n\treturn tmpStr\n}\n```\n\n然后我们调整一下调用的地方。\n\n```go\nfunc main() {\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(0, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 120); err != nil {\n\t\tpanic(err)\n\t}\n\ts := \"Hello,world! Hello,ByteDancer!\"\n\tellipsisWidth, _ := dc.MeasureString(\"...\")\n\tmaxTextWidth := S * 0.75\n\ts = TruncateText(dc, s, maxTextWidth - ellipsisWidth) + \"...\"\n\tfmt.Println(s)\n\tsWidth, sHeight := dc.MeasureString(s)\n\n\tdc.DrawString(s, (S-sWidth)/2, (S+sHeight)/2)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n这里我们先计算了省略号的宽度，然后用最大字符串宽度减去省略号宽度作为最大宽度传入，得到最终要展示的字符串。生成的效果如下：\n\n![](7.png)\n\n看起来好像没什么毛病，但如果我们把文字换成中文，情况可能就不一样了。我们换一个中文字体，然后把字符串设置成中文。\n\n```go\nif err := dc.LoadFontFace(\"方正楷体简体.ttf\", 120); err != nil {\n    panic(err)\n}\ns := \"如果我们把文字换成中文\"\n```\n\n就变成了这个样子。\n\n![](8.png)\n\n发现图片上只剩下了省略号，原因是中文字符串分割不正确导致出现了乱码，而这个乱码在字体里找不到对应的文字，所以无法展示。这时，需要先将字符串先转化为`rune`数组，或者通过直接对字符串使用 `for range` 遍历，可以避免在中文的情况出现乱码的情况。\n\n```go\nfunc TruncateText(dc *gg.Context, originalText string, maxTextWidth float64) string {\n\ttmpStr := \"\"\n\tresult := make([]rune, 0)\n\tfor _, r := range originalText {\n\t\ttmpStr = tmpStr + string(r)\n\t\tw, _ := dc.MeasureString(tmpStr)\n\t\tif w > maxTextWidth {\n\t\t\tif len(tmpStr) <= 1 {\n\t\t\t\treturn \"\"\n\t\t\t} else {\n\t\t\t\tbreak\n\t\t\t}\n\t\t} else {\n\t\t\tresult = append(result, r)\n\t\t}\n\t}\n\treturn string(result)\n}\n```\n\n这样文字就能按照我们的预期进行展示了。\n\n![](9.png)\n\n### 多行文本处理\n\n接下来，我们来看看怎么处理多行文本，即当一行文字展示不下时，把文字切割成多行进行展示。如果我们仍旧使用之前的方法来处理的话，就需要先计算好每行展示的字以及行数，然后再进行展示。\n\n```go\npackage main\n\nimport (\n\t\"github.com/fogleman/gg\"\n\t\"strings\"\n)\n\nfunc main() {\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(0, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tif err := dc.LoadFontFace(\"/Users/bytedance/Downloads/方正楷体简体.ttf\", 120); err != nil {\n\t\tpanic(err)\n\t}\n\ts := \"这是我的一个秘密，再简单不过的秘密：一个人只有用心去看，才能看到真实。事情的真相只用眼睛是看不见的。        --《小王子》\"\n\tellipsisWidth, _ := dc.MeasureString(\"...\")\n\n\tmaxTextWidth := S * 0.9\n\tlineSpace := 25.0\n\tmaxLine := int(S / (dc.FontHeight() + lineSpace))\n\n\tline := 0\n\tlineTexts := make([]string, 0)\n\tfor len(s) > 0 {\n\t\tline++\n\t\tif line > maxLine {\n\t\t\tbreak\n\t\t}\n\t\tif line == maxLine {\n\t\t\tsw, _ := dc.MeasureString(s)\n\t\t\tif sw > maxTextWidth {\n\t\t\t\tmaxTextWidth -= ellipsisWidth\n\t\t\t}\n\t\t}\n\t\tlineText := TruncateText(dc, s, maxTextWidth)\n\t\tif line == maxLine && len(lineText) < len(s) {\n\t\t\tlineText += \"...\"\n\t\t}\n\t\tlineTexts = append(lineTexts, lineText)\n\t\tif len(lineText) >= len(s) {\n\t\t\tbreak\n\t\t}\n\t\ts = s[len(lineText):]\n\t}\n\n\tlineY := (S - dc.FontHeight()*float64(len(lineTexts)) - lineSpace*float64(len(lineTexts)-1)) / 2\n\tlineY += dc.FontHeight()\n\tfor _, text := range lineTexts {\n\t\tsWidth, _ := dc.MeasureString(text)\n\t\tlineX := (S - sWidth) / 2\n\t\tdc.DrawString(text, lineX, lineY)\n\t\tlineY += dc.FontHeight() + lineSpace\n\t}\n\n\tdc.SavePNG(\"out.png\")\n}\n\nfunc TruncateText(dc *gg.Context, originalText string, maxTextWidth float64) string {\n\ttmpStr := \"\"\n\tresult := make([]rune, 0)\n\tfor _, r := range originalText {\n\t\ttmpStr = tmpStr + string(r)\n\t\tw, _ := dc.MeasureString(tmpStr)\n\t\tif w > maxTextWidth {\n\t\t\tif len(tmpStr) <= 1 {\n\t\t\t\treturn \"\"\n\t\t\t} else {\n\t\t\t\tbreak\n\t\t\t}\n\t\t} else {\n\t\t\tresult = append(result, r)\n\t\t}\n\t}\n\treturn string(result)\n}\n```\n\n这段逻辑其实也很简单，首先根据行高和行间距计算出当前图片最多能展示多少行字，然后遍历需要展示的字符串进行逐行截取，截取出一行行的文字来。\n\n遍历时有一个小细节，那就是判断是否已经到达最后一行，如果到达最后一行，则要考虑是否添加省略号了。\n\n```go\n//如果已经是最后一行，则需要判断剩余字符串是否仍旧超过最大宽度\nif line == maxLine {\n    sw, _ := dc.MeasureString(s)\n    // 如果超过则需要在末尾添加省略号，截取的最大宽度需要减去省略号的宽度\n    if sw > maxTextWidth {\n        maxTextWidth -= ellipsisWidth\n    }\n}\nlineText := TruncateText(dc, s, maxTextWidth)\n// 如果是最后一行并且文字仍旧是被截取过，那么在末尾添加省略号\nif line == maxLine && len(lineText) < len(s) {\n    lineText += \"...\"\n}\n```\n\n在绘制文本时，先考虑整个文本框的左上顶点位置，因为需要居中展示，每一行的宽度是变化的，X轴坐标是不确定的，但是Y轴坐标是可以先计算出来的，因为每一行的高度和行间距我们都已经知道了。整个文本框的高度就是`dc.FontHeight()*float64(len(lineTexts)) - lineSpace*float64(len(lineTexts)-1))` ，用图片高度减去文本框高度再除以2，就能得到左上顶点高度了。\n\n```go\nlineY := (S - dc.FontHeight()*float64(len(lineTexts)) - lineSpace*float64(len(lineTexts)-1)) / 2\n```\n\n然后开始逐行绘制文字，计算每一行的左下顶点X轴和Y轴坐标即可。\n\n```go\nlineY += dc.FontHeight()\nfor _, text := range lineTexts {\n    sWidth, _ := dc.MeasureString(text)\n    lineX := (S - sWidth) / 2\n    dc.DrawString(text, lineX, lineY)\n    lineY += dc.FontHeight() + lineSpace\n}\n```\n\n最后的效果如下图：\n\n![](10.png)\n\n这样虽然实现了效果，但是显然有些太过复杂，我们还能再简化一下这个过程。\n\n在gg库中，还有两个方法可以绘制文字，`DrawStringAnchored()` 和 `DrawStringWrapped()`。前者可以在指定一个点为偏移起点。后者则类似于一个文本框的效果，可以指定文本框中心点和文本框宽度，这些将在下一篇中进行介绍。\n\n这里的处理没有考虑原文本中有换行符的情况，所以其实还不够完善，在处理时可以先对文本进行换行符分割，然后再依次进行上述处理。\n\n## 小结\n\n这一篇中，主要讲解了如何在纯色背景图上进行文字的绘制，说明了 `DrawString()` 方法和 `MeasureString()` 的使用，并利用它们来实现了文字居中的效果。在下一篇中，将对通过另外几个方法的讲解来了解文字绘制的更多技巧。\n\n如果本篇内容对你有帮助，别忘了点赞关注加收藏～\n","source":"_posts/picture/go-draw-word-in-pic.md","raw":"---\ntitle: 【Go语言绘图】图片添加文字（一）\ntags:\n  - go\ncategories:\n  - 编程\ntoc: true\ncover: true\ndate: 2020-12-20 22:45:35\n---\n\n前一篇讲解了利用gg包来进行图片旋转的操作，这一篇我们来看看怎么在图片上添加文字。\n\n## 绘制纯色背景\n\n首先，我们先绘制一个纯白色的背景，作为添加文字的背景板。\n\n```go\npackage main\n\nimport \"github.com/fogleman/gg\"\n\nfunc main() {\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(0, 1, 1)\n\tdc.Clear()\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n输出图片如下：\n\n![](1.png)\n\n这样我就得到了一张纯青色的背景图。回顾一下上一篇里绘制背景图的步骤：\n\n```go\nfunc TestRotateImage(t *testing.T) {\n\twidth := 1000\n\theight := 1000\n\n\tdc := gg.NewContext(width, height)\n\tdc.DrawRectangle(0, 0, float64(width), float64(width))\n\tdc.SetRGB255(255, 255, 0)\n\tdc.Fill()\n\tdc.SavePNG(\"test.png\")\n}\n```\n\n我们是通过先绘制跟画布同样大小的矩形，然后将它的颜色进行填充来实现纯色背景效果的，但实际上使用 `Clear()` 方法便能直接使用当前颜色对画布进行填充。\n\n查看一下 `Clear()` 方法便能发现，里面是通过调用 `draw.Draw()` 函数来实现的，这也是go语言自带的 `image` 包里很有用的一个函数，后面会有文章来做更详细的介绍。简单来说，`Clear()` 方法是通过调用`draw.Draw()` 函数，通过将纯色图片覆盖到原画布的方式来实现纯色背景的效果的。\n\n```go\n// Clear fills the entire image with the current color.\nfunc (dc *Context) Clear() {\n\tsrc := image.NewUniform(dc.color)\n\tdraw.Draw(dc.im, dc.im.Bounds(), src, image.ZP, draw.Src)\n}\n```\n\n## 添加文字\n\n背景板已经准备就绪，接下来，我们来添加一些文字。\n\n```go\npackage main\n\nimport \"github.com/fogleman/gg\"\n\nfunc main() {\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(0, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 120); err != nil {\n\t\tpanic(err)\n\t}\n\tdc.DrawString(\"Hello, world!\", 0, S/2)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n输出如下，一个硕大、黑色的“Hello, World!”就出现在了图片中央。\n\n![](2.png)\n\n这里我们添加了三个步骤，首先是设置了字体颜色为黑色。\n\n```go\ndc.SetRGB(0, 0, 0)\n```\n\n然后加载了字体文件，这里需要注意的是，通过 `LoadFontFace()` 方法加载的字体文件只支持 `ttf` 后缀的文件，也就是 `true type font`，\n\n```go\nif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 120); err != nil {\n    panic(err)\n}\n```\n\n里面的实现也比较简单：\n\n```go\nfunc (dc *Context) LoadFontFace(path string, points float64) error {\n\tface, err := LoadFontFace(path, points)\n\tif err == nil {\n\t\tdc.fontFace = face\n\t\tdc.fontHeight = points * 72 / 96\n\t}\n\treturn err\n}\n```\n\n内部调用了 `LoadFontFace()` 函数，在这个函数内部进行了字体文件读取，并用 `freetype` 包里的`Parse()`函数进行字体的加载，最后在调用 `NewFace()` 函数来创建一个 `font.Face` 对象，在外面的`LoadFontFace()`方法里，将这个对象保存在 `fontFace` 字段中，并且根据传入的`point`大小设置了一下字体高度。\n\n至于为什么是乘以`72`然后除以`96`，这个查了一下资料，简单的说，字体的大小单位磅(`points`) 是`1/72`逻辑英寸，屏幕的分辨率是`96DPI`（96点每逻辑英寸），那么屏幕每个点就是`72/96`=`0.75`磅。\n\n```go\nfunc LoadFontFace(path string, points float64) (font.Face, error) {\n\tfontBytes, err := ioutil.ReadFile(path)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tf, err := truetype.Parse(fontBytes)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tface := truetype.NewFace(f, &truetype.Options{\n\t\tSize: points,\n\t\t// Hinting: font.HintingFull,\n\t})\n\treturn face, nil\n}\n```\n\n### 调整字体大小\n\n如果想调整字体大小，也很简单，只需要调整`LoadFontFace()` 方法传入的值即可，让我们来调大一点字体看看效果。\n\n```go\nif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 240); err != nil {\n    panic(err)\n}\n```\n\n![](3.png)\n\n这样就大很多了。不知道聪明的你注意到了没有，在调用`dc.DrawString(\"Hello, world!\", 0, S/2)`时，我们设置的坐标是 `(0, S/2)` ，也就是左侧边的正中心点，**这个位置刚好是绘制出来的文字的左下角的坐标**，这是需要注意的一点。\n\n### 居中显示\n\n如果想要文字居中显示怎么办呢？比如我们想要这个 `Hello,World!` 显示在图片的正中央，要怎么处理呢？一个笨办法当然是通过调整字体位置来实现这个效果，让我们先来试试：\n\n```go\nif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 120); err != nil {\n    panic(err)\n}\ndc.DrawString(\"Hello, world!\", 130, S/2)\n```\n\n![](4.png)\n\n通过多次调整，字体大小设置为`120`时，`x`的位置设置为`130`，基本上可以看起来是居中的。但这样的话每次换文字都得反复调整位置，显然不科学。\n\n别慌，有一个方法可以得到文字的宽度，`MeasureString()` 可以得到在当前字体下指定字符串的宽度和高度，这个高度其实就是前面通过 `points * 72 / 96` 计算得到的，然后我们再将左下角的位置设置为`((S-sWidth)/2, (S+sHeight)/2)`即可实现文字居中的效果，注意y轴坐标是`(S+sHeight)/2`，因为文字的左上顶点位置y轴坐标应该是`(S-sHeight)/2`，左下顶点坐标只需要再加上字体高度即可得出。\n\n```go\ns := \"Hello, world!\"\nsWidth, sHeight := dc.MeasureString(s)\ndc.DrawString(s, (S-sWidth)/2, (S+sHeight)/2)\n```\n\n![](5.png)\n\n这样看来，居中显示也不过如此嘛。但别高兴的太早，有没有想过，如果文字过长该怎么处理？比如我们来调整一下文字内容，再看下生成的效果。\n\n```go\ns := \"Hello,world! Hello,ByteDancer!\"\n```\n\n![](6.png)\n\n文字已经超出边界了，显然不是理想的效果，这个时候有两种处理方法，一种是添加省略号，一种是换行。\n\n### 单行长文本处理\n\n先来说一下添加省略号的处理方案，听起来好像挺简单，但实际上处理起来也挺麻烦的。\n\n首先需要确定一个文字展示的最大宽度，因为如果满打满算整行都塞满文字显然不好看。其次是要逐个字符进行宽度计算，并判断是否会超过最大宽度，最后截取并保留刚好小于最大宽度时的字符串（需要考虑省略号的宽度）。\n\n我们来逐个处理。首先拍脑袋定一个文字最大宽度为图片宽度的`0.75`倍。\n\n```go\nmaxTextWidth := S * 0.75\n```\n\n然后来逐个字符计算宽度，直到刚好大于最大宽度为止。\n\n```go\nfunc TruncateText(dc *gg.Context, originalText string, maxTextWidth float64) string {\n\ttmpStr := \"\"\n\tfor i := 0; i < len(originalText); i++ {\n\t\ttmpStr = tmpStr + string(originalText[i])\n\t\tw, _ := dc.MeasureString(tmpStr)\n\t\tif w > maxTextWidth {\n\t\t\treturn tmpStr[0 : i-1]\n\t\t}\n\t}\n\treturn tmpStr\n}\n```\n\n然后我们调整一下调用的地方。\n\n```go\nfunc main() {\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(0, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tif err := dc.LoadFontFace(\"gilmer-heavy.ttf\", 120); err != nil {\n\t\tpanic(err)\n\t}\n\ts := \"Hello,world! Hello,ByteDancer!\"\n\tellipsisWidth, _ := dc.MeasureString(\"...\")\n\tmaxTextWidth := S * 0.75\n\ts = TruncateText(dc, s, maxTextWidth - ellipsisWidth) + \"...\"\n\tfmt.Println(s)\n\tsWidth, sHeight := dc.MeasureString(s)\n\n\tdc.DrawString(s, (S-sWidth)/2, (S+sHeight)/2)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n这里我们先计算了省略号的宽度，然后用最大字符串宽度减去省略号宽度作为最大宽度传入，得到最终要展示的字符串。生成的效果如下：\n\n![](7.png)\n\n看起来好像没什么毛病，但如果我们把文字换成中文，情况可能就不一样了。我们换一个中文字体，然后把字符串设置成中文。\n\n```go\nif err := dc.LoadFontFace(\"方正楷体简体.ttf\", 120); err != nil {\n    panic(err)\n}\ns := \"如果我们把文字换成中文\"\n```\n\n就变成了这个样子。\n\n![](8.png)\n\n发现图片上只剩下了省略号，原因是中文字符串分割不正确导致出现了乱码，而这个乱码在字体里找不到对应的文字，所以无法展示。这时，需要先将字符串先转化为`rune`数组，或者通过直接对字符串使用 `for range` 遍历，可以避免在中文的情况出现乱码的情况。\n\n```go\nfunc TruncateText(dc *gg.Context, originalText string, maxTextWidth float64) string {\n\ttmpStr := \"\"\n\tresult := make([]rune, 0)\n\tfor _, r := range originalText {\n\t\ttmpStr = tmpStr + string(r)\n\t\tw, _ := dc.MeasureString(tmpStr)\n\t\tif w > maxTextWidth {\n\t\t\tif len(tmpStr) <= 1 {\n\t\t\t\treturn \"\"\n\t\t\t} else {\n\t\t\t\tbreak\n\t\t\t}\n\t\t} else {\n\t\t\tresult = append(result, r)\n\t\t}\n\t}\n\treturn string(result)\n}\n```\n\n这样文字就能按照我们的预期进行展示了。\n\n![](9.png)\n\n### 多行文本处理\n\n接下来，我们来看看怎么处理多行文本，即当一行文字展示不下时，把文字切割成多行进行展示。如果我们仍旧使用之前的方法来处理的话，就需要先计算好每行展示的字以及行数，然后再进行展示。\n\n```go\npackage main\n\nimport (\n\t\"github.com/fogleman/gg\"\n\t\"strings\"\n)\n\nfunc main() {\n\tconst S = 1024\n\tdc := gg.NewContext(S, S)\n\tdc.SetRGB(0, 1, 1)\n\tdc.Clear()\n\tdc.SetRGB(0, 0, 0)\n\tif err := dc.LoadFontFace(\"/Users/bytedance/Downloads/方正楷体简体.ttf\", 120); err != nil {\n\t\tpanic(err)\n\t}\n\ts := \"这是我的一个秘密，再简单不过的秘密：一个人只有用心去看，才能看到真实。事情的真相只用眼睛是看不见的。        --《小王子》\"\n\tellipsisWidth, _ := dc.MeasureString(\"...\")\n\n\tmaxTextWidth := S * 0.9\n\tlineSpace := 25.0\n\tmaxLine := int(S / (dc.FontHeight() + lineSpace))\n\n\tline := 0\n\tlineTexts := make([]string, 0)\n\tfor len(s) > 0 {\n\t\tline++\n\t\tif line > maxLine {\n\t\t\tbreak\n\t\t}\n\t\tif line == maxLine {\n\t\t\tsw, _ := dc.MeasureString(s)\n\t\t\tif sw > maxTextWidth {\n\t\t\t\tmaxTextWidth -= ellipsisWidth\n\t\t\t}\n\t\t}\n\t\tlineText := TruncateText(dc, s, maxTextWidth)\n\t\tif line == maxLine && len(lineText) < len(s) {\n\t\t\tlineText += \"...\"\n\t\t}\n\t\tlineTexts = append(lineTexts, lineText)\n\t\tif len(lineText) >= len(s) {\n\t\t\tbreak\n\t\t}\n\t\ts = s[len(lineText):]\n\t}\n\n\tlineY := (S - dc.FontHeight()*float64(len(lineTexts)) - lineSpace*float64(len(lineTexts)-1)) / 2\n\tlineY += dc.FontHeight()\n\tfor _, text := range lineTexts {\n\t\tsWidth, _ := dc.MeasureString(text)\n\t\tlineX := (S - sWidth) / 2\n\t\tdc.DrawString(text, lineX, lineY)\n\t\tlineY += dc.FontHeight() + lineSpace\n\t}\n\n\tdc.SavePNG(\"out.png\")\n}\n\nfunc TruncateText(dc *gg.Context, originalText string, maxTextWidth float64) string {\n\ttmpStr := \"\"\n\tresult := make([]rune, 0)\n\tfor _, r := range originalText {\n\t\ttmpStr = tmpStr + string(r)\n\t\tw, _ := dc.MeasureString(tmpStr)\n\t\tif w > maxTextWidth {\n\t\t\tif len(tmpStr) <= 1 {\n\t\t\t\treturn \"\"\n\t\t\t} else {\n\t\t\t\tbreak\n\t\t\t}\n\t\t} else {\n\t\t\tresult = append(result, r)\n\t\t}\n\t}\n\treturn string(result)\n}\n```\n\n这段逻辑其实也很简单，首先根据行高和行间距计算出当前图片最多能展示多少行字，然后遍历需要展示的字符串进行逐行截取，截取出一行行的文字来。\n\n遍历时有一个小细节，那就是判断是否已经到达最后一行，如果到达最后一行，则要考虑是否添加省略号了。\n\n```go\n//如果已经是最后一行，则需要判断剩余字符串是否仍旧超过最大宽度\nif line == maxLine {\n    sw, _ := dc.MeasureString(s)\n    // 如果超过则需要在末尾添加省略号，截取的最大宽度需要减去省略号的宽度\n    if sw > maxTextWidth {\n        maxTextWidth -= ellipsisWidth\n    }\n}\nlineText := TruncateText(dc, s, maxTextWidth)\n// 如果是最后一行并且文字仍旧是被截取过，那么在末尾添加省略号\nif line == maxLine && len(lineText) < len(s) {\n    lineText += \"...\"\n}\n```\n\n在绘制文本时，先考虑整个文本框的左上顶点位置，因为需要居中展示，每一行的宽度是变化的，X轴坐标是不确定的，但是Y轴坐标是可以先计算出来的，因为每一行的高度和行间距我们都已经知道了。整个文本框的高度就是`dc.FontHeight()*float64(len(lineTexts)) - lineSpace*float64(len(lineTexts)-1))` ，用图片高度减去文本框高度再除以2，就能得到左上顶点高度了。\n\n```go\nlineY := (S - dc.FontHeight()*float64(len(lineTexts)) - lineSpace*float64(len(lineTexts)-1)) / 2\n```\n\n然后开始逐行绘制文字，计算每一行的左下顶点X轴和Y轴坐标即可。\n\n```go\nlineY += dc.FontHeight()\nfor _, text := range lineTexts {\n    sWidth, _ := dc.MeasureString(text)\n    lineX := (S - sWidth) / 2\n    dc.DrawString(text, lineX, lineY)\n    lineY += dc.FontHeight() + lineSpace\n}\n```\n\n最后的效果如下图：\n\n![](10.png)\n\n这样虽然实现了效果，但是显然有些太过复杂，我们还能再简化一下这个过程。\n\n在gg库中，还有两个方法可以绘制文字，`DrawStringAnchored()` 和 `DrawStringWrapped()`。前者可以在指定一个点为偏移起点。后者则类似于一个文本框的效果，可以指定文本框中心点和文本框宽度，这些将在下一篇中进行介绍。\n\n这里的处理没有考虑原文本中有换行符的情况，所以其实还不够完善，在处理时可以先对文本进行换行符分割，然后再依次进行上述处理。\n\n## 小结\n\n这一篇中，主要讲解了如何在纯色背景图上进行文字的绘制，说明了 `DrawString()` 方法和 `MeasureString()` 的使用，并利用它们来实现了文字居中的效果。在下一篇中，将对通过另外几个方法的讲解来了解文字绘制的更多技巧。\n\n如果本篇内容对你有帮助，别忘了点赞关注加收藏～\n","slug":"picture/go-draw-word-in-pic","published":1,"updated":"2020-12-20T14:45:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfbf000q5ohu7jjx94bs","content":"<p>前一篇讲解了利用gg包来进行图片旋转的操作，这一篇我们来看看怎么在图片上添加文字。</p>\n<h2 id=\"绘制纯色背景\"><a href=\"#绘制纯色背景\" class=\"headerlink\" title=\"绘制纯色背景\"></a>绘制纯色背景</h2><p>首先，我们先绘制一个纯白色的背景，作为添加文字的背景板。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"github.com/fogleman/gg\"</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> S <span class=\"token operator\">=</span> <span class=\"token number\">1024</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>输出图片如下：</p>\n<p><img src=\"1.png\" alt=\"\"></p>\n<p>这样我就得到了一张纯青色的背景图。回顾一下上一篇里绘制背景图的步骤：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">TestRotateImage</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    width <span class=\"token operator\">:=</span> <span class=\"token number\">1000</span>\n    height <span class=\"token operator\">:=</span> <span class=\"token number\">1000</span>\n\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawRectangle</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB255</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>我们是通过先绘制跟画布同样大小的矩形，然后将它的颜色进行填充来实现纯色背景效果的，但实际上使用 <code>Clear()</code> 方法便能直接使用当前颜色对画布进行填充。</p>\n<p>查看一下 <code>Clear()</code> 方法便能发现，里面是通过调用 <code>draw.Draw()</code> 函数来实现的，这也是go语言自带的 <code>image</code> 包里很有用的一个函数，后面会有文章来做更详细的介绍。简单来说，<code>Clear()</code> 方法是通过调用<code>draw.Draw()</code> 函数，通过将纯色图片覆盖到原画布的方式来实现纯色背景的效果的。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token comment\" spellcheck=\"true\">// Clear fills the entire image with the current color.</span>\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>Context<span class=\"token punctuation\">)</span> <span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    src <span class=\"token operator\">:=</span> image<span class=\"token punctuation\">.</span><span class=\"token function\">NewUniform</span><span class=\"token punctuation\">(</span>dc<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">)</span>\n    draw<span class=\"token punctuation\">.</span><span class=\"token function\">Draw</span><span class=\"token punctuation\">(</span>dc<span class=\"token punctuation\">.</span>im<span class=\"token punctuation\">,</span> dc<span class=\"token punctuation\">.</span>im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> src<span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">.</span>ZP<span class=\"token punctuation\">,</span> draw<span class=\"token punctuation\">.</span>Src<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<h2 id=\"添加文字\"><a href=\"#添加文字\" class=\"headerlink\" title=\"添加文字\"></a>添加文字</h2><p>背景板已经准备就绪，接下来，我们来添加一些文字。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"github.com/fogleman/gg\"</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> S <span class=\"token operator\">=</span> <span class=\"token number\">1024</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gilmer-heavy.ttf\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello, world!\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>输出如下，一个硕大、黑色的“Hello, World!”就出现在了图片中央。</p>\n<p><img src=\"2.png\" alt=\"\"></p>\n<p>这里我们添加了三个步骤，首先是设置了字体颜色为黑色。</p>\n<pre class=\" language-go\"><code class=\"language-go\">dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></code></pre>\n<p>然后加载了字体文件，这里需要注意的是，通过 <code>LoadFontFace()</code> 方法加载的字体文件只支持 <code>ttf</code> 后缀的文件，也就是 <code>true type font</code>，</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gilmer-heavy.ttf\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>里面的实现也比较简单：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>Context<span class=\"token punctuation\">)</span> <span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span>path <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> points <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">error</span> <span class=\"token punctuation\">{</span>\n    face<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> <span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> points<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        dc<span class=\"token punctuation\">.</span>fontFace <span class=\"token operator\">=</span> face\n        dc<span class=\"token punctuation\">.</span>fontHeight <span class=\"token operator\">=</span> points <span class=\"token operator\">*</span> <span class=\"token number\">72</span> <span class=\"token operator\">/</span> <span class=\"token number\">96</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> err\n<span class=\"token punctuation\">}</span></code></pre>\n<p>内部调用了 <code>LoadFontFace()</code> 函数，在这个函数内部进行了字体文件读取，并用 <code>freetype</code> 包里的<code>Parse()</code>函数进行字体的加载，最后在调用 <code>NewFace()</code> 函数来创建一个 <code>font.Face</code> 对象，在外面的<code>LoadFontFace()</code>方法里，将这个对象保存在 <code>fontFace</code> 字段中，并且根据传入的<code>point</code>大小设置了一下字体高度。</p>\n<p>至于为什么是乘以<code>72</code>然后除以<code>96</code>，这个查了一下资料，简单的说，字体的大小单位磅(<code>points</code>) 是<code>1/72</code>逻辑英寸，屏幕的分辨率是<code>96DPI</code>（96点每逻辑英寸），那么屏幕每个点就是<code>72/96</code>=<code>0.75</code>磅。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span>path <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> points <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>font<span class=\"token punctuation\">.</span>Face<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    fontBytes<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> ioutil<span class=\"token punctuation\">.</span><span class=\"token function\">ReadFile</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> err\n    <span class=\"token punctuation\">}</span>\n    f<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> truetype<span class=\"token punctuation\">.</span><span class=\"token function\">Parse</span><span class=\"token punctuation\">(</span>fontBytes<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> err\n    <span class=\"token punctuation\">}</span>\n    face <span class=\"token operator\">:=</span> truetype<span class=\"token punctuation\">.</span><span class=\"token function\">NewFace</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>truetype<span class=\"token punctuation\">.</span>Options<span class=\"token punctuation\">{</span>\n        Size<span class=\"token punctuation\">:</span> points<span class=\"token punctuation\">,</span>\n        <span class=\"token comment\" spellcheck=\"true\">// Hinting: font.HintingFull,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> face<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<h3 id=\"调整字体大小\"><a href=\"#调整字体大小\" class=\"headerlink\" title=\"调整字体大小\"></a>调整字体大小</h3><p>如果想调整字体大小，也很简单，只需要调整<code>LoadFontFace()</code> 方法传入的值即可，让我们来调大一点字体看看效果。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gilmer-heavy.ttf\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">240</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><img src=\"3.png\" alt=\"\"></p>\n<p>这样就大很多了。不知道聪明的你注意到了没有，在调用<code>dc.DrawString(\"Hello, world!\", 0, S/2)</code>时，我们设置的坐标是 <code>(0, S/2)</code> ，也就是左侧边的正中心点，<strong>这个位置刚好是绘制出来的文字的左下角的坐标</strong>，这是需要注意的一点。</p>\n<h3 id=\"居中显示\"><a href=\"#居中显示\" class=\"headerlink\" title=\"居中显示\"></a>居中显示</h3><p>如果想要文字居中显示怎么办呢？比如我们想要这个 <code>Hello,World!</code> 显示在图片的正中央，要怎么处理呢？一个笨办法当然是通过调整字体位置来实现这个效果，让我们先来试试：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gilmer-heavy.ttf\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\ndc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello, world!\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">130</span><span class=\"token punctuation\">,</span> S<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></code></pre>\n<p><img src=\"4.png\" alt=\"\"></p>\n<p>通过多次调整，字体大小设置为<code>120</code>时，<code>x</code>的位置设置为<code>130</code>，基本上可以看起来是居中的。但这样的话每次换文字都得反复调整位置，显然不科学。</p>\n<p>别慌，有一个方法可以得到文字的宽度，<code>MeasureString()</code> 可以得到在当前字体下指定字符串的宽度和高度，这个高度其实就是前面通过 <code>points * 72 / 96</code> 计算得到的，然后我们再将左下角的位置设置为<code>((S-sWidth)/2, (S+sHeight)/2)</code>即可实现文字居中的效果，注意y轴坐标是<code>(S+sHeight)/2</code>，因为文字的左上顶点位置y轴坐标应该是<code>(S-sHeight)/2</code>，左下顶点坐标只需要再加上字体高度即可得出。</p>\n<pre class=\" language-go\"><code class=\"language-go\">s <span class=\"token operator\">:=</span> <span class=\"token string\">\"Hello, world!\"</span>\nsWidth<span class=\"token punctuation\">,</span> sHeight <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>\ndc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawString</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>S<span class=\"token operator\">-</span>sWidth<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>S<span class=\"token operator\">+</span>sHeight<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></code></pre>\n<p><img src=\"5.png\" alt=\"\"></p>\n<p>这样看来，居中显示也不过如此嘛。但别高兴的太早，有没有想过，如果文字过长该怎么处理？比如我们来调整一下文字内容，再看下生成的效果。</p>\n<pre class=\" language-go\"><code class=\"language-go\">s <span class=\"token operator\">:=</span> <span class=\"token string\">\"Hello,world! Hello,ByteDancer!\"</span></code></pre>\n<p><img src=\"6.png\" alt=\"\"></p>\n<p>文字已经超出边界了，显然不是理想的效果，这个时候有两种处理方法，一种是添加省略号，一种是换行。</p>\n<h3 id=\"单行长文本处理\"><a href=\"#单行长文本处理\" class=\"headerlink\" title=\"单行长文本处理\"></a>单行长文本处理</h3><p>先来说一下添加省略号的处理方案，听起来好像挺简单，但实际上处理起来也挺麻烦的。</p>\n<p>首先需要确定一个文字展示的最大宽度，因为如果满打满算整行都塞满文字显然不好看。其次是要逐个字符进行宽度计算，并判断是否会超过最大宽度，最后截取并保留刚好小于最大宽度时的字符串（需要考虑省略号的宽度）。</p>\n<p>我们来逐个处理。首先拍脑袋定一个文字最大宽度为图片宽度的<code>0.75</code>倍。</p>\n<pre class=\" language-go\"><code class=\"language-go\">maxTextWidth <span class=\"token operator\">:=</span> S <span class=\"token operator\">*</span> <span class=\"token number\">0.75</span></code></pre>\n<p>然后来逐个字符计算宽度，直到刚好大于最大宽度为止。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">TruncateText</span><span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>gg<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> originalText <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> maxTextWidth <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    tmpStr <span class=\"token operator\">:=</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token operator\">:=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>originalText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span> <span class=\"token punctuation\">{</span>\n        tmpStr <span class=\"token operator\">=</span> tmpStr <span class=\"token operator\">+</span> <span class=\"token function\">string</span><span class=\"token punctuation\">(</span>originalText<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        w<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span>tmpStr<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> w <span class=\"token operator\">></span> maxTextWidth <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> tmpStr<span class=\"token punctuation\">[</span><span class=\"token number\">0</span> <span class=\"token punctuation\">:</span> i<span class=\"token number\">-1</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> tmpStr\n<span class=\"token punctuation\">}</span></code></pre>\n<p>然后我们调整一下调用的地方。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> S <span class=\"token operator\">=</span> <span class=\"token number\">1024</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gilmer-heavy.ttf\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    s <span class=\"token operator\">:=</span> <span class=\"token string\">\"Hello,world! Hello,ByteDancer!\"</span>\n    ellipsisWidth<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"...\"</span><span class=\"token punctuation\">)</span>\n    maxTextWidth <span class=\"token operator\">:=</span> S <span class=\"token operator\">*</span> <span class=\"token number\">0.75</span>\n    s <span class=\"token operator\">=</span> <span class=\"token function\">TruncateText</span><span class=\"token punctuation\">(</span>dc<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> maxTextWidth <span class=\"token operator\">-</span> ellipsisWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"...\"</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>\n    sWidth<span class=\"token punctuation\">,</span> sHeight <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>\n\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawString</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>S<span class=\"token operator\">-</span>sWidth<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>S<span class=\"token operator\">+</span>sHeight<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这里我们先计算了省略号的宽度，然后用最大字符串宽度减去省略号宽度作为最大宽度传入，得到最终要展示的字符串。生成的效果如下：</p>\n<p><img src=\"7.png\" alt=\"\"></p>\n<p>看起来好像没什么毛病，但如果我们把文字换成中文，情况可能就不一样了。我们换一个中文字体，然后把字符串设置成中文。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"方正楷体简体.ttf\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\ns <span class=\"token operator\">:=</span> <span class=\"token string\">\"如果我们把文字换成中文\"</span></code></pre>\n<p>就变成了这个样子。</p>\n<p><img src=\"8.png\" alt=\"\"></p>\n<p>发现图片上只剩下了省略号，原因是中文字符串分割不正确导致出现了乱码，而这个乱码在字体里找不到对应的文字，所以无法展示。这时，需要先将字符串先转化为<code>rune</code>数组，或者通过直接对字符串使用 <code>for range</code> 遍历，可以避免在中文的情况出现乱码的情况。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">TruncateText</span><span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>gg<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> originalText <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> maxTextWidth <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    tmpStr <span class=\"token operator\">:=</span> <span class=\"token string\">\"\"</span>\n    result <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">rune</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> r <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> originalText <span class=\"token punctuation\">{</span>\n        tmpStr <span class=\"token operator\">=</span> tmpStr <span class=\"token operator\">+</span> <span class=\"token function\">string</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span>\n        w<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span>tmpStr<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> w <span class=\"token operator\">></span> maxTextWidth <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>tmpStr<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token string\">\"\"</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">break</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            result <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">string</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这样文字就能按照我们的预期进行展示了。</p>\n<p><img src=\"9.png\" alt=\"\"></p>\n<h3 id=\"多行文本处理\"><a href=\"#多行文本处理\" class=\"headerlink\" title=\"多行文本处理\"></a>多行文本处理</h3><p>接下来，我们来看看怎么处理多行文本，即当一行文字展示不下时，把文字切割成多行进行展示。如果我们仍旧使用之前的方法来处理的话，就需要先计算好每行展示的字以及行数，然后再进行展示。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"github.com/fogleman/gg\"</span>\n    <span class=\"token string\">\"strings\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> S <span class=\"token operator\">=</span> <span class=\"token number\">1024</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">,</span> S<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFontFace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/Users/bytedance/Downloads/方正楷体简体.ttf\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    s <span class=\"token operator\">:=</span> <span class=\"token string\">\"这是我的一个秘密，再简单不过的秘密：一个人只有用心去看，才能看到真实。事情的真相只用眼睛是看不见的。        --《小王子》\"</span>\n    ellipsisWidth<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"...\"</span><span class=\"token punctuation\">)</span>\n\n    maxTextWidth <span class=\"token operator\">:=</span> S <span class=\"token operator\">*</span> <span class=\"token number\">0.9</span>\n    lineSpace <span class=\"token operator\">:=</span> <span class=\"token number\">25.0</span>\n    maxLine <span class=\"token operator\">:=</span> <span class=\"token function\">int</span><span class=\"token punctuation\">(</span>S <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>dc<span class=\"token punctuation\">.</span><span class=\"token function\">FontHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> lineSpace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    line <span class=\"token operator\">:=</span> <span class=\"token number\">0</span>\n    lineTexts <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token punctuation\">{</span>\n        line<span class=\"token operator\">++</span>\n        <span class=\"token keyword\">if</span> line <span class=\"token operator\">></span> maxLine <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">break</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> line <span class=\"token operator\">==</span> maxLine <span class=\"token punctuation\">{</span>\n            sw<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> sw <span class=\"token operator\">></span> maxTextWidth <span class=\"token punctuation\">{</span>\n                maxTextWidth <span class=\"token operator\">-=</span> ellipsisWidth\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        lineText <span class=\"token operator\">:=</span> <span class=\"token function\">TruncateText</span><span class=\"token punctuation\">(</span>dc<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> maxTextWidth<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> line <span class=\"token operator\">==</span> maxLine <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>lineText<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            lineText <span class=\"token operator\">+=</span> <span class=\"token string\">\"...\"</span>\n        <span class=\"token punctuation\">}</span>\n        lineTexts <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>lineTexts<span class=\"token punctuation\">,</span> lineText<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>lineText<span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">break</span>\n        <span class=\"token punctuation\">}</span>\n        s <span class=\"token operator\">=</span> s<span class=\"token punctuation\">[</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>lineText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n\n    lineY <span class=\"token operator\">:=</span> <span class=\"token punctuation\">(</span>S <span class=\"token operator\">-</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">FontHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token function\">float64</span><span class=\"token punctuation\">(</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>lineTexts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> lineSpace<span class=\"token operator\">*</span><span class=\"token function\">float64</span><span class=\"token punctuation\">(</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>lineTexts<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n    lineY <span class=\"token operator\">+=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">FontHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> text <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> lineTexts <span class=\"token punctuation\">{</span>\n        sWidth<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n        lineX <span class=\"token operator\">:=</span> <span class=\"token punctuation\">(</span>S <span class=\"token operator\">-</span> sWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n        dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawString</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">,</span> lineX<span class=\"token punctuation\">,</span> lineY<span class=\"token punctuation\">)</span>\n        lineY <span class=\"token operator\">+=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">FontHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> lineSpace\n    <span class=\"token punctuation\">}</span>\n\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">TruncateText</span><span class=\"token punctuation\">(</span>dc <span class=\"token operator\">*</span>gg<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> originalText <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> maxTextWidth <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    tmpStr <span class=\"token operator\">:=</span> <span class=\"token string\">\"\"</span>\n    result <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">rune</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> r <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> originalText <span class=\"token punctuation\">{</span>\n        tmpStr <span class=\"token operator\">=</span> tmpStr <span class=\"token operator\">+</span> <span class=\"token function\">string</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span>\n        w<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span>tmpStr<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> w <span class=\"token operator\">></span> maxTextWidth <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>tmpStr<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token string\">\"\"</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">break</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            result <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">string</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这段逻辑其实也很简单，首先根据行高和行间距计算出当前图片最多能展示多少行字，然后遍历需要展示的字符串进行逐行截取，截取出一行行的文字来。</p>\n<p>遍历时有一个小细节，那就是判断是否已经到达最后一行，如果到达最后一行，则要考虑是否添加省略号了。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token comment\" spellcheck=\"true\">//如果已经是最后一行，则需要判断剩余字符串是否仍旧超过最大宽度</span>\n<span class=\"token keyword\">if</span> line <span class=\"token operator\">==</span> maxLine <span class=\"token punctuation\">{</span>\n    sw<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\" spellcheck=\"true\">// 如果超过则需要在末尾添加省略号，截取的最大宽度需要减去省略号的宽度</span>\n    <span class=\"token keyword\">if</span> sw <span class=\"token operator\">></span> maxTextWidth <span class=\"token punctuation\">{</span>\n        maxTextWidth <span class=\"token operator\">-=</span> ellipsisWidth\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\nlineText <span class=\"token operator\">:=</span> <span class=\"token function\">TruncateText</span><span class=\"token punctuation\">(</span>dc<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">,</span> maxTextWidth<span class=\"token punctuation\">)</span>\n<span class=\"token comment\" spellcheck=\"true\">// 如果是最后一行并且文字仍旧是被截取过，那么在末尾添加省略号</span>\n<span class=\"token keyword\">if</span> line <span class=\"token operator\">==</span> maxLine <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>lineText<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    lineText <span class=\"token operator\">+=</span> <span class=\"token string\">\"...\"</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>在绘制文本时，先考虑整个文本框的左上顶点位置，因为需要居中展示，每一行的宽度是变化的，X轴坐标是不确定的，但是Y轴坐标是可以先计算出来的，因为每一行的高度和行间距我们都已经知道了。整个文本框的高度就是<code>dc.FontHeight()*float64(len(lineTexts)) - lineSpace*float64(len(lineTexts)-1))</code> ，用图片高度减去文本框高度再除以2，就能得到左上顶点高度了。</p>\n<pre class=\" language-go\"><code class=\"language-go\">lineY <span class=\"token operator\">:=</span> <span class=\"token punctuation\">(</span>S <span class=\"token operator\">-</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">FontHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token function\">float64</span><span class=\"token punctuation\">(</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>lineTexts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> lineSpace<span class=\"token operator\">*</span><span class=\"token function\">float64</span><span class=\"token punctuation\">(</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>lineTexts<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span></code></pre>\n<p>然后开始逐行绘制文字，计算每一行的左下顶点X轴和Y轴坐标即可。</p>\n<pre class=\" language-go\"><code class=\"language-go\">lineY <span class=\"token operator\">+=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">FontHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> text <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> lineTexts <span class=\"token punctuation\">{</span>\n    sWidth<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">MeasureString</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n    lineX <span class=\"token operator\">:=</span> <span class=\"token punctuation\">(</span>S <span class=\"token operator\">-</span> sWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawString</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">,</span> lineX<span class=\"token punctuation\">,</span> lineY<span class=\"token punctuation\">)</span>\n    lineY <span class=\"token operator\">+=</span> dc<span class=\"token punctuation\">.</span><span class=\"token function\">FontHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> lineSpace\n<span class=\"token punctuation\">}</span></code></pre>\n<p>最后的效果如下图：</p>\n<p><img src=\"10.png\" alt=\"\"></p>\n<p>这样虽然实现了效果，但是显然有些太过复杂，我们还能再简化一下这个过程。</p>\n<p>在gg库中，还有两个方法可以绘制文字，<code>DrawStringAnchored()</code> 和 <code>DrawStringWrapped()</code>。前者可以在指定一个点为偏移起点。后者则类似于一个文本框的效果，可以指定文本框中心点和文本框宽度，这些将在下一篇中进行介绍。</p>\n<p>这里的处理没有考虑原文本中有换行符的情况，所以其实还不够完善，在处理时可以先对文本进行换行符分割，然后再依次进行上述处理。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>这一篇中，主要讲解了如何在纯色背景图上进行文字的绘制，说明了 <code>DrawString()</code> 方法和 <code>MeasureString()</code> 的使用，并利用它们来实现了文字居中的效果。在下一篇中，将对通过另外几个方法的讲解来了解文字绘制的更多技巧。</p>\n<p>如果本篇内容对你有帮助，别忘了点赞关注加收藏～</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<p>前一篇讲解了利用gg包来进行图片旋转的操作，这一篇我们来看看怎么在图片上添加文字。</p>\n<h2 id=\"绘制纯色背景\"><a href=\"#绘制纯色背景\" class=\"headerlink\" title=\"绘制纯色背景\"></a>绘制纯色背景</h2><p>首先，我们先绘制一个纯白色的背景，作为添加文字的背景板。</p>\n<pre><code class=\"go\">package main\n\nimport &quot;github.com/fogleman/gg&quot;\n\nfunc main() {\n    const S = 1024\n    dc := gg.NewContext(S, S)\n    dc.SetRGB(0, 1, 1)\n    dc.Clear()\n    dc.SavePNG(&quot;out.png&quot;)\n}</code></pre>\n<p>输出图片如下：</p>\n<p><img src=\"1.png\" alt=\"\"></p>\n<p>这样我就得到了一张纯青色的背景图。回顾一下上一篇里绘制背景图的步骤：</p>\n<pre><code class=\"go\">func TestRotateImage(t *testing.T) {\n    width := 1000\n    height := 1000\n\n    dc := gg.NewContext(width, height)\n    dc.DrawRectangle(0, 0, float64(width), float64(width))\n    dc.SetRGB255(255, 255, 0)\n    dc.Fill()\n    dc.SavePNG(&quot;test.png&quot;)\n}</code></pre>\n<p>我们是通过先绘制跟画布同样大小的矩形，然后将它的颜色进行填充来实现纯色背景效果的，但实际上使用 <code>Clear()</code> 方法便能直接使用当前颜色对画布进行填充。</p>\n<p>查看一下 <code>Clear()</code> 方法便能发现，里面是通过调用 <code>draw.Draw()</code> 函数来实现的，这也是go语言自带的 <code>image</code> 包里很有用的一个函数，后面会有文章来做更详细的介绍。简单来说，<code>Clear()</code> 方法是通过调用<code>draw.Draw()</code> 函数，通过将纯色图片覆盖到原画布的方式来实现纯色背景的效果的。</p>\n<pre><code class=\"go\">// Clear fills the entire image with the current color.\nfunc (dc *Context) Clear() {\n    src := image.NewUniform(dc.color)\n    draw.Draw(dc.im, dc.im.Bounds(), src, image.ZP, draw.Src)\n}</code></pre>\n<h2 id=\"添加文字\"><a href=\"#添加文字\" class=\"headerlink\" title=\"添加文字\"></a>添加文字</h2><p>背景板已经准备就绪，接下来，我们来添加一些文字。</p>\n<pre><code class=\"go\">package main\n\nimport &quot;github.com/fogleman/gg&quot;\n\nfunc main() {\n    const S = 1024\n    dc := gg.NewContext(S, S)\n    dc.SetRGB(0, 1, 1)\n    dc.Clear()\n    dc.SetRGB(0, 0, 0)\n    if err := dc.LoadFontFace(&quot;gilmer-heavy.ttf&quot;, 120); err != nil {\n        panic(err)\n    }\n    dc.DrawString(&quot;Hello, world!&quot;, 0, S/2)\n    dc.SavePNG(&quot;out.png&quot;)\n}</code></pre>\n<p>输出如下，一个硕大、黑色的“Hello, World!”就出现在了图片中央。</p>\n<p><img src=\"2.png\" alt=\"\"></p>\n<p>这里我们添加了三个步骤，首先是设置了字体颜色为黑色。</p>\n<pre><code class=\"go\">dc.SetRGB(0, 0, 0)</code></pre>\n<p>然后加载了字体文件，这里需要注意的是，通过 <code>LoadFontFace()</code> 方法加载的字体文件只支持 <code>ttf</code> 后缀的文件，也就是 <code>true type font</code>，</p>\n<pre><code class=\"go\">if err := dc.LoadFontFace(&quot;gilmer-heavy.ttf&quot;, 120); err != nil {\n    panic(err)\n}</code></pre>\n<p>里面的实现也比较简单：</p>\n<pre><code class=\"go\">func (dc *Context) LoadFontFace(path string, points float64) error {\n    face, err := LoadFontFace(path, points)\n    if err == nil {\n        dc.fontFace = face\n        dc.fontHeight = points * 72 / 96\n    }\n    return err\n}</code></pre>\n<p>内部调用了 <code>LoadFontFace()</code> 函数，在这个函数内部进行了字体文件读取，并用 <code>freetype</code> 包里的<code>Parse()</code>函数进行字体的加载，最后在调用 <code>NewFace()</code> 函数来创建一个 <code>font.Face</code> 对象，在外面的<code>LoadFontFace()</code>方法里，将这个对象保存在 <code>fontFace</code> 字段中，并且根据传入的<code>point</code>大小设置了一下字体高度。</p>\n<p>至于为什么是乘以<code>72</code>然后除以<code>96</code>，这个查了一下资料，简单的说，字体的大小单位磅(<code>points</code>) 是<code>1/72</code>逻辑英寸，屏幕的分辨率是<code>96DPI</code>（96点每逻辑英寸），那么屏幕每个点就是<code>72/96</code>=<code>0.75</code>磅。</p>\n<pre><code class=\"go\">func LoadFontFace(path string, points float64) (font.Face, error) {\n    fontBytes, err := ioutil.ReadFile(path)\n    if err != nil {\n        return nil, err\n    }\n    f, err := truetype.Parse(fontBytes)\n    if err != nil {\n        return nil, err\n    }\n    face := truetype.NewFace(f, &amp;truetype.Options{\n        Size: points,\n        // Hinting: font.HintingFull,\n    })\n    return face, nil\n}</code></pre>\n<h3 id=\"调整字体大小\"><a href=\"#调整字体大小\" class=\"headerlink\" title=\"调整字体大小\"></a>调整字体大小</h3><p>如果想调整字体大小，也很简单，只需要调整<code>LoadFontFace()</code> 方法传入的值即可，让我们来调大一点字体看看效果。</p>\n<pre><code class=\"go\">if err := dc.LoadFontFace(&quot;gilmer-heavy.ttf&quot;, 240); err != nil {\n    panic(err)\n}</code></pre>\n<p><img src=\"3.png\" alt=\"\"></p>\n<p>这样就大很多了。不知道聪明的你注意到了没有，在调用<code>dc.DrawString(&quot;Hello, world!&quot;, 0, S/2)</code>时，我们设置的坐标是 <code>(0, S/2)</code> ，也就是左侧边的正中心点，<strong>这个位置刚好是绘制出来的文字的左下角的坐标</strong>，这是需要注意的一点。</p>\n<h3 id=\"居中显示\"><a href=\"#居中显示\" class=\"headerlink\" title=\"居中显示\"></a>居中显示</h3><p>如果想要文字居中显示怎么办呢？比如我们想要这个 <code>Hello,World!</code> 显示在图片的正中央，要怎么处理呢？一个笨办法当然是通过调整字体位置来实现这个效果，让我们先来试试：</p>\n<pre><code class=\"go\">if err := dc.LoadFontFace(&quot;gilmer-heavy.ttf&quot;, 120); err != nil {\n    panic(err)\n}\ndc.DrawString(&quot;Hello, world!&quot;, 130, S/2)</code></pre>\n<p><img src=\"4.png\" alt=\"\"></p>\n<p>通过多次调整，字体大小设置为<code>120</code>时，<code>x</code>的位置设置为<code>130</code>，基本上可以看起来是居中的。但这样的话每次换文字都得反复调整位置，显然不科学。</p>\n<p>别慌，有一个方法可以得到文字的宽度，<code>MeasureString()</code> 可以得到在当前字体下指定字符串的宽度和高度，这个高度其实就是前面通过 <code>points * 72 / 96</code> 计算得到的，然后我们再将左下角的位置设置为<code>((S-sWidth)/2, (S+sHeight)/2)</code>即可实现文字居中的效果，注意y轴坐标是<code>(S+sHeight)/2</code>，因为文字的左上顶点位置y轴坐标应该是<code>(S-sHeight)/2</code>，左下顶点坐标只需要再加上字体高度即可得出。</p>\n<pre><code class=\"go\">s := &quot;Hello, world!&quot;\nsWidth, sHeight := dc.MeasureString(s)\ndc.DrawString(s, (S-sWidth)/2, (S+sHeight)/2)</code></pre>\n<p><img src=\"5.png\" alt=\"\"></p>\n<p>这样看来，居中显示也不过如此嘛。但别高兴的太早，有没有想过，如果文字过长该怎么处理？比如我们来调整一下文字内容，再看下生成的效果。</p>\n<pre><code class=\"go\">s := &quot;Hello,world! Hello,ByteDancer!&quot;</code></pre>\n<p><img src=\"6.png\" alt=\"\"></p>\n<p>文字已经超出边界了，显然不是理想的效果，这个时候有两种处理方法，一种是添加省略号，一种是换行。</p>\n<h3 id=\"单行长文本处理\"><a href=\"#单行长文本处理\" class=\"headerlink\" title=\"单行长文本处理\"></a>单行长文本处理</h3><p>先来说一下添加省略号的处理方案，听起来好像挺简单，但实际上处理起来也挺麻烦的。</p>\n<p>首先需要确定一个文字展示的最大宽度，因为如果满打满算整行都塞满文字显然不好看。其次是要逐个字符进行宽度计算，并判断是否会超过最大宽度，最后截取并保留刚好小于最大宽度时的字符串（需要考虑省略号的宽度）。</p>\n<p>我们来逐个处理。首先拍脑袋定一个文字最大宽度为图片宽度的<code>0.75</code>倍。</p>\n<pre><code class=\"go\">maxTextWidth := S * 0.75</code></pre>\n<p>然后来逐个字符计算宽度，直到刚好大于最大宽度为止。</p>\n<pre><code class=\"go\">func TruncateText(dc *gg.Context, originalText string, maxTextWidth float64) string {\n    tmpStr := &quot;&quot;\n    for i := 0; i &lt; len(originalText); i++ {\n        tmpStr = tmpStr + string(originalText[i])\n        w, _ := dc.MeasureString(tmpStr)\n        if w &gt; maxTextWidth {\n            return tmpStr[0 : i-1]\n        }\n    }\n    return tmpStr\n}</code></pre>\n<p>然后我们调整一下调用的地方。</p>\n<pre><code class=\"go\">func main() {\n    const S = 1024\n    dc := gg.NewContext(S, S)\n    dc.SetRGB(0, 1, 1)\n    dc.Clear()\n    dc.SetRGB(0, 0, 0)\n    if err := dc.LoadFontFace(&quot;gilmer-heavy.ttf&quot;, 120); err != nil {\n        panic(err)\n    }\n    s := &quot;Hello,world! Hello,ByteDancer!&quot;\n    ellipsisWidth, _ := dc.MeasureString(&quot;...&quot;)\n    maxTextWidth := S * 0.75\n    s = TruncateText(dc, s, maxTextWidth - ellipsisWidth) + &quot;...&quot;\n    fmt.Println(s)\n    sWidth, sHeight := dc.MeasureString(s)\n\n    dc.DrawString(s, (S-sWidth)/2, (S+sHeight)/2)\n    dc.SavePNG(&quot;out.png&quot;)\n}</code></pre>\n<p>这里我们先计算了省略号的宽度，然后用最大字符串宽度减去省略号宽度作为最大宽度传入，得到最终要展示的字符串。生成的效果如下：</p>\n<p><img src=\"7.png\" alt=\"\"></p>\n<p>看起来好像没什么毛病，但如果我们把文字换成中文，情况可能就不一样了。我们换一个中文字体，然后把字符串设置成中文。</p>\n<pre><code class=\"go\">if err := dc.LoadFontFace(&quot;方正楷体简体.ttf&quot;, 120); err != nil {\n    panic(err)\n}\ns := &quot;如果我们把文字换成中文&quot;</code></pre>\n<p>就变成了这个样子。</p>\n<p><img src=\"8.png\" alt=\"\"></p>\n<p>发现图片上只剩下了省略号，原因是中文字符串分割不正确导致出现了乱码，而这个乱码在字体里找不到对应的文字，所以无法展示。这时，需要先将字符串先转化为<code>rune</code>数组，或者通过直接对字符串使用 <code>for range</code> 遍历，可以避免在中文的情况出现乱码的情况。</p>\n<pre><code class=\"go\">func TruncateText(dc *gg.Context, originalText string, maxTextWidth float64) string {\n    tmpStr := &quot;&quot;\n    result := make([]rune, 0)\n    for _, r := range originalText {\n        tmpStr = tmpStr + string(r)\n        w, _ := dc.MeasureString(tmpStr)\n        if w &gt; maxTextWidth {\n            if len(tmpStr) &lt;= 1 {\n                return &quot;&quot;\n            } else {\n                break\n            }\n        } else {\n            result = append(result, r)\n        }\n    }\n    return string(result)\n}</code></pre>\n<p>这样文字就能按照我们的预期进行展示了。</p>\n<p><img src=\"9.png\" alt=\"\"></p>\n<h3 id=\"多行文本处理\"><a href=\"#多行文本处理\" class=\"headerlink\" title=\"多行文本处理\"></a>多行文本处理</h3><p>接下来，我们来看看怎么处理多行文本，即当一行文字展示不下时，把文字切割成多行进行展示。如果我们仍旧使用之前的方法来处理的话，就需要先计算好每行展示的字以及行数，然后再进行展示。</p>\n<pre><code class=\"go\">package main\n\nimport (\n    &quot;github.com/fogleman/gg&quot;\n    &quot;strings&quot;\n)\n\nfunc main() {\n    const S = 1024\n    dc := gg.NewContext(S, S)\n    dc.SetRGB(0, 1, 1)\n    dc.Clear()\n    dc.SetRGB(0, 0, 0)\n    if err := dc.LoadFontFace(&quot;/Users/bytedance/Downloads/方正楷体简体.ttf&quot;, 120); err != nil {\n        panic(err)\n    }\n    s := &quot;这是我的一个秘密，再简单不过的秘密：一个人只有用心去看，才能看到真实。事情的真相只用眼睛是看不见的。        --《小王子》&quot;\n    ellipsisWidth, _ := dc.MeasureString(&quot;...&quot;)\n\n    maxTextWidth := S * 0.9\n    lineSpace := 25.0\n    maxLine := int(S / (dc.FontHeight() + lineSpace))\n\n    line := 0\n    lineTexts := make([]string, 0)\n    for len(s) &gt; 0 {\n        line++\n        if line &gt; maxLine {\n            break\n        }\n        if line == maxLine {\n            sw, _ := dc.MeasureString(s)\n            if sw &gt; maxTextWidth {\n                maxTextWidth -= ellipsisWidth\n            }\n        }\n        lineText := TruncateText(dc, s, maxTextWidth)\n        if line == maxLine &amp;&amp; len(lineText) &lt; len(s) {\n            lineText += &quot;...&quot;\n        }\n        lineTexts = append(lineTexts, lineText)\n        if len(lineText) &gt;= len(s) {\n            break\n        }\n        s = s[len(lineText):]\n    }\n\n    lineY := (S - dc.FontHeight()*float64(len(lineTexts)) - lineSpace*float64(len(lineTexts)-1)) / 2\n    lineY += dc.FontHeight()\n    for _, text := range lineTexts {\n        sWidth, _ := dc.MeasureString(text)\n        lineX := (S - sWidth) / 2\n        dc.DrawString(text, lineX, lineY)\n        lineY += dc.FontHeight() + lineSpace\n    }\n\n    dc.SavePNG(&quot;out.png&quot;)\n}\n\nfunc TruncateText(dc *gg.Context, originalText string, maxTextWidth float64) string {\n    tmpStr := &quot;&quot;\n    result := make([]rune, 0)\n    for _, r := range originalText {\n        tmpStr = tmpStr + string(r)\n        w, _ := dc.MeasureString(tmpStr)\n        if w &gt; maxTextWidth {\n            if len(tmpStr) &lt;= 1 {\n                return &quot;&quot;\n            } else {\n                break\n            }\n        } else {\n            result = append(result, r)\n        }\n    }\n    return string(result)\n}</code></pre>\n<p>这段逻辑其实也很简单，首先根据行高和行间距计算出当前图片最多能展示多少行字，然后遍历需要展示的字符串进行逐行截取，截取出一行行的文字来。</p>\n<p>遍历时有一个小细节，那就是判断是否已经到达最后一行，如果到达最后一行，则要考虑是否添加省略号了。</p>\n<pre><code class=\"go\">//如果已经是最后一行，则需要判断剩余字符串是否仍旧超过最大宽度\nif line == maxLine {\n    sw, _ := dc.MeasureString(s)\n    // 如果超过则需要在末尾添加省略号，截取的最大宽度需要减去省略号的宽度\n    if sw &gt; maxTextWidth {\n        maxTextWidth -= ellipsisWidth\n    }\n}\nlineText := TruncateText(dc, s, maxTextWidth)\n// 如果是最后一行并且文字仍旧是被截取过，那么在末尾添加省略号\nif line == maxLine &amp;&amp; len(lineText) &lt; len(s) {\n    lineText += &quot;...&quot;\n}</code></pre>\n<p>在绘制文本时，先考虑整个文本框的左上顶点位置，因为需要居中展示，每一行的宽度是变化的，X轴坐标是不确定的，但是Y轴坐标是可以先计算出来的，因为每一行的高度和行间距我们都已经知道了。整个文本框的高度就是<code>dc.FontHeight()*float64(len(lineTexts)) - lineSpace*float64(len(lineTexts)-1))</code> ，用图片高度减去文本框高度再除以2，就能得到左上顶点高度了。</p>\n<pre><code class=\"go\">lineY := (S - dc.FontHeight()*float64(len(lineTexts)) - lineSpace*float64(len(lineTexts)-1)) / 2</code></pre>\n<p>然后开始逐行绘制文字，计算每一行的左下顶点X轴和Y轴坐标即可。</p>\n<pre><code class=\"go\">lineY += dc.FontHeight()\nfor _, text := range lineTexts {\n    sWidth, _ := dc.MeasureString(text)\n    lineX := (S - sWidth) / 2\n    dc.DrawString(text, lineX, lineY)\n    lineY += dc.FontHeight() + lineSpace\n}</code></pre>\n<p>最后的效果如下图：</p>\n<p><img src=\"10.png\" alt=\"\"></p>\n<p>这样虽然实现了效果，但是显然有些太过复杂，我们还能再简化一下这个过程。</p>\n<p>在gg库中，还有两个方法可以绘制文字，<code>DrawStringAnchored()</code> 和 <code>DrawStringWrapped()</code>。前者可以在指定一个点为偏移起点。后者则类似于一个文本框的效果，可以指定文本框中心点和文本框宽度，这些将在下一篇中进行介绍。</p>\n<p>这里的处理没有考虑原文本中有换行符的情况，所以其实还不够完善，在处理时可以先对文本进行换行符分割，然后再依次进行上述处理。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>这一篇中，主要讲解了如何在纯色背景图上进行文字的绘制，说明了 <code>DrawString()</code> 方法和 <code>MeasureString()</code> 的使用，并利用它们来实现了文字居中的效果。在下一篇中，将对通过另外几个方法的讲解来了解文字绘制的更多技巧。</p>\n<p>如果本篇内容对你有帮助，别忘了点赞关注加收藏～</p>\n"},{"title":"【Go语言绘图】图片的旋转","toc":true,"top":true,"cover":true,"date":"2020-12-16T14:50:00.000Z","_content":"\n在上一篇中，我们了解了gg库的基本使用，包括调整大小、调整圆形参数、设置颜色、保存图片、加载图片和裁剪。这一篇我们来学习一下图片的旋转。\n\n## 加载图片\n\n首先，我们先来一张黄图。\n\n```go\nfunc TestRotateImage(t *testing.T) {\n\twidth := 1000\n\theight := 1000\n\n\tdc := gg.NewContext(width, height)\n\tdc.DrawRectangle(0, 0, float64(width), float64(width))\n\tdc.SetRGB255(255, 255, 0)\n\tdc.Fill()\n\tdc.SavePNG(\"test.png\")\n}\n```\n\n![](1.png)\n\n然后加载好我们要旋转的图片，用的仍旧是我们上一篇中使用的图。\n\n![](2.png)\n\n```go\nfunc TestRotateImage(t *testing.T) {\n\tim, err := gg.LoadImage(\"/Users/bytedance/Desktop/test.png\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tw := im.Bounds().Size().X\n\th := im.Bounds().Size().Y\n\n\twidth := 2 * w\n\theight := 2 * h\n\n\tdc := gg.NewContext(width, height)\n\tdc.DrawRectangle(0, 0, float64(width), float64(width))\n\tdc.SetRGB255(255, 255, 0)\n\tdc.Fill()\n\n\tdc.DrawImage(im, width/4, height/4)\n\tdc.SavePNG(\"test.png\")\n}\n```\n\n这里为了更好的看到旋转的效果，对之前的代码做了一些调整。把画布大小设置为2倍图片的长宽。\n\n```go\nwidth := 2 * w\nheight := 2 * h\n\ndc := gg.NewContext(width, height)\n```\n\n然后绘制了一个矩形，并且将它的颜色填充为黄色（因为图片比较白，用黑色背景更容易看到边界）。\n\n```go\ndc.DrawRectangle(0, 0, float64(2*h), float64(2*w))\ndc.SetRGB255(255, 255, 0)\ndc.Fill()\n```\n\n顺便纠正一下上一篇中的遗漏的点，使用 `setRGB()` 方法来设置颜色确实需要使用转换函数来将RGB值进行映射，但还有另一个方法 `SetRGB255()` 可以直接设置RGB值，就不需要先进行一次转换了。\n\n然后我们将图片加载到了正中心的位置，`(w/4,h/4)` 对应图片左上角在画布上的位置。\n\n```go\ndc.DrawImage(im, width/4, height/4)\n```\n\n输出的图片如下：\n\n![](3.png)\n\n## 旋转图片\n\n图片加载好了，下面我们开始添加一个旋转操作。\n\n```go\nfunc TestRotateImage(t *testing.T) {\n\tim, err := gg.LoadImage(\"/Users/bytedance/Desktop/test.png\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tw := im.Bounds().Size().X\n\th := im.Bounds().Size().Y\n\n\twidth := 2 * w\n\theight := 2 * h\n\n\tdc := gg.NewContext(width, height)\n\tdc.DrawRectangle(0, 0, float64(width), float64(width))\n\tdc.SetRGB255(255, 255, 0)\n\tdc.Fill()\n\n\tdc.Rotate(45)\n\tdc.DrawImage(im, width/4, height/4)\n\tdc.SavePNG(\"test.png\")\n}\n```\n\n其实只添加了一行代码，就是在加载图片前先调用了 `Rotate()` 方法。想象之中，我们会把图片旋转45度，但实际上是这样的：\n\n![](4.png)\n\n好像不太符合预期，实际上，仔细研究一下就会发现，这里的旋转是围绕原点也就是整个画布的左上角进行旋转的，那我想要它围绕中心点旋转该怎么办呢？别慌，换一个方法就可以了。`RotateAbout()` 方法可以指定图片的旋转中心点，换这个来试试看：\n\n```go\nfunc TestRotateImage(t *testing.T) {\n\tim, err := gg.LoadImage(\"/Users/bytedance/Desktop/test.png\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tw := im.Bounds().Size().X\n\th := im.Bounds().Size().Y\n\n\twidth := 2 * w\n\theight := 2 * h\n\n\tdc := gg.NewContext(width, height)\n\tdc.DrawRectangle(0, 0, float64(width), float64(width))\n\tdc.SetRGB255(255, 255, 0)\n\tdc.Fill()\n\n\tdc.RotateAbout(45, float64(width/2), float64(height/2))\n\tdc.DrawImage(im, width/4, height/4)\n\tdc.SavePNG(\"test.png\")\n}\n```\n\n![](5.png)\n\n这下图片确实绕中心点旋转了，但转45度好像不应该是这样的，再来看看这个方法的说明：\n\n```\n// RotateAbout updates the current matrix with a clockwise rotation.\n// Rotation occurs about the specified point. Angle is specified in radians.\n```\n\n可以看到，第一个参数的意思其实代表的是弧度，而不是角度，所以想要旋转45度当然不能这么传，我们换一个姿势再试试。\n\n```go\nfunc TestRotateImage(t *testing.T) {\n\tim, err := gg.LoadImage(\"/Users/bytedance/Desktop/test.png\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tw := im.Bounds().Size().X\n\th := im.Bounds().Size().Y\n\n\twidth := 2 * w\n\theight := 2 * h\n\n\tdc := gg.NewContext(width, height)\n\tdc.DrawRectangle(0, 0, float64(width), float64(width))\n\tdc.SetRGB255(255, 255, 0)\n\tdc.Fill()\n\n\tdc.RotateAbout(gg.Radians(45), float64(width/2), float64(height/2))\n\tdc.DrawImage(im, width/4, height/4)\n\tdc.SavePNG(\"test.png\")\n}\n```\n\n![](6.png)\n\n这下终于得到了我们想要的图。\n\n## 总结\n\n图片旋转其实很简单，只需要在绘制前调用 `Rotate()` 或 `RotateAbout()` 方法即可。但需要注意几点：\n\n1. 旋转是顺时针旋转\n2. `Rotate` 方法是绕左上角旋转\n3. 第一个参数都代表的是弧度而不是角度\n\n这样旋转我们也能掌握了，图片处理功能又进了一步。喜欢本文的朋友欢迎点赞收藏加关注～\n\n![](7.png)\n","source":"_posts/picture/go-pic-rotate-use-gg-package.md","raw":"---\ntitle: 【Go语言绘图】图片的旋转\ntags:\n  - go\ncategories:\n  - 编程\ntoc: true\ntop: true\ncover: true\ndate: 2020-12-16 22:50:00\n---\n\n在上一篇中，我们了解了gg库的基本使用，包括调整大小、调整圆形参数、设置颜色、保存图片、加载图片和裁剪。这一篇我们来学习一下图片的旋转。\n\n## 加载图片\n\n首先，我们先来一张黄图。\n\n```go\nfunc TestRotateImage(t *testing.T) {\n\twidth := 1000\n\theight := 1000\n\n\tdc := gg.NewContext(width, height)\n\tdc.DrawRectangle(0, 0, float64(width), float64(width))\n\tdc.SetRGB255(255, 255, 0)\n\tdc.Fill()\n\tdc.SavePNG(\"test.png\")\n}\n```\n\n![](1.png)\n\n然后加载好我们要旋转的图片，用的仍旧是我们上一篇中使用的图。\n\n![](2.png)\n\n```go\nfunc TestRotateImage(t *testing.T) {\n\tim, err := gg.LoadImage(\"/Users/bytedance/Desktop/test.png\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tw := im.Bounds().Size().X\n\th := im.Bounds().Size().Y\n\n\twidth := 2 * w\n\theight := 2 * h\n\n\tdc := gg.NewContext(width, height)\n\tdc.DrawRectangle(0, 0, float64(width), float64(width))\n\tdc.SetRGB255(255, 255, 0)\n\tdc.Fill()\n\n\tdc.DrawImage(im, width/4, height/4)\n\tdc.SavePNG(\"test.png\")\n}\n```\n\n这里为了更好的看到旋转的效果，对之前的代码做了一些调整。把画布大小设置为2倍图片的长宽。\n\n```go\nwidth := 2 * w\nheight := 2 * h\n\ndc := gg.NewContext(width, height)\n```\n\n然后绘制了一个矩形，并且将它的颜色填充为黄色（因为图片比较白，用黑色背景更容易看到边界）。\n\n```go\ndc.DrawRectangle(0, 0, float64(2*h), float64(2*w))\ndc.SetRGB255(255, 255, 0)\ndc.Fill()\n```\n\n顺便纠正一下上一篇中的遗漏的点，使用 `setRGB()` 方法来设置颜色确实需要使用转换函数来将RGB值进行映射，但还有另一个方法 `SetRGB255()` 可以直接设置RGB值，就不需要先进行一次转换了。\n\n然后我们将图片加载到了正中心的位置，`(w/4,h/4)` 对应图片左上角在画布上的位置。\n\n```go\ndc.DrawImage(im, width/4, height/4)\n```\n\n输出的图片如下：\n\n![](3.png)\n\n## 旋转图片\n\n图片加载好了，下面我们开始添加一个旋转操作。\n\n```go\nfunc TestRotateImage(t *testing.T) {\n\tim, err := gg.LoadImage(\"/Users/bytedance/Desktop/test.png\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tw := im.Bounds().Size().X\n\th := im.Bounds().Size().Y\n\n\twidth := 2 * w\n\theight := 2 * h\n\n\tdc := gg.NewContext(width, height)\n\tdc.DrawRectangle(0, 0, float64(width), float64(width))\n\tdc.SetRGB255(255, 255, 0)\n\tdc.Fill()\n\n\tdc.Rotate(45)\n\tdc.DrawImage(im, width/4, height/4)\n\tdc.SavePNG(\"test.png\")\n}\n```\n\n其实只添加了一行代码，就是在加载图片前先调用了 `Rotate()` 方法。想象之中，我们会把图片旋转45度，但实际上是这样的：\n\n![](4.png)\n\n好像不太符合预期，实际上，仔细研究一下就会发现，这里的旋转是围绕原点也就是整个画布的左上角进行旋转的，那我想要它围绕中心点旋转该怎么办呢？别慌，换一个方法就可以了。`RotateAbout()` 方法可以指定图片的旋转中心点，换这个来试试看：\n\n```go\nfunc TestRotateImage(t *testing.T) {\n\tim, err := gg.LoadImage(\"/Users/bytedance/Desktop/test.png\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tw := im.Bounds().Size().X\n\th := im.Bounds().Size().Y\n\n\twidth := 2 * w\n\theight := 2 * h\n\n\tdc := gg.NewContext(width, height)\n\tdc.DrawRectangle(0, 0, float64(width), float64(width))\n\tdc.SetRGB255(255, 255, 0)\n\tdc.Fill()\n\n\tdc.RotateAbout(45, float64(width/2), float64(height/2))\n\tdc.DrawImage(im, width/4, height/4)\n\tdc.SavePNG(\"test.png\")\n}\n```\n\n![](5.png)\n\n这下图片确实绕中心点旋转了，但转45度好像不应该是这样的，再来看看这个方法的说明：\n\n```\n// RotateAbout updates the current matrix with a clockwise rotation.\n// Rotation occurs about the specified point. Angle is specified in radians.\n```\n\n可以看到，第一个参数的意思其实代表的是弧度，而不是角度，所以想要旋转45度当然不能这么传，我们换一个姿势再试试。\n\n```go\nfunc TestRotateImage(t *testing.T) {\n\tim, err := gg.LoadImage(\"/Users/bytedance/Desktop/test.png\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tw := im.Bounds().Size().X\n\th := im.Bounds().Size().Y\n\n\twidth := 2 * w\n\theight := 2 * h\n\n\tdc := gg.NewContext(width, height)\n\tdc.DrawRectangle(0, 0, float64(width), float64(width))\n\tdc.SetRGB255(255, 255, 0)\n\tdc.Fill()\n\n\tdc.RotateAbout(gg.Radians(45), float64(width/2), float64(height/2))\n\tdc.DrawImage(im, width/4, height/4)\n\tdc.SavePNG(\"test.png\")\n}\n```\n\n![](6.png)\n\n这下终于得到了我们想要的图。\n\n## 总结\n\n图片旋转其实很简单，只需要在绘制前调用 `Rotate()` 或 `RotateAbout()` 方法即可。但需要注意几点：\n\n1. 旋转是顺时针旋转\n2. `Rotate` 方法是绕左上角旋转\n3. 第一个参数都代表的是弧度而不是角度\n\n这样旋转我们也能掌握了，图片处理功能又进了一步。喜欢本文的朋友欢迎点赞收藏加关注～\n\n![](7.png)\n","slug":"picture/go-pic-rotate-use-gg-package","published":1,"updated":"2020-12-16T14:50:00.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfbh000t5ohubzf01mj3","content":"<p>在上一篇中，我们了解了gg库的基本使用，包括调整大小、调整圆形参数、设置颜色、保存图片、加载图片和裁剪。这一篇我们来学习一下图片的旋转。</p>\n<h2 id=\"加载图片\"><a href=\"#加载图片\" class=\"headerlink\" title=\"加载图片\"></a>加载图片</h2><p>首先，我们先来一张黄图。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">TestRotateImage</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    width <span class=\"token operator\">:=</span> <span class=\"token number\">1000</span>\n    height <span class=\"token operator\">:=</span> <span class=\"token number\">1000</span>\n\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawRectangle</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB255</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><img src=\"1.png\" alt=\"\"></p>\n<p>然后加载好我们要旋转的图片，用的仍旧是我们上一篇中使用的图。</p>\n<p><img src=\"2.png\" alt=\"\"></p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">TestRotateImage</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    im<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">LoadImage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/Users/bytedance/Desktop/test.png\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    w <span class=\"token operator\">:=</span> im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>X\n    h <span class=\"token operator\">:=</span> im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Y\n\n    width <span class=\"token operator\">:=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> w\n    height <span class=\"token operator\">:=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> h\n\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawRectangle</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB255</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawImage</span><span class=\"token punctuation\">(</span>im<span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这里为了更好的看到旋转的效果，对之前的代码做了一些调整。把画布大小设置为2倍图片的长宽。</p>\n<pre class=\" language-go\"><code class=\"language-go\">width <span class=\"token operator\">:=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> w\nheight <span class=\"token operator\">:=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> h\n\ndc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span></code></pre>\n<p>然后绘制了一个矩形，并且将它的颜色填充为黄色（因为图片比较白，用黑色背景更容易看到边界）。</p>\n<pre class=\" language-go\"><code class=\"language-go\">dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawRectangle</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token operator\">*</span>h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token operator\">*</span>w<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ndc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB255</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\ndc<span class=\"token punctuation\">.</span><span class=\"token function\">Fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre>\n<p>顺便纠正一下上一篇中的遗漏的点，使用 <code>setRGB()</code> 方法来设置颜色确实需要使用转换函数来将RGB值进行映射，但还有另一个方法 <code>SetRGB255()</code> 可以直接设置RGB值，就不需要先进行一次转换了。</p>\n<p>然后我们将图片加载到了正中心的位置，<code>(w/4,h/4)</code> 对应图片左上角在画布上的位置。</p>\n<pre class=\" language-go\"><code class=\"language-go\">dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawImage</span><span class=\"token punctuation\">(</span>im<span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span></code></pre>\n<p>输出的图片如下：</p>\n<p><img src=\"3.png\" alt=\"\"></p>\n<h2 id=\"旋转图片\"><a href=\"#旋转图片\" class=\"headerlink\" title=\"旋转图片\"></a>旋转图片</h2><p>图片加载好了，下面我们开始添加一个旋转操作。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">TestRotateImage</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    im<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">LoadImage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/Users/bytedance/Desktop/test.png\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    w <span class=\"token operator\">:=</span> im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>X\n    h <span class=\"token operator\">:=</span> im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Y\n\n    width <span class=\"token operator\">:=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> w\n    height <span class=\"token operator\">:=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> h\n\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawRectangle</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB255</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Rotate</span><span class=\"token punctuation\">(</span><span class=\"token number\">45</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawImage</span><span class=\"token punctuation\">(</span>im<span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>其实只添加了一行代码，就是在加载图片前先调用了 <code>Rotate()</code> 方法。想象之中，我们会把图片旋转45度，但实际上是这样的：</p>\n<p><img src=\"4.png\" alt=\"\"></p>\n<p>好像不太符合预期，实际上，仔细研究一下就会发现，这里的旋转是围绕原点也就是整个画布的左上角进行旋转的，那我想要它围绕中心点旋转该怎么办呢？别慌，换一个方法就可以了。<code>RotateAbout()</code> 方法可以指定图片的旋转中心点，换这个来试试看：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">TestRotateImage</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    im<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">LoadImage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/Users/bytedance/Desktop/test.png\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    w <span class=\"token operator\">:=</span> im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>X\n    h <span class=\"token operator\">:=</span> im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Y\n\n    width <span class=\"token operator\">:=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> w\n    height <span class=\"token operator\">:=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> h\n\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawRectangle</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB255</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">RotateAbout</span><span class=\"token punctuation\">(</span><span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawImage</span><span class=\"token punctuation\">(</span>im<span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><img src=\"5.png\" alt=\"\"></p>\n<p>这下图片确实绕中心点旋转了，但转45度好像不应该是这样的，再来看看这个方法的说明：</p>\n<pre><code>// RotateAbout updates the current matrix with a clockwise rotation.\n// Rotation occurs about the specified point. Angle is specified in radians.</code></pre><p>可以看到，第一个参数的意思其实代表的是弧度，而不是角度，所以想要旋转45度当然不能这么传，我们换一个姿势再试试。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">TestRotateImage</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    im<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">LoadImage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/Users/bytedance/Desktop/test.png\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    w <span class=\"token operator\">:=</span> im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>X\n    h <span class=\"token operator\">:=</span> im<span class=\"token punctuation\">.</span><span class=\"token function\">Bounds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Y\n\n    width <span class=\"token operator\">:=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> w\n    height <span class=\"token operator\">:=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> h\n\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawRectangle</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB255</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">RotateAbout</span><span class=\"token punctuation\">(</span>gg<span class=\"token punctuation\">.</span><span class=\"token function\">Radians</span><span class=\"token punctuation\">(</span><span class=\"token number\">45</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">float64</span><span class=\"token punctuation\">(</span>height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawImage</span><span class=\"token punctuation\">(</span>im<span class=\"token punctuation\">,</span> width<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><img src=\"6.png\" alt=\"\"></p>\n<p>这下终于得到了我们想要的图。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>图片旋转其实很简单，只需要在绘制前调用 <code>Rotate()</code> 或 <code>RotateAbout()</code> 方法即可。但需要注意几点：</p>\n<ol>\n<li>旋转是顺时针旋转</li>\n<li><code>Rotate</code> 方法是绕左上角旋转</li>\n<li>第一个参数都代表的是弧度而不是角度</li>\n</ol>\n<p>这样旋转我们也能掌握了，图片处理功能又进了一步。喜欢本文的朋友欢迎点赞收藏加关注～</p>\n<p><img src=\"7.png\" alt=\"\"></p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<p>在上一篇中，我们了解了gg库的基本使用，包括调整大小、调整圆形参数、设置颜色、保存图片、加载图片和裁剪。这一篇我们来学习一下图片的旋转。</p>\n<h2 id=\"加载图片\"><a href=\"#加载图片\" class=\"headerlink\" title=\"加载图片\"></a>加载图片</h2><p>首先，我们先来一张黄图。</p>\n<pre><code class=\"go\">func TestRotateImage(t *testing.T) {\n    width := 1000\n    height := 1000\n\n    dc := gg.NewContext(width, height)\n    dc.DrawRectangle(0, 0, float64(width), float64(width))\n    dc.SetRGB255(255, 255, 0)\n    dc.Fill()\n    dc.SavePNG(&quot;test.png&quot;)\n}</code></pre>\n<p><img src=\"1.png\" alt=\"\"></p>\n<p>然后加载好我们要旋转的图片，用的仍旧是我们上一篇中使用的图。</p>\n<p><img src=\"2.png\" alt=\"\"></p>\n<pre><code class=\"go\">func TestRotateImage(t *testing.T) {\n    im, err := gg.LoadImage(&quot;/Users/bytedance/Desktop/test.png&quot;)\n    if err != nil {\n        panic(err)\n    }\n    w := im.Bounds().Size().X\n    h := im.Bounds().Size().Y\n\n    width := 2 * w\n    height := 2 * h\n\n    dc := gg.NewContext(width, height)\n    dc.DrawRectangle(0, 0, float64(width), float64(width))\n    dc.SetRGB255(255, 255, 0)\n    dc.Fill()\n\n    dc.DrawImage(im, width/4, height/4)\n    dc.SavePNG(&quot;test.png&quot;)\n}</code></pre>\n<p>这里为了更好的看到旋转的效果，对之前的代码做了一些调整。把画布大小设置为2倍图片的长宽。</p>\n<pre><code class=\"go\">width := 2 * w\nheight := 2 * h\n\ndc := gg.NewContext(width, height)</code></pre>\n<p>然后绘制了一个矩形，并且将它的颜色填充为黄色（因为图片比较白，用黑色背景更容易看到边界）。</p>\n<pre><code class=\"go\">dc.DrawRectangle(0, 0, float64(2*h), float64(2*w))\ndc.SetRGB255(255, 255, 0)\ndc.Fill()</code></pre>\n<p>顺便纠正一下上一篇中的遗漏的点，使用 <code>setRGB()</code> 方法来设置颜色确实需要使用转换函数来将RGB值进行映射，但还有另一个方法 <code>SetRGB255()</code> 可以直接设置RGB值，就不需要先进行一次转换了。</p>\n<p>然后我们将图片加载到了正中心的位置，<code>(w/4,h/4)</code> 对应图片左上角在画布上的位置。</p>\n<pre><code class=\"go\">dc.DrawImage(im, width/4, height/4)</code></pre>\n<p>输出的图片如下：</p>\n<p><img src=\"3.png\" alt=\"\"></p>\n<h2 id=\"旋转图片\"><a href=\"#旋转图片\" class=\"headerlink\" title=\"旋转图片\"></a>旋转图片</h2><p>图片加载好了，下面我们开始添加一个旋转操作。</p>\n<pre><code class=\"go\">func TestRotateImage(t *testing.T) {\n    im, err := gg.LoadImage(&quot;/Users/bytedance/Desktop/test.png&quot;)\n    if err != nil {\n        panic(err)\n    }\n    w := im.Bounds().Size().X\n    h := im.Bounds().Size().Y\n\n    width := 2 * w\n    height := 2 * h\n\n    dc := gg.NewContext(width, height)\n    dc.DrawRectangle(0, 0, float64(width), float64(width))\n    dc.SetRGB255(255, 255, 0)\n    dc.Fill()\n\n    dc.Rotate(45)\n    dc.DrawImage(im, width/4, height/4)\n    dc.SavePNG(&quot;test.png&quot;)\n}</code></pre>\n<p>其实只添加了一行代码，就是在加载图片前先调用了 <code>Rotate()</code> 方法。想象之中，我们会把图片旋转45度，但实际上是这样的：</p>\n<p><img src=\"4.png\" alt=\"\"></p>\n<p>好像不太符合预期，实际上，仔细研究一下就会发现，这里的旋转是围绕原点也就是整个画布的左上角进行旋转的，那我想要它围绕中心点旋转该怎么办呢？别慌，换一个方法就可以了。<code>RotateAbout()</code> 方法可以指定图片的旋转中心点，换这个来试试看：</p>\n<pre><code class=\"go\">func TestRotateImage(t *testing.T) {\n    im, err := gg.LoadImage(&quot;/Users/bytedance/Desktop/test.png&quot;)\n    if err != nil {\n        panic(err)\n    }\n    w := im.Bounds().Size().X\n    h := im.Bounds().Size().Y\n\n    width := 2 * w\n    height := 2 * h\n\n    dc := gg.NewContext(width, height)\n    dc.DrawRectangle(0, 0, float64(width), float64(width))\n    dc.SetRGB255(255, 255, 0)\n    dc.Fill()\n\n    dc.RotateAbout(45, float64(width/2), float64(height/2))\n    dc.DrawImage(im, width/4, height/4)\n    dc.SavePNG(&quot;test.png&quot;)\n}</code></pre>\n<p><img src=\"5.png\" alt=\"\"></p>\n<p>这下图片确实绕中心点旋转了，但转45度好像不应该是这样的，再来看看这个方法的说明：</p>\n<pre><code>// RotateAbout updates the current matrix with a clockwise rotation.\n// Rotation occurs about the specified point. Angle is specified in radians.</code></pre><p>可以看到，第一个参数的意思其实代表的是弧度，而不是角度，所以想要旋转45度当然不能这么传，我们换一个姿势再试试。</p>\n<pre><code class=\"go\">func TestRotateImage(t *testing.T) {\n    im, err := gg.LoadImage(&quot;/Users/bytedance/Desktop/test.png&quot;)\n    if err != nil {\n        panic(err)\n    }\n    w := im.Bounds().Size().X\n    h := im.Bounds().Size().Y\n\n    width := 2 * w\n    height := 2 * h\n\n    dc := gg.NewContext(width, height)\n    dc.DrawRectangle(0, 0, float64(width), float64(width))\n    dc.SetRGB255(255, 255, 0)\n    dc.Fill()\n\n    dc.RotateAbout(gg.Radians(45), float64(width/2), float64(height/2))\n    dc.DrawImage(im, width/4, height/4)\n    dc.SavePNG(&quot;test.png&quot;)\n}</code></pre>\n<p><img src=\"6.png\" alt=\"\"></p>\n<p>这下终于得到了我们想要的图。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>图片旋转其实很简单，只需要在绘制前调用 <code>Rotate()</code> 或 <code>RotateAbout()</code> 方法即可。但需要注意几点：</p>\n<ol>\n<li>旋转是顺时针旋转</li>\n<li><code>Rotate</code> 方法是绕左上角旋转</li>\n<li>第一个参数都代表的是弧度而不是角度</li>\n</ol>\n<p>这样旋转我们也能掌握了，图片处理功能又进了一步。喜欢本文的朋友欢迎点赞收藏加关注～</p>\n<p><img src=\"7.png\" alt=\"\"></p>\n"},{"title":"【Go语言绘图】 微信公众号文章封面图生成","toc":true,"top":true,"cover":true,"date":"2021-08-01T11:48:23.000Z","_content":"\n## 想法来源\n\n每次写文章都得花点时间找图，有点点麻烦，（其实就是懒。。。）。而且翻了翻之前的文章配图，大概是这个样子。\n\n![](1.png)\n\nemmm，风格还挺统一的。但身为正义凛然的公众号博主，老是用这样图，会有些图文不符，也不符合我这正襟危坐的人物形象，而且，做为一名程序猿，能用代码解决的事情，自然要用代码来解决。\n\n最近看到有些技术类公众号，都使用了统一的图片模版，比如这样：\n\n![](2.png)\n\n左边放上logo，右边放字，简约大气。于是，想着自己也整一个。\n\n![](3.png)\n\n## 图片分析\n\n要如何生成这样一张图呢，我们来简单来分析一下。\n\n最底层是一张纯色的底图，这个不难，之前已经介绍过如何绘制纯色底图了，具体颜色可以用工具吸色看看。\n\n第二层是文字，在前面的文章中，已经介绍过如何绘制文字，在这里刚好能用上。\n\n第三层是logo，还没有介绍过将一张图覆盖在另一张图上的操作，本文会对此进行讲解。\n\n这里还需要注意的就是文字跟logo的区域，在绘制时，需要将文本框和图片框的位置计算好，这个可以使用 Sketch 工具来完成。\n\n![](4.jpg)\n\n![](5.jpg)\n\n![](6.jpg)\n\n这样就得到了Logo和文字位置的具体信息。\n\n接下来就可以开始写代码了\n\n## 代码编写\n\n首先，我们先绘制一个纯色的背景。RGB色值为：(63, 64, 87)，底图的宽和高通过 Sketch 工具测出分别为 1050和442。\n\n```go\nimport (\n\t\"github.com/fogleman/gg\"\n\t\"testing\"\n)\n\nfunc TestDrawWxPic(t *testing.T){\n\tweight := 1050\n\theight := 442\n\tdc := gg.NewContext(weight, height)\n\tdc.SetRGB255(63, 64, 87)\n\tdc.Clear()\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n输出图片如下：\n\n![](7.png)\n\n然后来绘制第二层的文字：\n\n```go\nimport (\n\t\"github.com/fogleman/gg\"\n\t\"golang.org/x/image/font\"\n\t\"golang.org/x/image/font/opentype\"\n\t\"io/ioutil\"\n\t\"testing\"\n)\n\nfunc TestDrawWxPic(t *testing.T){\n\twidth := 1050\n\theight := 442\n\tdc := gg.NewContext(width, height)\n\tdc.SetRGB255(63, 64, 87)\n\tdc.Clear()\n\n\tfontFilePath := \"/Users/bytedance/Downloads/FangZhengKaiTiJianTi.TTF\"\n\tfontFace, err := getOpenTypeFontFace(fontFilePath, 76, 72)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdc.SetFontFace(*fontFace)\n\tdc.SetRGB255(238, 241, 247)\n\n\t// 文本框最大宽度\n\tmaxWordsWidth := 660.0\n\tx := 645.0\n\ty := 224.0\n\tdc.DrawStringWrapped(\"高并发的秘密武器 epoll 机制\", x, y, 0.5, 0.6, maxWordsWidth, 1.1, gg.AlignCenter)\n\tdc.SavePNG(\"out.png\")\n}\n\nfunc getOpenTypeFontFace(fontFilePath string, fontSize, dpi float64)(*font.Face, error){\n\tfontData, fontFileReadErr := ioutil.ReadFile(fontFilePath)\n\tif fontFileReadErr != nil {\n\t\treturn nil, fontFileReadErr\n\t}\n\totfFont, parseErr := opentype.Parse(fontData)\n\tif parseErr != nil {\n\t\treturn nil, parseErr\n\t}\n\totfFace, newFaceErr := opentype.NewFace(otfFont, &opentype.FaceOptions{\n\t\tSize: fontSize,\n\t\tDPI:  dpi,\n\t})\n\tif newFaceErr != nil {\n\t\treturn nil, newFaceErr\n\t}\n\treturn &otfFace, nil\n}\n```\n\n**DrawStringWrapped** 方法已经在之前的文章中介绍过了，这里就不缀述了，文本框的位置可以通过 (x,y,ax,ay)这四个参数来调整。\n\n输出效果如下：\n\n![](8.png)\n\n字体不太一样，位置是差不多了。\n\n最后来把logo拼上去：\n\n```go\nimport (\n\t\"github.com/disintegration/imaging\"\n\t\"github.com/fogleman/gg\"\n\t\"golang.org/x/image/font\"\n\t\"golang.org/x/image/font/opentype\"\n\t\"io/ioutil\"\n\t\"testing\"\n)\n\nfunc TestDrawWxPic(t *testing.T){\n\t...\n\tdc.DrawStringWrapped(\"高并发的秘密武器 epoll 机制\", x, y, 0.5, 0.6, maxWordsWidth, 1.1, gg.AlignCenter)\n\n\t//开始压缩图片\n\tsrc, openErr := imaging.Open(\"logo.png\")\n\tif openErr != nil {\n\t\tpanic(openErr)\n\t}\n\tsrc = imaging.Resize(src, 240, 240, imaging.Lanczos)\n\tdc.DrawImageAnchored(src, 182, 220, 0.5, 0.5)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n`fogleman/gg` 包不支持对图片使用 resize 的操作，因此这里引入了一个新包，\"github.com/disintegration/imaging”。效果如下：\n\n![](9.png)\n\nemm，看起来颜色有些不谐调，改一下背景色，然后放大一下logo试试：\n\n![](10.png)\n\n嗯，这样就好多了，把这段代码封装成方法，传入标题和文件保存位置，即可一键生成封面图。\n\n完整代码如下：\n\n```go\nimport (\n\t\"github.com/disintegration/imaging\"\n\t\"github.com/fogleman/gg\"\n\t\"golang.org/x/image/font\"\n\t\"golang.org/x/image/font/opentype\"\n\t\"io/ioutil\"\n\t\"testing\"\n)\n\nfunc TestDrawWxPic(t *testing.T){\n\tgenerateWxImage(\"微信公众号封面图\\n一键生成\", \"result\")\n}\n\nfunc generateWxImage(title string, savingFileName string) {\n\twidth := 1050\n\theight := 442\n\tdc := gg.NewContext(width, height)\n\tdc.SetRGB255(47, 54, 66)\n\tdc.Clear()\n\n\tfontFilePath := \"FangZhengKaiTiJianTi.TTF\"\n\tfontFace, err := getOpenTypeFontFace(fontFilePath, 76, 72)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdc.SetFontFace(*fontFace)\n\tdc.SetRGB255(238, 241, 247)\n\n\t// 文本框最大宽度\n\tmaxWordsWidth := 660.0\n\tx := 665.0\n\ty := 224.0\n\tdc.DrawStringWrapped(title, x, y, 0.5, 0.6, maxWordsWidth, 1.1, gg.AlignCenter)\n\n\t//开始压缩图片\n\tsrc, openErr := imaging.Open(\"logo.png\")\n\tif openErr != nil {\n\t\tpanic(openErr)\n\t}\n\tsrc = imaging.Resize(src, 360, 360, imaging.Lanczos)\n\n\tdc.DrawImageAnchored(src, 182, 220, 0.5, 0.5)\n\n\tdc.SavePNG(savingFileName + \".png\")\n}\n\nfunc getOpenTypeFontFace(fontFilePath string, fontSize, dpi float64)(*font.Face, error){\n\tfontData, fontFileReadErr := ioutil.ReadFile(fontFilePath)\n\tif fontFileReadErr != nil {\n\t\treturn nil, fontFileReadErr\n\t}\n\totfFont, parseErr := opentype.Parse(fontData)\n\tif parseErr != nil {\n\t\treturn nil, parseErr\n\t}\n\totfFace, newFaceErr := opentype.NewFace(otfFont, &opentype.FaceOptions{\n\t\tSize: fontSize,\n\t\tDPI:  dpi,\n\t})\n\tif newFaceErr != nil {\n\t\treturn nil, newFaceErr\n\t}\n\treturn &otfFace, nil\n}\n```\n\n## 小结\n\n回顾一下整个过程，其实只要想清楚最终想要的效果，然后把步骤拆解开来，代码其实写起来并不复杂，重要的还是逻辑，至于类似于如何实现图片裁剪、文字拼接、图片缩放，这些通常都有现成的库可以拿来就用。\n\n当然，如果感兴趣也可以深入研究其中的实现原理。就像前面所说，了解这些工具，可以增加手中的牌，遇到问题时自然更加左右逢源。\n\n最近的大部分时间都花在了健身上，很长时间都没有好好写博客了，接下来得好好写文章了，光有输入确实还不够，用输出反推输入，会更加有的放矢。\n\n[//]: # (![]&#40;11.png&#41;)\n","source":"_posts/picture/go-wx-pic-generator.md","raw":"---\ntitle: 【Go语言绘图】 微信公众号文章封面图生成\ntags:\n  - go\ncategories:\n  - 编程\ntoc: true\ntop: true\ncover: true\ndate: 2021-08-01 19:48:23\n---\n\n## 想法来源\n\n每次写文章都得花点时间找图，有点点麻烦，（其实就是懒。。。）。而且翻了翻之前的文章配图，大概是这个样子。\n\n![](1.png)\n\nemmm，风格还挺统一的。但身为正义凛然的公众号博主，老是用这样图，会有些图文不符，也不符合我这正襟危坐的人物形象，而且，做为一名程序猿，能用代码解决的事情，自然要用代码来解决。\n\n最近看到有些技术类公众号，都使用了统一的图片模版，比如这样：\n\n![](2.png)\n\n左边放上logo，右边放字，简约大气。于是，想着自己也整一个。\n\n![](3.png)\n\n## 图片分析\n\n要如何生成这样一张图呢，我们来简单来分析一下。\n\n最底层是一张纯色的底图，这个不难，之前已经介绍过如何绘制纯色底图了，具体颜色可以用工具吸色看看。\n\n第二层是文字，在前面的文章中，已经介绍过如何绘制文字，在这里刚好能用上。\n\n第三层是logo，还没有介绍过将一张图覆盖在另一张图上的操作，本文会对此进行讲解。\n\n这里还需要注意的就是文字跟logo的区域，在绘制时，需要将文本框和图片框的位置计算好，这个可以使用 Sketch 工具来完成。\n\n![](4.jpg)\n\n![](5.jpg)\n\n![](6.jpg)\n\n这样就得到了Logo和文字位置的具体信息。\n\n接下来就可以开始写代码了\n\n## 代码编写\n\n首先，我们先绘制一个纯色的背景。RGB色值为：(63, 64, 87)，底图的宽和高通过 Sketch 工具测出分别为 1050和442。\n\n```go\nimport (\n\t\"github.com/fogleman/gg\"\n\t\"testing\"\n)\n\nfunc TestDrawWxPic(t *testing.T){\n\tweight := 1050\n\theight := 442\n\tdc := gg.NewContext(weight, height)\n\tdc.SetRGB255(63, 64, 87)\n\tdc.Clear()\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n输出图片如下：\n\n![](7.png)\n\n然后来绘制第二层的文字：\n\n```go\nimport (\n\t\"github.com/fogleman/gg\"\n\t\"golang.org/x/image/font\"\n\t\"golang.org/x/image/font/opentype\"\n\t\"io/ioutil\"\n\t\"testing\"\n)\n\nfunc TestDrawWxPic(t *testing.T){\n\twidth := 1050\n\theight := 442\n\tdc := gg.NewContext(width, height)\n\tdc.SetRGB255(63, 64, 87)\n\tdc.Clear()\n\n\tfontFilePath := \"/Users/bytedance/Downloads/FangZhengKaiTiJianTi.TTF\"\n\tfontFace, err := getOpenTypeFontFace(fontFilePath, 76, 72)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdc.SetFontFace(*fontFace)\n\tdc.SetRGB255(238, 241, 247)\n\n\t// 文本框最大宽度\n\tmaxWordsWidth := 660.0\n\tx := 645.0\n\ty := 224.0\n\tdc.DrawStringWrapped(\"高并发的秘密武器 epoll 机制\", x, y, 0.5, 0.6, maxWordsWidth, 1.1, gg.AlignCenter)\n\tdc.SavePNG(\"out.png\")\n}\n\nfunc getOpenTypeFontFace(fontFilePath string, fontSize, dpi float64)(*font.Face, error){\n\tfontData, fontFileReadErr := ioutil.ReadFile(fontFilePath)\n\tif fontFileReadErr != nil {\n\t\treturn nil, fontFileReadErr\n\t}\n\totfFont, parseErr := opentype.Parse(fontData)\n\tif parseErr != nil {\n\t\treturn nil, parseErr\n\t}\n\totfFace, newFaceErr := opentype.NewFace(otfFont, &opentype.FaceOptions{\n\t\tSize: fontSize,\n\t\tDPI:  dpi,\n\t})\n\tif newFaceErr != nil {\n\t\treturn nil, newFaceErr\n\t}\n\treturn &otfFace, nil\n}\n```\n\n**DrawStringWrapped** 方法已经在之前的文章中介绍过了，这里就不缀述了，文本框的位置可以通过 (x,y,ax,ay)这四个参数来调整。\n\n输出效果如下：\n\n![](8.png)\n\n字体不太一样，位置是差不多了。\n\n最后来把logo拼上去：\n\n```go\nimport (\n\t\"github.com/disintegration/imaging\"\n\t\"github.com/fogleman/gg\"\n\t\"golang.org/x/image/font\"\n\t\"golang.org/x/image/font/opentype\"\n\t\"io/ioutil\"\n\t\"testing\"\n)\n\nfunc TestDrawWxPic(t *testing.T){\n\t...\n\tdc.DrawStringWrapped(\"高并发的秘密武器 epoll 机制\", x, y, 0.5, 0.6, maxWordsWidth, 1.1, gg.AlignCenter)\n\n\t//开始压缩图片\n\tsrc, openErr := imaging.Open(\"logo.png\")\n\tif openErr != nil {\n\t\tpanic(openErr)\n\t}\n\tsrc = imaging.Resize(src, 240, 240, imaging.Lanczos)\n\tdc.DrawImageAnchored(src, 182, 220, 0.5, 0.5)\n\tdc.SavePNG(\"out.png\")\n}\n```\n\n`fogleman/gg` 包不支持对图片使用 resize 的操作，因此这里引入了一个新包，\"github.com/disintegration/imaging”。效果如下：\n\n![](9.png)\n\nemm，看起来颜色有些不谐调，改一下背景色，然后放大一下logo试试：\n\n![](10.png)\n\n嗯，这样就好多了，把这段代码封装成方法，传入标题和文件保存位置，即可一键生成封面图。\n\n完整代码如下：\n\n```go\nimport (\n\t\"github.com/disintegration/imaging\"\n\t\"github.com/fogleman/gg\"\n\t\"golang.org/x/image/font\"\n\t\"golang.org/x/image/font/opentype\"\n\t\"io/ioutil\"\n\t\"testing\"\n)\n\nfunc TestDrawWxPic(t *testing.T){\n\tgenerateWxImage(\"微信公众号封面图\\n一键生成\", \"result\")\n}\n\nfunc generateWxImage(title string, savingFileName string) {\n\twidth := 1050\n\theight := 442\n\tdc := gg.NewContext(width, height)\n\tdc.SetRGB255(47, 54, 66)\n\tdc.Clear()\n\n\tfontFilePath := \"FangZhengKaiTiJianTi.TTF\"\n\tfontFace, err := getOpenTypeFontFace(fontFilePath, 76, 72)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdc.SetFontFace(*fontFace)\n\tdc.SetRGB255(238, 241, 247)\n\n\t// 文本框最大宽度\n\tmaxWordsWidth := 660.0\n\tx := 665.0\n\ty := 224.0\n\tdc.DrawStringWrapped(title, x, y, 0.5, 0.6, maxWordsWidth, 1.1, gg.AlignCenter)\n\n\t//开始压缩图片\n\tsrc, openErr := imaging.Open(\"logo.png\")\n\tif openErr != nil {\n\t\tpanic(openErr)\n\t}\n\tsrc = imaging.Resize(src, 360, 360, imaging.Lanczos)\n\n\tdc.DrawImageAnchored(src, 182, 220, 0.5, 0.5)\n\n\tdc.SavePNG(savingFileName + \".png\")\n}\n\nfunc getOpenTypeFontFace(fontFilePath string, fontSize, dpi float64)(*font.Face, error){\n\tfontData, fontFileReadErr := ioutil.ReadFile(fontFilePath)\n\tif fontFileReadErr != nil {\n\t\treturn nil, fontFileReadErr\n\t}\n\totfFont, parseErr := opentype.Parse(fontData)\n\tif parseErr != nil {\n\t\treturn nil, parseErr\n\t}\n\totfFace, newFaceErr := opentype.NewFace(otfFont, &opentype.FaceOptions{\n\t\tSize: fontSize,\n\t\tDPI:  dpi,\n\t})\n\tif newFaceErr != nil {\n\t\treturn nil, newFaceErr\n\t}\n\treturn &otfFace, nil\n}\n```\n\n## 小结\n\n回顾一下整个过程，其实只要想清楚最终想要的效果，然后把步骤拆解开来，代码其实写起来并不复杂，重要的还是逻辑，至于类似于如何实现图片裁剪、文字拼接、图片缩放，这些通常都有现成的库可以拿来就用。\n\n当然，如果感兴趣也可以深入研究其中的实现原理。就像前面所说，了解这些工具，可以增加手中的牌，遇到问题时自然更加左右逢源。\n\n最近的大部分时间都花在了健身上，很长时间都没有好好写博客了，接下来得好好写文章了，光有输入确实还不够，用输出反推输入，会更加有的放矢。\n\n[//]: # (![]&#40;11.png&#41;)\n","slug":"picture/go-wx-pic-generator","published":1,"updated":"2021-08-01T11:48:23.000Z","_id":"cl70rsfbj000y5ohua65p291g","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"想法来源\"><a href=\"#想法来源\" class=\"headerlink\" title=\"想法来源\"></a>想法来源</h2><p>每次写文章都得花点时间找图，有点点麻烦，（其实就是懒。。。）。而且翻了翻之前的文章配图，大概是这个样子。</p>\n<p><img src=\"1.png\" alt=\"\"></p>\n<p>emmm，风格还挺统一的。但身为正义凛然的公众号博主，老是用这样图，会有些图文不符，也不符合我这正襟危坐的人物形象，而且，做为一名程序猿，能用代码解决的事情，自然要用代码来解决。</p>\n<p>最近看到有些技术类公众号，都使用了统一的图片模版，比如这样：</p>\n<p><img src=\"2.png\" alt=\"\"></p>\n<p>左边放上logo，右边放字，简约大气。于是，想着自己也整一个。</p>\n<p><img src=\"3.png\" alt=\"\"></p>\n<h2 id=\"图片分析\"><a href=\"#图片分析\" class=\"headerlink\" title=\"图片分析\"></a>图片分析</h2><p>要如何生成这样一张图呢，我们来简单来分析一下。</p>\n<p>最底层是一张纯色的底图，这个不难，之前已经介绍过如何绘制纯色底图了，具体颜色可以用工具吸色看看。</p>\n<p>第二层是文字，在前面的文章中，已经介绍过如何绘制文字，在这里刚好能用上。</p>\n<p>第三层是logo，还没有介绍过将一张图覆盖在另一张图上的操作，本文会对此进行讲解。</p>\n<p>这里还需要注意的就是文字跟logo的区域，在绘制时，需要将文本框和图片框的位置计算好，这个可以使用 Sketch 工具来完成。</p>\n<p><img src=\"4.jpg\" alt=\"\"></p>\n<p><img src=\"5.jpg\" alt=\"\"></p>\n<p><img src=\"6.jpg\" alt=\"\"></p>\n<p>这样就得到了Logo和文字位置的具体信息。</p>\n<p>接下来就可以开始写代码了</p>\n<h2 id=\"代码编写\"><a href=\"#代码编写\" class=\"headerlink\" title=\"代码编写\"></a>代码编写</h2><p>首先，我们先绘制一个纯色的背景。RGB色值为：(63, 64, 87)，底图的宽和高通过 Sketch 工具测出分别为 1050和442。</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"github.com/fogleman/gg\"</span>\n    <span class=\"token string\">\"testing\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">TestDrawWxPic</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    weight <span class=\"token operator\">:=</span> <span class=\"token number\">1050</span>\n    height <span class=\"token operator\">:=</span> <span class=\"token number\">442</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>weight<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB255</span><span class=\"token punctuation\">(</span><span class=\"token number\">63</span><span class=\"token punctuation\">,</span> <span class=\"token number\">64</span><span class=\"token punctuation\">,</span> <span class=\"token number\">87</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>输出图片如下：</p>\n<p><img src=\"7.png\" alt=\"\"></p>\n<p>然后来绘制第二层的文字：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"github.com/fogleman/gg\"</span>\n    <span class=\"token string\">\"golang.org/x/image/font\"</span>\n    <span class=\"token string\">\"golang.org/x/image/font/opentype\"</span>\n    <span class=\"token string\">\"io/ioutil\"</span>\n    <span class=\"token string\">\"testing\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">TestDrawWxPic</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    width <span class=\"token operator\">:=</span> <span class=\"token number\">1050</span>\n    height <span class=\"token operator\">:=</span> <span class=\"token number\">442</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB255</span><span class=\"token punctuation\">(</span><span class=\"token number\">63</span><span class=\"token punctuation\">,</span> <span class=\"token number\">64</span><span class=\"token punctuation\">,</span> <span class=\"token number\">87</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    fontFilePath <span class=\"token operator\">:=</span> <span class=\"token string\">\"/Users/bytedance/Downloads/FangZhengKaiTiJianTi.TTF\"</span>\n    fontFace<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> <span class=\"token function\">getOpenTypeFontFace</span><span class=\"token punctuation\">(</span>fontFilePath<span class=\"token punctuation\">,</span> <span class=\"token number\">76</span><span class=\"token punctuation\">,</span> <span class=\"token number\">72</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetFontFace</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>fontFace<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB255</span><span class=\"token punctuation\">(</span><span class=\"token number\">238</span><span class=\"token punctuation\">,</span> <span class=\"token number\">241</span><span class=\"token punctuation\">,</span> <span class=\"token number\">247</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 文本框最大宽度</span>\n    maxWordsWidth <span class=\"token operator\">:=</span> <span class=\"token number\">660.0</span>\n    x <span class=\"token operator\">:=</span> <span class=\"token number\">645.0</span>\n    y <span class=\"token operator\">:=</span> <span class=\"token number\">224.0</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringWrapped</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"高并发的秘密武器 epoll 机制\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">,</span> maxWordsWidth<span class=\"token punctuation\">,</span> <span class=\"token number\">1.1</span><span class=\"token punctuation\">,</span> gg<span class=\"token punctuation\">.</span>AlignCenter<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">getOpenTypeFontFace</span><span class=\"token punctuation\">(</span>fontFilePath <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> fontSize<span class=\"token punctuation\">,</span> dpi <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>font<span class=\"token punctuation\">.</span>Face<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    fontData<span class=\"token punctuation\">,</span> fontFileReadErr <span class=\"token operator\">:=</span> ioutil<span class=\"token punctuation\">.</span><span class=\"token function\">ReadFile</span><span class=\"token punctuation\">(</span>fontFilePath<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> fontFileReadErr <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> fontFileReadErr\n    <span class=\"token punctuation\">}</span>\n    otfFont<span class=\"token punctuation\">,</span> parseErr <span class=\"token operator\">:=</span> opentype<span class=\"token punctuation\">.</span><span class=\"token function\">Parse</span><span class=\"token punctuation\">(</span>fontData<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> parseErr <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> parseErr\n    <span class=\"token punctuation\">}</span>\n    otfFace<span class=\"token punctuation\">,</span> newFaceErr <span class=\"token operator\">:=</span> opentype<span class=\"token punctuation\">.</span><span class=\"token function\">NewFace</span><span class=\"token punctuation\">(</span>otfFont<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>opentype<span class=\"token punctuation\">.</span>FaceOptions<span class=\"token punctuation\">{</span>\n        Size<span class=\"token punctuation\">:</span> fontSize<span class=\"token punctuation\">,</span>\n        DPI<span class=\"token punctuation\">:</span>  dpi<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> newFaceErr <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> newFaceErr\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&amp;</span>otfFace<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><strong>DrawStringWrapped</strong> 方法已经在之前的文章中介绍过了，这里就不缀述了，文本框的位置可以通过 (x,y,ax,ay)这四个参数来调整。</p>\n<p>输出效果如下：</p>\n<p><img src=\"8.png\" alt=\"\"></p>\n<p>字体不太一样，位置是差不多了。</p>\n<p>最后来把logo拼上去：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"github.com/disintegration/imaging\"</span>\n    <span class=\"token string\">\"github.com/fogleman/gg\"</span>\n    <span class=\"token string\">\"golang.org/x/image/font\"</span>\n    <span class=\"token string\">\"golang.org/x/image/font/opentype\"</span>\n    <span class=\"token string\">\"io/ioutil\"</span>\n    <span class=\"token string\">\"testing\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">TestDrawWxPic</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringWrapped</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"高并发的秘密武器 epoll 机制\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">,</span> maxWordsWidth<span class=\"token punctuation\">,</span> <span class=\"token number\">1.1</span><span class=\"token punctuation\">,</span> gg<span class=\"token punctuation\">.</span>AlignCenter<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">//开始压缩图片</span>\n    src<span class=\"token punctuation\">,</span> openErr <span class=\"token operator\">:=</span> imaging<span class=\"token punctuation\">.</span><span class=\"token function\">Open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"logo.png\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> openErr <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>openErr<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    src <span class=\"token operator\">=</span> imaging<span class=\"token punctuation\">.</span><span class=\"token function\">Resize</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">,</span> <span class=\"token number\">240</span><span class=\"token punctuation\">,</span> <span class=\"token number\">240</span><span class=\"token punctuation\">,</span> imaging<span class=\"token punctuation\">.</span>Lanczos<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawImageAnchored</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">,</span> <span class=\"token number\">182</span><span class=\"token punctuation\">,</span> <span class=\"token number\">220</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"out.png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><code>fogleman/gg</code> 包不支持对图片使用 resize 的操作，因此这里引入了一个新包，”github.com/disintegration/imaging”。效果如下：</p>\n<p><img src=\"9.png\" alt=\"\"></p>\n<p>emm，看起来颜色有些不谐调，改一下背景色，然后放大一下logo试试：</p>\n<p><img src=\"10.png\" alt=\"\"></p>\n<p>嗯，这样就好多了，把这段代码封装成方法，传入标题和文件保存位置，即可一键生成封面图。</p>\n<p>完整代码如下：</p>\n<pre class=\" language-go\"><code class=\"language-go\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"github.com/disintegration/imaging\"</span>\n    <span class=\"token string\">\"github.com/fogleman/gg\"</span>\n    <span class=\"token string\">\"golang.org/x/image/font\"</span>\n    <span class=\"token string\">\"golang.org/x/image/font/opentype\"</span>\n    <span class=\"token string\">\"io/ioutil\"</span>\n    <span class=\"token string\">\"testing\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">TestDrawWxPic</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">*</span>testing<span class=\"token punctuation\">.</span>T<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">generateWxImage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"微信公众号封面图\\n一键生成\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"result\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">generateWxImage</span><span class=\"token punctuation\">(</span>title <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> savingFileName <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    width <span class=\"token operator\">:=</span> <span class=\"token number\">1050</span>\n    height <span class=\"token operator\">:=</span> <span class=\"token number\">442</span>\n    dc <span class=\"token operator\">:=</span> gg<span class=\"token punctuation\">.</span><span class=\"token function\">NewContext</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB255</span><span class=\"token punctuation\">(</span><span class=\"token number\">47</span><span class=\"token punctuation\">,</span> <span class=\"token number\">54</span><span class=\"token punctuation\">,</span> <span class=\"token number\">66</span><span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    fontFilePath <span class=\"token operator\">:=</span> <span class=\"token string\">\"FangZhengKaiTiJianTi.TTF\"</span>\n    fontFace<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> <span class=\"token function\">getOpenTypeFontFace</span><span class=\"token punctuation\">(</span>fontFilePath<span class=\"token punctuation\">,</span> <span class=\"token number\">76</span><span class=\"token punctuation\">,</span> <span class=\"token number\">72</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetFontFace</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>fontFace<span class=\"token punctuation\">)</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SetRGB255</span><span class=\"token punctuation\">(</span><span class=\"token number\">238</span><span class=\"token punctuation\">,</span> <span class=\"token number\">241</span><span class=\"token punctuation\">,</span> <span class=\"token number\">247</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 文本框最大宽度</span>\n    maxWordsWidth <span class=\"token operator\">:=</span> <span class=\"token number\">660.0</span>\n    x <span class=\"token operator\">:=</span> <span class=\"token number\">665.0</span>\n    y <span class=\"token operator\">:=</span> <span class=\"token number\">224.0</span>\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawStringWrapped</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">,</span> maxWordsWidth<span class=\"token punctuation\">,</span> <span class=\"token number\">1.1</span><span class=\"token punctuation\">,</span> gg<span class=\"token punctuation\">.</span>AlignCenter<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">//开始压缩图片</span>\n    src<span class=\"token punctuation\">,</span> openErr <span class=\"token operator\">:=</span> imaging<span class=\"token punctuation\">.</span><span class=\"token function\">Open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"logo.png\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> openErr <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>openErr<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    src <span class=\"token operator\">=</span> imaging<span class=\"token punctuation\">.</span><span class=\"token function\">Resize</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">,</span> <span class=\"token number\">360</span><span class=\"token punctuation\">,</span> <span class=\"token number\">360</span><span class=\"token punctuation\">,</span> imaging<span class=\"token punctuation\">.</span>Lanczos<span class=\"token punctuation\">)</span>\n\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawImageAnchored</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">,</span> <span class=\"token number\">182</span><span class=\"token punctuation\">,</span> <span class=\"token number\">220</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n\n    dc<span class=\"token punctuation\">.</span><span class=\"token function\">SavePNG</span><span class=\"token punctuation\">(</span>savingFileName <span class=\"token operator\">+</span> <span class=\"token string\">\".png\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">getOpenTypeFontFace</span><span class=\"token punctuation\">(</span>fontFilePath <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> fontSize<span class=\"token punctuation\">,</span> dpi <span class=\"token builtin\">float64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>font<span class=\"token punctuation\">.</span>Face<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    fontData<span class=\"token punctuation\">,</span> fontFileReadErr <span class=\"token operator\">:=</span> ioutil<span class=\"token punctuation\">.</span><span class=\"token function\">ReadFile</span><span class=\"token punctuation\">(</span>fontFilePath<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> fontFileReadErr <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> fontFileReadErr\n    <span class=\"token punctuation\">}</span>\n    otfFont<span class=\"token punctuation\">,</span> parseErr <span class=\"token operator\">:=</span> opentype<span class=\"token punctuation\">.</span><span class=\"token function\">Parse</span><span class=\"token punctuation\">(</span>fontData<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> parseErr <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> parseErr\n    <span class=\"token punctuation\">}</span>\n    otfFace<span class=\"token punctuation\">,</span> newFaceErr <span class=\"token operator\">:=</span> opentype<span class=\"token punctuation\">.</span><span class=\"token function\">NewFace</span><span class=\"token punctuation\">(</span>otfFont<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>opentype<span class=\"token punctuation\">.</span>FaceOptions<span class=\"token punctuation\">{</span>\n        Size<span class=\"token punctuation\">:</span> fontSize<span class=\"token punctuation\">,</span>\n        DPI<span class=\"token punctuation\">:</span>  dpi<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> newFaceErr <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> newFaceErr\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&amp;</span>otfFace<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>回顾一下整个过程，其实只要想清楚最终想要的效果，然后把步骤拆解开来，代码其实写起来并不复杂，重要的还是逻辑，至于类似于如何实现图片裁剪、文字拼接、图片缩放，这些通常都有现成的库可以拿来就用。</p>\n<p>当然，如果感兴趣也可以深入研究其中的实现原理。就像前面所说，了解这些工具，可以增加手中的牌，遇到问题时自然更加左右逢源。</p>\n<p>最近的大部分时间都花在了健身上，很长时间都没有好好写博客了，接下来得好好写文章了，光有输入确实还不够，用输出反推输入，会更加有的放矢。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<h2 id=\"想法来源\"><a href=\"#想法来源\" class=\"headerlink\" title=\"想法来源\"></a>想法来源</h2><p>每次写文章都得花点时间找图，有点点麻烦，（其实就是懒。。。）。而且翻了翻之前的文章配图，大概是这个样子。</p>\n<p><img src=\"1.png\" alt=\"\"></p>\n<p>emmm，风格还挺统一的。但身为正义凛然的公众号博主，老是用这样图，会有些图文不符，也不符合我这正襟危坐的人物形象，而且，做为一名程序猿，能用代码解决的事情，自然要用代码来解决。</p>\n<p>最近看到有些技术类公众号，都使用了统一的图片模版，比如这样：</p>\n<p><img src=\"2.png\" alt=\"\"></p>\n<p>左边放上logo，右边放字，简约大气。于是，想着自己也整一个。</p>\n<p><img src=\"3.png\" alt=\"\"></p>\n<h2 id=\"图片分析\"><a href=\"#图片分析\" class=\"headerlink\" title=\"图片分析\"></a>图片分析</h2><p>要如何生成这样一张图呢，我们来简单来分析一下。</p>\n<p>最底层是一张纯色的底图，这个不难，之前已经介绍过如何绘制纯色底图了，具体颜色可以用工具吸色看看。</p>\n<p>第二层是文字，在前面的文章中，已经介绍过如何绘制文字，在这里刚好能用上。</p>\n<p>第三层是logo，还没有介绍过将一张图覆盖在另一张图上的操作，本文会对此进行讲解。</p>\n<p>这里还需要注意的就是文字跟logo的区域，在绘制时，需要将文本框和图片框的位置计算好，这个可以使用 Sketch 工具来完成。</p>\n<p><img src=\"4.jpg\" alt=\"\"></p>\n<p><img src=\"5.jpg\" alt=\"\"></p>\n<p><img src=\"6.jpg\" alt=\"\"></p>\n<p>这样就得到了Logo和文字位置的具体信息。</p>\n<p>接下来就可以开始写代码了</p>\n<h2 id=\"代码编写\"><a href=\"#代码编写\" class=\"headerlink\" title=\"代码编写\"></a>代码编写</h2><p>首先，我们先绘制一个纯色的背景。RGB色值为：(63, 64, 87)，底图的宽和高通过 Sketch 工具测出分别为 1050和442。</p>\n<pre><code class=\"go\">import (\n    &quot;github.com/fogleman/gg&quot;\n    &quot;testing&quot;\n)\n\nfunc TestDrawWxPic(t *testing.T){\n    weight := 1050\n    height := 442\n    dc := gg.NewContext(weight, height)\n    dc.SetRGB255(63, 64, 87)\n    dc.Clear()\n    dc.SavePNG(&quot;out.png&quot;)\n}</code></pre>\n<p>输出图片如下：</p>\n<p><img src=\"7.png\" alt=\"\"></p>\n<p>然后来绘制第二层的文字：</p>\n<pre><code class=\"go\">import (\n    &quot;github.com/fogleman/gg&quot;\n    &quot;golang.org/x/image/font&quot;\n    &quot;golang.org/x/image/font/opentype&quot;\n    &quot;io/ioutil&quot;\n    &quot;testing&quot;\n)\n\nfunc TestDrawWxPic(t *testing.T){\n    width := 1050\n    height := 442\n    dc := gg.NewContext(width, height)\n    dc.SetRGB255(63, 64, 87)\n    dc.Clear()\n\n    fontFilePath := &quot;/Users/bytedance/Downloads/FangZhengKaiTiJianTi.TTF&quot;\n    fontFace, err := getOpenTypeFontFace(fontFilePath, 76, 72)\n    if err != nil {\n        panic(err)\n    }\n    dc.SetFontFace(*fontFace)\n    dc.SetRGB255(238, 241, 247)\n\n    // 文本框最大宽度\n    maxWordsWidth := 660.0\n    x := 645.0\n    y := 224.0\n    dc.DrawStringWrapped(&quot;高并发的秘密武器 epoll 机制&quot;, x, y, 0.5, 0.6, maxWordsWidth, 1.1, gg.AlignCenter)\n    dc.SavePNG(&quot;out.png&quot;)\n}\n\nfunc getOpenTypeFontFace(fontFilePath string, fontSize, dpi float64)(*font.Face, error){\n    fontData, fontFileReadErr := ioutil.ReadFile(fontFilePath)\n    if fontFileReadErr != nil {\n        return nil, fontFileReadErr\n    }\n    otfFont, parseErr := opentype.Parse(fontData)\n    if parseErr != nil {\n        return nil, parseErr\n    }\n    otfFace, newFaceErr := opentype.NewFace(otfFont, &amp;opentype.FaceOptions{\n        Size: fontSize,\n        DPI:  dpi,\n    })\n    if newFaceErr != nil {\n        return nil, newFaceErr\n    }\n    return &amp;otfFace, nil\n}</code></pre>\n<p><strong>DrawStringWrapped</strong> 方法已经在之前的文章中介绍过了，这里就不缀述了，文本框的位置可以通过 (x,y,ax,ay)这四个参数来调整。</p>\n<p>输出效果如下：</p>\n<p><img src=\"8.png\" alt=\"\"></p>\n<p>字体不太一样，位置是差不多了。</p>\n<p>最后来把logo拼上去：</p>\n<pre><code class=\"go\">import (\n    &quot;github.com/disintegration/imaging&quot;\n    &quot;github.com/fogleman/gg&quot;\n    &quot;golang.org/x/image/font&quot;\n    &quot;golang.org/x/image/font/opentype&quot;\n    &quot;io/ioutil&quot;\n    &quot;testing&quot;\n)\n\nfunc TestDrawWxPic(t *testing.T){\n    ...\n    dc.DrawStringWrapped(&quot;高并发的秘密武器 epoll 机制&quot;, x, y, 0.5, 0.6, maxWordsWidth, 1.1, gg.AlignCenter)\n\n    //开始压缩图片\n    src, openErr := imaging.Open(&quot;logo.png&quot;)\n    if openErr != nil {\n        panic(openErr)\n    }\n    src = imaging.Resize(src, 240, 240, imaging.Lanczos)\n    dc.DrawImageAnchored(src, 182, 220, 0.5, 0.5)\n    dc.SavePNG(&quot;out.png&quot;)\n}</code></pre>\n<p><code>fogleman/gg</code> 包不支持对图片使用 resize 的操作，因此这里引入了一个新包，”github.com/disintegration/imaging”。效果如下：</p>\n<p><img src=\"9.png\" alt=\"\"></p>\n<p>emm，看起来颜色有些不谐调，改一下背景色，然后放大一下logo试试：</p>\n<p><img src=\"10.png\" alt=\"\"></p>\n<p>嗯，这样就好多了，把这段代码封装成方法，传入标题和文件保存位置，即可一键生成封面图。</p>\n<p>完整代码如下：</p>\n<pre><code class=\"go\">import (\n    &quot;github.com/disintegration/imaging&quot;\n    &quot;github.com/fogleman/gg&quot;\n    &quot;golang.org/x/image/font&quot;\n    &quot;golang.org/x/image/font/opentype&quot;\n    &quot;io/ioutil&quot;\n    &quot;testing&quot;\n)\n\nfunc TestDrawWxPic(t *testing.T){\n    generateWxImage(&quot;微信公众号封面图\\n一键生成&quot;, &quot;result&quot;)\n}\n\nfunc generateWxImage(title string, savingFileName string) {\n    width := 1050\n    height := 442\n    dc := gg.NewContext(width, height)\n    dc.SetRGB255(47, 54, 66)\n    dc.Clear()\n\n    fontFilePath := &quot;FangZhengKaiTiJianTi.TTF&quot;\n    fontFace, err := getOpenTypeFontFace(fontFilePath, 76, 72)\n    if err != nil {\n        panic(err)\n    }\n    dc.SetFontFace(*fontFace)\n    dc.SetRGB255(238, 241, 247)\n\n    // 文本框最大宽度\n    maxWordsWidth := 660.0\n    x := 665.0\n    y := 224.0\n    dc.DrawStringWrapped(title, x, y, 0.5, 0.6, maxWordsWidth, 1.1, gg.AlignCenter)\n\n    //开始压缩图片\n    src, openErr := imaging.Open(&quot;logo.png&quot;)\n    if openErr != nil {\n        panic(openErr)\n    }\n    src = imaging.Resize(src, 360, 360, imaging.Lanczos)\n\n    dc.DrawImageAnchored(src, 182, 220, 0.5, 0.5)\n\n    dc.SavePNG(savingFileName + &quot;.png&quot;)\n}\n\nfunc getOpenTypeFontFace(fontFilePath string, fontSize, dpi float64)(*font.Face, error){\n    fontData, fontFileReadErr := ioutil.ReadFile(fontFilePath)\n    if fontFileReadErr != nil {\n        return nil, fontFileReadErr\n    }\n    otfFont, parseErr := opentype.Parse(fontData)\n    if parseErr != nil {\n        return nil, parseErr\n    }\n    otfFace, newFaceErr := opentype.NewFace(otfFont, &amp;opentype.FaceOptions{\n        Size: fontSize,\n        DPI:  dpi,\n    })\n    if newFaceErr != nil {\n        return nil, newFaceErr\n    }\n    return &amp;otfFace, nil\n}</code></pre>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>回顾一下整个过程，其实只要想清楚最终想要的效果，然后把步骤拆解开来，代码其实写起来并不复杂，重要的还是逻辑，至于类似于如何实现图片裁剪、文字拼接、图片缩放，这些通常都有现成的库可以拿来就用。</p>\n<p>当然，如果感兴趣也可以深入研究其中的实现原理。就像前面所说，了解这些工具，可以增加手中的牌，遇到问题时自然更加左右逢源。</p>\n<p>最近的大部分时间都花在了健身上，很长时间都没有好好写博客了，接下来得好好写文章了，光有输入确实还不够，用输出反推输入，会更加有的放矢。</p>\n"},{"title":"【RabbitMQ】如何进行消息可靠投递【上篇】","toc":true,"top":true,"cover":true,"date":"2020-05-03T17:00:20.000Z","_content":"\n## 说明\n\n前几天，突然发生线上报警，钉钉连发了好几条消息，一看是*RabbitMQ*相关的消息，心头一紧，难道翻车了？\n\n![u=1091165172,1855706818&fm=26&gp=0.jpg](https://i.loli.net/2019/08/19/o3ZELv7GkRImstJ.jpg)\n\n```java\n[橙色报警] 应用[xxx]在[08-15 16:36:04]发生[错误日志异常]，alertId=[xxx]。由[org.springframework.amqp.rabbit.listener.BlockingQueueConsumer:start:620]触发。\n应用xxx 可能原因如下\n服务名为：\n 异常为：org.springframework.amqp.rabbit.listener.BlockingQueueConsumer:start:620\n 产生原因如下:\n1.org.springframework.amqp.rabbit.listener.QueuesNotAvailableException: Cannot prepare queue for listener. Either the queue doesn't exist or the broker will not allow us to use it.\n||Consumer received fatal=false exception on startup:\n...\n应用xxx 可能原因如下\n服务名为：\n 异常为：org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer:run:1160\n 产生原因如下:\n1.Stopping container from aborted consumer||Stopping container from aborted consumer:\n```\n\n定睛一看，看样子像是消费者莫名其妙断开了连接，正逢公司搬家之际，难道是机房又双叒叕。。。。断电了？于是赶紧联系了运维，咨询*RabbitMQ*是否发生了调整。几分钟后，得到了运维的回复，由于一些不可描述的原因，*RabbitMQ*进行了重启，emmmm，虽然重启只持续了10分钟，但是导致该集群下所有消费者都挂了，需要将项目重启后才能正常进行消费。\n\n项目重启后，一切似乎又正常运转起来，但好景不长，没过多久，工单就找上了门来，经过排查，发现是生产者在*RabbitMQ*重启期间消息投递失败，导致消息丢失，需要手动处理和恢复。\n\n于是，我开始思考，如何才能进行*RabbitMQ*的消息可靠投递呢？特别是在这样比较极端的情况，*RabbitMQ*集群不可用的时候，无法投递的消息该如何处理呢？\n\n## 可靠投递\n\n先来说明一个概念，什么是可靠投递呢？在*RabbitMQ*中，一个消息从生产者发送到*RabbitMQ*服务器，需要经历这么几个步骤：\n\n1. 生产者准备好需要投递的消息。\n2. 生产者与*RabbitMQ*服务器建立连接。\n3. 生产者发送消息。\n4. *RabbitMQ*服务器接收到消息，并将其路由到指定队列。\n5. *RabbitMQ*服务器发起回调，告知生产者消息发送成功。\n\n所谓可靠投递，就是确保消息能够百分百从生产者发送到服务器。\n\n![{6582FAF9-A46E-4239-810B-E1D6883ED070}.png.jpg](https://i.loli.net/2019/08/18/yHcfoILDmTh7qbd.jpg)\n\n为了避免争议，补充说明一下，如果没有设置*Mandatory*参数，是不需要先路由消息才发起回调的，服务器收到消息后就会进行回调确认。\n\n2、3、5步都是通过*TCP*连接进行交互，有网络调用的地方就会有事故，网络波动随时都有可能发生，不管是内部机房停电，还是外部光缆被切，网络事故无法预测，虽然这些都是小概率事件，但对于订单等敏感数据处理来说，这些情况下导致消息丢失都是不可接受的。\n\n![20170716034945131.jpg](https://i.loli.net/2019/08/19/Fwp87UqONIKCZsJ.jpg)\n\n## RabbitMQ中的消息可靠投递\n\n默认情况下，发送消息的操作是不会返回任何信息给生产者的，也就是说，默认情况下生产者是不知道消息有没有正确地到达服务器。\n\n那么如何解决这个问题呢？\n\n对此，*RabbitMQ*中有一些相关的解决方案：\n\n1. 使用事务机制来让生产者感知消息被成功投递到服务器。\n2. 通过生产者确认机制实现。\n\n在*RabbitMQ*中，所有确保消息可靠投递的机制都会对性能产生一定影响，如使用不当，可能会对吞吐量造成重大影响，只有通过执行性能基准测试，才能在确定性能与可靠投递之间的平衡。\n\n在使用可靠投递前，需要先思考以下问题：\n\n1. 消息发布时，保证消息进入队列的重要性有多高？\n2. 如果消息无法进行路由，是否应该将该消息返回给发布者？\n3. 如果消息无法被路由，是否应该将其发送到其他地方稍后再重新进行路由？\n4. 如果*RabbitMQ*服务器崩溃了，是否可以接受消息丢失？\n5. *RabbitMQ*在处理新消息时是否应该确认它已经为发布者执行了所有请求的路由和持久化？\n6. 消息发布者是否可以批量投递消息？\n7. 在可靠投递上是否有可以接受的平衡性？是否可以接受一部分的不可靠性来提升性能？\n\n只考虑平衡性不考虑性能是不行的，至于这个平衡的度具体如何把握，就要具体情况具体分析了，比如像订单数据这样敏感的信息，对可靠性的要求自然要比一般的业务消息对可靠性的要求高的多，因为订单数据是跟钱直接相关的，可能会导致直接的经济损失。\n\n所以不仅应该知道有哪些保证消息可靠性的解决方案，还应该知道每种方案对性能的影响程度，以此来进行方案的选择。\n\n### RabbitMQ的事务机制\n\n*RabbitMQ*是支持*AMQP*事务机制的，在生产者确认机制之前，事务是确保消息被成功投递的唯一方法。\n\n在*SpringBoot*项目中，使用*RabbitMQ*事务其实很简单，只需要声明一个事务管理的*Bean*，并将*RabbitTemplate*的事务设置为true即可。\n\n配置文件如下：\n\n```yml\nspring:\n  rabbitmq:\n    host: localhost\n    password: guest\n    username: guest\n    listener:\n      type: simple\n      simple:\n        default-requeue-rejected: false\n        acknowledge-mode: manual\n```\n\n先来配置一下交换机和队列，以及事务管理器。\n\n```java\n@Configuration\npublic class RabbitMQConfig {\n\n    public static final String BUSINESS_EXCHANGE_NAME = \"rabbitmq.tx.demo.simple.business.exchange\";\n    public static final String BUSINESS_QUEUEA_NAME = \"rabbitmq.tx.demo.simple.business.queue\";\n\n    // 声明业务Exchange\n    @Bean(\"businessExchange\")\n    public FanoutExchange businessExchange(){\n        return new FanoutExchange(BUSINESS_EXCHANGE_NAME);\n    }\n\n    // 声明业务队列\n    @Bean(\"businessQueue\")\n    public Queue businessQueue(){\n        return QueueBuilder.durable(BUSINESS_QUEUEA_NAME).build();\n    }\n\n    // 声明业务队列绑定关系\n    @Bean\n    public Binding businessBinding(@Qualifier(\"businessQueue\") Queue queue,\n                                    @Qualifier(\"businessExchange\") FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n\n    /**\n     * 配置启用rabbitmq事务\n     * @param connectionFactory\n     * @return\n     */\n    @Bean\n    public RabbitTransactionManager rabbitTransactionManager(CachingConnectionFactory connectionFactory) {\n        return new RabbitTransactionManager(connectionFactory);\n    }\n}\n```\n\n然后创建一个消费者，来监听消息，用以判断消息是否成功发送。\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgConsumer {\n\n\n    @RabbitListener(queues = BUSINESS_QUEUEA_NAME)\n    public void receiveMsg(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(\"收到业务消息：{}\", msg);\n        channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, false);\n    }\n}\n```\n\n然后是消息生产者：\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgProducer{\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    private void init() {\n        rabbitTemplate.setChannelTransacted(true);\n    }\n\n    @Transactional\n    public void sendMsg(String msg) {\n        rabbitTemplate.convertAndSend(BUSINESS_EXCHANGE_NAME, \"key\", msg);\n        if (msg != null && msg.contains(\"exception\"))\n            throw new RuntimeException(\"surprise!\");\n        log.info(\"消息已发送 {}\" ,msg);\n    }\n}\n```\n\n这里有两个注意的地方：\n\n1. 在初始化方法里，通过使用` rabbitTemplate.setChannelTransacted(true);` 来开启事务。\n2. 在发送消息的方法上加上 `@Transactional` 注解，这样在该方法中发生异常时，消息将不会发送。\n\n在controller中加一个接口来生产消息：\n\n```java\n@RestController\npublic class BusinessController {\n\n    @Autowired\n    private BusinessMsgProducer producer;\n\n    @RequestMapping(\"send\")\n    public void sendMsg(String msg){\n        producer.sendMsg(msg);\n    }\n}\n```\n\n来验证一下：\n\n```shell\nmsg:1\n消息已发送 1\n收到业务消息：1\nmsg:2\n消息已发送 2\n收到业务消息：2\nmsg:3\n消息已发送 3\n收到业务消息：3\nmsg:exception\n\nServlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.RuntimeException: surprise!] with root cause\n\njava.lang.RuntimeException: surprise!\n\tat com.mfrank.rabbitmqdemo.producer.BusinessMsgProducer.sendMsg(BusinessMsgProducer.java:30)\n    ...\n```\n\n当 `msg` 的值为 `exception` 时， 在调用`rabbitTemplate.convertAndSend` 方法之后，程序抛出了异常，消息并没有发送出去，而是被当前事务回滚了。\n\n当然，你可以将事务管理器注释掉，或者将初始化方法的开启事务注释掉，这样事务就不会生效，即使在调用了发送消息方法之后，程序发生了异常，消息也会被正常发送和消费。\n\nRabbitMQ中的事务使用起来虽然简单，但是对性能的影响是不可忽视的，因为每次事务的提交都是阻塞式的等待服务器处理返回结果，而默认模式下，客户端是不需要等待的，直接发送就完事了，除此之外，事务消息需要比普通消息多4次与服务器的交互，这就意味着会占用更多的处理时间，所以如果对消息处理速度有较高要求时，尽量不要采用事务机制。\n\n### RabbitMQ的生产者确认机制\n\n*RabbitMQ*中的生产者确认功能是*AMQP*规范的增强功能，当生产者发布给所有队列的已路由消息被消费者应用程序直接消费时，或者消息被放入队列并根据需要进行持久化时，一个*Basic.Ack*请求会被发送到生产者，如果消息无法路由，代理服务器将发送一个*Basic.Nack* RPC请求用于表示失败。然后由生产者决定该如何处理该消息。\n\n也就是说，通过生产者确认机制，生产者可以在消息被服务器成功接收时得到反馈，并有机会处理未被成功接收的消息。\n\n在Springboot中开启RabbitMQ的生产者确认模式也很简单，只多了一行配置：\n\n```yml\nspring:\n  rabbitmq:\n    host: localhost\n    password: guest\n    username: guest\n    listener:\n      type: simple\n      simple:\n        default-requeue-rejected: false\n        acknowledge-mode: manual\n    publisher-confirms: true\n```\n\n` publisher-confirms: true` 即表示开启生产者确认模式。\n\n然后将消息生产者的代表进行部分修改：\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgProducer implements RabbitTemplate.ConfirmCallback{\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    private void init() {\n//        rabbitTemplate.setChannelTransacted(true);\n        rabbitTemplate.setConfirmCallback(this);\n    }\n\n    public void sendCustomMsg(String exchange, String msg) {\n        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key\", msg, correlationData);\n    }\n    \n    @Override\n    public void confirm(CorrelationData correlationData, boolean b, String s) {\n        String id = correlationData != null ? correlationData.getId() : \"\";\n        if (b) {\n            log.info(\"消息确认成功, id:{}\", id);\n        } else {\n            log.error(\"消息未成功投递, id:{}, cause:{}\", id, s);\n        }\n    }\n}\n```\n\n让生产者继承自`RabbitTemplate.ConfirmCallback` 类，然后实现其`confirm` 方法，即可用其接收服务器回调。\n\n需要注意的是，在发送消息时，代码也进行了调整：\n\n```java\nCorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\nrabbitTemplate.convertAndSend(exchange, \"key\", msg, correlationData);\n```\n\n这里我们为消息设置了消息ID，以便在回调时通过该ID来判断是对哪个消息的回调，因为在回调函数中，我们是无法直接获取到消息内容的，所以需要将消息先暂存起来，根据消息的重要程度，可以考虑使用本地缓存，或者存入*Redis*中，或者*Mysql*中，然后在回调时更新其状态或者从缓存中移除，最后使用定时任务对一段时间内未发送的消息进行重新投递。\n\n以下是我盗来的图，原谅我偷懒不想画了[手动狗头]：\n\n![5b65729e0001439305000294.jpg](https://i.loli.net/2019/08/19/CO5bs2xwh4WHFpM.png)\n\n另外，还需要注意的是，如果将消息发布到不存在的交换机上，那么发布用的信道将会被*RabbitMQ*关闭。\n\n此外，生产者确认机制跟事务是不能一起工作的，是事务的轻量级替代方案。因为事务和发布者确认模式都是需要先跟服务器协商，对信道启用的一种模式，不能对同一个信道同时使用两种模式。\n\n在生产者确认模式中，消息的确认可以是异步和批量的，所以相比使用事务，性能会更好。\n\n使用事务机制和生产者确认机制都能确保消息被正确的发送至*RabbitMQ*，这里的“正确发送至RabbitMQ”说的是消息成功被交换机接收，但如果找不到能接收该消息的队列，这条消息也会丢失。至于如何处理那些无法被投递到队列的消息，将会在下篇进行说明。\n\n## 结题\n\n所以当公司机房“断电”时，如何处理那些需要发送的消息呢？相信看完上文之后，你的心中已经有了答案。\n\n一般来说，这种“断电”不会持续较长时间，一般几分钟到半小时之间，很快能够恢复，所以如果是重要消息，可以保存到数据库中，如果是非重要消息，可以使用*redis*进行保存，当然，还要根据消息的数量级来进行判断。\n\n如果消息量比较大，可以考虑将消息发送到另一个集群的死信队列中，事实上，所在公司就有两个*RabbitMQ*集群，所以当一个集群不可用时，可以往另一个集群发消息，emmm，如果两个机房都停电了的话，当我没说。\n\n![111.png.jpg](https://i.loli.net/2019/08/19/c8ZGAL7OEPQTeWM.jpg)","source":"_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message.md","raw":"---\ntitle: 【RabbitMQ】如何进行消息可靠投递【上篇】\ntags:\n  - RabbitMQ\ncategories:\n  - 编程\ntoc: true\ntop: true\ncover: true\ndate: 2020-05-04 01:00:20\n---\n\n## 说明\n\n前几天，突然发生线上报警，钉钉连发了好几条消息，一看是*RabbitMQ*相关的消息，心头一紧，难道翻车了？\n\n![u=1091165172,1855706818&fm=26&gp=0.jpg](https://i.loli.net/2019/08/19/o3ZELv7GkRImstJ.jpg)\n\n```java\n[橙色报警] 应用[xxx]在[08-15 16:36:04]发生[错误日志异常]，alertId=[xxx]。由[org.springframework.amqp.rabbit.listener.BlockingQueueConsumer:start:620]触发。\n应用xxx 可能原因如下\n服务名为：\n 异常为：org.springframework.amqp.rabbit.listener.BlockingQueueConsumer:start:620\n 产生原因如下:\n1.org.springframework.amqp.rabbit.listener.QueuesNotAvailableException: Cannot prepare queue for listener. Either the queue doesn't exist or the broker will not allow us to use it.\n||Consumer received fatal=false exception on startup:\n...\n应用xxx 可能原因如下\n服务名为：\n 异常为：org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer:run:1160\n 产生原因如下:\n1.Stopping container from aborted consumer||Stopping container from aborted consumer:\n```\n\n定睛一看，看样子像是消费者莫名其妙断开了连接，正逢公司搬家之际，难道是机房又双叒叕。。。。断电了？于是赶紧联系了运维，咨询*RabbitMQ*是否发生了调整。几分钟后，得到了运维的回复，由于一些不可描述的原因，*RabbitMQ*进行了重启，emmmm，虽然重启只持续了10分钟，但是导致该集群下所有消费者都挂了，需要将项目重启后才能正常进行消费。\n\n项目重启后，一切似乎又正常运转起来，但好景不长，没过多久，工单就找上了门来，经过排查，发现是生产者在*RabbitMQ*重启期间消息投递失败，导致消息丢失，需要手动处理和恢复。\n\n于是，我开始思考，如何才能进行*RabbitMQ*的消息可靠投递呢？特别是在这样比较极端的情况，*RabbitMQ*集群不可用的时候，无法投递的消息该如何处理呢？\n\n## 可靠投递\n\n先来说明一个概念，什么是可靠投递呢？在*RabbitMQ*中，一个消息从生产者发送到*RabbitMQ*服务器，需要经历这么几个步骤：\n\n1. 生产者准备好需要投递的消息。\n2. 生产者与*RabbitMQ*服务器建立连接。\n3. 生产者发送消息。\n4. *RabbitMQ*服务器接收到消息，并将其路由到指定队列。\n5. *RabbitMQ*服务器发起回调，告知生产者消息发送成功。\n\n所谓可靠投递，就是确保消息能够百分百从生产者发送到服务器。\n\n![{6582FAF9-A46E-4239-810B-E1D6883ED070}.png.jpg](https://i.loli.net/2019/08/18/yHcfoILDmTh7qbd.jpg)\n\n为了避免争议，补充说明一下，如果没有设置*Mandatory*参数，是不需要先路由消息才发起回调的，服务器收到消息后就会进行回调确认。\n\n2、3、5步都是通过*TCP*连接进行交互，有网络调用的地方就会有事故，网络波动随时都有可能发生，不管是内部机房停电，还是外部光缆被切，网络事故无法预测，虽然这些都是小概率事件，但对于订单等敏感数据处理来说，这些情况下导致消息丢失都是不可接受的。\n\n![20170716034945131.jpg](https://i.loli.net/2019/08/19/Fwp87UqONIKCZsJ.jpg)\n\n## RabbitMQ中的消息可靠投递\n\n默认情况下，发送消息的操作是不会返回任何信息给生产者的，也就是说，默认情况下生产者是不知道消息有没有正确地到达服务器。\n\n那么如何解决这个问题呢？\n\n对此，*RabbitMQ*中有一些相关的解决方案：\n\n1. 使用事务机制来让生产者感知消息被成功投递到服务器。\n2. 通过生产者确认机制实现。\n\n在*RabbitMQ*中，所有确保消息可靠投递的机制都会对性能产生一定影响，如使用不当，可能会对吞吐量造成重大影响，只有通过执行性能基准测试，才能在确定性能与可靠投递之间的平衡。\n\n在使用可靠投递前，需要先思考以下问题：\n\n1. 消息发布时，保证消息进入队列的重要性有多高？\n2. 如果消息无法进行路由，是否应该将该消息返回给发布者？\n3. 如果消息无法被路由，是否应该将其发送到其他地方稍后再重新进行路由？\n4. 如果*RabbitMQ*服务器崩溃了，是否可以接受消息丢失？\n5. *RabbitMQ*在处理新消息时是否应该确认它已经为发布者执行了所有请求的路由和持久化？\n6. 消息发布者是否可以批量投递消息？\n7. 在可靠投递上是否有可以接受的平衡性？是否可以接受一部分的不可靠性来提升性能？\n\n只考虑平衡性不考虑性能是不行的，至于这个平衡的度具体如何把握，就要具体情况具体分析了，比如像订单数据这样敏感的信息，对可靠性的要求自然要比一般的业务消息对可靠性的要求高的多，因为订单数据是跟钱直接相关的，可能会导致直接的经济损失。\n\n所以不仅应该知道有哪些保证消息可靠性的解决方案，还应该知道每种方案对性能的影响程度，以此来进行方案的选择。\n\n### RabbitMQ的事务机制\n\n*RabbitMQ*是支持*AMQP*事务机制的，在生产者确认机制之前，事务是确保消息被成功投递的唯一方法。\n\n在*SpringBoot*项目中，使用*RabbitMQ*事务其实很简单，只需要声明一个事务管理的*Bean*，并将*RabbitTemplate*的事务设置为true即可。\n\n配置文件如下：\n\n```yml\nspring:\n  rabbitmq:\n    host: localhost\n    password: guest\n    username: guest\n    listener:\n      type: simple\n      simple:\n        default-requeue-rejected: false\n        acknowledge-mode: manual\n```\n\n先来配置一下交换机和队列，以及事务管理器。\n\n```java\n@Configuration\npublic class RabbitMQConfig {\n\n    public static final String BUSINESS_EXCHANGE_NAME = \"rabbitmq.tx.demo.simple.business.exchange\";\n    public static final String BUSINESS_QUEUEA_NAME = \"rabbitmq.tx.demo.simple.business.queue\";\n\n    // 声明业务Exchange\n    @Bean(\"businessExchange\")\n    public FanoutExchange businessExchange(){\n        return new FanoutExchange(BUSINESS_EXCHANGE_NAME);\n    }\n\n    // 声明业务队列\n    @Bean(\"businessQueue\")\n    public Queue businessQueue(){\n        return QueueBuilder.durable(BUSINESS_QUEUEA_NAME).build();\n    }\n\n    // 声明业务队列绑定关系\n    @Bean\n    public Binding businessBinding(@Qualifier(\"businessQueue\") Queue queue,\n                                    @Qualifier(\"businessExchange\") FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n\n    /**\n     * 配置启用rabbitmq事务\n     * @param connectionFactory\n     * @return\n     */\n    @Bean\n    public RabbitTransactionManager rabbitTransactionManager(CachingConnectionFactory connectionFactory) {\n        return new RabbitTransactionManager(connectionFactory);\n    }\n}\n```\n\n然后创建一个消费者，来监听消息，用以判断消息是否成功发送。\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgConsumer {\n\n\n    @RabbitListener(queues = BUSINESS_QUEUEA_NAME)\n    public void receiveMsg(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(\"收到业务消息：{}\", msg);\n        channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, false);\n    }\n}\n```\n\n然后是消息生产者：\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgProducer{\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    private void init() {\n        rabbitTemplate.setChannelTransacted(true);\n    }\n\n    @Transactional\n    public void sendMsg(String msg) {\n        rabbitTemplate.convertAndSend(BUSINESS_EXCHANGE_NAME, \"key\", msg);\n        if (msg != null && msg.contains(\"exception\"))\n            throw new RuntimeException(\"surprise!\");\n        log.info(\"消息已发送 {}\" ,msg);\n    }\n}\n```\n\n这里有两个注意的地方：\n\n1. 在初始化方法里，通过使用` rabbitTemplate.setChannelTransacted(true);` 来开启事务。\n2. 在发送消息的方法上加上 `@Transactional` 注解，这样在该方法中发生异常时，消息将不会发送。\n\n在controller中加一个接口来生产消息：\n\n```java\n@RestController\npublic class BusinessController {\n\n    @Autowired\n    private BusinessMsgProducer producer;\n\n    @RequestMapping(\"send\")\n    public void sendMsg(String msg){\n        producer.sendMsg(msg);\n    }\n}\n```\n\n来验证一下：\n\n```shell\nmsg:1\n消息已发送 1\n收到业务消息：1\nmsg:2\n消息已发送 2\n收到业务消息：2\nmsg:3\n消息已发送 3\n收到业务消息：3\nmsg:exception\n\nServlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.RuntimeException: surprise!] with root cause\n\njava.lang.RuntimeException: surprise!\n\tat com.mfrank.rabbitmqdemo.producer.BusinessMsgProducer.sendMsg(BusinessMsgProducer.java:30)\n    ...\n```\n\n当 `msg` 的值为 `exception` 时， 在调用`rabbitTemplate.convertAndSend` 方法之后，程序抛出了异常，消息并没有发送出去，而是被当前事务回滚了。\n\n当然，你可以将事务管理器注释掉，或者将初始化方法的开启事务注释掉，这样事务就不会生效，即使在调用了发送消息方法之后，程序发生了异常，消息也会被正常发送和消费。\n\nRabbitMQ中的事务使用起来虽然简单，但是对性能的影响是不可忽视的，因为每次事务的提交都是阻塞式的等待服务器处理返回结果，而默认模式下，客户端是不需要等待的，直接发送就完事了，除此之外，事务消息需要比普通消息多4次与服务器的交互，这就意味着会占用更多的处理时间，所以如果对消息处理速度有较高要求时，尽量不要采用事务机制。\n\n### RabbitMQ的生产者确认机制\n\n*RabbitMQ*中的生产者确认功能是*AMQP*规范的增强功能，当生产者发布给所有队列的已路由消息被消费者应用程序直接消费时，或者消息被放入队列并根据需要进行持久化时，一个*Basic.Ack*请求会被发送到生产者，如果消息无法路由，代理服务器将发送一个*Basic.Nack* RPC请求用于表示失败。然后由生产者决定该如何处理该消息。\n\n也就是说，通过生产者确认机制，生产者可以在消息被服务器成功接收时得到反馈，并有机会处理未被成功接收的消息。\n\n在Springboot中开启RabbitMQ的生产者确认模式也很简单，只多了一行配置：\n\n```yml\nspring:\n  rabbitmq:\n    host: localhost\n    password: guest\n    username: guest\n    listener:\n      type: simple\n      simple:\n        default-requeue-rejected: false\n        acknowledge-mode: manual\n    publisher-confirms: true\n```\n\n` publisher-confirms: true` 即表示开启生产者确认模式。\n\n然后将消息生产者的代表进行部分修改：\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgProducer implements RabbitTemplate.ConfirmCallback{\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    private void init() {\n//        rabbitTemplate.setChannelTransacted(true);\n        rabbitTemplate.setConfirmCallback(this);\n    }\n\n    public void sendCustomMsg(String exchange, String msg) {\n        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key\", msg, correlationData);\n    }\n    \n    @Override\n    public void confirm(CorrelationData correlationData, boolean b, String s) {\n        String id = correlationData != null ? correlationData.getId() : \"\";\n        if (b) {\n            log.info(\"消息确认成功, id:{}\", id);\n        } else {\n            log.error(\"消息未成功投递, id:{}, cause:{}\", id, s);\n        }\n    }\n}\n```\n\n让生产者继承自`RabbitTemplate.ConfirmCallback` 类，然后实现其`confirm` 方法，即可用其接收服务器回调。\n\n需要注意的是，在发送消息时，代码也进行了调整：\n\n```java\nCorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\nrabbitTemplate.convertAndSend(exchange, \"key\", msg, correlationData);\n```\n\n这里我们为消息设置了消息ID，以便在回调时通过该ID来判断是对哪个消息的回调，因为在回调函数中，我们是无法直接获取到消息内容的，所以需要将消息先暂存起来，根据消息的重要程度，可以考虑使用本地缓存，或者存入*Redis*中，或者*Mysql*中，然后在回调时更新其状态或者从缓存中移除，最后使用定时任务对一段时间内未发送的消息进行重新投递。\n\n以下是我盗来的图，原谅我偷懒不想画了[手动狗头]：\n\n![5b65729e0001439305000294.jpg](https://i.loli.net/2019/08/19/CO5bs2xwh4WHFpM.png)\n\n另外，还需要注意的是，如果将消息发布到不存在的交换机上，那么发布用的信道将会被*RabbitMQ*关闭。\n\n此外，生产者确认机制跟事务是不能一起工作的，是事务的轻量级替代方案。因为事务和发布者确认模式都是需要先跟服务器协商，对信道启用的一种模式，不能对同一个信道同时使用两种模式。\n\n在生产者确认模式中，消息的确认可以是异步和批量的，所以相比使用事务，性能会更好。\n\n使用事务机制和生产者确认机制都能确保消息被正确的发送至*RabbitMQ*，这里的“正确发送至RabbitMQ”说的是消息成功被交换机接收，但如果找不到能接收该消息的队列，这条消息也会丢失。至于如何处理那些无法被投递到队列的消息，将会在下篇进行说明。\n\n## 结题\n\n所以当公司机房“断电”时，如何处理那些需要发送的消息呢？相信看完上文之后，你的心中已经有了答案。\n\n一般来说，这种“断电”不会持续较长时间，一般几分钟到半小时之间，很快能够恢复，所以如果是重要消息，可以保存到数据库中，如果是非重要消息，可以使用*redis*进行保存，当然，还要根据消息的数量级来进行判断。\n\n如果消息量比较大，可以考虑将消息发送到另一个集群的死信队列中，事实上，所在公司就有两个*RabbitMQ*集群，所以当一个集群不可用时，可以往另一个集群发消息，emmm，如果两个机房都停电了的话，当我没说。\n\n![111.png.jpg](https://i.loli.net/2019/08/19/c8ZGAL7OEPQTeWM.jpg)","slug":"rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message","published":1,"updated":"2020-05-03T17:00:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfbj00115ohu0wq7hw4y","content":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>前几天，突然发生线上报警，钉钉连发了好几条消息，一看是<em>RabbitMQ</em>相关的消息，心头一紧，难道翻车了？</p>\n<p><img src=\"https://i.loli.net/2019/08/19/o3ZELv7GkRImstJ.jpg\" alt=\"u=1091165172,1855706818&amp;fm=26&amp;gp=0.jpg\"></p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token punctuation\">[</span>橙色报警<span class=\"token punctuation\">]</span> 应用<span class=\"token punctuation\">[</span>xxx<span class=\"token punctuation\">]</span>在<span class=\"token punctuation\">[</span><span class=\"token number\">08</span><span class=\"token operator\">-</span><span class=\"token number\">15</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">36</span><span class=\"token operator\">:</span><span class=\"token number\">04</span><span class=\"token punctuation\">]</span>发生<span class=\"token punctuation\">[</span>错误日志异常<span class=\"token punctuation\">]</span>，alertId<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>xxx<span class=\"token punctuation\">]</span>。由<span class=\"token punctuation\">[</span>org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>rabbit<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span>BlockingQueueConsumer<span class=\"token operator\">:</span>start<span class=\"token operator\">:</span><span class=\"token number\">620</span><span class=\"token punctuation\">]</span>触发。\n应用xxx 可能原因如下\n服务名为：\n 异常为：org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>rabbit<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span>BlockingQueueConsumer<span class=\"token operator\">:</span>start<span class=\"token operator\">:</span><span class=\"token number\">620</span>\n 产生原因如下<span class=\"token operator\">:</span>\n<span class=\"token number\">1</span><span class=\"token punctuation\">.</span>org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>rabbit<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span>QueuesNotAvailableException<span class=\"token operator\">:</span> Cannot prepare queue <span class=\"token keyword\">for</span> listener<span class=\"token punctuation\">.</span> Either the queue doesn't exist or the broker will not allow us to use it<span class=\"token punctuation\">.</span>\n<span class=\"token operator\">||</span>Consumer received fatal<span class=\"token operator\">=</span><span class=\"token boolean\">false</span> exception on startup<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n应用xxx 可能原因如下\n服务名为：\n 异常为：org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token punctuation\">.</span>rabbit<span class=\"token punctuation\">.</span>listener<span class=\"token punctuation\">.</span>SimpleMessageListenerContainer$AsyncMessageProcessingConsumer<span class=\"token operator\">:</span>run<span class=\"token operator\">:</span><span class=\"token number\">1160</span>\n 产生原因如下<span class=\"token operator\">:</span>\n<span class=\"token number\">1</span><span class=\"token punctuation\">.</span>Stopping container from aborted consumer<span class=\"token operator\">||</span>Stopping container from aborted consumer<span class=\"token operator\">:</span></code></pre>\n<p>定睛一看，看样子像是消费者莫名其妙断开了连接，正逢公司搬家之际，难道是机房又双叒叕。。。。断电了？于是赶紧联系了运维，咨询<em>RabbitMQ</em>是否发生了调整。几分钟后，得到了运维的回复，由于一些不可描述的原因，<em>RabbitMQ</em>进行了重启，emmmm，虽然重启只持续了10分钟，但是导致该集群下所有消费者都挂了，需要将项目重启后才能正常进行消费。</p>\n<p>项目重启后，一切似乎又正常运转起来，但好景不长，没过多久，工单就找上了门来，经过排查，发现是生产者在<em>RabbitMQ</em>重启期间消息投递失败，导致消息丢失，需要手动处理和恢复。</p>\n<p>于是，我开始思考，如何才能进行<em>RabbitMQ</em>的消息可靠投递呢？特别是在这样比较极端的情况，<em>RabbitMQ</em>集群不可用的时候，无法投递的消息该如何处理呢？</p>\n<h2 id=\"可靠投递\"><a href=\"#可靠投递\" class=\"headerlink\" title=\"可靠投递\"></a>可靠投递</h2><p>先来说明一个概念，什么是可靠投递呢？在<em>RabbitMQ</em>中，一个消息从生产者发送到<em>RabbitMQ</em>服务器，需要经历这么几个步骤：</p>\n<ol>\n<li>生产者准备好需要投递的消息。</li>\n<li>生产者与<em>RabbitMQ</em>服务器建立连接。</li>\n<li>生产者发送消息。</li>\n<li><em>RabbitMQ</em>服务器接收到消息，并将其路由到指定队列。</li>\n<li><em>RabbitMQ</em>服务器发起回调，告知生产者消息发送成功。</li>\n</ol>\n<p>所谓可靠投递，就是确保消息能够百分百从生产者发送到服务器。</p>\n<p><img src=\"https://i.loli.net/2019/08/18/yHcfoILDmTh7qbd.jpg\" alt=\"{6582FAF9-A46E-4239-810B-E1D6883ED070}.png.jpg\"></p>\n<p>为了避免争议，补充说明一下，如果没有设置<em>Mandatory</em>参数，是不需要先路由消息才发起回调的，服务器收到消息后就会进行回调确认。</p>\n<p>2、3、5步都是通过<em>TCP</em>连接进行交互，有网络调用的地方就会有事故，网络波动随时都有可能发生，不管是内部机房停电，还是外部光缆被切，网络事故无法预测，虽然这些都是小概率事件，但对于订单等敏感数据处理来说，这些情况下导致消息丢失都是不可接受的。</p>\n<p><img src=\"https://i.loli.net/2019/08/19/Fwp87UqONIKCZsJ.jpg\" alt=\"20170716034945131.jpg\"></p>\n<h2 id=\"RabbitMQ中的消息可靠投递\"><a href=\"#RabbitMQ中的消息可靠投递\" class=\"headerlink\" title=\"RabbitMQ中的消息可靠投递\"></a>RabbitMQ中的消息可靠投递</h2><p>默认情况下，发送消息的操作是不会返回任何信息给生产者的，也就是说，默认情况下生产者是不知道消息有没有正确地到达服务器。</p>\n<p>那么如何解决这个问题呢？</p>\n<p>对此，<em>RabbitMQ</em>中有一些相关的解决方案：</p>\n<ol>\n<li>使用事务机制来让生产者感知消息被成功投递到服务器。</li>\n<li>通过生产者确认机制实现。</li>\n</ol>\n<p>在<em>RabbitMQ</em>中，所有确保消息可靠投递的机制都会对性能产生一定影响，如使用不当，可能会对吞吐量造成重大影响，只有通过执行性能基准测试，才能在确定性能与可靠投递之间的平衡。</p>\n<p>在使用可靠投递前，需要先思考以下问题：</p>\n<ol>\n<li>消息发布时，保证消息进入队列的重要性有多高？</li>\n<li>如果消息无法进行路由，是否应该将该消息返回给发布者？</li>\n<li>如果消息无法被路由，是否应该将其发送到其他地方稍后再重新进行路由？</li>\n<li>如果<em>RabbitMQ</em>服务器崩溃了，是否可以接受消息丢失？</li>\n<li><em>RabbitMQ</em>在处理新消息时是否应该确认它已经为发布者执行了所有请求的路由和持久化？</li>\n<li>消息发布者是否可以批量投递消息？</li>\n<li>在可靠投递上是否有可以接受的平衡性？是否可以接受一部分的不可靠性来提升性能？</li>\n</ol>\n<p>只考虑平衡性不考虑性能是不行的，至于这个平衡的度具体如何把握，就要具体情况具体分析了，比如像订单数据这样敏感的信息，对可靠性的要求自然要比一般的业务消息对可靠性的要求高的多，因为订单数据是跟钱直接相关的，可能会导致直接的经济损失。</p>\n<p>所以不仅应该知道有哪些保证消息可靠性的解决方案，还应该知道每种方案对性能的影响程度，以此来进行方案的选择。</p>\n<h3 id=\"RabbitMQ的事务机制\"><a href=\"#RabbitMQ的事务机制\" class=\"headerlink\" title=\"RabbitMQ的事务机制\"></a>RabbitMQ的事务机制</h3><p><em>RabbitMQ</em>是支持<em>AMQP</em>事务机制的，在生产者确认机制之前，事务是确保消息被成功投递的唯一方法。</p>\n<p>在<em>SpringBoot</em>项目中，使用<em>RabbitMQ</em>事务其实很简单，只需要声明一个事务管理的<em>Bean</em>，并将<em>RabbitTemplate</em>的事务设置为true即可。</p>\n<p>配置文件如下：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">spring:\n  rabbitmq:\n    host: localhost\n    password: guest\n    username: guest\n    listener:\n      type: simple\n      simple:\n        default-requeue-rejected: false\n        acknowledge-mode: manual</code></pre>\n<p>先来配置一下交换机和队列，以及事务管理器。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RabbitMQConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String BUSINESS_EXCHANGE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"rabbitmq.tx.demo.simple.business.exchange\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String BUSINESS_QUEUEA_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"rabbitmq.tx.demo.simple.business.queue\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明业务Exchange</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessExchange\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> FanoutExchange <span class=\"token function\">businessExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FanoutExchange</span><span class=\"token punctuation\">(</span>BUSINESS_EXCHANGE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明业务队列</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessQueue\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">businessQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> QueueBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span>BUSINESS_QUEUEA_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明业务队列绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">businessBinding</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessQueue\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                    <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessExchange\"</span><span class=\"token punctuation\">)</span> FanoutExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token comment\" spellcheck=\"true\">/**\n     * 配置启用rabbitmq事务\n     * @param connectionFactory\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> RabbitTransactionManager <span class=\"token function\">rabbitTransactionManager</span><span class=\"token punctuation\">(</span>CachingConnectionFactory connectionFactory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RabbitTransactionManager</span><span class=\"token punctuation\">(</span>connectionFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>然后创建一个消费者，来监听消息，用以判断消息是否成功发送。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BusinessMsgConsumer</span> <span class=\"token punctuation\">{</span>\n\n\n    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> BUSINESS_QUEUEA_NAME<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveMsg</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> Channel channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException <span class=\"token punctuation\">{</span>\n        String msg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"收到业务消息：{}\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicNack</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>然后是消息生产者：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BusinessMsgProducer</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> RabbitTemplate rabbitTemplate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@PostConstruct</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setChannelTransacted</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsg</span><span class=\"token punctuation\">(</span>String msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>BUSINESS_EXCHANGE_NAME<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>msg <span class=\"token operator\">!=</span> null <span class=\"token operator\">&amp;&amp;</span> msg<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"exception\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"surprise!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息已发送 {}\"</span> <span class=\"token punctuation\">,</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这里有两个注意的地方：</p>\n<ol>\n<li>在初始化方法里，通过使用<code>rabbitTemplate.setChannelTransacted(true);</code> 来开启事务。</li>\n<li>在发送消息的方法上加上 <code>@Transactional</code> 注解，这样在该方法中发生异常时，消息将不会发送。</li>\n</ol>\n<p>在controller中加一个接口来生产消息：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BusinessController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> BusinessMsgProducer producer<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"send\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsg</span><span class=\"token punctuation\">(</span>String msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        producer<span class=\"token punctuation\">.</span><span class=\"token function\">sendMsg</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>来验证一下：</p>\n<pre class=\" language-shell\"><code class=\"language-shell\">msg:1\n消息已发送 1\n收到业务消息：1\nmsg:2\n消息已发送 2\n收到业务消息：2\nmsg:3\n消息已发送 3\n收到业务消息：3\nmsg:exception\n\nServlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.RuntimeException: surprise!] with root cause\n\njava.lang.RuntimeException: surprise!\n    at com.mfrank.rabbitmqdemo.producer.BusinessMsgProducer.sendMsg(BusinessMsgProducer.java:30)\n    ...</code></pre>\n<p>当 <code>msg</code> 的值为 <code>exception</code> 时， 在调用<code>rabbitTemplate.convertAndSend</code> 方法之后，程序抛出了异常，消息并没有发送出去，而是被当前事务回滚了。</p>\n<p>当然，你可以将事务管理器注释掉，或者将初始化方法的开启事务注释掉，这样事务就不会生效，即使在调用了发送消息方法之后，程序发生了异常，消息也会被正常发送和消费。</p>\n<p>RabbitMQ中的事务使用起来虽然简单，但是对性能的影响是不可忽视的，因为每次事务的提交都是阻塞式的等待服务器处理返回结果，而默认模式下，客户端是不需要等待的，直接发送就完事了，除此之外，事务消息需要比普通消息多4次与服务器的交互，这就意味着会占用更多的处理时间，所以如果对消息处理速度有较高要求时，尽量不要采用事务机制。</p>\n<h3 id=\"RabbitMQ的生产者确认机制\"><a href=\"#RabbitMQ的生产者确认机制\" class=\"headerlink\" title=\"RabbitMQ的生产者确认机制\"></a>RabbitMQ的生产者确认机制</h3><p><em>RabbitMQ<em>中的生产者确认功能是</em>AMQP<em>规范的增强功能，当生产者发布给所有队列的已路由消息被消费者应用程序直接消费时，或者消息被放入队列并根据需要进行持久化时，一个</em>Basic.Ack<em>请求会被发送到生产者，如果消息无法路由，代理服务器将发送一个</em>Basic.Nack</em> RPC请求用于表示失败。然后由生产者决定该如何处理该消息。</p>\n<p>也就是说，通过生产者确认机制，生产者可以在消息被服务器成功接收时得到反馈，并有机会处理未被成功接收的消息。</p>\n<p>在Springboot中开启RabbitMQ的生产者确认模式也很简单，只多了一行配置：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">spring:\n  rabbitmq:\n    host: localhost\n    password: guest\n    username: guest\n    listener:\n      type: simple\n      simple:\n        default-requeue-rejected: false\n        acknowledge-mode: manual\n    publisher-confirms: true</code></pre>\n<p><code>publisher-confirms: true</code> 即表示开启生产者确认模式。</p>\n<p>然后将消息生产者的代表进行部分修改：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BusinessMsgProducer</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">RabbitTemplate<span class=\"token punctuation\">.</span>ConfirmCallback</span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> RabbitTemplate rabbitTemplate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@PostConstruct</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\" spellcheck=\"true\">//        rabbitTemplate.setChannelTransacted(true);</span>\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setConfirmCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendCustomMsg</span><span class=\"token punctuation\">(</span>String exchange<span class=\"token punctuation\">,</span> String msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        CorrelationData correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span>UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息id:{}, msg:{}\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span>CorrelationData correlationData<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> b<span class=\"token punctuation\">,</span> String s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        String id <span class=\"token operator\">=</span> correlationData <span class=\"token operator\">!=</span> null <span class=\"token operator\">?</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息确认成功, id:{}\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息未成功投递, id:{}, cause:{}\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>让生产者继承自<code>RabbitTemplate.ConfirmCallback</code> 类，然后实现其<code>confirm</code> 方法，即可用其接收服务器回调。</p>\n<p>需要注意的是，在发送消息时，代码也进行了调整：</p>\n<pre class=\" language-java\"><code class=\"language-java\">CorrelationData correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span>UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nrabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>这里我们为消息设置了消息ID，以便在回调时通过该ID来判断是对哪个消息的回调，因为在回调函数中，我们是无法直接获取到消息内容的，所以需要将消息先暂存起来，根据消息的重要程度，可以考虑使用本地缓存，或者存入<em>Redis</em>中，或者<em>Mysql</em>中，然后在回调时更新其状态或者从缓存中移除，最后使用定时任务对一段时间内未发送的消息进行重新投递。</p>\n<p>以下是我盗来的图，原谅我偷懒不想画了[手动狗头]：</p>\n<p><img src=\"https://i.loli.net/2019/08/19/CO5bs2xwh4WHFpM.png\" alt=\"5b65729e0001439305000294.jpg\"></p>\n<p>另外，还需要注意的是，如果将消息发布到不存在的交换机上，那么发布用的信道将会被<em>RabbitMQ</em>关闭。</p>\n<p>此外，生产者确认机制跟事务是不能一起工作的，是事务的轻量级替代方案。因为事务和发布者确认模式都是需要先跟服务器协商，对信道启用的一种模式，不能对同一个信道同时使用两种模式。</p>\n<p>在生产者确认模式中，消息的确认可以是异步和批量的，所以相比使用事务，性能会更好。</p>\n<p>使用事务机制和生产者确认机制都能确保消息被正确的发送至<em>RabbitMQ</em>，这里的“正确发送至RabbitMQ”说的是消息成功被交换机接收，但如果找不到能接收该消息的队列，这条消息也会丢失。至于如何处理那些无法被投递到队列的消息，将会在下篇进行说明。</p>\n<h2 id=\"结题\"><a href=\"#结题\" class=\"headerlink\" title=\"结题\"></a>结题</h2><p>所以当公司机房“断电”时，如何处理那些需要发送的消息呢？相信看完上文之后，你的心中已经有了答案。</p>\n<p>一般来说，这种“断电”不会持续较长时间，一般几分钟到半小时之间，很快能够恢复，所以如果是重要消息，可以保存到数据库中，如果是非重要消息，可以使用<em>redis</em>进行保存，当然，还要根据消息的数量级来进行判断。</p>\n<p>如果消息量比较大，可以考虑将消息发送到另一个集群的死信队列中，事实上，所在公司就有两个<em>RabbitMQ</em>集群，所以当一个集群不可用时，可以往另一个集群发消息，emmm，如果两个机房都停电了的话，当我没说。</p>\n<p><img src=\"https://i.loli.net/2019/08/19/c8ZGAL7OEPQTeWM.jpg\" alt=\"111.png.jpg\"></p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>前几天，突然发生线上报警，钉钉连发了好几条消息，一看是<em>RabbitMQ</em>相关的消息，心头一紧，难道翻车了？</p>\n<p><img src=\"https://i.loli.net/2019/08/19/o3ZELv7GkRImstJ.jpg\" alt=\"u=1091165172,1855706818&amp;fm=26&amp;gp=0.jpg\"></p>\n<pre><code class=\"java\">[橙色报警] 应用[xxx]在[08-15 16:36:04]发生[错误日志异常]，alertId=[xxx]。由[org.springframework.amqp.rabbit.listener.BlockingQueueConsumer:start:620]触发。\n应用xxx 可能原因如下\n服务名为：\n 异常为：org.springframework.amqp.rabbit.listener.BlockingQueueConsumer:start:620\n 产生原因如下:\n1.org.springframework.amqp.rabbit.listener.QueuesNotAvailableException: Cannot prepare queue for listener. Either the queue doesn&#39;t exist or the broker will not allow us to use it.\n||Consumer received fatal=false exception on startup:\n...\n应用xxx 可能原因如下\n服务名为：\n 异常为：org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer:run:1160\n 产生原因如下:\n1.Stopping container from aborted consumer||Stopping container from aborted consumer:</code></pre>\n<p>定睛一看，看样子像是消费者莫名其妙断开了连接，正逢公司搬家之际，难道是机房又双叒叕。。。。断电了？于是赶紧联系了运维，咨询<em>RabbitMQ</em>是否发生了调整。几分钟后，得到了运维的回复，由于一些不可描述的原因，<em>RabbitMQ</em>进行了重启，emmmm，虽然重启只持续了10分钟，但是导致该集群下所有消费者都挂了，需要将项目重启后才能正常进行消费。</p>\n<p>项目重启后，一切似乎又正常运转起来，但好景不长，没过多久，工单就找上了门来，经过排查，发现是生产者在<em>RabbitMQ</em>重启期间消息投递失败，导致消息丢失，需要手动处理和恢复。</p>\n<p>于是，我开始思考，如何才能进行<em>RabbitMQ</em>的消息可靠投递呢？特别是在这样比较极端的情况，<em>RabbitMQ</em>集群不可用的时候，无法投递的消息该如何处理呢？</p>\n<h2 id=\"可靠投递\"><a href=\"#可靠投递\" class=\"headerlink\" title=\"可靠投递\"></a>可靠投递</h2><p>先来说明一个概念，什么是可靠投递呢？在<em>RabbitMQ</em>中，一个消息从生产者发送到<em>RabbitMQ</em>服务器，需要经历这么几个步骤：</p>\n<ol>\n<li>生产者准备好需要投递的消息。</li>\n<li>生产者与<em>RabbitMQ</em>服务器建立连接。</li>\n<li>生产者发送消息。</li>\n<li><em>RabbitMQ</em>服务器接收到消息，并将其路由到指定队列。</li>\n<li><em>RabbitMQ</em>服务器发起回调，告知生产者消息发送成功。</li>\n</ol>\n<p>所谓可靠投递，就是确保消息能够百分百从生产者发送到服务器。</p>\n<p><img src=\"https://i.loli.net/2019/08/18/yHcfoILDmTh7qbd.jpg\" alt=\"{6582FAF9-A46E-4239-810B-E1D6883ED070}.png.jpg\"></p>\n<p>为了避免争议，补充说明一下，如果没有设置<em>Mandatory</em>参数，是不需要先路由消息才发起回调的，服务器收到消息后就会进行回调确认。</p>\n<p>2、3、5步都是通过<em>TCP</em>连接进行交互，有网络调用的地方就会有事故，网络波动随时都有可能发生，不管是内部机房停电，还是外部光缆被切，网络事故无法预测，虽然这些都是小概率事件，但对于订单等敏感数据处理来说，这些情况下导致消息丢失都是不可接受的。</p>\n<p><img src=\"https://i.loli.net/2019/08/19/Fwp87UqONIKCZsJ.jpg\" alt=\"20170716034945131.jpg\"></p>\n<h2 id=\"RabbitMQ中的消息可靠投递\"><a href=\"#RabbitMQ中的消息可靠投递\" class=\"headerlink\" title=\"RabbitMQ中的消息可靠投递\"></a>RabbitMQ中的消息可靠投递</h2><p>默认情况下，发送消息的操作是不会返回任何信息给生产者的，也就是说，默认情况下生产者是不知道消息有没有正确地到达服务器。</p>\n<p>那么如何解决这个问题呢？</p>\n<p>对此，<em>RabbitMQ</em>中有一些相关的解决方案：</p>\n<ol>\n<li>使用事务机制来让生产者感知消息被成功投递到服务器。</li>\n<li>通过生产者确认机制实现。</li>\n</ol>\n<p>在<em>RabbitMQ</em>中，所有确保消息可靠投递的机制都会对性能产生一定影响，如使用不当，可能会对吞吐量造成重大影响，只有通过执行性能基准测试，才能在确定性能与可靠投递之间的平衡。</p>\n<p>在使用可靠投递前，需要先思考以下问题：</p>\n<ol>\n<li>消息发布时，保证消息进入队列的重要性有多高？</li>\n<li>如果消息无法进行路由，是否应该将该消息返回给发布者？</li>\n<li>如果消息无法被路由，是否应该将其发送到其他地方稍后再重新进行路由？</li>\n<li>如果<em>RabbitMQ</em>服务器崩溃了，是否可以接受消息丢失？</li>\n<li><em>RabbitMQ</em>在处理新消息时是否应该确认它已经为发布者执行了所有请求的路由和持久化？</li>\n<li>消息发布者是否可以批量投递消息？</li>\n<li>在可靠投递上是否有可以接受的平衡性？是否可以接受一部分的不可靠性来提升性能？</li>\n</ol>\n<p>只考虑平衡性不考虑性能是不行的，至于这个平衡的度具体如何把握，就要具体情况具体分析了，比如像订单数据这样敏感的信息，对可靠性的要求自然要比一般的业务消息对可靠性的要求高的多，因为订单数据是跟钱直接相关的，可能会导致直接的经济损失。</p>\n<p>所以不仅应该知道有哪些保证消息可靠性的解决方案，还应该知道每种方案对性能的影响程度，以此来进行方案的选择。</p>\n<h3 id=\"RabbitMQ的事务机制\"><a href=\"#RabbitMQ的事务机制\" class=\"headerlink\" title=\"RabbitMQ的事务机制\"></a>RabbitMQ的事务机制</h3><p><em>RabbitMQ</em>是支持<em>AMQP</em>事务机制的，在生产者确认机制之前，事务是确保消息被成功投递的唯一方法。</p>\n<p>在<em>SpringBoot</em>项目中，使用<em>RabbitMQ</em>事务其实很简单，只需要声明一个事务管理的<em>Bean</em>，并将<em>RabbitTemplate</em>的事务设置为true即可。</p>\n<p>配置文件如下：</p>\n<pre><code class=\"yml\">spring:\n  rabbitmq:\n    host: localhost\n    password: guest\n    username: guest\n    listener:\n      type: simple\n      simple:\n        default-requeue-rejected: false\n        acknowledge-mode: manual</code></pre>\n<p>先来配置一下交换机和队列，以及事务管理器。</p>\n<pre><code class=\"java\">@Configuration\npublic class RabbitMQConfig {\n\n    public static final String BUSINESS_EXCHANGE_NAME = &quot;rabbitmq.tx.demo.simple.business.exchange&quot;;\n    public static final String BUSINESS_QUEUEA_NAME = &quot;rabbitmq.tx.demo.simple.business.queue&quot;;\n\n    // 声明业务Exchange\n    @Bean(&quot;businessExchange&quot;)\n    public FanoutExchange businessExchange(){\n        return new FanoutExchange(BUSINESS_EXCHANGE_NAME);\n    }\n\n    // 声明业务队列\n    @Bean(&quot;businessQueue&quot;)\n    public Queue businessQueue(){\n        return QueueBuilder.durable(BUSINESS_QUEUEA_NAME).build();\n    }\n\n    // 声明业务队列绑定关系\n    @Bean\n    public Binding businessBinding(@Qualifier(&quot;businessQueue&quot;) Queue queue,\n                                    @Qualifier(&quot;businessExchange&quot;) FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n\n    /**\n     * 配置启用rabbitmq事务\n     * @param connectionFactory\n     * @return\n     */\n    @Bean\n    public RabbitTransactionManager rabbitTransactionManager(CachingConnectionFactory connectionFactory) {\n        return new RabbitTransactionManager(connectionFactory);\n    }\n}</code></pre>\n<p>然后创建一个消费者，来监听消息，用以判断消息是否成功发送。</p>\n<pre><code class=\"java\">@Slf4j\n@Component\npublic class BusinessMsgConsumer {\n\n\n    @RabbitListener(queues = BUSINESS_QUEUEA_NAME)\n    public void receiveMsg(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(&quot;收到业务消息：{}&quot;, msg);\n        channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, false);\n    }\n}</code></pre>\n<p>然后是消息生产者：</p>\n<pre><code class=\"java\">@Slf4j\n@Component\npublic class BusinessMsgProducer{\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    private void init() {\n        rabbitTemplate.setChannelTransacted(true);\n    }\n\n    @Transactional\n    public void sendMsg(String msg) {\n        rabbitTemplate.convertAndSend(BUSINESS_EXCHANGE_NAME, &quot;key&quot;, msg);\n        if (msg != null &amp;&amp; msg.contains(&quot;exception&quot;))\n            throw new RuntimeException(&quot;surprise!&quot;);\n        log.info(&quot;消息已发送 {}&quot; ,msg);\n    }\n}</code></pre>\n<p>这里有两个注意的地方：</p>\n<ol>\n<li>在初始化方法里，通过使用<code>rabbitTemplate.setChannelTransacted(true);</code> 来开启事务。</li>\n<li>在发送消息的方法上加上 <code>@Transactional</code> 注解，这样在该方法中发生异常时，消息将不会发送。</li>\n</ol>\n<p>在controller中加一个接口来生产消息：</p>\n<pre><code class=\"java\">@RestController\npublic class BusinessController {\n\n    @Autowired\n    private BusinessMsgProducer producer;\n\n    @RequestMapping(&quot;send&quot;)\n    public void sendMsg(String msg){\n        producer.sendMsg(msg);\n    }\n}</code></pre>\n<p>来验证一下：</p>\n<pre><code class=\"shell\">msg:1\n消息已发送 1\n收到业务消息：1\nmsg:2\n消息已发送 2\n收到业务消息：2\nmsg:3\n消息已发送 3\n收到业务消息：3\nmsg:exception\n\nServlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.RuntimeException: surprise!] with root cause\n\njava.lang.RuntimeException: surprise!\n    at com.mfrank.rabbitmqdemo.producer.BusinessMsgProducer.sendMsg(BusinessMsgProducer.java:30)\n    ...</code></pre>\n<p>当 <code>msg</code> 的值为 <code>exception</code> 时， 在调用<code>rabbitTemplate.convertAndSend</code> 方法之后，程序抛出了异常，消息并没有发送出去，而是被当前事务回滚了。</p>\n<p>当然，你可以将事务管理器注释掉，或者将初始化方法的开启事务注释掉，这样事务就不会生效，即使在调用了发送消息方法之后，程序发生了异常，消息也会被正常发送和消费。</p>\n<p>RabbitMQ中的事务使用起来虽然简单，但是对性能的影响是不可忽视的，因为每次事务的提交都是阻塞式的等待服务器处理返回结果，而默认模式下，客户端是不需要等待的，直接发送就完事了，除此之外，事务消息需要比普通消息多4次与服务器的交互，这就意味着会占用更多的处理时间，所以如果对消息处理速度有较高要求时，尽量不要采用事务机制。</p>\n<h3 id=\"RabbitMQ的生产者确认机制\"><a href=\"#RabbitMQ的生产者确认机制\" class=\"headerlink\" title=\"RabbitMQ的生产者确认机制\"></a>RabbitMQ的生产者确认机制</h3><p><em>RabbitMQ<em>中的生产者确认功能是</em>AMQP<em>规范的增强功能，当生产者发布给所有队列的已路由消息被消费者应用程序直接消费时，或者消息被放入队列并根据需要进行持久化时，一个</em>Basic.Ack<em>请求会被发送到生产者，如果消息无法路由，代理服务器将发送一个</em>Basic.Nack</em> RPC请求用于表示失败。然后由生产者决定该如何处理该消息。</p>\n<p>也就是说，通过生产者确认机制，生产者可以在消息被服务器成功接收时得到反馈，并有机会处理未被成功接收的消息。</p>\n<p>在Springboot中开启RabbitMQ的生产者确认模式也很简单，只多了一行配置：</p>\n<pre><code class=\"yml\">spring:\n  rabbitmq:\n    host: localhost\n    password: guest\n    username: guest\n    listener:\n      type: simple\n      simple:\n        default-requeue-rejected: false\n        acknowledge-mode: manual\n    publisher-confirms: true</code></pre>\n<p><code>publisher-confirms: true</code> 即表示开启生产者确认模式。</p>\n<p>然后将消息生产者的代表进行部分修改：</p>\n<pre><code class=\"java\">@Slf4j\n@Component\npublic class BusinessMsgProducer implements RabbitTemplate.ConfirmCallback{\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    private void init() {\n//        rabbitTemplate.setChannelTransacted(true);\n        rabbitTemplate.setConfirmCallback(this);\n    }\n\n    public void sendCustomMsg(String exchange, String msg) {\n        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(&quot;消息id:{}, msg:{}&quot;, correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, &quot;key&quot;, msg, correlationData);\n    }\n\n    @Override\n    public void confirm(CorrelationData correlationData, boolean b, String s) {\n        String id = correlationData != null ? correlationData.getId() : &quot;&quot;;\n        if (b) {\n            log.info(&quot;消息确认成功, id:{}&quot;, id);\n        } else {\n            log.error(&quot;消息未成功投递, id:{}, cause:{}&quot;, id, s);\n        }\n    }\n}</code></pre>\n<p>让生产者继承自<code>RabbitTemplate.ConfirmCallback</code> 类，然后实现其<code>confirm</code> 方法，即可用其接收服务器回调。</p>\n<p>需要注意的是，在发送消息时，代码也进行了调整：</p>\n<pre><code class=\"java\">CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\nrabbitTemplate.convertAndSend(exchange, &quot;key&quot;, msg, correlationData);</code></pre>\n<p>这里我们为消息设置了消息ID，以便在回调时通过该ID来判断是对哪个消息的回调，因为在回调函数中，我们是无法直接获取到消息内容的，所以需要将消息先暂存起来，根据消息的重要程度，可以考虑使用本地缓存，或者存入<em>Redis</em>中，或者<em>Mysql</em>中，然后在回调时更新其状态或者从缓存中移除，最后使用定时任务对一段时间内未发送的消息进行重新投递。</p>\n<p>以下是我盗来的图，原谅我偷懒不想画了[手动狗头]：</p>\n<p><img src=\"https://i.loli.net/2019/08/19/CO5bs2xwh4WHFpM.png\" alt=\"5b65729e0001439305000294.jpg\"></p>\n<p>另外，还需要注意的是，如果将消息发布到不存在的交换机上，那么发布用的信道将会被<em>RabbitMQ</em>关闭。</p>\n<p>此外，生产者确认机制跟事务是不能一起工作的，是事务的轻量级替代方案。因为事务和发布者确认模式都是需要先跟服务器协商，对信道启用的一种模式，不能对同一个信道同时使用两种模式。</p>\n<p>在生产者确认模式中，消息的确认可以是异步和批量的，所以相比使用事务，性能会更好。</p>\n<p>使用事务机制和生产者确认机制都能确保消息被正确的发送至<em>RabbitMQ</em>，这里的“正确发送至RabbitMQ”说的是消息成功被交换机接收，但如果找不到能接收该消息的队列，这条消息也会丢失。至于如何处理那些无法被投递到队列的消息，将会在下篇进行说明。</p>\n<h2 id=\"结题\"><a href=\"#结题\" class=\"headerlink\" title=\"结题\"></a>结题</h2><p>所以当公司机房“断电”时，如何处理那些需要发送的消息呢？相信看完上文之后，你的心中已经有了答案。</p>\n<p>一般来说，这种“断电”不会持续较长时间，一般几分钟到半小时之间，很快能够恢复，所以如果是重要消息，可以保存到数据库中，如果是非重要消息，可以使用<em>redis</em>进行保存，当然，还要根据消息的数量级来进行判断。</p>\n<p>如果消息量比较大，可以考虑将消息发送到另一个集群的死信队列中，事实上，所在公司就有两个<em>RabbitMQ</em>集群，所以当一个集群不可用时，可以往另一个集群发消息，emmm，如果两个机房都停电了的话，当我没说。</p>\n<p><img src=\"https://i.loli.net/2019/08/19/c8ZGAL7OEPQTeWM.jpg\" alt=\"111.png.jpg\"></p>\n"},{"title":"【RabbitMQ】如何进行消息可靠投递【下篇】","toc":true,"top":true,"cover":true,"date":"2020-05-03T17:00:30.000Z","_content":"\n## 说明\n\n上一篇文章里，我们了解了如何保证消息被可靠投递到*RabbitMQ*的交换机中，但还有一些不完美的地方，试想一下，如果向RabbitMQ服务器发送一条消息，服务器确实也接收到了这条消息，于是给你返回了ACK确认消息，但服务器拿到这条消息一看，找不到路由它的队列，于是就把它丢进了垃圾桶，emmm，我猜应该属于可回收垃圾。\n\n![1](https://i.loli.net/2019/08/22/nmPFS3RkIMweEXc.png)\n\n## 如何让消息可靠投递到队列\n\n如果你对上面的描述还不是很清楚，那我再用代码来说明一次。\n\n在仅开启了生产者确认机制的情况下，交换机接收到消息后，会直接给消息生产者发送确认消息，如果发现该消息不可路由，那么消息会被直接丢弃，此时，生产者是不知道消息被丢弃这个事件的。\n\n我们将上一篇中的交换机类型改为*DirectExchange*，这样就只有当消息的 *RoutingKey* 和队列绑定时设置的 *Bindingkey* （这里即“key”）一致时，才会真正将该消息进行路由。\n\n```java\npublic static final String BUSINESS_EXCHANGE_NAME = \"rabbitmq.tx.demo.simple.business.exchange\";\npublic static final String BUSINESS_QUEUEA_NAME = \"rabbitmq.tx.demo.simple.business.queue\";\n\n// 声明业务 Exchange\n@Bean(\"businessExchange\")\npublic DirectExchange businessExchange(){\n    return new DirectExchange(BUSINESS_EXCHANGE_NAME);\n}\n\n// 声明业务队列\n@Bean(\"businessQueue\")\npublic Queue businessQueue(){\n    return QueueBuilder.durable(BUSINESS_QUEUEA_NAME).build();\n}\n\n// 声明业务队列绑定关系\n@Bean\npublic Binding businessBinding(@Qualifier(\"businessQueue\") Queue queue,\n                               @Qualifier(\"businessExchange\") DirectExchange exchange){\n    return BindingBuilder.bind(queue).to(exchange).with(\"key\");\n}\n```\n\n对消息生产者也稍作修改：\n\n```java\n@Autowired\nprivate RabbitTemplate rabbitTemplate;\n\n@PostConstruct\nprivate void init() {\n    //        rabbitTemplate.setChannelTransacted(true);\n    rabbitTemplate.setConfirmCallback(this);\n}\n\npublic void sendCustomMsg(String exchange, String msg) {\n    CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n    log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n    rabbitTemplate.convertAndSend(exchange, \"key\", msg, correlationData);\n\n    correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n    log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n    rabbitTemplate.convertAndSend(exchange, \"key2\", msg, correlationData);\n}\n\n@Override\npublic void confirm(CorrelationData correlationData, boolean b, String s) {\n    String id = correlationData != null ? correlationData.getId() : \"\";\n    if (b) {\n        log.info(\"消息确认成功, id:{}\", id);\n    } else {\n        log.error(\"消息未成功投递, id:{}, cause:{}\", id, s);\n    }\n}\n```\n\n然后我们调用该方法，发送两条消息测试一下：\n\n```java\n消息id:ba6bf502-9381-4220-8dc9-313d6a289a4e, msg:1\n消息id:f0040a41-dc02-4e45-b8af-e3cfa8a118b2, msg:1\n消息确认成功, id:ba6bf502-9381-4220-8dc9-313d6a289a4e\n消息确认成功, id:f0040a41-dc02-4e45-b8af-e3cfa8a118b2\n收到业务消息：1\n```\n\n可以看到，发送了两条消息，第一条消息的 *RoutingKey* 为 “key”，第二条消息的 RoutingKey 为 “key2”，两条消息都成功被交换机接收，也收到了交换机的确认回调，但消费者只收到了一条消息，因为第二条消息的 *RoutingKey* 与队列的 *BindingKey* 不一致，也没有其它队列能接收这个消息，所有第二条消息被直接丢弃了。\n\n那么，如何让消息被路由到队列后再返回ACK呢？或者无法被路由的消息帮我想办法处理一下？最起码通知我一声，我好自己处理啊。\n\n别慌别慌，*RabbitMQ*里有两个机制刚好可以解决我们上面的疑问：\n\n1、mandatory 参数\n2、备份交换机\n\n## mandatory 参数\n\n设置 *mandatory* 参数可以在当消息传递过程中不可达目的地时将消息返回给生产者。\n\n当把 *mandotory* 参数设置为 true 时，如果交换机无法将消息进行路由时，会将该消息返回给生产者，而如果该参数设置为false，如果发现消息无法进行路由，则直接丢弃。\n\n![2.png](https://i.loli.net/2019/09/01/YZ8acG1HxKQ9fLN.png)\n\n那么如何设置这个参数呢？在发送消息的时候，只需要在初始化方法添加一行代码即可：\n\n```java\nrabbitTemplate.setMandatory(true);\n```\n\n开启之后我们再重新运行前面的代码：\n\n```java\n消息id:19729f33-15c4-4c1b-8d48-044c301e2a8e, msg:1\n消息id:4aea5c57-3e71-4a7b-8a00-1595d2b568eb, msg:1\n消息确认成功, id:19729f33-15c4-4c1b-8d48-044c301e2a8e\nReturned message but no callback available\n消息确认成功, id:4aea5c57-3e71-4a7b-8a00-1595d2b568eb\n收到业务消息：1\n```\n\n我们看到中间多了一行提示 `Returned message but no callback available` 这是什么意思呢？\n\n我们上面提到，设置 *mandatory* 参数后，如果消息无法被路由，则会返回给生产者，是通过回调的方式进行的，所以，生产者需要设置相应的回调函数才能接受该消息。\n\n为了进行回调，我们需要实现一个接口 `RabbitTemplate.ReturnCallback`。\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgProducer implements RabbitTemplate.ConfirmCallback, RabbitTemplate.ReturnCallback{\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    private void init() {\n        rabbitTemplate.setConfirmCallback(this);\n        rabbitTemplate.setMandatory(true);\n        rabbitTemplate.setReturnCallback(this);\n    }\n\n    public void sendCustomMsg(String exchange, String msg) {\n        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key\", msg, correlationData);\n\n        correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key2\", msg, correlationData);\n    }\n\n    @Override\n    public void confirm(CorrelationData correlationData, boolean b, String s) {\n        String id = correlationData != null ? correlationData.getId() : \"\";\n        if (b) {\n            log.info(\"消息确认成功, id:{}\", id);\n        } else {\n            log.error(\"消息未成功投递, id:{}, cause:{}\", id, s);\n        }\n    }\n\n    @Override\n    public void returnedMessage(Message message, int replyCode, String replyText, String exchange, String routingKey) {\n        log.info(\"消息被服务器退回。msg:{}, replyCode:{}. replyText:{}, exchange:{}, routingKey :{}\",\n                new String(message.getBody()), replyCode, replyText, exchange, routingKey);\n    }\n}\n```\n\n然后我们再来重新运行一次：\n\n```java\n消息id:2e5c336a-883a-474e-b40e-b6e3499088ef, msg:1\n消息id:85c771cb-c88f-47dd-adea-f0da57138423, msg:1\n消息确认成功, id:2e5c336a-883a-474e-b40e-b6e3499088ef\n消息无法被路由，被服务器退回。msg:1, replyCode:312. replyText:NO_ROUTE, exchange:rabbitmq.tx.demo.simple.business.exchange, routingKey :key2\n消息确认成功, id:85c771cb-c88f-47dd-adea-f0da57138423\n收到业务消息：1\n```\n\n可以看到，我们接收到了被退回的消息，并带上了消息被退回的原因：`NO_ROUTE`。但是要注意的是， *mandatory* 参数仅仅是在当消息无法被路由的时候，让生产者可以感知到这一点，只要开启了生产者确认机制，无论是否设置了 *mandatory* 参数，都会在交换机接收到消息时进行消息确认回调，而且通常消息的返回回调会在消息的确认回调之前。\n\n## 备份交换机\n\n有了 *mandatory* 参数，我们获得了对无法投递消息的感知能力，有机会在生产者的消息无法被投递时发现并处理。但有时候，我们并不知道该如何处理这些无法路由的消息，最多打个日志，然后触发报警，再来手动处理。而通过日志来处理这些无法路由的消息是很不优雅的做法，特别是当生产者所在的服务有多台机器的时候，手动复制日志会更加麻烦而且容易出错。\n\n而且设置 *mandatory* 参数会增加生产者的复杂性，需要添加处理这些被退回的消息的逻辑。如果既不想丢失消息，又不想增加生产者的复杂性，该怎么做呢？\n\n前面在设置死信队列的文章中，我们提到，可以为队列设置死信交换机来存储那些处理失败的消息，可是这些不可路由消息根本没有机会进入到队列，因此无法使用死信队列来保存消息。\n\n不要慌，在 RabbitMQ 中，有一种备份交换机的机制存在，可以很好的应对这个问题。\n\n什么是备份交换机呢？备份交换机可以理解为 *RabbitMQ* 中交换机的“备胎”，当我们为某一个交换机声明一个对应的备份交换机时，就是为它创建一个备胎，当交换机接收到一条不可路由消息时，将会将这条消息转发到备份交换机中，由备份交换机来进行转发和处理，通常备份交换机的类型为 *Fanout* ，这样就能把所有消息都投递到与其绑定的队列中，然后我们在备份交换机下绑定一个队列，这样所有那些原交换机无法被路由的消息，就会都进入这个队列了。当然，我们还可以建立一个报警队列，用独立的消费者来进行监测和报警。\n\n听的不太明白？没关系，看个图就知道是怎么回事了。\n\n![3.png](https://i.loli.net/2019/09/01/VsGpZJbk2u7wSv4.png)\n\n（emmm，调整了一下配色，感觉还是很丑- - 。急需一个UI来拯救我。）\n\n接下来，我们就来设置一下备份交换机：\n\n```java\n@Configuration\npublic class RabbitMQConfig {\n\n    public static final String BUSINESS_EXCHANGE_NAME = \"rabbitmq.backup.test.exchange\";\n    public static final String BUSINESS_QUEUE_NAME = \"rabbitmq.backup.test.queue\";\n    public static final String BUSINESS_BACKUP_EXCHANGE_NAME = \"rabbitmq.backup.test.backup-exchange\";\n    public static final String BUSINESS_BACKUP_QUEUE_NAME = \"rabbitmq.backup.test.backup-queue\";\n    public static final String BUSINESS_BACKUP_WARNING_QUEUE_NAME = \"rabbitmq.backup.test.backup-warning-queue\";\n\n    // 声明业务 Exchange\n    @Bean(\"businessExchange\")\n    public DirectExchange businessExchange(){\n        ExchangeBuilder exchangeBuilder = ExchangeBuilder.directExchange(BUSINESS_EXCHANGE_NAME)\n                .durable(true)\n                .withArgument(\"alternate-exchange\", BUSINESS_BACKUP_EXCHANGE_NAME);\n\n        return (DirectExchange)exchangeBuilder.build();\n    }\n\n    // 声明备份 Exchange\n    @Bean(\"backupExchange\")\n    public FanoutExchange backupExchange(){\n        ExchangeBuilder exchangeBuilder = ExchangeBuilder.fanoutExchange(BUSINESS_BACKUP_EXCHANGE_NAME)\n                .durable(true);\n        return (FanoutExchange)exchangeBuilder.build();\n    }\n\n    // 声明业务队列\n    @Bean(\"businessQueue\")\n    public Queue businessQueue(){\n        return QueueBuilder.durable(BUSINESS_QUEUE_NAME).build();\n    }\n\n    // 声明业务队列绑定关系\n    @Bean\n    public Binding businessBinding(@Qualifier(\"businessQueue\") Queue queue,\n                                    @Qualifier(\"businessExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(\"key\");\n    }\n\n    // 声明备份队列\n    @Bean(\"backupQueue\")\n    public Queue backupQueue(){\n        return QueueBuilder.durable(BUSINESS_BACKUP_QUEUE_NAME).build();\n    }\n\n    // 声明报警队列\n    @Bean(\"warningQueue\")\n    public Queue warningQueue(){\n        return QueueBuilder.durable(BUSINESS_BACKUP_WARNING_QUEUE_NAME).build();\n    }\n\n    // 声明备份队列绑定关系\n    @Bean\n    public Binding backupBinding(@Qualifier(\"backupQueue\") Queue queue,\n                                   @Qualifier(\"backupExchange\") FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n    // 声明备份报警队列绑定关系\n    @Bean\n    public Binding backupWarningBinding(@Qualifier(\"warningQueue\") Queue queue,\n                                 @Qualifier(\"backupExchange\") FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n}\n```\n\n这里我们使用 `ExchangeBuilder` 来声明交换机，并为其设置备份交换机：\n\n```java\n .withArgument(\"alternate-exchange\", BUSINESS_BACKUP_EXCHANGE_NAME);\n```\n\n为业务交换机绑定了一个队列，为备份交换机绑定了两个队列，一个专门用来做报警用途。\n\n接下来，分别为业务交换机和备份交换机创建消费者：\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgConsumer {\n\n    @RabbitListener(queues = BUSINESS_QUEUE_NAME)\n    public void receiveMsg(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(\"收到业务消息：{}\", msg);\n        channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, false);\n    }\n}\n```\n\n```java\n@Slf4j\n@Component\npublic class BusinessWaringConsumer {\n\n    @RabbitListener(queues = BUSINESS_BACKUP_WARNING_QUEUE_NAME)\n    public void receiveMsg(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.error(\"发现不可路由消息：{}\", msg);\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n}\n```\n\n接下来我们分别发送一条可路由消息和不可路由消息：\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgProducer {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void sendCustomMsg(String exchange, String msg) {\n\n\n        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key\", msg, correlationData);\n\n        correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key2\", msg, correlationData);\n    }\n}\n```\n\n消息如下：\n\n```java\n消息id:5c3a33c9-0764-4d1f-bf6a-a00d771dccb4, msg:1\n消息id:42ac8c35-1d0a-4413-a1df-c26a85435354, msg:1\n收到业务消息：1\n发现不可路由消息：1\n```\n\n这里仅仅使用 *error* 日志配合日志系统进行报警，如果是敏感数据，可以使用邮件、钉钉、短信、电话等报警方式来提高时效性。\n\n那么问题来了，*mandatory* 参数与备份交换机可以一起使用吗？设置 *mandatory* 参数会让交换机将不可路由消息退回给生产者，而备份交换机会让交换机将不可路由消息转发给它，那么如果两者同时开启，消息究竟何去何从？？\n\nemmm，想这么多干嘛，试试不就知道了。\n\n修改一下生产者即可：\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgProducer implements RabbitTemplate.ConfirmCallback, RabbitTemplate.ReturnCallback{\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    private void init() {\n//        rabbitTemplate.setChannelTransacted(true);\n        rabbitTemplate.setConfirmCallback(this);\n        rabbitTemplate.setMandatory(true);\n        rabbitTemplate.setReturnCallback(this);\n    }\n\n    public void sendCustomMsg(String exchange, String msg) {\n\n\n        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key\", msg, correlationData);\n\n        correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key2\", msg, correlationData);\n    }\n\n\n    @Override\n    public void confirm(CorrelationData correlationData, boolean b, String s) {\n        String id = correlationData != null ? correlationData.getId() : \"\";\n        if (b) {\n            log.info(\"消息确认成功, id:{}\", id);\n        } else {\n            log.error(\"消息未成功投递, id:{}, cause:{}\", id, s);\n        }\n    }\n\n    @Override\n    public void returnedMessage(Message message, int replyCode, String replyText, String exchange, String routingKey) {\n        log.info(\"消息被服务器退回。msg:{}, replyCode:{}. replyText:{}, exchange:{}, routingKey :{}\",\n                new String(message.getBody()), replyCode, replyText, exchange, routingKey);\n    }\n}\n```\n\n再来测试一下：\n\n```java\n消息id:0a3eca1e-d937-418c-a7ce-bfb8ce25fdd4, msg:1\n消息id:d8c9e010-e120-46da-a42e-1ba21026ff06, msg:1\n消息确认成功, id:0a3eca1e-d937-418c-a7ce-bfb8ce25fdd4\n消息确认成功, id:d8c9e010-e120-46da-a42e-1ba21026ff06\n发现不可路由消息：1\n收到业务消息：1\n```\n\n可以看到，两条消息都可以收到确认成功回调，但是不可路由消息不会被回退给生产者，而是直接转发给备份交换机。可见备份交换机的处理优先级更高。\n\n## 总结\n\n上一篇中，我们介绍了事务机制和生产者确认机制来确保消息的可靠投递，相对而言，生产者确认机制更加高效和灵活。本篇中，我们介绍了另外两种确保生产者的消息不丢失的机制，即通过 mandatory 参数和备份交换机来处理不可路由消息。\n\n通过以上几种机制，我们总算是可以确保消息被万无一失的投递到目的地了。到此，我们的消息可靠投递也就告一段落了。消息可靠投递是我们使用MQ时无法逃避的话题，一次性搞定它，就不会再为其所困。总的来说，方法总比问题多，但如果你不知道这些方法，那么当问题来临时，也许就会不知所措了。\n\n相信通过这几篇关于 *RabbitMQ* 文章的学习，对于 *RabbitMQ* 的理解已经突破天际，那还在等什么，赶紧把接入 *RabbitMQ* 的项目好好优化一下吧，相信现在你就不会再被那些不知所云的配置和代码所迷惑了。\n\n到此为止，本篇就完美落幕了，希望能给你带来一些启发，也欢迎关注我的公众号进行留言交流。\n\n[//]: # (![1565529015677.png]&#40;https://i.loli.net/2019/08/11/8MxBPNgyIlTZDRk.png&#41;)\n","source":"_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2.md","raw":"---\ntitle: 【RabbitMQ】如何进行消息可靠投递【下篇】\ntags:\n  - RabbitMQ\ncategories:\n  - 编程\ntoc: true\ntop: true\ncover: true\ndate: 2020-05-04 01:00:30\n---\n\n## 说明\n\n上一篇文章里，我们了解了如何保证消息被可靠投递到*RabbitMQ*的交换机中，但还有一些不完美的地方，试想一下，如果向RabbitMQ服务器发送一条消息，服务器确实也接收到了这条消息，于是给你返回了ACK确认消息，但服务器拿到这条消息一看，找不到路由它的队列，于是就把它丢进了垃圾桶，emmm，我猜应该属于可回收垃圾。\n\n![1](https://i.loli.net/2019/08/22/nmPFS3RkIMweEXc.png)\n\n## 如何让消息可靠投递到队列\n\n如果你对上面的描述还不是很清楚，那我再用代码来说明一次。\n\n在仅开启了生产者确认机制的情况下，交换机接收到消息后，会直接给消息生产者发送确认消息，如果发现该消息不可路由，那么消息会被直接丢弃，此时，生产者是不知道消息被丢弃这个事件的。\n\n我们将上一篇中的交换机类型改为*DirectExchange*，这样就只有当消息的 *RoutingKey* 和队列绑定时设置的 *Bindingkey* （这里即“key”）一致时，才会真正将该消息进行路由。\n\n```java\npublic static final String BUSINESS_EXCHANGE_NAME = \"rabbitmq.tx.demo.simple.business.exchange\";\npublic static final String BUSINESS_QUEUEA_NAME = \"rabbitmq.tx.demo.simple.business.queue\";\n\n// 声明业务 Exchange\n@Bean(\"businessExchange\")\npublic DirectExchange businessExchange(){\n    return new DirectExchange(BUSINESS_EXCHANGE_NAME);\n}\n\n// 声明业务队列\n@Bean(\"businessQueue\")\npublic Queue businessQueue(){\n    return QueueBuilder.durable(BUSINESS_QUEUEA_NAME).build();\n}\n\n// 声明业务队列绑定关系\n@Bean\npublic Binding businessBinding(@Qualifier(\"businessQueue\") Queue queue,\n                               @Qualifier(\"businessExchange\") DirectExchange exchange){\n    return BindingBuilder.bind(queue).to(exchange).with(\"key\");\n}\n```\n\n对消息生产者也稍作修改：\n\n```java\n@Autowired\nprivate RabbitTemplate rabbitTemplate;\n\n@PostConstruct\nprivate void init() {\n    //        rabbitTemplate.setChannelTransacted(true);\n    rabbitTemplate.setConfirmCallback(this);\n}\n\npublic void sendCustomMsg(String exchange, String msg) {\n    CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n    log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n    rabbitTemplate.convertAndSend(exchange, \"key\", msg, correlationData);\n\n    correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n    log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n    rabbitTemplate.convertAndSend(exchange, \"key2\", msg, correlationData);\n}\n\n@Override\npublic void confirm(CorrelationData correlationData, boolean b, String s) {\n    String id = correlationData != null ? correlationData.getId() : \"\";\n    if (b) {\n        log.info(\"消息确认成功, id:{}\", id);\n    } else {\n        log.error(\"消息未成功投递, id:{}, cause:{}\", id, s);\n    }\n}\n```\n\n然后我们调用该方法，发送两条消息测试一下：\n\n```java\n消息id:ba6bf502-9381-4220-8dc9-313d6a289a4e, msg:1\n消息id:f0040a41-dc02-4e45-b8af-e3cfa8a118b2, msg:1\n消息确认成功, id:ba6bf502-9381-4220-8dc9-313d6a289a4e\n消息确认成功, id:f0040a41-dc02-4e45-b8af-e3cfa8a118b2\n收到业务消息：1\n```\n\n可以看到，发送了两条消息，第一条消息的 *RoutingKey* 为 “key”，第二条消息的 RoutingKey 为 “key2”，两条消息都成功被交换机接收，也收到了交换机的确认回调，但消费者只收到了一条消息，因为第二条消息的 *RoutingKey* 与队列的 *BindingKey* 不一致，也没有其它队列能接收这个消息，所有第二条消息被直接丢弃了。\n\n那么，如何让消息被路由到队列后再返回ACK呢？或者无法被路由的消息帮我想办法处理一下？最起码通知我一声，我好自己处理啊。\n\n别慌别慌，*RabbitMQ*里有两个机制刚好可以解决我们上面的疑问：\n\n1、mandatory 参数\n2、备份交换机\n\n## mandatory 参数\n\n设置 *mandatory* 参数可以在当消息传递过程中不可达目的地时将消息返回给生产者。\n\n当把 *mandotory* 参数设置为 true 时，如果交换机无法将消息进行路由时，会将该消息返回给生产者，而如果该参数设置为false，如果发现消息无法进行路由，则直接丢弃。\n\n![2.png](https://i.loli.net/2019/09/01/YZ8acG1HxKQ9fLN.png)\n\n那么如何设置这个参数呢？在发送消息的时候，只需要在初始化方法添加一行代码即可：\n\n```java\nrabbitTemplate.setMandatory(true);\n```\n\n开启之后我们再重新运行前面的代码：\n\n```java\n消息id:19729f33-15c4-4c1b-8d48-044c301e2a8e, msg:1\n消息id:4aea5c57-3e71-4a7b-8a00-1595d2b568eb, msg:1\n消息确认成功, id:19729f33-15c4-4c1b-8d48-044c301e2a8e\nReturned message but no callback available\n消息确认成功, id:4aea5c57-3e71-4a7b-8a00-1595d2b568eb\n收到业务消息：1\n```\n\n我们看到中间多了一行提示 `Returned message but no callback available` 这是什么意思呢？\n\n我们上面提到，设置 *mandatory* 参数后，如果消息无法被路由，则会返回给生产者，是通过回调的方式进行的，所以，生产者需要设置相应的回调函数才能接受该消息。\n\n为了进行回调，我们需要实现一个接口 `RabbitTemplate.ReturnCallback`。\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgProducer implements RabbitTemplate.ConfirmCallback, RabbitTemplate.ReturnCallback{\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    private void init() {\n        rabbitTemplate.setConfirmCallback(this);\n        rabbitTemplate.setMandatory(true);\n        rabbitTemplate.setReturnCallback(this);\n    }\n\n    public void sendCustomMsg(String exchange, String msg) {\n        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key\", msg, correlationData);\n\n        correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key2\", msg, correlationData);\n    }\n\n    @Override\n    public void confirm(CorrelationData correlationData, boolean b, String s) {\n        String id = correlationData != null ? correlationData.getId() : \"\";\n        if (b) {\n            log.info(\"消息确认成功, id:{}\", id);\n        } else {\n            log.error(\"消息未成功投递, id:{}, cause:{}\", id, s);\n        }\n    }\n\n    @Override\n    public void returnedMessage(Message message, int replyCode, String replyText, String exchange, String routingKey) {\n        log.info(\"消息被服务器退回。msg:{}, replyCode:{}. replyText:{}, exchange:{}, routingKey :{}\",\n                new String(message.getBody()), replyCode, replyText, exchange, routingKey);\n    }\n}\n```\n\n然后我们再来重新运行一次：\n\n```java\n消息id:2e5c336a-883a-474e-b40e-b6e3499088ef, msg:1\n消息id:85c771cb-c88f-47dd-adea-f0da57138423, msg:1\n消息确认成功, id:2e5c336a-883a-474e-b40e-b6e3499088ef\n消息无法被路由，被服务器退回。msg:1, replyCode:312. replyText:NO_ROUTE, exchange:rabbitmq.tx.demo.simple.business.exchange, routingKey :key2\n消息确认成功, id:85c771cb-c88f-47dd-adea-f0da57138423\n收到业务消息：1\n```\n\n可以看到，我们接收到了被退回的消息，并带上了消息被退回的原因：`NO_ROUTE`。但是要注意的是， *mandatory* 参数仅仅是在当消息无法被路由的时候，让生产者可以感知到这一点，只要开启了生产者确认机制，无论是否设置了 *mandatory* 参数，都会在交换机接收到消息时进行消息确认回调，而且通常消息的返回回调会在消息的确认回调之前。\n\n## 备份交换机\n\n有了 *mandatory* 参数，我们获得了对无法投递消息的感知能力，有机会在生产者的消息无法被投递时发现并处理。但有时候，我们并不知道该如何处理这些无法路由的消息，最多打个日志，然后触发报警，再来手动处理。而通过日志来处理这些无法路由的消息是很不优雅的做法，特别是当生产者所在的服务有多台机器的时候，手动复制日志会更加麻烦而且容易出错。\n\n而且设置 *mandatory* 参数会增加生产者的复杂性，需要添加处理这些被退回的消息的逻辑。如果既不想丢失消息，又不想增加生产者的复杂性，该怎么做呢？\n\n前面在设置死信队列的文章中，我们提到，可以为队列设置死信交换机来存储那些处理失败的消息，可是这些不可路由消息根本没有机会进入到队列，因此无法使用死信队列来保存消息。\n\n不要慌，在 RabbitMQ 中，有一种备份交换机的机制存在，可以很好的应对这个问题。\n\n什么是备份交换机呢？备份交换机可以理解为 *RabbitMQ* 中交换机的“备胎”，当我们为某一个交换机声明一个对应的备份交换机时，就是为它创建一个备胎，当交换机接收到一条不可路由消息时，将会将这条消息转发到备份交换机中，由备份交换机来进行转发和处理，通常备份交换机的类型为 *Fanout* ，这样就能把所有消息都投递到与其绑定的队列中，然后我们在备份交换机下绑定一个队列，这样所有那些原交换机无法被路由的消息，就会都进入这个队列了。当然，我们还可以建立一个报警队列，用独立的消费者来进行监测和报警。\n\n听的不太明白？没关系，看个图就知道是怎么回事了。\n\n![3.png](https://i.loli.net/2019/09/01/VsGpZJbk2u7wSv4.png)\n\n（emmm，调整了一下配色，感觉还是很丑- - 。急需一个UI来拯救我。）\n\n接下来，我们就来设置一下备份交换机：\n\n```java\n@Configuration\npublic class RabbitMQConfig {\n\n    public static final String BUSINESS_EXCHANGE_NAME = \"rabbitmq.backup.test.exchange\";\n    public static final String BUSINESS_QUEUE_NAME = \"rabbitmq.backup.test.queue\";\n    public static final String BUSINESS_BACKUP_EXCHANGE_NAME = \"rabbitmq.backup.test.backup-exchange\";\n    public static final String BUSINESS_BACKUP_QUEUE_NAME = \"rabbitmq.backup.test.backup-queue\";\n    public static final String BUSINESS_BACKUP_WARNING_QUEUE_NAME = \"rabbitmq.backup.test.backup-warning-queue\";\n\n    // 声明业务 Exchange\n    @Bean(\"businessExchange\")\n    public DirectExchange businessExchange(){\n        ExchangeBuilder exchangeBuilder = ExchangeBuilder.directExchange(BUSINESS_EXCHANGE_NAME)\n                .durable(true)\n                .withArgument(\"alternate-exchange\", BUSINESS_BACKUP_EXCHANGE_NAME);\n\n        return (DirectExchange)exchangeBuilder.build();\n    }\n\n    // 声明备份 Exchange\n    @Bean(\"backupExchange\")\n    public FanoutExchange backupExchange(){\n        ExchangeBuilder exchangeBuilder = ExchangeBuilder.fanoutExchange(BUSINESS_BACKUP_EXCHANGE_NAME)\n                .durable(true);\n        return (FanoutExchange)exchangeBuilder.build();\n    }\n\n    // 声明业务队列\n    @Bean(\"businessQueue\")\n    public Queue businessQueue(){\n        return QueueBuilder.durable(BUSINESS_QUEUE_NAME).build();\n    }\n\n    // 声明业务队列绑定关系\n    @Bean\n    public Binding businessBinding(@Qualifier(\"businessQueue\") Queue queue,\n                                    @Qualifier(\"businessExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(\"key\");\n    }\n\n    // 声明备份队列\n    @Bean(\"backupQueue\")\n    public Queue backupQueue(){\n        return QueueBuilder.durable(BUSINESS_BACKUP_QUEUE_NAME).build();\n    }\n\n    // 声明报警队列\n    @Bean(\"warningQueue\")\n    public Queue warningQueue(){\n        return QueueBuilder.durable(BUSINESS_BACKUP_WARNING_QUEUE_NAME).build();\n    }\n\n    // 声明备份队列绑定关系\n    @Bean\n    public Binding backupBinding(@Qualifier(\"backupQueue\") Queue queue,\n                                   @Qualifier(\"backupExchange\") FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n    // 声明备份报警队列绑定关系\n    @Bean\n    public Binding backupWarningBinding(@Qualifier(\"warningQueue\") Queue queue,\n                                 @Qualifier(\"backupExchange\") FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n}\n```\n\n这里我们使用 `ExchangeBuilder` 来声明交换机，并为其设置备份交换机：\n\n```java\n .withArgument(\"alternate-exchange\", BUSINESS_BACKUP_EXCHANGE_NAME);\n```\n\n为业务交换机绑定了一个队列，为备份交换机绑定了两个队列，一个专门用来做报警用途。\n\n接下来，分别为业务交换机和备份交换机创建消费者：\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgConsumer {\n\n    @RabbitListener(queues = BUSINESS_QUEUE_NAME)\n    public void receiveMsg(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(\"收到业务消息：{}\", msg);\n        channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, false);\n    }\n}\n```\n\n```java\n@Slf4j\n@Component\npublic class BusinessWaringConsumer {\n\n    @RabbitListener(queues = BUSINESS_BACKUP_WARNING_QUEUE_NAME)\n    public void receiveMsg(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.error(\"发现不可路由消息：{}\", msg);\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n}\n```\n\n接下来我们分别发送一条可路由消息和不可路由消息：\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgProducer {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void sendCustomMsg(String exchange, String msg) {\n\n\n        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key\", msg, correlationData);\n\n        correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key2\", msg, correlationData);\n    }\n}\n```\n\n消息如下：\n\n```java\n消息id:5c3a33c9-0764-4d1f-bf6a-a00d771dccb4, msg:1\n消息id:42ac8c35-1d0a-4413-a1df-c26a85435354, msg:1\n收到业务消息：1\n发现不可路由消息：1\n```\n\n这里仅仅使用 *error* 日志配合日志系统进行报警，如果是敏感数据，可以使用邮件、钉钉、短信、电话等报警方式来提高时效性。\n\n那么问题来了，*mandatory* 参数与备份交换机可以一起使用吗？设置 *mandatory* 参数会让交换机将不可路由消息退回给生产者，而备份交换机会让交换机将不可路由消息转发给它，那么如果两者同时开启，消息究竟何去何从？？\n\nemmm，想这么多干嘛，试试不就知道了。\n\n修改一下生产者即可：\n\n```java\n@Slf4j\n@Component\npublic class BusinessMsgProducer implements RabbitTemplate.ConfirmCallback, RabbitTemplate.ReturnCallback{\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    private void init() {\n//        rabbitTemplate.setChannelTransacted(true);\n        rabbitTemplate.setConfirmCallback(this);\n        rabbitTemplate.setMandatory(true);\n        rabbitTemplate.setReturnCallback(this);\n    }\n\n    public void sendCustomMsg(String exchange, String msg) {\n\n\n        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key\", msg, correlationData);\n\n        correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(\"消息id:{}, msg:{}\", correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, \"key2\", msg, correlationData);\n    }\n\n\n    @Override\n    public void confirm(CorrelationData correlationData, boolean b, String s) {\n        String id = correlationData != null ? correlationData.getId() : \"\";\n        if (b) {\n            log.info(\"消息确认成功, id:{}\", id);\n        } else {\n            log.error(\"消息未成功投递, id:{}, cause:{}\", id, s);\n        }\n    }\n\n    @Override\n    public void returnedMessage(Message message, int replyCode, String replyText, String exchange, String routingKey) {\n        log.info(\"消息被服务器退回。msg:{}, replyCode:{}. replyText:{}, exchange:{}, routingKey :{}\",\n                new String(message.getBody()), replyCode, replyText, exchange, routingKey);\n    }\n}\n```\n\n再来测试一下：\n\n```java\n消息id:0a3eca1e-d937-418c-a7ce-bfb8ce25fdd4, msg:1\n消息id:d8c9e010-e120-46da-a42e-1ba21026ff06, msg:1\n消息确认成功, id:0a3eca1e-d937-418c-a7ce-bfb8ce25fdd4\n消息确认成功, id:d8c9e010-e120-46da-a42e-1ba21026ff06\n发现不可路由消息：1\n收到业务消息：1\n```\n\n可以看到，两条消息都可以收到确认成功回调，但是不可路由消息不会被回退给生产者，而是直接转发给备份交换机。可见备份交换机的处理优先级更高。\n\n## 总结\n\n上一篇中，我们介绍了事务机制和生产者确认机制来确保消息的可靠投递，相对而言，生产者确认机制更加高效和灵活。本篇中，我们介绍了另外两种确保生产者的消息不丢失的机制，即通过 mandatory 参数和备份交换机来处理不可路由消息。\n\n通过以上几种机制，我们总算是可以确保消息被万无一失的投递到目的地了。到此，我们的消息可靠投递也就告一段落了。消息可靠投递是我们使用MQ时无法逃避的话题，一次性搞定它，就不会再为其所困。总的来说，方法总比问题多，但如果你不知道这些方法，那么当问题来临时，也许就会不知所措了。\n\n相信通过这几篇关于 *RabbitMQ* 文章的学习，对于 *RabbitMQ* 的理解已经突破天际，那还在等什么，赶紧把接入 *RabbitMQ* 的项目好好优化一下吧，相信现在你就不会再被那些不知所云的配置和代码所迷惑了。\n\n到此为止，本篇就完美落幕了，希望能给你带来一些启发，也欢迎关注我的公众号进行留言交流。\n\n[//]: # (![1565529015677.png]&#40;https://i.loli.net/2019/08/11/8MxBPNgyIlTZDRk.png&#41;)\n","slug":"rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2","published":1,"updated":"2020-05-03T17:00:30.000Z","_id":"cl70rsfbk00155ohuf689b5gd","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>上一篇文章里，我们了解了如何保证消息被可靠投递到<em>RabbitMQ</em>的交换机中，但还有一些不完美的地方，试想一下，如果向RabbitMQ服务器发送一条消息，服务器确实也接收到了这条消息，于是给你返回了ACK确认消息，但服务器拿到这条消息一看，找不到路由它的队列，于是就把它丢进了垃圾桶，emmm，我猜应该属于可回收垃圾。</p>\n<p><img src=\"https://i.loli.net/2019/08/22/nmPFS3RkIMweEXc.png\" alt=\"1\"></p>\n<h2 id=\"如何让消息可靠投递到队列\"><a href=\"#如何让消息可靠投递到队列\" class=\"headerlink\" title=\"如何让消息可靠投递到队列\"></a>如何让消息可靠投递到队列</h2><p>如果你对上面的描述还不是很清楚，那我再用代码来说明一次。</p>\n<p>在仅开启了生产者确认机制的情况下，交换机接收到消息后，会直接给消息生产者发送确认消息，如果发现该消息不可路由，那么消息会被直接丢弃，此时，生产者是不知道消息被丢弃这个事件的。</p>\n<p>我们将上一篇中的交换机类型改为<em>DirectExchange*，这样就只有当消息的 *RoutingKey</em> 和队列绑定时设置的 <em>Bindingkey</em> （这里即“key”）一致时，才会真正将该消息进行路由。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String BUSINESS_EXCHANGE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"rabbitmq.tx.demo.simple.business.exchange\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String BUSINESS_QUEUEA_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"rabbitmq.tx.demo.simple.business.queue\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\" spellcheck=\"true\">// 声明业务 Exchange</span>\n<span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessExchange\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> DirectExchange <span class=\"token function\">businessExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span>BUSINESS_EXCHANGE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">// 声明业务队列</span>\n<span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessQueue\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> Queue <span class=\"token function\">businessQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> QueueBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span>BUSINESS_QUEUEA_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\" spellcheck=\"true\">// 声明业务队列绑定关系</span>\n<span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> Binding <span class=\"token function\">businessBinding</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessQueue\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                               <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessExchange\"</span><span class=\"token punctuation\">)</span> DirectExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"key\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>对消息生产者也稍作修改：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Autowired</span>\n<span class=\"token keyword\">private</span> RabbitTemplate rabbitTemplate<span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@PostConstruct</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\" spellcheck=\"true\">//        rabbitTemplate.setChannelTransacted(true);</span>\n    rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setConfirmCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendCustomMsg</span><span class=\"token punctuation\">(</span>String exchange<span class=\"token punctuation\">,</span> String msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    CorrelationData correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span>UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息id:{}, msg:{}\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span>UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息id:{}, msg:{}\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key2\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span>CorrelationData correlationData<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> b<span class=\"token punctuation\">,</span> String s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    String id <span class=\"token operator\">=</span> correlationData <span class=\"token operator\">!=</span> null <span class=\"token operator\">?</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息确认成功, id:{}\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息未成功投递, id:{}, cause:{}\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>然后我们调用该方法，发送两条消息测试一下：</p>\n<pre class=\" language-java\"><code class=\"language-java\">消息id<span class=\"token operator\">:</span>ba6bf502<span class=\"token operator\">-</span><span class=\"token number\">9381</span><span class=\"token operator\">-</span><span class=\"token number\">4220</span><span class=\"token operator\">-</span>8dc9<span class=\"token operator\">-</span>313d6a289a4e<span class=\"token punctuation\">,</span> msg<span class=\"token operator\">:</span><span class=\"token number\">1</span>\n消息id<span class=\"token operator\">:</span>f0040a41<span class=\"token operator\">-</span>dc02<span class=\"token operator\">-</span><span class=\"token number\">4e45</span><span class=\"token operator\">-</span>b8af<span class=\"token operator\">-</span>e3cfa8a118b2<span class=\"token punctuation\">,</span> msg<span class=\"token operator\">:</span><span class=\"token number\">1</span>\n消息确认成功<span class=\"token punctuation\">,</span> id<span class=\"token operator\">:</span>ba6bf502<span class=\"token operator\">-</span><span class=\"token number\">9381</span><span class=\"token operator\">-</span><span class=\"token number\">4220</span><span class=\"token operator\">-</span>8dc9<span class=\"token operator\">-</span>313d6a289a4e\n消息确认成功<span class=\"token punctuation\">,</span> id<span class=\"token operator\">:</span>f0040a41<span class=\"token operator\">-</span>dc02<span class=\"token operator\">-</span><span class=\"token number\">4e45</span><span class=\"token operator\">-</span>b8af<span class=\"token operator\">-</span>e3cfa8a118b2\n收到业务消息：<span class=\"token number\">1</span></code></pre>\n<p>可以看到，发送了两条消息，第一条消息的 <em>RoutingKey</em> 为 “key”，第二条消息的 RoutingKey 为 “key2”，两条消息都成功被交换机接收，也收到了交换机的确认回调，但消费者只收到了一条消息，因为第二条消息的 <em>RoutingKey</em> 与队列的 <em>BindingKey</em> 不一致，也没有其它队列能接收这个消息，所有第二条消息被直接丢弃了。</p>\n<p>那么，如何让消息被路由到队列后再返回ACK呢？或者无法被路由的消息帮我想办法处理一下？最起码通知我一声，我好自己处理啊。</p>\n<p>别慌别慌，<em>RabbitMQ</em>里有两个机制刚好可以解决我们上面的疑问：</p>\n<p>1、mandatory 参数<br>2、备份交换机</p>\n<h2 id=\"mandatory-参数\"><a href=\"#mandatory-参数\" class=\"headerlink\" title=\"mandatory 参数\"></a>mandatory 参数</h2><p>设置 <em>mandatory</em> 参数可以在当消息传递过程中不可达目的地时将消息返回给生产者。</p>\n<p>当把 <em>mandotory</em> 参数设置为 true 时，如果交换机无法将消息进行路由时，会将该消息返回给生产者，而如果该参数设置为false，如果发现消息无法进行路由，则直接丢弃。</p>\n<p><img src=\"https://i.loli.net/2019/09/01/YZ8acG1HxKQ9fLN.png\" alt=\"2.png\"></p>\n<p>那么如何设置这个参数呢？在发送消息的时候，只需要在初始化方法添加一行代码即可：</p>\n<pre class=\" language-java\"><code class=\"language-java\">rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setMandatory</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>开启之后我们再重新运行前面的代码：</p>\n<pre class=\" language-java\"><code class=\"language-java\">消息id<span class=\"token operator\">:</span>19729f33<span class=\"token operator\">-</span>15c4<span class=\"token operator\">-</span>4c1b<span class=\"token operator\">-</span>8d48<span class=\"token operator\">-</span>044c301e2a8e<span class=\"token punctuation\">,</span> msg<span class=\"token operator\">:</span><span class=\"token number\">1</span>\n消息id<span class=\"token operator\">:</span>4aea5c57<span class=\"token operator\">-</span><span class=\"token number\">3e71</span><span class=\"token operator\">-</span>4a7b<span class=\"token operator\">-</span>8a00<span class=\"token operator\">-</span>1595d2b568eb<span class=\"token punctuation\">,</span> msg<span class=\"token operator\">:</span><span class=\"token number\">1</span>\n消息确认成功<span class=\"token punctuation\">,</span> id<span class=\"token operator\">:</span>19729f33<span class=\"token operator\">-</span>15c4<span class=\"token operator\">-</span>4c1b<span class=\"token operator\">-</span>8d48<span class=\"token operator\">-</span>044c301e2a8e\nReturned message but no callback available\n消息确认成功<span class=\"token punctuation\">,</span> id<span class=\"token operator\">:</span>4aea5c57<span class=\"token operator\">-</span><span class=\"token number\">3e71</span><span class=\"token operator\">-</span>4a7b<span class=\"token operator\">-</span>8a00<span class=\"token operator\">-</span>1595d2b568eb\n收到业务消息：<span class=\"token number\">1</span></code></pre>\n<p>我们看到中间多了一行提示 <code>Returned message but no callback available</code> 这是什么意思呢？</p>\n<p>我们上面提到，设置 <em>mandatory</em> 参数后，如果消息无法被路由，则会返回给生产者，是通过回调的方式进行的，所以，生产者需要设置相应的回调函数才能接受该消息。</p>\n<p>为了进行回调，我们需要实现一个接口 <code>RabbitTemplate.ReturnCallback</code>。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BusinessMsgProducer</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">RabbitTemplate<span class=\"token punctuation\">.</span>ConfirmCallback</span><span class=\"token punctuation\">,</span> RabbitTemplate<span class=\"token punctuation\">.</span>ReturnCallback<span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> RabbitTemplate rabbitTemplate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@PostConstruct</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setConfirmCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setMandatory</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setReturnCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendCustomMsg</span><span class=\"token punctuation\">(</span>String exchange<span class=\"token punctuation\">,</span> String msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        CorrelationData correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span>UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息id:{}, msg:{}\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span>UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息id:{}, msg:{}\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key2\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span>CorrelationData correlationData<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> b<span class=\"token punctuation\">,</span> String s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        String id <span class=\"token operator\">=</span> correlationData <span class=\"token operator\">!=</span> null <span class=\"token operator\">?</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息确认成功, id:{}\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息未成功投递, id:{}, cause:{}\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">returnedMessage</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> replyCode<span class=\"token punctuation\">,</span> String replyText<span class=\"token punctuation\">,</span> String exchange<span class=\"token punctuation\">,</span> String routingKey<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息被服务器退回。msg:{}, replyCode:{}. replyText:{}, exchange:{}, routingKey :{}\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> replyCode<span class=\"token punctuation\">,</span> replyText<span class=\"token punctuation\">,</span> exchange<span class=\"token punctuation\">,</span> routingKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>然后我们再来重新运行一次：</p>\n<pre class=\" language-java\"><code class=\"language-java\">消息id<span class=\"token operator\">:</span>2e5c336a<span class=\"token operator\">-</span>883a<span class=\"token operator\">-</span>474e<span class=\"token operator\">-</span>b40e<span class=\"token operator\">-</span>b6e3499088ef<span class=\"token punctuation\">,</span> msg<span class=\"token operator\">:</span><span class=\"token number\">1</span>\n消息id<span class=\"token operator\">:</span>85c771cb<span class=\"token operator\">-</span>c88f<span class=\"token operator\">-</span>47dd<span class=\"token operator\">-</span>adea<span class=\"token operator\">-</span>f0da57138423<span class=\"token punctuation\">,</span> msg<span class=\"token operator\">:</span><span class=\"token number\">1</span>\n消息确认成功<span class=\"token punctuation\">,</span> id<span class=\"token operator\">:</span>2e5c336a<span class=\"token operator\">-</span>883a<span class=\"token operator\">-</span>474e<span class=\"token operator\">-</span>b40e<span class=\"token operator\">-</span>b6e3499088ef\n消息无法被路由，被服务器退回。msg<span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> replyCode<span class=\"token operator\">:</span><span class=\"token number\">312</span><span class=\"token punctuation\">.</span> replyText<span class=\"token operator\">:</span>NO_ROUTE<span class=\"token punctuation\">,</span> exchange<span class=\"token operator\">:</span>rabbitmq<span class=\"token punctuation\">.</span>tx<span class=\"token punctuation\">.</span>demo<span class=\"token punctuation\">.</span>simple<span class=\"token punctuation\">.</span>business<span class=\"token punctuation\">.</span>exchange<span class=\"token punctuation\">,</span> routingKey <span class=\"token operator\">:</span>key2\n消息确认成功<span class=\"token punctuation\">,</span> id<span class=\"token operator\">:</span>85c771cb<span class=\"token operator\">-</span>c88f<span class=\"token operator\">-</span>47dd<span class=\"token operator\">-</span>adea<span class=\"token operator\">-</span>f0da57138423\n收到业务消息：<span class=\"token number\">1</span></code></pre>\n<p>可以看到，我们接收到了被退回的消息，并带上了消息被退回的原因：<code>NO_ROUTE</code>。但是要注意的是， <em>mandatory</em> 参数仅仅是在当消息无法被路由的时候，让生产者可以感知到这一点，只要开启了生产者确认机制，无论是否设置了 <em>mandatory</em> 参数，都会在交换机接收到消息时进行消息确认回调，而且通常消息的返回回调会在消息的确认回调之前。</p>\n<h2 id=\"备份交换机\"><a href=\"#备份交换机\" class=\"headerlink\" title=\"备份交换机\"></a>备份交换机</h2><p>有了 <em>mandatory</em> 参数，我们获得了对无法投递消息的感知能力，有机会在生产者的消息无法被投递时发现并处理。但有时候，我们并不知道该如何处理这些无法路由的消息，最多打个日志，然后触发报警，再来手动处理。而通过日志来处理这些无法路由的消息是很不优雅的做法，特别是当生产者所在的服务有多台机器的时候，手动复制日志会更加麻烦而且容易出错。</p>\n<p>而且设置 <em>mandatory</em> 参数会增加生产者的复杂性，需要添加处理这些被退回的消息的逻辑。如果既不想丢失消息，又不想增加生产者的复杂性，该怎么做呢？</p>\n<p>前面在设置死信队列的文章中，我们提到，可以为队列设置死信交换机来存储那些处理失败的消息，可是这些不可路由消息根本没有机会进入到队列，因此无法使用死信队列来保存消息。</p>\n<p>不要慌，在 RabbitMQ 中，有一种备份交换机的机制存在，可以很好的应对这个问题。</p>\n<p>什么是备份交换机呢？备份交换机可以理解为 <em>RabbitMQ</em> 中交换机的“备胎”，当我们为某一个交换机声明一个对应的备份交换机时，就是为它创建一个备胎，当交换机接收到一条不可路由消息时，将会将这条消息转发到备份交换机中，由备份交换机来进行转发和处理，通常备份交换机的类型为 <em>Fanout</em> ，这样就能把所有消息都投递到与其绑定的队列中，然后我们在备份交换机下绑定一个队列，这样所有那些原交换机无法被路由的消息，就会都进入这个队列了。当然，我们还可以建立一个报警队列，用独立的消费者来进行监测和报警。</p>\n<p>听的不太明白？没关系，看个图就知道是怎么回事了。</p>\n<p><img src=\"https://i.loli.net/2019/09/01/VsGpZJbk2u7wSv4.png\" alt=\"3.png\"></p>\n<p>（emmm，调整了一下配色，感觉还是很丑- - 。急需一个UI来拯救我。）</p>\n<p>接下来，我们就来设置一下备份交换机：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RabbitMQConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String BUSINESS_EXCHANGE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"rabbitmq.backup.test.exchange\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String BUSINESS_QUEUE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"rabbitmq.backup.test.queue\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String BUSINESS_BACKUP_EXCHANGE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"rabbitmq.backup.test.backup-exchange\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String BUSINESS_BACKUP_QUEUE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"rabbitmq.backup.test.backup-queue\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String BUSINESS_BACKUP_WARNING_QUEUE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"rabbitmq.backup.test.backup-warning-queue\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明业务 Exchange</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessExchange\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> DirectExchange <span class=\"token function\">businessExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        ExchangeBuilder exchangeBuilder <span class=\"token operator\">=</span> ExchangeBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">directExchange</span><span class=\"token punctuation\">(</span>BUSINESS_EXCHANGE_NAME<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">withArgument</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"alternate-exchange\"</span><span class=\"token punctuation\">,</span> BUSINESS_BACKUP_EXCHANGE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>DirectExchange<span class=\"token punctuation\">)</span>exchangeBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明备份 Exchange</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"backupExchange\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> FanoutExchange <span class=\"token function\">backupExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        ExchangeBuilder exchangeBuilder <span class=\"token operator\">=</span> ExchangeBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">fanoutExchange</span><span class=\"token punctuation\">(</span>BUSINESS_BACKUP_EXCHANGE_NAME<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>FanoutExchange<span class=\"token punctuation\">)</span>exchangeBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明业务队列</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessQueue\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">businessQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> QueueBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span>BUSINESS_QUEUE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明业务队列绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">businessBinding</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessQueue\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                    <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessExchange\"</span><span class=\"token punctuation\">)</span> DirectExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"key\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明备份队列</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"backupQueue\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">backupQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> QueueBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span>BUSINESS_BACKUP_QUEUE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明报警队列</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"warningQueue\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">warningQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> QueueBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span>BUSINESS_BACKUP_WARNING_QUEUE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明备份队列绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">backupBinding</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"backupQueue\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                   <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"backupExchange\"</span><span class=\"token punctuation\">)</span> FanoutExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明备份报警队列绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">backupWarningBinding</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"warningQueue\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                 <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"backupExchange\"</span><span class=\"token punctuation\">)</span> FanoutExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这里我们使用 <code>ExchangeBuilder</code> 来声明交换机，并为其设置备份交换机：</p>\n<pre class=\" language-java\"><code class=\"language-java\"> <span class=\"token punctuation\">.</span><span class=\"token function\">withArgument</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"alternate-exchange\"</span><span class=\"token punctuation\">,</span> BUSINESS_BACKUP_EXCHANGE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>为业务交换机绑定了一个队列，为备份交换机绑定了两个队列，一个专门用来做报警用途。</p>\n<p>接下来，分别为业务交换机和备份交换机创建消费者：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BusinessMsgConsumer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> BUSINESS_QUEUE_NAME<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveMsg</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> Channel channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException <span class=\"token punctuation\">{</span>\n        String msg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"收到业务消息：{}\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicNack</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BusinessWaringConsumer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> BUSINESS_BACKUP_WARNING_QUEUE_NAME<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveMsg</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> Channel channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException <span class=\"token punctuation\">{</span>\n        String msg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发现不可路由消息：{}\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>接下来我们分别发送一条可路由消息和不可路由消息：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BusinessMsgProducer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> RabbitTemplate rabbitTemplate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendCustomMsg</span><span class=\"token punctuation\">(</span>String exchange<span class=\"token punctuation\">,</span> String msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\n        CorrelationData correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span>UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息id:{}, msg:{}\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span>UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息id:{}, msg:{}\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key2\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>消息如下：</p>\n<pre class=\" language-java\"><code class=\"language-java\">消息id<span class=\"token operator\">:</span>5c3a33c9<span class=\"token operator\">-</span><span class=\"token number\">0764</span><span class=\"token operator\">-</span>4d1f<span class=\"token operator\">-</span>bf6a<span class=\"token operator\">-</span>a00d771dccb4<span class=\"token punctuation\">,</span> msg<span class=\"token operator\">:</span><span class=\"token number\">1</span>\n消息id<span class=\"token operator\">:</span>42ac8c35<span class=\"token operator\">-</span>1d0a<span class=\"token operator\">-</span><span class=\"token number\">4413</span><span class=\"token operator\">-</span>a1df<span class=\"token operator\">-</span>c26a85435354<span class=\"token punctuation\">,</span> msg<span class=\"token operator\">:</span><span class=\"token number\">1</span>\n收到业务消息：<span class=\"token number\">1</span>\n发现不可路由消息：<span class=\"token number\">1</span></code></pre>\n<p>这里仅仅使用 <em>error</em> 日志配合日志系统进行报警，如果是敏感数据，可以使用邮件、钉钉、短信、电话等报警方式来提高时效性。</p>\n<p>那么问题来了，<em>mandatory</em> 参数与备份交换机可以一起使用吗？设置 <em>mandatory</em> 参数会让交换机将不可路由消息退回给生产者，而备份交换机会让交换机将不可路由消息转发给它，那么如果两者同时开启，消息究竟何去何从？？</p>\n<p>emmm，想这么多干嘛，试试不就知道了。</p>\n<p>修改一下生产者即可：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BusinessMsgProducer</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">RabbitTemplate<span class=\"token punctuation\">.</span>ConfirmCallback</span><span class=\"token punctuation\">,</span> RabbitTemplate<span class=\"token punctuation\">.</span>ReturnCallback<span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> RabbitTemplate rabbitTemplate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@PostConstruct</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\" spellcheck=\"true\">//        rabbitTemplate.setChannelTransacted(true);</span>\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setConfirmCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setMandatory</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setReturnCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendCustomMsg</span><span class=\"token punctuation\">(</span>String exchange<span class=\"token punctuation\">,</span> String msg<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\n        CorrelationData correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span>UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息id:{}, msg:{}\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        correlationData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CorrelationData</span><span class=\"token punctuation\">(</span>UUID<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息id:{}, msg:{}\"</span><span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">,</span> <span class=\"token string\">\"key2\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> correlationData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span>CorrelationData correlationData<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> b<span class=\"token punctuation\">,</span> String s<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        String id <span class=\"token operator\">=</span> correlationData <span class=\"token operator\">!=</span> null <span class=\"token operator\">?</span> correlationData<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息确认成功, id:{}\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息未成功投递, id:{}, cause:{}\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">returnedMessage</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> replyCode<span class=\"token punctuation\">,</span> String replyText<span class=\"token punctuation\">,</span> String exchange<span class=\"token punctuation\">,</span> String routingKey<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息被服务器退回。msg:{}, replyCode:{}. replyText:{}, exchange:{}, routingKey :{}\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> replyCode<span class=\"token punctuation\">,</span> replyText<span class=\"token punctuation\">,</span> exchange<span class=\"token punctuation\">,</span> routingKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>再来测试一下：</p>\n<pre class=\" language-java\"><code class=\"language-java\">消息id<span class=\"token operator\">:</span>0a3eca1e<span class=\"token operator\">-</span>d937<span class=\"token operator\">-</span>418c<span class=\"token operator\">-</span>a7ce<span class=\"token operator\">-</span>bfb8ce25fdd4<span class=\"token punctuation\">,</span> msg<span class=\"token operator\">:</span><span class=\"token number\">1</span>\n消息id<span class=\"token operator\">:</span>d8c9e010<span class=\"token operator\">-</span>e120<span class=\"token operator\">-</span>46da<span class=\"token operator\">-</span>a42e<span class=\"token operator\">-</span>1ba21026ff06<span class=\"token punctuation\">,</span> msg<span class=\"token operator\">:</span><span class=\"token number\">1</span>\n消息确认成功<span class=\"token punctuation\">,</span> id<span class=\"token operator\">:</span>0a3eca1e<span class=\"token operator\">-</span>d937<span class=\"token operator\">-</span>418c<span class=\"token operator\">-</span>a7ce<span class=\"token operator\">-</span>bfb8ce25fdd4\n消息确认成功<span class=\"token punctuation\">,</span> id<span class=\"token operator\">:</span>d8c9e010<span class=\"token operator\">-</span>e120<span class=\"token operator\">-</span>46da<span class=\"token operator\">-</span>a42e<span class=\"token operator\">-</span>1ba21026ff06\n发现不可路由消息：<span class=\"token number\">1</span>\n收到业务消息：<span class=\"token number\">1</span></code></pre>\n<p>可以看到，两条消息都可以收到确认成功回调，但是不可路由消息不会被回退给生产者，而是直接转发给备份交换机。可见备份交换机的处理优先级更高。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>上一篇中，我们介绍了事务机制和生产者确认机制来确保消息的可靠投递，相对而言，生产者确认机制更加高效和灵活。本篇中，我们介绍了另外两种确保生产者的消息不丢失的机制，即通过 mandatory 参数和备份交换机来处理不可路由消息。</p>\n<p>通过以上几种机制，我们总算是可以确保消息被万无一失的投递到目的地了。到此，我们的消息可靠投递也就告一段落了。消息可靠投递是我们使用MQ时无法逃避的话题，一次性搞定它，就不会再为其所困。总的来说，方法总比问题多，但如果你不知道这些方法，那么当问题来临时，也许就会不知所措了。</p>\n<p>相信通过这几篇关于 <em>RabbitMQ</em> 文章的学习，对于 <em>RabbitMQ</em> 的理解已经突破天际，那还在等什么，赶紧把接入 <em>RabbitMQ</em> 的项目好好优化一下吧，相信现在你就不会再被那些不知所云的配置和代码所迷惑了。</p>\n<p>到此为止，本篇就完美落幕了，希望能给你带来一些启发，也欢迎关注我的公众号进行留言交流。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>上一篇文章里，我们了解了如何保证消息被可靠投递到<em>RabbitMQ</em>的交换机中，但还有一些不完美的地方，试想一下，如果向RabbitMQ服务器发送一条消息，服务器确实也接收到了这条消息，于是给你返回了ACK确认消息，但服务器拿到这条消息一看，找不到路由它的队列，于是就把它丢进了垃圾桶，emmm，我猜应该属于可回收垃圾。</p>\n<p><img src=\"https://i.loli.net/2019/08/22/nmPFS3RkIMweEXc.png\" alt=\"1\"></p>\n<h2 id=\"如何让消息可靠投递到队列\"><a href=\"#如何让消息可靠投递到队列\" class=\"headerlink\" title=\"如何让消息可靠投递到队列\"></a>如何让消息可靠投递到队列</h2><p>如果你对上面的描述还不是很清楚，那我再用代码来说明一次。</p>\n<p>在仅开启了生产者确认机制的情况下，交换机接收到消息后，会直接给消息生产者发送确认消息，如果发现该消息不可路由，那么消息会被直接丢弃，此时，生产者是不知道消息被丢弃这个事件的。</p>\n<p>我们将上一篇中的交换机类型改为<em>DirectExchange*，这样就只有当消息的 *RoutingKey</em> 和队列绑定时设置的 <em>Bindingkey</em> （这里即“key”）一致时，才会真正将该消息进行路由。</p>\n<pre><code class=\"java\">public static final String BUSINESS_EXCHANGE_NAME = &quot;rabbitmq.tx.demo.simple.business.exchange&quot;;\npublic static final String BUSINESS_QUEUEA_NAME = &quot;rabbitmq.tx.demo.simple.business.queue&quot;;\n\n// 声明业务 Exchange\n@Bean(&quot;businessExchange&quot;)\npublic DirectExchange businessExchange(){\n    return new DirectExchange(BUSINESS_EXCHANGE_NAME);\n}\n\n// 声明业务队列\n@Bean(&quot;businessQueue&quot;)\npublic Queue businessQueue(){\n    return QueueBuilder.durable(BUSINESS_QUEUEA_NAME).build();\n}\n\n// 声明业务队列绑定关系\n@Bean\npublic Binding businessBinding(@Qualifier(&quot;businessQueue&quot;) Queue queue,\n                               @Qualifier(&quot;businessExchange&quot;) DirectExchange exchange){\n    return BindingBuilder.bind(queue).to(exchange).with(&quot;key&quot;);\n}</code></pre>\n<p>对消息生产者也稍作修改：</p>\n<pre><code class=\"java\">@Autowired\nprivate RabbitTemplate rabbitTemplate;\n\n@PostConstruct\nprivate void init() {\n    //        rabbitTemplate.setChannelTransacted(true);\n    rabbitTemplate.setConfirmCallback(this);\n}\n\npublic void sendCustomMsg(String exchange, String msg) {\n    CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n    log.info(&quot;消息id:{}, msg:{}&quot;, correlationData.getId(), msg);\n\n    rabbitTemplate.convertAndSend(exchange, &quot;key&quot;, msg, correlationData);\n\n    correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n    log.info(&quot;消息id:{}, msg:{}&quot;, correlationData.getId(), msg);\n\n    rabbitTemplate.convertAndSend(exchange, &quot;key2&quot;, msg, correlationData);\n}\n\n@Override\npublic void confirm(CorrelationData correlationData, boolean b, String s) {\n    String id = correlationData != null ? correlationData.getId() : &quot;&quot;;\n    if (b) {\n        log.info(&quot;消息确认成功, id:{}&quot;, id);\n    } else {\n        log.error(&quot;消息未成功投递, id:{}, cause:{}&quot;, id, s);\n    }\n}</code></pre>\n<p>然后我们调用该方法，发送两条消息测试一下：</p>\n<pre><code class=\"java\">消息id:ba6bf502-9381-4220-8dc9-313d6a289a4e, msg:1\n消息id:f0040a41-dc02-4e45-b8af-e3cfa8a118b2, msg:1\n消息确认成功, id:ba6bf502-9381-4220-8dc9-313d6a289a4e\n消息确认成功, id:f0040a41-dc02-4e45-b8af-e3cfa8a118b2\n收到业务消息：1</code></pre>\n<p>可以看到，发送了两条消息，第一条消息的 <em>RoutingKey</em> 为 “key”，第二条消息的 RoutingKey 为 “key2”，两条消息都成功被交换机接收，也收到了交换机的确认回调，但消费者只收到了一条消息，因为第二条消息的 <em>RoutingKey</em> 与队列的 <em>BindingKey</em> 不一致，也没有其它队列能接收这个消息，所有第二条消息被直接丢弃了。</p>\n<p>那么，如何让消息被路由到队列后再返回ACK呢？或者无法被路由的消息帮我想办法处理一下？最起码通知我一声，我好自己处理啊。</p>\n<p>别慌别慌，<em>RabbitMQ</em>里有两个机制刚好可以解决我们上面的疑问：</p>\n<p>1、mandatory 参数<br>2、备份交换机</p>\n<h2 id=\"mandatory-参数\"><a href=\"#mandatory-参数\" class=\"headerlink\" title=\"mandatory 参数\"></a>mandatory 参数</h2><p>设置 <em>mandatory</em> 参数可以在当消息传递过程中不可达目的地时将消息返回给生产者。</p>\n<p>当把 <em>mandotory</em> 参数设置为 true 时，如果交换机无法将消息进行路由时，会将该消息返回给生产者，而如果该参数设置为false，如果发现消息无法进行路由，则直接丢弃。</p>\n<p><img src=\"https://i.loli.net/2019/09/01/YZ8acG1HxKQ9fLN.png\" alt=\"2.png\"></p>\n<p>那么如何设置这个参数呢？在发送消息的时候，只需要在初始化方法添加一行代码即可：</p>\n<pre><code class=\"java\">rabbitTemplate.setMandatory(true);</code></pre>\n<p>开启之后我们再重新运行前面的代码：</p>\n<pre><code class=\"java\">消息id:19729f33-15c4-4c1b-8d48-044c301e2a8e, msg:1\n消息id:4aea5c57-3e71-4a7b-8a00-1595d2b568eb, msg:1\n消息确认成功, id:19729f33-15c4-4c1b-8d48-044c301e2a8e\nReturned message but no callback available\n消息确认成功, id:4aea5c57-3e71-4a7b-8a00-1595d2b568eb\n收到业务消息：1</code></pre>\n<p>我们看到中间多了一行提示 <code>Returned message but no callback available</code> 这是什么意思呢？</p>\n<p>我们上面提到，设置 <em>mandatory</em> 参数后，如果消息无法被路由，则会返回给生产者，是通过回调的方式进行的，所以，生产者需要设置相应的回调函数才能接受该消息。</p>\n<p>为了进行回调，我们需要实现一个接口 <code>RabbitTemplate.ReturnCallback</code>。</p>\n<pre><code class=\"java\">@Slf4j\n@Component\npublic class BusinessMsgProducer implements RabbitTemplate.ConfirmCallback, RabbitTemplate.ReturnCallback{\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    private void init() {\n        rabbitTemplate.setConfirmCallback(this);\n        rabbitTemplate.setMandatory(true);\n        rabbitTemplate.setReturnCallback(this);\n    }\n\n    public void sendCustomMsg(String exchange, String msg) {\n        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(&quot;消息id:{}, msg:{}&quot;, correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, &quot;key&quot;, msg, correlationData);\n\n        correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(&quot;消息id:{}, msg:{}&quot;, correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, &quot;key2&quot;, msg, correlationData);\n    }\n\n    @Override\n    public void confirm(CorrelationData correlationData, boolean b, String s) {\n        String id = correlationData != null ? correlationData.getId() : &quot;&quot;;\n        if (b) {\n            log.info(&quot;消息确认成功, id:{}&quot;, id);\n        } else {\n            log.error(&quot;消息未成功投递, id:{}, cause:{}&quot;, id, s);\n        }\n    }\n\n    @Override\n    public void returnedMessage(Message message, int replyCode, String replyText, String exchange, String routingKey) {\n        log.info(&quot;消息被服务器退回。msg:{}, replyCode:{}. replyText:{}, exchange:{}, routingKey :{}&quot;,\n                new String(message.getBody()), replyCode, replyText, exchange, routingKey);\n    }\n}</code></pre>\n<p>然后我们再来重新运行一次：</p>\n<pre><code class=\"java\">消息id:2e5c336a-883a-474e-b40e-b6e3499088ef, msg:1\n消息id:85c771cb-c88f-47dd-adea-f0da57138423, msg:1\n消息确认成功, id:2e5c336a-883a-474e-b40e-b6e3499088ef\n消息无法被路由，被服务器退回。msg:1, replyCode:312. replyText:NO_ROUTE, exchange:rabbitmq.tx.demo.simple.business.exchange, routingKey :key2\n消息确认成功, id:85c771cb-c88f-47dd-adea-f0da57138423\n收到业务消息：1</code></pre>\n<p>可以看到，我们接收到了被退回的消息，并带上了消息被退回的原因：<code>NO_ROUTE</code>。但是要注意的是， <em>mandatory</em> 参数仅仅是在当消息无法被路由的时候，让生产者可以感知到这一点，只要开启了生产者确认机制，无论是否设置了 <em>mandatory</em> 参数，都会在交换机接收到消息时进行消息确认回调，而且通常消息的返回回调会在消息的确认回调之前。</p>\n<h2 id=\"备份交换机\"><a href=\"#备份交换机\" class=\"headerlink\" title=\"备份交换机\"></a>备份交换机</h2><p>有了 <em>mandatory</em> 参数，我们获得了对无法投递消息的感知能力，有机会在生产者的消息无法被投递时发现并处理。但有时候，我们并不知道该如何处理这些无法路由的消息，最多打个日志，然后触发报警，再来手动处理。而通过日志来处理这些无法路由的消息是很不优雅的做法，特别是当生产者所在的服务有多台机器的时候，手动复制日志会更加麻烦而且容易出错。</p>\n<p>而且设置 <em>mandatory</em> 参数会增加生产者的复杂性，需要添加处理这些被退回的消息的逻辑。如果既不想丢失消息，又不想增加生产者的复杂性，该怎么做呢？</p>\n<p>前面在设置死信队列的文章中，我们提到，可以为队列设置死信交换机来存储那些处理失败的消息，可是这些不可路由消息根本没有机会进入到队列，因此无法使用死信队列来保存消息。</p>\n<p>不要慌，在 RabbitMQ 中，有一种备份交换机的机制存在，可以很好的应对这个问题。</p>\n<p>什么是备份交换机呢？备份交换机可以理解为 <em>RabbitMQ</em> 中交换机的“备胎”，当我们为某一个交换机声明一个对应的备份交换机时，就是为它创建一个备胎，当交换机接收到一条不可路由消息时，将会将这条消息转发到备份交换机中，由备份交换机来进行转发和处理，通常备份交换机的类型为 <em>Fanout</em> ，这样就能把所有消息都投递到与其绑定的队列中，然后我们在备份交换机下绑定一个队列，这样所有那些原交换机无法被路由的消息，就会都进入这个队列了。当然，我们还可以建立一个报警队列，用独立的消费者来进行监测和报警。</p>\n<p>听的不太明白？没关系，看个图就知道是怎么回事了。</p>\n<p><img src=\"https://i.loli.net/2019/09/01/VsGpZJbk2u7wSv4.png\" alt=\"3.png\"></p>\n<p>（emmm，调整了一下配色，感觉还是很丑- - 。急需一个UI来拯救我。）</p>\n<p>接下来，我们就来设置一下备份交换机：</p>\n<pre><code class=\"java\">@Configuration\npublic class RabbitMQConfig {\n\n    public static final String BUSINESS_EXCHANGE_NAME = &quot;rabbitmq.backup.test.exchange&quot;;\n    public static final String BUSINESS_QUEUE_NAME = &quot;rabbitmq.backup.test.queue&quot;;\n    public static final String BUSINESS_BACKUP_EXCHANGE_NAME = &quot;rabbitmq.backup.test.backup-exchange&quot;;\n    public static final String BUSINESS_BACKUP_QUEUE_NAME = &quot;rabbitmq.backup.test.backup-queue&quot;;\n    public static final String BUSINESS_BACKUP_WARNING_QUEUE_NAME = &quot;rabbitmq.backup.test.backup-warning-queue&quot;;\n\n    // 声明业务 Exchange\n    @Bean(&quot;businessExchange&quot;)\n    public DirectExchange businessExchange(){\n        ExchangeBuilder exchangeBuilder = ExchangeBuilder.directExchange(BUSINESS_EXCHANGE_NAME)\n                .durable(true)\n                .withArgument(&quot;alternate-exchange&quot;, BUSINESS_BACKUP_EXCHANGE_NAME);\n\n        return (DirectExchange)exchangeBuilder.build();\n    }\n\n    // 声明备份 Exchange\n    @Bean(&quot;backupExchange&quot;)\n    public FanoutExchange backupExchange(){\n        ExchangeBuilder exchangeBuilder = ExchangeBuilder.fanoutExchange(BUSINESS_BACKUP_EXCHANGE_NAME)\n                .durable(true);\n        return (FanoutExchange)exchangeBuilder.build();\n    }\n\n    // 声明业务队列\n    @Bean(&quot;businessQueue&quot;)\n    public Queue businessQueue(){\n        return QueueBuilder.durable(BUSINESS_QUEUE_NAME).build();\n    }\n\n    // 声明业务队列绑定关系\n    @Bean\n    public Binding businessBinding(@Qualifier(&quot;businessQueue&quot;) Queue queue,\n                                    @Qualifier(&quot;businessExchange&quot;) DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(&quot;key&quot;);\n    }\n\n    // 声明备份队列\n    @Bean(&quot;backupQueue&quot;)\n    public Queue backupQueue(){\n        return QueueBuilder.durable(BUSINESS_BACKUP_QUEUE_NAME).build();\n    }\n\n    // 声明报警队列\n    @Bean(&quot;warningQueue&quot;)\n    public Queue warningQueue(){\n        return QueueBuilder.durable(BUSINESS_BACKUP_WARNING_QUEUE_NAME).build();\n    }\n\n    // 声明备份队列绑定关系\n    @Bean\n    public Binding backupBinding(@Qualifier(&quot;backupQueue&quot;) Queue queue,\n                                   @Qualifier(&quot;backupExchange&quot;) FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n    // 声明备份报警队列绑定关系\n    @Bean\n    public Binding backupWarningBinding(@Qualifier(&quot;warningQueue&quot;) Queue queue,\n                                 @Qualifier(&quot;backupExchange&quot;) FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n}</code></pre>\n<p>这里我们使用 <code>ExchangeBuilder</code> 来声明交换机，并为其设置备份交换机：</p>\n<pre><code class=\"java\"> .withArgument(&quot;alternate-exchange&quot;, BUSINESS_BACKUP_EXCHANGE_NAME);</code></pre>\n<p>为业务交换机绑定了一个队列，为备份交换机绑定了两个队列，一个专门用来做报警用途。</p>\n<p>接下来，分别为业务交换机和备份交换机创建消费者：</p>\n<pre><code class=\"java\">@Slf4j\n@Component\npublic class BusinessMsgConsumer {\n\n    @RabbitListener(queues = BUSINESS_QUEUE_NAME)\n    public void receiveMsg(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(&quot;收到业务消息：{}&quot;, msg);\n        channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, false);\n    }\n}</code></pre>\n<pre><code class=\"java\">@Slf4j\n@Component\npublic class BusinessWaringConsumer {\n\n    @RabbitListener(queues = BUSINESS_BACKUP_WARNING_QUEUE_NAME)\n    public void receiveMsg(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.error(&quot;发现不可路由消息：{}&quot;, msg);\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n}</code></pre>\n<p>接下来我们分别发送一条可路由消息和不可路由消息：</p>\n<pre><code class=\"java\">@Slf4j\n@Component\npublic class BusinessMsgProducer {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void sendCustomMsg(String exchange, String msg) {\n\n\n        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n\n        log.info(&quot;消息id:{}, msg:{}&quot;, correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, &quot;key&quot;, msg, correlationData);\n\n        correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(&quot;消息id:{}, msg:{}&quot;, correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, &quot;key2&quot;, msg, correlationData);\n    }\n}</code></pre>\n<p>消息如下：</p>\n<pre><code class=\"java\">消息id:5c3a33c9-0764-4d1f-bf6a-a00d771dccb4, msg:1\n消息id:42ac8c35-1d0a-4413-a1df-c26a85435354, msg:1\n收到业务消息：1\n发现不可路由消息：1</code></pre>\n<p>这里仅仅使用 <em>error</em> 日志配合日志系统进行报警，如果是敏感数据，可以使用邮件、钉钉、短信、电话等报警方式来提高时效性。</p>\n<p>那么问题来了，<em>mandatory</em> 参数与备份交换机可以一起使用吗？设置 <em>mandatory</em> 参数会让交换机将不可路由消息退回给生产者，而备份交换机会让交换机将不可路由消息转发给它，那么如果两者同时开启，消息究竟何去何从？？</p>\n<p>emmm，想这么多干嘛，试试不就知道了。</p>\n<p>修改一下生产者即可：</p>\n<pre><code class=\"java\">@Slf4j\n@Component\npublic class BusinessMsgProducer implements RabbitTemplate.ConfirmCallback, RabbitTemplate.ReturnCallback{\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    private void init() {\n//        rabbitTemplate.setChannelTransacted(true);\n        rabbitTemplate.setConfirmCallback(this);\n        rabbitTemplate.setMandatory(true);\n        rabbitTemplate.setReturnCallback(this);\n    }\n\n    public void sendCustomMsg(String exchange, String msg) {\n\n\n        CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n\n        log.info(&quot;消息id:{}, msg:{}&quot;, correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, &quot;key&quot;, msg, correlationData);\n\n        correlationData = new CorrelationData(UUID.randomUUID().toString());\n\n        log.info(&quot;消息id:{}, msg:{}&quot;, correlationData.getId(), msg);\n\n        rabbitTemplate.convertAndSend(exchange, &quot;key2&quot;, msg, correlationData);\n    }\n\n\n    @Override\n    public void confirm(CorrelationData correlationData, boolean b, String s) {\n        String id = correlationData != null ? correlationData.getId() : &quot;&quot;;\n        if (b) {\n            log.info(&quot;消息确认成功, id:{}&quot;, id);\n        } else {\n            log.error(&quot;消息未成功投递, id:{}, cause:{}&quot;, id, s);\n        }\n    }\n\n    @Override\n    public void returnedMessage(Message message, int replyCode, String replyText, String exchange, String routingKey) {\n        log.info(&quot;消息被服务器退回。msg:{}, replyCode:{}. replyText:{}, exchange:{}, routingKey :{}&quot;,\n                new String(message.getBody()), replyCode, replyText, exchange, routingKey);\n    }\n}</code></pre>\n<p>再来测试一下：</p>\n<pre><code class=\"java\">消息id:0a3eca1e-d937-418c-a7ce-bfb8ce25fdd4, msg:1\n消息id:d8c9e010-e120-46da-a42e-1ba21026ff06, msg:1\n消息确认成功, id:0a3eca1e-d937-418c-a7ce-bfb8ce25fdd4\n消息确认成功, id:d8c9e010-e120-46da-a42e-1ba21026ff06\n发现不可路由消息：1\n收到业务消息：1</code></pre>\n<p>可以看到，两条消息都可以收到确认成功回调，但是不可路由消息不会被回退给生产者，而是直接转发给备份交换机。可见备份交换机的处理优先级更高。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>上一篇中，我们介绍了事务机制和生产者确认机制来确保消息的可靠投递，相对而言，生产者确认机制更加高效和灵活。本篇中，我们介绍了另外两种确保生产者的消息不丢失的机制，即通过 mandatory 参数和备份交换机来处理不可路由消息。</p>\n<p>通过以上几种机制，我们总算是可以确保消息被万无一失的投递到目的地了。到此，我们的消息可靠投递也就告一段落了。消息可靠投递是我们使用MQ时无法逃避的话题，一次性搞定它，就不会再为其所困。总的来说，方法总比问题多，但如果你不知道这些方法，那么当问题来临时，也许就会不知所措了。</p>\n<p>相信通过这几篇关于 <em>RabbitMQ</em> 文章的学习，对于 <em>RabbitMQ</em> 的理解已经突破天际，那还在等什么，赶紧把接入 <em>RabbitMQ</em> 的项目好好优化一下吧，相信现在你就不会再被那些不知所云的配置和代码所迷惑了。</p>\n<p>到此为止，本篇就完美落幕了，希望能给你带来一些启发，也欢迎关注我的公众号进行留言交流。</p>\n"},{"title":"【RabbitMQ】一文带你搞定RabbitMQ死信队列","toc":true,"top":true,"cover":true,"date":"2020-05-03T17:00:40.000Z","_content":"\n本文口味：爆炒鱿鱼   预计阅读：15分钟\n\n## 一、说明\n\nRabbitMQ是流行的开源消息队列系统，使用erlang语言开发，由于其社区活跃度高，维护更新较快，性能稳定，深得很多企业的欢心（当然，也包括我现在所在公司【手动滑稽】）。\n\n为了保证订单业务的消息数据不丢失，需要使用到RabbitMQ的死信队列机制，当消息消费发生异常时，将消息投入死信队列中。但由于对死信队列的概念及配置不熟悉，导致曾一度陷入百度的汪洋大海，无法自拔，很多文章都看起来可行，但是实际上却并不能帮我解决实际问题。最终，在官网文档中找到了我想要的答案，通过官网文档的学习，才发现对于死信队列存在一些误解，导致配置死信队列之路困难重重。\n\n于是本着记录和分享的精神，将死信队列的概念和配置完整的写下来，以便帮助遇到同样问题的朋友。\n\n## 二、本文大纲\n\n以下是本文大纲：\n\n![AG4T332}_NEUNPUAU(A_)U6.png](https://i.loli.net/2019/07/14/5d2af4176d1d483480.png)\n\n本文阅读前，需要对RabbitMQ有一个简单的了解，偏向实战配置讲解。\n\n## 三、死信队列是什么\n\n死信，在官网中对应的单词为“Dead Letter”，可以看出翻译确实非常的简单粗暴。那么死信是个什么东西呢？\n\n“死信”是RabbitMQ中的一种消息机制，当你在消费消息时，如果队列里的消息出现以下情况：\n\n1. 消息被否定确认，使用 `channel.basicNack`  或 `channel.basicReject` ，并且此时`requeue` 属性被设置为`false`。\n2. 消息在队列的存活时间超过设置的TTL时间。\n3. 消息队列的消息数量已经超过最大队列长度。\n\n那么该消息将成为“死信”。\n\n“死信”消息会被RabbitMQ进行特殊处理，如果配置了死信队列信息，那么该消息将会被丢进死信队列中，如果没有配置，则该消息将会被丢弃。\n\n## 四、如何配置死信队列\n\n这一部分将是本文的关键，如何配置死信队列呢？其实很简单，大概可以分为以下步骤：\n\n1. 配置业务队列，绑定到业务交换机上\n2. 为业务队列配置死信交换机和路由key\n3. 为死信交换机配置死信队列\n\n注意，并不是直接声明一个公共的死信队列，然后所以死信消息就自己跑到死信队列里去了。而是为每个需要使用死信的业务队列配置一个死信交换机，这里同一个项目的死信交换机可以共用一个，然后为每个业务队列分配一个单独的路由key。\n\n有了死信交换机和路由key后，接下来，就像配置业务队列一样，配置死信队列，然后绑定在死信交换机上。也就是说，死信队列并不是什么特殊的队列，只不过是绑定在死信交换机上的队列。死信交换机也不是什么特殊的交换机，只不过是用来接受死信的交换机，所以可以为任何类型【Direct、Fanout、Topic】。一般来说，会为每个业务队列分配一个独有的路由key，并对应的配置一个死信队列进行监听，也就是说，一般会为每个重要的业务队列配置一个死信队列。\n\n有了前文这些陈述后，接下来就是惊险刺激的实战环节，这里省略了RabbitMQ环境的部署和搭建环节。\n\n先创建一个Springboot项目。然后在pom文件中添加 `spring-boot-starter-amqp` 和 `spring-boot-starter-web` 的依赖，接下来创建一个Config类，这里是关键：\n\n```java\n@Configuration\npublic class RabbitMQConfig {\n\n    public static final String BUSINESS_EXCHANGE_NAME = \"dead.letter.demo.simple.business.exchange\";\n    public static final String BUSINESS_QUEUEA_NAME = \"dead.letter.demo.simple.business.queuea\";\n    public static final String BUSINESS_QUEUEB_NAME = \"dead.letter.demo.simple.business.queueb\";\n    public static final String DEAD_LETTER_EXCHANGE = \"dead.letter.demo.simple.deadletter.exchange\";\n    public static final String DEAD_LETTER_QUEUEA_ROUTING_KEY = \"dead.letter.demo.simple.deadletter.queuea.routingkey\";\n    public static final String DEAD_LETTER_QUEUEB_ROUTING_KEY = \"dead.letter.demo.simple.deadletter.queueb.routingkey\";\n    public static final String DEAD_LETTER_QUEUEA_NAME = \"dead.letter.demo.simple.deadletter.queuea\";\n    public static final String DEAD_LETTER_QUEUEB_NAME = \"dead.letter.demo.simple.deadletter.queueb\";\n\n    // 声明业务Exchange\n    @Bean(\"businessExchange\")\n    public FanoutExchange businessExchange(){\n        return new FanoutExchange(BUSINESS_EXCHANGE_NAME);\n    }\n\n    // 声明死信Exchange\n    @Bean(\"deadLetterExchange\")\n    public DirectExchange deadLetterExchange(){\n        return new DirectExchange(DEAD_LETTER_EXCHANGE);\n    }\n\n    // 声明业务队列A\n    @Bean(\"businessQueueA\")\n    public Queue businessQueueA(){\n        Map<String, Object> args = new HashMap<>(2);\n//       x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(\"x-dead-letter-exchange\", DEAD_LETTER_EXCHANGE);\n//       x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(\"x-dead-letter-routing-key\", DEAD_LETTER_QUEUEA_ROUTING_KEY);\n        return QueueBuilder.durable(BUSINESS_QUEUEA_NAME).withArguments(args).build();\n    }\n\n    // 声明业务队列B\n    @Bean(\"businessQueueB\")\n    public Queue businessQueueB(){\n        Map<String, Object> args = new HashMap<>(2);\n//       x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(\"x-dead-letter-exchange\", DEAD_LETTER_EXCHANGE);\n//       x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(\"x-dead-letter-routing-key\", DEAD_LETTER_QUEUEB_ROUTING_KEY);\n        return QueueBuilder.durable(BUSINESS_QUEUEB_NAME).withArguments(args).build();\n    }\n\n    // 声明死信队列A\n    @Bean(\"deadLetterQueueA\")\n    public Queue deadLetterQueueA(){\n        return new Queue(DEAD_LETTER_QUEUEA_NAME);\n    }\n\n    // 声明死信队列B\n    @Bean(\"deadLetterQueueB\")\n    public Queue deadLetterQueueB(){\n        return new Queue(DEAD_LETTER_QUEUEB_NAME);\n    }\n\n    // 声明业务队列A绑定关系\n    @Bean\n    public Binding businessBindingA(@Qualifier(\"businessQueueA\") Queue queue,\n                                    @Qualifier(\"businessExchange\") FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n    // 声明业务队列B绑定关系\n    @Bean\n    public Binding businessBindingB(@Qualifier(\"businessQueueB\") Queue queue,\n                                    @Qualifier(\"businessExchange\") FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n    // 声明死信队列A绑定关系\n    @Bean\n    public Binding deadLetterBindingA(@Qualifier(\"deadLetterQueueA\") Queue queue,\n                                    @Qualifier(\"deadLetterExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEA_ROUTING_KEY);\n    }\n\n    // 声明死信队列B绑定关系\n    @Bean\n    public Binding deadLetterBindingB(@Qualifier(\"deadLetterQueueB\") Queue queue,\n                                      @Qualifier(\"deadLetterExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEB_ROUTING_KEY);\n    }\n}\n```\n\n这里声明了两个Exchange，一个是业务Exchange，另一个是死信Exchange，业务Exchange下绑定了两个业务队列，业务队列都配置了同一个死信Exchange，并分别配置了路由key，在死信Exchange下绑定了两个死信队列，设置的路由key分别为业务队列里配置的路由key。\n\n下面是配置文件application.yml：\n\n```yml\nspring:\n  rabbitmq:\n    host: localhost\n    password: guest\n    username: guest\n    listener:\n      type: simple\n      simple:\n          default-requeue-rejected: false\n          acknowledge-mode: manual\n```\n\n这里记得将`default-requeue-rejected`属性设置为false。\n\n接下来，是业务队列的消费代码：\n\n```java\n@Slf4j\n@Component\npublic class BusinessMessageReceiver {\n\n    @RabbitListener(queues = BUSINESS_QUEUEA_NAME)\n    public void receiveA(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(\"收到业务消息A：{}\", msg);\n        boolean ack = true;\n        Exception exception = null;\n        try {\n            if (msg.contains(\"deadletter\")){\n                throw new RuntimeException(\"dead letter exception\");\n            }\n        } catch (Exception e){\n            ack = false;\n            exception = e;\n        }\n        if (!ack){\n            log.error(\"消息消费发生异常，error msg:{}\", exception.getMessage(), exception);\n            channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, false);\n        } else {\n            channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n        }\n    }\n\n    @RabbitListener(queues = BUSINESS_QUEUEB_NAME)\n    public void receiveB(Message message, Channel channel) throws IOException {\n        System.out.println(\"收到业务消息B：\" + new String(message.getBody()));\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n}\n```\n\n然后配置死信队列的消费者：\n\n```java\n@Component\npublic class DeadLetterMessageReceiver {\n\n\n    @RabbitListener(queues = DEAD_LETTER_QUEUEA_NAME)\n    public void receiveA(Message message, Channel channel) throws IOException {\n        System.out.println(\"收到死信消息A：\" + new String(message.getBody()));\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n\n    @RabbitListener(queues = DEAD_LETTER_QUEUEB_NAME)\n    public void receiveB(Message message, Channel channel) throws IOException {\n        System.out.println(\"收到死信消息B：\" + new String(message.getBody()));\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n}\n```\n\n最后，为了方便测试，写一个简单的消息生产者，并通过controller层来生产消息。\n\n```java\n@Component\npublic class BusinessMessageSender {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void sendMsg(String msg){\n        rabbitTemplate.convertSendAndReceive(BUSINESS_EXCHANGE_NAME, \"\", msg);\n    }\n}\n```\n\n```java\n@RequestMapping(\"rabbitmq\")\n@RestController\npublic class RabbitMQMsgController {\n\n    @Autowired\n    private BusinessMessageSender sender;\n\n    @RequestMapping(\"sendmsg\")\n    public void sendMsg(String msg){\n        sender.sendMsg(msg);\n    }\n}\n```\n\n一切准备就绪，启动！\n\n可以从RabbitMQ的管理后台中看到一共有四个队列，除默认的Exchange外还有声明的两个Exchange。\n\n![8(%(3A_Y`_N8XX8W5XHZMWY.png](https://i.loli.net/2019/07/14/5d2ae72753a8e90481.png)\n\n![123.png](https://i.loli.net/2019/07/14/5d2ae792598f781012.png)\n\n接下来，访问一下url，来测试一下：\n\n```\nhttp://localhost:8080/rabbitmq/sendmsg?msg=msg\n```\n\n日志：\n\n```java\n收到业务消息A：msg\n收到业务消息B：msg\n```\n\n表示两个Consumer都正常收到了消息。这代表正常消费的消息，ack后正常返回。然后我们再来测试nck的消息。\n\n```\nhttp://localhost:8080/rabbitmq/sendmsg?msg=deadletter\n```\n\n这将会触发业务队列A的NCK，按照预期，消息被NCK后，会抛到死信队列中，因此死信队列将会出现这个消息，日志如下：\n\n```\n收到业务消息A：deadletter\n消息消费发生异常，error msg:dead letter exception\njava.lang.RuntimeException: dead letter exception\n...\n\n收到死信消息A：deadletter\n```\n\n可以看到，死信队列的Consumer接受到了这个消息，所以流程到此为止就打通了。\n\n## 五、死信消息的变化\n\n那么“死信”被丢到死信队列中后，会发生什么变化呢？\n\n如果队列配置了参数 `x-dead-letter-routing-key` 的话，“死信”的路由key将会被替换成该参数对应的值。如果没有设置，则保留该消息原有的路由key。\n\n举个栗子：\n\n如果原有消息的路由key是`testA`，被发送到业务Exchage中，然后被投递到业务队列QueueA中，如果该队列没有配置参数`x-dead-letter-routing-key`，则该消息成为死信后，将保留原有的路由key`testA`，如果配置了该参数，并且值设置为`testB`，那么该消息成为死信后，路由key将会被替换为`testB`，然后被抛到死信交换机中。\n\n另外，由于被抛到了死信交换机，所以消息的Exchange Name也会被替换为死信交换机的名称。\n\n消息的Header中，也会添加很多奇奇怪怪的字段，修改一下上面的代码，在死信队列的消费者中添加一行日志输出：\n\n```java\nlog.info(\"死信消息properties：{}\", message.getMessageProperties());\n```\n\n然后重新运行一次，即可得到死信消息Header中被添加的信息：\n\n```\n死信消息properties：MessageProperties [headers={x-first-death-exchange=dead.letter.demo.simple.business.exchange, x-death=[{reason=rejected, count=1, exchange=dead.letter.demo.simple.business.exchange, time=Sun Jul 14 16:48:16 CST 2019, routing-keys=[], queue=dead.letter.demo.simple.business.queuea}], x-first-death-reason=rejected, x-first-death-queue=dead.letter.demo.simple.business.queuea}, correlationId=1, replyTo=amq.rabbitmq.reply-to.g2dkABZyYWJiaXRAREVTS1RPUC1DUlZGUzBOAAAPQAAAAAAB.bLbsdR1DnuRSwiKKmtdOGw==, contentType=text/plain, contentEncoding=UTF-8, contentLength=0, receivedDeliveryMode=PERSISTENT, priority=0, redelivered=false, receivedExchange=dead.letter.demo.simple.deadletter.exchange, receivedRoutingKey=dead.letter.demo.simple.deadletter.queuea.routingkey, deliveryTag=1, consumerTag=amq.ctag-NSp18SUPoCNvQcoYoS2lPg, consumerQueue=dead.letter.demo.simple.deadletter.queuea]\n```\n\nHeader中看起来有很多信息，实际上并不多，只是值比较长而已。下面就简单说明一下Header中的值：\n\n| 字段名 |含义  |\n| --- | --- |\n| x-first-death-exchange | 第一次被抛入的死信交换机的名称 |\n| x-first-death-reason | 第一次成为死信的原因，`rejected`：消息在重新进入队列时被队列拒绝，由于`default-requeue-rejected` 参数被设置为`false`。`expired`  ：消息过期。`maxlen` ： 队列内消息数量超过队列最大容量|\n| x-first-death-queue | 第一次成为死信前所在队列名称 |\n| x-death | 历次被投入死信交换机的信息列表，同一个消息每次进入一个死信交换机，这个数组的信息就会被更新|\n\n## 六、死信队列应用场景\n\n通过上面的信息，我们已经知道如何使用死信队列了，那么死信队列一般在什么场景下使用呢？\n\n一般用在较为重要的业务队列中，确保未被正确消费的消息不被丢弃，一般发生消费异常可能原因主要有由于消息信息本身存在错误导致处理异常，处理过程中参数校验异常，或者因网络波动导致的查询异常等等，当发生异常时，当然不能每次通过日志来获取原消息，然后让运维帮忙重新投递消息（没错，以前就是这么干的= =）。通过配置死信队列，可以让未正确处理的消息暂存到另一个队列中，待后续排查清楚问题后，编写相应的处理代码来处理死信消息，这样比手工恢复数据要好太多了。\n\n## 七、总结\n\n死信队列其实并没有什么神秘的地方，不过是绑定在死信交换机上的普通队列，而死信交换机也只是一个普通的交换机，不过是用来专门处理死信的交换机。\n\n总结一下死信消息的生命周期：\n\n1. 业务消息被投入业务队列\n2. 消费者消费业务队列的消息，由于处理过程中发生异常，于是进行了nck或者reject操作\n3. 被nck或reject的消息由RabbitMQ投递到死信交换机中\n4. 死信交换机将消息投入相应的死信队列\n5. 死信队列的消费者消费死信消息\n\n死信消息是RabbitMQ为我们做的一层保证，其实我们也可以不使用死信队列，而是在消息消费异常时，将消息主动投递到另一个交换机中，当你明白了这些之后，这些Exchange和Queue想怎样配合就能怎么配合。比如从死信队列拉取消息，然后发送邮件、短信、钉钉通知来通知开发人员关注。或者将消息重新投递到一个队列然后设置过期时间，来进行延时消费。\n\n如果本文对你有帮助，记得点个赞，也希望能分享给更多的朋友。也欢迎关注我的公众号进行留言交流。\n\n[//]: # (![TIM图片20190714173105.png]&#40;https://i.loli.net/2019/07/14/5d2af6692a8f432182.png&#41;)\n","source":"_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue.md","raw":"---\ntitle: 【RabbitMQ】一文带你搞定RabbitMQ死信队列\ntags:\n  - RabbitMQ\ncategories:\n  - 编程\ntoc: true\ntop: true\ncover: true\ndate: 2020-05-04 01:00:40\n---\n\n本文口味：爆炒鱿鱼   预计阅读：15分钟\n\n## 一、说明\n\nRabbitMQ是流行的开源消息队列系统，使用erlang语言开发，由于其社区活跃度高，维护更新较快，性能稳定，深得很多企业的欢心（当然，也包括我现在所在公司【手动滑稽】）。\n\n为了保证订单业务的消息数据不丢失，需要使用到RabbitMQ的死信队列机制，当消息消费发生异常时，将消息投入死信队列中。但由于对死信队列的概念及配置不熟悉，导致曾一度陷入百度的汪洋大海，无法自拔，很多文章都看起来可行，但是实际上却并不能帮我解决实际问题。最终，在官网文档中找到了我想要的答案，通过官网文档的学习，才发现对于死信队列存在一些误解，导致配置死信队列之路困难重重。\n\n于是本着记录和分享的精神，将死信队列的概念和配置完整的写下来，以便帮助遇到同样问题的朋友。\n\n## 二、本文大纲\n\n以下是本文大纲：\n\n![AG4T332}_NEUNPUAU(A_)U6.png](https://i.loli.net/2019/07/14/5d2af4176d1d483480.png)\n\n本文阅读前，需要对RabbitMQ有一个简单的了解，偏向实战配置讲解。\n\n## 三、死信队列是什么\n\n死信，在官网中对应的单词为“Dead Letter”，可以看出翻译确实非常的简单粗暴。那么死信是个什么东西呢？\n\n“死信”是RabbitMQ中的一种消息机制，当你在消费消息时，如果队列里的消息出现以下情况：\n\n1. 消息被否定确认，使用 `channel.basicNack`  或 `channel.basicReject` ，并且此时`requeue` 属性被设置为`false`。\n2. 消息在队列的存活时间超过设置的TTL时间。\n3. 消息队列的消息数量已经超过最大队列长度。\n\n那么该消息将成为“死信”。\n\n“死信”消息会被RabbitMQ进行特殊处理，如果配置了死信队列信息，那么该消息将会被丢进死信队列中，如果没有配置，则该消息将会被丢弃。\n\n## 四、如何配置死信队列\n\n这一部分将是本文的关键，如何配置死信队列呢？其实很简单，大概可以分为以下步骤：\n\n1. 配置业务队列，绑定到业务交换机上\n2. 为业务队列配置死信交换机和路由key\n3. 为死信交换机配置死信队列\n\n注意，并不是直接声明一个公共的死信队列，然后所以死信消息就自己跑到死信队列里去了。而是为每个需要使用死信的业务队列配置一个死信交换机，这里同一个项目的死信交换机可以共用一个，然后为每个业务队列分配一个单独的路由key。\n\n有了死信交换机和路由key后，接下来，就像配置业务队列一样，配置死信队列，然后绑定在死信交换机上。也就是说，死信队列并不是什么特殊的队列，只不过是绑定在死信交换机上的队列。死信交换机也不是什么特殊的交换机，只不过是用来接受死信的交换机，所以可以为任何类型【Direct、Fanout、Topic】。一般来说，会为每个业务队列分配一个独有的路由key，并对应的配置一个死信队列进行监听，也就是说，一般会为每个重要的业务队列配置一个死信队列。\n\n有了前文这些陈述后，接下来就是惊险刺激的实战环节，这里省略了RabbitMQ环境的部署和搭建环节。\n\n先创建一个Springboot项目。然后在pom文件中添加 `spring-boot-starter-amqp` 和 `spring-boot-starter-web` 的依赖，接下来创建一个Config类，这里是关键：\n\n```java\n@Configuration\npublic class RabbitMQConfig {\n\n    public static final String BUSINESS_EXCHANGE_NAME = \"dead.letter.demo.simple.business.exchange\";\n    public static final String BUSINESS_QUEUEA_NAME = \"dead.letter.demo.simple.business.queuea\";\n    public static final String BUSINESS_QUEUEB_NAME = \"dead.letter.demo.simple.business.queueb\";\n    public static final String DEAD_LETTER_EXCHANGE = \"dead.letter.demo.simple.deadletter.exchange\";\n    public static final String DEAD_LETTER_QUEUEA_ROUTING_KEY = \"dead.letter.demo.simple.deadletter.queuea.routingkey\";\n    public static final String DEAD_LETTER_QUEUEB_ROUTING_KEY = \"dead.letter.demo.simple.deadletter.queueb.routingkey\";\n    public static final String DEAD_LETTER_QUEUEA_NAME = \"dead.letter.demo.simple.deadletter.queuea\";\n    public static final String DEAD_LETTER_QUEUEB_NAME = \"dead.letter.demo.simple.deadletter.queueb\";\n\n    // 声明业务Exchange\n    @Bean(\"businessExchange\")\n    public FanoutExchange businessExchange(){\n        return new FanoutExchange(BUSINESS_EXCHANGE_NAME);\n    }\n\n    // 声明死信Exchange\n    @Bean(\"deadLetterExchange\")\n    public DirectExchange deadLetterExchange(){\n        return new DirectExchange(DEAD_LETTER_EXCHANGE);\n    }\n\n    // 声明业务队列A\n    @Bean(\"businessQueueA\")\n    public Queue businessQueueA(){\n        Map<String, Object> args = new HashMap<>(2);\n//       x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(\"x-dead-letter-exchange\", DEAD_LETTER_EXCHANGE);\n//       x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(\"x-dead-letter-routing-key\", DEAD_LETTER_QUEUEA_ROUTING_KEY);\n        return QueueBuilder.durable(BUSINESS_QUEUEA_NAME).withArguments(args).build();\n    }\n\n    // 声明业务队列B\n    @Bean(\"businessQueueB\")\n    public Queue businessQueueB(){\n        Map<String, Object> args = new HashMap<>(2);\n//       x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(\"x-dead-letter-exchange\", DEAD_LETTER_EXCHANGE);\n//       x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(\"x-dead-letter-routing-key\", DEAD_LETTER_QUEUEB_ROUTING_KEY);\n        return QueueBuilder.durable(BUSINESS_QUEUEB_NAME).withArguments(args).build();\n    }\n\n    // 声明死信队列A\n    @Bean(\"deadLetterQueueA\")\n    public Queue deadLetterQueueA(){\n        return new Queue(DEAD_LETTER_QUEUEA_NAME);\n    }\n\n    // 声明死信队列B\n    @Bean(\"deadLetterQueueB\")\n    public Queue deadLetterQueueB(){\n        return new Queue(DEAD_LETTER_QUEUEB_NAME);\n    }\n\n    // 声明业务队列A绑定关系\n    @Bean\n    public Binding businessBindingA(@Qualifier(\"businessQueueA\") Queue queue,\n                                    @Qualifier(\"businessExchange\") FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n    // 声明业务队列B绑定关系\n    @Bean\n    public Binding businessBindingB(@Qualifier(\"businessQueueB\") Queue queue,\n                                    @Qualifier(\"businessExchange\") FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n    // 声明死信队列A绑定关系\n    @Bean\n    public Binding deadLetterBindingA(@Qualifier(\"deadLetterQueueA\") Queue queue,\n                                    @Qualifier(\"deadLetterExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEA_ROUTING_KEY);\n    }\n\n    // 声明死信队列B绑定关系\n    @Bean\n    public Binding deadLetterBindingB(@Qualifier(\"deadLetterQueueB\") Queue queue,\n                                      @Qualifier(\"deadLetterExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEB_ROUTING_KEY);\n    }\n}\n```\n\n这里声明了两个Exchange，一个是业务Exchange，另一个是死信Exchange，业务Exchange下绑定了两个业务队列，业务队列都配置了同一个死信Exchange，并分别配置了路由key，在死信Exchange下绑定了两个死信队列，设置的路由key分别为业务队列里配置的路由key。\n\n下面是配置文件application.yml：\n\n```yml\nspring:\n  rabbitmq:\n    host: localhost\n    password: guest\n    username: guest\n    listener:\n      type: simple\n      simple:\n          default-requeue-rejected: false\n          acknowledge-mode: manual\n```\n\n这里记得将`default-requeue-rejected`属性设置为false。\n\n接下来，是业务队列的消费代码：\n\n```java\n@Slf4j\n@Component\npublic class BusinessMessageReceiver {\n\n    @RabbitListener(queues = BUSINESS_QUEUEA_NAME)\n    public void receiveA(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(\"收到业务消息A：{}\", msg);\n        boolean ack = true;\n        Exception exception = null;\n        try {\n            if (msg.contains(\"deadletter\")){\n                throw new RuntimeException(\"dead letter exception\");\n            }\n        } catch (Exception e){\n            ack = false;\n            exception = e;\n        }\n        if (!ack){\n            log.error(\"消息消费发生异常，error msg:{}\", exception.getMessage(), exception);\n            channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, false);\n        } else {\n            channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n        }\n    }\n\n    @RabbitListener(queues = BUSINESS_QUEUEB_NAME)\n    public void receiveB(Message message, Channel channel) throws IOException {\n        System.out.println(\"收到业务消息B：\" + new String(message.getBody()));\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n}\n```\n\n然后配置死信队列的消费者：\n\n```java\n@Component\npublic class DeadLetterMessageReceiver {\n\n\n    @RabbitListener(queues = DEAD_LETTER_QUEUEA_NAME)\n    public void receiveA(Message message, Channel channel) throws IOException {\n        System.out.println(\"收到死信消息A：\" + new String(message.getBody()));\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n\n    @RabbitListener(queues = DEAD_LETTER_QUEUEB_NAME)\n    public void receiveB(Message message, Channel channel) throws IOException {\n        System.out.println(\"收到死信消息B：\" + new String(message.getBody()));\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n}\n```\n\n最后，为了方便测试，写一个简单的消息生产者，并通过controller层来生产消息。\n\n```java\n@Component\npublic class BusinessMessageSender {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void sendMsg(String msg){\n        rabbitTemplate.convertSendAndReceive(BUSINESS_EXCHANGE_NAME, \"\", msg);\n    }\n}\n```\n\n```java\n@RequestMapping(\"rabbitmq\")\n@RestController\npublic class RabbitMQMsgController {\n\n    @Autowired\n    private BusinessMessageSender sender;\n\n    @RequestMapping(\"sendmsg\")\n    public void sendMsg(String msg){\n        sender.sendMsg(msg);\n    }\n}\n```\n\n一切准备就绪，启动！\n\n可以从RabbitMQ的管理后台中看到一共有四个队列，除默认的Exchange外还有声明的两个Exchange。\n\n![8(%(3A_Y`_N8XX8W5XHZMWY.png](https://i.loli.net/2019/07/14/5d2ae72753a8e90481.png)\n\n![123.png](https://i.loli.net/2019/07/14/5d2ae792598f781012.png)\n\n接下来，访问一下url，来测试一下：\n\n```\nhttp://localhost:8080/rabbitmq/sendmsg?msg=msg\n```\n\n日志：\n\n```java\n收到业务消息A：msg\n收到业务消息B：msg\n```\n\n表示两个Consumer都正常收到了消息。这代表正常消费的消息，ack后正常返回。然后我们再来测试nck的消息。\n\n```\nhttp://localhost:8080/rabbitmq/sendmsg?msg=deadletter\n```\n\n这将会触发业务队列A的NCK，按照预期，消息被NCK后，会抛到死信队列中，因此死信队列将会出现这个消息，日志如下：\n\n```\n收到业务消息A：deadletter\n消息消费发生异常，error msg:dead letter exception\njava.lang.RuntimeException: dead letter exception\n...\n\n收到死信消息A：deadletter\n```\n\n可以看到，死信队列的Consumer接受到了这个消息，所以流程到此为止就打通了。\n\n## 五、死信消息的变化\n\n那么“死信”被丢到死信队列中后，会发生什么变化呢？\n\n如果队列配置了参数 `x-dead-letter-routing-key` 的话，“死信”的路由key将会被替换成该参数对应的值。如果没有设置，则保留该消息原有的路由key。\n\n举个栗子：\n\n如果原有消息的路由key是`testA`，被发送到业务Exchage中，然后被投递到业务队列QueueA中，如果该队列没有配置参数`x-dead-letter-routing-key`，则该消息成为死信后，将保留原有的路由key`testA`，如果配置了该参数，并且值设置为`testB`，那么该消息成为死信后，路由key将会被替换为`testB`，然后被抛到死信交换机中。\n\n另外，由于被抛到了死信交换机，所以消息的Exchange Name也会被替换为死信交换机的名称。\n\n消息的Header中，也会添加很多奇奇怪怪的字段，修改一下上面的代码，在死信队列的消费者中添加一行日志输出：\n\n```java\nlog.info(\"死信消息properties：{}\", message.getMessageProperties());\n```\n\n然后重新运行一次，即可得到死信消息Header中被添加的信息：\n\n```\n死信消息properties：MessageProperties [headers={x-first-death-exchange=dead.letter.demo.simple.business.exchange, x-death=[{reason=rejected, count=1, exchange=dead.letter.demo.simple.business.exchange, time=Sun Jul 14 16:48:16 CST 2019, routing-keys=[], queue=dead.letter.demo.simple.business.queuea}], x-first-death-reason=rejected, x-first-death-queue=dead.letter.demo.simple.business.queuea}, correlationId=1, replyTo=amq.rabbitmq.reply-to.g2dkABZyYWJiaXRAREVTS1RPUC1DUlZGUzBOAAAPQAAAAAAB.bLbsdR1DnuRSwiKKmtdOGw==, contentType=text/plain, contentEncoding=UTF-8, contentLength=0, receivedDeliveryMode=PERSISTENT, priority=0, redelivered=false, receivedExchange=dead.letter.demo.simple.deadletter.exchange, receivedRoutingKey=dead.letter.demo.simple.deadletter.queuea.routingkey, deliveryTag=1, consumerTag=amq.ctag-NSp18SUPoCNvQcoYoS2lPg, consumerQueue=dead.letter.demo.simple.deadletter.queuea]\n```\n\nHeader中看起来有很多信息，实际上并不多，只是值比较长而已。下面就简单说明一下Header中的值：\n\n| 字段名 |含义  |\n| --- | --- |\n| x-first-death-exchange | 第一次被抛入的死信交换机的名称 |\n| x-first-death-reason | 第一次成为死信的原因，`rejected`：消息在重新进入队列时被队列拒绝，由于`default-requeue-rejected` 参数被设置为`false`。`expired`  ：消息过期。`maxlen` ： 队列内消息数量超过队列最大容量|\n| x-first-death-queue | 第一次成为死信前所在队列名称 |\n| x-death | 历次被投入死信交换机的信息列表，同一个消息每次进入一个死信交换机，这个数组的信息就会被更新|\n\n## 六、死信队列应用场景\n\n通过上面的信息，我们已经知道如何使用死信队列了，那么死信队列一般在什么场景下使用呢？\n\n一般用在较为重要的业务队列中，确保未被正确消费的消息不被丢弃，一般发生消费异常可能原因主要有由于消息信息本身存在错误导致处理异常，处理过程中参数校验异常，或者因网络波动导致的查询异常等等，当发生异常时，当然不能每次通过日志来获取原消息，然后让运维帮忙重新投递消息（没错，以前就是这么干的= =）。通过配置死信队列，可以让未正确处理的消息暂存到另一个队列中，待后续排查清楚问题后，编写相应的处理代码来处理死信消息，这样比手工恢复数据要好太多了。\n\n## 七、总结\n\n死信队列其实并没有什么神秘的地方，不过是绑定在死信交换机上的普通队列，而死信交换机也只是一个普通的交换机，不过是用来专门处理死信的交换机。\n\n总结一下死信消息的生命周期：\n\n1. 业务消息被投入业务队列\n2. 消费者消费业务队列的消息，由于处理过程中发生异常，于是进行了nck或者reject操作\n3. 被nck或reject的消息由RabbitMQ投递到死信交换机中\n4. 死信交换机将消息投入相应的死信队列\n5. 死信队列的消费者消费死信消息\n\n死信消息是RabbitMQ为我们做的一层保证，其实我们也可以不使用死信队列，而是在消息消费异常时，将消息主动投递到另一个交换机中，当你明白了这些之后，这些Exchange和Queue想怎样配合就能怎么配合。比如从死信队列拉取消息，然后发送邮件、短信、钉钉通知来通知开发人员关注。或者将消息重新投递到一个队列然后设置过期时间，来进行延时消费。\n\n如果本文对你有帮助，记得点个赞，也希望能分享给更多的朋友。也欢迎关注我的公众号进行留言交流。\n\n[//]: # (![TIM图片20190714173105.png]&#40;https://i.loli.net/2019/07/14/5d2af6692a8f432182.png&#41;)\n","slug":"rabbitmq/rabbitmq-how-to-use-dead-letter-queue","published":1,"updated":"2020-05-03T17:00:40.000Z","_id":"cl70rsfbm00195ohu6z1m6rv7","comments":1,"layout":"post","photos":[],"link":"","content":"<p>本文口味：爆炒鱿鱼   预计阅读：15分钟</p>\n<h2 id=\"一、说明\"><a href=\"#一、说明\" class=\"headerlink\" title=\"一、说明\"></a>一、说明</h2><p>RabbitMQ是流行的开源消息队列系统，使用erlang语言开发，由于其社区活跃度高，维护更新较快，性能稳定，深得很多企业的欢心（当然，也包括我现在所在公司【手动滑稽】）。</p>\n<p>为了保证订单业务的消息数据不丢失，需要使用到RabbitMQ的死信队列机制，当消息消费发生异常时，将消息投入死信队列中。但由于对死信队列的概念及配置不熟悉，导致曾一度陷入百度的汪洋大海，无法自拔，很多文章都看起来可行，但是实际上却并不能帮我解决实际问题。最终，在官网文档中找到了我想要的答案，通过官网文档的学习，才发现对于死信队列存在一些误解，导致配置死信队列之路困难重重。</p>\n<p>于是本着记录和分享的精神，将死信队列的概念和配置完整的写下来，以便帮助遇到同样问题的朋友。</p>\n<h2 id=\"二、本文大纲\"><a href=\"#二、本文大纲\" class=\"headerlink\" title=\"二、本文大纲\"></a>二、本文大纲</h2><p>以下是本文大纲：</p>\n<p><img src=\"https://i.loli.net/2019/07/14/5d2af4176d1d483480.png\" alt=\"AG4T332}_NEUNPUAU(A_)U6.png\"></p>\n<p>本文阅读前，需要对RabbitMQ有一个简单的了解，偏向实战配置讲解。</p>\n<h2 id=\"三、死信队列是什么\"><a href=\"#三、死信队列是什么\" class=\"headerlink\" title=\"三、死信队列是什么\"></a>三、死信队列是什么</h2><p>死信，在官网中对应的单词为“Dead Letter”，可以看出翻译确实非常的简单粗暴。那么死信是个什么东西呢？</p>\n<p>“死信”是RabbitMQ中的一种消息机制，当你在消费消息时，如果队列里的消息出现以下情况：</p>\n<ol>\n<li>消息被否定确认，使用 <code>channel.basicNack</code>  或 <code>channel.basicReject</code> ，并且此时<code>requeue</code> 属性被设置为<code>false</code>。</li>\n<li>消息在队列的存活时间超过设置的TTL时间。</li>\n<li>消息队列的消息数量已经超过最大队列长度。</li>\n</ol>\n<p>那么该消息将成为“死信”。</p>\n<p>“死信”消息会被RabbitMQ进行特殊处理，如果配置了死信队列信息，那么该消息将会被丢进死信队列中，如果没有配置，则该消息将会被丢弃。</p>\n<h2 id=\"四、如何配置死信队列\"><a href=\"#四、如何配置死信队列\" class=\"headerlink\" title=\"四、如何配置死信队列\"></a>四、如何配置死信队列</h2><p>这一部分将是本文的关键，如何配置死信队列呢？其实很简单，大概可以分为以下步骤：</p>\n<ol>\n<li>配置业务队列，绑定到业务交换机上</li>\n<li>为业务队列配置死信交换机和路由key</li>\n<li>为死信交换机配置死信队列</li>\n</ol>\n<p>注意，并不是直接声明一个公共的死信队列，然后所以死信消息就自己跑到死信队列里去了。而是为每个需要使用死信的业务队列配置一个死信交换机，这里同一个项目的死信交换机可以共用一个，然后为每个业务队列分配一个单独的路由key。</p>\n<p>有了死信交换机和路由key后，接下来，就像配置业务队列一样，配置死信队列，然后绑定在死信交换机上。也就是说，死信队列并不是什么特殊的队列，只不过是绑定在死信交换机上的队列。死信交换机也不是什么特殊的交换机，只不过是用来接受死信的交换机，所以可以为任何类型【Direct、Fanout、Topic】。一般来说，会为每个业务队列分配一个独有的路由key，并对应的配置一个死信队列进行监听，也就是说，一般会为每个重要的业务队列配置一个死信队列。</p>\n<p>有了前文这些陈述后，接下来就是惊险刺激的实战环节，这里省略了RabbitMQ环境的部署和搭建环节。</p>\n<p>先创建一个Springboot项目。然后在pom文件中添加 <code>spring-boot-starter-amqp</code> 和 <code>spring-boot-starter-web</code> 的依赖，接下来创建一个Config类，这里是关键：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RabbitMQConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String BUSINESS_EXCHANGE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"dead.letter.demo.simple.business.exchange\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String BUSINESS_QUEUEA_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"dead.letter.demo.simple.business.queuea\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String BUSINESS_QUEUEB_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"dead.letter.demo.simple.business.queueb\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_EXCHANGE <span class=\"token operator\">=</span> <span class=\"token string\">\"dead.letter.demo.simple.deadletter.exchange\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_QUEUEA_ROUTING_KEY <span class=\"token operator\">=</span> <span class=\"token string\">\"dead.letter.demo.simple.deadletter.queuea.routingkey\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_QUEUEB_ROUTING_KEY <span class=\"token operator\">=</span> <span class=\"token string\">\"dead.letter.demo.simple.deadletter.queueb.routingkey\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_QUEUEA_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"dead.letter.demo.simple.deadletter.queuea\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_QUEUEB_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"dead.letter.demo.simple.deadletter.queueb\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明业务Exchange</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessExchange\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> FanoutExchange <span class=\"token function\">businessExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FanoutExchange</span><span class=\"token punctuation\">(</span>BUSINESS_EXCHANGE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信Exchange</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterExchange\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> DirectExchange <span class=\"token function\">deadLetterExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span>DEAD_LETTER_EXCHANGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明业务队列A</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessQueueA\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">businessQueueA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        Map<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Object<span class=\"token operator\">></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//       x-dead-letter-exchange    这里声明当前队列绑定的死信交换机</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-exchange\"</span><span class=\"token punctuation\">,</span> DEAD_LETTER_EXCHANGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//       x-dead-letter-routing-key  这里声明当前队列的死信路由key</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-routing-key\"</span><span class=\"token punctuation\">,</span> DEAD_LETTER_QUEUEA_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> QueueBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span>BUSINESS_QUEUEA_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withArguments</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明业务队列B</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessQueueB\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">businessQueueB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        Map<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Object<span class=\"token operator\">></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//       x-dead-letter-exchange    这里声明当前队列绑定的死信交换机</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-exchange\"</span><span class=\"token punctuation\">,</span> DEAD_LETTER_EXCHANGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//       x-dead-letter-routing-key  这里声明当前队列的死信路由key</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-routing-key\"</span><span class=\"token punctuation\">,</span> DEAD_LETTER_QUEUEB_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> QueueBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span>BUSINESS_QUEUEB_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withArguments</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信队列A</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterQueueA\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">deadLetterQueueA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span>DEAD_LETTER_QUEUEA_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信队列B</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterQueueB\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">deadLetterQueueB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span>DEAD_LETTER_QUEUEB_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明业务队列A绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">businessBindingA</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessQueueA\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                    <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessExchange\"</span><span class=\"token punctuation\">)</span> FanoutExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明业务队列B绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">businessBindingB</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessQueueB\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                    <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"businessExchange\"</span><span class=\"token punctuation\">)</span> FanoutExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信队列A绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">deadLetterBindingA</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterQueueA\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                    <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterExchange\"</span><span class=\"token punctuation\">)</span> DirectExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span>DEAD_LETTER_QUEUEA_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信队列B绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">deadLetterBindingB</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterQueueB\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                      <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterExchange\"</span><span class=\"token punctuation\">)</span> DirectExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span>DEAD_LETTER_QUEUEB_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这里声明了两个Exchange，一个是业务Exchange，另一个是死信Exchange，业务Exchange下绑定了两个业务队列，业务队列都配置了同一个死信Exchange，并分别配置了路由key，在死信Exchange下绑定了两个死信队列，设置的路由key分别为业务队列里配置的路由key。</p>\n<p>下面是配置文件application.yml：</p>\n<pre class=\" language-yml\"><code class=\"language-yml\">spring:\n  rabbitmq:\n    host: localhost\n    password: guest\n    username: guest\n    listener:\n      type: simple\n      simple:\n          default-requeue-rejected: false\n          acknowledge-mode: manual</code></pre>\n<p>这里记得将<code>default-requeue-rejected</code>属性设置为false。</p>\n<p>接下来，是业务队列的消费代码：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BusinessMessageReceiver</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> BUSINESS_QUEUEA_NAME<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveA</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> Channel channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException <span class=\"token punctuation\">{</span>\n        String msg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"收到业务消息A：{}\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">boolean</span> ack <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        Exception exception <span class=\"token operator\">=</span> null<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadletter\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dead letter exception\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            ack <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n            exception <span class=\"token operator\">=</span> e<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>ack<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"消息消费发生异常，error msg:{}\"</span><span class=\"token punctuation\">,</span> exception<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> exception<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicNack</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> BUSINESS_QUEUEB_NAME<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveB</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> Channel channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException <span class=\"token punctuation\">{</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"收到业务消息B：\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>然后配置死信队列的消费者：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeadLetterMessageReceiver</span> <span class=\"token punctuation\">{</span>\n\n\n    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> DEAD_LETTER_QUEUEA_NAME<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveA</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> Channel channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException <span class=\"token punctuation\">{</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"收到死信消息A：\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> DEAD_LETTER_QUEUEB_NAME<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveB</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> Channel channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException <span class=\"token punctuation\">{</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"收到死信消息B：\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>最后，为了方便测试，写一个简单的消息生产者，并通过controller层来生产消息。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BusinessMessageSender</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> RabbitTemplate rabbitTemplate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsg</span><span class=\"token punctuation\">(</span>String msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertSendAndReceive</span><span class=\"token punctuation\">(</span>BUSINESS_EXCHANGE_NAME<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rabbitmq\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RabbitMQMsgController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> BusinessMessageSender sender<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sendmsg\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsg</span><span class=\"token punctuation\">(</span>String msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        sender<span class=\"token punctuation\">.</span><span class=\"token function\">sendMsg</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>一切准备就绪，启动！</p>\n<p>可以从RabbitMQ的管理后台中看到一共有四个队列，除默认的Exchange外还有声明的两个Exchange。</p>\n<p>![8(%(3A_Y`_N8XX8W5XHZMWY.png](<a href=\"https://i.loli.net/2019/07/14/5d2ae72753a8e90481.png\" target=\"_blank\" rel=\"noopener\">https://i.loli.net/2019/07/14/5d2ae72753a8e90481.png</a>)</p>\n<p><img src=\"https://i.loli.net/2019/07/14/5d2ae792598f781012.png\" alt=\"123.png\"></p>\n<p>接下来，访问一下url，来测试一下：</p>\n<pre><code>http://localhost:8080/rabbitmq/sendmsg?msg=msg</code></pre><p>日志：</p>\n<pre class=\" language-java\"><code class=\"language-java\">收到业务消息A：msg\n收到业务消息B：msg</code></pre>\n<p>表示两个Consumer都正常收到了消息。这代表正常消费的消息，ack后正常返回。然后我们再来测试nck的消息。</p>\n<pre><code>http://localhost:8080/rabbitmq/sendmsg?msg=deadletter</code></pre><p>这将会触发业务队列A的NCK，按照预期，消息被NCK后，会抛到死信队列中，因此死信队列将会出现这个消息，日志如下：</p>\n<pre><code>收到业务消息A：deadletter\n消息消费发生异常，error msg:dead letter exception\njava.lang.RuntimeException: dead letter exception\n...\n\n收到死信消息A：deadletter</code></pre><p>可以看到，死信队列的Consumer接受到了这个消息，所以流程到此为止就打通了。</p>\n<h2 id=\"五、死信消息的变化\"><a href=\"#五、死信消息的变化\" class=\"headerlink\" title=\"五、死信消息的变化\"></a>五、死信消息的变化</h2><p>那么“死信”被丢到死信队列中后，会发生什么变化呢？</p>\n<p>如果队列配置了参数 <code>x-dead-letter-routing-key</code> 的话，“死信”的路由key将会被替换成该参数对应的值。如果没有设置，则保留该消息原有的路由key。</p>\n<p>举个栗子：</p>\n<p>如果原有消息的路由key是<code>testA</code>，被发送到业务Exchage中，然后被投递到业务队列QueueA中，如果该队列没有配置参数<code>x-dead-letter-routing-key</code>，则该消息成为死信后，将保留原有的路由key<code>testA</code>，如果配置了该参数，并且值设置为<code>testB</code>，那么该消息成为死信后，路由key将会被替换为<code>testB</code>，然后被抛到死信交换机中。</p>\n<p>另外，由于被抛到了死信交换机，所以消息的Exchange Name也会被替换为死信交换机的名称。</p>\n<p>消息的Header中，也会添加很多奇奇怪怪的字段，修改一下上面的代码，在死信队列的消费者中添加一行日志输出：</p>\n<pre class=\" language-java\"><code class=\"language-java\">log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"死信消息properties：{}\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>然后重新运行一次，即可得到死信消息Header中被添加的信息：</p>\n<pre><code>死信消息properties：MessageProperties [headers={x-first-death-exchange=dead.letter.demo.simple.business.exchange, x-death=[{reason=rejected, count=1, exchange=dead.letter.demo.simple.business.exchange, time=Sun Jul 14 16:48:16 CST 2019, routing-keys=[], queue=dead.letter.demo.simple.business.queuea}], x-first-death-reason=rejected, x-first-death-queue=dead.letter.demo.simple.business.queuea}, correlationId=1, replyTo=amq.rabbitmq.reply-to.g2dkABZyYWJiaXRAREVTS1RPUC1DUlZGUzBOAAAPQAAAAAAB.bLbsdR1DnuRSwiKKmtdOGw==, contentType=text/plain, contentEncoding=UTF-8, contentLength=0, receivedDeliveryMode=PERSISTENT, priority=0, redelivered=false, receivedExchange=dead.letter.demo.simple.deadletter.exchange, receivedRoutingKey=dead.letter.demo.simple.deadletter.queuea.routingkey, deliveryTag=1, consumerTag=amq.ctag-NSp18SUPoCNvQcoYoS2lPg, consumerQueue=dead.letter.demo.simple.deadletter.queuea]</code></pre><p>Header中看起来有很多信息，实际上并不多，只是值比较长而已。下面就简单说明一下Header中的值：</p>\n<table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>x-first-death-exchange</td>\n<td>第一次被抛入的死信交换机的名称</td>\n</tr>\n<tr>\n<td>x-first-death-reason</td>\n<td>第一次成为死信的原因，<code>rejected</code>：消息在重新进入队列时被队列拒绝，由于<code>default-requeue-rejected</code> 参数被设置为<code>false</code>。<code>expired</code>  ：消息过期。<code>maxlen</code> ： 队列内消息数量超过队列最大容量</td>\n</tr>\n<tr>\n<td>x-first-death-queue</td>\n<td>第一次成为死信前所在队列名称</td>\n</tr>\n<tr>\n<td>x-death</td>\n<td>历次被投入死信交换机的信息列表，同一个消息每次进入一个死信交换机，这个数组的信息就会被更新</td>\n</tr>\n</tbody></table>\n<h2 id=\"六、死信队列应用场景\"><a href=\"#六、死信队列应用场景\" class=\"headerlink\" title=\"六、死信队列应用场景\"></a>六、死信队列应用场景</h2><p>通过上面的信息，我们已经知道如何使用死信队列了，那么死信队列一般在什么场景下使用呢？</p>\n<p>一般用在较为重要的业务队列中，确保未被正确消费的消息不被丢弃，一般发生消费异常可能原因主要有由于消息信息本身存在错误导致处理异常，处理过程中参数校验异常，或者因网络波动导致的查询异常等等，当发生异常时，当然不能每次通过日志来获取原消息，然后让运维帮忙重新投递消息（没错，以前就是这么干的= =）。通过配置死信队列，可以让未正确处理的消息暂存到另一个队列中，待后续排查清楚问题后，编写相应的处理代码来处理死信消息，这样比手工恢复数据要好太多了。</p>\n<h2 id=\"七、总结\"><a href=\"#七、总结\" class=\"headerlink\" title=\"七、总结\"></a>七、总结</h2><p>死信队列其实并没有什么神秘的地方，不过是绑定在死信交换机上的普通队列，而死信交换机也只是一个普通的交换机，不过是用来专门处理死信的交换机。</p>\n<p>总结一下死信消息的生命周期：</p>\n<ol>\n<li>业务消息被投入业务队列</li>\n<li>消费者消费业务队列的消息，由于处理过程中发生异常，于是进行了nck或者reject操作</li>\n<li>被nck或reject的消息由RabbitMQ投递到死信交换机中</li>\n<li>死信交换机将消息投入相应的死信队列</li>\n<li>死信队列的消费者消费死信消息</li>\n</ol>\n<p>死信消息是RabbitMQ为我们做的一层保证，其实我们也可以不使用死信队列，而是在消息消费异常时，将消息主动投递到另一个交换机中，当你明白了这些之后，这些Exchange和Queue想怎样配合就能怎么配合。比如从死信队列拉取消息，然后发送邮件、短信、钉钉通知来通知开发人员关注。或者将消息重新投递到一个队列然后设置过期时间，来进行延时消费。</p>\n<p>如果本文对你有帮助，记得点个赞，也希望能分享给更多的朋友。也欢迎关注我的公众号进行留言交流。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<p>本文口味：爆炒鱿鱼   预计阅读：15分钟</p>\n<h2 id=\"一、说明\"><a href=\"#一、说明\" class=\"headerlink\" title=\"一、说明\"></a>一、说明</h2><p>RabbitMQ是流行的开源消息队列系统，使用erlang语言开发，由于其社区活跃度高，维护更新较快，性能稳定，深得很多企业的欢心（当然，也包括我现在所在公司【手动滑稽】）。</p>\n<p>为了保证订单业务的消息数据不丢失，需要使用到RabbitMQ的死信队列机制，当消息消费发生异常时，将消息投入死信队列中。但由于对死信队列的概念及配置不熟悉，导致曾一度陷入百度的汪洋大海，无法自拔，很多文章都看起来可行，但是实际上却并不能帮我解决实际问题。最终，在官网文档中找到了我想要的答案，通过官网文档的学习，才发现对于死信队列存在一些误解，导致配置死信队列之路困难重重。</p>\n<p>于是本着记录和分享的精神，将死信队列的概念和配置完整的写下来，以便帮助遇到同样问题的朋友。</p>\n<h2 id=\"二、本文大纲\"><a href=\"#二、本文大纲\" class=\"headerlink\" title=\"二、本文大纲\"></a>二、本文大纲</h2><p>以下是本文大纲：</p>\n<p><img src=\"https://i.loli.net/2019/07/14/5d2af4176d1d483480.png\" alt=\"AG4T332}_NEUNPUAU(A_)U6.png\"></p>\n<p>本文阅读前，需要对RabbitMQ有一个简单的了解，偏向实战配置讲解。</p>\n<h2 id=\"三、死信队列是什么\"><a href=\"#三、死信队列是什么\" class=\"headerlink\" title=\"三、死信队列是什么\"></a>三、死信队列是什么</h2><p>死信，在官网中对应的单词为“Dead Letter”，可以看出翻译确实非常的简单粗暴。那么死信是个什么东西呢？</p>\n<p>“死信”是RabbitMQ中的一种消息机制，当你在消费消息时，如果队列里的消息出现以下情况：</p>\n<ol>\n<li>消息被否定确认，使用 <code>channel.basicNack</code>  或 <code>channel.basicReject</code> ，并且此时<code>requeue</code> 属性被设置为<code>false</code>。</li>\n<li>消息在队列的存活时间超过设置的TTL时间。</li>\n<li>消息队列的消息数量已经超过最大队列长度。</li>\n</ol>\n<p>那么该消息将成为“死信”。</p>\n<p>“死信”消息会被RabbitMQ进行特殊处理，如果配置了死信队列信息，那么该消息将会被丢进死信队列中，如果没有配置，则该消息将会被丢弃。</p>\n<h2 id=\"四、如何配置死信队列\"><a href=\"#四、如何配置死信队列\" class=\"headerlink\" title=\"四、如何配置死信队列\"></a>四、如何配置死信队列</h2><p>这一部分将是本文的关键，如何配置死信队列呢？其实很简单，大概可以分为以下步骤：</p>\n<ol>\n<li>配置业务队列，绑定到业务交换机上</li>\n<li>为业务队列配置死信交换机和路由key</li>\n<li>为死信交换机配置死信队列</li>\n</ol>\n<p>注意，并不是直接声明一个公共的死信队列，然后所以死信消息就自己跑到死信队列里去了。而是为每个需要使用死信的业务队列配置一个死信交换机，这里同一个项目的死信交换机可以共用一个，然后为每个业务队列分配一个单独的路由key。</p>\n<p>有了死信交换机和路由key后，接下来，就像配置业务队列一样，配置死信队列，然后绑定在死信交换机上。也就是说，死信队列并不是什么特殊的队列，只不过是绑定在死信交换机上的队列。死信交换机也不是什么特殊的交换机，只不过是用来接受死信的交换机，所以可以为任何类型【Direct、Fanout、Topic】。一般来说，会为每个业务队列分配一个独有的路由key，并对应的配置一个死信队列进行监听，也就是说，一般会为每个重要的业务队列配置一个死信队列。</p>\n<p>有了前文这些陈述后，接下来就是惊险刺激的实战环节，这里省略了RabbitMQ环境的部署和搭建环节。</p>\n<p>先创建一个Springboot项目。然后在pom文件中添加 <code>spring-boot-starter-amqp</code> 和 <code>spring-boot-starter-web</code> 的依赖，接下来创建一个Config类，这里是关键：</p>\n<pre><code class=\"java\">@Configuration\npublic class RabbitMQConfig {\n\n    public static final String BUSINESS_EXCHANGE_NAME = &quot;dead.letter.demo.simple.business.exchange&quot;;\n    public static final String BUSINESS_QUEUEA_NAME = &quot;dead.letter.demo.simple.business.queuea&quot;;\n    public static final String BUSINESS_QUEUEB_NAME = &quot;dead.letter.demo.simple.business.queueb&quot;;\n    public static final String DEAD_LETTER_EXCHANGE = &quot;dead.letter.demo.simple.deadletter.exchange&quot;;\n    public static final String DEAD_LETTER_QUEUEA_ROUTING_KEY = &quot;dead.letter.demo.simple.deadletter.queuea.routingkey&quot;;\n    public static final String DEAD_LETTER_QUEUEB_ROUTING_KEY = &quot;dead.letter.demo.simple.deadletter.queueb.routingkey&quot;;\n    public static final String DEAD_LETTER_QUEUEA_NAME = &quot;dead.letter.demo.simple.deadletter.queuea&quot;;\n    public static final String DEAD_LETTER_QUEUEB_NAME = &quot;dead.letter.demo.simple.deadletter.queueb&quot;;\n\n    // 声明业务Exchange\n    @Bean(&quot;businessExchange&quot;)\n    public FanoutExchange businessExchange(){\n        return new FanoutExchange(BUSINESS_EXCHANGE_NAME);\n    }\n\n    // 声明死信Exchange\n    @Bean(&quot;deadLetterExchange&quot;)\n    public DirectExchange deadLetterExchange(){\n        return new DirectExchange(DEAD_LETTER_EXCHANGE);\n    }\n\n    // 声明业务队列A\n    @Bean(&quot;businessQueueA&quot;)\n    public Queue businessQueueA(){\n        Map&lt;String, Object&gt; args = new HashMap&lt;&gt;(2);\n//       x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(&quot;x-dead-letter-exchange&quot;, DEAD_LETTER_EXCHANGE);\n//       x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(&quot;x-dead-letter-routing-key&quot;, DEAD_LETTER_QUEUEA_ROUTING_KEY);\n        return QueueBuilder.durable(BUSINESS_QUEUEA_NAME).withArguments(args).build();\n    }\n\n    // 声明业务队列B\n    @Bean(&quot;businessQueueB&quot;)\n    public Queue businessQueueB(){\n        Map&lt;String, Object&gt; args = new HashMap&lt;&gt;(2);\n//       x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(&quot;x-dead-letter-exchange&quot;, DEAD_LETTER_EXCHANGE);\n//       x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(&quot;x-dead-letter-routing-key&quot;, DEAD_LETTER_QUEUEB_ROUTING_KEY);\n        return QueueBuilder.durable(BUSINESS_QUEUEB_NAME).withArguments(args).build();\n    }\n\n    // 声明死信队列A\n    @Bean(&quot;deadLetterQueueA&quot;)\n    public Queue deadLetterQueueA(){\n        return new Queue(DEAD_LETTER_QUEUEA_NAME);\n    }\n\n    // 声明死信队列B\n    @Bean(&quot;deadLetterQueueB&quot;)\n    public Queue deadLetterQueueB(){\n        return new Queue(DEAD_LETTER_QUEUEB_NAME);\n    }\n\n    // 声明业务队列A绑定关系\n    @Bean\n    public Binding businessBindingA(@Qualifier(&quot;businessQueueA&quot;) Queue queue,\n                                    @Qualifier(&quot;businessExchange&quot;) FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n    // 声明业务队列B绑定关系\n    @Bean\n    public Binding businessBindingB(@Qualifier(&quot;businessQueueB&quot;) Queue queue,\n                                    @Qualifier(&quot;businessExchange&quot;) FanoutExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange);\n    }\n\n    // 声明死信队列A绑定关系\n    @Bean\n    public Binding deadLetterBindingA(@Qualifier(&quot;deadLetterQueueA&quot;) Queue queue,\n                                    @Qualifier(&quot;deadLetterExchange&quot;) DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEA_ROUTING_KEY);\n    }\n\n    // 声明死信队列B绑定关系\n    @Bean\n    public Binding deadLetterBindingB(@Qualifier(&quot;deadLetterQueueB&quot;) Queue queue,\n                                      @Qualifier(&quot;deadLetterExchange&quot;) DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEB_ROUTING_KEY);\n    }\n}</code></pre>\n<p>这里声明了两个Exchange，一个是业务Exchange，另一个是死信Exchange，业务Exchange下绑定了两个业务队列，业务队列都配置了同一个死信Exchange，并分别配置了路由key，在死信Exchange下绑定了两个死信队列，设置的路由key分别为业务队列里配置的路由key。</p>\n<p>下面是配置文件application.yml：</p>\n<pre><code class=\"yml\">spring:\n  rabbitmq:\n    host: localhost\n    password: guest\n    username: guest\n    listener:\n      type: simple\n      simple:\n          default-requeue-rejected: false\n          acknowledge-mode: manual</code></pre>\n<p>这里记得将<code>default-requeue-rejected</code>属性设置为false。</p>\n<p>接下来，是业务队列的消费代码：</p>\n<pre><code class=\"java\">@Slf4j\n@Component\npublic class BusinessMessageReceiver {\n\n    @RabbitListener(queues = BUSINESS_QUEUEA_NAME)\n    public void receiveA(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(&quot;收到业务消息A：{}&quot;, msg);\n        boolean ack = true;\n        Exception exception = null;\n        try {\n            if (msg.contains(&quot;deadletter&quot;)){\n                throw new RuntimeException(&quot;dead letter exception&quot;);\n            }\n        } catch (Exception e){\n            ack = false;\n            exception = e;\n        }\n        if (!ack){\n            log.error(&quot;消息消费发生异常，error msg:{}&quot;, exception.getMessage(), exception);\n            channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, false);\n        } else {\n            channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n        }\n    }\n\n    @RabbitListener(queues = BUSINESS_QUEUEB_NAME)\n    public void receiveB(Message message, Channel channel) throws IOException {\n        System.out.println(&quot;收到业务消息B：&quot; + new String(message.getBody()));\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n}</code></pre>\n<p>然后配置死信队列的消费者：</p>\n<pre><code class=\"java\">@Component\npublic class DeadLetterMessageReceiver {\n\n\n    @RabbitListener(queues = DEAD_LETTER_QUEUEA_NAME)\n    public void receiveA(Message message, Channel channel) throws IOException {\n        System.out.println(&quot;收到死信消息A：&quot; + new String(message.getBody()));\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n\n    @RabbitListener(queues = DEAD_LETTER_QUEUEB_NAME)\n    public void receiveB(Message message, Channel channel) throws IOException {\n        System.out.println(&quot;收到死信消息B：&quot; + new String(message.getBody()));\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n}</code></pre>\n<p>最后，为了方便测试，写一个简单的消息生产者，并通过controller层来生产消息。</p>\n<pre><code class=\"java\">@Component\npublic class BusinessMessageSender {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void sendMsg(String msg){\n        rabbitTemplate.convertSendAndReceive(BUSINESS_EXCHANGE_NAME, &quot;&quot;, msg);\n    }\n}</code></pre>\n<pre><code class=\"java\">@RequestMapping(&quot;rabbitmq&quot;)\n@RestController\npublic class RabbitMQMsgController {\n\n    @Autowired\n    private BusinessMessageSender sender;\n\n    @RequestMapping(&quot;sendmsg&quot;)\n    public void sendMsg(String msg){\n        sender.sendMsg(msg);\n    }\n}</code></pre>\n<p>一切准备就绪，启动！</p>\n<p>可以从RabbitMQ的管理后台中看到一共有四个队列，除默认的Exchange外还有声明的两个Exchange。</p>\n<p>![8(%(3A_Y`_N8XX8W5XHZMWY.png](<a href=\"https://i.loli.net/2019/07/14/5d2ae72753a8e90481.png\" target=\"_blank\" rel=\"noopener\">https://i.loli.net/2019/07/14/5d2ae72753a8e90481.png</a>)</p>\n<p><img src=\"https://i.loli.net/2019/07/14/5d2ae792598f781012.png\" alt=\"123.png\"></p>\n<p>接下来，访问一下url，来测试一下：</p>\n<pre><code>http://localhost:8080/rabbitmq/sendmsg?msg=msg</code></pre><p>日志：</p>\n<pre><code class=\"java\">收到业务消息A：msg\n收到业务消息B：msg</code></pre>\n<p>表示两个Consumer都正常收到了消息。这代表正常消费的消息，ack后正常返回。然后我们再来测试nck的消息。</p>\n<pre><code>http://localhost:8080/rabbitmq/sendmsg?msg=deadletter</code></pre><p>这将会触发业务队列A的NCK，按照预期，消息被NCK后，会抛到死信队列中，因此死信队列将会出现这个消息，日志如下：</p>\n<pre><code>收到业务消息A：deadletter\n消息消费发生异常，error msg:dead letter exception\njava.lang.RuntimeException: dead letter exception\n...\n\n收到死信消息A：deadletter</code></pre><p>可以看到，死信队列的Consumer接受到了这个消息，所以流程到此为止就打通了。</p>\n<h2 id=\"五、死信消息的变化\"><a href=\"#五、死信消息的变化\" class=\"headerlink\" title=\"五、死信消息的变化\"></a>五、死信消息的变化</h2><p>那么“死信”被丢到死信队列中后，会发生什么变化呢？</p>\n<p>如果队列配置了参数 <code>x-dead-letter-routing-key</code> 的话，“死信”的路由key将会被替换成该参数对应的值。如果没有设置，则保留该消息原有的路由key。</p>\n<p>举个栗子：</p>\n<p>如果原有消息的路由key是<code>testA</code>，被发送到业务Exchage中，然后被投递到业务队列QueueA中，如果该队列没有配置参数<code>x-dead-letter-routing-key</code>，则该消息成为死信后，将保留原有的路由key<code>testA</code>，如果配置了该参数，并且值设置为<code>testB</code>，那么该消息成为死信后，路由key将会被替换为<code>testB</code>，然后被抛到死信交换机中。</p>\n<p>另外，由于被抛到了死信交换机，所以消息的Exchange Name也会被替换为死信交换机的名称。</p>\n<p>消息的Header中，也会添加很多奇奇怪怪的字段，修改一下上面的代码，在死信队列的消费者中添加一行日志输出：</p>\n<pre><code class=\"java\">log.info(&quot;死信消息properties：{}&quot;, message.getMessageProperties());</code></pre>\n<p>然后重新运行一次，即可得到死信消息Header中被添加的信息：</p>\n<pre><code>死信消息properties：MessageProperties [headers={x-first-death-exchange=dead.letter.demo.simple.business.exchange, x-death=[{reason=rejected, count=1, exchange=dead.letter.demo.simple.business.exchange, time=Sun Jul 14 16:48:16 CST 2019, routing-keys=[], queue=dead.letter.demo.simple.business.queuea}], x-first-death-reason=rejected, x-first-death-queue=dead.letter.demo.simple.business.queuea}, correlationId=1, replyTo=amq.rabbitmq.reply-to.g2dkABZyYWJiaXRAREVTS1RPUC1DUlZGUzBOAAAPQAAAAAAB.bLbsdR1DnuRSwiKKmtdOGw==, contentType=text/plain, contentEncoding=UTF-8, contentLength=0, receivedDeliveryMode=PERSISTENT, priority=0, redelivered=false, receivedExchange=dead.letter.demo.simple.deadletter.exchange, receivedRoutingKey=dead.letter.demo.simple.deadletter.queuea.routingkey, deliveryTag=1, consumerTag=amq.ctag-NSp18SUPoCNvQcoYoS2lPg, consumerQueue=dead.letter.demo.simple.deadletter.queuea]</code></pre><p>Header中看起来有很多信息，实际上并不多，只是值比较长而已。下面就简单说明一下Header中的值：</p>\n<table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>x-first-death-exchange</td>\n<td>第一次被抛入的死信交换机的名称</td>\n</tr>\n<tr>\n<td>x-first-death-reason</td>\n<td>第一次成为死信的原因，<code>rejected</code>：消息在重新进入队列时被队列拒绝，由于<code>default-requeue-rejected</code> 参数被设置为<code>false</code>。<code>expired</code>  ：消息过期。<code>maxlen</code> ： 队列内消息数量超过队列最大容量</td>\n</tr>\n<tr>\n<td>x-first-death-queue</td>\n<td>第一次成为死信前所在队列名称</td>\n</tr>\n<tr>\n<td>x-death</td>\n<td>历次被投入死信交换机的信息列表，同一个消息每次进入一个死信交换机，这个数组的信息就会被更新</td>\n</tr>\n</tbody></table>\n<h2 id=\"六、死信队列应用场景\"><a href=\"#六、死信队列应用场景\" class=\"headerlink\" title=\"六、死信队列应用场景\"></a>六、死信队列应用场景</h2><p>通过上面的信息，我们已经知道如何使用死信队列了，那么死信队列一般在什么场景下使用呢？</p>\n<p>一般用在较为重要的业务队列中，确保未被正确消费的消息不被丢弃，一般发生消费异常可能原因主要有由于消息信息本身存在错误导致处理异常，处理过程中参数校验异常，或者因网络波动导致的查询异常等等，当发生异常时，当然不能每次通过日志来获取原消息，然后让运维帮忙重新投递消息（没错，以前就是这么干的= =）。通过配置死信队列，可以让未正确处理的消息暂存到另一个队列中，待后续排查清楚问题后，编写相应的处理代码来处理死信消息，这样比手工恢复数据要好太多了。</p>\n<h2 id=\"七、总结\"><a href=\"#七、总结\" class=\"headerlink\" title=\"七、总结\"></a>七、总结</h2><p>死信队列其实并没有什么神秘的地方，不过是绑定在死信交换机上的普通队列，而死信交换机也只是一个普通的交换机，不过是用来专门处理死信的交换机。</p>\n<p>总结一下死信消息的生命周期：</p>\n<ol>\n<li>业务消息被投入业务队列</li>\n<li>消费者消费业务队列的消息，由于处理过程中发生异常，于是进行了nck或者reject操作</li>\n<li>被nck或reject的消息由RabbitMQ投递到死信交换机中</li>\n<li>死信交换机将消息投入相应的死信队列</li>\n<li>死信队列的消费者消费死信消息</li>\n</ol>\n<p>死信消息是RabbitMQ为我们做的一层保证，其实我们也可以不使用死信队列，而是在消息消费异常时，将消息主动投递到另一个交换机中，当你明白了这些之后，这些Exchange和Queue想怎样配合就能怎么配合。比如从死信队列拉取消息，然后发送邮件、短信、钉钉通知来通知开发人员关注。或者将消息重新投递到一个队列然后设置过期时间，来进行延时消费。</p>\n<p>如果本文对你有帮助，记得点个赞，也希望能分享给更多的朋友。也欢迎关注我的公众号进行留言交流。</p>\n"},{"title":"【周末随想】我思故我在","toc":true,"top":true,"cover":true,"date":"2020-11-01T15:45:35.000Z","_content":"\n又是一个周末的晚上，刚在客厅看完令人爆笑的脱口秀，回到自己房间，关了灯，做几次深呼吸，把心情平静了下来。虽然刚才的脱口秀确实让人忍俊不禁，但此刻的独处更让我欢喜。在这漆黑的房间里，闭上眼，聆听周围的一切，感受心跳的旋律和呼吸的节奏，能获得一种独特的平静。\n\n闭目养神了片刻，睁开双眼，路由器的信号灯在角落里跳动着。我打开窗，一阵微风吹入，周身泛起一股寒意。不知不觉，已是深秋，习惯性的抬头看了一眼天空，窗外的夜空，被周围的建筑切割成了好几片，那一个个小方格里，透出或黄或白的灯光，每一盏灯背后，都在上演着各自的故事。\n\n我披了外套，在小区里踱起步来。今晚的月亮挂的很高，漆黑的夜空散布着几片白云，在这漆黑的画布上，启明星的光芒显得格外耀眼，皓月悬空，孤星伴月，给这深秋的夜色凭添了几分孤冷。周遭路灯的光影，让这薄弱的月光毫无抗衡之力，只得往暗黑处避让。于是我往黑暗里走，去寻找这散落的月光。\n\n此时的小区已经没有了白日里的热闹景象，路上只有稀疏几个晚归的行人。路旁白日里还妖艳绽放的小花，在黑夜里黯然失色，只剩下孤零零的身影，在这微冷的晚风中摇曳。行至暗处，才终于寻得几许月光。月光如流水般轻盈，静静地从树叶的夹缝中滑落下来，洒在地上，仿佛给周围的树木都披上了一层薄纱。突然想到苏轼的诗词，“何处无月，何处无竹柏，但少闲人如吾两人耳”，此刻倒是羡慕起他来，虽已成闲人，毕竟还有人可以共赏这月色。\n\n抬头望向那月亮，月光流转千年，见证了无数的历史变迁，兴衰荣辱，此时此刻，却仍旧安安静静地在夜空中凝视着这一切，让我觉得沧桑而又孤傲。细细想来，我也只是这历史长河里茫茫众生中的一个，无法超脱于世，不禁又想到王国维的那句“试上高峰窥皓月，偶开天眼觑红尘，可怜身是眼中人”，好一个“可怜身是眼中人”，让词人苦闷又无奈的情绪跃然纸上。但这一切就应如此，或只能如此了吗。我想，关于人生的这道题，也许还有其他解法。\n\n白日里看到一些关于笛卡尔“我思故我在”的文章，觉得很有意思，于是又回味起来。\n\n笛卡尔是一位很有意思的哲学家，他主张怀疑一切，对自己所学的一切都表示怀疑，他认为一切知识都是不可靠的，因为它们都建立在不可靠的基础之上。但他并不是怀疑论者，而是希望为怀疑论找到一个答案，希望在一切怀疑中找到绝对可靠的“阿基米德点”。他构思了一个有趣的思想实验，如果有一个邪恶的魔鬼，可以让我们产生各种幻觉，包括我们所见所闻所知所感，甚至连最简单的事物也可以欺骗我们，甚至可以让我们以为一加一等于三，而且不会发现这其实是错的，那有没有什么是它绝对不可能骗过我们的，有没有什么事情是绝对不可怀疑的。就像盗梦空间里的梦境，我们如何知道自己是否身处梦境，是否能找到那只陀螺？又如同黑客帝国里，我们怎么知道自己是不是被连在一台巨大的超级计算机背后，我们所有的感觉也许只是计算机生成的指令，有没有什么是绝对正确的？\n\n“我思故我在”便是笛卡尔给出的答案，即使所见所闻都是假象，至少有一事无论如何都是真的，那便是“我在思考”，这便证明作为思考主体的我必定也存在，当然，这里说的“我”并不是指作为客观身体而存在的我，而是作为精神主体而存在的我。很多人对这句话都有着误解，把“故”理解成了“所以”，于是“我思”成了“我在”的原因，更有甚者，甚至说出“不思考便不存在”这样的荒诞逻辑。这两者都犯了逻辑错误，“我在思考，所以我存在”和“我在思考，证明我存在”，这两个解释听起来没什么区别，但再仔细品品，“所以”如果用“导致”来替换的话，区别就能比较明显的看出来了，看看下面这个例子：“我午饭吃了很多，证明我很饿”，“我吃了很多”确实可以作为“我很饿”的证据，但如果换成“我午饭吃了很多，所以我很饿”，从逻辑上就不对了，“我午饭吃了很多”并不少导致“我很饿”的原因，它们并不是因果关系，“我饿”在先，“吃很多”在后。同样，“我思”并不是“我在”的原因，“我在”也并不是“我思”的结果，而是“我思”能证明“我在”，“我在”在先，“我思”在后。至于“不思考便不存在”更是逻辑错的离谱，举个例子，“湖南人是人”这个命题是正确的，但“不是湖南人便不是人”这个命题显然就错的有些嚣张了。\n\n这样咬文嚼字似乎略显无趣，但有时为了追寻真理，却不得不如此。\n\n我曾经也有一段时间经常有这样的困惑，认为我所知道的一切不过是建立在不可靠的认识之下的，我所见所闻未必为真，我看到的也许只是故事的某个片段，甚至不排除是被人刻意剪辑过具有误导性的片段，就此得出的知识经验实在难说有什么价值。在这种思想的影响下，我对身边的一切都产生着怀疑，并怀疑真理是否真的存在，求知是否还有意义。经过一番思索，我终于给出了自己的答案。\n\n我必须承认我所有的知识都有可能是错误的，也许只是真实世界经过某种转换后出现在我心中的映射，所以我接受它随时会被驳倒的可能性，但只要它能很好的服务于当下，并且没有有力的证据表明其错误时，我便仍旧能够相信它。也许我确实只是一个缸中之脑，所有的一切都是虚幻，但如果没有足够的证据来支持，这个只会让我徒增烦恼的猜想便不再有什么意义。当然，由于对这个世界没有足够的了解，有些事也许确实跟我所理解的不一样，我所理解的世界跟真实的世界也许是两回事，所以需要不断去探索和学习，才能了解更多关于这个世界的真相。活在当下，便是我的选择。\n\n说回当下，老实说，今年的状态一直很差劲。也许是因为失去了情感的寄托，生活少了很多乐趣和期待，学习上也懈怠了，从博客更新的频率便可以看出。一直想方设法想要调整，也试图通过减肥来转移注意力。虽然在两个月的时间里，成功减掉了二十多斤，但仍旧没有找到生活的激情。以前我总以为只要足够努力，便能过上想要的生活。但仔细想想，我对于理想生活的构想其实还很模糊，对于自己追求的事物都尚未确定，又怎么知道该如何努力，如何选择。所以我决定放慢脚步，多思考问题的本质，尝试更多的可能性。人类的存在也许并没有什么意义，但我相信每个人的生活各有各的意义。\n\n一阵清风吹过，把我从无尽的思绪中拉回现实。月光如水，依旧流淌怀中，我轻叹一声，捧了一捧月光，一饮而尽。","source":"_posts/thoughts/cogito-ergo-sum.md","raw":"---\ntitle: 【周末随想】我思故我在\ntags:\n  - Thoughts\ncategories:\n  - 编程\ntoc: true\ntop: true\ncover: true\ndate: 2020-11-01 23:45:35\n---\n\n又是一个周末的晚上，刚在客厅看完令人爆笑的脱口秀，回到自己房间，关了灯，做几次深呼吸，把心情平静了下来。虽然刚才的脱口秀确实让人忍俊不禁，但此刻的独处更让我欢喜。在这漆黑的房间里，闭上眼，聆听周围的一切，感受心跳的旋律和呼吸的节奏，能获得一种独特的平静。\n\n闭目养神了片刻，睁开双眼，路由器的信号灯在角落里跳动着。我打开窗，一阵微风吹入，周身泛起一股寒意。不知不觉，已是深秋，习惯性的抬头看了一眼天空，窗外的夜空，被周围的建筑切割成了好几片，那一个个小方格里，透出或黄或白的灯光，每一盏灯背后，都在上演着各自的故事。\n\n我披了外套，在小区里踱起步来。今晚的月亮挂的很高，漆黑的夜空散布着几片白云，在这漆黑的画布上，启明星的光芒显得格外耀眼，皓月悬空，孤星伴月，给这深秋的夜色凭添了几分孤冷。周遭路灯的光影，让这薄弱的月光毫无抗衡之力，只得往暗黑处避让。于是我往黑暗里走，去寻找这散落的月光。\n\n此时的小区已经没有了白日里的热闹景象，路上只有稀疏几个晚归的行人。路旁白日里还妖艳绽放的小花，在黑夜里黯然失色，只剩下孤零零的身影，在这微冷的晚风中摇曳。行至暗处，才终于寻得几许月光。月光如流水般轻盈，静静地从树叶的夹缝中滑落下来，洒在地上，仿佛给周围的树木都披上了一层薄纱。突然想到苏轼的诗词，“何处无月，何处无竹柏，但少闲人如吾两人耳”，此刻倒是羡慕起他来，虽已成闲人，毕竟还有人可以共赏这月色。\n\n抬头望向那月亮，月光流转千年，见证了无数的历史变迁，兴衰荣辱，此时此刻，却仍旧安安静静地在夜空中凝视着这一切，让我觉得沧桑而又孤傲。细细想来，我也只是这历史长河里茫茫众生中的一个，无法超脱于世，不禁又想到王国维的那句“试上高峰窥皓月，偶开天眼觑红尘，可怜身是眼中人”，好一个“可怜身是眼中人”，让词人苦闷又无奈的情绪跃然纸上。但这一切就应如此，或只能如此了吗。我想，关于人生的这道题，也许还有其他解法。\n\n白日里看到一些关于笛卡尔“我思故我在”的文章，觉得很有意思，于是又回味起来。\n\n笛卡尔是一位很有意思的哲学家，他主张怀疑一切，对自己所学的一切都表示怀疑，他认为一切知识都是不可靠的，因为它们都建立在不可靠的基础之上。但他并不是怀疑论者，而是希望为怀疑论找到一个答案，希望在一切怀疑中找到绝对可靠的“阿基米德点”。他构思了一个有趣的思想实验，如果有一个邪恶的魔鬼，可以让我们产生各种幻觉，包括我们所见所闻所知所感，甚至连最简单的事物也可以欺骗我们，甚至可以让我们以为一加一等于三，而且不会发现这其实是错的，那有没有什么是它绝对不可能骗过我们的，有没有什么事情是绝对不可怀疑的。就像盗梦空间里的梦境，我们如何知道自己是否身处梦境，是否能找到那只陀螺？又如同黑客帝国里，我们怎么知道自己是不是被连在一台巨大的超级计算机背后，我们所有的感觉也许只是计算机生成的指令，有没有什么是绝对正确的？\n\n“我思故我在”便是笛卡尔给出的答案，即使所见所闻都是假象，至少有一事无论如何都是真的，那便是“我在思考”，这便证明作为思考主体的我必定也存在，当然，这里说的“我”并不是指作为客观身体而存在的我，而是作为精神主体而存在的我。很多人对这句话都有着误解，把“故”理解成了“所以”，于是“我思”成了“我在”的原因，更有甚者，甚至说出“不思考便不存在”这样的荒诞逻辑。这两者都犯了逻辑错误，“我在思考，所以我存在”和“我在思考，证明我存在”，这两个解释听起来没什么区别，但再仔细品品，“所以”如果用“导致”来替换的话，区别就能比较明显的看出来了，看看下面这个例子：“我午饭吃了很多，证明我很饿”，“我吃了很多”确实可以作为“我很饿”的证据，但如果换成“我午饭吃了很多，所以我很饿”，从逻辑上就不对了，“我午饭吃了很多”并不少导致“我很饿”的原因，它们并不是因果关系，“我饿”在先，“吃很多”在后。同样，“我思”并不是“我在”的原因，“我在”也并不是“我思”的结果，而是“我思”能证明“我在”，“我在”在先，“我思”在后。至于“不思考便不存在”更是逻辑错的离谱，举个例子，“湖南人是人”这个命题是正确的，但“不是湖南人便不是人”这个命题显然就错的有些嚣张了。\n\n这样咬文嚼字似乎略显无趣，但有时为了追寻真理，却不得不如此。\n\n我曾经也有一段时间经常有这样的困惑，认为我所知道的一切不过是建立在不可靠的认识之下的，我所见所闻未必为真，我看到的也许只是故事的某个片段，甚至不排除是被人刻意剪辑过具有误导性的片段，就此得出的知识经验实在难说有什么价值。在这种思想的影响下，我对身边的一切都产生着怀疑，并怀疑真理是否真的存在，求知是否还有意义。经过一番思索，我终于给出了自己的答案。\n\n我必须承认我所有的知识都有可能是错误的，也许只是真实世界经过某种转换后出现在我心中的映射，所以我接受它随时会被驳倒的可能性，但只要它能很好的服务于当下，并且没有有力的证据表明其错误时，我便仍旧能够相信它。也许我确实只是一个缸中之脑，所有的一切都是虚幻，但如果没有足够的证据来支持，这个只会让我徒增烦恼的猜想便不再有什么意义。当然，由于对这个世界没有足够的了解，有些事也许确实跟我所理解的不一样，我所理解的世界跟真实的世界也许是两回事，所以需要不断去探索和学习，才能了解更多关于这个世界的真相。活在当下，便是我的选择。\n\n说回当下，老实说，今年的状态一直很差劲。也许是因为失去了情感的寄托，生活少了很多乐趣和期待，学习上也懈怠了，从博客更新的频率便可以看出。一直想方设法想要调整，也试图通过减肥来转移注意力。虽然在两个月的时间里，成功减掉了二十多斤，但仍旧没有找到生活的激情。以前我总以为只要足够努力，便能过上想要的生活。但仔细想想，我对于理想生活的构想其实还很模糊，对于自己追求的事物都尚未确定，又怎么知道该如何努力，如何选择。所以我决定放慢脚步，多思考问题的本质，尝试更多的可能性。人类的存在也许并没有什么意义，但我相信每个人的生活各有各的意义。\n\n一阵清风吹过，把我从无尽的思绪中拉回现实。月光如水，依旧流淌怀中，我轻叹一声，捧了一捧月光，一饮而尽。","slug":"thoughts/cogito-ergo-sum","published":1,"updated":"2020-11-01T15:45:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfbn001b5ohu702z6i5x","content":"<p>又是一个周末的晚上，刚在客厅看完令人爆笑的脱口秀，回到自己房间，关了灯，做几次深呼吸，把心情平静了下来。虽然刚才的脱口秀确实让人忍俊不禁，但此刻的独处更让我欢喜。在这漆黑的房间里，闭上眼，聆听周围的一切，感受心跳的旋律和呼吸的节奏，能获得一种独特的平静。</p>\n<p>闭目养神了片刻，睁开双眼，路由器的信号灯在角落里跳动着。我打开窗，一阵微风吹入，周身泛起一股寒意。不知不觉，已是深秋，习惯性的抬头看了一眼天空，窗外的夜空，被周围的建筑切割成了好几片，那一个个小方格里，透出或黄或白的灯光，每一盏灯背后，都在上演着各自的故事。</p>\n<p>我披了外套，在小区里踱起步来。今晚的月亮挂的很高，漆黑的夜空散布着几片白云，在这漆黑的画布上，启明星的光芒显得格外耀眼，皓月悬空，孤星伴月，给这深秋的夜色凭添了几分孤冷。周遭路灯的光影，让这薄弱的月光毫无抗衡之力，只得往暗黑处避让。于是我往黑暗里走，去寻找这散落的月光。</p>\n<p>此时的小区已经没有了白日里的热闹景象，路上只有稀疏几个晚归的行人。路旁白日里还妖艳绽放的小花，在黑夜里黯然失色，只剩下孤零零的身影，在这微冷的晚风中摇曳。行至暗处，才终于寻得几许月光。月光如流水般轻盈，静静地从树叶的夹缝中滑落下来，洒在地上，仿佛给周围的树木都披上了一层薄纱。突然想到苏轼的诗词，“何处无月，何处无竹柏，但少闲人如吾两人耳”，此刻倒是羡慕起他来，虽已成闲人，毕竟还有人可以共赏这月色。</p>\n<p>抬头望向那月亮，月光流转千年，见证了无数的历史变迁，兴衰荣辱，此时此刻，却仍旧安安静静地在夜空中凝视着这一切，让我觉得沧桑而又孤傲。细细想来，我也只是这历史长河里茫茫众生中的一个，无法超脱于世，不禁又想到王国维的那句“试上高峰窥皓月，偶开天眼觑红尘，可怜身是眼中人”，好一个“可怜身是眼中人”，让词人苦闷又无奈的情绪跃然纸上。但这一切就应如此，或只能如此了吗。我想，关于人生的这道题，也许还有其他解法。</p>\n<p>白日里看到一些关于笛卡尔“我思故我在”的文章，觉得很有意思，于是又回味起来。</p>\n<p>笛卡尔是一位很有意思的哲学家，他主张怀疑一切，对自己所学的一切都表示怀疑，他认为一切知识都是不可靠的，因为它们都建立在不可靠的基础之上。但他并不是怀疑论者，而是希望为怀疑论找到一个答案，希望在一切怀疑中找到绝对可靠的“阿基米德点”。他构思了一个有趣的思想实验，如果有一个邪恶的魔鬼，可以让我们产生各种幻觉，包括我们所见所闻所知所感，甚至连最简单的事物也可以欺骗我们，甚至可以让我们以为一加一等于三，而且不会发现这其实是错的，那有没有什么是它绝对不可能骗过我们的，有没有什么事情是绝对不可怀疑的。就像盗梦空间里的梦境，我们如何知道自己是否身处梦境，是否能找到那只陀螺？又如同黑客帝国里，我们怎么知道自己是不是被连在一台巨大的超级计算机背后，我们所有的感觉也许只是计算机生成的指令，有没有什么是绝对正确的？</p>\n<p>“我思故我在”便是笛卡尔给出的答案，即使所见所闻都是假象，至少有一事无论如何都是真的，那便是“我在思考”，这便证明作为思考主体的我必定也存在，当然，这里说的“我”并不是指作为客观身体而存在的我，而是作为精神主体而存在的我。很多人对这句话都有着误解，把“故”理解成了“所以”，于是“我思”成了“我在”的原因，更有甚者，甚至说出“不思考便不存在”这样的荒诞逻辑。这两者都犯了逻辑错误，“我在思考，所以我存在”和“我在思考，证明我存在”，这两个解释听起来没什么区别，但再仔细品品，“所以”如果用“导致”来替换的话，区别就能比较明显的看出来了，看看下面这个例子：“我午饭吃了很多，证明我很饿”，“我吃了很多”确实可以作为“我很饿”的证据，但如果换成“我午饭吃了很多，所以我很饿”，从逻辑上就不对了，“我午饭吃了很多”并不少导致“我很饿”的原因，它们并不是因果关系，“我饿”在先，“吃很多”在后。同样，“我思”并不是“我在”的原因，“我在”也并不是“我思”的结果，而是“我思”能证明“我在”，“我在”在先，“我思”在后。至于“不思考便不存在”更是逻辑错的离谱，举个例子，“湖南人是人”这个命题是正确的，但“不是湖南人便不是人”这个命题显然就错的有些嚣张了。</p>\n<p>这样咬文嚼字似乎略显无趣，但有时为了追寻真理，却不得不如此。</p>\n<p>我曾经也有一段时间经常有这样的困惑，认为我所知道的一切不过是建立在不可靠的认识之下的，我所见所闻未必为真，我看到的也许只是故事的某个片段，甚至不排除是被人刻意剪辑过具有误导性的片段，就此得出的知识经验实在难说有什么价值。在这种思想的影响下，我对身边的一切都产生着怀疑，并怀疑真理是否真的存在，求知是否还有意义。经过一番思索，我终于给出了自己的答案。</p>\n<p>我必须承认我所有的知识都有可能是错误的，也许只是真实世界经过某种转换后出现在我心中的映射，所以我接受它随时会被驳倒的可能性，但只要它能很好的服务于当下，并且没有有力的证据表明其错误时，我便仍旧能够相信它。也许我确实只是一个缸中之脑，所有的一切都是虚幻，但如果没有足够的证据来支持，这个只会让我徒增烦恼的猜想便不再有什么意义。当然，由于对这个世界没有足够的了解，有些事也许确实跟我所理解的不一样，我所理解的世界跟真实的世界也许是两回事，所以需要不断去探索和学习，才能了解更多关于这个世界的真相。活在当下，便是我的选择。</p>\n<p>说回当下，老实说，今年的状态一直很差劲。也许是因为失去了情感的寄托，生活少了很多乐趣和期待，学习上也懈怠了，从博客更新的频率便可以看出。一直想方设法想要调整，也试图通过减肥来转移注意力。虽然在两个月的时间里，成功减掉了二十多斤，但仍旧没有找到生活的激情。以前我总以为只要足够努力，便能过上想要的生活。但仔细想想，我对于理想生活的构想其实还很模糊，对于自己追求的事物都尚未确定，又怎么知道该如何努力，如何选择。所以我决定放慢脚步，多思考问题的本质，尝试更多的可能性。人类的存在也许并没有什么意义，但我相信每个人的生活各有各的意义。</p>\n<p>一阵清风吹过，把我从无尽的思绪中拉回现实。月光如水，依旧流淌怀中，我轻叹一声，捧了一捧月光，一饮而尽。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<p>又是一个周末的晚上，刚在客厅看完令人爆笑的脱口秀，回到自己房间，关了灯，做几次深呼吸，把心情平静了下来。虽然刚才的脱口秀确实让人忍俊不禁，但此刻的独处更让我欢喜。在这漆黑的房间里，闭上眼，聆听周围的一切，感受心跳的旋律和呼吸的节奏，能获得一种独特的平静。</p>\n<p>闭目养神了片刻，睁开双眼，路由器的信号灯在角落里跳动着。我打开窗，一阵微风吹入，周身泛起一股寒意。不知不觉，已是深秋，习惯性的抬头看了一眼天空，窗外的夜空，被周围的建筑切割成了好几片，那一个个小方格里，透出或黄或白的灯光，每一盏灯背后，都在上演着各自的故事。</p>\n<p>我披了外套，在小区里踱起步来。今晚的月亮挂的很高，漆黑的夜空散布着几片白云，在这漆黑的画布上，启明星的光芒显得格外耀眼，皓月悬空，孤星伴月，给这深秋的夜色凭添了几分孤冷。周遭路灯的光影，让这薄弱的月光毫无抗衡之力，只得往暗黑处避让。于是我往黑暗里走，去寻找这散落的月光。</p>\n<p>此时的小区已经没有了白日里的热闹景象，路上只有稀疏几个晚归的行人。路旁白日里还妖艳绽放的小花，在黑夜里黯然失色，只剩下孤零零的身影，在这微冷的晚风中摇曳。行至暗处，才终于寻得几许月光。月光如流水般轻盈，静静地从树叶的夹缝中滑落下来，洒在地上，仿佛给周围的树木都披上了一层薄纱。突然想到苏轼的诗词，“何处无月，何处无竹柏，但少闲人如吾两人耳”，此刻倒是羡慕起他来，虽已成闲人，毕竟还有人可以共赏这月色。</p>\n<p>抬头望向那月亮，月光流转千年，见证了无数的历史变迁，兴衰荣辱，此时此刻，却仍旧安安静静地在夜空中凝视着这一切，让我觉得沧桑而又孤傲。细细想来，我也只是这历史长河里茫茫众生中的一个，无法超脱于世，不禁又想到王国维的那句“试上高峰窥皓月，偶开天眼觑红尘，可怜身是眼中人”，好一个“可怜身是眼中人”，让词人苦闷又无奈的情绪跃然纸上。但这一切就应如此，或只能如此了吗。我想，关于人生的这道题，也许还有其他解法。</p>\n<p>白日里看到一些关于笛卡尔“我思故我在”的文章，觉得很有意思，于是又回味起来。</p>\n<p>笛卡尔是一位很有意思的哲学家，他主张怀疑一切，对自己所学的一切都表示怀疑，他认为一切知识都是不可靠的，因为它们都建立在不可靠的基础之上。但他并不是怀疑论者，而是希望为怀疑论找到一个答案，希望在一切怀疑中找到绝对可靠的“阿基米德点”。他构思了一个有趣的思想实验，如果有一个邪恶的魔鬼，可以让我们产生各种幻觉，包括我们所见所闻所知所感，甚至连最简单的事物也可以欺骗我们，甚至可以让我们以为一加一等于三，而且不会发现这其实是错的，那有没有什么是它绝对不可能骗过我们的，有没有什么事情是绝对不可怀疑的。就像盗梦空间里的梦境，我们如何知道自己是否身处梦境，是否能找到那只陀螺？又如同黑客帝国里，我们怎么知道自己是不是被连在一台巨大的超级计算机背后，我们所有的感觉也许只是计算机生成的指令，有没有什么是绝对正确的？</p>\n<p>“我思故我在”便是笛卡尔给出的答案，即使所见所闻都是假象，至少有一事无论如何都是真的，那便是“我在思考”，这便证明作为思考主体的我必定也存在，当然，这里说的“我”并不是指作为客观身体而存在的我，而是作为精神主体而存在的我。很多人对这句话都有着误解，把“故”理解成了“所以”，于是“我思”成了“我在”的原因，更有甚者，甚至说出“不思考便不存在”这样的荒诞逻辑。这两者都犯了逻辑错误，“我在思考，所以我存在”和“我在思考，证明我存在”，这两个解释听起来没什么区别，但再仔细品品，“所以”如果用“导致”来替换的话，区别就能比较明显的看出来了，看看下面这个例子：“我午饭吃了很多，证明我很饿”，“我吃了很多”确实可以作为“我很饿”的证据，但如果换成“我午饭吃了很多，所以我很饿”，从逻辑上就不对了，“我午饭吃了很多”并不少导致“我很饿”的原因，它们并不是因果关系，“我饿”在先，“吃很多”在后。同样，“我思”并不是“我在”的原因，“我在”也并不是“我思”的结果，而是“我思”能证明“我在”，“我在”在先，“我思”在后。至于“不思考便不存在”更是逻辑错的离谱，举个例子，“湖南人是人”这个命题是正确的，但“不是湖南人便不是人”这个命题显然就错的有些嚣张了。</p>\n<p>这样咬文嚼字似乎略显无趣，但有时为了追寻真理，却不得不如此。</p>\n<p>我曾经也有一段时间经常有这样的困惑，认为我所知道的一切不过是建立在不可靠的认识之下的，我所见所闻未必为真，我看到的也许只是故事的某个片段，甚至不排除是被人刻意剪辑过具有误导性的片段，就此得出的知识经验实在难说有什么价值。在这种思想的影响下，我对身边的一切都产生着怀疑，并怀疑真理是否真的存在，求知是否还有意义。经过一番思索，我终于给出了自己的答案。</p>\n<p>我必须承认我所有的知识都有可能是错误的，也许只是真实世界经过某种转换后出现在我心中的映射，所以我接受它随时会被驳倒的可能性，但只要它能很好的服务于当下，并且没有有力的证据表明其错误时，我便仍旧能够相信它。也许我确实只是一个缸中之脑，所有的一切都是虚幻，但如果没有足够的证据来支持，这个只会让我徒增烦恼的猜想便不再有什么意义。当然，由于对这个世界没有足够的了解，有些事也许确实跟我所理解的不一样，我所理解的世界跟真实的世界也许是两回事，所以需要不断去探索和学习，才能了解更多关于这个世界的真相。活在当下，便是我的选择。</p>\n<p>说回当下，老实说，今年的状态一直很差劲。也许是因为失去了情感的寄托，生活少了很多乐趣和期待，学习上也懈怠了，从博客更新的频率便可以看出。一直想方设法想要调整，也试图通过减肥来转移注意力。虽然在两个月的时间里，成功减掉了二十多斤，但仍旧没有找到生活的激情。以前我总以为只要足够努力，便能过上想要的生活。但仔细想想，我对于理想生活的构想其实还很模糊，对于自己追求的事物都尚未确定，又怎么知道该如何努力，如何选择。所以我决定放慢脚步，多思考问题的本质，尝试更多的可能性。人类的存在也许并没有什么意义，但我相信每个人的生活各有各的意义。</p>\n<p>一阵清风吹过，把我从无尽的思绪中拉回现实。月光如水，依旧流淌怀中，我轻叹一声，捧了一捧月光，一饮而尽。</p>\n"},{"title":"【RabbitMQ】一文带你搞定RabbitMQ延迟队列","toc":true,"top":true,"cover":true,"date":"2020-05-03T17:00:50.000Z","_content":"\n本文口味：鱼香肉丝   预计阅读：10分钟\n\n## 一、说明\n\n在上一篇中，介绍了RabbitMQ中的死信队列是什么，何时使用以及如何使用RabbitMQ的死信队列。相信通过上一篇的学习，对于死信队列已经有了更多的了解，这一篇的内容也跟死信队列息息相关，如果你还不了解死信队列，那么建议你先进行上一篇文章的阅读。\n\n这一篇里，我们将继续介绍RabbitMQ的高级特性，通过本篇的学习，你将收获：\n1. 什么是延时队列\n2. 延时队列使用场景\n3. RabbitMQ中的TTL\n4. 如何利用RabbitMQ来实现延时队列\n\n## 二、本文大纲\n\n以下是本文大纲：\n\n![1.png](https://i.loli.net/2019/07/28/5d3d74d99699d43032.png)\n\n本文阅读前，需要对RabbitMQ以及死信队列有一个简单的了解。\n\n## 三、什么是延时队列\n\n`延时队列`，首先，它是一种队列，队列意味着内部的元素是`有序`的，元素出队和入队是有方向性的，元素从一端进入，从另一端取出。\n\n其次，`延时队列`，最重要的特性就体现在它的`延时`属性上，跟普通的队列不一样的是，`普通队列中的元素总是等着希望被早点取出处理，而延时队列中的元素则是希望被在指定时间得到取出和处理`，所以延时队列中的元素是都是带时间属性的，通常来说是需要被处理的消息或者任务。\n\n简单来说，延时队列就是用来存放需要在指定时间被处理的元素的队列。\n\n## 四、延时队列使用场景\n\n那么什么时候需要用延时队列呢？考虑一下以下场景：\n\n1. 订单在十分钟之内未支付则自动取消。\n2. 新创建的店铺，如果在十天内都没有上传过商品，则自动发送消息提醒。\n3. 账单在一周内未支付，则自动结算。\n4. 用户注册成功后，如果三天内没有登陆则进行短信提醒。\n5. 用户发起退款，如果三天内没有得到处理则通知相关运营人员。\n6. 预定会议后，需要在预定的时间点前十分钟通知各个与会人员参加会议。\n\n这些场景都有一个特点，需要在某个事件发生之后或者之前的指定时间点完成某一项任务，如：发生订单生成事件，在十分钟之后检查该订单支付状态，然后将未支付的订单进行关闭；发生店铺创建事件，十天后检查该店铺上新商品数，然后通知上新数为0的商户；发生账单生成事件，检查账单支付状态，然后自动结算未支付的账单；发生新用户注册事件，三天后检查新注册用户的活动数据，然后通知没有任何活动记录的用户；发生退款事件，在三天之后检查该订单是否已被处理，如仍未被处理，则发送消息给相关运营人员；发生预定会议事件，判断离会议开始是否只有十分钟了，如果是，则通知各个与会人员。\n\n看起来似乎使用定时任务，一直轮询数据，每秒查一次，取出需要被处理的数据，然后处理不就完事了吗？如果数据量比较少，确实可以这样做，比如：对于“如果账单一周内未支付则进行自动结算”这样的需求，如果对于时间不是严格限制，而是宽松意义上的一周，那么每天晚上跑个定时任务检查一下所有未支付的账单，确实也是一个可行的方案。但对于数据量比较大，并且时效性较强的场景，如：“订单十分钟内未支付则关闭“，短期内未支付的订单数据可能会有很多，活动期间甚至会达到百万甚至千万级别，对这么庞大的数据量仍旧使用轮询的方式显然是不可取的，很可能在一秒内无法完成所有订单的检查，同时会给数据库带来很大压力，无法满足业务要求而且性能低下。\n\n更重要的一点是，不！优！雅！\n\n没错，作为一名有追求的程序员，始终应该追求更优雅的架构和更优雅的代码风格，写代码要像写诗一样优美。【滑稽】\n\n这时候，延时队列就可以闪亮登场了，以上场景，正是延时队列的用武之地。\n\n既然`延时队列`可以解决很多特定场景下，带时间属性的任务需求，那么如何构造一个延时队列呢？接下来，本文将介绍如何用RabbitMQ来实现延时队列。\n\n## 五、RabbitMQ中的TTL\n\n在介绍延时队列之前，还需要先介绍一下RabbitMQ中的一个高级特性——`TTL（Time To Live）`。\n\n`TTL`是什么呢？`TTL`是RabbitMQ中一个消息或者队列的属性，表明`一条消息或者该队列中的所有消息的最大存活时间`，单位是毫秒。换句话说，如果一条消息设置了TTL属性或者进入了设置TTL属性的队列，那么这条消息如果在TTL设置的时间内没有被消费，则会成为“死信”（至于什么是死信，请翻看上一篇）。如果同时配置了队列的TTL和消息的TTL，那么较小的那个值将会被使用。\n\n那么，如何设置这个TTL值呢？有两种方式，第一种是在创建队列的时候设置队列的“x-message-ttl”属性，如下：\n\n```java\nMap<String, Object> args = new HashMap<String, Object>();\nargs.put(\"x-message-ttl\", 6000);\nchannel.queueDeclare(queueName, durable, exclusive, autoDelete, args);\n```\n\n这样所有被投递到该队列的消息都最多不会存活超过6s。\n\n另一种方式便是针对每条消息设置TTL，代码如下：\n\n```java\nAMQP.BasicProperties.Builder builder = new AMQP.BasicProperties.Builder();\nbuilder.expiration(\"6000\");\nAMQP.BasicProperties properties = builder.build();\nchannel.basicPublish(exchangeName, routingKey, mandatory, properties, \"msg body\".getBytes());\n```\n\n这样这条消息的过期时间也被设置成了6s。\n\n但这两种方式是有区别的，**如果设置了队列的TTL属性，那么一旦消息过期，就会被队列丢弃，而第二种方式，消息即使过期，也不一定会被马上丢弃，因为消息是否过期是在即将投递到消费者之前判定的，如果当前队列有严重的消息积压情况，则已过期的消息也许还能存活较长时间。**\n\n另外，还需要注意的一点是，如果不设置TTL，表示消息永远不会过期，如果将TTL设置为0，则表示除非此时可以直接投递该消息到消费者，否则该消息将会被丢弃。\n\n## 六、如何利用RabbitMQ实现延时队列\n\n前一篇里介绍了如果设置死信队列，前文中又介绍了TTL，至此，利用RabbitMQ实现延时队列的两大要素已经集齐，接下来只需要将它们进行调和，再加入一点点调味料，延时队列就可以新鲜出炉了。\n\n想想看，`延时队列`，不就是想要消息延迟多久被处理吗，TTL则刚好能让消息在延迟多久之后成为死信，另一方面，成为死信的消息都会被投递到死信队列里，这样只需要消费者一直消费死信队列里的消息就万事大吉了，因为里面的消息都是希望被立即处理的消息。\n\n从下图可以大致看出消息的流向：\n\n![23.png](https://i.loli.net/2019/07/28/5d3d743143ecc85643.png)\n\n生产者生产一条延时消息，根据需要延时时间的不同，利用不同的routingkey将消息路由到不同的延时队列，每个队列都设置了不同的TTL属性，并绑定在同一个死信交换机中，消息过期后，根据routingkey的不同，又会被路由到不同的死信队列中，消费者只需要监听对应的死信队列进行处理即可。\n\n下面来看代码：\n\n先声明交换机、队列以及他们的绑定关系：\n\n```java\n@Configuration\npublic class RabbitMQConfig {\n\n    public static final String DELAY_EXCHANGE_NAME = \"delay.queue.demo.business.exchange\";\n    public static final String DELAY_QUEUEA_NAME = \"delay.queue.demo.business.queuea\";\n    public static final String DELAY_QUEUEA_ROUTING_KEY = \"delay.queue.demo.business.queuea.routingkey\";\n    public static final String DELAY_QUEUEB_ROUTING_KEY = \"delay.queue.demo.business.queueb.routingkey\";\n    public static final String DEAD_LETTER_EXCHANGE = \"delay.queue.demo.deadletter.exchange\";\n    public static final String DEAD_LETTER_QUEUEA_ROUTING_KEY = \"delay.queue.demo.deadletter.delay_10s.routingkey\";\n    public static final String DEAD_LETTER_QUEUEB_ROUTING_KEY = \"delay.queue.demo.deadletter.delay_60s.routingkey\";\n    public static final String DEAD_LETTER_QUEUEA_NAME = \"delay.queue.demo.deadletter.queuea\";\n    public static final String DEAD_LETTER_QUEUEB_NAME = \"delay.queue.demo.deadletter.queueb\";\n\n    // 声明延时Exchange\n    @Bean(\"delayExchange\")\n    public DirectExchange delayExchange(){\n        return new DirectExchange(DELAY_EXCHANGE_NAME);\n    }\n\n    // 声明死信Exchange\n    @Bean(\"deadLetterExchange\")\n    public DirectExchange deadLetterExchange(){\n        return new DirectExchange(DEAD_LETTER_EXCHANGE);\n    }\n\n    // 声明延时队列A 延时10s\n    // 并绑定到对应的死信交换机\n    @Bean(\"delayQueueA\")\n    public Queue delayQueueA(){\n        Map<String, Object> args = new HashMap<>(2);\n        // x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(\"x-dead-letter-exchange\", DEAD_LETTER_EXCHANGE);\n        // x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(\"x-dead-letter-routing-key\", DEAD_LETTER_QUEUEA_ROUTING_KEY);\n        // x-message-ttl  声明队列的TTL\n        args.put(\"x-message-ttl\", 6000);\n        return QueueBuilder.durable(DEAD_LETTER_QUEUEA_NAME).withArguments(args).build();\n    }\n\n    // 声明延时队列B 延时 60s\n    // 并绑定到对应的死信交换机\n    @Bean(\"delayQueueB\")\n    public Queue delayQueueB(){\n        Map<String, Object> args = new HashMap<>(2);\n        // x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(\"x-dead-letter-exchange\", DEAD_LETTER_EXCHANGE);\n        // x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(\"x-dead-letter-routing-key\", DEAD_LETTER_QUEUEB_ROUTING_KEY);\n        // x-message-ttl  声明队列的TTL\n        args.put(\"x-message-ttl\", 60000);\n        return QueueBuilder.durable(DEAD_LETTER_QUEUEB_NAME).withArguments(args).build();\n    }\n\n    // 声明死信队列A 用于接收延时10s处理的消息\n    @Bean(\"deadLetterQueueA\")\n    public Queue deadLetterQueueA(){\n        return new Queue(DEAD_LETTER_QUEUEA_NAME);\n    }\n\n    // 声明死信队列B 用于接收延时60s处理的消息\n    @Bean(\"deadLetterQueueB\")\n    public Queue deadLetterQueueB(){\n        return new Queue(DEAD_LETTER_QUEUEB_NAME);\n    }\n\n    // 声明延时队列A绑定关系\n    @Bean\n    public Binding delayBindingA(@Qualifier(\"delayQueueA\") Queue queue,\n                                    @Qualifier(\"delayExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DELAY_QUEUEA_ROUTING_KEY);\n    }\n\n    // 声明业务队列B绑定关系\n    @Bean\n    public Binding delayBindingB(@Qualifier(\"delayQueueB\") Queue queue,\n                                    @Qualifier(\"delayExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DELAY_QUEUEB_ROUTING_KEY);\n    }\n\n    // 声明死信队列A绑定关系\n    @Bean\n    public Binding deadLetterBindingA(@Qualifier(\"deadLetterQueueA\") Queue queue,\n                                    @Qualifier(\"deadLetterExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEA_ROUTING_KEY);\n    }\n\n    // 声明死信队列B绑定关系\n    @Bean\n    public Binding deadLetterBindingB(@Qualifier(\"deadLetterQueueB\") Queue queue,\n                                      @Qualifier(\"deadLetterExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEB_ROUTING_KEY);\n    }\n}\n```\n\n接下来，创建两个消费者，分别对两个死信队列的消息进行消费：\n\n```java\n@Slf4j\n@Component\npublic class DeadLetterQueueConsumer {\n\n    @RabbitListener(queues = DEAD_LETTER_QUEUEA_NAME)\n    public void receiveA(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(\"当前时间：{},死信队列A收到消息：{}\", new Date().toString(), msg);\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n\n    @RabbitListener(queues = DEAD_LETTER_QUEUEB_NAME)\n    public void receiveB(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(\"当前时间：{},死信队列B收到消息：{}\", new Date().toString(), msg);\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n}\n```\n\n然后是消息的生产者：\n\n```java\n@Component\npublic class DelayMessageSender {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void sendMsg(String msg, DelayTypeEnum type){\n        switch (type){\n            case DELAY_10s:\n                rabbitTemplate.convertAndSend(DELAY_EXCHANGE_NAME, DELAY_QUEUEA_ROUTING_KEY, msg);\n                break;\n            case DELAY_60s:\n                rabbitTemplate.convertAndSend(DELAY_EXCHANGE_NAME, DELAY_QUEUEB_ROUTING_KEY, msg);\n                break;\n        }\n    }\n}\n```\n\n接下来，我们暴露一个web接口来生产消息：\n\n```java\n@Slf4j\n@RequestMapping(\"rabbitmq\")\n@RestController\npublic class RabbitMQMsgController {\n\n    @Autowired\n    private DelayMessageSender sender;\n\n    @RequestMapping(\"sendmsg\")\n    public void sendMsg(String msg, Integer delayType){\n        log.info(\"当前时间：{},收到请求，msg:{},delayType:{}\", new Date(), msg, delayType);\n        sender.sendMsg(msg, Objects.requireNonNull(DelayTypeEnum.getDelayTypeEnumByValue(delayType)));\n    }\n}\n```\n\n准备就绪，启动！\n\n打开rabbitMQ的[管理后台](http://localhost:15672)，可以看到我们刚才创建的交换机和队列信息：\n\n![2.png](https://i.loli.net/2019/07/28/5d3d54e15534398514.png)\n\n![4.png](https://i.loli.net/2019/07/28/5d3d54e17df8183993.png)\n\n![3.png](https://i.loli.net/2019/07/28/5d3d54e16952546955.png)\n\n接下来，我们来发送几条消息，http://localhost:8080/rabbitmq/sendmsg?msg=testMsg1&delayType=1 http://localhost:8080/rabbitmq/sendmsg?msg=testMsg2&delayType=2\n\n日志如下：\n\n```powershell\n2019-07-28 16:02:19.813  INFO 3860 --- [nio-8080-exec-9] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:02:19 CST 2019,收到请求，msg:testMsg1,delayType:1\n2019-07-28 16:02:19.815  INFO 3860 --- [nio-8080-exec-9] .l.DirectReplyToMessageListenerContainer : SimpleConsumer [queue=amq.rabbitmq.reply-to, consumerTag=amq.ctag-o-qPpkWIkRm73DIrOIVhig identity=766339] started\n2019-07-28 16:02:25.829  INFO 3860 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:02:25 CST 2019,死信队列A收到消息：testMsg1\n2019-07-28 16:02:41.326  INFO 3860 --- [nio-8080-exec-1] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:02:41 CST 2019,收到请求，msg:testMsg2,delayType:2\n2019-07-28 16:03:41.329  INFO 3860 --- [ntContainer#0-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:03:41 CST 2019,死信队列B收到消息：testMsg2\n```\n\n第一条消息在6s后变成了死信消息，然后被消费者消费掉，第二条消息在60s之后变成了死信消息，然后被消费掉，这样，一个还算ok的延时队列就打造完成了。\n\n不过，等等，如果这样使用的话，岂不是每增加一个新的时间需求，就要新增一个队列，这里只有6s和60s两个时间选项，如果需要一个小时后处理，那么就需要增加TTL为一个小时的队列，如果是预定会议室然后提前通知这样的场景，岂不是要增加无数个队列才能满足需求？？\n\n嗯，仔细想想，事情并不简单。\n\n## 七、RabbitMQ延时队列优化\n\n显然，需要一种更通用的方案才能满足需求，那么就只能将TTL设置在消息属性里了。我们来试一试。\n\n增加一个延时队列，用于接收设置为任意延时时长的消息，增加一个相应的死信队列和routingkey：\n\n```java\n@Configuration\npublic class RabbitMQConfig {\n\n    public static final String DELAY_EXCHANGE_NAME = \"delay.queue.demo.business.exchange\";\n    public static final String DELAY_QUEUEC_NAME = \"delay.queue.demo.business.queuec\";\n    public static final String DELAY_QUEUEC_ROUTING_KEY = \"delay.queue.demo.business.queuec.routingkey\";\n    public static final String DEAD_LETTER_EXCHANGE = \"delay.queue.demo.deadletter.exchange\";\n    public static final String DEAD_LETTER_QUEUEC_ROUTING_KEY = \"delay.queue.demo.deadletter.delay_anytime.routingkey\";\n    public static final String DEAD_LETTER_QUEUEC_NAME = \"delay.queue.demo.deadletter.queuec\";\n\n    // 声明延时Exchange\n    @Bean(\"delayExchange\")\n    public DirectExchange delayExchange(){\n        return new DirectExchange(DELAY_EXCHANGE_NAME);\n    }\n\n    // 声明死信Exchange\n    @Bean(\"deadLetterExchange\")\n    public DirectExchange deadLetterExchange(){\n        return new DirectExchange(DEAD_LETTER_EXCHANGE);\n    }\n\n    // 声明延时队列C 不设置TTL\n    // 并绑定到对应的死信交换机\n    @Bean(\"delayQueueC\")\n    public Queue delayQueueC(){\n        Map<String, Object> args = new HashMap<>(3);\n        // x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(\"x-dead-letter-exchange\", DEAD_LETTER_EXCHANGE);\n        // x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(\"x-dead-letter-routing-key\", DEAD_LETTER_QUEUEC_ROUTING_KEY);\n        return QueueBuilder.durable(DELAY_QUEUEC_NAME).withArguments(args).build();\n    }\n\n    // 声明死信队列C 用于接收延时任意时长处理的消息\n    @Bean(\"deadLetterQueueC\")\n    public Queue deadLetterQueueC(){\n        return new Queue(DEAD_LETTER_QUEUEC_NAME);\n    }\n\n    // 声明延时列C绑定关系\n    @Bean\n    public Binding delayBindingC(@Qualifier(\"delayQueueC\") Queue queue,\n                                 @Qualifier(\"delayExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DELAY_QUEUEC_ROUTING_KEY);\n    }\n\n    // 声明死信队列C绑定关系\n    @Bean\n    public Binding deadLetterBindingC(@Qualifier(\"deadLetterQueueC\") Queue queue,\n                                      @Qualifier(\"deadLetterExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEC_ROUTING_KEY);\n    }\n}\n```\n\n增加一个死信队列C的消费者：\n\n```java\n@RabbitListener(queues = DEAD_LETTER_QUEUEC_NAME)\npublic void receiveC(Message message, Channel channel) throws IOException {\n    String msg = new String(message.getBody());\n    log.info(\"当前时间：{},死信队列C收到消息：{}\", new Date().toString(), msg);\n    channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n}\n```\n\n再次启动！然后访问：http://localhost:8080/rabbitmq/delayMsg?msg=testMsg1delayTime=5000 来生产消息，注意这里的单位是毫秒。\n\n```\n2019-07-28 16:45:07.033  INFO 31468 --- [nio-8080-exec-4] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:45:07 CST 2019,收到请求，msg:testMsg1,delayTime:5000\n2019-07-28 16:45:11.694  INFO 31468 --- [nio-8080-exec-5] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:45:11 CST 2019,收到请求，msg:testMsg2,delayTime:5000\n2019-07-28 16:45:12.048  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:45:12 CST 2019,死信队列C收到消息：testMsg1\n2019-07-28 16:45:16.709  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:45:16 CST 2019,死信队列C收到消息：testMsg2\n```\n\n看起来似乎没什么问题，但不要高兴的太早，在最开始的时候，就介绍过，如果使用在消息属性上设置TTL的方式，消息可能并不会按时“死亡“，因为RabbitMQ只会检查第一个消息是否过期，如果过期则丢到死信队列，索引如果第一个消息的延时时长很长，而第二个消息的延时时长很短，则第二个消息并不会优先得到执行。\n\n实验一下：\n\n```\n2019-07-28 16:49:02.957  INFO 31468 --- [nio-8080-exec-8] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:49:02 CST 2019,收到请求，msg:longDelayedMsg,delayTime:20000\n2019-07-28 16:49:10.671  INFO 31468 --- [nio-8080-exec-9] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:49:10 CST 2019,收到请求，msg:shortDelayedMsg,delayTime:2000\n2019-07-28 16:49:22.969  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:49:22 CST 2019,死信队列C收到消息：longDelayedMsg\n2019-07-28 16:49:22.970  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:49:22 CST 2019,死信队列C收到消息：shortDelayedMsg\n```\n\n我们先发了一个延时时长为20s的消息，然后发了一个延时时长为2s的消息，结果显示，第二个消息会在等第一个消息成为死信后才会“死亡“。\n\n## 八、利用RabbitMQ插件实现延迟队列\n\n上文中提到的问题，确实是一个硬伤，如果不能实现在消息粒度上添加TTL，并使其在设置的TTL时间及时死亡，就无法设计成一个通用的延时队列。\n\n那如何解决这个问题呢？不要慌，安装一个插件即可：https://www.rabbitmq.com/community-plugins.html ，下载rabbitmq_delayed_message_exchange插件，然后解压放置到RabbitMQ的插件目录。\n\n接下来，进入RabbitMQ的安装目录下的sbin目录，执行下面命令让该插件生效，然后重启RabbitMQ。\n\n```shell\nrabbitmq-plugins enable rabbitmq_delayed_message_exchange\n```\n\n然后，我们再声明几个Bean：\n\n```java\n@Configuration\npublic class DelayedRabbitMQConfig {\n    public static final String DELAYED_QUEUE_NAME = \"delay.queue.demo.delay.queue\";\n    public static final String DELAYED_EXCHANGE_NAME = \"delay.queue.demo.delay.exchange\";\n    public static final String DELAYED_ROUTING_KEY = \"delay.queue.demo.delay.routingkey\";\n\n    @Bean\n    public Queue immediateQueue() {\n        return new Queue(DELAYED_QUEUE_NAME);\n    }\n\n    @Bean\n    public CustomExchange customExchange() {\n        Map<String, Object> args = new HashMap<>();\n        args.put(\"x-delayed-type\", \"direct\");\n        return new CustomExchange(DELAYED_EXCHANGE_NAME, \"x-delayed-message\", true, false, args);\n    }\n\n    @Bean\n    public Binding bindingNotify(@Qualifier(\"immediateQueue\") Queue queue,\n                                 @Qualifier(\"customExchange\") CustomExchange customExchange) {\n        return BindingBuilder.bind(queue).to(customExchange).with(DELAYED_ROUTING_KEY).noargs();\n    }\n}\n```\n\ncontroller层再添加一个入口：\n\n```java \n@RequestMapping(\"delayMsg2\")\npublic void delayMsg2(String msg, Integer delayTime) {\n    log.info(\"当前时间：{},收到请求，msg:{},delayTime:{}\", new Date(), msg, delayTime);\n    sender.sendDelayMsg(msg, delayTime);\n}\n```\n\n消息生产者的代码也需要修改：\n\n```java\npublic void sendDelayMsg(String msg, Integer delayTime) {\n    rabbitTemplate.convertAndSend(DELAYED_EXCHANGE_NAME, DELAYED_ROUTING_KEY, msg, a ->{\n        a.getMessageProperties().setDelay(delayTime);\n        return a;\n    });\n}\n```\n\n最后，再创建一个消费者：\n\n```java\n@RabbitListener(queues = DELAYED_QUEUE_NAME)\npublic void receiveD(Message message, Channel channel) throws IOException {\n    String msg = new String(message.getBody());\n    log.info(\"当前时间：{},延时队列收到消息：{}\", new Date().toString(), msg);\n    channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n}\n```\n\n一切准备就绪，启动！然后分别访问以下链接：\n\n```url\nhttp://localhost:8080/rabbitmq/delayMsg2?msg=msg1&delayTime=20000\nhttp://localhost:8080/rabbitmq/delayMsg2?msg=msg2&delayTime=2000\n```\n\n日志如下：\n\n```java\n2019-07-28 17:28:13.729  INFO 25804 --- [nio-8080-exec-2] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 17:28:13 CST 2019,收到请求，msg:msg1,delayTime:20000\n2019-07-28 17:28:20.607  INFO 25804 --- [nio-8080-exec-1] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 17:28:20 CST 2019,收到请求，msg:msg2,delayTime:2000\n2019-07-28 17:28:22.624  INFO 25804 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 17:28:22 CST 2019,延时队列收到消息：msg2\n2019-07-28 17:28:33.751  INFO 25804 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 17:28:33 CST 2019,延时队列收到消息：msg1\n```\n\n第二个消息被先消费掉了，符合预期。至此，RabbitMQ实现延时队列的部分就完结了。\n\n## 九、总结\n\n延时队列在需要延时处理的场景下非常有用，使用RabbitMQ来实现延时队列可以很好的利用RabbitMQ的特性，如：消息可靠发送、消息可靠投递、死信队列来保障消息至少被消费一次以及未被正确处理的消息不会被丢弃。另外，通过RabbitMQ集群的特性，可以很好的解决单点故障问题，不会因为单个节点挂掉导致延时队列不可用或者消息丢失。\n\n当然，延时队列还有很多其它选择，比如利用Java的DelayQueu，利用Redis的zset，利用Quartz或者利用kafka的时间轮，这些方式各有特点，但就像炉石传说一般，这些知识就好比手里的卡牌，知道的越多，可以用的卡牌也就越多，遇到问题便能游刃有余，所以需要大量的知识储备和经验积累才能打造出更出色的卡牌组合，让自己解决问题的能力得到更好的提升。\n\n但另一方面，随着时间的流逝和阅历的增长，越来越感觉到自己的能力有限，无法独自面对纷繁复杂且多变的业务需求，在很多方面需要其他人的协助才能很好的完成任务。也知道闻道有先后，术业有专攻，不会再狂妄自大，觉得自己能把所有事情都搞定，也将重心慢慢转移到研究如何有效的进行团队合作上来，我相信一个高度协调的团队永远比一个人战斗要更有价值。\n\n花了一个周末的时间完成了这篇文章，文中所有的代码都上传到了[github](https://github.com/MFrank2016/delayed-queue-demo)如有需要可以自行查阅，希望能对你有帮助，如果有错误的地方，欢迎指正，也欢迎关注我的公众号进行留言交流。\n\n[//]: # (![TIM图片20190714173105.png]&#40;https://i.loli.net/2019/07/14/5d2af6692a8f432182.png&#41;)\n","source":"_posts/rabbitmq/rabbitmq-how-to-use-delay-queue.md","raw":"---\ntitle: 【RabbitMQ】一文带你搞定RabbitMQ延迟队列\ntags:\n  - RabbitMQ\n  - DelayQueue\ncategories:\n  - 编程\ntoc: true\ntop: true\ncover: true\ndate: 2020-05-04 01:00:50\n---\n\n本文口味：鱼香肉丝   预计阅读：10分钟\n\n## 一、说明\n\n在上一篇中，介绍了RabbitMQ中的死信队列是什么，何时使用以及如何使用RabbitMQ的死信队列。相信通过上一篇的学习，对于死信队列已经有了更多的了解，这一篇的内容也跟死信队列息息相关，如果你还不了解死信队列，那么建议你先进行上一篇文章的阅读。\n\n这一篇里，我们将继续介绍RabbitMQ的高级特性，通过本篇的学习，你将收获：\n1. 什么是延时队列\n2. 延时队列使用场景\n3. RabbitMQ中的TTL\n4. 如何利用RabbitMQ来实现延时队列\n\n## 二、本文大纲\n\n以下是本文大纲：\n\n![1.png](https://i.loli.net/2019/07/28/5d3d74d99699d43032.png)\n\n本文阅读前，需要对RabbitMQ以及死信队列有一个简单的了解。\n\n## 三、什么是延时队列\n\n`延时队列`，首先，它是一种队列，队列意味着内部的元素是`有序`的，元素出队和入队是有方向性的，元素从一端进入，从另一端取出。\n\n其次，`延时队列`，最重要的特性就体现在它的`延时`属性上，跟普通的队列不一样的是，`普通队列中的元素总是等着希望被早点取出处理，而延时队列中的元素则是希望被在指定时间得到取出和处理`，所以延时队列中的元素是都是带时间属性的，通常来说是需要被处理的消息或者任务。\n\n简单来说，延时队列就是用来存放需要在指定时间被处理的元素的队列。\n\n## 四、延时队列使用场景\n\n那么什么时候需要用延时队列呢？考虑一下以下场景：\n\n1. 订单在十分钟之内未支付则自动取消。\n2. 新创建的店铺，如果在十天内都没有上传过商品，则自动发送消息提醒。\n3. 账单在一周内未支付，则自动结算。\n4. 用户注册成功后，如果三天内没有登陆则进行短信提醒。\n5. 用户发起退款，如果三天内没有得到处理则通知相关运营人员。\n6. 预定会议后，需要在预定的时间点前十分钟通知各个与会人员参加会议。\n\n这些场景都有一个特点，需要在某个事件发生之后或者之前的指定时间点完成某一项任务，如：发生订单生成事件，在十分钟之后检查该订单支付状态，然后将未支付的订单进行关闭；发生店铺创建事件，十天后检查该店铺上新商品数，然后通知上新数为0的商户；发生账单生成事件，检查账单支付状态，然后自动结算未支付的账单；发生新用户注册事件，三天后检查新注册用户的活动数据，然后通知没有任何活动记录的用户；发生退款事件，在三天之后检查该订单是否已被处理，如仍未被处理，则发送消息给相关运营人员；发生预定会议事件，判断离会议开始是否只有十分钟了，如果是，则通知各个与会人员。\n\n看起来似乎使用定时任务，一直轮询数据，每秒查一次，取出需要被处理的数据，然后处理不就完事了吗？如果数据量比较少，确实可以这样做，比如：对于“如果账单一周内未支付则进行自动结算”这样的需求，如果对于时间不是严格限制，而是宽松意义上的一周，那么每天晚上跑个定时任务检查一下所有未支付的账单，确实也是一个可行的方案。但对于数据量比较大，并且时效性较强的场景，如：“订单十分钟内未支付则关闭“，短期内未支付的订单数据可能会有很多，活动期间甚至会达到百万甚至千万级别，对这么庞大的数据量仍旧使用轮询的方式显然是不可取的，很可能在一秒内无法完成所有订单的检查，同时会给数据库带来很大压力，无法满足业务要求而且性能低下。\n\n更重要的一点是，不！优！雅！\n\n没错，作为一名有追求的程序员，始终应该追求更优雅的架构和更优雅的代码风格，写代码要像写诗一样优美。【滑稽】\n\n这时候，延时队列就可以闪亮登场了，以上场景，正是延时队列的用武之地。\n\n既然`延时队列`可以解决很多特定场景下，带时间属性的任务需求，那么如何构造一个延时队列呢？接下来，本文将介绍如何用RabbitMQ来实现延时队列。\n\n## 五、RabbitMQ中的TTL\n\n在介绍延时队列之前，还需要先介绍一下RabbitMQ中的一个高级特性——`TTL（Time To Live）`。\n\n`TTL`是什么呢？`TTL`是RabbitMQ中一个消息或者队列的属性，表明`一条消息或者该队列中的所有消息的最大存活时间`，单位是毫秒。换句话说，如果一条消息设置了TTL属性或者进入了设置TTL属性的队列，那么这条消息如果在TTL设置的时间内没有被消费，则会成为“死信”（至于什么是死信，请翻看上一篇）。如果同时配置了队列的TTL和消息的TTL，那么较小的那个值将会被使用。\n\n那么，如何设置这个TTL值呢？有两种方式，第一种是在创建队列的时候设置队列的“x-message-ttl”属性，如下：\n\n```java\nMap<String, Object> args = new HashMap<String, Object>();\nargs.put(\"x-message-ttl\", 6000);\nchannel.queueDeclare(queueName, durable, exclusive, autoDelete, args);\n```\n\n这样所有被投递到该队列的消息都最多不会存活超过6s。\n\n另一种方式便是针对每条消息设置TTL，代码如下：\n\n```java\nAMQP.BasicProperties.Builder builder = new AMQP.BasicProperties.Builder();\nbuilder.expiration(\"6000\");\nAMQP.BasicProperties properties = builder.build();\nchannel.basicPublish(exchangeName, routingKey, mandatory, properties, \"msg body\".getBytes());\n```\n\n这样这条消息的过期时间也被设置成了6s。\n\n但这两种方式是有区别的，**如果设置了队列的TTL属性，那么一旦消息过期，就会被队列丢弃，而第二种方式，消息即使过期，也不一定会被马上丢弃，因为消息是否过期是在即将投递到消费者之前判定的，如果当前队列有严重的消息积压情况，则已过期的消息也许还能存活较长时间。**\n\n另外，还需要注意的一点是，如果不设置TTL，表示消息永远不会过期，如果将TTL设置为0，则表示除非此时可以直接投递该消息到消费者，否则该消息将会被丢弃。\n\n## 六、如何利用RabbitMQ实现延时队列\n\n前一篇里介绍了如果设置死信队列，前文中又介绍了TTL，至此，利用RabbitMQ实现延时队列的两大要素已经集齐，接下来只需要将它们进行调和，再加入一点点调味料，延时队列就可以新鲜出炉了。\n\n想想看，`延时队列`，不就是想要消息延迟多久被处理吗，TTL则刚好能让消息在延迟多久之后成为死信，另一方面，成为死信的消息都会被投递到死信队列里，这样只需要消费者一直消费死信队列里的消息就万事大吉了，因为里面的消息都是希望被立即处理的消息。\n\n从下图可以大致看出消息的流向：\n\n![23.png](https://i.loli.net/2019/07/28/5d3d743143ecc85643.png)\n\n生产者生产一条延时消息，根据需要延时时间的不同，利用不同的routingkey将消息路由到不同的延时队列，每个队列都设置了不同的TTL属性，并绑定在同一个死信交换机中，消息过期后，根据routingkey的不同，又会被路由到不同的死信队列中，消费者只需要监听对应的死信队列进行处理即可。\n\n下面来看代码：\n\n先声明交换机、队列以及他们的绑定关系：\n\n```java\n@Configuration\npublic class RabbitMQConfig {\n\n    public static final String DELAY_EXCHANGE_NAME = \"delay.queue.demo.business.exchange\";\n    public static final String DELAY_QUEUEA_NAME = \"delay.queue.demo.business.queuea\";\n    public static final String DELAY_QUEUEA_ROUTING_KEY = \"delay.queue.demo.business.queuea.routingkey\";\n    public static final String DELAY_QUEUEB_ROUTING_KEY = \"delay.queue.demo.business.queueb.routingkey\";\n    public static final String DEAD_LETTER_EXCHANGE = \"delay.queue.demo.deadletter.exchange\";\n    public static final String DEAD_LETTER_QUEUEA_ROUTING_KEY = \"delay.queue.demo.deadletter.delay_10s.routingkey\";\n    public static final String DEAD_LETTER_QUEUEB_ROUTING_KEY = \"delay.queue.demo.deadletter.delay_60s.routingkey\";\n    public static final String DEAD_LETTER_QUEUEA_NAME = \"delay.queue.demo.deadletter.queuea\";\n    public static final String DEAD_LETTER_QUEUEB_NAME = \"delay.queue.demo.deadletter.queueb\";\n\n    // 声明延时Exchange\n    @Bean(\"delayExchange\")\n    public DirectExchange delayExchange(){\n        return new DirectExchange(DELAY_EXCHANGE_NAME);\n    }\n\n    // 声明死信Exchange\n    @Bean(\"deadLetterExchange\")\n    public DirectExchange deadLetterExchange(){\n        return new DirectExchange(DEAD_LETTER_EXCHANGE);\n    }\n\n    // 声明延时队列A 延时10s\n    // 并绑定到对应的死信交换机\n    @Bean(\"delayQueueA\")\n    public Queue delayQueueA(){\n        Map<String, Object> args = new HashMap<>(2);\n        // x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(\"x-dead-letter-exchange\", DEAD_LETTER_EXCHANGE);\n        // x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(\"x-dead-letter-routing-key\", DEAD_LETTER_QUEUEA_ROUTING_KEY);\n        // x-message-ttl  声明队列的TTL\n        args.put(\"x-message-ttl\", 6000);\n        return QueueBuilder.durable(DEAD_LETTER_QUEUEA_NAME).withArguments(args).build();\n    }\n\n    // 声明延时队列B 延时 60s\n    // 并绑定到对应的死信交换机\n    @Bean(\"delayQueueB\")\n    public Queue delayQueueB(){\n        Map<String, Object> args = new HashMap<>(2);\n        // x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(\"x-dead-letter-exchange\", DEAD_LETTER_EXCHANGE);\n        // x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(\"x-dead-letter-routing-key\", DEAD_LETTER_QUEUEB_ROUTING_KEY);\n        // x-message-ttl  声明队列的TTL\n        args.put(\"x-message-ttl\", 60000);\n        return QueueBuilder.durable(DEAD_LETTER_QUEUEB_NAME).withArguments(args).build();\n    }\n\n    // 声明死信队列A 用于接收延时10s处理的消息\n    @Bean(\"deadLetterQueueA\")\n    public Queue deadLetterQueueA(){\n        return new Queue(DEAD_LETTER_QUEUEA_NAME);\n    }\n\n    // 声明死信队列B 用于接收延时60s处理的消息\n    @Bean(\"deadLetterQueueB\")\n    public Queue deadLetterQueueB(){\n        return new Queue(DEAD_LETTER_QUEUEB_NAME);\n    }\n\n    // 声明延时队列A绑定关系\n    @Bean\n    public Binding delayBindingA(@Qualifier(\"delayQueueA\") Queue queue,\n                                    @Qualifier(\"delayExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DELAY_QUEUEA_ROUTING_KEY);\n    }\n\n    // 声明业务队列B绑定关系\n    @Bean\n    public Binding delayBindingB(@Qualifier(\"delayQueueB\") Queue queue,\n                                    @Qualifier(\"delayExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DELAY_QUEUEB_ROUTING_KEY);\n    }\n\n    // 声明死信队列A绑定关系\n    @Bean\n    public Binding deadLetterBindingA(@Qualifier(\"deadLetterQueueA\") Queue queue,\n                                    @Qualifier(\"deadLetterExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEA_ROUTING_KEY);\n    }\n\n    // 声明死信队列B绑定关系\n    @Bean\n    public Binding deadLetterBindingB(@Qualifier(\"deadLetterQueueB\") Queue queue,\n                                      @Qualifier(\"deadLetterExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEB_ROUTING_KEY);\n    }\n}\n```\n\n接下来，创建两个消费者，分别对两个死信队列的消息进行消费：\n\n```java\n@Slf4j\n@Component\npublic class DeadLetterQueueConsumer {\n\n    @RabbitListener(queues = DEAD_LETTER_QUEUEA_NAME)\n    public void receiveA(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(\"当前时间：{},死信队列A收到消息：{}\", new Date().toString(), msg);\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n\n    @RabbitListener(queues = DEAD_LETTER_QUEUEB_NAME)\n    public void receiveB(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(\"当前时间：{},死信队列B收到消息：{}\", new Date().toString(), msg);\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n}\n```\n\n然后是消息的生产者：\n\n```java\n@Component\npublic class DelayMessageSender {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void sendMsg(String msg, DelayTypeEnum type){\n        switch (type){\n            case DELAY_10s:\n                rabbitTemplate.convertAndSend(DELAY_EXCHANGE_NAME, DELAY_QUEUEA_ROUTING_KEY, msg);\n                break;\n            case DELAY_60s:\n                rabbitTemplate.convertAndSend(DELAY_EXCHANGE_NAME, DELAY_QUEUEB_ROUTING_KEY, msg);\n                break;\n        }\n    }\n}\n```\n\n接下来，我们暴露一个web接口来生产消息：\n\n```java\n@Slf4j\n@RequestMapping(\"rabbitmq\")\n@RestController\npublic class RabbitMQMsgController {\n\n    @Autowired\n    private DelayMessageSender sender;\n\n    @RequestMapping(\"sendmsg\")\n    public void sendMsg(String msg, Integer delayType){\n        log.info(\"当前时间：{},收到请求，msg:{},delayType:{}\", new Date(), msg, delayType);\n        sender.sendMsg(msg, Objects.requireNonNull(DelayTypeEnum.getDelayTypeEnumByValue(delayType)));\n    }\n}\n```\n\n准备就绪，启动！\n\n打开rabbitMQ的[管理后台](http://localhost:15672)，可以看到我们刚才创建的交换机和队列信息：\n\n![2.png](https://i.loli.net/2019/07/28/5d3d54e15534398514.png)\n\n![4.png](https://i.loli.net/2019/07/28/5d3d54e17df8183993.png)\n\n![3.png](https://i.loli.net/2019/07/28/5d3d54e16952546955.png)\n\n接下来，我们来发送几条消息，http://localhost:8080/rabbitmq/sendmsg?msg=testMsg1&delayType=1 http://localhost:8080/rabbitmq/sendmsg?msg=testMsg2&delayType=2\n\n日志如下：\n\n```powershell\n2019-07-28 16:02:19.813  INFO 3860 --- [nio-8080-exec-9] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:02:19 CST 2019,收到请求，msg:testMsg1,delayType:1\n2019-07-28 16:02:19.815  INFO 3860 --- [nio-8080-exec-9] .l.DirectReplyToMessageListenerContainer : SimpleConsumer [queue=amq.rabbitmq.reply-to, consumerTag=amq.ctag-o-qPpkWIkRm73DIrOIVhig identity=766339] started\n2019-07-28 16:02:25.829  INFO 3860 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:02:25 CST 2019,死信队列A收到消息：testMsg1\n2019-07-28 16:02:41.326  INFO 3860 --- [nio-8080-exec-1] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:02:41 CST 2019,收到请求，msg:testMsg2,delayType:2\n2019-07-28 16:03:41.329  INFO 3860 --- [ntContainer#0-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:03:41 CST 2019,死信队列B收到消息：testMsg2\n```\n\n第一条消息在6s后变成了死信消息，然后被消费者消费掉，第二条消息在60s之后变成了死信消息，然后被消费掉，这样，一个还算ok的延时队列就打造完成了。\n\n不过，等等，如果这样使用的话，岂不是每增加一个新的时间需求，就要新增一个队列，这里只有6s和60s两个时间选项，如果需要一个小时后处理，那么就需要增加TTL为一个小时的队列，如果是预定会议室然后提前通知这样的场景，岂不是要增加无数个队列才能满足需求？？\n\n嗯，仔细想想，事情并不简单。\n\n## 七、RabbitMQ延时队列优化\n\n显然，需要一种更通用的方案才能满足需求，那么就只能将TTL设置在消息属性里了。我们来试一试。\n\n增加一个延时队列，用于接收设置为任意延时时长的消息，增加一个相应的死信队列和routingkey：\n\n```java\n@Configuration\npublic class RabbitMQConfig {\n\n    public static final String DELAY_EXCHANGE_NAME = \"delay.queue.demo.business.exchange\";\n    public static final String DELAY_QUEUEC_NAME = \"delay.queue.demo.business.queuec\";\n    public static final String DELAY_QUEUEC_ROUTING_KEY = \"delay.queue.demo.business.queuec.routingkey\";\n    public static final String DEAD_LETTER_EXCHANGE = \"delay.queue.demo.deadletter.exchange\";\n    public static final String DEAD_LETTER_QUEUEC_ROUTING_KEY = \"delay.queue.demo.deadletter.delay_anytime.routingkey\";\n    public static final String DEAD_LETTER_QUEUEC_NAME = \"delay.queue.demo.deadletter.queuec\";\n\n    // 声明延时Exchange\n    @Bean(\"delayExchange\")\n    public DirectExchange delayExchange(){\n        return new DirectExchange(DELAY_EXCHANGE_NAME);\n    }\n\n    // 声明死信Exchange\n    @Bean(\"deadLetterExchange\")\n    public DirectExchange deadLetterExchange(){\n        return new DirectExchange(DEAD_LETTER_EXCHANGE);\n    }\n\n    // 声明延时队列C 不设置TTL\n    // 并绑定到对应的死信交换机\n    @Bean(\"delayQueueC\")\n    public Queue delayQueueC(){\n        Map<String, Object> args = new HashMap<>(3);\n        // x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(\"x-dead-letter-exchange\", DEAD_LETTER_EXCHANGE);\n        // x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(\"x-dead-letter-routing-key\", DEAD_LETTER_QUEUEC_ROUTING_KEY);\n        return QueueBuilder.durable(DELAY_QUEUEC_NAME).withArguments(args).build();\n    }\n\n    // 声明死信队列C 用于接收延时任意时长处理的消息\n    @Bean(\"deadLetterQueueC\")\n    public Queue deadLetterQueueC(){\n        return new Queue(DEAD_LETTER_QUEUEC_NAME);\n    }\n\n    // 声明延时列C绑定关系\n    @Bean\n    public Binding delayBindingC(@Qualifier(\"delayQueueC\") Queue queue,\n                                 @Qualifier(\"delayExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DELAY_QUEUEC_ROUTING_KEY);\n    }\n\n    // 声明死信队列C绑定关系\n    @Bean\n    public Binding deadLetterBindingC(@Qualifier(\"deadLetterQueueC\") Queue queue,\n                                      @Qualifier(\"deadLetterExchange\") DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEC_ROUTING_KEY);\n    }\n}\n```\n\n增加一个死信队列C的消费者：\n\n```java\n@RabbitListener(queues = DEAD_LETTER_QUEUEC_NAME)\npublic void receiveC(Message message, Channel channel) throws IOException {\n    String msg = new String(message.getBody());\n    log.info(\"当前时间：{},死信队列C收到消息：{}\", new Date().toString(), msg);\n    channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n}\n```\n\n再次启动！然后访问：http://localhost:8080/rabbitmq/delayMsg?msg=testMsg1delayTime=5000 来生产消息，注意这里的单位是毫秒。\n\n```\n2019-07-28 16:45:07.033  INFO 31468 --- [nio-8080-exec-4] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:45:07 CST 2019,收到请求，msg:testMsg1,delayTime:5000\n2019-07-28 16:45:11.694  INFO 31468 --- [nio-8080-exec-5] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:45:11 CST 2019,收到请求，msg:testMsg2,delayTime:5000\n2019-07-28 16:45:12.048  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:45:12 CST 2019,死信队列C收到消息：testMsg1\n2019-07-28 16:45:16.709  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:45:16 CST 2019,死信队列C收到消息：testMsg2\n```\n\n看起来似乎没什么问题，但不要高兴的太早，在最开始的时候，就介绍过，如果使用在消息属性上设置TTL的方式，消息可能并不会按时“死亡“，因为RabbitMQ只会检查第一个消息是否过期，如果过期则丢到死信队列，索引如果第一个消息的延时时长很长，而第二个消息的延时时长很短，则第二个消息并不会优先得到执行。\n\n实验一下：\n\n```\n2019-07-28 16:49:02.957  INFO 31468 --- [nio-8080-exec-8] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:49:02 CST 2019,收到请求，msg:longDelayedMsg,delayTime:20000\n2019-07-28 16:49:10.671  INFO 31468 --- [nio-8080-exec-9] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:49:10 CST 2019,收到请求，msg:shortDelayedMsg,delayTime:2000\n2019-07-28 16:49:22.969  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:49:22 CST 2019,死信队列C收到消息：longDelayedMsg\n2019-07-28 16:49:22.970  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:49:22 CST 2019,死信队列C收到消息：shortDelayedMsg\n```\n\n我们先发了一个延时时长为20s的消息，然后发了一个延时时长为2s的消息，结果显示，第二个消息会在等第一个消息成为死信后才会“死亡“。\n\n## 八、利用RabbitMQ插件实现延迟队列\n\n上文中提到的问题，确实是一个硬伤，如果不能实现在消息粒度上添加TTL，并使其在设置的TTL时间及时死亡，就无法设计成一个通用的延时队列。\n\n那如何解决这个问题呢？不要慌，安装一个插件即可：https://www.rabbitmq.com/community-plugins.html ，下载rabbitmq_delayed_message_exchange插件，然后解压放置到RabbitMQ的插件目录。\n\n接下来，进入RabbitMQ的安装目录下的sbin目录，执行下面命令让该插件生效，然后重启RabbitMQ。\n\n```shell\nrabbitmq-plugins enable rabbitmq_delayed_message_exchange\n```\n\n然后，我们再声明几个Bean：\n\n```java\n@Configuration\npublic class DelayedRabbitMQConfig {\n    public static final String DELAYED_QUEUE_NAME = \"delay.queue.demo.delay.queue\";\n    public static final String DELAYED_EXCHANGE_NAME = \"delay.queue.demo.delay.exchange\";\n    public static final String DELAYED_ROUTING_KEY = \"delay.queue.demo.delay.routingkey\";\n\n    @Bean\n    public Queue immediateQueue() {\n        return new Queue(DELAYED_QUEUE_NAME);\n    }\n\n    @Bean\n    public CustomExchange customExchange() {\n        Map<String, Object> args = new HashMap<>();\n        args.put(\"x-delayed-type\", \"direct\");\n        return new CustomExchange(DELAYED_EXCHANGE_NAME, \"x-delayed-message\", true, false, args);\n    }\n\n    @Bean\n    public Binding bindingNotify(@Qualifier(\"immediateQueue\") Queue queue,\n                                 @Qualifier(\"customExchange\") CustomExchange customExchange) {\n        return BindingBuilder.bind(queue).to(customExchange).with(DELAYED_ROUTING_KEY).noargs();\n    }\n}\n```\n\ncontroller层再添加一个入口：\n\n```java \n@RequestMapping(\"delayMsg2\")\npublic void delayMsg2(String msg, Integer delayTime) {\n    log.info(\"当前时间：{},收到请求，msg:{},delayTime:{}\", new Date(), msg, delayTime);\n    sender.sendDelayMsg(msg, delayTime);\n}\n```\n\n消息生产者的代码也需要修改：\n\n```java\npublic void sendDelayMsg(String msg, Integer delayTime) {\n    rabbitTemplate.convertAndSend(DELAYED_EXCHANGE_NAME, DELAYED_ROUTING_KEY, msg, a ->{\n        a.getMessageProperties().setDelay(delayTime);\n        return a;\n    });\n}\n```\n\n最后，再创建一个消费者：\n\n```java\n@RabbitListener(queues = DELAYED_QUEUE_NAME)\npublic void receiveD(Message message, Channel channel) throws IOException {\n    String msg = new String(message.getBody());\n    log.info(\"当前时间：{},延时队列收到消息：{}\", new Date().toString(), msg);\n    channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n}\n```\n\n一切准备就绪，启动！然后分别访问以下链接：\n\n```url\nhttp://localhost:8080/rabbitmq/delayMsg2?msg=msg1&delayTime=20000\nhttp://localhost:8080/rabbitmq/delayMsg2?msg=msg2&delayTime=2000\n```\n\n日志如下：\n\n```java\n2019-07-28 17:28:13.729  INFO 25804 --- [nio-8080-exec-2] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 17:28:13 CST 2019,收到请求，msg:msg1,delayTime:20000\n2019-07-28 17:28:20.607  INFO 25804 --- [nio-8080-exec-1] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 17:28:20 CST 2019,收到请求，msg:msg2,delayTime:2000\n2019-07-28 17:28:22.624  INFO 25804 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 17:28:22 CST 2019,延时队列收到消息：msg2\n2019-07-28 17:28:33.751  INFO 25804 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 17:28:33 CST 2019,延时队列收到消息：msg1\n```\n\n第二个消息被先消费掉了，符合预期。至此，RabbitMQ实现延时队列的部分就完结了。\n\n## 九、总结\n\n延时队列在需要延时处理的场景下非常有用，使用RabbitMQ来实现延时队列可以很好的利用RabbitMQ的特性，如：消息可靠发送、消息可靠投递、死信队列来保障消息至少被消费一次以及未被正确处理的消息不会被丢弃。另外，通过RabbitMQ集群的特性，可以很好的解决单点故障问题，不会因为单个节点挂掉导致延时队列不可用或者消息丢失。\n\n当然，延时队列还有很多其它选择，比如利用Java的DelayQueu，利用Redis的zset，利用Quartz或者利用kafka的时间轮，这些方式各有特点，但就像炉石传说一般，这些知识就好比手里的卡牌，知道的越多，可以用的卡牌也就越多，遇到问题便能游刃有余，所以需要大量的知识储备和经验积累才能打造出更出色的卡牌组合，让自己解决问题的能力得到更好的提升。\n\n但另一方面，随着时间的流逝和阅历的增长，越来越感觉到自己的能力有限，无法独自面对纷繁复杂且多变的业务需求，在很多方面需要其他人的协助才能很好的完成任务。也知道闻道有先后，术业有专攻，不会再狂妄自大，觉得自己能把所有事情都搞定，也将重心慢慢转移到研究如何有效的进行团队合作上来，我相信一个高度协调的团队永远比一个人战斗要更有价值。\n\n花了一个周末的时间完成了这篇文章，文中所有的代码都上传到了[github](https://github.com/MFrank2016/delayed-queue-demo)如有需要可以自行查阅，希望能对你有帮助，如果有错误的地方，欢迎指正，也欢迎关注我的公众号进行留言交流。\n\n[//]: # (![TIM图片20190714173105.png]&#40;https://i.loli.net/2019/07/14/5d2af6692a8f432182.png&#41;)\n","slug":"rabbitmq/rabbitmq-how-to-use-delay-queue","published":1,"updated":"2020-05-03T17:00:50.000Z","_id":"cl70rsfbo001f5ohucfcngr87","comments":1,"layout":"post","photos":[],"link":"","content":"<p>本文口味：鱼香肉丝   预计阅读：10分钟</p>\n<h2 id=\"一、说明\"><a href=\"#一、说明\" class=\"headerlink\" title=\"一、说明\"></a>一、说明</h2><p>在上一篇中，介绍了RabbitMQ中的死信队列是什么，何时使用以及如何使用RabbitMQ的死信队列。相信通过上一篇的学习，对于死信队列已经有了更多的了解，这一篇的内容也跟死信队列息息相关，如果你还不了解死信队列，那么建议你先进行上一篇文章的阅读。</p>\n<p>这一篇里，我们将继续介绍RabbitMQ的高级特性，通过本篇的学习，你将收获：</p>\n<ol>\n<li>什么是延时队列</li>\n<li>延时队列使用场景</li>\n<li>RabbitMQ中的TTL</li>\n<li>如何利用RabbitMQ来实现延时队列</li>\n</ol>\n<h2 id=\"二、本文大纲\"><a href=\"#二、本文大纲\" class=\"headerlink\" title=\"二、本文大纲\"></a>二、本文大纲</h2><p>以下是本文大纲：</p>\n<p><img src=\"https://i.loli.net/2019/07/28/5d3d74d99699d43032.png\" alt=\"1.png\"></p>\n<p>本文阅读前，需要对RabbitMQ以及死信队列有一个简单的了解。</p>\n<h2 id=\"三、什么是延时队列\"><a href=\"#三、什么是延时队列\" class=\"headerlink\" title=\"三、什么是延时队列\"></a>三、什么是延时队列</h2><p><code>延时队列</code>，首先，它是一种队列，队列意味着内部的元素是<code>有序</code>的，元素出队和入队是有方向性的，元素从一端进入，从另一端取出。</p>\n<p>其次，<code>延时队列</code>，最重要的特性就体现在它的<code>延时</code>属性上，跟普通的队列不一样的是，<code>普通队列中的元素总是等着希望被早点取出处理，而延时队列中的元素则是希望被在指定时间得到取出和处理</code>，所以延时队列中的元素是都是带时间属性的，通常来说是需要被处理的消息或者任务。</p>\n<p>简单来说，延时队列就是用来存放需要在指定时间被处理的元素的队列。</p>\n<h2 id=\"四、延时队列使用场景\"><a href=\"#四、延时队列使用场景\" class=\"headerlink\" title=\"四、延时队列使用场景\"></a>四、延时队列使用场景</h2><p>那么什么时候需要用延时队列呢？考虑一下以下场景：</p>\n<ol>\n<li>订单在十分钟之内未支付则自动取消。</li>\n<li>新创建的店铺，如果在十天内都没有上传过商品，则自动发送消息提醒。</li>\n<li>账单在一周内未支付，则自动结算。</li>\n<li>用户注册成功后，如果三天内没有登陆则进行短信提醒。</li>\n<li>用户发起退款，如果三天内没有得到处理则通知相关运营人员。</li>\n<li>预定会议后，需要在预定的时间点前十分钟通知各个与会人员参加会议。</li>\n</ol>\n<p>这些场景都有一个特点，需要在某个事件发生之后或者之前的指定时间点完成某一项任务，如：发生订单生成事件，在十分钟之后检查该订单支付状态，然后将未支付的订单进行关闭；发生店铺创建事件，十天后检查该店铺上新商品数，然后通知上新数为0的商户；发生账单生成事件，检查账单支付状态，然后自动结算未支付的账单；发生新用户注册事件，三天后检查新注册用户的活动数据，然后通知没有任何活动记录的用户；发生退款事件，在三天之后检查该订单是否已被处理，如仍未被处理，则发送消息给相关运营人员；发生预定会议事件，判断离会议开始是否只有十分钟了，如果是，则通知各个与会人员。</p>\n<p>看起来似乎使用定时任务，一直轮询数据，每秒查一次，取出需要被处理的数据，然后处理不就完事了吗？如果数据量比较少，确实可以这样做，比如：对于“如果账单一周内未支付则进行自动结算”这样的需求，如果对于时间不是严格限制，而是宽松意义上的一周，那么每天晚上跑个定时任务检查一下所有未支付的账单，确实也是一个可行的方案。但对于数据量比较大，并且时效性较强的场景，如：“订单十分钟内未支付则关闭“，短期内未支付的订单数据可能会有很多，活动期间甚至会达到百万甚至千万级别，对这么庞大的数据量仍旧使用轮询的方式显然是不可取的，很可能在一秒内无法完成所有订单的检查，同时会给数据库带来很大压力，无法满足业务要求而且性能低下。</p>\n<p>更重要的一点是，不！优！雅！</p>\n<p>没错，作为一名有追求的程序员，始终应该追求更优雅的架构和更优雅的代码风格，写代码要像写诗一样优美。【滑稽】</p>\n<p>这时候，延时队列就可以闪亮登场了，以上场景，正是延时队列的用武之地。</p>\n<p>既然<code>延时队列</code>可以解决很多特定场景下，带时间属性的任务需求，那么如何构造一个延时队列呢？接下来，本文将介绍如何用RabbitMQ来实现延时队列。</p>\n<h2 id=\"五、RabbitMQ中的TTL\"><a href=\"#五、RabbitMQ中的TTL\" class=\"headerlink\" title=\"五、RabbitMQ中的TTL\"></a>五、RabbitMQ中的TTL</h2><p>在介绍延时队列之前，还需要先介绍一下RabbitMQ中的一个高级特性——<code>TTL（Time To Live）</code>。</p>\n<p><code>TTL</code>是什么呢？<code>TTL</code>是RabbitMQ中一个消息或者队列的属性，表明<code>一条消息或者该队列中的所有消息的最大存活时间</code>，单位是毫秒。换句话说，如果一条消息设置了TTL属性或者进入了设置TTL属性的队列，那么这条消息如果在TTL设置的时间内没有被消费，则会成为“死信”（至于什么是死信，请翻看上一篇）。如果同时配置了队列的TTL和消息的TTL，那么较小的那个值将会被使用。</p>\n<p>那么，如何设置这个TTL值呢？有两种方式，第一种是在创建队列的时候设置队列的“x-message-ttl”属性，如下：</p>\n<pre class=\" language-java\"><code class=\"language-java\">Map<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Object<span class=\"token operator\">></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Object<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nargs<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-message-ttl\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nchannel<span class=\"token punctuation\">.</span><span class=\"token function\">queueDeclare</span><span class=\"token punctuation\">(</span>queueName<span class=\"token punctuation\">,</span> durable<span class=\"token punctuation\">,</span> exclusive<span class=\"token punctuation\">,</span> autoDelete<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>这样所有被投递到该队列的消息都最多不会存活超过6s。</p>\n<p>另一种方式便是针对每条消息设置TTL，代码如下：</p>\n<pre class=\" language-java\"><code class=\"language-java\">AMQP<span class=\"token punctuation\">.</span>BasicProperties<span class=\"token punctuation\">.</span>Builder builder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AMQP<span class=\"token punctuation\">.</span>BasicProperties<span class=\"token punctuation\">.</span>Builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbuilder<span class=\"token punctuation\">.</span><span class=\"token function\">expiration</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"6000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nAMQP<span class=\"token punctuation\">.</span>BasicProperties properties <span class=\"token operator\">=</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nchannel<span class=\"token punctuation\">.</span><span class=\"token function\">basicPublish</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> routingKey<span class=\"token punctuation\">,</span> mandatory<span class=\"token punctuation\">,</span> properties<span class=\"token punctuation\">,</span> <span class=\"token string\">\"msg body\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>这样这条消息的过期时间也被设置成了6s。</p>\n<p>但这两种方式是有区别的，<strong>如果设置了队列的TTL属性，那么一旦消息过期，就会被队列丢弃，而第二种方式，消息即使过期，也不一定会被马上丢弃，因为消息是否过期是在即将投递到消费者之前判定的，如果当前队列有严重的消息积压情况，则已过期的消息也许还能存活较长时间。</strong></p>\n<p>另外，还需要注意的一点是，如果不设置TTL，表示消息永远不会过期，如果将TTL设置为0，则表示除非此时可以直接投递该消息到消费者，否则该消息将会被丢弃。</p>\n<h2 id=\"六、如何利用RabbitMQ实现延时队列\"><a href=\"#六、如何利用RabbitMQ实现延时队列\" class=\"headerlink\" title=\"六、如何利用RabbitMQ实现延时队列\"></a>六、如何利用RabbitMQ实现延时队列</h2><p>前一篇里介绍了如果设置死信队列，前文中又介绍了TTL，至此，利用RabbitMQ实现延时队列的两大要素已经集齐，接下来只需要将它们进行调和，再加入一点点调味料，延时队列就可以新鲜出炉了。</p>\n<p>想想看，<code>延时队列</code>，不就是想要消息延迟多久被处理吗，TTL则刚好能让消息在延迟多久之后成为死信，另一方面，成为死信的消息都会被投递到死信队列里，这样只需要消费者一直消费死信队列里的消息就万事大吉了，因为里面的消息都是希望被立即处理的消息。</p>\n<p>从下图可以大致看出消息的流向：</p>\n<p><img src=\"https://i.loli.net/2019/07/28/5d3d743143ecc85643.png\" alt=\"23.png\"></p>\n<p>生产者生产一条延时消息，根据需要延时时间的不同，利用不同的routingkey将消息路由到不同的延时队列，每个队列都设置了不同的TTL属性，并绑定在同一个死信交换机中，消息过期后，根据routingkey的不同，又会被路由到不同的死信队列中，消费者只需要监听对应的死信队列进行处理即可。</p>\n<p>下面来看代码：</p>\n<p>先声明交换机、队列以及他们的绑定关系：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RabbitMQConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DELAY_EXCHANGE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.business.exchange\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DELAY_QUEUEA_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.business.queuea\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DELAY_QUEUEA_ROUTING_KEY <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.business.queuea.routingkey\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DELAY_QUEUEB_ROUTING_KEY <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.business.queueb.routingkey\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_EXCHANGE <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.deadletter.exchange\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_QUEUEA_ROUTING_KEY <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.deadletter.delay_10s.routingkey\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_QUEUEB_ROUTING_KEY <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.deadletter.delay_60s.routingkey\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_QUEUEA_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.deadletter.queuea\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_QUEUEB_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.deadletter.queueb\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明延时Exchange</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delayExchange\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> DirectExchange <span class=\"token function\">delayExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span>DELAY_EXCHANGE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信Exchange</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterExchange\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> DirectExchange <span class=\"token function\">deadLetterExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span>DEAD_LETTER_EXCHANGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明延时队列A 延时10s</span>\n    <span class=\"token comment\" spellcheck=\"true\">// 并绑定到对应的死信交换机</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delayQueueA\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">delayQueueA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        Map<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Object<span class=\"token operator\">></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">// x-dead-letter-exchange    这里声明当前队列绑定的死信交换机</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-exchange\"</span><span class=\"token punctuation\">,</span> DEAD_LETTER_EXCHANGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">// x-dead-letter-routing-key  这里声明当前队列的死信路由key</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-routing-key\"</span><span class=\"token punctuation\">,</span> DEAD_LETTER_QUEUEA_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">// x-message-ttl  声明队列的TTL</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-message-ttl\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> QueueBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span>DEAD_LETTER_QUEUEA_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withArguments</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明延时队列B 延时 60s</span>\n    <span class=\"token comment\" spellcheck=\"true\">// 并绑定到对应的死信交换机</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delayQueueB\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">delayQueueB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        Map<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Object<span class=\"token operator\">></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">// x-dead-letter-exchange    这里声明当前队列绑定的死信交换机</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-exchange\"</span><span class=\"token punctuation\">,</span> DEAD_LETTER_EXCHANGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">// x-dead-letter-routing-key  这里声明当前队列的死信路由key</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-routing-key\"</span><span class=\"token punctuation\">,</span> DEAD_LETTER_QUEUEB_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">// x-message-ttl  声明队列的TTL</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-message-ttl\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">60000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> QueueBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span>DEAD_LETTER_QUEUEB_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withArguments</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信队列A 用于接收延时10s处理的消息</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterQueueA\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">deadLetterQueueA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span>DEAD_LETTER_QUEUEA_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信队列B 用于接收延时60s处理的消息</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterQueueB\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">deadLetterQueueB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span>DEAD_LETTER_QUEUEB_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明延时队列A绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">delayBindingA</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delayQueueA\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                    <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delayExchange\"</span><span class=\"token punctuation\">)</span> DirectExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span>DELAY_QUEUEA_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明业务队列B绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">delayBindingB</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delayQueueB\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                    <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delayExchange\"</span><span class=\"token punctuation\">)</span> DirectExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span>DELAY_QUEUEB_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信队列A绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">deadLetterBindingA</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterQueueA\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                    <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterExchange\"</span><span class=\"token punctuation\">)</span> DirectExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span>DEAD_LETTER_QUEUEA_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信队列B绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">deadLetterBindingB</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterQueueB\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                      <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterExchange\"</span><span class=\"token punctuation\">)</span> DirectExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span>DEAD_LETTER_QUEUEB_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>接下来，创建两个消费者，分别对两个死信队列的消息进行消费：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DeadLetterQueueConsumer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> DEAD_LETTER_QUEUEA_NAME<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveA</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> Channel channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException <span class=\"token punctuation\">{</span>\n        String msg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"当前时间：{},死信队列A收到消息：{}\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> DEAD_LETTER_QUEUEB_NAME<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveB</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> Channel channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException <span class=\"token punctuation\">{</span>\n        String msg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"当前时间：{},死信队列B收到消息：{}\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>然后是消息的生产者：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DelayMessageSender</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> RabbitTemplate rabbitTemplate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsg</span><span class=\"token punctuation\">(</span>String msg<span class=\"token punctuation\">,</span> DelayTypeEnum type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">case</span> DELAY_10s<span class=\"token operator\">:</span>\n                rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>DELAY_EXCHANGE_NAME<span class=\"token punctuation\">,</span> DELAY_QUEUEA_ROUTING_KEY<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> DELAY_60s<span class=\"token operator\">:</span>\n                rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>DELAY_EXCHANGE_NAME<span class=\"token punctuation\">,</span> DELAY_QUEUEB_ROUTING_KEY<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>接下来，我们暴露一个web接口来生产消息：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rabbitmq\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RabbitMQMsgController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> DelayMessageSender sender<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sendmsg\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMsg</span><span class=\"token punctuation\">(</span>String msg<span class=\"token punctuation\">,</span> Integer delayType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"当前时间：{},收到请求，msg:{},delayType:{}\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> delayType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        sender<span class=\"token punctuation\">.</span><span class=\"token function\">sendMsg</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">,</span> Objects<span class=\"token punctuation\">.</span><span class=\"token function\">requireNonNull</span><span class=\"token punctuation\">(</span>DelayTypeEnum<span class=\"token punctuation\">.</span><span class=\"token function\">getDelayTypeEnumByValue</span><span class=\"token punctuation\">(</span>delayType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>准备就绪，启动！</p>\n<p>打开rabbitMQ的<a href=\"http://localhost:15672\" target=\"_blank\" rel=\"noopener\">管理后台</a>，可以看到我们刚才创建的交换机和队列信息：</p>\n<p><img src=\"https://i.loli.net/2019/07/28/5d3d54e15534398514.png\" alt=\"2.png\"></p>\n<p><img src=\"https://i.loli.net/2019/07/28/5d3d54e17df8183993.png\" alt=\"4.png\"></p>\n<p><img src=\"https://i.loli.net/2019/07/28/5d3d54e16952546955.png\" alt=\"3.png\"></p>\n<p>接下来，我们来发送几条消息，<a href=\"http://localhost:8080/rabbitmq/sendmsg?msg=testMsg1&amp;delayType=1\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/rabbitmq/sendmsg?msg=testMsg1&amp;delayType=1</a> <a href=\"http://localhost:8080/rabbitmq/sendmsg?msg=testMsg2&amp;delayType=2\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/rabbitmq/sendmsg?msg=testMsg2&amp;delayType=2</a></p>\n<p>日志如下：</p>\n<pre class=\" language-powershell\"><code class=\"language-powershell\">2019<span class=\"token operator\">-</span>07<span class=\"token operator\">-</span>28 16:02:19<span class=\"token punctuation\">.</span>813  INFO 3860 <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token namespace\">[nio-8080-exec-9]</span> c<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">.</span>controller<span class=\"token punctuation\">.</span>RabbitMQMsgController   : 当前时间：Sun Jul 28 16:02:19 CST 2019<span class=\"token punctuation\">,</span>收到请求，msg:testMsg1<span class=\"token punctuation\">,</span>delayType:1\n2019<span class=\"token operator\">-</span>07<span class=\"token operator\">-</span>28 16:02:19<span class=\"token punctuation\">.</span>815  INFO 3860 <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token namespace\">[nio-8080-exec-9]</span> <span class=\"token punctuation\">.</span>l<span class=\"token punctuation\">.</span>DirectReplyToMessageListenerContainer : SimpleConsumer <span class=\"token namespace\">[queue=amq.rabbitmq.reply-to, consumerTag=amq.ctag-o-qPpkWIkRm73DIrOIVhig identity=766339]</span> started\n2019<span class=\"token operator\">-</span>07<span class=\"token operator\">-</span>28 16:02:25<span class=\"token punctuation\">.</span>829  INFO 3860 <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>ntContainer<span class=\"token comment\" spellcheck=\"true\">#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:02:25 CST 2019,死信队列A收到消息：testMsg1</span>\n2019<span class=\"token operator\">-</span>07<span class=\"token operator\">-</span>28 16:02:41<span class=\"token punctuation\">.</span>326  INFO 3860 <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token namespace\">[nio-8080-exec-1]</span> c<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">.</span>controller<span class=\"token punctuation\">.</span>RabbitMQMsgController   : 当前时间：Sun Jul 28 16:02:41 CST 2019<span class=\"token punctuation\">,</span>收到请求，msg:testMsg2<span class=\"token punctuation\">,</span>delayType:2\n2019<span class=\"token operator\">-</span>07<span class=\"token operator\">-</span>28 16:03:41<span class=\"token punctuation\">.</span>329  INFO 3860 <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>ntContainer<span class=\"token comment\" spellcheck=\"true\">#0-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:03:41 CST 2019,死信队列B收到消息：testMsg2</span></code></pre>\n<p>第一条消息在6s后变成了死信消息，然后被消费者消费掉，第二条消息在60s之后变成了死信消息，然后被消费掉，这样，一个还算ok的延时队列就打造完成了。</p>\n<p>不过，等等，如果这样使用的话，岂不是每增加一个新的时间需求，就要新增一个队列，这里只有6s和60s两个时间选项，如果需要一个小时后处理，那么就需要增加TTL为一个小时的队列，如果是预定会议室然后提前通知这样的场景，岂不是要增加无数个队列才能满足需求？？</p>\n<p>嗯，仔细想想，事情并不简单。</p>\n<h2 id=\"七、RabbitMQ延时队列优化\"><a href=\"#七、RabbitMQ延时队列优化\" class=\"headerlink\" title=\"七、RabbitMQ延时队列优化\"></a>七、RabbitMQ延时队列优化</h2><p>显然，需要一种更通用的方案才能满足需求，那么就只能将TTL设置在消息属性里了。我们来试一试。</p>\n<p>增加一个延时队列，用于接收设置为任意延时时长的消息，增加一个相应的死信队列和routingkey：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RabbitMQConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DELAY_EXCHANGE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.business.exchange\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DELAY_QUEUEC_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.business.queuec\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DELAY_QUEUEC_ROUTING_KEY <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.business.queuec.routingkey\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_EXCHANGE <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.deadletter.exchange\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_QUEUEC_ROUTING_KEY <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.deadletter.delay_anytime.routingkey\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DEAD_LETTER_QUEUEC_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.deadletter.queuec\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明延时Exchange</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delayExchange\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> DirectExchange <span class=\"token function\">delayExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span>DELAY_EXCHANGE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信Exchange</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterExchange\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> DirectExchange <span class=\"token function\">deadLetterExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DirectExchange</span><span class=\"token punctuation\">(</span>DEAD_LETTER_EXCHANGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明延时队列C 不设置TTL</span>\n    <span class=\"token comment\" spellcheck=\"true\">// 并绑定到对应的死信交换机</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delayQueueC\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">delayQueueC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        Map<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Object<span class=\"token operator\">></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">// x-dead-letter-exchange    这里声明当前队列绑定的死信交换机</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-exchange\"</span><span class=\"token punctuation\">,</span> DEAD_LETTER_EXCHANGE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\" spellcheck=\"true\">// x-dead-letter-routing-key  这里声明当前队列的死信路由key</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-routing-key\"</span><span class=\"token punctuation\">,</span> DEAD_LETTER_QUEUEC_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> QueueBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">durable</span><span class=\"token punctuation\">(</span>DELAY_QUEUEC_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withArguments</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信队列C 用于接收延时任意时长处理的消息</span>\n    <span class=\"token annotation punctuation\">@Bean</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterQueueC\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">deadLetterQueueC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span>DEAD_LETTER_QUEUEC_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明延时列C绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">delayBindingC</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delayQueueC\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                 <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delayExchange\"</span><span class=\"token punctuation\">)</span> DirectExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span>DELAY_QUEUEC_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\" spellcheck=\"true\">// 声明死信队列C绑定关系</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">deadLetterBindingC</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterQueueC\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                      <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deadLetterExchange\"</span><span class=\"token punctuation\">)</span> DirectExchange exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span>DEAD_LETTER_QUEUEC_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>增加一个死信队列C的消费者：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> DEAD_LETTER_QUEUEC_NAME<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveC</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> Channel channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException <span class=\"token punctuation\">{</span>\n    String msg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"当前时间：{},死信队列C收到消息：{}\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>再次启动！然后访问：<a href=\"http://localhost:8080/rabbitmq/delayMsg?msg=testMsg1delayTime=5000\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/rabbitmq/delayMsg?msg=testMsg1delayTime=5000</a> 来生产消息，注意这里的单位是毫秒。</p>\n<pre><code>2019-07-28 16:45:07.033  INFO 31468 --- [nio-8080-exec-4] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:45:07 CST 2019,收到请求，msg:testMsg1,delayTime:5000\n2019-07-28 16:45:11.694  INFO 31468 --- [nio-8080-exec-5] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:45:11 CST 2019,收到请求，msg:testMsg2,delayTime:5000\n2019-07-28 16:45:12.048  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:45:12 CST 2019,死信队列C收到消息：testMsg1\n2019-07-28 16:45:16.709  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:45:16 CST 2019,死信队列C收到消息：testMsg2</code></pre><p>看起来似乎没什么问题，但不要高兴的太早，在最开始的时候，就介绍过，如果使用在消息属性上设置TTL的方式，消息可能并不会按时“死亡“，因为RabbitMQ只会检查第一个消息是否过期，如果过期则丢到死信队列，索引如果第一个消息的延时时长很长，而第二个消息的延时时长很短，则第二个消息并不会优先得到执行。</p>\n<p>实验一下：</p>\n<pre><code>2019-07-28 16:49:02.957  INFO 31468 --- [nio-8080-exec-8] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:49:02 CST 2019,收到请求，msg:longDelayedMsg,delayTime:20000\n2019-07-28 16:49:10.671  INFO 31468 --- [nio-8080-exec-9] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:49:10 CST 2019,收到请求，msg:shortDelayedMsg,delayTime:2000\n2019-07-28 16:49:22.969  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:49:22 CST 2019,死信队列C收到消息：longDelayedMsg\n2019-07-28 16:49:22.970  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:49:22 CST 2019,死信队列C收到消息：shortDelayedMsg</code></pre><p>我们先发了一个延时时长为20s的消息，然后发了一个延时时长为2s的消息，结果显示，第二个消息会在等第一个消息成为死信后才会“死亡“。</p>\n<h2 id=\"八、利用RabbitMQ插件实现延迟队列\"><a href=\"#八、利用RabbitMQ插件实现延迟队列\" class=\"headerlink\" title=\"八、利用RabbitMQ插件实现延迟队列\"></a>八、利用RabbitMQ插件实现延迟队列</h2><p>上文中提到的问题，确实是一个硬伤，如果不能实现在消息粒度上添加TTL，并使其在设置的TTL时间及时死亡，就无法设计成一个通用的延时队列。</p>\n<p>那如何解决这个问题呢？不要慌，安装一个插件即可：<a href=\"https://www.rabbitmq.com/community-plugins.html\" target=\"_blank\" rel=\"noopener\">https://www.rabbitmq.com/community-plugins.html</a> ，下载rabbitmq_delayed_message_exchange插件，然后解压放置到RabbitMQ的插件目录。</p>\n<p>接下来，进入RabbitMQ的安装目录下的sbin目录，执行下面命令让该插件生效，然后重启RabbitMQ。</p>\n<pre class=\" language-shell\"><code class=\"language-shell\">rabbitmq-plugins enable rabbitmq_delayed_message_exchange</code></pre>\n<p>然后，我们再声明几个Bean：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DelayedRabbitMQConfig</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DELAYED_QUEUE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.delay.queue\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DELAYED_EXCHANGE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.delay.exchange\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> String DELAYED_ROUTING_KEY <span class=\"token operator\">=</span> <span class=\"token string\">\"delay.queue.demo.delay.routingkey\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Queue <span class=\"token function\">immediateQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span>DELAYED_QUEUE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> CustomExchange <span class=\"token function\">customExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        Map<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Object<span class=\"token operator\">></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-delayed-type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"direct\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomExchange</span><span class=\"token punctuation\">(</span>DELAYED_EXCHANGE_NAME<span class=\"token punctuation\">,</span> <span class=\"token string\">\"x-delayed-message\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> Binding <span class=\"token function\">bindingNotify</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"immediateQueue\"</span><span class=\"token punctuation\">)</span> Queue queue<span class=\"token punctuation\">,</span>\n                                 <span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"customExchange\"</span><span class=\"token punctuation\">)</span> CustomExchange customExchange<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> BindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>customExchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">with</span><span class=\"token punctuation\">(</span>DELAYED_ROUTING_KEY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">noargs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>controller层再添加一个入口：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"delayMsg2\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">delayMsg2</span><span class=\"token punctuation\">(</span>String msg<span class=\"token punctuation\">,</span> Integer delayTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"当前时间：{},收到请求，msg:{},delayTime:{}\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> delayTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    sender<span class=\"token punctuation\">.</span><span class=\"token function\">sendDelayMsg</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">,</span> delayTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>消息生产者的代码也需要修改：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendDelayMsg</span><span class=\"token punctuation\">(</span>String msg<span class=\"token punctuation\">,</span> Integer delayTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span>DELAYED_EXCHANGE_NAME<span class=\"token punctuation\">,</span> DELAYED_ROUTING_KEY<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> a <span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>\n        a<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setDelay</span><span class=\"token punctuation\">(</span>delayTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> a<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>最后，再创建一个消费者：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RabbitListener</span><span class=\"token punctuation\">(</span>queues <span class=\"token operator\">=</span> DELAYED_QUEUE_NAME<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">receiveD</span><span class=\"token punctuation\">(</span>Message message<span class=\"token punctuation\">,</span> Channel channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> IOException <span class=\"token punctuation\">{</span>\n    String msg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"当前时间：{},延时队列收到消息：{}\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    channel<span class=\"token punctuation\">.</span><span class=\"token function\">basicAck</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageProperties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDeliveryTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>一切准备就绪，启动！然后分别访问以下链接：</p>\n<pre class=\" language-url\"><code class=\"language-url\">http://localhost:8080/rabbitmq/delayMsg2?msg=msg1&delayTime=20000\nhttp://localhost:8080/rabbitmq/delayMsg2?msg=msg2&delayTime=2000</code></pre>\n<p>日志如下：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token number\">2019</span><span class=\"token operator\">-</span><span class=\"token number\">07</span><span class=\"token operator\">-</span><span class=\"token number\">28</span> <span class=\"token number\">17</span><span class=\"token operator\">:</span><span class=\"token number\">28</span><span class=\"token operator\">:</span><span class=\"token number\">13.729</span>  INFO <span class=\"token number\">25804</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>nio<span class=\"token operator\">-</span><span class=\"token number\">8080</span><span class=\"token operator\">-</span>exec<span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> c<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">.</span>controller<span class=\"token punctuation\">.</span>RabbitMQMsgController   <span class=\"token operator\">:</span> 当前时间：Sun Jul <span class=\"token number\">28</span> <span class=\"token number\">17</span><span class=\"token operator\">:</span><span class=\"token number\">28</span><span class=\"token operator\">:</span><span class=\"token number\">13</span> CST <span class=\"token number\">2019</span><span class=\"token punctuation\">,</span>收到请求，msg<span class=\"token operator\">:</span>msg1<span class=\"token punctuation\">,</span>delayTime<span class=\"token operator\">:</span><span class=\"token number\">20000</span>\n<span class=\"token number\">2019</span><span class=\"token operator\">-</span><span class=\"token number\">07</span><span class=\"token operator\">-</span><span class=\"token number\">28</span> <span class=\"token number\">17</span><span class=\"token operator\">:</span><span class=\"token number\">28</span><span class=\"token operator\">:</span><span class=\"token number\">20.607</span>  INFO <span class=\"token number\">25804</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>nio<span class=\"token operator\">-</span><span class=\"token number\">8080</span><span class=\"token operator\">-</span>exec<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> c<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">.</span>controller<span class=\"token punctuation\">.</span>RabbitMQMsgController   <span class=\"token operator\">:</span> 当前时间：Sun Jul <span class=\"token number\">28</span> <span class=\"token number\">17</span><span class=\"token operator\">:</span><span class=\"token number\">28</span><span class=\"token operator\">:</span><span class=\"token number\">20</span> CST <span class=\"token number\">2019</span><span class=\"token punctuation\">,</span>收到请求，msg<span class=\"token operator\">:</span>msg2<span class=\"token punctuation\">,</span>delayTime<span class=\"token operator\">:</span><span class=\"token number\">2000</span>\n<span class=\"token number\">2019</span><span class=\"token operator\">-</span><span class=\"token number\">07</span><span class=\"token operator\">-</span><span class=\"token number\">28</span> <span class=\"token number\">17</span><span class=\"token operator\">:</span><span class=\"token number\">28</span><span class=\"token operator\">:</span><span class=\"token number\">22.624</span>  INFO <span class=\"token number\">25804</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>ntContainer#<span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> c<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">.</span>mq<span class=\"token punctuation\">.</span>DeadLetterQueueConsumer         <span class=\"token operator\">:</span> 当前时间：Sun Jul <span class=\"token number\">28</span> <span class=\"token number\">17</span><span class=\"token operator\">:</span><span class=\"token number\">28</span><span class=\"token operator\">:</span><span class=\"token number\">22</span> CST <span class=\"token number\">2019</span><span class=\"token punctuation\">,</span>延时队列收到消息：msg2\n<span class=\"token number\">2019</span><span class=\"token operator\">-</span><span class=\"token number\">07</span><span class=\"token operator\">-</span><span class=\"token number\">28</span> <span class=\"token number\">17</span><span class=\"token operator\">:</span><span class=\"token number\">28</span><span class=\"token operator\">:</span><span class=\"token number\">33.751</span>  INFO <span class=\"token number\">25804</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>ntContainer#<span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> c<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span>d<span class=\"token punctuation\">.</span>mq<span class=\"token punctuation\">.</span>DeadLetterQueueConsumer         <span class=\"token operator\">:</span> 当前时间：Sun Jul <span class=\"token number\">28</span> <span class=\"token number\">17</span><span class=\"token operator\">:</span><span class=\"token number\">28</span><span class=\"token operator\">:</span><span class=\"token number\">33</span> CST <span class=\"token number\">2019</span><span class=\"token punctuation\">,</span>延时队列收到消息：msg1</code></pre>\n<p>第二个消息被先消费掉了，符合预期。至此，RabbitMQ实现延时队列的部分就完结了。</p>\n<h2 id=\"九、总结\"><a href=\"#九、总结\" class=\"headerlink\" title=\"九、总结\"></a>九、总结</h2><p>延时队列在需要延时处理的场景下非常有用，使用RabbitMQ来实现延时队列可以很好的利用RabbitMQ的特性，如：消息可靠发送、消息可靠投递、死信队列来保障消息至少被消费一次以及未被正确处理的消息不会被丢弃。另外，通过RabbitMQ集群的特性，可以很好的解决单点故障问题，不会因为单个节点挂掉导致延时队列不可用或者消息丢失。</p>\n<p>当然，延时队列还有很多其它选择，比如利用Java的DelayQueu，利用Redis的zset，利用Quartz或者利用kafka的时间轮，这些方式各有特点，但就像炉石传说一般，这些知识就好比手里的卡牌，知道的越多，可以用的卡牌也就越多，遇到问题便能游刃有余，所以需要大量的知识储备和经验积累才能打造出更出色的卡牌组合，让自己解决问题的能力得到更好的提升。</p>\n<p>但另一方面，随着时间的流逝和阅历的增长，越来越感觉到自己的能力有限，无法独自面对纷繁复杂且多变的业务需求，在很多方面需要其他人的协助才能很好的完成任务。也知道闻道有先后，术业有专攻，不会再狂妄自大，觉得自己能把所有事情都搞定，也将重心慢慢转移到研究如何有效的进行团队合作上来，我相信一个高度协调的团队永远比一个人战斗要更有价值。</p>\n<p>花了一个周末的时间完成了这篇文章，文中所有的代码都上传到了<a href=\"https://github.com/MFrank2016/delayed-queue-demo\" target=\"_blank\" rel=\"noopener\">github</a>如有需要可以自行查阅，希望能对你有帮助，如果有错误的地方，欢迎指正，也欢迎关注我的公众号进行留言交流。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<p>本文口味：鱼香肉丝   预计阅读：10分钟</p>\n<h2 id=\"一、说明\"><a href=\"#一、说明\" class=\"headerlink\" title=\"一、说明\"></a>一、说明</h2><p>在上一篇中，介绍了RabbitMQ中的死信队列是什么，何时使用以及如何使用RabbitMQ的死信队列。相信通过上一篇的学习，对于死信队列已经有了更多的了解，这一篇的内容也跟死信队列息息相关，如果你还不了解死信队列，那么建议你先进行上一篇文章的阅读。</p>\n<p>这一篇里，我们将继续介绍RabbitMQ的高级特性，通过本篇的学习，你将收获：</p>\n<ol>\n<li>什么是延时队列</li>\n<li>延时队列使用场景</li>\n<li>RabbitMQ中的TTL</li>\n<li>如何利用RabbitMQ来实现延时队列</li>\n</ol>\n<h2 id=\"二、本文大纲\"><a href=\"#二、本文大纲\" class=\"headerlink\" title=\"二、本文大纲\"></a>二、本文大纲</h2><p>以下是本文大纲：</p>\n<p><img src=\"https://i.loli.net/2019/07/28/5d3d74d99699d43032.png\" alt=\"1.png\"></p>\n<p>本文阅读前，需要对RabbitMQ以及死信队列有一个简单的了解。</p>\n<h2 id=\"三、什么是延时队列\"><a href=\"#三、什么是延时队列\" class=\"headerlink\" title=\"三、什么是延时队列\"></a>三、什么是延时队列</h2><p><code>延时队列</code>，首先，它是一种队列，队列意味着内部的元素是<code>有序</code>的，元素出队和入队是有方向性的，元素从一端进入，从另一端取出。</p>\n<p>其次，<code>延时队列</code>，最重要的特性就体现在它的<code>延时</code>属性上，跟普通的队列不一样的是，<code>普通队列中的元素总是等着希望被早点取出处理，而延时队列中的元素则是希望被在指定时间得到取出和处理</code>，所以延时队列中的元素是都是带时间属性的，通常来说是需要被处理的消息或者任务。</p>\n<p>简单来说，延时队列就是用来存放需要在指定时间被处理的元素的队列。</p>\n<h2 id=\"四、延时队列使用场景\"><a href=\"#四、延时队列使用场景\" class=\"headerlink\" title=\"四、延时队列使用场景\"></a>四、延时队列使用场景</h2><p>那么什么时候需要用延时队列呢？考虑一下以下场景：</p>\n<ol>\n<li>订单在十分钟之内未支付则自动取消。</li>\n<li>新创建的店铺，如果在十天内都没有上传过商品，则自动发送消息提醒。</li>\n<li>账单在一周内未支付，则自动结算。</li>\n<li>用户注册成功后，如果三天内没有登陆则进行短信提醒。</li>\n<li>用户发起退款，如果三天内没有得到处理则通知相关运营人员。</li>\n<li>预定会议后，需要在预定的时间点前十分钟通知各个与会人员参加会议。</li>\n</ol>\n<p>这些场景都有一个特点，需要在某个事件发生之后或者之前的指定时间点完成某一项任务，如：发生订单生成事件，在十分钟之后检查该订单支付状态，然后将未支付的订单进行关闭；发生店铺创建事件，十天后检查该店铺上新商品数，然后通知上新数为0的商户；发生账单生成事件，检查账单支付状态，然后自动结算未支付的账单；发生新用户注册事件，三天后检查新注册用户的活动数据，然后通知没有任何活动记录的用户；发生退款事件，在三天之后检查该订单是否已被处理，如仍未被处理，则发送消息给相关运营人员；发生预定会议事件，判断离会议开始是否只有十分钟了，如果是，则通知各个与会人员。</p>\n<p>看起来似乎使用定时任务，一直轮询数据，每秒查一次，取出需要被处理的数据，然后处理不就完事了吗？如果数据量比较少，确实可以这样做，比如：对于“如果账单一周内未支付则进行自动结算”这样的需求，如果对于时间不是严格限制，而是宽松意义上的一周，那么每天晚上跑个定时任务检查一下所有未支付的账单，确实也是一个可行的方案。但对于数据量比较大，并且时效性较强的场景，如：“订单十分钟内未支付则关闭“，短期内未支付的订单数据可能会有很多，活动期间甚至会达到百万甚至千万级别，对这么庞大的数据量仍旧使用轮询的方式显然是不可取的，很可能在一秒内无法完成所有订单的检查，同时会给数据库带来很大压力，无法满足业务要求而且性能低下。</p>\n<p>更重要的一点是，不！优！雅！</p>\n<p>没错，作为一名有追求的程序员，始终应该追求更优雅的架构和更优雅的代码风格，写代码要像写诗一样优美。【滑稽】</p>\n<p>这时候，延时队列就可以闪亮登场了，以上场景，正是延时队列的用武之地。</p>\n<p>既然<code>延时队列</code>可以解决很多特定场景下，带时间属性的任务需求，那么如何构造一个延时队列呢？接下来，本文将介绍如何用RabbitMQ来实现延时队列。</p>\n<h2 id=\"五、RabbitMQ中的TTL\"><a href=\"#五、RabbitMQ中的TTL\" class=\"headerlink\" title=\"五、RabbitMQ中的TTL\"></a>五、RabbitMQ中的TTL</h2><p>在介绍延时队列之前，还需要先介绍一下RabbitMQ中的一个高级特性——<code>TTL（Time To Live）</code>。</p>\n<p><code>TTL</code>是什么呢？<code>TTL</code>是RabbitMQ中一个消息或者队列的属性，表明<code>一条消息或者该队列中的所有消息的最大存活时间</code>，单位是毫秒。换句话说，如果一条消息设置了TTL属性或者进入了设置TTL属性的队列，那么这条消息如果在TTL设置的时间内没有被消费，则会成为“死信”（至于什么是死信，请翻看上一篇）。如果同时配置了队列的TTL和消息的TTL，那么较小的那个值将会被使用。</p>\n<p>那么，如何设置这个TTL值呢？有两种方式，第一种是在创建队列的时候设置队列的“x-message-ttl”属性，如下：</p>\n<pre><code class=\"java\">Map&lt;String, Object&gt; args = new HashMap&lt;String, Object&gt;();\nargs.put(&quot;x-message-ttl&quot;, 6000);\nchannel.queueDeclare(queueName, durable, exclusive, autoDelete, args);</code></pre>\n<p>这样所有被投递到该队列的消息都最多不会存活超过6s。</p>\n<p>另一种方式便是针对每条消息设置TTL，代码如下：</p>\n<pre><code class=\"java\">AMQP.BasicProperties.Builder builder = new AMQP.BasicProperties.Builder();\nbuilder.expiration(&quot;6000&quot;);\nAMQP.BasicProperties properties = builder.build();\nchannel.basicPublish(exchangeName, routingKey, mandatory, properties, &quot;msg body&quot;.getBytes());</code></pre>\n<p>这样这条消息的过期时间也被设置成了6s。</p>\n<p>但这两种方式是有区别的，<strong>如果设置了队列的TTL属性，那么一旦消息过期，就会被队列丢弃，而第二种方式，消息即使过期，也不一定会被马上丢弃，因为消息是否过期是在即将投递到消费者之前判定的，如果当前队列有严重的消息积压情况，则已过期的消息也许还能存活较长时间。</strong></p>\n<p>另外，还需要注意的一点是，如果不设置TTL，表示消息永远不会过期，如果将TTL设置为0，则表示除非此时可以直接投递该消息到消费者，否则该消息将会被丢弃。</p>\n<h2 id=\"六、如何利用RabbitMQ实现延时队列\"><a href=\"#六、如何利用RabbitMQ实现延时队列\" class=\"headerlink\" title=\"六、如何利用RabbitMQ实现延时队列\"></a>六、如何利用RabbitMQ实现延时队列</h2><p>前一篇里介绍了如果设置死信队列，前文中又介绍了TTL，至此，利用RabbitMQ实现延时队列的两大要素已经集齐，接下来只需要将它们进行调和，再加入一点点调味料，延时队列就可以新鲜出炉了。</p>\n<p>想想看，<code>延时队列</code>，不就是想要消息延迟多久被处理吗，TTL则刚好能让消息在延迟多久之后成为死信，另一方面，成为死信的消息都会被投递到死信队列里，这样只需要消费者一直消费死信队列里的消息就万事大吉了，因为里面的消息都是希望被立即处理的消息。</p>\n<p>从下图可以大致看出消息的流向：</p>\n<p><img src=\"https://i.loli.net/2019/07/28/5d3d743143ecc85643.png\" alt=\"23.png\"></p>\n<p>生产者生产一条延时消息，根据需要延时时间的不同，利用不同的routingkey将消息路由到不同的延时队列，每个队列都设置了不同的TTL属性，并绑定在同一个死信交换机中，消息过期后，根据routingkey的不同，又会被路由到不同的死信队列中，消费者只需要监听对应的死信队列进行处理即可。</p>\n<p>下面来看代码：</p>\n<p>先声明交换机、队列以及他们的绑定关系：</p>\n<pre><code class=\"java\">@Configuration\npublic class RabbitMQConfig {\n\n    public static final String DELAY_EXCHANGE_NAME = &quot;delay.queue.demo.business.exchange&quot;;\n    public static final String DELAY_QUEUEA_NAME = &quot;delay.queue.demo.business.queuea&quot;;\n    public static final String DELAY_QUEUEA_ROUTING_KEY = &quot;delay.queue.demo.business.queuea.routingkey&quot;;\n    public static final String DELAY_QUEUEB_ROUTING_KEY = &quot;delay.queue.demo.business.queueb.routingkey&quot;;\n    public static final String DEAD_LETTER_EXCHANGE = &quot;delay.queue.demo.deadletter.exchange&quot;;\n    public static final String DEAD_LETTER_QUEUEA_ROUTING_KEY = &quot;delay.queue.demo.deadletter.delay_10s.routingkey&quot;;\n    public static final String DEAD_LETTER_QUEUEB_ROUTING_KEY = &quot;delay.queue.demo.deadletter.delay_60s.routingkey&quot;;\n    public static final String DEAD_LETTER_QUEUEA_NAME = &quot;delay.queue.demo.deadletter.queuea&quot;;\n    public static final String DEAD_LETTER_QUEUEB_NAME = &quot;delay.queue.demo.deadletter.queueb&quot;;\n\n    // 声明延时Exchange\n    @Bean(&quot;delayExchange&quot;)\n    public DirectExchange delayExchange(){\n        return new DirectExchange(DELAY_EXCHANGE_NAME);\n    }\n\n    // 声明死信Exchange\n    @Bean(&quot;deadLetterExchange&quot;)\n    public DirectExchange deadLetterExchange(){\n        return new DirectExchange(DEAD_LETTER_EXCHANGE);\n    }\n\n    // 声明延时队列A 延时10s\n    // 并绑定到对应的死信交换机\n    @Bean(&quot;delayQueueA&quot;)\n    public Queue delayQueueA(){\n        Map&lt;String, Object&gt; args = new HashMap&lt;&gt;(2);\n        // x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(&quot;x-dead-letter-exchange&quot;, DEAD_LETTER_EXCHANGE);\n        // x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(&quot;x-dead-letter-routing-key&quot;, DEAD_LETTER_QUEUEA_ROUTING_KEY);\n        // x-message-ttl  声明队列的TTL\n        args.put(&quot;x-message-ttl&quot;, 6000);\n        return QueueBuilder.durable(DEAD_LETTER_QUEUEA_NAME).withArguments(args).build();\n    }\n\n    // 声明延时队列B 延时 60s\n    // 并绑定到对应的死信交换机\n    @Bean(&quot;delayQueueB&quot;)\n    public Queue delayQueueB(){\n        Map&lt;String, Object&gt; args = new HashMap&lt;&gt;(2);\n        // x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(&quot;x-dead-letter-exchange&quot;, DEAD_LETTER_EXCHANGE);\n        // x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(&quot;x-dead-letter-routing-key&quot;, DEAD_LETTER_QUEUEB_ROUTING_KEY);\n        // x-message-ttl  声明队列的TTL\n        args.put(&quot;x-message-ttl&quot;, 60000);\n        return QueueBuilder.durable(DEAD_LETTER_QUEUEB_NAME).withArguments(args).build();\n    }\n\n    // 声明死信队列A 用于接收延时10s处理的消息\n    @Bean(&quot;deadLetterQueueA&quot;)\n    public Queue deadLetterQueueA(){\n        return new Queue(DEAD_LETTER_QUEUEA_NAME);\n    }\n\n    // 声明死信队列B 用于接收延时60s处理的消息\n    @Bean(&quot;deadLetterQueueB&quot;)\n    public Queue deadLetterQueueB(){\n        return new Queue(DEAD_LETTER_QUEUEB_NAME);\n    }\n\n    // 声明延时队列A绑定关系\n    @Bean\n    public Binding delayBindingA(@Qualifier(&quot;delayQueueA&quot;) Queue queue,\n                                    @Qualifier(&quot;delayExchange&quot;) DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DELAY_QUEUEA_ROUTING_KEY);\n    }\n\n    // 声明业务队列B绑定关系\n    @Bean\n    public Binding delayBindingB(@Qualifier(&quot;delayQueueB&quot;) Queue queue,\n                                    @Qualifier(&quot;delayExchange&quot;) DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DELAY_QUEUEB_ROUTING_KEY);\n    }\n\n    // 声明死信队列A绑定关系\n    @Bean\n    public Binding deadLetterBindingA(@Qualifier(&quot;deadLetterQueueA&quot;) Queue queue,\n                                    @Qualifier(&quot;deadLetterExchange&quot;) DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEA_ROUTING_KEY);\n    }\n\n    // 声明死信队列B绑定关系\n    @Bean\n    public Binding deadLetterBindingB(@Qualifier(&quot;deadLetterQueueB&quot;) Queue queue,\n                                      @Qualifier(&quot;deadLetterExchange&quot;) DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEB_ROUTING_KEY);\n    }\n}</code></pre>\n<p>接下来，创建两个消费者，分别对两个死信队列的消息进行消费：</p>\n<pre><code class=\"java\">@Slf4j\n@Component\npublic class DeadLetterQueueConsumer {\n\n    @RabbitListener(queues = DEAD_LETTER_QUEUEA_NAME)\n    public void receiveA(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(&quot;当前时间：{},死信队列A收到消息：{}&quot;, new Date().toString(), msg);\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n\n    @RabbitListener(queues = DEAD_LETTER_QUEUEB_NAME)\n    public void receiveB(Message message, Channel channel) throws IOException {\n        String msg = new String(message.getBody());\n        log.info(&quot;当前时间：{},死信队列B收到消息：{}&quot;, new Date().toString(), msg);\n        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n    }\n}</code></pre>\n<p>然后是消息的生产者：</p>\n<pre><code class=\"java\">@Component\npublic class DelayMessageSender {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void sendMsg(String msg, DelayTypeEnum type){\n        switch (type){\n            case DELAY_10s:\n                rabbitTemplate.convertAndSend(DELAY_EXCHANGE_NAME, DELAY_QUEUEA_ROUTING_KEY, msg);\n                break;\n            case DELAY_60s:\n                rabbitTemplate.convertAndSend(DELAY_EXCHANGE_NAME, DELAY_QUEUEB_ROUTING_KEY, msg);\n                break;\n        }\n    }\n}</code></pre>\n<p>接下来，我们暴露一个web接口来生产消息：</p>\n<pre><code class=\"java\">@Slf4j\n@RequestMapping(&quot;rabbitmq&quot;)\n@RestController\npublic class RabbitMQMsgController {\n\n    @Autowired\n    private DelayMessageSender sender;\n\n    @RequestMapping(&quot;sendmsg&quot;)\n    public void sendMsg(String msg, Integer delayType){\n        log.info(&quot;当前时间：{},收到请求，msg:{},delayType:{}&quot;, new Date(), msg, delayType);\n        sender.sendMsg(msg, Objects.requireNonNull(DelayTypeEnum.getDelayTypeEnumByValue(delayType)));\n    }\n}</code></pre>\n<p>准备就绪，启动！</p>\n<p>打开rabbitMQ的<a href=\"http://localhost:15672\" target=\"_blank\" rel=\"noopener\">管理后台</a>，可以看到我们刚才创建的交换机和队列信息：</p>\n<p><img src=\"https://i.loli.net/2019/07/28/5d3d54e15534398514.png\" alt=\"2.png\"></p>\n<p><img src=\"https://i.loli.net/2019/07/28/5d3d54e17df8183993.png\" alt=\"4.png\"></p>\n<p><img src=\"https://i.loli.net/2019/07/28/5d3d54e16952546955.png\" alt=\"3.png\"></p>\n<p>接下来，我们来发送几条消息，<a href=\"http://localhost:8080/rabbitmq/sendmsg?msg=testMsg1&amp;delayType=1\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/rabbitmq/sendmsg?msg=testMsg1&amp;delayType=1</a> <a href=\"http://localhost:8080/rabbitmq/sendmsg?msg=testMsg2&amp;delayType=2\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/rabbitmq/sendmsg?msg=testMsg2&amp;delayType=2</a></p>\n<p>日志如下：</p>\n<pre><code class=\"powershell\">2019-07-28 16:02:19.813  INFO 3860 --- [nio-8080-exec-9] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:02:19 CST 2019,收到请求，msg:testMsg1,delayType:1\n2019-07-28 16:02:19.815  INFO 3860 --- [nio-8080-exec-9] .l.DirectReplyToMessageListenerContainer : SimpleConsumer [queue=amq.rabbitmq.reply-to, consumerTag=amq.ctag-o-qPpkWIkRm73DIrOIVhig identity=766339] started\n2019-07-28 16:02:25.829  INFO 3860 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:02:25 CST 2019,死信队列A收到消息：testMsg1\n2019-07-28 16:02:41.326  INFO 3860 --- [nio-8080-exec-1] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:02:41 CST 2019,收到请求，msg:testMsg2,delayType:2\n2019-07-28 16:03:41.329  INFO 3860 --- [ntContainer#0-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:03:41 CST 2019,死信队列B收到消息：testMsg2</code></pre>\n<p>第一条消息在6s后变成了死信消息，然后被消费者消费掉，第二条消息在60s之后变成了死信消息，然后被消费掉，这样，一个还算ok的延时队列就打造完成了。</p>\n<p>不过，等等，如果这样使用的话，岂不是每增加一个新的时间需求，就要新增一个队列，这里只有6s和60s两个时间选项，如果需要一个小时后处理，那么就需要增加TTL为一个小时的队列，如果是预定会议室然后提前通知这样的场景，岂不是要增加无数个队列才能满足需求？？</p>\n<p>嗯，仔细想想，事情并不简单。</p>\n<h2 id=\"七、RabbitMQ延时队列优化\"><a href=\"#七、RabbitMQ延时队列优化\" class=\"headerlink\" title=\"七、RabbitMQ延时队列优化\"></a>七、RabbitMQ延时队列优化</h2><p>显然，需要一种更通用的方案才能满足需求，那么就只能将TTL设置在消息属性里了。我们来试一试。</p>\n<p>增加一个延时队列，用于接收设置为任意延时时长的消息，增加一个相应的死信队列和routingkey：</p>\n<pre><code class=\"java\">@Configuration\npublic class RabbitMQConfig {\n\n    public static final String DELAY_EXCHANGE_NAME = &quot;delay.queue.demo.business.exchange&quot;;\n    public static final String DELAY_QUEUEC_NAME = &quot;delay.queue.demo.business.queuec&quot;;\n    public static final String DELAY_QUEUEC_ROUTING_KEY = &quot;delay.queue.demo.business.queuec.routingkey&quot;;\n    public static final String DEAD_LETTER_EXCHANGE = &quot;delay.queue.demo.deadletter.exchange&quot;;\n    public static final String DEAD_LETTER_QUEUEC_ROUTING_KEY = &quot;delay.queue.demo.deadletter.delay_anytime.routingkey&quot;;\n    public static final String DEAD_LETTER_QUEUEC_NAME = &quot;delay.queue.demo.deadletter.queuec&quot;;\n\n    // 声明延时Exchange\n    @Bean(&quot;delayExchange&quot;)\n    public DirectExchange delayExchange(){\n        return new DirectExchange(DELAY_EXCHANGE_NAME);\n    }\n\n    // 声明死信Exchange\n    @Bean(&quot;deadLetterExchange&quot;)\n    public DirectExchange deadLetterExchange(){\n        return new DirectExchange(DEAD_LETTER_EXCHANGE);\n    }\n\n    // 声明延时队列C 不设置TTL\n    // 并绑定到对应的死信交换机\n    @Bean(&quot;delayQueueC&quot;)\n    public Queue delayQueueC(){\n        Map&lt;String, Object&gt; args = new HashMap&lt;&gt;(3);\n        // x-dead-letter-exchange    这里声明当前队列绑定的死信交换机\n        args.put(&quot;x-dead-letter-exchange&quot;, DEAD_LETTER_EXCHANGE);\n        // x-dead-letter-routing-key  这里声明当前队列的死信路由key\n        args.put(&quot;x-dead-letter-routing-key&quot;, DEAD_LETTER_QUEUEC_ROUTING_KEY);\n        return QueueBuilder.durable(DELAY_QUEUEC_NAME).withArguments(args).build();\n    }\n\n    // 声明死信队列C 用于接收延时任意时长处理的消息\n    @Bean(&quot;deadLetterQueueC&quot;)\n    public Queue deadLetterQueueC(){\n        return new Queue(DEAD_LETTER_QUEUEC_NAME);\n    }\n\n    // 声明延时列C绑定关系\n    @Bean\n    public Binding delayBindingC(@Qualifier(&quot;delayQueueC&quot;) Queue queue,\n                                 @Qualifier(&quot;delayExchange&quot;) DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DELAY_QUEUEC_ROUTING_KEY);\n    }\n\n    // 声明死信队列C绑定关系\n    @Bean\n    public Binding deadLetterBindingC(@Qualifier(&quot;deadLetterQueueC&quot;) Queue queue,\n                                      @Qualifier(&quot;deadLetterExchange&quot;) DirectExchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(DEAD_LETTER_QUEUEC_ROUTING_KEY);\n    }\n}</code></pre>\n<p>增加一个死信队列C的消费者：</p>\n<pre><code class=\"java\">@RabbitListener(queues = DEAD_LETTER_QUEUEC_NAME)\npublic void receiveC(Message message, Channel channel) throws IOException {\n    String msg = new String(message.getBody());\n    log.info(&quot;当前时间：{},死信队列C收到消息：{}&quot;, new Date().toString(), msg);\n    channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n}</code></pre>\n<p>再次启动！然后访问：<a href=\"http://localhost:8080/rabbitmq/delayMsg?msg=testMsg1delayTime=5000\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/rabbitmq/delayMsg?msg=testMsg1delayTime=5000</a> 来生产消息，注意这里的单位是毫秒。</p>\n<pre><code>2019-07-28 16:45:07.033  INFO 31468 --- [nio-8080-exec-4] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:45:07 CST 2019,收到请求，msg:testMsg1,delayTime:5000\n2019-07-28 16:45:11.694  INFO 31468 --- [nio-8080-exec-5] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:45:11 CST 2019,收到请求，msg:testMsg2,delayTime:5000\n2019-07-28 16:45:12.048  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:45:12 CST 2019,死信队列C收到消息：testMsg1\n2019-07-28 16:45:16.709  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:45:16 CST 2019,死信队列C收到消息：testMsg2</code></pre><p>看起来似乎没什么问题，但不要高兴的太早，在最开始的时候，就介绍过，如果使用在消息属性上设置TTL的方式，消息可能并不会按时“死亡“，因为RabbitMQ只会检查第一个消息是否过期，如果过期则丢到死信队列，索引如果第一个消息的延时时长很长，而第二个消息的延时时长很短，则第二个消息并不会优先得到执行。</p>\n<p>实验一下：</p>\n<pre><code>2019-07-28 16:49:02.957  INFO 31468 --- [nio-8080-exec-8] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:49:02 CST 2019,收到请求，msg:longDelayedMsg,delayTime:20000\n2019-07-28 16:49:10.671  INFO 31468 --- [nio-8080-exec-9] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 16:49:10 CST 2019,收到请求，msg:shortDelayedMsg,delayTime:2000\n2019-07-28 16:49:22.969  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:49:22 CST 2019,死信队列C收到消息：longDelayedMsg\n2019-07-28 16:49:22.970  INFO 31468 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 16:49:22 CST 2019,死信队列C收到消息：shortDelayedMsg</code></pre><p>我们先发了一个延时时长为20s的消息，然后发了一个延时时长为2s的消息，结果显示，第二个消息会在等第一个消息成为死信后才会“死亡“。</p>\n<h2 id=\"八、利用RabbitMQ插件实现延迟队列\"><a href=\"#八、利用RabbitMQ插件实现延迟队列\" class=\"headerlink\" title=\"八、利用RabbitMQ插件实现延迟队列\"></a>八、利用RabbitMQ插件实现延迟队列</h2><p>上文中提到的问题，确实是一个硬伤，如果不能实现在消息粒度上添加TTL，并使其在设置的TTL时间及时死亡，就无法设计成一个通用的延时队列。</p>\n<p>那如何解决这个问题呢？不要慌，安装一个插件即可：<a href=\"https://www.rabbitmq.com/community-plugins.html\" target=\"_blank\" rel=\"noopener\">https://www.rabbitmq.com/community-plugins.html</a> ，下载rabbitmq_delayed_message_exchange插件，然后解压放置到RabbitMQ的插件目录。</p>\n<p>接下来，进入RabbitMQ的安装目录下的sbin目录，执行下面命令让该插件生效，然后重启RabbitMQ。</p>\n<pre><code class=\"shell\">rabbitmq-plugins enable rabbitmq_delayed_message_exchange</code></pre>\n<p>然后，我们再声明几个Bean：</p>\n<pre><code class=\"java\">@Configuration\npublic class DelayedRabbitMQConfig {\n    public static final String DELAYED_QUEUE_NAME = &quot;delay.queue.demo.delay.queue&quot;;\n    public static final String DELAYED_EXCHANGE_NAME = &quot;delay.queue.demo.delay.exchange&quot;;\n    public static final String DELAYED_ROUTING_KEY = &quot;delay.queue.demo.delay.routingkey&quot;;\n\n    @Bean\n    public Queue immediateQueue() {\n        return new Queue(DELAYED_QUEUE_NAME);\n    }\n\n    @Bean\n    public CustomExchange customExchange() {\n        Map&lt;String, Object&gt; args = new HashMap&lt;&gt;();\n        args.put(&quot;x-delayed-type&quot;, &quot;direct&quot;);\n        return new CustomExchange(DELAYED_EXCHANGE_NAME, &quot;x-delayed-message&quot;, true, false, args);\n    }\n\n    @Bean\n    public Binding bindingNotify(@Qualifier(&quot;immediateQueue&quot;) Queue queue,\n                                 @Qualifier(&quot;customExchange&quot;) CustomExchange customExchange) {\n        return BindingBuilder.bind(queue).to(customExchange).with(DELAYED_ROUTING_KEY).noargs();\n    }\n}</code></pre>\n<p>controller层再添加一个入口：</p>\n<pre><code class=\"java\">@RequestMapping(&quot;delayMsg2&quot;)\npublic void delayMsg2(String msg, Integer delayTime) {\n    log.info(&quot;当前时间：{},收到请求，msg:{},delayTime:{}&quot;, new Date(), msg, delayTime);\n    sender.sendDelayMsg(msg, delayTime);\n}</code></pre>\n<p>消息生产者的代码也需要修改：</p>\n<pre><code class=\"java\">public void sendDelayMsg(String msg, Integer delayTime) {\n    rabbitTemplate.convertAndSend(DELAYED_EXCHANGE_NAME, DELAYED_ROUTING_KEY, msg, a -&gt;{\n        a.getMessageProperties().setDelay(delayTime);\n        return a;\n    });\n}</code></pre>\n<p>最后，再创建一个消费者：</p>\n<pre><code class=\"java\">@RabbitListener(queues = DELAYED_QUEUE_NAME)\npublic void receiveD(Message message, Channel channel) throws IOException {\n    String msg = new String(message.getBody());\n    log.info(&quot;当前时间：{},延时队列收到消息：{}&quot;, new Date().toString(), msg);\n    channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);\n}</code></pre>\n<p>一切准备就绪，启动！然后分别访问以下链接：</p>\n<pre><code class=\"url\">http://localhost:8080/rabbitmq/delayMsg2?msg=msg1&amp;delayTime=20000\nhttp://localhost:8080/rabbitmq/delayMsg2?msg=msg2&amp;delayTime=2000</code></pre>\n<p>日志如下：</p>\n<pre><code class=\"java\">2019-07-28 17:28:13.729  INFO 25804 --- [nio-8080-exec-2] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 17:28:13 CST 2019,收到请求，msg:msg1,delayTime:20000\n2019-07-28 17:28:20.607  INFO 25804 --- [nio-8080-exec-1] c.m.d.controller.RabbitMQMsgController   : 当前时间：Sun Jul 28 17:28:20 CST 2019,收到请求，msg:msg2,delayTime:2000\n2019-07-28 17:28:22.624  INFO 25804 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 17:28:22 CST 2019,延时队列收到消息：msg2\n2019-07-28 17:28:33.751  INFO 25804 --- [ntContainer#1-1] c.m.d.mq.DeadLetterQueueConsumer         : 当前时间：Sun Jul 28 17:28:33 CST 2019,延时队列收到消息：msg1</code></pre>\n<p>第二个消息被先消费掉了，符合预期。至此，RabbitMQ实现延时队列的部分就完结了。</p>\n<h2 id=\"九、总结\"><a href=\"#九、总结\" class=\"headerlink\" title=\"九、总结\"></a>九、总结</h2><p>延时队列在需要延时处理的场景下非常有用，使用RabbitMQ来实现延时队列可以很好的利用RabbitMQ的特性，如：消息可靠发送、消息可靠投递、死信队列来保障消息至少被消费一次以及未被正确处理的消息不会被丢弃。另外，通过RabbitMQ集群的特性，可以很好的解决单点故障问题，不会因为单个节点挂掉导致延时队列不可用或者消息丢失。</p>\n<p>当然，延时队列还有很多其它选择，比如利用Java的DelayQueu，利用Redis的zset，利用Quartz或者利用kafka的时间轮，这些方式各有特点，但就像炉石传说一般，这些知识就好比手里的卡牌，知道的越多，可以用的卡牌也就越多，遇到问题便能游刃有余，所以需要大量的知识储备和经验积累才能打造出更出色的卡牌组合，让自己解决问题的能力得到更好的提升。</p>\n<p>但另一方面，随着时间的流逝和阅历的增长，越来越感觉到自己的能力有限，无法独自面对纷繁复杂且多变的业务需求，在很多方面需要其他人的协助才能很好的完成任务。也知道闻道有先后，术业有专攻，不会再狂妄自大，觉得自己能把所有事情都搞定，也将重心慢慢转移到研究如何有效的进行团队合作上来，我相信一个高度协调的团队永远比一个人战斗要更有价值。</p>\n<p>花了一个周末的时间完成了这篇文章，文中所有的代码都上传到了<a href=\"https://github.com/MFrank2016/delayed-queue-demo\" target=\"_blank\" rel=\"noopener\">github</a>如有需要可以自行查阅，希望能对你有帮助，如果有错误的地方，欢迎指正，也欢迎关注我的公众号进行留言交流。</p>\n"},{"title":"【聊聊认知】你的答案是什么","toc":true,"top":true,"cover":true,"date":"2021-05-30T05:45:35.000Z","_content":"\n每一个问题都有一个答案。\n\n天空为什么是蓝色？因为太阳光发生了散射。\n\n鸟为什么会飞？因为鸟有翅膀。\n\n苹果为什么会掉下来？因为万有引力。\n\n每个问题我们都可以为它找到一个答案，我们也总是习惯于为每个问题找到一个合理的解释。\n\n因为这些解释可以让我们在这个充满不确定性的世界里增加一些确定性，为我们带来安全感。\n\n但我想问的是，你真的知道答案吗？\n\n天空是蓝色，是因为太阳光发生了散射，这就是答案吗？\n\n我想，你应该知道太阳光其实是由七种颜色构成，那为什么我们看到的偏偏是蓝色？而不是其他颜色？\n\n鸟会飞是因为鸟有翅膀，那鸡也有翅膀，为什么鸡不能飞？\n\n既然存在万有引力，为什么地球没有掉进太阳里？\n\n只要你多问几个为什么，你就会发现，其实很多时候，我们并不是真正知道答案，我们只是以为我们自己知道。\n\n天空之所以看起来是蓝色，是因为太阳光在空气中发生了瑞利散射，光的波长越短，被散射的比例就越大，蓝光的波长比较短，所以我们看到的天空便是蓝色。\n\n鸟能飞确实很大一部分原因是因为它的翅膀，鸟的翅膀往下扇动时，会让翅膀上下方产生压差，从而获得让鸟上升的升力。但另一方面，鸟的身体结构比较轻盈，骨骼轻而薄且充满空气，让它们只需要更少的升力便能飞起来。而家养的鸡在长期的进化过程中，翅膀逐渐弱化，而身材却不断变得臃肿，翅膀的力量已经不足以支撑肥胖的身体飞起来了。\n\n地球没有掉入太阳里，是因为在绕着太阳公转的同时也在发生自转，产生的离心力与万有引力平衡了。\n\n当然，只要你想，我们还可以再进一步提出更深层次的问题。\n\n比如：我们为什么能看到蓝色？为什么会发生瑞利散射？鸟为什么会有翅膀？为什么人没有翅膀？地球为什么会自转？又为什么刚好是以这样的角速度自转？\n\n通过不断的提问，你会发现自己的答案其实并不那么可靠，也许在继续探索的过程中，你能找到更深层的答案。\n\n如果你细心一点的话，就会发现在解释过程中，我们其实是在用一些概念来解释和替换另一个概念，再往深处探索，便会追溯到一些定理、公理或者是规则和定义。\n\n我们在追寻答案的过程中，身处不同认知层级，我们就会有不同的答案。\n\n但这篇文章的目的并不是为了问倒你，只是想说，你以为的，可能只是你以为的。\n\n你有你的答案，世界另有答案。\n\n既然每个问题背后都有一个答案，每个问题也能引申出更深层的问题，那是否存在一个终极问题，这个世界又是否存在一个终极答案呢？\n\n如果这个宇宙起源于大爆炸，那大爆炸之前又有什么呢？如果这个宇宙的终点是热寂，那热寂之后又会有什么呢？这个宇宙又究竟为何是这样运行？是否有什么东西在背后操控着这一切？\n\n如果你求助于宗教，他们便会告诉你，这一切都是全知全能的神的安排，这个宇宙是神创造的，神掌控着这一切，于是一切便有了答案。毕竟大部分人只是想要得到一个答案，他们其实并不关心这个答案正确与否。\n\n但我不接受这样的答案，因为这个答案太简单了。如果这个世界真的是神所创造，那神又是从何而来？宇宙之大，必然还有其他星球也存在生命和高级文明，那为何这些神又如此钟爱地球呢？\n\n根据奥卡姆剃刀原理，如无必要，勿增实体。没有神，这个世界也能正常运转，所以神自然便没有存在的必要。\n\n我们不妨假设这个世界真的存在一个终极答案，并且假设有一天你能得到这个终极答案，知道了这个世界的全部真相，在找到它的一瞬间，所有的问题都得到了解答，不再有问题困扰。听起来似乎很美好，但是，然后呢？接下来你要做什么呢？你还可以做什么呢？\n\n在我看来，根本不存在最终的答案，但却可以追求更好的答案。与其在虚空之中苦苦追寻那虚无缥缈的真理，不如回归到生活中来求索。\n\n也许人生的答案就隐藏在你追寻答案的路上，藏在那些辗转难眠的夜里，藏在觥筹交错的酒杯里，藏在春风得意马蹄疾，一日看尽长安花的年少轻狂里，藏在会当凌绝顶，一览众山小的雄心壮志里。\n\n一心只想追寻答案，反而会离答案越来越远。\n\n这个世界存在无数的问题，自然也存在无数的答案。如果妄图将每个问题都寻根探底，那这一生未免太过短暂。\n\n面对这无数的问题，我倒是觉得不必感到惊慌失措，也不必感到焦虑，如果你换个角度来思考这个事情，也许会有趣的多。\n\n这个世界就好比一座矿山，那些或大或小的问题便是这矿山表面的石头，下面都埋藏着金矿，与其纠结该从哪块开始挖，不如趁早换把好铲子。\n\n我们的思想便是铲子，只有足够深度和广度才能挖出这金矿来。这样一来，那些问题不过都是送上门来的宝贝，何乐而不为呢？\n\n当然，也不能太过贪心，毕竟光阴荏苒，转瞬即逝，我们不可能挖到所有的金矿，所以需要做出选择，解决那些需要和想要解决的问题即可。\n\n至于那绝大多数问题，我们可以选择留白，允许自己不知道答案。\n\n而事实上，我们也并不需要知道所有的答案。\n\n古人并不知道地球其实是围绕太阳转的，但他们也一样能很好的生存下来。我们并不用知道汽车发动机的原理，也能轻易的开动一辆几吨重的汽车。我们不用知道电脑操作系统的实现细节，不用知道芯片的制作原理，也能很好的对电脑操控自如。\n\n对于那些不知道事，如果真的很感兴趣，那便过去铲上几铲子，挖出背后的金矿来。\n\n可以允许自己不知道答案，但却不能没有探索答案的能力。\n\n那又该如何去做呢？\n\n首先，也是最重要的一点，便是保持开放谦逊的态度，听得进他人意见，保持空杯心态。\n\n说起来简单，但做起来却很难。每当别人反对自己的观点时，便很容易进入防御状态，一心只想驳倒对方，观点的对错已经不再重要。\n\n而这往往是没有把自己的观点和自己这个人区分开来，别人反对的只是观点，并不是针对人。\n\n我们每个人都会有很多错误的观点，这算不上什么羞耻的事。如果被别人提出反对意见的观点刚好是错的，那又是一次自我修正和提升的机会。\n\n这次别人把金矿都挖出来送到你面前了，你却还在生闷气吗？\n\n承认自己错误，是追寻答案路上一个好的开端。\n\n在《三体》中有一句让我印象深刻。“弱小和无知不是生存的障碍，傲慢才是”。\n\n什么是傲慢，傲慢便是自以为掌握了这个世界的所有答案，并且拒绝接受其它可能的答案。\n\n但世界之大，宇宙之浩瀚，岂是我们可以轻易掌握的。正确的态度是，承认自己的无知，承认自己的答案可能是错的，随时准备好接受更好的答案。\n\n否则，当答案来敲门时，你可能无法认出它的模样，只能眼睁睁看它溜走。\n\n明清朝的闭关锁国与西方列强的大航海时代便是鲜明的对比。明清时期的统治者自认为天朝地大物博，心高气傲，他们的世界地图上，天朝处在世界的中心，而其它未知地方都填充着妖物野兽，不愿与其它文明平起平坐，实行闭关锁国政策，不仅严格限制通商，也进一步限制了人们的思想，禁止学习西方思想和技术，用四书五经来禁锢和控制人们的思想，导致在世界的发展浪潮中逐渐落后，一步步被西方列强分割瓦解。\n\n而与此同时，葡萄牙、西班牙等西方列强的世界地图上，还留有大量空白，吸引着他们不断朝外探索，而随着哥伦布对新大陆的发现，给他们带来了巨大的财富，彻底点燃了他们的探险欲望，让他们能极速扩张和发展，加速了资本的原始积累，开启了重新划分世界格局的大航海时代。\n\n明清的傲慢与自负，最终在西方列强的坚船利炮下破碎一地，以惨痛的结局落魄收场，让人唏嘘不已。\n\n“以史为鉴，可以知兴替，以铜为鉴，可以正衣冠，以人为鉴，可以知得失”。\n\n新时代的我们，自然不能重蹈覆辙，回顾历史，是为了更好的前行。只有保持开放谦逊的态度，才不至于在追寻答案的旅途中迷失。\n\n其次，作为一个很好切入点，可以多关注那些不符合自己预期的事物。如果有些事没有按照你期待的样子出现，不应该去质疑他人或者质疑这个世界，而应及时调整自己对这个世界的认知。\n\n我想你可能听说过“尤里卡时刻”，也就是常说的“啊哈时刻”，是人们在探索答案之时突然发现了答案线索的欢喜。\n\n但还有一个时刻，其实更加关键，那便是说出“这有点奇怪啊”的时刻。这是新的问题出现在眼前的时刻，是认知碰到壁垒的时刻，突破它便能打开更广阔的世界。\n\n十九世纪末，经典物理学已经达到了辉煌的顶点，开尔文男爵在英国皇家学会的演讲中宣称。物理大厦已经落成，后辈物理学家只需要做一些修补工作就行了。物理学的未来，将只有在小数点第六位后去寻找。但他也补充说，但物理学晴朗天空的不远处，还悬挂着两朵乌云。\n\n而真理与宝藏总会留给喜欢探索的冒险者，后辈物理学家沿着那两朵乌云探索，便发展出了开启现代物理学的相对论和量子力学，差点掀翻了经典物理学的大厦。而物理学也随之跨入了一个崭新的阶段，往前踏了一大步。\n\n那些意料之外的事物，也许正是突破认知的关键，积极面对，勇敢探索，往往有意想不到的收获。\n\n我们手里的答案，只是在当前认知下的临时答案，并不是最终答案。所以我们不必坚守自己的答案， 也不必坚守基于手中答案得来的观点。\n\n也许我今天的观点跟昨天的观点不一致了，但相对真理来说，却更加一致了。\n\n这个世界已经存在了很长时间，光是从人类出现开始算起，便已有了几百万年。\n\n在数万年前，便同样有人类和我们一样抬头望天，对这个宇宙的运行法则提出了疑问。他们站在这广阔的大地上，便觉“天圆如张盖，地方如棋局”，对这个世界形成了“天圆地方”的感性认知。其后又有人在质疑中不断探索，从盖天说到浑天说，从地心说到日心说，经过了无数代人的苦苦探寻，才有了我们现在习以为常的认知。\n\n但这个世界太大了，我们对这个世界的认识，不过只是盲人摸象。\n\n摸到象腿的人以为这个世界是根柱子，摸到象尾的人以为这个世界是根鞭子，而摸到象耳的人以为这个世界是把扇子，他们都以为自己掌握的就是真理，我们又何尝不是如此呢。\n\n但有幸的是，在这漫长的探索过程中，无数的名人大家已在他们的领域取得了可叹的成就，并且将他们的知识以文字的形式流传了下来，让我们能站在巨人的肩膀上重新认识世界，而不必一切都从头开始。\n\n我们不是站在终点回望过程，而是在中途回望过去。尽管每一个答案都是只临时的，但每一个答案的发现也都意味着我们又往前进了一步。\n\n怕什么真理无穷，进一寸有一寸的欢喜。\n\n生活很大，世界更大。如何认识这个世界，便会如何去生活，好好审视一下自己手中的答案吧，它能把你带到更好的未来吗？\n\n你是准备在这临时停靠站就此止步，还是准备继续奋力前行，奔往下一站？\n\n过去的早已过去，未来正呼啸而来。\n\n关于这个世界，你的答案是什么？\n","source":"_posts/thoughts/what-is-your-answer.md","raw":"---\ntitle: 【聊聊认知】你的答案是什么\ntags:\n  - Thoughts\ncategories:\n  - 生活\n  - 答案\ntoc: true\ntop: true\ncover: true\ndate: 2021-05-30 13:45:35\n---\n\n每一个问题都有一个答案。\n\n天空为什么是蓝色？因为太阳光发生了散射。\n\n鸟为什么会飞？因为鸟有翅膀。\n\n苹果为什么会掉下来？因为万有引力。\n\n每个问题我们都可以为它找到一个答案，我们也总是习惯于为每个问题找到一个合理的解释。\n\n因为这些解释可以让我们在这个充满不确定性的世界里增加一些确定性，为我们带来安全感。\n\n但我想问的是，你真的知道答案吗？\n\n天空是蓝色，是因为太阳光发生了散射，这就是答案吗？\n\n我想，你应该知道太阳光其实是由七种颜色构成，那为什么我们看到的偏偏是蓝色？而不是其他颜色？\n\n鸟会飞是因为鸟有翅膀，那鸡也有翅膀，为什么鸡不能飞？\n\n既然存在万有引力，为什么地球没有掉进太阳里？\n\n只要你多问几个为什么，你就会发现，其实很多时候，我们并不是真正知道答案，我们只是以为我们自己知道。\n\n天空之所以看起来是蓝色，是因为太阳光在空气中发生了瑞利散射，光的波长越短，被散射的比例就越大，蓝光的波长比较短，所以我们看到的天空便是蓝色。\n\n鸟能飞确实很大一部分原因是因为它的翅膀，鸟的翅膀往下扇动时，会让翅膀上下方产生压差，从而获得让鸟上升的升力。但另一方面，鸟的身体结构比较轻盈，骨骼轻而薄且充满空气，让它们只需要更少的升力便能飞起来。而家养的鸡在长期的进化过程中，翅膀逐渐弱化，而身材却不断变得臃肿，翅膀的力量已经不足以支撑肥胖的身体飞起来了。\n\n地球没有掉入太阳里，是因为在绕着太阳公转的同时也在发生自转，产生的离心力与万有引力平衡了。\n\n当然，只要你想，我们还可以再进一步提出更深层次的问题。\n\n比如：我们为什么能看到蓝色？为什么会发生瑞利散射？鸟为什么会有翅膀？为什么人没有翅膀？地球为什么会自转？又为什么刚好是以这样的角速度自转？\n\n通过不断的提问，你会发现自己的答案其实并不那么可靠，也许在继续探索的过程中，你能找到更深层的答案。\n\n如果你细心一点的话，就会发现在解释过程中，我们其实是在用一些概念来解释和替换另一个概念，再往深处探索，便会追溯到一些定理、公理或者是规则和定义。\n\n我们在追寻答案的过程中，身处不同认知层级，我们就会有不同的答案。\n\n但这篇文章的目的并不是为了问倒你，只是想说，你以为的，可能只是你以为的。\n\n你有你的答案，世界另有答案。\n\n既然每个问题背后都有一个答案，每个问题也能引申出更深层的问题，那是否存在一个终极问题，这个世界又是否存在一个终极答案呢？\n\n如果这个宇宙起源于大爆炸，那大爆炸之前又有什么呢？如果这个宇宙的终点是热寂，那热寂之后又会有什么呢？这个宇宙又究竟为何是这样运行？是否有什么东西在背后操控着这一切？\n\n如果你求助于宗教，他们便会告诉你，这一切都是全知全能的神的安排，这个宇宙是神创造的，神掌控着这一切，于是一切便有了答案。毕竟大部分人只是想要得到一个答案，他们其实并不关心这个答案正确与否。\n\n但我不接受这样的答案，因为这个答案太简单了。如果这个世界真的是神所创造，那神又是从何而来？宇宙之大，必然还有其他星球也存在生命和高级文明，那为何这些神又如此钟爱地球呢？\n\n根据奥卡姆剃刀原理，如无必要，勿增实体。没有神，这个世界也能正常运转，所以神自然便没有存在的必要。\n\n我们不妨假设这个世界真的存在一个终极答案，并且假设有一天你能得到这个终极答案，知道了这个世界的全部真相，在找到它的一瞬间，所有的问题都得到了解答，不再有问题困扰。听起来似乎很美好，但是，然后呢？接下来你要做什么呢？你还可以做什么呢？\n\n在我看来，根本不存在最终的答案，但却可以追求更好的答案。与其在虚空之中苦苦追寻那虚无缥缈的真理，不如回归到生活中来求索。\n\n也许人生的答案就隐藏在你追寻答案的路上，藏在那些辗转难眠的夜里，藏在觥筹交错的酒杯里，藏在春风得意马蹄疾，一日看尽长安花的年少轻狂里，藏在会当凌绝顶，一览众山小的雄心壮志里。\n\n一心只想追寻答案，反而会离答案越来越远。\n\n这个世界存在无数的问题，自然也存在无数的答案。如果妄图将每个问题都寻根探底，那这一生未免太过短暂。\n\n面对这无数的问题，我倒是觉得不必感到惊慌失措，也不必感到焦虑，如果你换个角度来思考这个事情，也许会有趣的多。\n\n这个世界就好比一座矿山，那些或大或小的问题便是这矿山表面的石头，下面都埋藏着金矿，与其纠结该从哪块开始挖，不如趁早换把好铲子。\n\n我们的思想便是铲子，只有足够深度和广度才能挖出这金矿来。这样一来，那些问题不过都是送上门来的宝贝，何乐而不为呢？\n\n当然，也不能太过贪心，毕竟光阴荏苒，转瞬即逝，我们不可能挖到所有的金矿，所以需要做出选择，解决那些需要和想要解决的问题即可。\n\n至于那绝大多数问题，我们可以选择留白，允许自己不知道答案。\n\n而事实上，我们也并不需要知道所有的答案。\n\n古人并不知道地球其实是围绕太阳转的，但他们也一样能很好的生存下来。我们并不用知道汽车发动机的原理，也能轻易的开动一辆几吨重的汽车。我们不用知道电脑操作系统的实现细节，不用知道芯片的制作原理，也能很好的对电脑操控自如。\n\n对于那些不知道事，如果真的很感兴趣，那便过去铲上几铲子，挖出背后的金矿来。\n\n可以允许自己不知道答案，但却不能没有探索答案的能力。\n\n那又该如何去做呢？\n\n首先，也是最重要的一点，便是保持开放谦逊的态度，听得进他人意见，保持空杯心态。\n\n说起来简单，但做起来却很难。每当别人反对自己的观点时，便很容易进入防御状态，一心只想驳倒对方，观点的对错已经不再重要。\n\n而这往往是没有把自己的观点和自己这个人区分开来，别人反对的只是观点，并不是针对人。\n\n我们每个人都会有很多错误的观点，这算不上什么羞耻的事。如果被别人提出反对意见的观点刚好是错的，那又是一次自我修正和提升的机会。\n\n这次别人把金矿都挖出来送到你面前了，你却还在生闷气吗？\n\n承认自己错误，是追寻答案路上一个好的开端。\n\n在《三体》中有一句让我印象深刻。“弱小和无知不是生存的障碍，傲慢才是”。\n\n什么是傲慢，傲慢便是自以为掌握了这个世界的所有答案，并且拒绝接受其它可能的答案。\n\n但世界之大，宇宙之浩瀚，岂是我们可以轻易掌握的。正确的态度是，承认自己的无知，承认自己的答案可能是错的，随时准备好接受更好的答案。\n\n否则，当答案来敲门时，你可能无法认出它的模样，只能眼睁睁看它溜走。\n\n明清朝的闭关锁国与西方列强的大航海时代便是鲜明的对比。明清时期的统治者自认为天朝地大物博，心高气傲，他们的世界地图上，天朝处在世界的中心，而其它未知地方都填充着妖物野兽，不愿与其它文明平起平坐，实行闭关锁国政策，不仅严格限制通商，也进一步限制了人们的思想，禁止学习西方思想和技术，用四书五经来禁锢和控制人们的思想，导致在世界的发展浪潮中逐渐落后，一步步被西方列强分割瓦解。\n\n而与此同时，葡萄牙、西班牙等西方列强的世界地图上，还留有大量空白，吸引着他们不断朝外探索，而随着哥伦布对新大陆的发现，给他们带来了巨大的财富，彻底点燃了他们的探险欲望，让他们能极速扩张和发展，加速了资本的原始积累，开启了重新划分世界格局的大航海时代。\n\n明清的傲慢与自负，最终在西方列强的坚船利炮下破碎一地，以惨痛的结局落魄收场，让人唏嘘不已。\n\n“以史为鉴，可以知兴替，以铜为鉴，可以正衣冠，以人为鉴，可以知得失”。\n\n新时代的我们，自然不能重蹈覆辙，回顾历史，是为了更好的前行。只有保持开放谦逊的态度，才不至于在追寻答案的旅途中迷失。\n\n其次，作为一个很好切入点，可以多关注那些不符合自己预期的事物。如果有些事没有按照你期待的样子出现，不应该去质疑他人或者质疑这个世界，而应及时调整自己对这个世界的认知。\n\n我想你可能听说过“尤里卡时刻”，也就是常说的“啊哈时刻”，是人们在探索答案之时突然发现了答案线索的欢喜。\n\n但还有一个时刻，其实更加关键，那便是说出“这有点奇怪啊”的时刻。这是新的问题出现在眼前的时刻，是认知碰到壁垒的时刻，突破它便能打开更广阔的世界。\n\n十九世纪末，经典物理学已经达到了辉煌的顶点，开尔文男爵在英国皇家学会的演讲中宣称。物理大厦已经落成，后辈物理学家只需要做一些修补工作就行了。物理学的未来，将只有在小数点第六位后去寻找。但他也补充说，但物理学晴朗天空的不远处，还悬挂着两朵乌云。\n\n而真理与宝藏总会留给喜欢探索的冒险者，后辈物理学家沿着那两朵乌云探索，便发展出了开启现代物理学的相对论和量子力学，差点掀翻了经典物理学的大厦。而物理学也随之跨入了一个崭新的阶段，往前踏了一大步。\n\n那些意料之外的事物，也许正是突破认知的关键，积极面对，勇敢探索，往往有意想不到的收获。\n\n我们手里的答案，只是在当前认知下的临时答案，并不是最终答案。所以我们不必坚守自己的答案， 也不必坚守基于手中答案得来的观点。\n\n也许我今天的观点跟昨天的观点不一致了，但相对真理来说，却更加一致了。\n\n这个世界已经存在了很长时间，光是从人类出现开始算起，便已有了几百万年。\n\n在数万年前，便同样有人类和我们一样抬头望天，对这个宇宙的运行法则提出了疑问。他们站在这广阔的大地上，便觉“天圆如张盖，地方如棋局”，对这个世界形成了“天圆地方”的感性认知。其后又有人在质疑中不断探索，从盖天说到浑天说，从地心说到日心说，经过了无数代人的苦苦探寻，才有了我们现在习以为常的认知。\n\n但这个世界太大了，我们对这个世界的认识，不过只是盲人摸象。\n\n摸到象腿的人以为这个世界是根柱子，摸到象尾的人以为这个世界是根鞭子，而摸到象耳的人以为这个世界是把扇子，他们都以为自己掌握的就是真理，我们又何尝不是如此呢。\n\n但有幸的是，在这漫长的探索过程中，无数的名人大家已在他们的领域取得了可叹的成就，并且将他们的知识以文字的形式流传了下来，让我们能站在巨人的肩膀上重新认识世界，而不必一切都从头开始。\n\n我们不是站在终点回望过程，而是在中途回望过去。尽管每一个答案都是只临时的，但每一个答案的发现也都意味着我们又往前进了一步。\n\n怕什么真理无穷，进一寸有一寸的欢喜。\n\n生活很大，世界更大。如何认识这个世界，便会如何去生活，好好审视一下自己手中的答案吧，它能把你带到更好的未来吗？\n\n你是准备在这临时停靠站就此止步，还是准备继续奋力前行，奔往下一站？\n\n过去的早已过去，未来正呼啸而来。\n\n关于这个世界，你的答案是什么？\n","slug":"thoughts/what-is-your-answer","published":1,"updated":"2021-05-30T05:45:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfbp001h5ohu1zyidzi3","content":"<p>每一个问题都有一个答案。</p>\n<p>天空为什么是蓝色？因为太阳光发生了散射。</p>\n<p>鸟为什么会飞？因为鸟有翅膀。</p>\n<p>苹果为什么会掉下来？因为万有引力。</p>\n<p>每个问题我们都可以为它找到一个答案，我们也总是习惯于为每个问题找到一个合理的解释。</p>\n<p>因为这些解释可以让我们在这个充满不确定性的世界里增加一些确定性，为我们带来安全感。</p>\n<p>但我想问的是，你真的知道答案吗？</p>\n<p>天空是蓝色，是因为太阳光发生了散射，这就是答案吗？</p>\n<p>我想，你应该知道太阳光其实是由七种颜色构成，那为什么我们看到的偏偏是蓝色？而不是其他颜色？</p>\n<p>鸟会飞是因为鸟有翅膀，那鸡也有翅膀，为什么鸡不能飞？</p>\n<p>既然存在万有引力，为什么地球没有掉进太阳里？</p>\n<p>只要你多问几个为什么，你就会发现，其实很多时候，我们并不是真正知道答案，我们只是以为我们自己知道。</p>\n<p>天空之所以看起来是蓝色，是因为太阳光在空气中发生了瑞利散射，光的波长越短，被散射的比例就越大，蓝光的波长比较短，所以我们看到的天空便是蓝色。</p>\n<p>鸟能飞确实很大一部分原因是因为它的翅膀，鸟的翅膀往下扇动时，会让翅膀上下方产生压差，从而获得让鸟上升的升力。但另一方面，鸟的身体结构比较轻盈，骨骼轻而薄且充满空气，让它们只需要更少的升力便能飞起来。而家养的鸡在长期的进化过程中，翅膀逐渐弱化，而身材却不断变得臃肿，翅膀的力量已经不足以支撑肥胖的身体飞起来了。</p>\n<p>地球没有掉入太阳里，是因为在绕着太阳公转的同时也在发生自转，产生的离心力与万有引力平衡了。</p>\n<p>当然，只要你想，我们还可以再进一步提出更深层次的问题。</p>\n<p>比如：我们为什么能看到蓝色？为什么会发生瑞利散射？鸟为什么会有翅膀？为什么人没有翅膀？地球为什么会自转？又为什么刚好是以这样的角速度自转？</p>\n<p>通过不断的提问，你会发现自己的答案其实并不那么可靠，也许在继续探索的过程中，你能找到更深层的答案。</p>\n<p>如果你细心一点的话，就会发现在解释过程中，我们其实是在用一些概念来解释和替换另一个概念，再往深处探索，便会追溯到一些定理、公理或者是规则和定义。</p>\n<p>我们在追寻答案的过程中，身处不同认知层级，我们就会有不同的答案。</p>\n<p>但这篇文章的目的并不是为了问倒你，只是想说，你以为的，可能只是你以为的。</p>\n<p>你有你的答案，世界另有答案。</p>\n<p>既然每个问题背后都有一个答案，每个问题也能引申出更深层的问题，那是否存在一个终极问题，这个世界又是否存在一个终极答案呢？</p>\n<p>如果这个宇宙起源于大爆炸，那大爆炸之前又有什么呢？如果这个宇宙的终点是热寂，那热寂之后又会有什么呢？这个宇宙又究竟为何是这样运行？是否有什么东西在背后操控着这一切？</p>\n<p>如果你求助于宗教，他们便会告诉你，这一切都是全知全能的神的安排，这个宇宙是神创造的，神掌控着这一切，于是一切便有了答案。毕竟大部分人只是想要得到一个答案，他们其实并不关心这个答案正确与否。</p>\n<p>但我不接受这样的答案，因为这个答案太简单了。如果这个世界真的是神所创造，那神又是从何而来？宇宙之大，必然还有其他星球也存在生命和高级文明，那为何这些神又如此钟爱地球呢？</p>\n<p>根据奥卡姆剃刀原理，如无必要，勿增实体。没有神，这个世界也能正常运转，所以神自然便没有存在的必要。</p>\n<p>我们不妨假设这个世界真的存在一个终极答案，并且假设有一天你能得到这个终极答案，知道了这个世界的全部真相，在找到它的一瞬间，所有的问题都得到了解答，不再有问题困扰。听起来似乎很美好，但是，然后呢？接下来你要做什么呢？你还可以做什么呢？</p>\n<p>在我看来，根本不存在最终的答案，但却可以追求更好的答案。与其在虚空之中苦苦追寻那虚无缥缈的真理，不如回归到生活中来求索。</p>\n<p>也许人生的答案就隐藏在你追寻答案的路上，藏在那些辗转难眠的夜里，藏在觥筹交错的酒杯里，藏在春风得意马蹄疾，一日看尽长安花的年少轻狂里，藏在会当凌绝顶，一览众山小的雄心壮志里。</p>\n<p>一心只想追寻答案，反而会离答案越来越远。</p>\n<p>这个世界存在无数的问题，自然也存在无数的答案。如果妄图将每个问题都寻根探底，那这一生未免太过短暂。</p>\n<p>面对这无数的问题，我倒是觉得不必感到惊慌失措，也不必感到焦虑，如果你换个角度来思考这个事情，也许会有趣的多。</p>\n<p>这个世界就好比一座矿山，那些或大或小的问题便是这矿山表面的石头，下面都埋藏着金矿，与其纠结该从哪块开始挖，不如趁早换把好铲子。</p>\n<p>我们的思想便是铲子，只有足够深度和广度才能挖出这金矿来。这样一来，那些问题不过都是送上门来的宝贝，何乐而不为呢？</p>\n<p>当然，也不能太过贪心，毕竟光阴荏苒，转瞬即逝，我们不可能挖到所有的金矿，所以需要做出选择，解决那些需要和想要解决的问题即可。</p>\n<p>至于那绝大多数问题，我们可以选择留白，允许自己不知道答案。</p>\n<p>而事实上，我们也并不需要知道所有的答案。</p>\n<p>古人并不知道地球其实是围绕太阳转的，但他们也一样能很好的生存下来。我们并不用知道汽车发动机的原理，也能轻易的开动一辆几吨重的汽车。我们不用知道电脑操作系统的实现细节，不用知道芯片的制作原理，也能很好的对电脑操控自如。</p>\n<p>对于那些不知道事，如果真的很感兴趣，那便过去铲上几铲子，挖出背后的金矿来。</p>\n<p>可以允许自己不知道答案，但却不能没有探索答案的能力。</p>\n<p>那又该如何去做呢？</p>\n<p>首先，也是最重要的一点，便是保持开放谦逊的态度，听得进他人意见，保持空杯心态。</p>\n<p>说起来简单，但做起来却很难。每当别人反对自己的观点时，便很容易进入防御状态，一心只想驳倒对方，观点的对错已经不再重要。</p>\n<p>而这往往是没有把自己的观点和自己这个人区分开来，别人反对的只是观点，并不是针对人。</p>\n<p>我们每个人都会有很多错误的观点，这算不上什么羞耻的事。如果被别人提出反对意见的观点刚好是错的，那又是一次自我修正和提升的机会。</p>\n<p>这次别人把金矿都挖出来送到你面前了，你却还在生闷气吗？</p>\n<p>承认自己错误，是追寻答案路上一个好的开端。</p>\n<p>在《三体》中有一句让我印象深刻。“弱小和无知不是生存的障碍，傲慢才是”。</p>\n<p>什么是傲慢，傲慢便是自以为掌握了这个世界的所有答案，并且拒绝接受其它可能的答案。</p>\n<p>但世界之大，宇宙之浩瀚，岂是我们可以轻易掌握的。正确的态度是，承认自己的无知，承认自己的答案可能是错的，随时准备好接受更好的答案。</p>\n<p>否则，当答案来敲门时，你可能无法认出它的模样，只能眼睁睁看它溜走。</p>\n<p>明清朝的闭关锁国与西方列强的大航海时代便是鲜明的对比。明清时期的统治者自认为天朝地大物博，心高气傲，他们的世界地图上，天朝处在世界的中心，而其它未知地方都填充着妖物野兽，不愿与其它文明平起平坐，实行闭关锁国政策，不仅严格限制通商，也进一步限制了人们的思想，禁止学习西方思想和技术，用四书五经来禁锢和控制人们的思想，导致在世界的发展浪潮中逐渐落后，一步步被西方列强分割瓦解。</p>\n<p>而与此同时，葡萄牙、西班牙等西方列强的世界地图上，还留有大量空白，吸引着他们不断朝外探索，而随着哥伦布对新大陆的发现，给他们带来了巨大的财富，彻底点燃了他们的探险欲望，让他们能极速扩张和发展，加速了资本的原始积累，开启了重新划分世界格局的大航海时代。</p>\n<p>明清的傲慢与自负，最终在西方列强的坚船利炮下破碎一地，以惨痛的结局落魄收场，让人唏嘘不已。</p>\n<p>“以史为鉴，可以知兴替，以铜为鉴，可以正衣冠，以人为鉴，可以知得失”。</p>\n<p>新时代的我们，自然不能重蹈覆辙，回顾历史，是为了更好的前行。只有保持开放谦逊的态度，才不至于在追寻答案的旅途中迷失。</p>\n<p>其次，作为一个很好切入点，可以多关注那些不符合自己预期的事物。如果有些事没有按照你期待的样子出现，不应该去质疑他人或者质疑这个世界，而应及时调整自己对这个世界的认知。</p>\n<p>我想你可能听说过“尤里卡时刻”，也就是常说的“啊哈时刻”，是人们在探索答案之时突然发现了答案线索的欢喜。</p>\n<p>但还有一个时刻，其实更加关键，那便是说出“这有点奇怪啊”的时刻。这是新的问题出现在眼前的时刻，是认知碰到壁垒的时刻，突破它便能打开更广阔的世界。</p>\n<p>十九世纪末，经典物理学已经达到了辉煌的顶点，开尔文男爵在英国皇家学会的演讲中宣称。物理大厦已经落成，后辈物理学家只需要做一些修补工作就行了。物理学的未来，将只有在小数点第六位后去寻找。但他也补充说，但物理学晴朗天空的不远处，还悬挂着两朵乌云。</p>\n<p>而真理与宝藏总会留给喜欢探索的冒险者，后辈物理学家沿着那两朵乌云探索，便发展出了开启现代物理学的相对论和量子力学，差点掀翻了经典物理学的大厦。而物理学也随之跨入了一个崭新的阶段，往前踏了一大步。</p>\n<p>那些意料之外的事物，也许正是突破认知的关键，积极面对，勇敢探索，往往有意想不到的收获。</p>\n<p>我们手里的答案，只是在当前认知下的临时答案，并不是最终答案。所以我们不必坚守自己的答案， 也不必坚守基于手中答案得来的观点。</p>\n<p>也许我今天的观点跟昨天的观点不一致了，但相对真理来说，却更加一致了。</p>\n<p>这个世界已经存在了很长时间，光是从人类出现开始算起，便已有了几百万年。</p>\n<p>在数万年前，便同样有人类和我们一样抬头望天，对这个宇宙的运行法则提出了疑问。他们站在这广阔的大地上，便觉“天圆如张盖，地方如棋局”，对这个世界形成了“天圆地方”的感性认知。其后又有人在质疑中不断探索，从盖天说到浑天说，从地心说到日心说，经过了无数代人的苦苦探寻，才有了我们现在习以为常的认知。</p>\n<p>但这个世界太大了，我们对这个世界的认识，不过只是盲人摸象。</p>\n<p>摸到象腿的人以为这个世界是根柱子，摸到象尾的人以为这个世界是根鞭子，而摸到象耳的人以为这个世界是把扇子，他们都以为自己掌握的就是真理，我们又何尝不是如此呢。</p>\n<p>但有幸的是，在这漫长的探索过程中，无数的名人大家已在他们的领域取得了可叹的成就，并且将他们的知识以文字的形式流传了下来，让我们能站在巨人的肩膀上重新认识世界，而不必一切都从头开始。</p>\n<p>我们不是站在终点回望过程，而是在中途回望过去。尽管每一个答案都是只临时的，但每一个答案的发现也都意味着我们又往前进了一步。</p>\n<p>怕什么真理无穷，进一寸有一寸的欢喜。</p>\n<p>生活很大，世界更大。如何认识这个世界，便会如何去生活，好好审视一下自己手中的答案吧，它能把你带到更好的未来吗？</p>\n<p>你是准备在这临时停靠站就此止步，还是准备继续奋力前行，奔往下一站？</p>\n<p>过去的早已过去，未来正呼啸而来。</p>\n<p>关于这个世界，你的答案是什么？</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<p>每一个问题都有一个答案。</p>\n<p>天空为什么是蓝色？因为太阳光发生了散射。</p>\n<p>鸟为什么会飞？因为鸟有翅膀。</p>\n<p>苹果为什么会掉下来？因为万有引力。</p>\n<p>每个问题我们都可以为它找到一个答案，我们也总是习惯于为每个问题找到一个合理的解释。</p>\n<p>因为这些解释可以让我们在这个充满不确定性的世界里增加一些确定性，为我们带来安全感。</p>\n<p>但我想问的是，你真的知道答案吗？</p>\n<p>天空是蓝色，是因为太阳光发生了散射，这就是答案吗？</p>\n<p>我想，你应该知道太阳光其实是由七种颜色构成，那为什么我们看到的偏偏是蓝色？而不是其他颜色？</p>\n<p>鸟会飞是因为鸟有翅膀，那鸡也有翅膀，为什么鸡不能飞？</p>\n<p>既然存在万有引力，为什么地球没有掉进太阳里？</p>\n<p>只要你多问几个为什么，你就会发现，其实很多时候，我们并不是真正知道答案，我们只是以为我们自己知道。</p>\n<p>天空之所以看起来是蓝色，是因为太阳光在空气中发生了瑞利散射，光的波长越短，被散射的比例就越大，蓝光的波长比较短，所以我们看到的天空便是蓝色。</p>\n<p>鸟能飞确实很大一部分原因是因为它的翅膀，鸟的翅膀往下扇动时，会让翅膀上下方产生压差，从而获得让鸟上升的升力。但另一方面，鸟的身体结构比较轻盈，骨骼轻而薄且充满空气，让它们只需要更少的升力便能飞起来。而家养的鸡在长期的进化过程中，翅膀逐渐弱化，而身材却不断变得臃肿，翅膀的力量已经不足以支撑肥胖的身体飞起来了。</p>\n<p>地球没有掉入太阳里，是因为在绕着太阳公转的同时也在发生自转，产生的离心力与万有引力平衡了。</p>\n<p>当然，只要你想，我们还可以再进一步提出更深层次的问题。</p>\n<p>比如：我们为什么能看到蓝色？为什么会发生瑞利散射？鸟为什么会有翅膀？为什么人没有翅膀？地球为什么会自转？又为什么刚好是以这样的角速度自转？</p>\n<p>通过不断的提问，你会发现自己的答案其实并不那么可靠，也许在继续探索的过程中，你能找到更深层的答案。</p>\n<p>如果你细心一点的话，就会发现在解释过程中，我们其实是在用一些概念来解释和替换另一个概念，再往深处探索，便会追溯到一些定理、公理或者是规则和定义。</p>\n<p>我们在追寻答案的过程中，身处不同认知层级，我们就会有不同的答案。</p>\n<p>但这篇文章的目的并不是为了问倒你，只是想说，你以为的，可能只是你以为的。</p>\n<p>你有你的答案，世界另有答案。</p>\n<p>既然每个问题背后都有一个答案，每个问题也能引申出更深层的问题，那是否存在一个终极问题，这个世界又是否存在一个终极答案呢？</p>\n<p>如果这个宇宙起源于大爆炸，那大爆炸之前又有什么呢？如果这个宇宙的终点是热寂，那热寂之后又会有什么呢？这个宇宙又究竟为何是这样运行？是否有什么东西在背后操控着这一切？</p>\n<p>如果你求助于宗教，他们便会告诉你，这一切都是全知全能的神的安排，这个宇宙是神创造的，神掌控着这一切，于是一切便有了答案。毕竟大部分人只是想要得到一个答案，他们其实并不关心这个答案正确与否。</p>\n<p>但我不接受这样的答案，因为这个答案太简单了。如果这个世界真的是神所创造，那神又是从何而来？宇宙之大，必然还有其他星球也存在生命和高级文明，那为何这些神又如此钟爱地球呢？</p>\n<p>根据奥卡姆剃刀原理，如无必要，勿增实体。没有神，这个世界也能正常运转，所以神自然便没有存在的必要。</p>\n<p>我们不妨假设这个世界真的存在一个终极答案，并且假设有一天你能得到这个终极答案，知道了这个世界的全部真相，在找到它的一瞬间，所有的问题都得到了解答，不再有问题困扰。听起来似乎很美好，但是，然后呢？接下来你要做什么呢？你还可以做什么呢？</p>\n<p>在我看来，根本不存在最终的答案，但却可以追求更好的答案。与其在虚空之中苦苦追寻那虚无缥缈的真理，不如回归到生活中来求索。</p>\n<p>也许人生的答案就隐藏在你追寻答案的路上，藏在那些辗转难眠的夜里，藏在觥筹交错的酒杯里，藏在春风得意马蹄疾，一日看尽长安花的年少轻狂里，藏在会当凌绝顶，一览众山小的雄心壮志里。</p>\n<p>一心只想追寻答案，反而会离答案越来越远。</p>\n<p>这个世界存在无数的问题，自然也存在无数的答案。如果妄图将每个问题都寻根探底，那这一生未免太过短暂。</p>\n<p>面对这无数的问题，我倒是觉得不必感到惊慌失措，也不必感到焦虑，如果你换个角度来思考这个事情，也许会有趣的多。</p>\n<p>这个世界就好比一座矿山，那些或大或小的问题便是这矿山表面的石头，下面都埋藏着金矿，与其纠结该从哪块开始挖，不如趁早换把好铲子。</p>\n<p>我们的思想便是铲子，只有足够深度和广度才能挖出这金矿来。这样一来，那些问题不过都是送上门来的宝贝，何乐而不为呢？</p>\n<p>当然，也不能太过贪心，毕竟光阴荏苒，转瞬即逝，我们不可能挖到所有的金矿，所以需要做出选择，解决那些需要和想要解决的问题即可。</p>\n<p>至于那绝大多数问题，我们可以选择留白，允许自己不知道答案。</p>\n<p>而事实上，我们也并不需要知道所有的答案。</p>\n<p>古人并不知道地球其实是围绕太阳转的，但他们也一样能很好的生存下来。我们并不用知道汽车发动机的原理，也能轻易的开动一辆几吨重的汽车。我们不用知道电脑操作系统的实现细节，不用知道芯片的制作原理，也能很好的对电脑操控自如。</p>\n<p>对于那些不知道事，如果真的很感兴趣，那便过去铲上几铲子，挖出背后的金矿来。</p>\n<p>可以允许自己不知道答案，但却不能没有探索答案的能力。</p>\n<p>那又该如何去做呢？</p>\n<p>首先，也是最重要的一点，便是保持开放谦逊的态度，听得进他人意见，保持空杯心态。</p>\n<p>说起来简单，但做起来却很难。每当别人反对自己的观点时，便很容易进入防御状态，一心只想驳倒对方，观点的对错已经不再重要。</p>\n<p>而这往往是没有把自己的观点和自己这个人区分开来，别人反对的只是观点，并不是针对人。</p>\n<p>我们每个人都会有很多错误的观点，这算不上什么羞耻的事。如果被别人提出反对意见的观点刚好是错的，那又是一次自我修正和提升的机会。</p>\n<p>这次别人把金矿都挖出来送到你面前了，你却还在生闷气吗？</p>\n<p>承认自己错误，是追寻答案路上一个好的开端。</p>\n<p>在《三体》中有一句让我印象深刻。“弱小和无知不是生存的障碍，傲慢才是”。</p>\n<p>什么是傲慢，傲慢便是自以为掌握了这个世界的所有答案，并且拒绝接受其它可能的答案。</p>\n<p>但世界之大，宇宙之浩瀚，岂是我们可以轻易掌握的。正确的态度是，承认自己的无知，承认自己的答案可能是错的，随时准备好接受更好的答案。</p>\n<p>否则，当答案来敲门时，你可能无法认出它的模样，只能眼睁睁看它溜走。</p>\n<p>明清朝的闭关锁国与西方列强的大航海时代便是鲜明的对比。明清时期的统治者自认为天朝地大物博，心高气傲，他们的世界地图上，天朝处在世界的中心，而其它未知地方都填充着妖物野兽，不愿与其它文明平起平坐，实行闭关锁国政策，不仅严格限制通商，也进一步限制了人们的思想，禁止学习西方思想和技术，用四书五经来禁锢和控制人们的思想，导致在世界的发展浪潮中逐渐落后，一步步被西方列强分割瓦解。</p>\n<p>而与此同时，葡萄牙、西班牙等西方列强的世界地图上，还留有大量空白，吸引着他们不断朝外探索，而随着哥伦布对新大陆的发现，给他们带来了巨大的财富，彻底点燃了他们的探险欲望，让他们能极速扩张和发展，加速了资本的原始积累，开启了重新划分世界格局的大航海时代。</p>\n<p>明清的傲慢与自负，最终在西方列强的坚船利炮下破碎一地，以惨痛的结局落魄收场，让人唏嘘不已。</p>\n<p>“以史为鉴，可以知兴替，以铜为鉴，可以正衣冠，以人为鉴，可以知得失”。</p>\n<p>新时代的我们，自然不能重蹈覆辙，回顾历史，是为了更好的前行。只有保持开放谦逊的态度，才不至于在追寻答案的旅途中迷失。</p>\n<p>其次，作为一个很好切入点，可以多关注那些不符合自己预期的事物。如果有些事没有按照你期待的样子出现，不应该去质疑他人或者质疑这个世界，而应及时调整自己对这个世界的认知。</p>\n<p>我想你可能听说过“尤里卡时刻”，也就是常说的“啊哈时刻”，是人们在探索答案之时突然发现了答案线索的欢喜。</p>\n<p>但还有一个时刻，其实更加关键，那便是说出“这有点奇怪啊”的时刻。这是新的问题出现在眼前的时刻，是认知碰到壁垒的时刻，突破它便能打开更广阔的世界。</p>\n<p>十九世纪末，经典物理学已经达到了辉煌的顶点，开尔文男爵在英国皇家学会的演讲中宣称。物理大厦已经落成，后辈物理学家只需要做一些修补工作就行了。物理学的未来，将只有在小数点第六位后去寻找。但他也补充说，但物理学晴朗天空的不远处，还悬挂着两朵乌云。</p>\n<p>而真理与宝藏总会留给喜欢探索的冒险者，后辈物理学家沿着那两朵乌云探索，便发展出了开启现代物理学的相对论和量子力学，差点掀翻了经典物理学的大厦。而物理学也随之跨入了一个崭新的阶段，往前踏了一大步。</p>\n<p>那些意料之外的事物，也许正是突破认知的关键，积极面对，勇敢探索，往往有意想不到的收获。</p>\n<p>我们手里的答案，只是在当前认知下的临时答案，并不是最终答案。所以我们不必坚守自己的答案， 也不必坚守基于手中答案得来的观点。</p>\n<p>也许我今天的观点跟昨天的观点不一致了，但相对真理来说，却更加一致了。</p>\n<p>这个世界已经存在了很长时间，光是从人类出现开始算起，便已有了几百万年。</p>\n<p>在数万年前，便同样有人类和我们一样抬头望天，对这个宇宙的运行法则提出了疑问。他们站在这广阔的大地上，便觉“天圆如张盖，地方如棋局”，对这个世界形成了“天圆地方”的感性认知。其后又有人在质疑中不断探索，从盖天说到浑天说，从地心说到日心说，经过了无数代人的苦苦探寻，才有了我们现在习以为常的认知。</p>\n<p>但这个世界太大了，我们对这个世界的认识，不过只是盲人摸象。</p>\n<p>摸到象腿的人以为这个世界是根柱子，摸到象尾的人以为这个世界是根鞭子，而摸到象耳的人以为这个世界是把扇子，他们都以为自己掌握的就是真理，我们又何尝不是如此呢。</p>\n<p>但有幸的是，在这漫长的探索过程中，无数的名人大家已在他们的领域取得了可叹的成就，并且将他们的知识以文字的形式流传了下来，让我们能站在巨人的肩膀上重新认识世界，而不必一切都从头开始。</p>\n<p>我们不是站在终点回望过程，而是在中途回望过去。尽管每一个答案都是只临时的，但每一个答案的发现也都意味着我们又往前进了一步。</p>\n<p>怕什么真理无穷，进一寸有一寸的欢喜。</p>\n<p>生活很大，世界更大。如何认识这个世界，便会如何去生活，好好审视一下自己手中的答案吧，它能把你带到更好的未来吗？</p>\n<p>你是准备在这临时停靠站就此止步，还是准备继续奋力前行，奔往下一站？</p>\n<p>过去的早已过去，未来正呼啸而来。</p>\n<p>关于这个世界，你的答案是什么？</p>\n"},{"title":"【聊聊认知】你以为你以为的就是你以为的吗","toc":true,"top":true,"cover":true,"date":"2020-05-31T13:00:50.000Z","_content":"\n## 前言\n\n这周是双休，时间比较充裕，睡睡懒觉后发现还有时间，便想写写文章，来对前段时间的思考做一个总结。\n\n似乎是从知识付费兴起之后，`认知`这个词便开始成为了热门词汇，似乎只要谈到`认知`，便能将自身高度提升一个档次。\n\n刚来上海的时候，还是一个愣头青（虽然一直都是），对`认知`这种东西嗤之以鼻，觉得不过是资本主义用来收割年轻韭菜的迷魂汤，但后来经历的一些事，改变了我的看法。其中有一件事让我记忆犹新。\n\n时间回到2018年，那时的创业新风口是带有大数据和人工智能加持的*新零售*，而我也刚好进入了一家做新零售的创业公司，在货架组做着后端开发的工作。\n\n一天，朋友约我一起吃饭，在吃饭聊天时，相互寒暄了近况，我说我在的公司是做*新零售*的，朋友对此似乎很感兴趣，并说了很多关于*新零售*的见解，大数据、推荐算法、人工智能、用户画像等等名词顺手捏来，当我听得一头雾水时，朋友问我有什么看法，我却支支吾吾的说道，我们做的不就是把货架铺到人家公司里，让商品离人更近一点，缩短商品的最后一公里，然后再弄一个小程序入口给用户使用，不就这么多东西吗。可想而知，最后只得跟朋友面面相觑。\n\n现在想来，当时我对于自己所从事行业的认识确实有失偏颇，只知道*新零售*是当时热门的风口，大家都在讨论，大家都觉得这个行业前途无量，而离它太近却反而看不到它的全貌，只见树木不见森林。但这也跟我并没有主动去思考这件事有着莫大的关系。那天的聊天，让我逐渐意识到自己的思维定势和盲区，而且不仅仅是工作，对于生活中其它很多事情，关于未来的思考，也是如此。我想，要是一直这样下去，恐怕真要做一辈子低阶码农了。\n\n于是，我便开始认真对待提升`认知`这件事了。\n\n把我领进门的第一本书，应该算是`成甲`老师的《好好学习》，学习了关于如何管理个人知识的方法论。里面有几处提到了`万维钢`老师的《精英日课》，于是我又去学习了这门课程，万老师的《精英日课》里会讲解历史上重要的科学发现和现在最前沿的科学理论，也会挑一些有意思的书来进行讲解，极大的扩展了我的认知视野。其中万老师讲解的一本书让我觉得很有意思，那便是以色列作家`尤瓦尔赫拉利`的《人类简史》，听完后觉得不过瘾，于是又找到书来读。这本书可以说给予了我极大的震惊，让我发现原来我生活的世界并不是像我以为的那样，就像万老师所说，**“你有你的计划，世界另有计划”**。而且，我发现，如果思考一些比我自身更大的事物时，生活中那些繁琐的小事便显得不足一提，很多烦恼也随之消失。\n\n我想，不能在将来被这个世界所抛弃，我必须知道这个世界正在发生什么，未来最有可能的方向是什么。于是我找了更多的书和课程来学习，也不断提升自己认知的高度。过年回家跟好友聊天时，他说，你好像成熟了许多，我微笑着，因为我知道这一切是怎么发生的。\n\n说了这么多废话，无非是想表达`认知`这个东西确实很重要。下面是我关于“`认知`是什么”以及“`认知偏差`是如何产生的”这两件事的一些见解和总结，希望也能对你有所帮助。\n\n## 什么是认知\n\n> `认知`是指人们**获得知识**或**应用知识**的过程，或**信息加工**的过程，这是人的最基本的心理过程。它包括*感觉*、*知觉*、*记忆*、*思维*、*想像*和*语言*等。人脑接受外界输入的信息，经过头脑的加工处理，转换成内在的心理活动，进而支配人的行为，这个过程就是**信息加工**的过程，也就是`认知过程`。（来自`百度百科`）\n\n简单来说，`认知`就是我们如何去认识和了解这个世界的过程。我们通过五官感觉来收集信息，然后在大脑中进行处理加工，从而产生知识。这是一个看似简单，却极其复杂的过程，涉及到我们人体内的一系列生化神经过程，最终产生出知识，“存储”在我们的大脑中，进而为后续行动提供支持和指导。\n\n我们出生时认知过程其实大同小异，虽然智力水平有高低，不过出类拔萃者总是少数，但成年后形成的认知水平却千差万别。有人说，*人与人之间的差距比人与猪之间的差距还大*，这里说的差距，其实就是`认知`上的差距。想要提升`自我认知`，便需要对`认知过程`有一个正确的认识。\n\n`认知过程`是我们获取知识的必要手段，而这些知识可以指导我们的生存发展。\n\n如果把从信息中提炼知识的过程比作是从金矿中提取黄金，有的人可以提取出纯度很高的金子，而有人却只能从中得到一堆的杂质。**提升认知，本质上来说，就是提升从复杂信息中筛选提取出有用信息并归纳总结的能力**。\n\n## 认知偏差\n\n随着信息技术的发展，我们每天能接触到信息成指数型增加，每天都有无数的信息试图进入我们的视野，这些信息有真有假，质量也参差不齐。\n\n那些以牟利为目的而批量生产的垃圾文章，看似有用却食之无味的鸡汤文，看起来大快人心却误人心智的网络爽文，就像迷魂汤一样，试图麻醉我们的心智，抢占我们的注意力，让我们活在虚无的幻想世界里。更不用说越来越多为了吸引眼球而造谣生事的文章，通过片面截取，东拼西凑，断章取义甚至直接捏造是非，从而推导出看似有趣实则荒谬的结论。\n\n如果你相信了一个错误的观点，从而产生了错误的知识，那么很可能会从这个错误的知识推导出更多错误的知识。**这些错误的知识会像病毒一样会自我繁殖**，占据你的大脑，扰乱你的行为。所以只有掌握正确的炼金法则，才能在这个复杂的世界里找到生存发展之路。\n\n我们每隔一段时间都会检测自己的视力，以对我们的眼镜度数做出调整，来更好的看清这个世界。如果把我们的思想则比作是认知这个世界的眼镜的话，你可曾检测过自己的`认知视力`？如果眼镜度数不对，那我们对世界的认知也会是模糊失真的。而我们的`认知`也会指导我们的判断和行为，**错误的认知很可能会带来错误的判断和选择**。\n\n那么我们为什么会产生错误的认知呢？这就跟我们大脑的运行机制有关。\n\n我们大脑的思考框架由两部分组成：`系统1`和`系统2`。`系统1`代指*无意识*的思考模式，`系统2`代指*有意识*进行的思考模式。`系统1`思考或判断非常快捷，因此我们往往第一时间通过它在脑海中形成主观印象和初步判断。但有时`系统1`可能得不到结论或是得到错误的结论，因此我们也经常求助`系统2`进行更为复杂和费力的思考过程，以图补充或纠正系统1。但不等于`系统1`是感性的、`系统2`是理性的。实际上`系统2`经常受到`系统1`的影响。这种影响可能是正确的，也可能是错误的。而且`系统2`很懒惰，经常疏于校验，从而无法纠正`系统1`形成的错误。\n\n当`系统1`产生的错误被`系统2`所接受或者`系统2`犯错时，`认知偏差`就产生了。\n\n## 演绎法\n\n我们认知这个世界主要通过两种方式，`演绎法`和`归纳法`。\n\n`演绎法`是使用我们自定的一些客观规律、基本原则和基本假设作为前提，对已知的信息进行加工处理，进一步推演得出未知的结论。\n\n下面是来自维基百科的解释：\n\n> `演绎推理`、`正向推理`在传统的亚里士多德逻辑中是“结论，可从叫做‘前提’的已知事实，‘必然地’得出的推理”。如果前提为真，则结论必然为真。这区别于溯因推理和归纳推理：它们的前提可以预测出高概率的结论，但是不确保结论为真。\n“演绎推理”还可以定义为结论在普遍性上不大于前提的推理，或“结论在确定性上，同前提一样”的推理。\n\n举例来说，如果我们知道明天要下雨，便会做出一个决策，明天出门要带伞。我们把这个简单的决策过程拆解一下：\n\n> 基本判断：下雨出门要带伞\n> 信息：明天会下雨\n> 结论：明天出门要带伞\n\n再举一个例子，亚里士多德的三段论：\n\n> 基本判断：所有人都会死\n> 信息：苏格拉底是人\n> 结论：苏格拉底会死\n\n这个过程是一个`逻辑推演`的过程，**根据基本假设和信息来推断出未知的信息**。\n\n如果你看过《名侦探柯南》或者《福尔摩斯》等侦探题材的小说或电影，一定会对侦探们对逻辑推理的巧妙运用留下深刻印象。\n\n演绎法看似严谨，但对于普通人来说，其实每一步都有可能会出错，从而导致`认知偏差`的出现。\n\n首先，**我们用作前提的基本假设和原则也许来源于人云亦云或当下流行的观点**。比如“仗义每逢屠狗辈，负心多是读书人”，“长得帅的人通常性格不好”，“渣男锡纸烫，渣女大波浪”，这些简单粗暴而又朗朗上口，能迎合内心意淫想法的观点很容易在不经意间溜进我们的思想。\n\n其次，**基本规律可能来自于我们的生活经验总结**，而由于我们生活范围和经历有限，加上我们以自我为中心的心理因素，总结出的基本规律也许只是小范围内有效，甚至可能完全无效。\n\n另外，**我们得到的信息可能并不准确甚至完全是错的**。你也许只是在跟朋友聊天时听朋友随口说了一句天气情况，而他可能看错了日期。更何况天气还隐含了概率的因素，即使是大概率事件也不代表一定会发生。\n\n最后，我们在**推演结论的过程中可能会因为逻辑错误而得出错误的结论**。比如：“美国人会说英语，Alice 会说英语，所以 Alice 是美国人”，“你喜欢用苹果手机，而苹果手机很贵，所以你喜欢用很贵的东西”，这些让人很容易疏忽的常见的`逻辑谬误`也是产生`认知偏差`的重要原因。\n\n## 归纳法\n\n说完了`演绎法`再来看看`归纳法`。\n\n`演绎法`的推演过程是**由一般到特殊**，而`归纳法`恰好相反。`归纳法`是**对事物进行归纳总结，从普遍的现象中总结出一般性的结论**。\n\n下面解释来自维基百科：\n\n> `归纳法`或`归纳推理`，有时叫做`归纳逻辑`，是论证的前提支持结论但不确保结论的推理过程。它基于对特殊的代表的有限观察，把性质或关系归结到类型；或基于对反复再现的现象的模式的有限观察，公式表达规律。\n\n举个例子：\n\n> 冰是冷的。\n弹子球在击打球杆的时候移动。\n\n推断出普遍的命题如：\n\n> 所有冰都是冷的。\n所有弹子球都在击打球杆的时候移动。\n\n正如你看到的那样，归纳法很容易出现过度普遍化的情况，我们经常会根据我们观察到的有限例子具有某种特性，便轻率的得出其它事物也具有相同特性的结论。\n\n举个很常见的例子，很多人都会说，“湖南人都喜欢吃辣”，于是遇到像我这样不那么喜欢吃辣的湖南人时，反而会质问我，“你到底是不是湖南人”。他们似乎把“大多数”这个词给省略掉了，“大多数湖南人喜欢吃辣”不代表“所有湖南人都喜欢吃辣”。而且这个大多数也仅仅是观测到的结果，具体比例也并没有数据支撑。\n\n（关于吃辣，我刚好在一席上发现了一个很有意思的视频，可以消除一些大家对于辣椒的误解，大家有兴趣也可以看看：https://yixi.tv/speech/831。）\n\n还有一个更出名的例子，那便是`黑天鹅`，这也是塔勒布的`《黑天鹅》`一书中所阐述的主要概念。\n\n> 在18世纪欧洲人发现澳洲之前，由于他们所见过的天鹅都是白色的，所以在当时欧洲人眼中，天鹅只有白色的品种。直到欧洲人发现了澳洲，看到当地的黑天鹅后，人们认识天鹅的视野才打开，只需一个黑天鹅的观察结果就能使从无数次对白天鹅的观察中归纳推理出的一般结论失效，引起了人们对认知的反思－以往认为对的不等于以后总是对的。“黑天鹅”隐喻那些意外事件：它们极为罕见，在通常的预期之外，在发生前，没有任何前例可以证明，但一旦发生，就会产生极端的影响。\n\n`归纳推理`过程中也**很容易由于样本的有限性和特殊性而导致统计偏差，得出一些错误的结论**。比如`幸存者偏差`、`辛普森悖论`、`选择性偏差`、`伯克森悖论`等等，关于这些统计偏差，后面会有文章来做更详细的说明，这里就不展开讨论了。\n\n## 总结\n\n看完上面的说明，我们的`认知体系`似乎显得有些弱不经风。但事实上并非如此，**我们的认知是能够在成长过程中不断学习进化的**，能够调整和提升认知的人便有机会取得更多的资源，机会来临时也更容易抓住。而认知有限的人，在发展到一定程度后，认知水平就会成为成长的瓶颈，很难取得更高的成就。有一句话说的好，你只能赚到你认知水平范围内的钱，凭运气赚的钱，迟早会凭本事亏掉。\n\n也许你还是会问，这跟我们在现实生活中看到的似乎又不太一样。为什么有些学习差的人反而赚了大钱，而很多大学生却只能碌碌无为的度过一生？难道大学生的认知水平反而更低吗？\n\n如果你问出这样的问题，显然又掉入了`幸存者偏差`的陷进里，那些学习不好，过得也很差的人并没有出现在你的视野里，而那些学习成绩好也取得了巨大成就的人也被你选择性忽略掉了。**因为他们的新闻和传播阈值都比较低，反常的事物更容易吸引人目光和注意**。\n\n既然我们的认知如此脆弱，那我们该怎么做呢？我觉得可以从这几个方面入手改善：\n\n1. **放平心态，认清现实**。\n\n如果你跟我一样，也发现自己的认知水平亟待提高，那么承认并接受这个事实，然后摆平心态，是我们必须做的一步。接受事实是改变的第一步。如果拒绝承认，每次提及都主动回避，进入自我保护姿态，那改变就无从谈起了。\n\n2. **多结交优秀的朋友**。\n\n如果你身边都是跟你一样，甚至不如你的人，那你可能会沉溺在虚无的自我满足中。与优秀的人为伍，并努力让自己跟上他们的脚步，学习他们思考的方式。“想要得到某样东西的最好方法，就是让自己配得上它”，所以需要努力提升自我并向他们靠近。这里有一个很容易陷入的心理陷进，对于优秀的人，近的会嫉妒，远的会羡慕；够得着的会嫉妒，够不着的会羡慕。想要加入他们的队伍，就必须先克服这样的心理状态。\n\n3. **分清事实和观点**。\n\n无论是交流还是阅读，我们很容易把观点和事实混为一谈，但大部分时候，它们都有着明显的边界。关于事实，我们不应该产生争论和分歧，而关于观点，我们可以相互交流探讨。很多时候，我们就是因为把二者混为一谈，导致产生偏见和谬误。\n\n4. **多阅读，努力提升自我认知**。\n\n这也是我觉得最有效，最直接的方式。多看看那些优秀前辈们写的书，可以从中得到不少启发。比如`尤瓦尔赫拉利`的`《人类简史》`、`《今日简史》`和`《未来简史》`，塔勒布的`《黑天鹅》`、`《随机漫步的傻瓜》`、`《反脆弱》`、`《非对称风险》`，`丹尼尔卡尼曼`的`《思考，快与慢》`，这类的书籍很多，多加阅读可以增加对自我和世界的认知。\n\n**活到老，学到老**，未来的世界还会有很多新鲜的事，只要活得足够久，就会遇到各种情况，如何再这个复杂多变的世界里坦然应对可能来临的变化，我想你心中已有了答案。所以，一起加油吧！\n\n","source":"_posts/thoughts/why-are-we-biased.md","raw":"---\ntitle: 【聊聊认知】你以为你以为的就是你以为的吗\ntags:\n  - Thoughts\ncategories:\n  - 编程\ntoc: true\ntop: true\ncover: true\ndate: 2020-05-31 21:00:50\n---\n\n## 前言\n\n这周是双休，时间比较充裕，睡睡懒觉后发现还有时间，便想写写文章，来对前段时间的思考做一个总结。\n\n似乎是从知识付费兴起之后，`认知`这个词便开始成为了热门词汇，似乎只要谈到`认知`，便能将自身高度提升一个档次。\n\n刚来上海的时候，还是一个愣头青（虽然一直都是），对`认知`这种东西嗤之以鼻，觉得不过是资本主义用来收割年轻韭菜的迷魂汤，但后来经历的一些事，改变了我的看法。其中有一件事让我记忆犹新。\n\n时间回到2018年，那时的创业新风口是带有大数据和人工智能加持的*新零售*，而我也刚好进入了一家做新零售的创业公司，在货架组做着后端开发的工作。\n\n一天，朋友约我一起吃饭，在吃饭聊天时，相互寒暄了近况，我说我在的公司是做*新零售*的，朋友对此似乎很感兴趣，并说了很多关于*新零售*的见解，大数据、推荐算法、人工智能、用户画像等等名词顺手捏来，当我听得一头雾水时，朋友问我有什么看法，我却支支吾吾的说道，我们做的不就是把货架铺到人家公司里，让商品离人更近一点，缩短商品的最后一公里，然后再弄一个小程序入口给用户使用，不就这么多东西吗。可想而知，最后只得跟朋友面面相觑。\n\n现在想来，当时我对于自己所从事行业的认识确实有失偏颇，只知道*新零售*是当时热门的风口，大家都在讨论，大家都觉得这个行业前途无量，而离它太近却反而看不到它的全貌，只见树木不见森林。但这也跟我并没有主动去思考这件事有着莫大的关系。那天的聊天，让我逐渐意识到自己的思维定势和盲区，而且不仅仅是工作，对于生活中其它很多事情，关于未来的思考，也是如此。我想，要是一直这样下去，恐怕真要做一辈子低阶码农了。\n\n于是，我便开始认真对待提升`认知`这件事了。\n\n把我领进门的第一本书，应该算是`成甲`老师的《好好学习》，学习了关于如何管理个人知识的方法论。里面有几处提到了`万维钢`老师的《精英日课》，于是我又去学习了这门课程，万老师的《精英日课》里会讲解历史上重要的科学发现和现在最前沿的科学理论，也会挑一些有意思的书来进行讲解，极大的扩展了我的认知视野。其中万老师讲解的一本书让我觉得很有意思，那便是以色列作家`尤瓦尔赫拉利`的《人类简史》，听完后觉得不过瘾，于是又找到书来读。这本书可以说给予了我极大的震惊，让我发现原来我生活的世界并不是像我以为的那样，就像万老师所说，**“你有你的计划，世界另有计划”**。而且，我发现，如果思考一些比我自身更大的事物时，生活中那些繁琐的小事便显得不足一提，很多烦恼也随之消失。\n\n我想，不能在将来被这个世界所抛弃，我必须知道这个世界正在发生什么，未来最有可能的方向是什么。于是我找了更多的书和课程来学习，也不断提升自己认知的高度。过年回家跟好友聊天时，他说，你好像成熟了许多，我微笑着，因为我知道这一切是怎么发生的。\n\n说了这么多废话，无非是想表达`认知`这个东西确实很重要。下面是我关于“`认知`是什么”以及“`认知偏差`是如何产生的”这两件事的一些见解和总结，希望也能对你有所帮助。\n\n## 什么是认知\n\n> `认知`是指人们**获得知识**或**应用知识**的过程，或**信息加工**的过程，这是人的最基本的心理过程。它包括*感觉*、*知觉*、*记忆*、*思维*、*想像*和*语言*等。人脑接受外界输入的信息，经过头脑的加工处理，转换成内在的心理活动，进而支配人的行为，这个过程就是**信息加工**的过程，也就是`认知过程`。（来自`百度百科`）\n\n简单来说，`认知`就是我们如何去认识和了解这个世界的过程。我们通过五官感觉来收集信息，然后在大脑中进行处理加工，从而产生知识。这是一个看似简单，却极其复杂的过程，涉及到我们人体内的一系列生化神经过程，最终产生出知识，“存储”在我们的大脑中，进而为后续行动提供支持和指导。\n\n我们出生时认知过程其实大同小异，虽然智力水平有高低，不过出类拔萃者总是少数，但成年后形成的认知水平却千差万别。有人说，*人与人之间的差距比人与猪之间的差距还大*，这里说的差距，其实就是`认知`上的差距。想要提升`自我认知`，便需要对`认知过程`有一个正确的认识。\n\n`认知过程`是我们获取知识的必要手段，而这些知识可以指导我们的生存发展。\n\n如果把从信息中提炼知识的过程比作是从金矿中提取黄金，有的人可以提取出纯度很高的金子，而有人却只能从中得到一堆的杂质。**提升认知，本质上来说，就是提升从复杂信息中筛选提取出有用信息并归纳总结的能力**。\n\n## 认知偏差\n\n随着信息技术的发展，我们每天能接触到信息成指数型增加，每天都有无数的信息试图进入我们的视野，这些信息有真有假，质量也参差不齐。\n\n那些以牟利为目的而批量生产的垃圾文章，看似有用却食之无味的鸡汤文，看起来大快人心却误人心智的网络爽文，就像迷魂汤一样，试图麻醉我们的心智，抢占我们的注意力，让我们活在虚无的幻想世界里。更不用说越来越多为了吸引眼球而造谣生事的文章，通过片面截取，东拼西凑，断章取义甚至直接捏造是非，从而推导出看似有趣实则荒谬的结论。\n\n如果你相信了一个错误的观点，从而产生了错误的知识，那么很可能会从这个错误的知识推导出更多错误的知识。**这些错误的知识会像病毒一样会自我繁殖**，占据你的大脑，扰乱你的行为。所以只有掌握正确的炼金法则，才能在这个复杂的世界里找到生存发展之路。\n\n我们每隔一段时间都会检测自己的视力，以对我们的眼镜度数做出调整，来更好的看清这个世界。如果把我们的思想则比作是认知这个世界的眼镜的话，你可曾检测过自己的`认知视力`？如果眼镜度数不对，那我们对世界的认知也会是模糊失真的。而我们的`认知`也会指导我们的判断和行为，**错误的认知很可能会带来错误的判断和选择**。\n\n那么我们为什么会产生错误的认知呢？这就跟我们大脑的运行机制有关。\n\n我们大脑的思考框架由两部分组成：`系统1`和`系统2`。`系统1`代指*无意识*的思考模式，`系统2`代指*有意识*进行的思考模式。`系统1`思考或判断非常快捷，因此我们往往第一时间通过它在脑海中形成主观印象和初步判断。但有时`系统1`可能得不到结论或是得到错误的结论，因此我们也经常求助`系统2`进行更为复杂和费力的思考过程，以图补充或纠正系统1。但不等于`系统1`是感性的、`系统2`是理性的。实际上`系统2`经常受到`系统1`的影响。这种影响可能是正确的，也可能是错误的。而且`系统2`很懒惰，经常疏于校验，从而无法纠正`系统1`形成的错误。\n\n当`系统1`产生的错误被`系统2`所接受或者`系统2`犯错时，`认知偏差`就产生了。\n\n## 演绎法\n\n我们认知这个世界主要通过两种方式，`演绎法`和`归纳法`。\n\n`演绎法`是使用我们自定的一些客观规律、基本原则和基本假设作为前提，对已知的信息进行加工处理，进一步推演得出未知的结论。\n\n下面是来自维基百科的解释：\n\n> `演绎推理`、`正向推理`在传统的亚里士多德逻辑中是“结论，可从叫做‘前提’的已知事实，‘必然地’得出的推理”。如果前提为真，则结论必然为真。这区别于溯因推理和归纳推理：它们的前提可以预测出高概率的结论，但是不确保结论为真。\n“演绎推理”还可以定义为结论在普遍性上不大于前提的推理，或“结论在确定性上，同前提一样”的推理。\n\n举例来说，如果我们知道明天要下雨，便会做出一个决策，明天出门要带伞。我们把这个简单的决策过程拆解一下：\n\n> 基本判断：下雨出门要带伞\n> 信息：明天会下雨\n> 结论：明天出门要带伞\n\n再举一个例子，亚里士多德的三段论：\n\n> 基本判断：所有人都会死\n> 信息：苏格拉底是人\n> 结论：苏格拉底会死\n\n这个过程是一个`逻辑推演`的过程，**根据基本假设和信息来推断出未知的信息**。\n\n如果你看过《名侦探柯南》或者《福尔摩斯》等侦探题材的小说或电影，一定会对侦探们对逻辑推理的巧妙运用留下深刻印象。\n\n演绎法看似严谨，但对于普通人来说，其实每一步都有可能会出错，从而导致`认知偏差`的出现。\n\n首先，**我们用作前提的基本假设和原则也许来源于人云亦云或当下流行的观点**。比如“仗义每逢屠狗辈，负心多是读书人”，“长得帅的人通常性格不好”，“渣男锡纸烫，渣女大波浪”，这些简单粗暴而又朗朗上口，能迎合内心意淫想法的观点很容易在不经意间溜进我们的思想。\n\n其次，**基本规律可能来自于我们的生活经验总结**，而由于我们生活范围和经历有限，加上我们以自我为中心的心理因素，总结出的基本规律也许只是小范围内有效，甚至可能完全无效。\n\n另外，**我们得到的信息可能并不准确甚至完全是错的**。你也许只是在跟朋友聊天时听朋友随口说了一句天气情况，而他可能看错了日期。更何况天气还隐含了概率的因素，即使是大概率事件也不代表一定会发生。\n\n最后，我们在**推演结论的过程中可能会因为逻辑错误而得出错误的结论**。比如：“美国人会说英语，Alice 会说英语，所以 Alice 是美国人”，“你喜欢用苹果手机，而苹果手机很贵，所以你喜欢用很贵的东西”，这些让人很容易疏忽的常见的`逻辑谬误`也是产生`认知偏差`的重要原因。\n\n## 归纳法\n\n说完了`演绎法`再来看看`归纳法`。\n\n`演绎法`的推演过程是**由一般到特殊**，而`归纳法`恰好相反。`归纳法`是**对事物进行归纳总结，从普遍的现象中总结出一般性的结论**。\n\n下面解释来自维基百科：\n\n> `归纳法`或`归纳推理`，有时叫做`归纳逻辑`，是论证的前提支持结论但不确保结论的推理过程。它基于对特殊的代表的有限观察，把性质或关系归结到类型；或基于对反复再现的现象的模式的有限观察，公式表达规律。\n\n举个例子：\n\n> 冰是冷的。\n弹子球在击打球杆的时候移动。\n\n推断出普遍的命题如：\n\n> 所有冰都是冷的。\n所有弹子球都在击打球杆的时候移动。\n\n正如你看到的那样，归纳法很容易出现过度普遍化的情况，我们经常会根据我们观察到的有限例子具有某种特性，便轻率的得出其它事物也具有相同特性的结论。\n\n举个很常见的例子，很多人都会说，“湖南人都喜欢吃辣”，于是遇到像我这样不那么喜欢吃辣的湖南人时，反而会质问我，“你到底是不是湖南人”。他们似乎把“大多数”这个词给省略掉了，“大多数湖南人喜欢吃辣”不代表“所有湖南人都喜欢吃辣”。而且这个大多数也仅仅是观测到的结果，具体比例也并没有数据支撑。\n\n（关于吃辣，我刚好在一席上发现了一个很有意思的视频，可以消除一些大家对于辣椒的误解，大家有兴趣也可以看看：https://yixi.tv/speech/831。）\n\n还有一个更出名的例子，那便是`黑天鹅`，这也是塔勒布的`《黑天鹅》`一书中所阐述的主要概念。\n\n> 在18世纪欧洲人发现澳洲之前，由于他们所见过的天鹅都是白色的，所以在当时欧洲人眼中，天鹅只有白色的品种。直到欧洲人发现了澳洲，看到当地的黑天鹅后，人们认识天鹅的视野才打开，只需一个黑天鹅的观察结果就能使从无数次对白天鹅的观察中归纳推理出的一般结论失效，引起了人们对认知的反思－以往认为对的不等于以后总是对的。“黑天鹅”隐喻那些意外事件：它们极为罕见，在通常的预期之外，在发生前，没有任何前例可以证明，但一旦发生，就会产生极端的影响。\n\n`归纳推理`过程中也**很容易由于样本的有限性和特殊性而导致统计偏差，得出一些错误的结论**。比如`幸存者偏差`、`辛普森悖论`、`选择性偏差`、`伯克森悖论`等等，关于这些统计偏差，后面会有文章来做更详细的说明，这里就不展开讨论了。\n\n## 总结\n\n看完上面的说明，我们的`认知体系`似乎显得有些弱不经风。但事实上并非如此，**我们的认知是能够在成长过程中不断学习进化的**，能够调整和提升认知的人便有机会取得更多的资源，机会来临时也更容易抓住。而认知有限的人，在发展到一定程度后，认知水平就会成为成长的瓶颈，很难取得更高的成就。有一句话说的好，你只能赚到你认知水平范围内的钱，凭运气赚的钱，迟早会凭本事亏掉。\n\n也许你还是会问，这跟我们在现实生活中看到的似乎又不太一样。为什么有些学习差的人反而赚了大钱，而很多大学生却只能碌碌无为的度过一生？难道大学生的认知水平反而更低吗？\n\n如果你问出这样的问题，显然又掉入了`幸存者偏差`的陷进里，那些学习不好，过得也很差的人并没有出现在你的视野里，而那些学习成绩好也取得了巨大成就的人也被你选择性忽略掉了。**因为他们的新闻和传播阈值都比较低，反常的事物更容易吸引人目光和注意**。\n\n既然我们的认知如此脆弱，那我们该怎么做呢？我觉得可以从这几个方面入手改善：\n\n1. **放平心态，认清现实**。\n\n如果你跟我一样，也发现自己的认知水平亟待提高，那么承认并接受这个事实，然后摆平心态，是我们必须做的一步。接受事实是改变的第一步。如果拒绝承认，每次提及都主动回避，进入自我保护姿态，那改变就无从谈起了。\n\n2. **多结交优秀的朋友**。\n\n如果你身边都是跟你一样，甚至不如你的人，那你可能会沉溺在虚无的自我满足中。与优秀的人为伍，并努力让自己跟上他们的脚步，学习他们思考的方式。“想要得到某样东西的最好方法，就是让自己配得上它”，所以需要努力提升自我并向他们靠近。这里有一个很容易陷入的心理陷进，对于优秀的人，近的会嫉妒，远的会羡慕；够得着的会嫉妒，够不着的会羡慕。想要加入他们的队伍，就必须先克服这样的心理状态。\n\n3. **分清事实和观点**。\n\n无论是交流还是阅读，我们很容易把观点和事实混为一谈，但大部分时候，它们都有着明显的边界。关于事实，我们不应该产生争论和分歧，而关于观点，我们可以相互交流探讨。很多时候，我们就是因为把二者混为一谈，导致产生偏见和谬误。\n\n4. **多阅读，努力提升自我认知**。\n\n这也是我觉得最有效，最直接的方式。多看看那些优秀前辈们写的书，可以从中得到不少启发。比如`尤瓦尔赫拉利`的`《人类简史》`、`《今日简史》`和`《未来简史》`，塔勒布的`《黑天鹅》`、`《随机漫步的傻瓜》`、`《反脆弱》`、`《非对称风险》`，`丹尼尔卡尼曼`的`《思考，快与慢》`，这类的书籍很多，多加阅读可以增加对自我和世界的认知。\n\n**活到老，学到老**，未来的世界还会有很多新鲜的事，只要活得足够久，就会遇到各种情况，如何再这个复杂多变的世界里坦然应对可能来临的变化，我想你心中已有了答案。所以，一起加油吧！\n\n","slug":"thoughts/why-are-we-biased","published":1,"updated":"2020-05-31T13:00:50.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfbq001k5ohu8yu29nc7","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>这周是双休，时间比较充裕，睡睡懒觉后发现还有时间，便想写写文章，来对前段时间的思考做一个总结。</p>\n<p>似乎是从知识付费兴起之后，<code>认知</code>这个词便开始成为了热门词汇，似乎只要谈到<code>认知</code>，便能将自身高度提升一个档次。</p>\n<p>刚来上海的时候，还是一个愣头青（虽然一直都是），对<code>认知</code>这种东西嗤之以鼻，觉得不过是资本主义用来收割年轻韭菜的迷魂汤，但后来经历的一些事，改变了我的看法。其中有一件事让我记忆犹新。</p>\n<p>时间回到2018年，那时的创业新风口是带有大数据和人工智能加持的<em>新零售</em>，而我也刚好进入了一家做新零售的创业公司，在货架组做着后端开发的工作。</p>\n<p>一天，朋友约我一起吃饭，在吃饭聊天时，相互寒暄了近况，我说我在的公司是做<em>新零售</em>的，朋友对此似乎很感兴趣，并说了很多关于<em>新零售</em>的见解，大数据、推荐算法、人工智能、用户画像等等名词顺手捏来，当我听得一头雾水时，朋友问我有什么看法，我却支支吾吾的说道，我们做的不就是把货架铺到人家公司里，让商品离人更近一点，缩短商品的最后一公里，然后再弄一个小程序入口给用户使用，不就这么多东西吗。可想而知，最后只得跟朋友面面相觑。</p>\n<p>现在想来，当时我对于自己所从事行业的认识确实有失偏颇，只知道<em>新零售</em>是当时热门的风口，大家都在讨论，大家都觉得这个行业前途无量，而离它太近却反而看不到它的全貌，只见树木不见森林。但这也跟我并没有主动去思考这件事有着莫大的关系。那天的聊天，让我逐渐意识到自己的思维定势和盲区，而且不仅仅是工作，对于生活中其它很多事情，关于未来的思考，也是如此。我想，要是一直这样下去，恐怕真要做一辈子低阶码农了。</p>\n<p>于是，我便开始认真对待提升<code>认知</code>这件事了。</p>\n<p>把我领进门的第一本书，应该算是<code>成甲</code>老师的《好好学习》，学习了关于如何管理个人知识的方法论。里面有几处提到了<code>万维钢</code>老师的《精英日课》，于是我又去学习了这门课程，万老师的《精英日课》里会讲解历史上重要的科学发现和现在最前沿的科学理论，也会挑一些有意思的书来进行讲解，极大的扩展了我的认知视野。其中万老师讲解的一本书让我觉得很有意思，那便是以色列作家<code>尤瓦尔赫拉利</code>的《人类简史》，听完后觉得不过瘾，于是又找到书来读。这本书可以说给予了我极大的震惊，让我发现原来我生活的世界并不是像我以为的那样，就像万老师所说，<strong>“你有你的计划，世界另有计划”</strong>。而且，我发现，如果思考一些比我自身更大的事物时，生活中那些繁琐的小事便显得不足一提，很多烦恼也随之消失。</p>\n<p>我想，不能在将来被这个世界所抛弃，我必须知道这个世界正在发生什么，未来最有可能的方向是什么。于是我找了更多的书和课程来学习，也不断提升自己认知的高度。过年回家跟好友聊天时，他说，你好像成熟了许多，我微笑着，因为我知道这一切是怎么发生的。</p>\n<p>说了这么多废话，无非是想表达<code>认知</code>这个东西确实很重要。下面是我关于“<code>认知</code>是什么”以及“<code>认知偏差</code>是如何产生的”这两件事的一些见解和总结，希望也能对你有所帮助。</p>\n<h2 id=\"什么是认知\"><a href=\"#什么是认知\" class=\"headerlink\" title=\"什么是认知\"></a>什么是认知</h2><blockquote>\n<p><code>认知</code>是指人们<strong>获得知识</strong>或<strong>应用知识</strong>的过程，或<strong>信息加工</strong>的过程，这是人的最基本的心理过程。它包括<em>感觉</em>、<em>知觉</em>、<em>记忆</em>、<em>思维</em>、<em>想像</em>和<em>语言</em>等。人脑接受外界输入的信息，经过头脑的加工处理，转换成内在的心理活动，进而支配人的行为，这个过程就是<strong>信息加工</strong>的过程，也就是<code>认知过程</code>。（来自<code>百度百科</code>）</p>\n</blockquote>\n<p>简单来说，<code>认知</code>就是我们如何去认识和了解这个世界的过程。我们通过五官感觉来收集信息，然后在大脑中进行处理加工，从而产生知识。这是一个看似简单，却极其复杂的过程，涉及到我们人体内的一系列生化神经过程，最终产生出知识，“存储”在我们的大脑中，进而为后续行动提供支持和指导。</p>\n<p>我们出生时认知过程其实大同小异，虽然智力水平有高低，不过出类拔萃者总是少数，但成年后形成的认知水平却千差万别。有人说，<em>人与人之间的差距比人与猪之间的差距还大</em>，这里说的差距，其实就是<code>认知</code>上的差距。想要提升<code>自我认知</code>，便需要对<code>认知过程</code>有一个正确的认识。</p>\n<p><code>认知过程</code>是我们获取知识的必要手段，而这些知识可以指导我们的生存发展。</p>\n<p>如果把从信息中提炼知识的过程比作是从金矿中提取黄金，有的人可以提取出纯度很高的金子，而有人却只能从中得到一堆的杂质。<strong>提升认知，本质上来说，就是提升从复杂信息中筛选提取出有用信息并归纳总结的能力</strong>。</p>\n<h2 id=\"认知偏差\"><a href=\"#认知偏差\" class=\"headerlink\" title=\"认知偏差\"></a>认知偏差</h2><p>随着信息技术的发展，我们每天能接触到信息成指数型增加，每天都有无数的信息试图进入我们的视野，这些信息有真有假，质量也参差不齐。</p>\n<p>那些以牟利为目的而批量生产的垃圾文章，看似有用却食之无味的鸡汤文，看起来大快人心却误人心智的网络爽文，就像迷魂汤一样，试图麻醉我们的心智，抢占我们的注意力，让我们活在虚无的幻想世界里。更不用说越来越多为了吸引眼球而造谣生事的文章，通过片面截取，东拼西凑，断章取义甚至直接捏造是非，从而推导出看似有趣实则荒谬的结论。</p>\n<p>如果你相信了一个错误的观点，从而产生了错误的知识，那么很可能会从这个错误的知识推导出更多错误的知识。<strong>这些错误的知识会像病毒一样会自我繁殖</strong>，占据你的大脑，扰乱你的行为。所以只有掌握正确的炼金法则，才能在这个复杂的世界里找到生存发展之路。</p>\n<p>我们每隔一段时间都会检测自己的视力，以对我们的眼镜度数做出调整，来更好的看清这个世界。如果把我们的思想则比作是认知这个世界的眼镜的话，你可曾检测过自己的<code>认知视力</code>？如果眼镜度数不对，那我们对世界的认知也会是模糊失真的。而我们的<code>认知</code>也会指导我们的判断和行为，<strong>错误的认知很可能会带来错误的判断和选择</strong>。</p>\n<p>那么我们为什么会产生错误的认知呢？这就跟我们大脑的运行机制有关。</p>\n<p>我们大脑的思考框架由两部分组成：<code>系统1</code>和<code>系统2</code>。<code>系统1</code>代指<em>无意识</em>的思考模式，<code>系统2</code>代指<em>有意识</em>进行的思考模式。<code>系统1</code>思考或判断非常快捷，因此我们往往第一时间通过它在脑海中形成主观印象和初步判断。但有时<code>系统1</code>可能得不到结论或是得到错误的结论，因此我们也经常求助<code>系统2</code>进行更为复杂和费力的思考过程，以图补充或纠正系统1。但不等于<code>系统1</code>是感性的、<code>系统2</code>是理性的。实际上<code>系统2</code>经常受到<code>系统1</code>的影响。这种影响可能是正确的，也可能是错误的。而且<code>系统2</code>很懒惰，经常疏于校验，从而无法纠正<code>系统1</code>形成的错误。</p>\n<p>当<code>系统1</code>产生的错误被<code>系统2</code>所接受或者<code>系统2</code>犯错时，<code>认知偏差</code>就产生了。</p>\n<h2 id=\"演绎法\"><a href=\"#演绎法\" class=\"headerlink\" title=\"演绎法\"></a>演绎法</h2><p>我们认知这个世界主要通过两种方式，<code>演绎法</code>和<code>归纳法</code>。</p>\n<p><code>演绎法</code>是使用我们自定的一些客观规律、基本原则和基本假设作为前提，对已知的信息进行加工处理，进一步推演得出未知的结论。</p>\n<p>下面是来自维基百科的解释：</p>\n<blockquote>\n<p><code>演绎推理</code>、<code>正向推理</code>在传统的亚里士多德逻辑中是“结论，可从叫做‘前提’的已知事实，‘必然地’得出的推理”。如果前提为真，则结论必然为真。这区别于溯因推理和归纳推理：它们的前提可以预测出高概率的结论，但是不确保结论为真。<br>“演绎推理”还可以定义为结论在普遍性上不大于前提的推理，或“结论在确定性上，同前提一样”的推理。</p>\n</blockquote>\n<p>举例来说，如果我们知道明天要下雨，便会做出一个决策，明天出门要带伞。我们把这个简单的决策过程拆解一下：</p>\n<blockquote>\n<p>基本判断：下雨出门要带伞<br>信息：明天会下雨<br>结论：明天出门要带伞</p>\n</blockquote>\n<p>再举一个例子，亚里士多德的三段论：</p>\n<blockquote>\n<p>基本判断：所有人都会死<br>信息：苏格拉底是人<br>结论：苏格拉底会死</p>\n</blockquote>\n<p>这个过程是一个<code>逻辑推演</code>的过程，<strong>根据基本假设和信息来推断出未知的信息</strong>。</p>\n<p>如果你看过《名侦探柯南》或者《福尔摩斯》等侦探题材的小说或电影，一定会对侦探们对逻辑推理的巧妙运用留下深刻印象。</p>\n<p>演绎法看似严谨，但对于普通人来说，其实每一步都有可能会出错，从而导致<code>认知偏差</code>的出现。</p>\n<p>首先，<strong>我们用作前提的基本假设和原则也许来源于人云亦云或当下流行的观点</strong>。比如“仗义每逢屠狗辈，负心多是读书人”，“长得帅的人通常性格不好”，“渣男锡纸烫，渣女大波浪”，这些简单粗暴而又朗朗上口，能迎合内心意淫想法的观点很容易在不经意间溜进我们的思想。</p>\n<p>其次，<strong>基本规律可能来自于我们的生活经验总结</strong>，而由于我们生活范围和经历有限，加上我们以自我为中心的心理因素，总结出的基本规律也许只是小范围内有效，甚至可能完全无效。</p>\n<p>另外，<strong>我们得到的信息可能并不准确甚至完全是错的</strong>。你也许只是在跟朋友聊天时听朋友随口说了一句天气情况，而他可能看错了日期。更何况天气还隐含了概率的因素，即使是大概率事件也不代表一定会发生。</p>\n<p>最后，我们在<strong>推演结论的过程中可能会因为逻辑错误而得出错误的结论</strong>。比如：“美国人会说英语，Alice 会说英语，所以 Alice 是美国人”，“你喜欢用苹果手机，而苹果手机很贵，所以你喜欢用很贵的东西”，这些让人很容易疏忽的常见的<code>逻辑谬误</code>也是产生<code>认知偏差</code>的重要原因。</p>\n<h2 id=\"归纳法\"><a href=\"#归纳法\" class=\"headerlink\" title=\"归纳法\"></a>归纳法</h2><p>说完了<code>演绎法</code>再来看看<code>归纳法</code>。</p>\n<p><code>演绎法</code>的推演过程是<strong>由一般到特殊</strong>，而<code>归纳法</code>恰好相反。<code>归纳法</code>是<strong>对事物进行归纳总结，从普遍的现象中总结出一般性的结论</strong>。</p>\n<p>下面解释来自维基百科：</p>\n<blockquote>\n<p><code>归纳法</code>或<code>归纳推理</code>，有时叫做<code>归纳逻辑</code>，是论证的前提支持结论但不确保结论的推理过程。它基于对特殊的代表的有限观察，把性质或关系归结到类型；或基于对反复再现的现象的模式的有限观察，公式表达规律。</p>\n</blockquote>\n<p>举个例子：</p>\n<blockquote>\n<p>冰是冷的。<br>弹子球在击打球杆的时候移动。</p>\n</blockquote>\n<p>推断出普遍的命题如：</p>\n<blockquote>\n<p>所有冰都是冷的。<br>所有弹子球都在击打球杆的时候移动。</p>\n</blockquote>\n<p>正如你看到的那样，归纳法很容易出现过度普遍化的情况，我们经常会根据我们观察到的有限例子具有某种特性，便轻率的得出其它事物也具有相同特性的结论。</p>\n<p>举个很常见的例子，很多人都会说，“湖南人都喜欢吃辣”，于是遇到像我这样不那么喜欢吃辣的湖南人时，反而会质问我，“你到底是不是湖南人”。他们似乎把“大多数”这个词给省略掉了，“大多数湖南人喜欢吃辣”不代表“所有湖南人都喜欢吃辣”。而且这个大多数也仅仅是观测到的结果，具体比例也并没有数据支撑。</p>\n<p>（关于吃辣，我刚好在一席上发现了一个很有意思的视频，可以消除一些大家对于辣椒的误解，大家有兴趣也可以看看：<a href=\"https://yixi.tv/speech/831。）\" target=\"_blank\" rel=\"noopener\">https://yixi.tv/speech/831。）</a></p>\n<p>还有一个更出名的例子，那便是<code>黑天鹅</code>，这也是塔勒布的<code>《黑天鹅》</code>一书中所阐述的主要概念。</p>\n<blockquote>\n<p>在18世纪欧洲人发现澳洲之前，由于他们所见过的天鹅都是白色的，所以在当时欧洲人眼中，天鹅只有白色的品种。直到欧洲人发现了澳洲，看到当地的黑天鹅后，人们认识天鹅的视野才打开，只需一个黑天鹅的观察结果就能使从无数次对白天鹅的观察中归纳推理出的一般结论失效，引起了人们对认知的反思－以往认为对的不等于以后总是对的。“黑天鹅”隐喻那些意外事件：它们极为罕见，在通常的预期之外，在发生前，没有任何前例可以证明，但一旦发生，就会产生极端的影响。</p>\n</blockquote>\n<p><code>归纳推理</code>过程中也<strong>很容易由于样本的有限性和特殊性而导致统计偏差，得出一些错误的结论</strong>。比如<code>幸存者偏差</code>、<code>辛普森悖论</code>、<code>选择性偏差</code>、<code>伯克森悖论</code>等等，关于这些统计偏差，后面会有文章来做更详细的说明，这里就不展开讨论了。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>看完上面的说明，我们的<code>认知体系</code>似乎显得有些弱不经风。但事实上并非如此，<strong>我们的认知是能够在成长过程中不断学习进化的</strong>，能够调整和提升认知的人便有机会取得更多的资源，机会来临时也更容易抓住。而认知有限的人，在发展到一定程度后，认知水平就会成为成长的瓶颈，很难取得更高的成就。有一句话说的好，你只能赚到你认知水平范围内的钱，凭运气赚的钱，迟早会凭本事亏掉。</p>\n<p>也许你还是会问，这跟我们在现实生活中看到的似乎又不太一样。为什么有些学习差的人反而赚了大钱，而很多大学生却只能碌碌无为的度过一生？难道大学生的认知水平反而更低吗？</p>\n<p>如果你问出这样的问题，显然又掉入了<code>幸存者偏差</code>的陷进里，那些学习不好，过得也很差的人并没有出现在你的视野里，而那些学习成绩好也取得了巨大成就的人也被你选择性忽略掉了。<strong>因为他们的新闻和传播阈值都比较低，反常的事物更容易吸引人目光和注意</strong>。</p>\n<p>既然我们的认知如此脆弱，那我们该怎么做呢？我觉得可以从这几个方面入手改善：</p>\n<ol>\n<li><strong>放平心态，认清现实</strong>。</li>\n</ol>\n<p>如果你跟我一样，也发现自己的认知水平亟待提高，那么承认并接受这个事实，然后摆平心态，是我们必须做的一步。接受事实是改变的第一步。如果拒绝承认，每次提及都主动回避，进入自我保护姿态，那改变就无从谈起了。</p>\n<ol start=\"2\">\n<li><strong>多结交优秀的朋友</strong>。</li>\n</ol>\n<p>如果你身边都是跟你一样，甚至不如你的人，那你可能会沉溺在虚无的自我满足中。与优秀的人为伍，并努力让自己跟上他们的脚步，学习他们思考的方式。“想要得到某样东西的最好方法，就是让自己配得上它”，所以需要努力提升自我并向他们靠近。这里有一个很容易陷入的心理陷进，对于优秀的人，近的会嫉妒，远的会羡慕；够得着的会嫉妒，够不着的会羡慕。想要加入他们的队伍，就必须先克服这样的心理状态。</p>\n<ol start=\"3\">\n<li><strong>分清事实和观点</strong>。</li>\n</ol>\n<p>无论是交流还是阅读，我们很容易把观点和事实混为一谈，但大部分时候，它们都有着明显的边界。关于事实，我们不应该产生争论和分歧，而关于观点，我们可以相互交流探讨。很多时候，我们就是因为把二者混为一谈，导致产生偏见和谬误。</p>\n<ol start=\"4\">\n<li><strong>多阅读，努力提升自我认知</strong>。</li>\n</ol>\n<p>这也是我觉得最有效，最直接的方式。多看看那些优秀前辈们写的书，可以从中得到不少启发。比如<code>尤瓦尔赫拉利</code>的<code>《人类简史》</code>、<code>《今日简史》</code>和<code>《未来简史》</code>，塔勒布的<code>《黑天鹅》</code>、<code>《随机漫步的傻瓜》</code>、<code>《反脆弱》</code>、<code>《非对称风险》</code>，<code>丹尼尔卡尼曼</code>的<code>《思考，快与慢》</code>，这类的书籍很多，多加阅读可以增加对自我和世界的认知。</p>\n<p><strong>活到老，学到老</strong>，未来的世界还会有很多新鲜的事，只要活得足够久，就会遇到各种情况，如何再这个复杂多变的世界里坦然应对可能来临的变化，我想你心中已有了答案。所以，一起加油吧！</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>这周是双休，时间比较充裕，睡睡懒觉后发现还有时间，便想写写文章，来对前段时间的思考做一个总结。</p>\n<p>似乎是从知识付费兴起之后，<code>认知</code>这个词便开始成为了热门词汇，似乎只要谈到<code>认知</code>，便能将自身高度提升一个档次。</p>\n<p>刚来上海的时候，还是一个愣头青（虽然一直都是），对<code>认知</code>这种东西嗤之以鼻，觉得不过是资本主义用来收割年轻韭菜的迷魂汤，但后来经历的一些事，改变了我的看法。其中有一件事让我记忆犹新。</p>\n<p>时间回到2018年，那时的创业新风口是带有大数据和人工智能加持的<em>新零售</em>，而我也刚好进入了一家做新零售的创业公司，在货架组做着后端开发的工作。</p>\n<p>一天，朋友约我一起吃饭，在吃饭聊天时，相互寒暄了近况，我说我在的公司是做<em>新零售</em>的，朋友对此似乎很感兴趣，并说了很多关于<em>新零售</em>的见解，大数据、推荐算法、人工智能、用户画像等等名词顺手捏来，当我听得一头雾水时，朋友问我有什么看法，我却支支吾吾的说道，我们做的不就是把货架铺到人家公司里，让商品离人更近一点，缩短商品的最后一公里，然后再弄一个小程序入口给用户使用，不就这么多东西吗。可想而知，最后只得跟朋友面面相觑。</p>\n<p>现在想来，当时我对于自己所从事行业的认识确实有失偏颇，只知道<em>新零售</em>是当时热门的风口，大家都在讨论，大家都觉得这个行业前途无量，而离它太近却反而看不到它的全貌，只见树木不见森林。但这也跟我并没有主动去思考这件事有着莫大的关系。那天的聊天，让我逐渐意识到自己的思维定势和盲区，而且不仅仅是工作，对于生活中其它很多事情，关于未来的思考，也是如此。我想，要是一直这样下去，恐怕真要做一辈子低阶码农了。</p>\n<p>于是，我便开始认真对待提升<code>认知</code>这件事了。</p>\n<p>把我领进门的第一本书，应该算是<code>成甲</code>老师的《好好学习》，学习了关于如何管理个人知识的方法论。里面有几处提到了<code>万维钢</code>老师的《精英日课》，于是我又去学习了这门课程，万老师的《精英日课》里会讲解历史上重要的科学发现和现在最前沿的科学理论，也会挑一些有意思的书来进行讲解，极大的扩展了我的认知视野。其中万老师讲解的一本书让我觉得很有意思，那便是以色列作家<code>尤瓦尔赫拉利</code>的《人类简史》，听完后觉得不过瘾，于是又找到书来读。这本书可以说给予了我极大的震惊，让我发现原来我生活的世界并不是像我以为的那样，就像万老师所说，<strong>“你有你的计划，世界另有计划”</strong>。而且，我发现，如果思考一些比我自身更大的事物时，生活中那些繁琐的小事便显得不足一提，很多烦恼也随之消失。</p>\n<p>我想，不能在将来被这个世界所抛弃，我必须知道这个世界正在发生什么，未来最有可能的方向是什么。于是我找了更多的书和课程来学习，也不断提升自己认知的高度。过年回家跟好友聊天时，他说，你好像成熟了许多，我微笑着，因为我知道这一切是怎么发生的。</p>\n<p>说了这么多废话，无非是想表达<code>认知</code>这个东西确实很重要。下面是我关于“<code>认知</code>是什么”以及“<code>认知偏差</code>是如何产生的”这两件事的一些见解和总结，希望也能对你有所帮助。</p>\n<h2 id=\"什么是认知\"><a href=\"#什么是认知\" class=\"headerlink\" title=\"什么是认知\"></a>什么是认知</h2><blockquote>\n<p><code>认知</code>是指人们<strong>获得知识</strong>或<strong>应用知识</strong>的过程，或<strong>信息加工</strong>的过程，这是人的最基本的心理过程。它包括<em>感觉</em>、<em>知觉</em>、<em>记忆</em>、<em>思维</em>、<em>想像</em>和<em>语言</em>等。人脑接受外界输入的信息，经过头脑的加工处理，转换成内在的心理活动，进而支配人的行为，这个过程就是<strong>信息加工</strong>的过程，也就是<code>认知过程</code>。（来自<code>百度百科</code>）</p>\n</blockquote>\n<p>简单来说，<code>认知</code>就是我们如何去认识和了解这个世界的过程。我们通过五官感觉来收集信息，然后在大脑中进行处理加工，从而产生知识。这是一个看似简单，却极其复杂的过程，涉及到我们人体内的一系列生化神经过程，最终产生出知识，“存储”在我们的大脑中，进而为后续行动提供支持和指导。</p>\n<p>我们出生时认知过程其实大同小异，虽然智力水平有高低，不过出类拔萃者总是少数，但成年后形成的认知水平却千差万别。有人说，<em>人与人之间的差距比人与猪之间的差距还大</em>，这里说的差距，其实就是<code>认知</code>上的差距。想要提升<code>自我认知</code>，便需要对<code>认知过程</code>有一个正确的认识。</p>\n<p><code>认知过程</code>是我们获取知识的必要手段，而这些知识可以指导我们的生存发展。</p>\n<p>如果把从信息中提炼知识的过程比作是从金矿中提取黄金，有的人可以提取出纯度很高的金子，而有人却只能从中得到一堆的杂质。<strong>提升认知，本质上来说，就是提升从复杂信息中筛选提取出有用信息并归纳总结的能力</strong>。</p>\n<h2 id=\"认知偏差\"><a href=\"#认知偏差\" class=\"headerlink\" title=\"认知偏差\"></a>认知偏差</h2><p>随着信息技术的发展，我们每天能接触到信息成指数型增加，每天都有无数的信息试图进入我们的视野，这些信息有真有假，质量也参差不齐。</p>\n<p>那些以牟利为目的而批量生产的垃圾文章，看似有用却食之无味的鸡汤文，看起来大快人心却误人心智的网络爽文，就像迷魂汤一样，试图麻醉我们的心智，抢占我们的注意力，让我们活在虚无的幻想世界里。更不用说越来越多为了吸引眼球而造谣生事的文章，通过片面截取，东拼西凑，断章取义甚至直接捏造是非，从而推导出看似有趣实则荒谬的结论。</p>\n<p>如果你相信了一个错误的观点，从而产生了错误的知识，那么很可能会从这个错误的知识推导出更多错误的知识。<strong>这些错误的知识会像病毒一样会自我繁殖</strong>，占据你的大脑，扰乱你的行为。所以只有掌握正确的炼金法则，才能在这个复杂的世界里找到生存发展之路。</p>\n<p>我们每隔一段时间都会检测自己的视力，以对我们的眼镜度数做出调整，来更好的看清这个世界。如果把我们的思想则比作是认知这个世界的眼镜的话，你可曾检测过自己的<code>认知视力</code>？如果眼镜度数不对，那我们对世界的认知也会是模糊失真的。而我们的<code>认知</code>也会指导我们的判断和行为，<strong>错误的认知很可能会带来错误的判断和选择</strong>。</p>\n<p>那么我们为什么会产生错误的认知呢？这就跟我们大脑的运行机制有关。</p>\n<p>我们大脑的思考框架由两部分组成：<code>系统1</code>和<code>系统2</code>。<code>系统1</code>代指<em>无意识</em>的思考模式，<code>系统2</code>代指<em>有意识</em>进行的思考模式。<code>系统1</code>思考或判断非常快捷，因此我们往往第一时间通过它在脑海中形成主观印象和初步判断。但有时<code>系统1</code>可能得不到结论或是得到错误的结论，因此我们也经常求助<code>系统2</code>进行更为复杂和费力的思考过程，以图补充或纠正系统1。但不等于<code>系统1</code>是感性的、<code>系统2</code>是理性的。实际上<code>系统2</code>经常受到<code>系统1</code>的影响。这种影响可能是正确的，也可能是错误的。而且<code>系统2</code>很懒惰，经常疏于校验，从而无法纠正<code>系统1</code>形成的错误。</p>\n<p>当<code>系统1</code>产生的错误被<code>系统2</code>所接受或者<code>系统2</code>犯错时，<code>认知偏差</code>就产生了。</p>\n<h2 id=\"演绎法\"><a href=\"#演绎法\" class=\"headerlink\" title=\"演绎法\"></a>演绎法</h2><p>我们认知这个世界主要通过两种方式，<code>演绎法</code>和<code>归纳法</code>。</p>\n<p><code>演绎法</code>是使用我们自定的一些客观规律、基本原则和基本假设作为前提，对已知的信息进行加工处理，进一步推演得出未知的结论。</p>\n<p>下面是来自维基百科的解释：</p>\n<blockquote>\n<p><code>演绎推理</code>、<code>正向推理</code>在传统的亚里士多德逻辑中是“结论，可从叫做‘前提’的已知事实，‘必然地’得出的推理”。如果前提为真，则结论必然为真。这区别于溯因推理和归纳推理：它们的前提可以预测出高概率的结论，但是不确保结论为真。<br>“演绎推理”还可以定义为结论在普遍性上不大于前提的推理，或“结论在确定性上，同前提一样”的推理。</p>\n</blockquote>\n<p>举例来说，如果我们知道明天要下雨，便会做出一个决策，明天出门要带伞。我们把这个简单的决策过程拆解一下：</p>\n<blockquote>\n<p>基本判断：下雨出门要带伞<br>信息：明天会下雨<br>结论：明天出门要带伞</p>\n</blockquote>\n<p>再举一个例子，亚里士多德的三段论：</p>\n<blockquote>\n<p>基本判断：所有人都会死<br>信息：苏格拉底是人<br>结论：苏格拉底会死</p>\n</blockquote>\n<p>这个过程是一个<code>逻辑推演</code>的过程，<strong>根据基本假设和信息来推断出未知的信息</strong>。</p>\n<p>如果你看过《名侦探柯南》或者《福尔摩斯》等侦探题材的小说或电影，一定会对侦探们对逻辑推理的巧妙运用留下深刻印象。</p>\n<p>演绎法看似严谨，但对于普通人来说，其实每一步都有可能会出错，从而导致<code>认知偏差</code>的出现。</p>\n<p>首先，<strong>我们用作前提的基本假设和原则也许来源于人云亦云或当下流行的观点</strong>。比如“仗义每逢屠狗辈，负心多是读书人”，“长得帅的人通常性格不好”，“渣男锡纸烫，渣女大波浪”，这些简单粗暴而又朗朗上口，能迎合内心意淫想法的观点很容易在不经意间溜进我们的思想。</p>\n<p>其次，<strong>基本规律可能来自于我们的生活经验总结</strong>，而由于我们生活范围和经历有限，加上我们以自我为中心的心理因素，总结出的基本规律也许只是小范围内有效，甚至可能完全无效。</p>\n<p>另外，<strong>我们得到的信息可能并不准确甚至完全是错的</strong>。你也许只是在跟朋友聊天时听朋友随口说了一句天气情况，而他可能看错了日期。更何况天气还隐含了概率的因素，即使是大概率事件也不代表一定会发生。</p>\n<p>最后，我们在<strong>推演结论的过程中可能会因为逻辑错误而得出错误的结论</strong>。比如：“美国人会说英语，Alice 会说英语，所以 Alice 是美国人”，“你喜欢用苹果手机，而苹果手机很贵，所以你喜欢用很贵的东西”，这些让人很容易疏忽的常见的<code>逻辑谬误</code>也是产生<code>认知偏差</code>的重要原因。</p>\n<h2 id=\"归纳法\"><a href=\"#归纳法\" class=\"headerlink\" title=\"归纳法\"></a>归纳法</h2><p>说完了<code>演绎法</code>再来看看<code>归纳法</code>。</p>\n<p><code>演绎法</code>的推演过程是<strong>由一般到特殊</strong>，而<code>归纳法</code>恰好相反。<code>归纳法</code>是<strong>对事物进行归纳总结，从普遍的现象中总结出一般性的结论</strong>。</p>\n<p>下面解释来自维基百科：</p>\n<blockquote>\n<p><code>归纳法</code>或<code>归纳推理</code>，有时叫做<code>归纳逻辑</code>，是论证的前提支持结论但不确保结论的推理过程。它基于对特殊的代表的有限观察，把性质或关系归结到类型；或基于对反复再现的现象的模式的有限观察，公式表达规律。</p>\n</blockquote>\n<p>举个例子：</p>\n<blockquote>\n<p>冰是冷的。<br>弹子球在击打球杆的时候移动。</p>\n</blockquote>\n<p>推断出普遍的命题如：</p>\n<blockquote>\n<p>所有冰都是冷的。<br>所有弹子球都在击打球杆的时候移动。</p>\n</blockquote>\n<p>正如你看到的那样，归纳法很容易出现过度普遍化的情况，我们经常会根据我们观察到的有限例子具有某种特性，便轻率的得出其它事物也具有相同特性的结论。</p>\n<p>举个很常见的例子，很多人都会说，“湖南人都喜欢吃辣”，于是遇到像我这样不那么喜欢吃辣的湖南人时，反而会质问我，“你到底是不是湖南人”。他们似乎把“大多数”这个词给省略掉了，“大多数湖南人喜欢吃辣”不代表“所有湖南人都喜欢吃辣”。而且这个大多数也仅仅是观测到的结果，具体比例也并没有数据支撑。</p>\n<p>（关于吃辣，我刚好在一席上发现了一个很有意思的视频，可以消除一些大家对于辣椒的误解，大家有兴趣也可以看看：<a href=\"https://yixi.tv/speech/831。）\" target=\"_blank\" rel=\"noopener\">https://yixi.tv/speech/831。）</a></p>\n<p>还有一个更出名的例子，那便是<code>黑天鹅</code>，这也是塔勒布的<code>《黑天鹅》</code>一书中所阐述的主要概念。</p>\n<blockquote>\n<p>在18世纪欧洲人发现澳洲之前，由于他们所见过的天鹅都是白色的，所以在当时欧洲人眼中，天鹅只有白色的品种。直到欧洲人发现了澳洲，看到当地的黑天鹅后，人们认识天鹅的视野才打开，只需一个黑天鹅的观察结果就能使从无数次对白天鹅的观察中归纳推理出的一般结论失效，引起了人们对认知的反思－以往认为对的不等于以后总是对的。“黑天鹅”隐喻那些意外事件：它们极为罕见，在通常的预期之外，在发生前，没有任何前例可以证明，但一旦发生，就会产生极端的影响。</p>\n</blockquote>\n<p><code>归纳推理</code>过程中也<strong>很容易由于样本的有限性和特殊性而导致统计偏差，得出一些错误的结论</strong>。比如<code>幸存者偏差</code>、<code>辛普森悖论</code>、<code>选择性偏差</code>、<code>伯克森悖论</code>等等，关于这些统计偏差，后面会有文章来做更详细的说明，这里就不展开讨论了。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>看完上面的说明，我们的<code>认知体系</code>似乎显得有些弱不经风。但事实上并非如此，<strong>我们的认知是能够在成长过程中不断学习进化的</strong>，能够调整和提升认知的人便有机会取得更多的资源，机会来临时也更容易抓住。而认知有限的人，在发展到一定程度后，认知水平就会成为成长的瓶颈，很难取得更高的成就。有一句话说的好，你只能赚到你认知水平范围内的钱，凭运气赚的钱，迟早会凭本事亏掉。</p>\n<p>也许你还是会问，这跟我们在现实生活中看到的似乎又不太一样。为什么有些学习差的人反而赚了大钱，而很多大学生却只能碌碌无为的度过一生？难道大学生的认知水平反而更低吗？</p>\n<p>如果你问出这样的问题，显然又掉入了<code>幸存者偏差</code>的陷进里，那些学习不好，过得也很差的人并没有出现在你的视野里，而那些学习成绩好也取得了巨大成就的人也被你选择性忽略掉了。<strong>因为他们的新闻和传播阈值都比较低，反常的事物更容易吸引人目光和注意</strong>。</p>\n<p>既然我们的认知如此脆弱，那我们该怎么做呢？我觉得可以从这几个方面入手改善：</p>\n<ol>\n<li><strong>放平心态，认清现实</strong>。</li>\n</ol>\n<p>如果你跟我一样，也发现自己的认知水平亟待提高，那么承认并接受这个事实，然后摆平心态，是我们必须做的一步。接受事实是改变的第一步。如果拒绝承认，每次提及都主动回避，进入自我保护姿态，那改变就无从谈起了。</p>\n<ol start=\"2\">\n<li><strong>多结交优秀的朋友</strong>。</li>\n</ol>\n<p>如果你身边都是跟你一样，甚至不如你的人，那你可能会沉溺在虚无的自我满足中。与优秀的人为伍，并努力让自己跟上他们的脚步，学习他们思考的方式。“想要得到某样东西的最好方法，就是让自己配得上它”，所以需要努力提升自我并向他们靠近。这里有一个很容易陷入的心理陷进，对于优秀的人，近的会嫉妒，远的会羡慕；够得着的会嫉妒，够不着的会羡慕。想要加入他们的队伍，就必须先克服这样的心理状态。</p>\n<ol start=\"3\">\n<li><strong>分清事实和观点</strong>。</li>\n</ol>\n<p>无论是交流还是阅读，我们很容易把观点和事实混为一谈，但大部分时候，它们都有着明显的边界。关于事实，我们不应该产生争论和分歧，而关于观点，我们可以相互交流探讨。很多时候，我们就是因为把二者混为一谈，导致产生偏见和谬误。</p>\n<ol start=\"4\">\n<li><strong>多阅读，努力提升自我认知</strong>。</li>\n</ol>\n<p>这也是我觉得最有效，最直接的方式。多看看那些优秀前辈们写的书，可以从中得到不少启发。比如<code>尤瓦尔赫拉利</code>的<code>《人类简史》</code>、<code>《今日简史》</code>和<code>《未来简史》</code>，塔勒布的<code>《黑天鹅》</code>、<code>《随机漫步的傻瓜》</code>、<code>《反脆弱》</code>、<code>《非对称风险》</code>，<code>丹尼尔卡尼曼</code>的<code>《思考，快与慢》</code>，这类的书籍很多，多加阅读可以增加对自我和世界的认知。</p>\n<p><strong>活到老，学到老</strong>，未来的世界还会有很多新鲜的事，只要活得足够久，就会遇到各种情况，如何再这个复杂多变的世界里坦然应对可能来临的变化，我想你心中已有了答案。所以，一起加油吧！</p>\n"},{"title":"【Java基础篇】启航","toc":true,"date":"2020-05-03T16:25:01.000Z","_content":"\n> 无论最终的结果是什么，只要这是自己选择的道路。 -- 《龙与虎》\n\n## 前言\n\n**Java开发入门篇**十分简单，相信聪明的你已经完成了新手村的任务，顺利打败了小Boss，开启这一新的篇章。​\n\n本篇是**Java基础篇**，主要内容是介绍 `Java` 开发中的*基础概念*和*基本知识*，包括 `Java` 程序的基本组成，`Java` 中的`类`与`对象`、`数据类型`、`变量`与`常量`、`运算符`、`控制流程`、`接口`、`封装`、`继承`与`多态`等等。这些基本要素是组成 `Java` 程序必不可少的部分，要想对 `Java` 有一个全面的认识，那么就必须认真掌握好这些基本知识。\n\n就像学习高深莫测的武林秘籍之前必须要先学会一些基本的内功心法和基础招式那样，本篇的重要性不言自明，只有打好基础，才能在更高深的技能上有所突破。\n\n为了不让这个过程太过枯燥，本篇将继续完善上一篇中的计算器，以它为基础进行分析，并随着学习的深入，让它的功能变得越来越强大。当然，除了这个计算器之外，还会有很多小栗子伴随其中，以加深大家对这个部分的理解。\n\n之后的每一篇开头，都会引用一句话来作为鼓励，希望它能成为激励你继续前进的精神力量。\n\n那么，年轻的勇士，继续你的征程吧！","source":"_posts/java/basic/java-basic.md","raw":"---\ntitle: 【Java基础篇】启航\ntags:\n  - Java\n  - Java基础\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-04 00:25:01\n---\n\n> 无论最终的结果是什么，只要这是自己选择的道路。 -- 《龙与虎》\n\n## 前言\n\n**Java开发入门篇**十分简单，相信聪明的你已经完成了新手村的任务，顺利打败了小Boss，开启这一新的篇章。​\n\n本篇是**Java基础篇**，主要内容是介绍 `Java` 开发中的*基础概念*和*基本知识*，包括 `Java` 程序的基本组成，`Java` 中的`类`与`对象`、`数据类型`、`变量`与`常量`、`运算符`、`控制流程`、`接口`、`封装`、`继承`与`多态`等等。这些基本要素是组成 `Java` 程序必不可少的部分，要想对 `Java` 有一个全面的认识，那么就必须认真掌握好这些基本知识。\n\n就像学习高深莫测的武林秘籍之前必须要先学会一些基本的内功心法和基础招式那样，本篇的重要性不言自明，只有打好基础，才能在更高深的技能上有所突破。\n\n为了不让这个过程太过枯燥，本篇将继续完善上一篇中的计算器，以它为基础进行分析，并随着学习的深入，让它的功能变得越来越强大。当然，除了这个计算器之外，还会有很多小栗子伴随其中，以加深大家对这个部分的理解。\n\n之后的每一篇开头，都会引用一句话来作为鼓励，希望它能成为激励你继续前进的精神力量。\n\n那么，年轻的勇士，继续你的征程吧！","slug":"java/basic/java-basic","published":1,"updated":"2020-05-03T16:25:01.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfg800325ohu1sog7nls","content":"<blockquote>\n<p>无论最终的结果是什么，只要这是自己选择的道路。 – 《龙与虎》</p>\n</blockquote>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p><strong>Java开发入门篇</strong>十分简单，相信聪明的你已经完成了新手村的任务，顺利打败了小Boss，开启这一新的篇章。​</p>\n<p>本篇是<strong>Java基础篇</strong>，主要内容是介绍 <code>Java</code> 开发中的<em>基础概念</em>和<em>基本知识</em>，包括 <code>Java</code> 程序的基本组成，<code>Java</code> 中的<code>类</code>与<code>对象</code>、<code>数据类型</code>、<code>变量</code>与<code>常量</code>、<code>运算符</code>、<code>控制流程</code>、<code>接口</code>、<code>封装</code>、<code>继承</code>与<code>多态</code>等等。这些基本要素是组成 <code>Java</code> 程序必不可少的部分，要想对 <code>Java</code> 有一个全面的认识，那么就必须认真掌握好这些基本知识。</p>\n<p>就像学习高深莫测的武林秘籍之前必须要先学会一些基本的内功心法和基础招式那样，本篇的重要性不言自明，只有打好基础，才能在更高深的技能上有所突破。</p>\n<p>为了不让这个过程太过枯燥，本篇将继续完善上一篇中的计算器，以它为基础进行分析，并随着学习的深入，让它的功能变得越来越强大。当然，除了这个计算器之外，还会有很多小栗子伴随其中，以加深大家对这个部分的理解。</p>\n<p>之后的每一篇开头，都会引用一句话来作为鼓励，希望它能成为激励你继续前进的精神力量。</p>\n<p>那么，年轻的勇士，继续你的征程吧！</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>无论最终的结果是什么，只要这是自己选择的道路。 – 《龙与虎》</p>\n</blockquote>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p><strong>Java开发入门篇</strong>十分简单，相信聪明的你已经完成了新手村的任务，顺利打败了小Boss，开启这一新的篇章。​</p>\n<p>本篇是<strong>Java基础篇</strong>，主要内容是介绍 <code>Java</code> 开发中的<em>基础概念</em>和<em>基本知识</em>，包括 <code>Java</code> 程序的基本组成，<code>Java</code> 中的<code>类</code>与<code>对象</code>、<code>数据类型</code>、<code>变量</code>与<code>常量</code>、<code>运算符</code>、<code>控制流程</code>、<code>接口</code>、<code>封装</code>、<code>继承</code>与<code>多态</code>等等。这些基本要素是组成 <code>Java</code> 程序必不可少的部分，要想对 <code>Java</code> 有一个全面的认识，那么就必须认真掌握好这些基本知识。</p>\n<p>就像学习高深莫测的武林秘籍之前必须要先学会一些基本的内功心法和基础招式那样，本篇的重要性不言自明，只有打好基础，才能在更高深的技能上有所突破。</p>\n<p>为了不让这个过程太过枯燥，本篇将继续完善上一篇中的计算器，以它为基础进行分析，并随着学习的深入，让它的功能变得越来越强大。当然，除了这个计算器之外，还会有很多小栗子伴随其中，以加深大家对这个部分的理解。</p>\n<p>之后的每一篇开头，都会引用一句话来作为鼓励，希望它能成为激励你继续前进的精神力量。</p>\n<p>那么，年轻的勇士，继续你的征程吧！</p>\n"},{"title":"【Java基础篇】一、Java package与import","toc":true,"date":"2020-05-03T16:25:02.000Z","_content":"\n> 共道人间惆怅事，不知今夕是何年。  -- 《周秦行纪》\n\n## 关卡说明\n\n关卡描述：不知你是否还记得上一篇中的代码，前面的两行，这是在 `Java` 中特定的格式，想要知道它们是什么含义吗？通过本关你就能获得答案。\n\n过关条件：理解 `Java` 中 `package` 与 `import` 的作用以及如何使用它们\n\n关卡难度：⭐️\n\n## 什么是 package\n\n现在再来回顾一下我们上一篇中的代码，首先我们创建了一个类，叫做 `SimpleCalculator` ，文件名叫做 `SimpleCalculator.java`。\n\n在最开头有这么一行：\n\n```java\npackage hello;\n```\n\n第一行会声明这个类所在的包名，因为这个类文件是在 `hello` 包下的，所以第一行的含义就是表明这个类的位置。\n\n## 为什么要使用package\n\n聪明的你也许会想到，同一个包下面应该不允许存在两个相同的文件名，也就是不允许存在相同的类名。确实如此，这也是 `package` 的一个很重要的作用，为类提供一个类似命名空间的管理，避免同名的类产生冲突。\n\n试想一下，如果没有 `package` ，所有类都在同一个地方，那就要争先恐后的使用类名了，后来者可能就要为取名想破脑袋，就像注册游戏名时经常感慨好名字都被🐷拱了那样。\n\n`package` 的另一个作用便是用来将 `Java` 文件进行分类管理，比如有同一种用处的类放到同一个包下，方便查找和管理。\n\n## package命名规范\n\n虽然理论上来说，你可以随心所欲、为所欲为的命名你项目中的包，但还是建议你遵循一定的规范，因为如果大家都遵循规范来设计的话，会减少很多交流成本。\n\n`package` 的命名一般分为几个部分，`身份标识.开发者名/团队名/公司名.项目名.模块名`，对于身份标识，主要是用来标识是个人开发还是团队开发，个人开发主要使用的标识有：*indi*（个体项目）、*onem*（单人项目）、*pers*（个人项目）、*priv*（私有项目），团队开发主要使用的标识有：*team*（团队项目）、*com*（公司项目）。\n\n但其实没有特殊要求的话，使用域名倒写是最常见的，因为域名是不会重复的。\n\n所以比较常见的命名类似于：*com.frank.hello.controller*，*frank*是我的英文名，（假装）*frank.com*是我的域名，*hello* 是项目名，*controller* 则代表这个包都用途，表明在下面我会放控制器（先不用纠结控制器是什么）。\n\n所以，如果还没有英文名的话，赶紧给自己找一个吧。你也许会问，如果有人用了跟自己一样的英文名怎么办？\n\n没有关系，反正极大概率上来说，你又不会使用他的包，即使真遇上了，还是有解决办法的，改改项目名，改改包名，就ok了。\n\n## 使用package的注意事项\n\n1. `package` 必须是程序中可执行的第一行代码\n2. `package` 语句只能有一句，且语句后面有分号\n3. `package` 命名要求包含的所有字符均为小写，同时不能有特殊字符\n4. `package` 可以有多层，每一层有`.`隔开，例如：`package com.frank.hello;`（com是一个文件夹，*frank* 是 *com* 下的一个文件夹，*hello* 是 *frank* 文件夹下的一个文件夹）\n5. 包的路径符合所开发的系统模块的定义\n6. 如果定义类的时候没有使用 *package*，那么 *java* 就认为我们所定义的类位于默认包里面(java.lang)。\n\n## import的作用\n\n在之前的 `SimpleCalculator` 类中，我们还看到了这么一句代码：\n\n```java\nimport java.util.Scanner;\n```\n\n那么 `import` 又是做什么用的呢？\n\n`import` 是在 *java* 文件开头的地方，先说明会用到那些类所在的全路径名，这样我们就能在代码中使用对应的类名，而不是使用全路径。\n\n开发中需要引用到其他包下的类，比如 *JDK* 中一些常用的类，那么就需要先使用 *import* 告诉编译器我们要引用的类的位置，比如说这里的 *Scanner* 。那么你也许会注意到，代码中不是有 `System` 吗，是怎么回事呢？为什么不用引入 `System` 所在的包呢？\n\n这是一个很好的问题。原因是 *java.lang* 这个包实在是太常用了，所以默认可以不用写，编译器会自动引入，编译器只要看到没有使用 `import` 引入包名的类，就会去 *java.lang* 中找。\n\n那如果要引入一个包下所有类该怎么办呢？\n\n有时候需要用到的类刚好有有多在同一个包下面，一个一个引入，显然太费事，别着急，还有更好的解决办法，可以使用`*`来匹配所有，比如说：\n\n```java\nimport java.util.*\n```\n\n那么就会引入`java.util`包下的所有类。\n\n也许你会觉得，那都使用`*`的方式不就好了。如果这样想，那就大错特错了，包的存在就是为了减少类名冲突，这样每次都使用`*`将大量类引入的话，会更容易产生类名冲突，那就适得其反了。\n\n# 小结\n\n本篇讲解了 `package` 和 `import` 的用途，希望通过本篇，你能知道代码中前面的那些代码有什么作用，也能在之后的代码编写中知道如何去正确使用它们。","source":"_posts/java/basic/java-package.md","raw":"---\ntitle: 【Java基础篇】一、Java package与import\ntags:\n  - Java\n  - Java基础\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-04 00:25:02\n---\n\n> 共道人间惆怅事，不知今夕是何年。  -- 《周秦行纪》\n\n## 关卡说明\n\n关卡描述：不知你是否还记得上一篇中的代码，前面的两行，这是在 `Java` 中特定的格式，想要知道它们是什么含义吗？通过本关你就能获得答案。\n\n过关条件：理解 `Java` 中 `package` 与 `import` 的作用以及如何使用它们\n\n关卡难度：⭐️\n\n## 什么是 package\n\n现在再来回顾一下我们上一篇中的代码，首先我们创建了一个类，叫做 `SimpleCalculator` ，文件名叫做 `SimpleCalculator.java`。\n\n在最开头有这么一行：\n\n```java\npackage hello;\n```\n\n第一行会声明这个类所在的包名，因为这个类文件是在 `hello` 包下的，所以第一行的含义就是表明这个类的位置。\n\n## 为什么要使用package\n\n聪明的你也许会想到，同一个包下面应该不允许存在两个相同的文件名，也就是不允许存在相同的类名。确实如此，这也是 `package` 的一个很重要的作用，为类提供一个类似命名空间的管理，避免同名的类产生冲突。\n\n试想一下，如果没有 `package` ，所有类都在同一个地方，那就要争先恐后的使用类名了，后来者可能就要为取名想破脑袋，就像注册游戏名时经常感慨好名字都被🐷拱了那样。\n\n`package` 的另一个作用便是用来将 `Java` 文件进行分类管理，比如有同一种用处的类放到同一个包下，方便查找和管理。\n\n## package命名规范\n\n虽然理论上来说，你可以随心所欲、为所欲为的命名你项目中的包，但还是建议你遵循一定的规范，因为如果大家都遵循规范来设计的话，会减少很多交流成本。\n\n`package` 的命名一般分为几个部分，`身份标识.开发者名/团队名/公司名.项目名.模块名`，对于身份标识，主要是用来标识是个人开发还是团队开发，个人开发主要使用的标识有：*indi*（个体项目）、*onem*（单人项目）、*pers*（个人项目）、*priv*（私有项目），团队开发主要使用的标识有：*team*（团队项目）、*com*（公司项目）。\n\n但其实没有特殊要求的话，使用域名倒写是最常见的，因为域名是不会重复的。\n\n所以比较常见的命名类似于：*com.frank.hello.controller*，*frank*是我的英文名，（假装）*frank.com*是我的域名，*hello* 是项目名，*controller* 则代表这个包都用途，表明在下面我会放控制器（先不用纠结控制器是什么）。\n\n所以，如果还没有英文名的话，赶紧给自己找一个吧。你也许会问，如果有人用了跟自己一样的英文名怎么办？\n\n没有关系，反正极大概率上来说，你又不会使用他的包，即使真遇上了，还是有解决办法的，改改项目名，改改包名，就ok了。\n\n## 使用package的注意事项\n\n1. `package` 必须是程序中可执行的第一行代码\n2. `package` 语句只能有一句，且语句后面有分号\n3. `package` 命名要求包含的所有字符均为小写，同时不能有特殊字符\n4. `package` 可以有多层，每一层有`.`隔开，例如：`package com.frank.hello;`（com是一个文件夹，*frank* 是 *com* 下的一个文件夹，*hello* 是 *frank* 文件夹下的一个文件夹）\n5. 包的路径符合所开发的系统模块的定义\n6. 如果定义类的时候没有使用 *package*，那么 *java* 就认为我们所定义的类位于默认包里面(java.lang)。\n\n## import的作用\n\n在之前的 `SimpleCalculator` 类中，我们还看到了这么一句代码：\n\n```java\nimport java.util.Scanner;\n```\n\n那么 `import` 又是做什么用的呢？\n\n`import` 是在 *java* 文件开头的地方，先说明会用到那些类所在的全路径名，这样我们就能在代码中使用对应的类名，而不是使用全路径。\n\n开发中需要引用到其他包下的类，比如 *JDK* 中一些常用的类，那么就需要先使用 *import* 告诉编译器我们要引用的类的位置，比如说这里的 *Scanner* 。那么你也许会注意到，代码中不是有 `System` 吗，是怎么回事呢？为什么不用引入 `System` 所在的包呢？\n\n这是一个很好的问题。原因是 *java.lang* 这个包实在是太常用了，所以默认可以不用写，编译器会自动引入，编译器只要看到没有使用 `import` 引入包名的类，就会去 *java.lang* 中找。\n\n那如果要引入一个包下所有类该怎么办呢？\n\n有时候需要用到的类刚好有有多在同一个包下面，一个一个引入，显然太费事，别着急，还有更好的解决办法，可以使用`*`来匹配所有，比如说：\n\n```java\nimport java.util.*\n```\n\n那么就会引入`java.util`包下的所有类。\n\n也许你会觉得，那都使用`*`的方式不就好了。如果这样想，那就大错特错了，包的存在就是为了减少类名冲突，这样每次都使用`*`将大量类引入的话，会更容易产生类名冲突，那就适得其反了。\n\n# 小结\n\n本篇讲解了 `package` 和 `import` 的用途，希望通过本篇，你能知道代码中前面的那些代码有什么作用，也能在之后的代码编写中知道如何去正确使用它们。","slug":"java/basic/java-package","published":1,"updated":"2020-05-03T16:25:02.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfg900335ohuddjgdhwc","content":"<blockquote>\n<p>共道人间惆怅事，不知今夕是何年。  – 《周秦行纪》</p>\n</blockquote>\n<h2 id=\"关卡说明\"><a href=\"#关卡说明\" class=\"headerlink\" title=\"关卡说明\"></a>关卡说明</h2><p>关卡描述：不知你是否还记得上一篇中的代码，前面的两行，这是在 <code>Java</code> 中特定的格式，想要知道它们是什么含义吗？通过本关你就能获得答案。</p>\n<p>过关条件：理解 <code>Java</code> 中 <code>package</code> 与 <code>import</code> 的作用以及如何使用它们</p>\n<p>关卡难度：⭐️</p>\n<h2 id=\"什么是-package\"><a href=\"#什么是-package\" class=\"headerlink\" title=\"什么是 package\"></a>什么是 package</h2><p>现在再来回顾一下我们上一篇中的代码，首先我们创建了一个类，叫做 <code>SimpleCalculator</code> ，文件名叫做 <code>SimpleCalculator.java</code>。</p>\n<p>在最开头有这么一行：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> hello<span class=\"token punctuation\">;</span></code></pre>\n<p>第一行会声明这个类所在的包名，因为这个类文件是在 <code>hello</code> 包下的，所以第一行的含义就是表明这个类的位置。</p>\n<h2 id=\"为什么要使用package\"><a href=\"#为什么要使用package\" class=\"headerlink\" title=\"为什么要使用package\"></a>为什么要使用package</h2><p>聪明的你也许会想到，同一个包下面应该不允许存在两个相同的文件名，也就是不允许存在相同的类名。确实如此，这也是 <code>package</code> 的一个很重要的作用，为类提供一个类似命名空间的管理，避免同名的类产生冲突。</p>\n<p>试想一下，如果没有 <code>package</code> ，所有类都在同一个地方，那就要争先恐后的使用类名了，后来者可能就要为取名想破脑袋，就像注册游戏名时经常感慨好名字都被🐷拱了那样。</p>\n<p><code>package</code> 的另一个作用便是用来将 <code>Java</code> 文件进行分类管理，比如有同一种用处的类放到同一个包下，方便查找和管理。</p>\n<h2 id=\"package命名规范\"><a href=\"#package命名规范\" class=\"headerlink\" title=\"package命名规范\"></a>package命名规范</h2><p>虽然理论上来说，你可以随心所欲、为所欲为的命名你项目中的包，但还是建议你遵循一定的规范，因为如果大家都遵循规范来设计的话，会减少很多交流成本。</p>\n<p><code>package</code> 的命名一般分为几个部分，<code>身份标识.开发者名/团队名/公司名.项目名.模块名</code>，对于身份标识，主要是用来标识是个人开发还是团队开发，个人开发主要使用的标识有：<em>indi</em>（个体项目）、<em>onem</em>（单人项目）、<em>pers</em>（个人项目）、<em>priv</em>（私有项目），团队开发主要使用的标识有：<em>team</em>（团队项目）、<em>com</em>（公司项目）。</p>\n<p>但其实没有特殊要求的话，使用域名倒写是最常见的，因为域名是不会重复的。</p>\n<p>所以比较常见的命名类似于：<em>com.frank.hello.controller<em>，</em>frank<em>是我的英文名，（假装）</em>frank.com<em>是我的域名，</em>hello</em> 是项目名，<em>controller</em> 则代表这个包都用途，表明在下面我会放控制器（先不用纠结控制器是什么）。</p>\n<p>所以，如果还没有英文名的话，赶紧给自己找一个吧。你也许会问，如果有人用了跟自己一样的英文名怎么办？</p>\n<p>没有关系，反正极大概率上来说，你又不会使用他的包，即使真遇上了，还是有解决办法的，改改项目名，改改包名，就ok了。</p>\n<h2 id=\"使用package的注意事项\"><a href=\"#使用package的注意事项\" class=\"headerlink\" title=\"使用package的注意事项\"></a>使用package的注意事项</h2><ol>\n<li><code>package</code> 必须是程序中可执行的第一行代码</li>\n<li><code>package</code> 语句只能有一句，且语句后面有分号</li>\n<li><code>package</code> 命名要求包含的所有字符均为小写，同时不能有特殊字符</li>\n<li><code>package</code> 可以有多层，每一层有<code>.</code>隔开，例如：<code>package com.frank.hello;</code>（com是一个文件夹，<em>frank</em> 是 <em>com</em> 下的一个文件夹，<em>hello</em> 是 <em>frank</em> 文件夹下的一个文件夹）</li>\n<li>包的路径符合所开发的系统模块的定义</li>\n<li>如果定义类的时候没有使用 <em>package*，那么 *java</em> 就认为我们所定义的类位于默认包里面(java.lang)。</li>\n</ol>\n<h2 id=\"import的作用\"><a href=\"#import的作用\" class=\"headerlink\" title=\"import的作用\"></a>import的作用</h2><p>在之前的 <code>SimpleCalculator</code> 类中，我们还看到了这么一句代码：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>Scanner<span class=\"token punctuation\">;</span></code></pre>\n<p>那么 <code>import</code> 又是做什么用的呢？</p>\n<p><code>import</code> 是在 <em>java</em> 文件开头的地方，先说明会用到那些类所在的全路径名，这样我们就能在代码中使用对应的类名，而不是使用全路径。</p>\n<p>开发中需要引用到其他包下的类，比如 <em>JDK</em> 中一些常用的类，那么就需要先使用 <em>import</em> 告诉编译器我们要引用的类的位置，比如说这里的 <em>Scanner</em> 。那么你也许会注意到，代码中不是有 <code>System</code> 吗，是怎么回事呢？为什么不用引入 <code>System</code> 所在的包呢？</p>\n<p>这是一个很好的问题。原因是 <em>java.lang</em> 这个包实在是太常用了，所以默认可以不用写，编译器会自动引入，编译器只要看到没有使用 <code>import</code> 引入包名的类，就会去 <em>java.lang</em> 中找。</p>\n<p>那如果要引入一个包下所有类该怎么办呢？</p>\n<p>有时候需要用到的类刚好有有多在同一个包下面，一个一个引入，显然太费事，别着急，还有更好的解决办法，可以使用<code>*</code>来匹配所有，比如说：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>*</code></pre>\n<p>那么就会引入<code>java.util</code>包下的所有类。</p>\n<p>也许你会觉得，那都使用<code>*</code>的方式不就好了。如果这样想，那就大错特错了，包的存在就是为了减少类名冲突，这样每次都使用<code>*</code>将大量类引入的话，会更容易产生类名冲突，那就适得其反了。</p>\n<h1 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h1><p>本篇讲解了 <code>package</code> 和 <code>import</code> 的用途，希望通过本篇，你能知道代码中前面的那些代码有什么作用，也能在之后的代码编写中知道如何去正确使用它们。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>共道人间惆怅事，不知今夕是何年。  – 《周秦行纪》</p>\n</blockquote>\n<h2 id=\"关卡说明\"><a href=\"#关卡说明\" class=\"headerlink\" title=\"关卡说明\"></a>关卡说明</h2><p>关卡描述：不知你是否还记得上一篇中的代码，前面的两行，这是在 <code>Java</code> 中特定的格式，想要知道它们是什么含义吗？通过本关你就能获得答案。</p>\n<p>过关条件：理解 <code>Java</code> 中 <code>package</code> 与 <code>import</code> 的作用以及如何使用它们</p>\n<p>关卡难度：⭐️</p>\n<h2 id=\"什么是-package\"><a href=\"#什么是-package\" class=\"headerlink\" title=\"什么是 package\"></a>什么是 package</h2><p>现在再来回顾一下我们上一篇中的代码，首先我们创建了一个类，叫做 <code>SimpleCalculator</code> ，文件名叫做 <code>SimpleCalculator.java</code>。</p>\n<p>在最开头有这么一行：</p>\n<pre><code class=\"java\">package hello;</code></pre>\n<p>第一行会声明这个类所在的包名，因为这个类文件是在 <code>hello</code> 包下的，所以第一行的含义就是表明这个类的位置。</p>\n<h2 id=\"为什么要使用package\"><a href=\"#为什么要使用package\" class=\"headerlink\" title=\"为什么要使用package\"></a>为什么要使用package</h2><p>聪明的你也许会想到，同一个包下面应该不允许存在两个相同的文件名，也就是不允许存在相同的类名。确实如此，这也是 <code>package</code> 的一个很重要的作用，为类提供一个类似命名空间的管理，避免同名的类产生冲突。</p>\n<p>试想一下，如果没有 <code>package</code> ，所有类都在同一个地方，那就要争先恐后的使用类名了，后来者可能就要为取名想破脑袋，就像注册游戏名时经常感慨好名字都被🐷拱了那样。</p>\n<p><code>package</code> 的另一个作用便是用来将 <code>Java</code> 文件进行分类管理，比如有同一种用处的类放到同一个包下，方便查找和管理。</p>\n<h2 id=\"package命名规范\"><a href=\"#package命名规范\" class=\"headerlink\" title=\"package命名规范\"></a>package命名规范</h2><p>虽然理论上来说，你可以随心所欲、为所欲为的命名你项目中的包，但还是建议你遵循一定的规范，因为如果大家都遵循规范来设计的话，会减少很多交流成本。</p>\n<p><code>package</code> 的命名一般分为几个部分，<code>身份标识.开发者名/团队名/公司名.项目名.模块名</code>，对于身份标识，主要是用来标识是个人开发还是团队开发，个人开发主要使用的标识有：<em>indi</em>（个体项目）、<em>onem</em>（单人项目）、<em>pers</em>（个人项目）、<em>priv</em>（私有项目），团队开发主要使用的标识有：<em>team</em>（团队项目）、<em>com</em>（公司项目）。</p>\n<p>但其实没有特殊要求的话，使用域名倒写是最常见的，因为域名是不会重复的。</p>\n<p>所以比较常见的命名类似于：<em>com.frank.hello.controller<em>，</em>frank<em>是我的英文名，（假装）</em>frank.com<em>是我的域名，</em>hello</em> 是项目名，<em>controller</em> 则代表这个包都用途，表明在下面我会放控制器（先不用纠结控制器是什么）。</p>\n<p>所以，如果还没有英文名的话，赶紧给自己找一个吧。你也许会问，如果有人用了跟自己一样的英文名怎么办？</p>\n<p>没有关系，反正极大概率上来说，你又不会使用他的包，即使真遇上了，还是有解决办法的，改改项目名，改改包名，就ok了。</p>\n<h2 id=\"使用package的注意事项\"><a href=\"#使用package的注意事项\" class=\"headerlink\" title=\"使用package的注意事项\"></a>使用package的注意事项</h2><ol>\n<li><code>package</code> 必须是程序中可执行的第一行代码</li>\n<li><code>package</code> 语句只能有一句，且语句后面有分号</li>\n<li><code>package</code> 命名要求包含的所有字符均为小写，同时不能有特殊字符</li>\n<li><code>package</code> 可以有多层，每一层有<code>.</code>隔开，例如：<code>package com.frank.hello;</code>（com是一个文件夹，<em>frank</em> 是 <em>com</em> 下的一个文件夹，<em>hello</em> 是 <em>frank</em> 文件夹下的一个文件夹）</li>\n<li>包的路径符合所开发的系统模块的定义</li>\n<li>如果定义类的时候没有使用 <em>package*，那么 *java</em> 就认为我们所定义的类位于默认包里面(java.lang)。</li>\n</ol>\n<h2 id=\"import的作用\"><a href=\"#import的作用\" class=\"headerlink\" title=\"import的作用\"></a>import的作用</h2><p>在之前的 <code>SimpleCalculator</code> 类中，我们还看到了这么一句代码：</p>\n<pre><code class=\"java\">import java.util.Scanner;</code></pre>\n<p>那么 <code>import</code> 又是做什么用的呢？</p>\n<p><code>import</code> 是在 <em>java</em> 文件开头的地方，先说明会用到那些类所在的全路径名，这样我们就能在代码中使用对应的类名，而不是使用全路径。</p>\n<p>开发中需要引用到其他包下的类，比如 <em>JDK</em> 中一些常用的类，那么就需要先使用 <em>import</em> 告诉编译器我们要引用的类的位置，比如说这里的 <em>Scanner</em> 。那么你也许会注意到，代码中不是有 <code>System</code> 吗，是怎么回事呢？为什么不用引入 <code>System</code> 所在的包呢？</p>\n<p>这是一个很好的问题。原因是 <em>java.lang</em> 这个包实在是太常用了，所以默认可以不用写，编译器会自动引入，编译器只要看到没有使用 <code>import</code> 引入包名的类，就会去 <em>java.lang</em> 中找。</p>\n<p>那如果要引入一个包下所有类该怎么办呢？</p>\n<p>有时候需要用到的类刚好有有多在同一个包下面，一个一个引入，显然太费事，别着急，还有更好的解决办法，可以使用<code>*</code>来匹配所有，比如说：</p>\n<pre><code class=\"java\">import java.util.*</code></pre>\n<p>那么就会引入<code>java.util</code>包下的所有类。</p>\n<p>也许你会觉得，那都使用<code>*</code>的方式不就好了。如果这样想，那就大错特错了，包的存在就是为了减少类名冲突，这样每次都使用<code>*</code>将大量类引入的话，会更容易产生类名冲突，那就适得其反了。</p>\n<h1 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h1><p>本篇讲解了 <code>package</code> 和 <code>import</code> 的用途，希望通过本篇，你能知道代码中前面的那些代码有什么作用，也能在之后的代码编写中知道如何去正确使用它们。</p>\n"},{"title":"【Java基础篇】四、Java 类与对象","toc":true,"date":"2020-05-03T16:25:05.000Z","_content":"\n# Java 类与对象\n\n>**“Sometimes we stare so long at a door that is closing that we see too late the one that is open.”**\n>\n>— Alexander Graham Bell, Inventor\n>\n>**「我们有时候专注于消失中的机会太久，以致于太晚发现开启的机会。」**– 亚历山大‧贝尔 (发明家)\n\n## 关卡说明\n\n关卡描述：`Java` 是一门面向对象的语言，`类`和`对象`是 `Java` 中最重要的概念，本关将介绍这两个重要的概念，并通过一个简单的栗子来进行说明，你能否通过本关的考验呢？\n\n过关条件：理解面向对象编程的特点，理解 `Java` 中`类`和`对象`的关系，以及如何使用它们\n\n关卡难度：⭐️⭐️\n\n## 面向对象程序设计\n\n**面向对象编程**（Object Oriented Programming 简称OOP）是当今主流的程序设计规范，*Java*是完全面向对象的，所以必须熟悉++OOP++才能编写出优秀的*Java*代码。\n\n**面向对象编程**，顾名思义，重点就在于这个对象，没有对象怎么编程（手动滑稽）。咳咳，言归正传，面向对象的程序是由许许多多的对象组成，每个对象具有一定的属性和行为，通过对象之间的交互来实现软件的功能。从根本上来说，只要这个对象能满足功能要求，就不必关心它的具体实现过程。换句话说，**不管是黑猫白猫，能抓耗子的猫就是好猫**。\n\n传统的程序设计是面向过程编程，在传统的程序设计过程中，通常需要先设计一系列的算法来求解问题，然后再考虑存储数据的方式。这就是所谓的：\n\n> 算法 + 数据结构 = 程序\n\n在面向过程的设计中，算法是放在第一位的，数据结构是为了适应算法而存在的。\n\n而在OOP中，这个顺序刚好相反，数据结构放在第一位，然后再考虑操作数据的算法。\n\n两种开发方式各有利弊，一些简单的问题，使用面向过程的开发方式是比较容易的，因为它符合人们的惯常思考方式，先这样做，再那样做，最后得到一个什么样的结果。而面向对象的编程适合于解决更复杂的问题。比如实现一个网站也许需要1000个函数，这些过程可能会对一组全局的数据进行操作。如果采用面向对象的方式来设计，可能只需要大约100个类，每个类10个方法，而且大多数情况下，面向过程开发的代码中有很多设计是可以使用面向对象的方式简化和复用的。所以后者显然更容易掌握和维护，而且如果万一某个数据出了问题，在10个方法中排查总比在1000个函数中排查要容易得多。\n\n## Java中的类和对象\n\n既然面向对象编程这么优秀，那么我们就来好好认识一下这其中的主人公——类和对象。\n\n“类”是对具有相同属性的一系列事物的抽象，比如说，“人类”，描述的就是有“人”这个共同属性和行为的群体，普通的人都有两只手，两只脚等基本外貌特征，也具有说话，吃东西等能力，比如“轿车”描述的是有四个轮子，可以驾驶，可以载人的小型车辆，不管你是黑色的奔驰还是白色的宝马，都可以叫做轿车。\n\n那么什么是对象呢？对象就是类的某个具体实例，就好比你和我都是“人类”的一个具体实例，所以我们都是“人类”的一个对象。你家车库里的那辆轿车（不管是奔驰还是大众），也是“轿车”的一个对象。\n\n> 类是抽象的概念，是对具有共同特征的事物的抽象，而对象则是具体的概念，是指某一个具体的实例。\n\n类可以看作是对象的模子，可以用它来生产任意多个对象。\n\n## 类的定义\n\n先来看一个小栗子，我们来定义一个人类：\n\n```java\npublic class Person{\n    private String name;\n    private int age;\n    \n    public Person(String name, int age){\n        this.name = name;\n        this.age = age;\n    }\n    \n    public void eat(){\n        System.out.println(\"开始吃饭...\");\n    }\n    \n    public void say(){\n        System.out.println(\"我叫\" + name + \"，我今年\" + age + \"岁\");\n    }\n}\n```\n\n这里我们定义了一个类，类的名字叫做`Person`，它有两个属性，一个是`name`，一个是`age`。并且有三个方法，一个是构造函数，两个是Person的行为，吃饭和说话。\n\n可以看到，定义类的时候，我们是这样的：\n\n```java\npublic class Person{\n\t...\n}\n```\n\n定义类的格式为：\n\n> [访问权限修饰符] + class + [类名] \n\n其中访问权限修饰符用来表示类是否可以被外部类访问，`public`是最宽松的访问权限，表示这个类可以被外部的类访问和使用。关于访问权限修饰符，后面还会有更详细的介绍。\n\n`class`是用来声明一个类的关键字。什么是关键字呢？可以理解为一种声明，就像武功招式一样，大都会有一个起手式。`Java` 中的关键字其实不多，常用的就更少，所以在之后的学习过程中慢慢掌握就好了，不用太担心。\n\n关于类名，跟变量名一样，必须以字母开头，可以由字母、数字和下划线和$组成，但跟变量命名不同的是，Java中的类名规范通常使用大驼峰命名法，即每个单词的首字母都大写。比如：*SmallCar*、*SecondhandBook*。\n\n## 类的组成\n\n一个类主要由实例域和方法域组成，实例域由类的成员变量组成，上面的栗子中，Person类的实例域为：\n\n```java\nprivate String name;\nprivate int age;\n```\n\n这是Person类的两个成员变量，也叫Person类的属性，一个人有名字和年龄，在这里对应的两个属性就是`name`和`age`。\n\n成员变量定义的规则为：\n\n> [访问修饰符] + [成员变量类型] + [变量名]\n\n接下来是方法域，顾名思义便是由各种方法组成的。方法的定义规则为：\n\n> [访问修饰符] + [方法返回值类型] + [方法名]\n\n```java\npublic void eat(){\n    System.out.println(\"开始吃饭...\");\n}\n\npublic void say(){\n    System.out.println(\"我叫\" + name + \"，我今年\" + age + \"岁\");\n}\n```\n\n这里，`void`表示当前方法无返回值。方法的命名跟变量的命名规则一样，也使用小驼峰命名法。需要注意的一点是，无论是类名、方法名还是变量名，都需要具有一定的意义，也就是要能够传达出它代表的含义，做到见名知义。像`a1`、`a2`这样的命名就尽量不要出现。\n\n也许你会好奇，上面不是还有一个方法吗？为什看起来有点奇怪呢？为什么它不使用小驼峰，为什么它跟类名是一样的？\n\n```java\npublic Person(String name, int age){\n    this.name = name;\n    this.age = age;\n}\n```\n\n这是一个好问题，它叫做**构造函数**，是创建变量时使用的一个特殊的方法，与类名同名。这个方法有两个参数，一个是`String`类型，一个是`int`类型，`name`和`age`是参数名，跟变量名类似。这里面还用了一个`this`关键字，代表当前对象，可以看到参数名跟上面的成员变量名相同，为了将它们区分开来，就使用了`this.name`和`this.age`来表示成员变量。这个方法的作用就是接收传进来的两个参数，并将它们分别赋值给成员变量。关于构造函数的具体作用会在之后的篇章里做说明，这里就先不详细介绍了。\n\n## 对象的创建和使用\n\n既然已经有了类，那么如何创建对象呢？这时候就需要使用新的招式——`new`关键字。下面我们在*Person*类中加入一个main方法（如果不记得*main*方法是干嘛的了，可以翻看一下上一篇的内容），并在其中创建一个*Person*对象并调用它的方法。\n\n```java\npublic class Person {\n    ...\n\n    public static void main(String[] args){\n        Person alice = new Person(\"Alice\", 18);\n        alice.say();\n        alice.eat();\n    }\n}\n```\n\n输出如下：\n\n```bash\n我叫Alice，我今年18岁\n开始吃饭...\n```\n\n老规矩，我们来逐行分析，首先我们使用了`new`关键字创建了一个对象：\n\n```java\nPerson alice = new Person(\"Alice\", 18);\n```\n\n在前面我们已经介绍过变量的声明方式了，回顾一下：\n\n> [类名] + [变量名]\n\n*Person*是类名，*alice*是变量的名字，后面半段的作用是创建对象。往里面传了两个参数：`Alice`和`18`。创建好对象后，赋值给*alice*变量。\n\n然后我们分别调用了两个方法，`say`和`eat`。方法调用的格式为：\n\n> [对象] + 点号 + [方法名] + [参数]\n\n```java\nalice.say();\nalice.eat();\n```\n\n这两个方法都不需要传参数，可以直接调用。这样，我们就完成了创建对象并调用的全过程。\n\n# 小结\n\n本篇文章到此就告一段落了，本篇内容相对较多一点，而且也是相当重要的一篇，希望能仔细阅读，能通过本篇的学习了解类和对象是什么，以及如何使用。\n\n也许到这里你还有很多疑惑，但没有关系，在之后的学习和练习的过程中，相信你会慢慢理解的。","source":"_posts/java/basic/java-class.md","raw":"---\ntitle: 【Java基础篇】四、Java 类与对象\ntags:\n  - Java\n  - Java基础\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-04 00:25:05\n---\n\n# Java 类与对象\n\n>**“Sometimes we stare so long at a door that is closing that we see too late the one that is open.”**\n>\n>— Alexander Graham Bell, Inventor\n>\n>**「我们有时候专注于消失中的机会太久，以致于太晚发现开启的机会。」**– 亚历山大‧贝尔 (发明家)\n\n## 关卡说明\n\n关卡描述：`Java` 是一门面向对象的语言，`类`和`对象`是 `Java` 中最重要的概念，本关将介绍这两个重要的概念，并通过一个简单的栗子来进行说明，你能否通过本关的考验呢？\n\n过关条件：理解面向对象编程的特点，理解 `Java` 中`类`和`对象`的关系，以及如何使用它们\n\n关卡难度：⭐️⭐️\n\n## 面向对象程序设计\n\n**面向对象编程**（Object Oriented Programming 简称OOP）是当今主流的程序设计规范，*Java*是完全面向对象的，所以必须熟悉++OOP++才能编写出优秀的*Java*代码。\n\n**面向对象编程**，顾名思义，重点就在于这个对象，没有对象怎么编程（手动滑稽）。咳咳，言归正传，面向对象的程序是由许许多多的对象组成，每个对象具有一定的属性和行为，通过对象之间的交互来实现软件的功能。从根本上来说，只要这个对象能满足功能要求，就不必关心它的具体实现过程。换句话说，**不管是黑猫白猫，能抓耗子的猫就是好猫**。\n\n传统的程序设计是面向过程编程，在传统的程序设计过程中，通常需要先设计一系列的算法来求解问题，然后再考虑存储数据的方式。这就是所谓的：\n\n> 算法 + 数据结构 = 程序\n\n在面向过程的设计中，算法是放在第一位的，数据结构是为了适应算法而存在的。\n\n而在OOP中，这个顺序刚好相反，数据结构放在第一位，然后再考虑操作数据的算法。\n\n两种开发方式各有利弊，一些简单的问题，使用面向过程的开发方式是比较容易的，因为它符合人们的惯常思考方式，先这样做，再那样做，最后得到一个什么样的结果。而面向对象的编程适合于解决更复杂的问题。比如实现一个网站也许需要1000个函数，这些过程可能会对一组全局的数据进行操作。如果采用面向对象的方式来设计，可能只需要大约100个类，每个类10个方法，而且大多数情况下，面向过程开发的代码中有很多设计是可以使用面向对象的方式简化和复用的。所以后者显然更容易掌握和维护，而且如果万一某个数据出了问题，在10个方法中排查总比在1000个函数中排查要容易得多。\n\n## Java中的类和对象\n\n既然面向对象编程这么优秀，那么我们就来好好认识一下这其中的主人公——类和对象。\n\n“类”是对具有相同属性的一系列事物的抽象，比如说，“人类”，描述的就是有“人”这个共同属性和行为的群体，普通的人都有两只手，两只脚等基本外貌特征，也具有说话，吃东西等能力，比如“轿车”描述的是有四个轮子，可以驾驶，可以载人的小型车辆，不管你是黑色的奔驰还是白色的宝马，都可以叫做轿车。\n\n那么什么是对象呢？对象就是类的某个具体实例，就好比你和我都是“人类”的一个具体实例，所以我们都是“人类”的一个对象。你家车库里的那辆轿车（不管是奔驰还是大众），也是“轿车”的一个对象。\n\n> 类是抽象的概念，是对具有共同特征的事物的抽象，而对象则是具体的概念，是指某一个具体的实例。\n\n类可以看作是对象的模子，可以用它来生产任意多个对象。\n\n## 类的定义\n\n先来看一个小栗子，我们来定义一个人类：\n\n```java\npublic class Person{\n    private String name;\n    private int age;\n    \n    public Person(String name, int age){\n        this.name = name;\n        this.age = age;\n    }\n    \n    public void eat(){\n        System.out.println(\"开始吃饭...\");\n    }\n    \n    public void say(){\n        System.out.println(\"我叫\" + name + \"，我今年\" + age + \"岁\");\n    }\n}\n```\n\n这里我们定义了一个类，类的名字叫做`Person`，它有两个属性，一个是`name`，一个是`age`。并且有三个方法，一个是构造函数，两个是Person的行为，吃饭和说话。\n\n可以看到，定义类的时候，我们是这样的：\n\n```java\npublic class Person{\n\t...\n}\n```\n\n定义类的格式为：\n\n> [访问权限修饰符] + class + [类名] \n\n其中访问权限修饰符用来表示类是否可以被外部类访问，`public`是最宽松的访问权限，表示这个类可以被外部的类访问和使用。关于访问权限修饰符，后面还会有更详细的介绍。\n\n`class`是用来声明一个类的关键字。什么是关键字呢？可以理解为一种声明，就像武功招式一样，大都会有一个起手式。`Java` 中的关键字其实不多，常用的就更少，所以在之后的学习过程中慢慢掌握就好了，不用太担心。\n\n关于类名，跟变量名一样，必须以字母开头，可以由字母、数字和下划线和$组成，但跟变量命名不同的是，Java中的类名规范通常使用大驼峰命名法，即每个单词的首字母都大写。比如：*SmallCar*、*SecondhandBook*。\n\n## 类的组成\n\n一个类主要由实例域和方法域组成，实例域由类的成员变量组成，上面的栗子中，Person类的实例域为：\n\n```java\nprivate String name;\nprivate int age;\n```\n\n这是Person类的两个成员变量，也叫Person类的属性，一个人有名字和年龄，在这里对应的两个属性就是`name`和`age`。\n\n成员变量定义的规则为：\n\n> [访问修饰符] + [成员变量类型] + [变量名]\n\n接下来是方法域，顾名思义便是由各种方法组成的。方法的定义规则为：\n\n> [访问修饰符] + [方法返回值类型] + [方法名]\n\n```java\npublic void eat(){\n    System.out.println(\"开始吃饭...\");\n}\n\npublic void say(){\n    System.out.println(\"我叫\" + name + \"，我今年\" + age + \"岁\");\n}\n```\n\n这里，`void`表示当前方法无返回值。方法的命名跟变量的命名规则一样，也使用小驼峰命名法。需要注意的一点是，无论是类名、方法名还是变量名，都需要具有一定的意义，也就是要能够传达出它代表的含义，做到见名知义。像`a1`、`a2`这样的命名就尽量不要出现。\n\n也许你会好奇，上面不是还有一个方法吗？为什看起来有点奇怪呢？为什么它不使用小驼峰，为什么它跟类名是一样的？\n\n```java\npublic Person(String name, int age){\n    this.name = name;\n    this.age = age;\n}\n```\n\n这是一个好问题，它叫做**构造函数**，是创建变量时使用的一个特殊的方法，与类名同名。这个方法有两个参数，一个是`String`类型，一个是`int`类型，`name`和`age`是参数名，跟变量名类似。这里面还用了一个`this`关键字，代表当前对象，可以看到参数名跟上面的成员变量名相同，为了将它们区分开来，就使用了`this.name`和`this.age`来表示成员变量。这个方法的作用就是接收传进来的两个参数，并将它们分别赋值给成员变量。关于构造函数的具体作用会在之后的篇章里做说明，这里就先不详细介绍了。\n\n## 对象的创建和使用\n\n既然已经有了类，那么如何创建对象呢？这时候就需要使用新的招式——`new`关键字。下面我们在*Person*类中加入一个main方法（如果不记得*main*方法是干嘛的了，可以翻看一下上一篇的内容），并在其中创建一个*Person*对象并调用它的方法。\n\n```java\npublic class Person {\n    ...\n\n    public static void main(String[] args){\n        Person alice = new Person(\"Alice\", 18);\n        alice.say();\n        alice.eat();\n    }\n}\n```\n\n输出如下：\n\n```bash\n我叫Alice，我今年18岁\n开始吃饭...\n```\n\n老规矩，我们来逐行分析，首先我们使用了`new`关键字创建了一个对象：\n\n```java\nPerson alice = new Person(\"Alice\", 18);\n```\n\n在前面我们已经介绍过变量的声明方式了，回顾一下：\n\n> [类名] + [变量名]\n\n*Person*是类名，*alice*是变量的名字，后面半段的作用是创建对象。往里面传了两个参数：`Alice`和`18`。创建好对象后，赋值给*alice*变量。\n\n然后我们分别调用了两个方法，`say`和`eat`。方法调用的格式为：\n\n> [对象] + 点号 + [方法名] + [参数]\n\n```java\nalice.say();\nalice.eat();\n```\n\n这两个方法都不需要传参数，可以直接调用。这样，我们就完成了创建对象并调用的全过程。\n\n# 小结\n\n本篇文章到此就告一段落了，本篇内容相对较多一点，而且也是相当重要的一篇，希望能仔细阅读，能通过本篇的学习了解类和对象是什么，以及如何使用。\n\n也许到这里你还有很多疑惑，但没有关系，在之后的学习和练习的过程中，相信你会慢慢理解的。","slug":"java/basic/java-class","published":1,"updated":"2020-05-03T16:25:05.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfg900355ohu6io7ermn","content":"<h1 id=\"Java-类与对象\"><a href=\"#Java-类与对象\" class=\"headerlink\" title=\"Java 类与对象\"></a>Java 类与对象</h1><blockquote>\n<p><strong>“Sometimes we stare so long at a door that is closing that we see too late the one that is open.”</strong></p>\n<p>— Alexander Graham Bell, Inventor</p>\n<p><strong>「我们有时候专注于消失中的机会太久，以致于太晚发现开启的机会。」</strong>– 亚历山大‧贝尔 (发明家)</p>\n</blockquote>\n<h2 id=\"关卡说明\"><a href=\"#关卡说明\" class=\"headerlink\" title=\"关卡说明\"></a>关卡说明</h2><p>关卡描述：<code>Java</code> 是一门面向对象的语言，<code>类</code>和<code>对象</code>是 <code>Java</code> 中最重要的概念，本关将介绍这两个重要的概念，并通过一个简单的栗子来进行说明，你能否通过本关的考验呢？</p>\n<p>过关条件：理解面向对象编程的特点，理解 <code>Java</code> 中<code>类</code>和<code>对象</code>的关系，以及如何使用它们</p>\n<p>关卡难度：⭐️⭐️</p>\n<h2 id=\"面向对象程序设计\"><a href=\"#面向对象程序设计\" class=\"headerlink\" title=\"面向对象程序设计\"></a>面向对象程序设计</h2><p><strong>面向对象编程</strong>（Object Oriented Programming 简称OOP）是当今主流的程序设计规范，<em>Java</em>是完全面向对象的，所以必须熟悉++OOP++才能编写出优秀的<em>Java</em>代码。</p>\n<p><strong>面向对象编程</strong>，顾名思义，重点就在于这个对象，没有对象怎么编程（手动滑稽）。咳咳，言归正传，面向对象的程序是由许许多多的对象组成，每个对象具有一定的属性和行为，通过对象之间的交互来实现软件的功能。从根本上来说，只要这个对象能满足功能要求，就不必关心它的具体实现过程。换句话说，<strong>不管是黑猫白猫，能抓耗子的猫就是好猫</strong>。</p>\n<p>传统的程序设计是面向过程编程，在传统的程序设计过程中，通常需要先设计一系列的算法来求解问题，然后再考虑存储数据的方式。这就是所谓的：</p>\n<blockquote>\n<p>算法 + 数据结构 = 程序</p>\n</blockquote>\n<p>在面向过程的设计中，算法是放在第一位的，数据结构是为了适应算法而存在的。</p>\n<p>而在OOP中，这个顺序刚好相反，数据结构放在第一位，然后再考虑操作数据的算法。</p>\n<p>两种开发方式各有利弊，一些简单的问题，使用面向过程的开发方式是比较容易的，因为它符合人们的惯常思考方式，先这样做，再那样做，最后得到一个什么样的结果。而面向对象的编程适合于解决更复杂的问题。比如实现一个网站也许需要1000个函数，这些过程可能会对一组全局的数据进行操作。如果采用面向对象的方式来设计，可能只需要大约100个类，每个类10个方法，而且大多数情况下，面向过程开发的代码中有很多设计是可以使用面向对象的方式简化和复用的。所以后者显然更容易掌握和维护，而且如果万一某个数据出了问题，在10个方法中排查总比在1000个函数中排查要容易得多。</p>\n<h2 id=\"Java中的类和对象\"><a href=\"#Java中的类和对象\" class=\"headerlink\" title=\"Java中的类和对象\"></a>Java中的类和对象</h2><p>既然面向对象编程这么优秀，那么我们就来好好认识一下这其中的主人公——类和对象。</p>\n<p>“类”是对具有相同属性的一系列事物的抽象，比如说，“人类”，描述的就是有“人”这个共同属性和行为的群体，普通的人都有两只手，两只脚等基本外貌特征，也具有说话，吃东西等能力，比如“轿车”描述的是有四个轮子，可以驾驶，可以载人的小型车辆，不管你是黑色的奔驰还是白色的宝马，都可以叫做轿车。</p>\n<p>那么什么是对象呢？对象就是类的某个具体实例，就好比你和我都是“人类”的一个具体实例，所以我们都是“人类”的一个对象。你家车库里的那辆轿车（不管是奔驰还是大众），也是“轿车”的一个对象。</p>\n<blockquote>\n<p>类是抽象的概念，是对具有共同特征的事物的抽象，而对象则是具体的概念，是指某一个具体的实例。</p>\n</blockquote>\n<p>类可以看作是对象的模子，可以用它来生产任意多个对象。</p>\n<h2 id=\"类的定义\"><a href=\"#类的定义\" class=\"headerlink\" title=\"类的定义\"></a>类的定义</h2><p>先来看一个小栗子，我们来定义一个人类：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> String name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span>String name<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> age<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"开始吃饭...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"我叫\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token string\">\"，我今年\"</span> <span class=\"token operator\">+</span> age <span class=\"token operator\">+</span> <span class=\"token string\">\"岁\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这里我们定义了一个类，类的名字叫做<code>Person</code>，它有两个属性，一个是<code>name</code>，一个是<code>age</code>。并且有三个方法，一个是构造函数，两个是Person的行为，吃饭和说话。</p>\n<p>可以看到，定义类的时候，我们是这样的：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>定义类的格式为：</p>\n<blockquote>\n<p>[访问权限修饰符] + class + [类名] </p>\n</blockquote>\n<p>其中访问权限修饰符用来表示类是否可以被外部类访问，<code>public</code>是最宽松的访问权限，表示这个类可以被外部的类访问和使用。关于访问权限修饰符，后面还会有更详细的介绍。</p>\n<p><code>class</code>是用来声明一个类的关键字。什么是关键字呢？可以理解为一种声明，就像武功招式一样，大都会有一个起手式。<code>Java</code> 中的关键字其实不多，常用的就更少，所以在之后的学习过程中慢慢掌握就好了，不用太担心。</p>\n<p>关于类名，跟变量名一样，必须以字母开头，可以由字母、数字和下划线和$组成，但跟变量命名不同的是，Java中的类名规范通常使用大驼峰命名法，即每个单词的首字母都大写。比如：<em>SmallCar</em>、<em>SecondhandBook</em>。</p>\n<h2 id=\"类的组成\"><a href=\"#类的组成\" class=\"headerlink\" title=\"类的组成\"></a>类的组成</h2><p>一个类主要由实例域和方法域组成，实例域由类的成员变量组成，上面的栗子中，Person类的实例域为：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> String name<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span></code></pre>\n<p>这是Person类的两个成员变量，也叫Person类的属性，一个人有名字和年龄，在这里对应的两个属性就是<code>name</code>和<code>age</code>。</p>\n<p>成员变量定义的规则为：</p>\n<blockquote>\n<p>[访问修饰符] + [成员变量类型] + [变量名]</p>\n</blockquote>\n<p>接下来是方法域，顾名思义便是由各种方法组成的。方法的定义规则为：</p>\n<blockquote>\n<p>[访问修饰符] + [方法返回值类型] + [方法名]</p>\n</blockquote>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"开始吃饭...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"我叫\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token string\">\"，我今年\"</span> <span class=\"token operator\">+</span> age <span class=\"token operator\">+</span> <span class=\"token string\">\"岁\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这里，<code>void</code>表示当前方法无返回值。方法的命名跟变量的命名规则一样，也使用小驼峰命名法。需要注意的一点是，无论是类名、方法名还是变量名，都需要具有一定的意义，也就是要能够传达出它代表的含义，做到见名知义。像<code>a1</code>、<code>a2</code>这样的命名就尽量不要出现。</p>\n<p>也许你会好奇，上面不是还有一个方法吗？为什看起来有点奇怪呢？为什么它不使用小驼峰，为什么它跟类名是一样的？</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span>String name<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> age<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这是一个好问题，它叫做<strong>构造函数</strong>，是创建变量时使用的一个特殊的方法，与类名同名。这个方法有两个参数，一个是<code>String</code>类型，一个是<code>int</code>类型，<code>name</code>和<code>age</code>是参数名，跟变量名类似。这里面还用了一个<code>this</code>关键字，代表当前对象，可以看到参数名跟上面的成员变量名相同，为了将它们区分开来，就使用了<code>this.name</code>和<code>this.age</code>来表示成员变量。这个方法的作用就是接收传进来的两个参数，并将它们分别赋值给成员变量。关于构造函数的具体作用会在之后的篇章里做说明，这里就先不详细介绍了。</p>\n<h2 id=\"对象的创建和使用\"><a href=\"#对象的创建和使用\" class=\"headerlink\" title=\"对象的创建和使用\"></a>对象的创建和使用</h2><p>既然已经有了类，那么如何创建对象呢？这时候就需要使用新的招式——<code>new</code>关键字。下面我们在<em>Person</em>类中加入一个main方法（如果不记得<em>main</em>方法是干嘛的了，可以翻看一下上一篇的内容），并在其中创建一个<em>Person</em>对象并调用它的方法。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Person</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        Person alice <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Alice\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        alice<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        alice<span class=\"token punctuation\">.</span><span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>输出如下：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">我叫Alice，我今年18岁\n开始吃饭<span class=\"token punctuation\">..</span>.</code></pre>\n<p>老规矩，我们来逐行分析，首先我们使用了<code>new</code>关键字创建了一个对象：</p>\n<pre class=\" language-java\"><code class=\"language-java\">Person alice <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Alice\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>在前面我们已经介绍过变量的声明方式了，回顾一下：</p>\n<blockquote>\n<p>[类名] + [变量名]</p>\n</blockquote>\n<p><em>Person</em>是类名，<em>alice</em>是变量的名字，后面半段的作用是创建对象。往里面传了两个参数：<code>Alice</code>和<code>18</code>。创建好对象后，赋值给<em>alice</em>变量。</p>\n<p>然后我们分别调用了两个方法，<code>say</code>和<code>eat</code>。方法调用的格式为：</p>\n<blockquote>\n<p>[对象] + 点号 + [方法名] + [参数]</p>\n</blockquote>\n<pre class=\" language-java\"><code class=\"language-java\">alice<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nalice<span class=\"token punctuation\">.</span><span class=\"token function\">eat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>这两个方法都不需要传参数，可以直接调用。这样，我们就完成了创建对象并调用的全过程。</p>\n<h1 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h1><p>本篇文章到此就告一段落了，本篇内容相对较多一点，而且也是相当重要的一篇，希望能仔细阅读，能通过本篇的学习了解类和对象是什么，以及如何使用。</p>\n<p>也许到这里你还有很多疑惑，但没有关系，在之后的学习和练习的过程中，相信你会慢慢理解的。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<h1 id=\"Java-类与对象\"><a href=\"#Java-类与对象\" class=\"headerlink\" title=\"Java 类与对象\"></a>Java 类与对象</h1><blockquote>\n<p><strong>“Sometimes we stare so long at a door that is closing that we see too late the one that is open.”</strong></p>\n<p>— Alexander Graham Bell, Inventor</p>\n<p><strong>「我们有时候专注于消失中的机会太久，以致于太晚发现开启的机会。」</strong>– 亚历山大‧贝尔 (发明家)</p>\n</blockquote>\n<h2 id=\"关卡说明\"><a href=\"#关卡说明\" class=\"headerlink\" title=\"关卡说明\"></a>关卡说明</h2><p>关卡描述：<code>Java</code> 是一门面向对象的语言，<code>类</code>和<code>对象</code>是 <code>Java</code> 中最重要的概念，本关将介绍这两个重要的概念，并通过一个简单的栗子来进行说明，你能否通过本关的考验呢？</p>\n<p>过关条件：理解面向对象编程的特点，理解 <code>Java</code> 中<code>类</code>和<code>对象</code>的关系，以及如何使用它们</p>\n<p>关卡难度：⭐️⭐️</p>\n<h2 id=\"面向对象程序设计\"><a href=\"#面向对象程序设计\" class=\"headerlink\" title=\"面向对象程序设计\"></a>面向对象程序设计</h2><p><strong>面向对象编程</strong>（Object Oriented Programming 简称OOP）是当今主流的程序设计规范，<em>Java</em>是完全面向对象的，所以必须熟悉++OOP++才能编写出优秀的<em>Java</em>代码。</p>\n<p><strong>面向对象编程</strong>，顾名思义，重点就在于这个对象，没有对象怎么编程（手动滑稽）。咳咳，言归正传，面向对象的程序是由许许多多的对象组成，每个对象具有一定的属性和行为，通过对象之间的交互来实现软件的功能。从根本上来说，只要这个对象能满足功能要求，就不必关心它的具体实现过程。换句话说，<strong>不管是黑猫白猫，能抓耗子的猫就是好猫</strong>。</p>\n<p>传统的程序设计是面向过程编程，在传统的程序设计过程中，通常需要先设计一系列的算法来求解问题，然后再考虑存储数据的方式。这就是所谓的：</p>\n<blockquote>\n<p>算法 + 数据结构 = 程序</p>\n</blockquote>\n<p>在面向过程的设计中，算法是放在第一位的，数据结构是为了适应算法而存在的。</p>\n<p>而在OOP中，这个顺序刚好相反，数据结构放在第一位，然后再考虑操作数据的算法。</p>\n<p>两种开发方式各有利弊，一些简单的问题，使用面向过程的开发方式是比较容易的，因为它符合人们的惯常思考方式，先这样做，再那样做，最后得到一个什么样的结果。而面向对象的编程适合于解决更复杂的问题。比如实现一个网站也许需要1000个函数，这些过程可能会对一组全局的数据进行操作。如果采用面向对象的方式来设计，可能只需要大约100个类，每个类10个方法，而且大多数情况下，面向过程开发的代码中有很多设计是可以使用面向对象的方式简化和复用的。所以后者显然更容易掌握和维护，而且如果万一某个数据出了问题，在10个方法中排查总比在1000个函数中排查要容易得多。</p>\n<h2 id=\"Java中的类和对象\"><a href=\"#Java中的类和对象\" class=\"headerlink\" title=\"Java中的类和对象\"></a>Java中的类和对象</h2><p>既然面向对象编程这么优秀，那么我们就来好好认识一下这其中的主人公——类和对象。</p>\n<p>“类”是对具有相同属性的一系列事物的抽象，比如说，“人类”，描述的就是有“人”这个共同属性和行为的群体，普通的人都有两只手，两只脚等基本外貌特征，也具有说话，吃东西等能力，比如“轿车”描述的是有四个轮子，可以驾驶，可以载人的小型车辆，不管你是黑色的奔驰还是白色的宝马，都可以叫做轿车。</p>\n<p>那么什么是对象呢？对象就是类的某个具体实例，就好比你和我都是“人类”的一个具体实例，所以我们都是“人类”的一个对象。你家车库里的那辆轿车（不管是奔驰还是大众），也是“轿车”的一个对象。</p>\n<blockquote>\n<p>类是抽象的概念，是对具有共同特征的事物的抽象，而对象则是具体的概念，是指某一个具体的实例。</p>\n</blockquote>\n<p>类可以看作是对象的模子，可以用它来生产任意多个对象。</p>\n<h2 id=\"类的定义\"><a href=\"#类的定义\" class=\"headerlink\" title=\"类的定义\"></a>类的定义</h2><p>先来看一个小栗子，我们来定义一个人类：</p>\n<pre><code class=\"java\">public class Person{\n    private String name;\n    private int age;\n\n    public Person(String name, int age){\n        this.name = name;\n        this.age = age;\n    }\n\n    public void eat(){\n        System.out.println(&quot;开始吃饭...&quot;);\n    }\n\n    public void say(){\n        System.out.println(&quot;我叫&quot; + name + &quot;，我今年&quot; + age + &quot;岁&quot;);\n    }\n}</code></pre>\n<p>这里我们定义了一个类，类的名字叫做<code>Person</code>，它有两个属性，一个是<code>name</code>，一个是<code>age</code>。并且有三个方法，一个是构造函数，两个是Person的行为，吃饭和说话。</p>\n<p>可以看到，定义类的时候，我们是这样的：</p>\n<pre><code class=\"java\">public class Person{\n    ...\n}</code></pre>\n<p>定义类的格式为：</p>\n<blockquote>\n<p>[访问权限修饰符] + class + [类名] </p>\n</blockquote>\n<p>其中访问权限修饰符用来表示类是否可以被外部类访问，<code>public</code>是最宽松的访问权限，表示这个类可以被外部的类访问和使用。关于访问权限修饰符，后面还会有更详细的介绍。</p>\n<p><code>class</code>是用来声明一个类的关键字。什么是关键字呢？可以理解为一种声明，就像武功招式一样，大都会有一个起手式。<code>Java</code> 中的关键字其实不多，常用的就更少，所以在之后的学习过程中慢慢掌握就好了，不用太担心。</p>\n<p>关于类名，跟变量名一样，必须以字母开头，可以由字母、数字和下划线和$组成，但跟变量命名不同的是，Java中的类名规范通常使用大驼峰命名法，即每个单词的首字母都大写。比如：<em>SmallCar</em>、<em>SecondhandBook</em>。</p>\n<h2 id=\"类的组成\"><a href=\"#类的组成\" class=\"headerlink\" title=\"类的组成\"></a>类的组成</h2><p>一个类主要由实例域和方法域组成，实例域由类的成员变量组成，上面的栗子中，Person类的实例域为：</p>\n<pre><code class=\"java\">private String name;\nprivate int age;</code></pre>\n<p>这是Person类的两个成员变量，也叫Person类的属性，一个人有名字和年龄，在这里对应的两个属性就是<code>name</code>和<code>age</code>。</p>\n<p>成员变量定义的规则为：</p>\n<blockquote>\n<p>[访问修饰符] + [成员变量类型] + [变量名]</p>\n</blockquote>\n<p>接下来是方法域，顾名思义便是由各种方法组成的。方法的定义规则为：</p>\n<blockquote>\n<p>[访问修饰符] + [方法返回值类型] + [方法名]</p>\n</blockquote>\n<pre><code class=\"java\">public void eat(){\n    System.out.println(&quot;开始吃饭...&quot;);\n}\n\npublic void say(){\n    System.out.println(&quot;我叫&quot; + name + &quot;，我今年&quot; + age + &quot;岁&quot;);\n}</code></pre>\n<p>这里，<code>void</code>表示当前方法无返回值。方法的命名跟变量的命名规则一样，也使用小驼峰命名法。需要注意的一点是，无论是类名、方法名还是变量名，都需要具有一定的意义，也就是要能够传达出它代表的含义，做到见名知义。像<code>a1</code>、<code>a2</code>这样的命名就尽量不要出现。</p>\n<p>也许你会好奇，上面不是还有一个方法吗？为什看起来有点奇怪呢？为什么它不使用小驼峰，为什么它跟类名是一样的？</p>\n<pre><code class=\"java\">public Person(String name, int age){\n    this.name = name;\n    this.age = age;\n}</code></pre>\n<p>这是一个好问题，它叫做<strong>构造函数</strong>，是创建变量时使用的一个特殊的方法，与类名同名。这个方法有两个参数，一个是<code>String</code>类型，一个是<code>int</code>类型，<code>name</code>和<code>age</code>是参数名，跟变量名类似。这里面还用了一个<code>this</code>关键字，代表当前对象，可以看到参数名跟上面的成员变量名相同，为了将它们区分开来，就使用了<code>this.name</code>和<code>this.age</code>来表示成员变量。这个方法的作用就是接收传进来的两个参数，并将它们分别赋值给成员变量。关于构造函数的具体作用会在之后的篇章里做说明，这里就先不详细介绍了。</p>\n<h2 id=\"对象的创建和使用\"><a href=\"#对象的创建和使用\" class=\"headerlink\" title=\"对象的创建和使用\"></a>对象的创建和使用</h2><p>既然已经有了类，那么如何创建对象呢？这时候就需要使用新的招式——<code>new</code>关键字。下面我们在<em>Person</em>类中加入一个main方法（如果不记得<em>main</em>方法是干嘛的了，可以翻看一下上一篇的内容），并在其中创建一个<em>Person</em>对象并调用它的方法。</p>\n<pre><code class=\"java\">public class Person {\n    ...\n\n    public static void main(String[] args){\n        Person alice = new Person(&quot;Alice&quot;, 18);\n        alice.say();\n        alice.eat();\n    }\n}</code></pre>\n<p>输出如下：</p>\n<pre><code class=\"bash\">我叫Alice，我今年18岁\n开始吃饭...</code></pre>\n<p>老规矩，我们来逐行分析，首先我们使用了<code>new</code>关键字创建了一个对象：</p>\n<pre><code class=\"java\">Person alice = new Person(&quot;Alice&quot;, 18);</code></pre>\n<p>在前面我们已经介绍过变量的声明方式了，回顾一下：</p>\n<blockquote>\n<p>[类名] + [变量名]</p>\n</blockquote>\n<p><em>Person</em>是类名，<em>alice</em>是变量的名字，后面半段的作用是创建对象。往里面传了两个参数：<code>Alice</code>和<code>18</code>。创建好对象后，赋值给<em>alice</em>变量。</p>\n<p>然后我们分别调用了两个方法，<code>say</code>和<code>eat</code>。方法调用的格式为：</p>\n<blockquote>\n<p>[对象] + 点号 + [方法名] + [参数]</p>\n</blockquote>\n<pre><code class=\"java\">alice.say();\nalice.eat();</code></pre>\n<p>这两个方法都不需要传参数，可以直接调用。这样，我们就完成了创建对象并调用的全过程。</p>\n<h1 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h1><p>本篇文章到此就告一段落了，本篇内容相对较多一点，而且也是相当重要的一篇，希望能仔细阅读，能通过本篇的学习了解类和对象是什么，以及如何使用。</p>\n<p>也许到这里你还有很多疑惑，但没有关系，在之后的学习和练习的过程中，相信你会慢慢理解的。</p>\n"},{"title":"【Java基础篇】二、Java 程序基本结构","toc":true,"date":"2020-05-03T16:25:03.000Z","_content":"\n>“No matter how small and unimportant what we are doing may seem, if we do it well, it may soon become the step that will lead us to better things.”\t\t\t\t— Channing Pollock, Writer\n>\n>「不管我们现在所做的事看起来有么的微不足道或不重要，如果我们认真的做，它可能很快就会成为通往美好事物的踏石阶。」\t\t\t\t\t\t\t\t– 詹宁‧布鲁克 (作家)\n\n## 关卡说明\n\n关卡描述：`Java` 程序具有一些固定的形式，本篇将来对此进行简单的说明介绍。\n\n过关条件：理解 `Java` 程序的基本组成结构\n\n关卡难度：⭐️\n\n## 一个简单的程序\n\n为了简单起见，本篇以及之后的很多篇里，都会设计很多“玩具”代码，与实际中 `Java` 的设计可能相去甚远，本系列中的代示例都是为了说明一些相关概念，让你能够更好的理解 `Java` 的相关特性。\n\n下面再来看看上一篇中的栗子：\n\n```java\npackage hello;\n\nimport java.util.Scanner;\n\npublic class SimpleCalculator {\n    public static void main(String[] args){\n        System.out.print(\"请输入一个整数:\");\n        Scanner in = new Scanner(System.in);\n        int a = in.nextInt();\n        System.out.print(\"请再输入一个整数:\");\n        int b = in.nextInt();\n        int sum = a + b;\n        System.out.print(\"这两个数的和为:\" + sum);\n    }\n}\n```\n\n这是一个非常简单的能够运行的*Java*程序，它有一些基本的结构，下面将对其一一介绍。\n\n前面两句的作用已经在[上一篇](../introduction/java-package.md)中进行说明了，这里就不赘述了。接下来是类的定义：\n\n```java\npublic class SimpleCalculator {\n    ...\n}\n```\n\n这里是定义了一个叫做*SimpleCalculator*的类，`public` 称为*访问修饰符*，用于控制代码的访问级别，关于这部分的内容，会在之后的章节中进行详细的介绍。在这里，`public` 表示这个类的访问权限为任何外部类均可以访问。`class` 是定义一个类的关键字，它的后面是类。关于类的命名规范在之后也会有详细说明。不要忘了后面还有一对大括号，表示类的内部内容。\n\n需要注意的是，**Java是区分大小写的**，如果出现了大小写拼写错误，程序是无法正确运行的。\n\n```java\npublic static void main(String[] args){\n    ...\n}\n```\n\n在类的内部定义了一个*main*方法，为什么说它是一个方法而不是类呢？因为它位于一个类的内部，并且没有用*class*关键字修饰，而且符合方法的定义规范。`public`同样可以修饰方法，表示这个方法对于外部类是公开的，可以访问的，`static`表示这是一个静态方法（先不要纠结什么是静态方法），`void`表示这个方法的返回值类型，`main`为方法名，后面跟上一对小括号，里面是参数列表，这里为`String[] args`，表示它接受一个*String*数组作为参数，`args`为参数名。\n\n也许上面还有许多概念你还不清楚是什么意思，不要着急，先不要纠结于这些细节，先从整体上把握，继续看下去，后面的文章中会有说明。\n\n需要注意的是，`main`方法是*Java*程序中一个十分特殊的方法，它是整个程序的入口，也就是说，程序会从`main`方法开始执行，因此，如果想要代码能够执行，在类的源文件中必须包含一个`main`方法。\n\n方法中的方法体则是我们为了实现功能而设计的自定义代码，在*Java*中，每个句子必须用分号结束。\n\n```java\nSystem.out.print(\"请输入一个整数:\");\nScanner in = new Scanner(System.in);\nint a = in.nextInt();\nSystem.out.print(\"请再输入一个整数:\");\nint b = in.nextInt();\nint sum = a + b;\nSystem.out.print(\"这两个数的和为:\" + sum);\n```\n\n*Java*中，点号是用来调用方法或者使用对象的，如：`System.out.print(...)`表示使用`System.out`对象并调用它的`print`方法。\n\n# 小结\n\n至此，本篇的*Java*的基本结构就介绍完毕了，希望通过本篇，你能知道一个简单*Java*程序的结构是怎样的以及*main*方法有什么作用。","source":"_posts/java/basic/java-simple-structure.md","raw":"---\ntitle: 【Java基础篇】二、Java 程序基本结构\ntags:\n  - Java\n  - Java基础\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-04 00:25:03\n---\n\n>“No matter how small and unimportant what we are doing may seem, if we do it well, it may soon become the step that will lead us to better things.”\t\t\t\t— Channing Pollock, Writer\n>\n>「不管我们现在所做的事看起来有么的微不足道或不重要，如果我们认真的做，它可能很快就会成为通往美好事物的踏石阶。」\t\t\t\t\t\t\t\t– 詹宁‧布鲁克 (作家)\n\n## 关卡说明\n\n关卡描述：`Java` 程序具有一些固定的形式，本篇将来对此进行简单的说明介绍。\n\n过关条件：理解 `Java` 程序的基本组成结构\n\n关卡难度：⭐️\n\n## 一个简单的程序\n\n为了简单起见，本篇以及之后的很多篇里，都会设计很多“玩具”代码，与实际中 `Java` 的设计可能相去甚远，本系列中的代示例都是为了说明一些相关概念，让你能够更好的理解 `Java` 的相关特性。\n\n下面再来看看上一篇中的栗子：\n\n```java\npackage hello;\n\nimport java.util.Scanner;\n\npublic class SimpleCalculator {\n    public static void main(String[] args){\n        System.out.print(\"请输入一个整数:\");\n        Scanner in = new Scanner(System.in);\n        int a = in.nextInt();\n        System.out.print(\"请再输入一个整数:\");\n        int b = in.nextInt();\n        int sum = a + b;\n        System.out.print(\"这两个数的和为:\" + sum);\n    }\n}\n```\n\n这是一个非常简单的能够运行的*Java*程序，它有一些基本的结构，下面将对其一一介绍。\n\n前面两句的作用已经在[上一篇](../introduction/java-package.md)中进行说明了，这里就不赘述了。接下来是类的定义：\n\n```java\npublic class SimpleCalculator {\n    ...\n}\n```\n\n这里是定义了一个叫做*SimpleCalculator*的类，`public` 称为*访问修饰符*，用于控制代码的访问级别，关于这部分的内容，会在之后的章节中进行详细的介绍。在这里，`public` 表示这个类的访问权限为任何外部类均可以访问。`class` 是定义一个类的关键字，它的后面是类。关于类的命名规范在之后也会有详细说明。不要忘了后面还有一对大括号，表示类的内部内容。\n\n需要注意的是，**Java是区分大小写的**，如果出现了大小写拼写错误，程序是无法正确运行的。\n\n```java\npublic static void main(String[] args){\n    ...\n}\n```\n\n在类的内部定义了一个*main*方法，为什么说它是一个方法而不是类呢？因为它位于一个类的内部，并且没有用*class*关键字修饰，而且符合方法的定义规范。`public`同样可以修饰方法，表示这个方法对于外部类是公开的，可以访问的，`static`表示这是一个静态方法（先不要纠结什么是静态方法），`void`表示这个方法的返回值类型，`main`为方法名，后面跟上一对小括号，里面是参数列表，这里为`String[] args`，表示它接受一个*String*数组作为参数，`args`为参数名。\n\n也许上面还有许多概念你还不清楚是什么意思，不要着急，先不要纠结于这些细节，先从整体上把握，继续看下去，后面的文章中会有说明。\n\n需要注意的是，`main`方法是*Java*程序中一个十分特殊的方法，它是整个程序的入口，也就是说，程序会从`main`方法开始执行，因此，如果想要代码能够执行，在类的源文件中必须包含一个`main`方法。\n\n方法中的方法体则是我们为了实现功能而设计的自定义代码，在*Java*中，每个句子必须用分号结束。\n\n```java\nSystem.out.print(\"请输入一个整数:\");\nScanner in = new Scanner(System.in);\nint a = in.nextInt();\nSystem.out.print(\"请再输入一个整数:\");\nint b = in.nextInt();\nint sum = a + b;\nSystem.out.print(\"这两个数的和为:\" + sum);\n```\n\n*Java*中，点号是用来调用方法或者使用对象的，如：`System.out.print(...)`表示使用`System.out`对象并调用它的`print`方法。\n\n# 小结\n\n至此，本篇的*Java*的基本结构就介绍完毕了，希望通过本篇，你能知道一个简单*Java*程序的结构是怎样的以及*main*方法有什么作用。","slug":"java/basic/java-simple-structure","published":1,"updated":"2020-05-03T16:25:03.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfga00365ohu9ofp7rvh","content":"<blockquote>\n<p>“No matter how small and unimportant what we are doing may seem, if we do it well, it may soon become the step that will lead us to better things.”                — Channing Pollock, Writer</p>\n<p>「不管我们现在所做的事看起来有么的微不足道或不重要，如果我们认真的做，它可能很快就会成为通往美好事物的踏石阶。」                                – 詹宁‧布鲁克 (作家)</p>\n</blockquote>\n<h2 id=\"关卡说明\"><a href=\"#关卡说明\" class=\"headerlink\" title=\"关卡说明\"></a>关卡说明</h2><p>关卡描述：<code>Java</code> 程序具有一些固定的形式，本篇将来对此进行简单的说明介绍。</p>\n<p>过关条件：理解 <code>Java</code> 程序的基本组成结构</p>\n<p>关卡难度：⭐️</p>\n<h2 id=\"一个简单的程序\"><a href=\"#一个简单的程序\" class=\"headerlink\" title=\"一个简单的程序\"></a>一个简单的程序</h2><p>为了简单起见，本篇以及之后的很多篇里，都会设计很多“玩具”代码，与实际中 <code>Java</code> 的设计可能相去甚远，本系列中的代示例都是为了说明一些相关概念，让你能够更好的理解 <code>Java</code> 的相关特性。</p>\n<p>下面再来看看上一篇中的栗子：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> hello<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>Scanner<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SimpleCalculator</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入一个整数:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Scanner in <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请再输入一个整数:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> b <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> sum <span class=\"token operator\">=</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"这两个数的和为:\"</span> <span class=\"token operator\">+</span> sum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这是一个非常简单的能够运行的<em>Java</em>程序，它有一些基本的结构，下面将对其一一介绍。</p>\n<p>前面两句的作用已经在<a href=\"../introduction/java-package.md\">上一篇</a>中进行说明了，这里就不赘述了。接下来是类的定义：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SimpleCalculator</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>这里是定义了一个叫做<em>SimpleCalculator</em>的类，<code>public</code> 称为<em>访问修饰符</em>，用于控制代码的访问级别，关于这部分的内容，会在之后的章节中进行详细的介绍。在这里，<code>public</code> 表示这个类的访问权限为任何外部类均可以访问。<code>class</code> 是定义一个类的关键字，它的后面是类。关于类的命名规范在之后也会有详细说明。不要忘了后面还有一对大括号，表示类的内部内容。</p>\n<p>需要注意的是，<strong>Java是区分大小写的</strong>，如果出现了大小写拼写错误，程序是无法正确运行的。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>在类的内部定义了一个<em>main</em>方法，为什么说它是一个方法而不是类呢？因为它位于一个类的内部，并且没有用<em>class</em>关键字修饰，而且符合方法的定义规范。<code>public</code>同样可以修饰方法，表示这个方法对于外部类是公开的，可以访问的，<code>static</code>表示这是一个静态方法（先不要纠结什么是静态方法），<code>void</code>表示这个方法的返回值类型，<code>main</code>为方法名，后面跟上一对小括号，里面是参数列表，这里为<code>String[] args</code>，表示它接受一个<em>String</em>数组作为参数，<code>args</code>为参数名。</p>\n<p>也许上面还有许多概念你还不清楚是什么意思，不要着急，先不要纠结于这些细节，先从整体上把握，继续看下去，后面的文章中会有说明。</p>\n<p>需要注意的是，<code>main</code>方法是<em>Java</em>程序中一个十分特殊的方法，它是整个程序的入口，也就是说，程序会从<code>main</code>方法开始执行，因此，如果想要代码能够执行，在类的源文件中必须包含一个<code>main</code>方法。</p>\n<p>方法中的方法体则是我们为了实现功能而设计的自定义代码，在<em>Java</em>中，每个句子必须用分号结束。</p>\n<pre class=\" language-java\"><code class=\"language-java\">System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入一个整数:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nScanner in <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSystem<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请再输入一个整数:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> b <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> sum <span class=\"token operator\">=</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\nSystem<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"这两个数的和为:\"</span> <span class=\"token operator\">+</span> sum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><em>Java</em>中，点号是用来调用方法或者使用对象的，如：<code>System.out.print(...)</code>表示使用<code>System.out</code>对象并调用它的<code>print</code>方法。</p>\n<h1 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h1><p>至此，本篇的<em>Java</em>的基本结构就介绍完毕了，希望通过本篇，你能知道一个简单<em>Java</em>程序的结构是怎样的以及<em>main</em>方法有什么作用。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>“No matter how small and unimportant what we are doing may seem, if we do it well, it may soon become the step that will lead us to better things.”                — Channing Pollock, Writer</p>\n<p>「不管我们现在所做的事看起来有么的微不足道或不重要，如果我们认真的做，它可能很快就会成为通往美好事物的踏石阶。」                                – 詹宁‧布鲁克 (作家)</p>\n</blockquote>\n<h2 id=\"关卡说明\"><a href=\"#关卡说明\" class=\"headerlink\" title=\"关卡说明\"></a>关卡说明</h2><p>关卡描述：<code>Java</code> 程序具有一些固定的形式，本篇将来对此进行简单的说明介绍。</p>\n<p>过关条件：理解 <code>Java</code> 程序的基本组成结构</p>\n<p>关卡难度：⭐️</p>\n<h2 id=\"一个简单的程序\"><a href=\"#一个简单的程序\" class=\"headerlink\" title=\"一个简单的程序\"></a>一个简单的程序</h2><p>为了简单起见，本篇以及之后的很多篇里，都会设计很多“玩具”代码，与实际中 <code>Java</code> 的设计可能相去甚远，本系列中的代示例都是为了说明一些相关概念，让你能够更好的理解 <code>Java</code> 的相关特性。</p>\n<p>下面再来看看上一篇中的栗子：</p>\n<pre><code class=\"java\">package hello;\n\nimport java.util.Scanner;\n\npublic class SimpleCalculator {\n    public static void main(String[] args){\n        System.out.print(&quot;请输入一个整数:&quot;);\n        Scanner in = new Scanner(System.in);\n        int a = in.nextInt();\n        System.out.print(&quot;请再输入一个整数:&quot;);\n        int b = in.nextInt();\n        int sum = a + b;\n        System.out.print(&quot;这两个数的和为:&quot; + sum);\n    }\n}</code></pre>\n<p>这是一个非常简单的能够运行的<em>Java</em>程序，它有一些基本的结构，下面将对其一一介绍。</p>\n<p>前面两句的作用已经在<a href=\"../introduction/java-package.md\">上一篇</a>中进行说明了，这里就不赘述了。接下来是类的定义：</p>\n<pre><code class=\"java\">public class SimpleCalculator {\n    ...\n}</code></pre>\n<p>这里是定义了一个叫做<em>SimpleCalculator</em>的类，<code>public</code> 称为<em>访问修饰符</em>，用于控制代码的访问级别，关于这部分的内容，会在之后的章节中进行详细的介绍。在这里，<code>public</code> 表示这个类的访问权限为任何外部类均可以访问。<code>class</code> 是定义一个类的关键字，它的后面是类。关于类的命名规范在之后也会有详细说明。不要忘了后面还有一对大括号，表示类的内部内容。</p>\n<p>需要注意的是，<strong>Java是区分大小写的</strong>，如果出现了大小写拼写错误，程序是无法正确运行的。</p>\n<pre><code class=\"java\">public static void main(String[] args){\n    ...\n}</code></pre>\n<p>在类的内部定义了一个<em>main</em>方法，为什么说它是一个方法而不是类呢？因为它位于一个类的内部，并且没有用<em>class</em>关键字修饰，而且符合方法的定义规范。<code>public</code>同样可以修饰方法，表示这个方法对于外部类是公开的，可以访问的，<code>static</code>表示这是一个静态方法（先不要纠结什么是静态方法），<code>void</code>表示这个方法的返回值类型，<code>main</code>为方法名，后面跟上一对小括号，里面是参数列表，这里为<code>String[] args</code>，表示它接受一个<em>String</em>数组作为参数，<code>args</code>为参数名。</p>\n<p>也许上面还有许多概念你还不清楚是什么意思，不要着急，先不要纠结于这些细节，先从整体上把握，继续看下去，后面的文章中会有说明。</p>\n<p>需要注意的是，<code>main</code>方法是<em>Java</em>程序中一个十分特殊的方法，它是整个程序的入口，也就是说，程序会从<code>main</code>方法开始执行，因此，如果想要代码能够执行，在类的源文件中必须包含一个<code>main</code>方法。</p>\n<p>方法中的方法体则是我们为了实现功能而设计的自定义代码，在<em>Java</em>中，每个句子必须用分号结束。</p>\n<pre><code class=\"java\">System.out.print(&quot;请输入一个整数:&quot;);\nScanner in = new Scanner(System.in);\nint a = in.nextInt();\nSystem.out.print(&quot;请再输入一个整数:&quot;);\nint b = in.nextInt();\nint sum = a + b;\nSystem.out.print(&quot;这两个数的和为:&quot; + sum);</code></pre>\n<p><em>Java</em>中，点号是用来调用方法或者使用对象的，如：<code>System.out.print(...)</code>表示使用<code>System.out</code>对象并调用它的<code>print</code>方法。</p>\n<h1 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h1><p>至此，本篇的<em>Java</em>的基本结构就介绍完毕了，希望通过本篇，你能知道一个简单<em>Java</em>程序的结构是怎样的以及<em>main</em>方法有什么作用。</p>\n"},{"title":"【Java基础篇】三、Java 变量","toc":true,"date":"2020-05-03T16:25:04.000Z","_content":"\n>**“The superior man makes the difficulty to be overcome his first interest; success comes only later.”**\n>\n>— William Jennings Bryan\n>\n>**「优秀的人将克服困难当做第一优先，成功只是之后的附带品。」**    – 威廉‧詹宁斯‧布莱恩 (政客)\n\n## 关卡说明\n\n关卡描述：变量是*Java*程序中最常见的内容，是设计*Java*程序必不可少的部分。\n\n过关条件：理解什么是变量，为什么需要使用变量，以及如何使用它们\n\n关卡难度：⭐️\n\n## 变量\n\n什么是变量？为什么要有变量？怎么使用它？\n\n如果你不能很好的回答这三个问题，那么就带着这些疑问来完成本次挑战吧，相信你必能有所收获。\n\n### 什么是变量\n\n在一个*Java*程序中，通常需要很多个步骤才能实现我们想要的功能，比如之前设计的计算器，就需要先提示用户输入，读取输入的值，然后再将它们相加后输出。我们日常生活中的事情也是类似的，拿吃饭而言，我们需要先把饭盛到碗里，然后再加点菜，再往嘴里塞。\n\n这里的碗就相当于变量，我们用它来盛饭，也就是存放中间过程的一些处理结果，饭是我们从锅里盛出来的，是经过我们处理过的。\n\n也许这样说还是有些抽象，我们继续看之前的栗子：\n\n```java\npublic static void main(String[] args){\n    System.out.print(\"请输入一个整数:\");\n    Scanner in = new Scanner(System.in);\n    int a = in.nextInt();\n    System.out.print(\"请再输入一个整数:\");\n    int b = in.nextInt();\n    int sum = a + b;\n    System.out.print(\"这两个数的和为:\" + sum);\n}\n```\n\n在第三行，我们定义了一个变量*in*，用来存放*Scanner*实例引用，在第四行，我们定义了一个变量*a*，用来存放用户输入的第一个整数，第六行里我们又定义了一个变量*b*，用来接收用户输入的第二个整数，然后在第七行定义了一个变量*sum*，用来存放变量*a*和变量*b*的和。\n\n虽然是一个简单的程序，但是我们已经使用了四个变量，可见其应用的广泛性和重要性。变量就如同程序的血液，是一个程序能顺利运转的不可或缺的部分。\n\n### 为什么需要变量\n\n那么有没有可能不使用任何变量呢？其实也是可以的，比如这样：\n\n```java\npublic static void main(String[] args){\n    System.out.print(\"我是一个最简单的程序，我不使用变量\");\n}\n```\n\n但毕竟这样的需求只是极少的一部分，绝大部分的应用还是比较繁杂的，所以变量便不可避免的需要使用。\n\n另外，使用变量还可以使得程序逻辑变得更加清晰，通过使用变量，将整个流程的步骤变得更加清晰明确。就好比说吃饭，不再是模糊的一个概念，而是分为盛饭，夹菜，吃饭这几个具体的步骤了。\n\n### 如何使用变量\n\n要想使用变量，就必须先定义一个变量，或者说声明一个变量。声明变量的格式为：\n\n```java\n[类名] + [变量名]\n```\n\n例如：`int a` 中 `int` 是变量的类型，`a` 是变量的名字。\n\n可以在声明变量的同时给它赋一个初始值，也可以在之后改变变量的值。声明变量之后，必须使用赋值语句对变量显式初始化，千万不要使用未初始化的变量，否则会被编译器视为错误的代码。\n\n想要对一个变量进行赋值，就需要将变量放在`=` 左边，然后将*Java*表达式放在等号的右边。\n\n举个小栗子：\n\n```java\npublic static void main(String[] args){\n    int a = 1;\n    System.out.println(\"变量a的值为：\" + a);\n    a = 2;\n    System.out.println(\"变量a的值为：\" + a);\n    a = 3;\n    System.out.println(\"变量a的值为：\" + a);\n    int b;\n    System.out.println(\"变量b的值为：\" + b);\n    b = a;\n    System.out.println(\"变量b的值为：\" + b);\n}\n```\n\n那么程序将会输出：\n\n```java\n变量a的值为：1\n变量a的值为：2\n变量a的值为：3\n变量b的值为：0\n变量b的值为：3\n```\n\n补充说明一下，`System.out.println` 与 `System.out.print` 的区别是，前者会在内容输出完成之后添加一个换行。\n\n### 变量的命名规范\n\n变量名必须以字母开头，并且由字母、数字或者下划线和$构成，对于长度理论上来说是没有限制的，此外，*Java*中的保留字是不能用作变量名的，保留字也就是*Java*中的关键字，比如之前的 `public`、`static`、`int`、`void`等等，在后续的学习中，会不断接触到各种关键字。\n\n变量命名最好符合它使用的意义，能表现其作用，因为往往在一个程序中会出现非常多的变量，如果变量命名都像`a1`、`a2`、`a3`这样看了让人摸不着头脑的形式，那么将使得代码的阅读和维护变得十分困难。永远不要忘记，代码是用来阅读的。\n\n在*Java*中，变量的命名通常使用小驼峰命名法，也就是第一个单词的首字母小写，其余单词的首字母大写，比如：`totalDays`、`paperWidth`。\n\n## 小结\n\n至此，关于变量的介绍就结束了，变量是Java中最重要也是最基础的组成部分，希望你能很好的理解和掌握它。","source":"_posts/java/basic/java-variable.md","raw":"---\ntitle: 【Java基础篇】三、Java 变量\ntags:\n  - Java\n  - Java基础\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-04 00:25:04\n---\n\n>**“The superior man makes the difficulty to be overcome his first interest; success comes only later.”**\n>\n>— William Jennings Bryan\n>\n>**「优秀的人将克服困难当做第一优先，成功只是之后的附带品。」**    – 威廉‧詹宁斯‧布莱恩 (政客)\n\n## 关卡说明\n\n关卡描述：变量是*Java*程序中最常见的内容，是设计*Java*程序必不可少的部分。\n\n过关条件：理解什么是变量，为什么需要使用变量，以及如何使用它们\n\n关卡难度：⭐️\n\n## 变量\n\n什么是变量？为什么要有变量？怎么使用它？\n\n如果你不能很好的回答这三个问题，那么就带着这些疑问来完成本次挑战吧，相信你必能有所收获。\n\n### 什么是变量\n\n在一个*Java*程序中，通常需要很多个步骤才能实现我们想要的功能，比如之前设计的计算器，就需要先提示用户输入，读取输入的值，然后再将它们相加后输出。我们日常生活中的事情也是类似的，拿吃饭而言，我们需要先把饭盛到碗里，然后再加点菜，再往嘴里塞。\n\n这里的碗就相当于变量，我们用它来盛饭，也就是存放中间过程的一些处理结果，饭是我们从锅里盛出来的，是经过我们处理过的。\n\n也许这样说还是有些抽象，我们继续看之前的栗子：\n\n```java\npublic static void main(String[] args){\n    System.out.print(\"请输入一个整数:\");\n    Scanner in = new Scanner(System.in);\n    int a = in.nextInt();\n    System.out.print(\"请再输入一个整数:\");\n    int b = in.nextInt();\n    int sum = a + b;\n    System.out.print(\"这两个数的和为:\" + sum);\n}\n```\n\n在第三行，我们定义了一个变量*in*，用来存放*Scanner*实例引用，在第四行，我们定义了一个变量*a*，用来存放用户输入的第一个整数，第六行里我们又定义了一个变量*b*，用来接收用户输入的第二个整数，然后在第七行定义了一个变量*sum*，用来存放变量*a*和变量*b*的和。\n\n虽然是一个简单的程序，但是我们已经使用了四个变量，可见其应用的广泛性和重要性。变量就如同程序的血液，是一个程序能顺利运转的不可或缺的部分。\n\n### 为什么需要变量\n\n那么有没有可能不使用任何变量呢？其实也是可以的，比如这样：\n\n```java\npublic static void main(String[] args){\n    System.out.print(\"我是一个最简单的程序，我不使用变量\");\n}\n```\n\n但毕竟这样的需求只是极少的一部分，绝大部分的应用还是比较繁杂的，所以变量便不可避免的需要使用。\n\n另外，使用变量还可以使得程序逻辑变得更加清晰，通过使用变量，将整个流程的步骤变得更加清晰明确。就好比说吃饭，不再是模糊的一个概念，而是分为盛饭，夹菜，吃饭这几个具体的步骤了。\n\n### 如何使用变量\n\n要想使用变量，就必须先定义一个变量，或者说声明一个变量。声明变量的格式为：\n\n```java\n[类名] + [变量名]\n```\n\n例如：`int a` 中 `int` 是变量的类型，`a` 是变量的名字。\n\n可以在声明变量的同时给它赋一个初始值，也可以在之后改变变量的值。声明变量之后，必须使用赋值语句对变量显式初始化，千万不要使用未初始化的变量，否则会被编译器视为错误的代码。\n\n想要对一个变量进行赋值，就需要将变量放在`=` 左边，然后将*Java*表达式放在等号的右边。\n\n举个小栗子：\n\n```java\npublic static void main(String[] args){\n    int a = 1;\n    System.out.println(\"变量a的值为：\" + a);\n    a = 2;\n    System.out.println(\"变量a的值为：\" + a);\n    a = 3;\n    System.out.println(\"变量a的值为：\" + a);\n    int b;\n    System.out.println(\"变量b的值为：\" + b);\n    b = a;\n    System.out.println(\"变量b的值为：\" + b);\n}\n```\n\n那么程序将会输出：\n\n```java\n变量a的值为：1\n变量a的值为：2\n变量a的值为：3\n变量b的值为：0\n变量b的值为：3\n```\n\n补充说明一下，`System.out.println` 与 `System.out.print` 的区别是，前者会在内容输出完成之后添加一个换行。\n\n### 变量的命名规范\n\n变量名必须以字母开头，并且由字母、数字或者下划线和$构成，对于长度理论上来说是没有限制的，此外，*Java*中的保留字是不能用作变量名的，保留字也就是*Java*中的关键字，比如之前的 `public`、`static`、`int`、`void`等等，在后续的学习中，会不断接触到各种关键字。\n\n变量命名最好符合它使用的意义，能表现其作用，因为往往在一个程序中会出现非常多的变量，如果变量命名都像`a1`、`a2`、`a3`这样看了让人摸不着头脑的形式，那么将使得代码的阅读和维护变得十分困难。永远不要忘记，代码是用来阅读的。\n\n在*Java*中，变量的命名通常使用小驼峰命名法，也就是第一个单词的首字母小写，其余单词的首字母大写，比如：`totalDays`、`paperWidth`。\n\n## 小结\n\n至此，关于变量的介绍就结束了，变量是Java中最重要也是最基础的组成部分，希望你能很好的理解和掌握它。","slug":"java/basic/java-variable","published":1,"updated":"2020-05-03T16:25:04.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl70rsfgb00385ohu00jv4gds","content":"<blockquote>\n<p><strong>“The superior man makes the difficulty to be overcome his first interest; success comes only later.”</strong></p>\n<p>— William Jennings Bryan</p>\n<p><strong>「优秀的人将克服困难当做第一优先，成功只是之后的附带品。」</strong>    – 威廉‧詹宁斯‧布莱恩 (政客)</p>\n</blockquote>\n<h2 id=\"关卡说明\"><a href=\"#关卡说明\" class=\"headerlink\" title=\"关卡说明\"></a>关卡说明</h2><p>关卡描述：变量是<em>Java</em>程序中最常见的内容，是设计<em>Java</em>程序必不可少的部分。</p>\n<p>过关条件：理解什么是变量，为什么需要使用变量，以及如何使用它们</p>\n<p>关卡难度：⭐️</p>\n<h2 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h2><p>什么是变量？为什么要有变量？怎么使用它？</p>\n<p>如果你不能很好的回答这三个问题，那么就带着这些疑问来完成本次挑战吧，相信你必能有所收获。</p>\n<h3 id=\"什么是变量\"><a href=\"#什么是变量\" class=\"headerlink\" title=\"什么是变量\"></a>什么是变量</h3><p>在一个<em>Java</em>程序中，通常需要很多个步骤才能实现我们想要的功能，比如之前设计的计算器，就需要先提示用户输入，读取输入的值，然后再将它们相加后输出。我们日常生活中的事情也是类似的，拿吃饭而言，我们需要先把饭盛到碗里，然后再加点菜，再往嘴里塞。</p>\n<p>这里的碗就相当于变量，我们用它来盛饭，也就是存放中间过程的一些处理结果，饭是我们从锅里盛出来的，是经过我们处理过的。</p>\n<p>也许这样说还是有些抽象，我们继续看之前的栗子：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入一个整数:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    Scanner in <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请再输入一个整数:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> b <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> sum <span class=\"token operator\">=</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n    System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"这两个数的和为:\"</span> <span class=\"token operator\">+</span> sum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>在第三行，我们定义了一个变量<em>in</em>，用来存放<em>Scanner</em>实例引用，在第四行，我们定义了一个变量<em>a</em>，用来存放用户输入的第一个整数，第六行里我们又定义了一个变量<em>b</em>，用来接收用户输入的第二个整数，然后在第七行定义了一个变量<em>sum</em>，用来存放变量<em>a</em>和变量<em>b</em>的和。</p>\n<p>虽然是一个简单的程序，但是我们已经使用了四个变量，可见其应用的广泛性和重要性。变量就如同程序的血液，是一个程序能顺利运转的不可或缺的部分。</p>\n<h3 id=\"为什么需要变量\"><a href=\"#为什么需要变量\" class=\"headerlink\" title=\"为什么需要变量\"></a>为什么需要变量</h3><p>那么有没有可能不使用任何变量呢？其实也是可以的，比如这样：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"我是一个最简单的程序，我不使用变量\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>但毕竟这样的需求只是极少的一部分，绝大部分的应用还是比较繁杂的，所以变量便不可避免的需要使用。</p>\n<p>另外，使用变量还可以使得程序逻辑变得更加清晰，通过使用变量，将整个流程的步骤变得更加清晰明确。就好比说吃饭，不再是模糊的一个概念，而是分为盛饭，夹菜，吃饭这几个具体的步骤了。</p>\n<h3 id=\"如何使用变量\"><a href=\"#如何使用变量\" class=\"headerlink\" title=\"如何使用变量\"></a>如何使用变量</h3><p>要想使用变量，就必须先定义一个变量，或者说声明一个变量。声明变量的格式为：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token punctuation\">[</span>类名<span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">[</span>变量名<span class=\"token punctuation\">]</span></code></pre>\n<p>例如：<code>int a</code> 中 <code>int</code> 是变量的类型，<code>a</code> 是变量的名字。</p>\n<p>可以在声明变量的同时给它赋一个初始值，也可以在之后改变变量的值。声明变量之后，必须使用赋值语句对变量显式初始化，千万不要使用未初始化的变量，否则会被编译器视为错误的代码。</p>\n<p>想要对一个变量进行赋值，就需要将变量放在<code>=</code> 左边，然后将<em>Java</em>表达式放在等号的右边。</p>\n<p>举个小栗子：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"变量a的值为：\"</span> <span class=\"token operator\">+</span> a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    a <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"变量a的值为：\"</span> <span class=\"token operator\">+</span> a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    a <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n    System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"变量a的值为：\"</span> <span class=\"token operator\">+</span> a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> b<span class=\"token punctuation\">;</span>\n    System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"变量b的值为：\"</span> <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    b <span class=\"token operator\">=</span> a<span class=\"token punctuation\">;</span>\n    System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"变量b的值为：\"</span> <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>那么程序将会输出：</p>\n<pre class=\" language-java\"><code class=\"language-java\">变量a的值为：<span class=\"token number\">1</span>\n变量a的值为：<span class=\"token number\">2</span>\n变量a的值为：<span class=\"token number\">3</span>\n变量b的值为：<span class=\"token number\">0</span>\n变量b的值为：<span class=\"token number\">3</span></code></pre>\n<p>补充说明一下，<code>System.out.println</code> 与 <code>System.out.print</code> 的区别是，前者会在内容输出完成之后添加一个换行。</p>\n<h3 id=\"变量的命名规范\"><a href=\"#变量的命名规范\" class=\"headerlink\" title=\"变量的命名规范\"></a>变量的命名规范</h3><p>变量名必须以字母开头，并且由字母、数字或者下划线和$构成，对于长度理论上来说是没有限制的，此外，<em>Java</em>中的保留字是不能用作变量名的，保留字也就是<em>Java</em>中的关键字，比如之前的 <code>public</code>、<code>static</code>、<code>int</code>、<code>void</code>等等，在后续的学习中，会不断接触到各种关键字。</p>\n<p>变量命名最好符合它使用的意义，能表现其作用，因为往往在一个程序中会出现非常多的变量，如果变量命名都像<code>a1</code>、<code>a2</code>、<code>a3</code>这样看了让人摸不着头脑的形式，那么将使得代码的阅读和维护变得十分困难。永远不要忘记，代码是用来阅读的。</p>\n<p>在<em>Java</em>中，变量的命名通常使用小驼峰命名法，也就是第一个单词的首字母小写，其余单词的首字母大写，比如：<code>totalDays</code>、<code>paperWidth</code>。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>至此，关于变量的介绍就结束了，变量是Java中最重要也是最基础的组成部分，希望你能很好的理解和掌握它。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"https://draveness.me/images/draven-logo.png","name":"真没什么逻辑","introduction":"面向信仰编程","url":"https://draveness.me/","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p><strong>“The superior man makes the difficulty to be overcome his first interest; success comes only later.”</strong></p>\n<p>— William Jennings Bryan</p>\n<p><strong>「优秀的人将克服困难当做第一优先，成功只是之后的附带品。」</strong>    – 威廉‧詹宁斯‧布莱恩 (政客)</p>\n</blockquote>\n<h2 id=\"关卡说明\"><a href=\"#关卡说明\" class=\"headerlink\" title=\"关卡说明\"></a>关卡说明</h2><p>关卡描述：变量是<em>Java</em>程序中最常见的内容，是设计<em>Java</em>程序必不可少的部分。</p>\n<p>过关条件：理解什么是变量，为什么需要使用变量，以及如何使用它们</p>\n<p>关卡难度：⭐️</p>\n<h2 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h2><p>什么是变量？为什么要有变量？怎么使用它？</p>\n<p>如果你不能很好的回答这三个问题，那么就带着这些疑问来完成本次挑战吧，相信你必能有所收获。</p>\n<h3 id=\"什么是变量\"><a href=\"#什么是变量\" class=\"headerlink\" title=\"什么是变量\"></a>什么是变量</h3><p>在一个<em>Java</em>程序中，通常需要很多个步骤才能实现我们想要的功能，比如之前设计的计算器，就需要先提示用户输入，读取输入的值，然后再将它们相加后输出。我们日常生活中的事情也是类似的，拿吃饭而言，我们需要先把饭盛到碗里，然后再加点菜，再往嘴里塞。</p>\n<p>这里的碗就相当于变量，我们用它来盛饭，也就是存放中间过程的一些处理结果，饭是我们从锅里盛出来的，是经过我们处理过的。</p>\n<p>也许这样说还是有些抽象，我们继续看之前的栗子：</p>\n<pre><code class=\"java\">public static void main(String[] args){\n    System.out.print(&quot;请输入一个整数:&quot;);\n    Scanner in = new Scanner(System.in);\n    int a = in.nextInt();\n    System.out.print(&quot;请再输入一个整数:&quot;);\n    int b = in.nextInt();\n    int sum = a + b;\n    System.out.print(&quot;这两个数的和为:&quot; + sum);\n}</code></pre>\n<p>在第三行，我们定义了一个变量<em>in</em>，用来存放<em>Scanner</em>实例引用，在第四行，我们定义了一个变量<em>a</em>，用来存放用户输入的第一个整数，第六行里我们又定义了一个变量<em>b</em>，用来接收用户输入的第二个整数，然后在第七行定义了一个变量<em>sum</em>，用来存放变量<em>a</em>和变量<em>b</em>的和。</p>\n<p>虽然是一个简单的程序，但是我们已经使用了四个变量，可见其应用的广泛性和重要性。变量就如同程序的血液，是一个程序能顺利运转的不可或缺的部分。</p>\n<h3 id=\"为什么需要变量\"><a href=\"#为什么需要变量\" class=\"headerlink\" title=\"为什么需要变量\"></a>为什么需要变量</h3><p>那么有没有可能不使用任何变量呢？其实也是可以的，比如这样：</p>\n<pre><code class=\"java\">public static void main(String[] args){\n    System.out.print(&quot;我是一个最简单的程序，我不使用变量&quot;);\n}</code></pre>\n<p>但毕竟这样的需求只是极少的一部分，绝大部分的应用还是比较繁杂的，所以变量便不可避免的需要使用。</p>\n<p>另外，使用变量还可以使得程序逻辑变得更加清晰，通过使用变量，将整个流程的步骤变得更加清晰明确。就好比说吃饭，不再是模糊的一个概念，而是分为盛饭，夹菜，吃饭这几个具体的步骤了。</p>\n<h3 id=\"如何使用变量\"><a href=\"#如何使用变量\" class=\"headerlink\" title=\"如何使用变量\"></a>如何使用变量</h3><p>要想使用变量，就必须先定义一个变量，或者说声明一个变量。声明变量的格式为：</p>\n<pre><code class=\"java\">[类名] + [变量名]</code></pre>\n<p>例如：<code>int a</code> 中 <code>int</code> 是变量的类型，<code>a</code> 是变量的名字。</p>\n<p>可以在声明变量的同时给它赋一个初始值，也可以在之后改变变量的值。声明变量之后，必须使用赋值语句对变量显式初始化，千万不要使用未初始化的变量，否则会被编译器视为错误的代码。</p>\n<p>想要对一个变量进行赋值，就需要将变量放在<code>=</code> 左边，然后将<em>Java</em>表达式放在等号的右边。</p>\n<p>举个小栗子：</p>\n<pre><code class=\"java\">public static void main(String[] args){\n    int a = 1;\n    System.out.println(&quot;变量a的值为：&quot; + a);\n    a = 2;\n    System.out.println(&quot;变量a的值为：&quot; + a);\n    a = 3;\n    System.out.println(&quot;变量a的值为：&quot; + a);\n    int b;\n    System.out.println(&quot;变量b的值为：&quot; + b);\n    b = a;\n    System.out.println(&quot;变量b的值为：&quot; + b);\n}</code></pre>\n<p>那么程序将会输出：</p>\n<pre><code class=\"java\">变量a的值为：1\n变量a的值为：2\n变量a的值为：3\n变量b的值为：0\n变量b的值为：3</code></pre>\n<p>补充说明一下，<code>System.out.println</code> 与 <code>System.out.print</code> 的区别是，前者会在内容输出完成之后添加一个换行。</p>\n<h3 id=\"变量的命名规范\"><a href=\"#变量的命名规范\" class=\"headerlink\" title=\"变量的命名规范\"></a>变量的命名规范</h3><p>变量名必须以字母开头，并且由字母、数字或者下划线和$构成，对于长度理论上来说是没有限制的，此外，<em>Java</em>中的保留字是不能用作变量名的，保留字也就是<em>Java</em>中的关键字，比如之前的 <code>public</code>、<code>static</code>、<code>int</code>、<code>void</code>等等，在后续的学习中，会不断接触到各种关键字。</p>\n<p>变量命名最好符合它使用的意义，能表现其作用，因为往往在一个程序中会出现非常多的变量，如果变量命名都像<code>a1</code>、<code>a2</code>、<code>a3</code>这样看了让人摸不着头脑的形式，那么将使得代码的阅读和维护变得十分困难。永远不要忘记，代码是用来阅读的。</p>\n<p>在<em>Java</em>中，变量的命名通常使用小驼峰命名法，也就是第一个单词的首字母小写，其余单词的首字母大写，比如：<code>totalDays</code>、<code>paperWidth</code>。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>至此，关于变量的介绍就结束了，变量是Java中最重要也是最基础的组成部分，希望你能很好的理解和掌握它。</p>\n"},{"title":"【Java入门篇】三、Java开发环境搭建——Mac篇","toc":true,"date":"2020-05-01T14:33:04.000Z","_content":"\n> 人非圣贤，孰能无过？过而能改，善莫大焉。 --《左传》\n\n## 步骤说明\n\n主要分为以下几个步骤：\n\n1.到 `Oracle` 官网下载 `JDK` 安装包。(我在这里选择的是 `JDK1.8`，也可以选择其它版本)\n\n2.打开获取到的安装包按步骤安装到系统上。\n\n3.配置系统的环境变量。\n\n4.验证 `JDK` 是否安装成功。\n\n【由于电脑上已经安装过了 `JDK1.8`，所以偷懒把别人的文章搬过来了，[原文链接](https://blog.csdn.net/deliciousion/article/details/78046007)】\n\n## 一、下载JDK8\n\n通过下面 `Oracle` 官网找到对应的 `JDK1.8` 安装包\n\nhttps://www.oracle.com/index.html\n\n打开后如下所示，`Oracle` 主页内容经常变动，读者打开后很有可能不一样。\n\n![1-jdk-mac.png](https://i.loli.net/2020/05/02/munYUqTkJg5IxDR.png)\n\n拉到页面底部，找到“Download Java for Developers”，如下红框所示。\n\n![2-jdk-mac.png](https://i.loli.net/2020/05/02/GOvJdf7zLWrTCEb.png)\n\n点开链接后，如下图所示，再点击红框位置，只下载 `JDK1.8` ，红框右边的链接是 `JDK1.8` 加上 `NetBeans` ，一个挺好用的 `JAVA IDE`（集成化开发环境），有需要的可以下载。\n\n![3-jdk-mac.png](https://i.loli.net/2020/05/02/FakO2WjeMR1hi79.png)\n\n进入页面后第一步，点击“Accept License Agreement”同意许可证协议。第二步选择 `JDK` 对应的操作系统。本次选择“MAC OS X”，最后把相应的安装包下载到本地。\n\n![4-jdk-mac.png](https://i.loli.net/2020/05/02/I3XBT1vUJQGHDcK.png)\n\n## 二、安装JDK\n\n下载完成后，我们得到一个dmg的安装包，如下图所示，名称为 `jdk-8u144-macosx-x64.dmg` ，表示这是 `Java 8` 版本号为 `144` 的 `JDK`安装包，如果选择的是其它版本，名称也会有所不同。\n\n![5-jdk-mac.png](https://i.loli.net/2020/05/02/PSbdcZGVfY1n4Oz.png)\n\n双击 `dmg` 安装包，打开如下图所示窗口。按照红框的提示，便可轻松完成安装。\n\n![6-jdk-mac.png](https://i.loli.net/2020/05/02/bDiVGkgKOrQJS5w.png)\n\n再双击中间的 `pkg` 文件，开始安装，如下图所示。\n\n![7-jdk-mac.png](https://i.loli.net/2020/05/02/kMa9bSmKOY2seFD.png)\n\n![9-jdk-mac.png](https://i.loli.net/2020/05/02/ICbJmudG73f52lx.png)\n\n![10-jdk-mac.png](https://i.loli.net/2020/05/02/e92Dx1XPzBI5WVO.png)\n\n## 三、配置系统的环境变量\n\n上一步骤，实标上，我们只是把 `JDK1.8` 的文件复制到操作系统上。但是我们如果要在 `terminal` 终端上使用 `JAVA` 命令，还需要让其它应用知道 `JDK1.8` 环境的存在，那我们还需要配置系统的环境变量。\n\n首先我们得知道 `JDK` 目录安装在哪里，按照下面的路径我们可以找到 `JDK` 的主目录，如下图所示。这里有两个目录是因为本机较早前安装过早期版本的 `JDK1.8`。\n\n```bash\n/Library/Java/JavaVirtualMachines\n```\n\n![11-jdk-mac.png](https://i.loli.net/2020/05/02/ewjVCx6Wdiz7hE5.png)\n\n由于 `MAC` 文件系统结构，与 `WINDOWS` 有所不一样，所以 `JDK`的真实主目录如下\n\n```bash\n/Library/Java/JavaVirtualMachines/jdk1.8.0_144.jdk/Contents/Home\n```\n\n打开 `terminal` 终端，默认打开在自身 `home` 目录下，也可通过 `cd` 命令直接跳到主目录。\n\n![12-jdk-mac.png](https://i.loli.net/2020/05/02/bFOD8ViUStJYdBW.png)\n\n通过 `vim .bash_profile` 命令打开启动文件，修改内容\n\n![13-jdk-mac.png](https://i.loli.net/2020/05/02/u51VTvULm6HtJcn.png)\n\n进入 `vim`，按 `i` 键进入编辑状态。添加如下内容，如下图所示。再按 `ESC` 键，输入“:wq”保存退出。配置系统环境变量结束。\n\n![14-jdk-mac.png](https://i.loli.net/2020/05/02/93vEFplMf4Vjg8O.png)\n\n添加如下内容：\n\n```bash\nexport JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_45.jdk/Contents/Home\n```\n\n注意将 `jdk1.8.0_45` 这里改为你下载的 `JDK` 版本，不清楚的话，到 `/Library/Java/JavaVirtualMachines/` 这个目录下找找。\n\n## 四、验证JDK1.8是否安装成功。\n\n在终端输入 `java`,有如下画面，证明配置成功\n\n![15-jdk-mac.png](https://i.loli.net/2020/05/02/S3X7JwZfONlvqsM.png)\n\n或输入 `java -version`，会出现版本信息\n\n![16-jdk-mac.png](https://i.loli.net/2020/05/02/zlKysIfgXDL1E4C.png)\n\n至此，整个安装 `JDK` 过程结束。\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","source":"_posts/java/introduction/java-environment-mac.md","raw":"---\ntitle: 【Java入门篇】三、Java开发环境搭建——Mac篇\ntags:\n  - Java入门\n  - Java\n  - 环境搭建\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-01 22:33:04\n---\n\n> 人非圣贤，孰能无过？过而能改，善莫大焉。 --《左传》\n\n## 步骤说明\n\n主要分为以下几个步骤：\n\n1.到 `Oracle` 官网下载 `JDK` 安装包。(我在这里选择的是 `JDK1.8`，也可以选择其它版本)\n\n2.打开获取到的安装包按步骤安装到系统上。\n\n3.配置系统的环境变量。\n\n4.验证 `JDK` 是否安装成功。\n\n【由于电脑上已经安装过了 `JDK1.8`，所以偷懒把别人的文章搬过来了，[原文链接](https://blog.csdn.net/deliciousion/article/details/78046007)】\n\n## 一、下载JDK8\n\n通过下面 `Oracle` 官网找到对应的 `JDK1.8` 安装包\n\nhttps://www.oracle.com/index.html\n\n打开后如下所示，`Oracle` 主页内容经常变动，读者打开后很有可能不一样。\n\n![1-jdk-mac.png](https://i.loli.net/2020/05/02/munYUqTkJg5IxDR.png)\n\n拉到页面底部，找到“Download Java for Developers”，如下红框所示。\n\n![2-jdk-mac.png](https://i.loli.net/2020/05/02/GOvJdf7zLWrTCEb.png)\n\n点开链接后，如下图所示，再点击红框位置，只下载 `JDK1.8` ，红框右边的链接是 `JDK1.8` 加上 `NetBeans` ，一个挺好用的 `JAVA IDE`（集成化开发环境），有需要的可以下载。\n\n![3-jdk-mac.png](https://i.loli.net/2020/05/02/FakO2WjeMR1hi79.png)\n\n进入页面后第一步，点击“Accept License Agreement”同意许可证协议。第二步选择 `JDK` 对应的操作系统。本次选择“MAC OS X”，最后把相应的安装包下载到本地。\n\n![4-jdk-mac.png](https://i.loli.net/2020/05/02/I3XBT1vUJQGHDcK.png)\n\n## 二、安装JDK\n\n下载完成后，我们得到一个dmg的安装包，如下图所示，名称为 `jdk-8u144-macosx-x64.dmg` ，表示这是 `Java 8` 版本号为 `144` 的 `JDK`安装包，如果选择的是其它版本，名称也会有所不同。\n\n![5-jdk-mac.png](https://i.loli.net/2020/05/02/PSbdcZGVfY1n4Oz.png)\n\n双击 `dmg` 安装包，打开如下图所示窗口。按照红框的提示，便可轻松完成安装。\n\n![6-jdk-mac.png](https://i.loli.net/2020/05/02/bDiVGkgKOrQJS5w.png)\n\n再双击中间的 `pkg` 文件，开始安装，如下图所示。\n\n![7-jdk-mac.png](https://i.loli.net/2020/05/02/kMa9bSmKOY2seFD.png)\n\n![9-jdk-mac.png](https://i.loli.net/2020/05/02/ICbJmudG73f52lx.png)\n\n![10-jdk-mac.png](https://i.loli.net/2020/05/02/e92Dx1XPzBI5WVO.png)\n\n## 三、配置系统的环境变量\n\n上一步骤，实标上，我们只是把 `JDK1.8` 的文件复制到操作系统上。但是我们如果要在 `terminal` 终端上使用 `JAVA` 命令，还需要让其它应用知道 `JDK1.8` 环境的存在，那我们还需要配置系统的环境变量。\n\n首先我们得知道 `JDK` 目录安装在哪里，按照下面的路径我们可以找到 `JDK` 的主目录，如下图所示。这里有两个目录是因为本机较早前安装过早期版本的 `JDK1.8`。\n\n```bash\n/Library/Java/JavaVirtualMachines\n```\n\n![11-jdk-mac.png](https://i.loli.net/2020/05/02/ewjVCx6Wdiz7hE5.png)\n\n由于 `MAC` 文件系统结构，与 `WINDOWS` 有所不一样，所以 `JDK`的真实主目录如下\n\n```bash\n/Library/Java/JavaVirtualMachines/jdk1.8.0_144.jdk/Contents/Home\n```\n\n打开 `terminal` 终端，默认打开在自身 `home` 目录下，也可通过 `cd` 命令直接跳到主目录。\n\n![12-jdk-mac.png](https://i.loli.net/2020/05/02/bFOD8ViUStJYdBW.png)\n\n通过 `vim .bash_profile` 命令打开启动文件，修改内容\n\n![13-jdk-mac.png](https://i.loli.net/2020/05/02/u51VTvULm6HtJcn.png)\n\n进入 `vim`，按 `i` 键进入编辑状态。添加如下内容，如下图所示。再按 `ESC` 键，输入“:wq”保存退出。配置系统环境变量结束。\n\n![14-jdk-mac.png](https://i.loli.net/2020/05/02/93vEFplMf4Vjg8O.png)\n\n添加如下内容：\n\n```bash\nexport JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_45.jdk/Contents/Home\n```\n\n注意将 `jdk1.8.0_45` 这里改为你下载的 `JDK` 版本，不清楚的话，到 `/Library/Java/JavaVirtualMachines/` 这个目录下找找。\n\n## 四、验证JDK1.8是否安装成功。\n\n在终端输入 `java`,有如下画面，证明配置成功\n\n![15-jdk-mac.png](https://i.loli.net/2020/05/02/S3X7JwZfONlvqsM.png)\n\n或输入 `java -version`，会出现版本信息\n\n![16-jdk-mac.png](https://i.loli.net/2020/05/02/zlKysIfgXDL1E4C.png)\n\n至此，整个安装 `JDK` 过程结束。\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","slug":"java/introduction/java-environment-mac","published":1,"updated":"2020-05-01T14:33:04.000Z","_id":"cl70rsfgc003b5ohug4bv93mx","comments":1,"layout":"post","photos":[],"link":"","content":"<blockquote>\n<p>人非圣贤，孰能无过？过而能改，善莫大焉。 –《左传》</p>\n</blockquote>\n<h2 id=\"步骤说明\"><a href=\"#步骤说明\" class=\"headerlink\" title=\"步骤说明\"></a>步骤说明</h2><p>主要分为以下几个步骤：</p>\n<p>1.到 <code>Oracle</code> 官网下载 <code>JDK</code> 安装包。(我在这里选择的是 <code>JDK1.8</code>，也可以选择其它版本)</p>\n<p>2.打开获取到的安装包按步骤安装到系统上。</p>\n<p>3.配置系统的环境变量。</p>\n<p>4.验证 <code>JDK</code> 是否安装成功。</p>\n<p>【由于电脑上已经安装过了 <code>JDK1.8</code>，所以偷懒把别人的文章搬过来了，<a href=\"https://blog.csdn.net/deliciousion/article/details/78046007\" target=\"_blank\" rel=\"noopener\">原文链接</a>】</p>\n<h2 id=\"一、下载JDK8\"><a href=\"#一、下载JDK8\" class=\"headerlink\" title=\"一、下载JDK8\"></a>一、下载JDK8</h2><p>通过下面 <code>Oracle</code> 官网找到对应的 <code>JDK1.8</code> 安装包</p>\n<p><a href=\"https://www.oracle.com/index.html\" target=\"_blank\" rel=\"noopener\">https://www.oracle.com/index.html</a></p>\n<p>打开后如下所示，<code>Oracle</code> 主页内容经常变动，读者打开后很有可能不一样。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/munYUqTkJg5IxDR.png\" alt=\"1-jdk-mac.png\"></p>\n<p>拉到页面底部，找到“Download Java for Developers”，如下红框所示。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/GOvJdf7zLWrTCEb.png\" alt=\"2-jdk-mac.png\"></p>\n<p>点开链接后，如下图所示，再点击红框位置，只下载 <code>JDK1.8</code> ，红框右边的链接是 <code>JDK1.8</code> 加上 <code>NetBeans</code> ，一个挺好用的 <code>JAVA IDE</code>（集成化开发环境），有需要的可以下载。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/FakO2WjeMR1hi79.png\" alt=\"3-jdk-mac.png\"></p>\n<p>进入页面后第一步，点击“Accept License Agreement”同意许可证协议。第二步选择 <code>JDK</code> 对应的操作系统。本次选择“MAC OS X”，最后把相应的安装包下载到本地。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/I3XBT1vUJQGHDcK.png\" alt=\"4-jdk-mac.png\"></p>\n<h2 id=\"二、安装JDK\"><a href=\"#二、安装JDK\" class=\"headerlink\" title=\"二、安装JDK\"></a>二、安装JDK</h2><p>下载完成后，我们得到一个dmg的安装包，如下图所示，名称为 <code>jdk-8u144-macosx-x64.dmg</code> ，表示这是 <code>Java 8</code> 版本号为 <code>144</code> 的 <code>JDK</code>安装包，如果选择的是其它版本，名称也会有所不同。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/PSbdcZGVfY1n4Oz.png\" alt=\"5-jdk-mac.png\"></p>\n<p>双击 <code>dmg</code> 安装包，打开如下图所示窗口。按照红框的提示，便可轻松完成安装。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/bDiVGkgKOrQJS5w.png\" alt=\"6-jdk-mac.png\"></p>\n<p>再双击中间的 <code>pkg</code> 文件，开始安装，如下图所示。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/kMa9bSmKOY2seFD.png\" alt=\"7-jdk-mac.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/ICbJmudG73f52lx.png\" alt=\"9-jdk-mac.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/e92Dx1XPzBI5WVO.png\" alt=\"10-jdk-mac.png\"></p>\n<h2 id=\"三、配置系统的环境变量\"><a href=\"#三、配置系统的环境变量\" class=\"headerlink\" title=\"三、配置系统的环境变量\"></a>三、配置系统的环境变量</h2><p>上一步骤，实标上，我们只是把 <code>JDK1.8</code> 的文件复制到操作系统上。但是我们如果要在 <code>terminal</code> 终端上使用 <code>JAVA</code> 命令，还需要让其它应用知道 <code>JDK1.8</code> 环境的存在，那我们还需要配置系统的环境变量。</p>\n<p>首先我们得知道 <code>JDK</code> 目录安装在哪里，按照下面的路径我们可以找到 <code>JDK</code> 的主目录，如下图所示。这里有两个目录是因为本机较早前安装过早期版本的 <code>JDK1.8</code>。</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">/Library/Java/JavaVirtualMachines</code></pre>\n<p><img src=\"https://i.loli.net/2020/05/02/ewjVCx6Wdiz7hE5.png\" alt=\"11-jdk-mac.png\"></p>\n<p>由于 <code>MAC</code> 文件系统结构，与 <code>WINDOWS</code> 有所不一样，所以 <code>JDK</code>的真实主目录如下</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">/Library/Java/JavaVirtualMachines/jdk1.8.0_144.jdk/Contents/Home</code></pre>\n<p>打开 <code>terminal</code> 终端，默认打开在自身 <code>home</code> 目录下，也可通过 <code>cd</code> 命令直接跳到主目录。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/bFOD8ViUStJYdBW.png\" alt=\"12-jdk-mac.png\"></p>\n<p>通过 <code>vim .bash_profile</code> 命令打开启动文件，修改内容</p>\n<p><img src=\"https://i.loli.net/2020/05/02/u51VTvULm6HtJcn.png\" alt=\"13-jdk-mac.png\"></p>\n<p>进入 <code>vim</code>，按 <code>i</code> 键进入编辑状态。添加如下内容，如下图所示。再按 <code>ESC</code> 键，输入“:wq”保存退出。配置系统环境变量结束。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/93vEFplMf4Vjg8O.png\" alt=\"14-jdk-mac.png\"></p>\n<p>添加如下内容：</p>\n<pre class=\" language-bash\"><code class=\"language-bash\"><span class=\"token function\">export</span> JAVA_HOME<span class=\"token operator\">=</span>/Library/Java/JavaVirtualMachines/jdk1.8.0_45.jdk/Contents/Home</code></pre>\n<p>注意将 <code>jdk1.8.0_45</code> 这里改为你下载的 <code>JDK</code> 版本，不清楚的话，到 <code>/Library/Java/JavaVirtualMachines/</code> 这个目录下找找。</p>\n<h2 id=\"四、验证JDK1-8是否安装成功。\"><a href=\"#四、验证JDK1-8是否安装成功。\" class=\"headerlink\" title=\"四、验证JDK1.8是否安装成功。\"></a>四、验证JDK1.8是否安装成功。</h2><p>在终端输入 <code>java</code>,有如下画面，证明配置成功</p>\n<p><img src=\"https://i.loli.net/2020/05/02/S3X7JwZfONlvqsM.png\" alt=\"15-jdk-mac.png\"></p>\n<p>或输入 <code>java -version</code>，会出现版本信息</p>\n<p><img src=\"https://i.loli.net/2020/05/02/zlKysIfgXDL1E4C.png\" alt=\"16-jdk-mac.png\"></p>\n<p>至此，整个安装 <code>JDK</code> 过程结束。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>人非圣贤，孰能无过？过而能改，善莫大焉。 –《左传》</p>\n</blockquote>\n<h2 id=\"步骤说明\"><a href=\"#步骤说明\" class=\"headerlink\" title=\"步骤说明\"></a>步骤说明</h2><p>主要分为以下几个步骤：</p>\n<p>1.到 <code>Oracle</code> 官网下载 <code>JDK</code> 安装包。(我在这里选择的是 <code>JDK1.8</code>，也可以选择其它版本)</p>\n<p>2.打开获取到的安装包按步骤安装到系统上。</p>\n<p>3.配置系统的环境变量。</p>\n<p>4.验证 <code>JDK</code> 是否安装成功。</p>\n<p>【由于电脑上已经安装过了 <code>JDK1.8</code>，所以偷懒把别人的文章搬过来了，<a href=\"https://blog.csdn.net/deliciousion/article/details/78046007\" target=\"_blank\" rel=\"noopener\">原文链接</a>】</p>\n<h2 id=\"一、下载JDK8\"><a href=\"#一、下载JDK8\" class=\"headerlink\" title=\"一、下载JDK8\"></a>一、下载JDK8</h2><p>通过下面 <code>Oracle</code> 官网找到对应的 <code>JDK1.8</code> 安装包</p>\n<p><a href=\"https://www.oracle.com/index.html\" target=\"_blank\" rel=\"noopener\">https://www.oracle.com/index.html</a></p>\n<p>打开后如下所示，<code>Oracle</code> 主页内容经常变动，读者打开后很有可能不一样。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/munYUqTkJg5IxDR.png\" alt=\"1-jdk-mac.png\"></p>\n<p>拉到页面底部，找到“Download Java for Developers”，如下红框所示。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/GOvJdf7zLWrTCEb.png\" alt=\"2-jdk-mac.png\"></p>\n<p>点开链接后，如下图所示，再点击红框位置，只下载 <code>JDK1.8</code> ，红框右边的链接是 <code>JDK1.8</code> 加上 <code>NetBeans</code> ，一个挺好用的 <code>JAVA IDE</code>（集成化开发环境），有需要的可以下载。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/FakO2WjeMR1hi79.png\" alt=\"3-jdk-mac.png\"></p>\n<p>进入页面后第一步，点击“Accept License Agreement”同意许可证协议。第二步选择 <code>JDK</code> 对应的操作系统。本次选择“MAC OS X”，最后把相应的安装包下载到本地。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/I3XBT1vUJQGHDcK.png\" alt=\"4-jdk-mac.png\"></p>\n<h2 id=\"二、安装JDK\"><a href=\"#二、安装JDK\" class=\"headerlink\" title=\"二、安装JDK\"></a>二、安装JDK</h2><p>下载完成后，我们得到一个dmg的安装包，如下图所示，名称为 <code>jdk-8u144-macosx-x64.dmg</code> ，表示这是 <code>Java 8</code> 版本号为 <code>144</code> 的 <code>JDK</code>安装包，如果选择的是其它版本，名称也会有所不同。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/PSbdcZGVfY1n4Oz.png\" alt=\"5-jdk-mac.png\"></p>\n<p>双击 <code>dmg</code> 安装包，打开如下图所示窗口。按照红框的提示，便可轻松完成安装。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/bDiVGkgKOrQJS5w.png\" alt=\"6-jdk-mac.png\"></p>\n<p>再双击中间的 <code>pkg</code> 文件，开始安装，如下图所示。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/kMa9bSmKOY2seFD.png\" alt=\"7-jdk-mac.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/ICbJmudG73f52lx.png\" alt=\"9-jdk-mac.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/e92Dx1XPzBI5WVO.png\" alt=\"10-jdk-mac.png\"></p>\n<h2 id=\"三、配置系统的环境变量\"><a href=\"#三、配置系统的环境变量\" class=\"headerlink\" title=\"三、配置系统的环境变量\"></a>三、配置系统的环境变量</h2><p>上一步骤，实标上，我们只是把 <code>JDK1.8</code> 的文件复制到操作系统上。但是我们如果要在 <code>terminal</code> 终端上使用 <code>JAVA</code> 命令，还需要让其它应用知道 <code>JDK1.8</code> 环境的存在，那我们还需要配置系统的环境变量。</p>\n<p>首先我们得知道 <code>JDK</code> 目录安装在哪里，按照下面的路径我们可以找到 <code>JDK</code> 的主目录，如下图所示。这里有两个目录是因为本机较早前安装过早期版本的 <code>JDK1.8</code>。</p>\n<pre><code class=\"bash\">/Library/Java/JavaVirtualMachines</code></pre>\n<p><img src=\"https://i.loli.net/2020/05/02/ewjVCx6Wdiz7hE5.png\" alt=\"11-jdk-mac.png\"></p>\n<p>由于 <code>MAC</code> 文件系统结构，与 <code>WINDOWS</code> 有所不一样，所以 <code>JDK</code>的真实主目录如下</p>\n<pre><code class=\"bash\">/Library/Java/JavaVirtualMachines/jdk1.8.0_144.jdk/Contents/Home</code></pre>\n<p>打开 <code>terminal</code> 终端，默认打开在自身 <code>home</code> 目录下，也可通过 <code>cd</code> 命令直接跳到主目录。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/bFOD8ViUStJYdBW.png\" alt=\"12-jdk-mac.png\"></p>\n<p>通过 <code>vim .bash_profile</code> 命令打开启动文件，修改内容</p>\n<p><img src=\"https://i.loli.net/2020/05/02/u51VTvULm6HtJcn.png\" alt=\"13-jdk-mac.png\"></p>\n<p>进入 <code>vim</code>，按 <code>i</code> 键进入编辑状态。添加如下内容，如下图所示。再按 <code>ESC</code> 键，输入“:wq”保存退出。配置系统环境变量结束。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/93vEFplMf4Vjg8O.png\" alt=\"14-jdk-mac.png\"></p>\n<p>添加如下内容：</p>\n<pre><code class=\"bash\">export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_45.jdk/Contents/Home</code></pre>\n<p>注意将 <code>jdk1.8.0_45</code> 这里改为你下载的 <code>JDK</code> 版本，不清楚的话，到 <code>/Library/Java/JavaVirtualMachines/</code> 这个目录下找找。</p>\n<h2 id=\"四、验证JDK1-8是否安装成功。\"><a href=\"#四、验证JDK1-8是否安装成功。\" class=\"headerlink\" title=\"四、验证JDK1.8是否安装成功。\"></a>四、验证JDK1.8是否安装成功。</h2><p>在终端输入 <code>java</code>,有如下画面，证明配置成功</p>\n<p><img src=\"https://i.loli.net/2020/05/02/S3X7JwZfONlvqsM.png\" alt=\"15-jdk-mac.png\"></p>\n<p>或输入 <code>java -version</code>，会出现版本信息</p>\n<p><img src=\"https://i.loli.net/2020/05/02/zlKysIfgXDL1E4C.png\" alt=\"16-jdk-mac.png\"></p>\n<p>至此，整个安装 <code>JDK</code> 过程结束。</p>\n"},{"title":"【Java入门篇】二、Java开发环境搭建——Windows篇","toc":true,"date":"2020-05-01T14:33:03.000Z","_content":"\n> 你为了你的正义，我为了我的正义。 -- 《火影忍者》\n\n## 一、安装JDK\n\n官网下载链接：https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html\n\n![1-jdk-windows.png](https://i.loli.net/2020/05/02/CvASgTp3BQFGlks.png)\n\n## 二、配置环境变量\n\n需要配置以下几个环境变量：\n\n|环境变量名|说明|\n|-|-|\n|JAVA_HOME|配置JDK安装路径|\n|PATH|配置JDK命令文件的位置|\n|CLASSPATH|配置类库文件的位置｜\n\n### 1、我的电脑（右键）-->属性-->高级系统设置\n\n![2-jdk-windows.png](https://i.loli.net/2020/05/02/KkW2HEcewYmfyLC.png)\n\n### 2、环境变量-->新建\n\n![3-jdk-windows.png](https://i.loli.net/2020/05/02/Iybmol7AfZ2JjPV.png)\n\n![4-jdk-windows.png](https://i.loli.net/2020/05/02/iaUDGuIA2dFVLsb.png)\n\n![5-jdk-windows.png](https://i.loli.net/2020/05/02/Fm6WAQtRjKyxPv3.png)\n\n(1)新建->变量名\"JAVA_HOME\"，变量值\"C:/Java/jdk1.8.0_144\"（即JDK的安装路径），在此，我安装的是 `java8` 版本，如果选择其它版本，设置对应的路径和名称即可。 \n\n(2)编辑->变量名\"Path\"，在原变量值的最后面加上“;%JAVA_HOME%/bin;%JAVA_HOME%/jre/bin” \n\n(3)新建->变量名“CLASSPATH”,变量值“.;%JAVA_HOME%/lib;%JAVA_HOME%/lib/dt.jar;%JAVA_HOME%/lib/tools.jar”\n\n### 3、确认环境配置是否正确\n\n在控制台分别输入 `java`，`javac`，`java -version` 命令，出现如下所示的 `JDK` 的编译器信息，包括修改命令的语法和参数选项等信息。\n\n`java` 命令：\n\n![6-jdk-windows.png](https://i.loli.net/2020/05/02/4rDZIYn6yL5lGEp.png)\n\n`javac` 命令：\n\n![7-jdk-windows.png](https://i.loli.net/2020/05/02/WagrjY8X9AcwPNI.png)\n\n`java -version` 命令：\n\n![8-jdk-windows.png](https://i.loli.net/2020/05/02/wBrWpu7P8KIA1c6.png)\n\n### 4、在控制台下验证第一个java程序：\n\n右键--》新建--》文本文档\n\n```java\npublic class Test {\n    public static void main(String[] args) {\n        System.out.println(\"Hello World!\");\n    }\n}\n```\n\n用记事本编写好，点击“保存”，并保存在桌面后，先在控制台中进入桌面的目录。\n\n```bash\nC:\ncd /Users/[用户名]/Desktop\n```\n\n上面的[用户名]改成你的计算机用户名即可，不清楚的话打开我的电脑，进C盘目录：`C:/Users` 找一下。\n\n输入 `javac Test.java` 和 `java Test` 命令，即可运行程序（打印出结果“Hello Java”）。\n\n![9-jdk-windows.png](https://i.loli.net/2020/05/02/InRJXZb54T1veuc.png)\n\n至此，`Java` 开发环境搭建成功。\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","source":"_posts/java/introduction/java-environment-windows.md","raw":"---\ntitle: 【Java入门篇】二、Java开发环境搭建——Windows篇\ntags:\n  - Java入门\n  - Java\n  - 环境搭建\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-01 22:33:03\n---\n\n> 你为了你的正义，我为了我的正义。 -- 《火影忍者》\n\n## 一、安装JDK\n\n官网下载链接：https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html\n\n![1-jdk-windows.png](https://i.loli.net/2020/05/02/CvASgTp3BQFGlks.png)\n\n## 二、配置环境变量\n\n需要配置以下几个环境变量：\n\n|环境变量名|说明|\n|-|-|\n|JAVA_HOME|配置JDK安装路径|\n|PATH|配置JDK命令文件的位置|\n|CLASSPATH|配置类库文件的位置｜\n\n### 1、我的电脑（右键）-->属性-->高级系统设置\n\n![2-jdk-windows.png](https://i.loli.net/2020/05/02/KkW2HEcewYmfyLC.png)\n\n### 2、环境变量-->新建\n\n![3-jdk-windows.png](https://i.loli.net/2020/05/02/Iybmol7AfZ2JjPV.png)\n\n![4-jdk-windows.png](https://i.loli.net/2020/05/02/iaUDGuIA2dFVLsb.png)\n\n![5-jdk-windows.png](https://i.loli.net/2020/05/02/Fm6WAQtRjKyxPv3.png)\n\n(1)新建->变量名\"JAVA_HOME\"，变量值\"C:/Java/jdk1.8.0_144\"（即JDK的安装路径），在此，我安装的是 `java8` 版本，如果选择其它版本，设置对应的路径和名称即可。 \n\n(2)编辑->变量名\"Path\"，在原变量值的最后面加上“;%JAVA_HOME%/bin;%JAVA_HOME%/jre/bin” \n\n(3)新建->变量名“CLASSPATH”,变量值“.;%JAVA_HOME%/lib;%JAVA_HOME%/lib/dt.jar;%JAVA_HOME%/lib/tools.jar”\n\n### 3、确认环境配置是否正确\n\n在控制台分别输入 `java`，`javac`，`java -version` 命令，出现如下所示的 `JDK` 的编译器信息，包括修改命令的语法和参数选项等信息。\n\n`java` 命令：\n\n![6-jdk-windows.png](https://i.loli.net/2020/05/02/4rDZIYn6yL5lGEp.png)\n\n`javac` 命令：\n\n![7-jdk-windows.png](https://i.loli.net/2020/05/02/WagrjY8X9AcwPNI.png)\n\n`java -version` 命令：\n\n![8-jdk-windows.png](https://i.loli.net/2020/05/02/wBrWpu7P8KIA1c6.png)\n\n### 4、在控制台下验证第一个java程序：\n\n右键--》新建--》文本文档\n\n```java\npublic class Test {\n    public static void main(String[] args) {\n        System.out.println(\"Hello World!\");\n    }\n}\n```\n\n用记事本编写好，点击“保存”，并保存在桌面后，先在控制台中进入桌面的目录。\n\n```bash\nC:\ncd /Users/[用户名]/Desktop\n```\n\n上面的[用户名]改成你的计算机用户名即可，不清楚的话打开我的电脑，进C盘目录：`C:/Users` 找一下。\n\n输入 `javac Test.java` 和 `java Test` 命令，即可运行程序（打印出结果“Hello Java”）。\n\n![9-jdk-windows.png](https://i.loli.net/2020/05/02/InRJXZb54T1veuc.png)\n\n至此，`Java` 开发环境搭建成功。\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","slug":"java/introduction/java-environment-windows","published":1,"updated":"2020-05-01T14:33:03.000Z","_id":"cl70rsfgd003d5ohubtwu2lru","comments":1,"layout":"post","photos":[],"link":"","content":"<blockquote>\n<p>你为了你的正义，我为了我的正义。 – 《火影忍者》</p>\n</blockquote>\n<h2 id=\"一、安装JDK\"><a href=\"#一、安装JDK\" class=\"headerlink\" title=\"一、安装JDK\"></a>一、安装JDK</h2><p>官网下载链接：<a href=\"https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html\" target=\"_blank\" rel=\"noopener\">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p>\n<p><img src=\"https://i.loli.net/2020/05/02/CvASgTp3BQFGlks.png\" alt=\"1-jdk-windows.png\"></p>\n<h2 id=\"二、配置环境变量\"><a href=\"#二、配置环境变量\" class=\"headerlink\" title=\"二、配置环境变量\"></a>二、配置环境变量</h2><p>需要配置以下几个环境变量：</p>\n<table>\n<thead>\n<tr>\n<th>环境变量名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>JAVA_HOME</td>\n<td>配置JDK安装路径</td>\n</tr>\n<tr>\n<td>PATH</td>\n<td>配置JDK命令文件的位置</td>\n</tr>\n<tr>\n<td>CLASSPATH</td>\n<td>配置类库文件的位置｜</td>\n</tr>\n</tbody></table>\n<h3 id=\"1、我的电脑（右键）–-gt-属性–-gt-高级系统设置\"><a href=\"#1、我的电脑（右键）–-gt-属性–-gt-高级系统设置\" class=\"headerlink\" title=\"1、我的电脑（右键）–>属性–>高级系统设置\"></a>1、我的电脑（右键）–&gt;属性–&gt;高级系统设置</h3><p><img src=\"https://i.loli.net/2020/05/02/KkW2HEcewYmfyLC.png\" alt=\"2-jdk-windows.png\"></p>\n<h3 id=\"2、环境变量–-gt-新建\"><a href=\"#2、环境变量–-gt-新建\" class=\"headerlink\" title=\"2、环境变量–>新建\"></a>2、环境变量–&gt;新建</h3><p><img src=\"https://i.loli.net/2020/05/02/Iybmol7AfZ2JjPV.png\" alt=\"3-jdk-windows.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/iaUDGuIA2dFVLsb.png\" alt=\"4-jdk-windows.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/Fm6WAQtRjKyxPv3.png\" alt=\"5-jdk-windows.png\"></p>\n<p>(1)新建-&gt;变量名”JAVA_HOME”，变量值”C:/Java/jdk1.8.0_144”（即JDK的安装路径），在此，我安装的是 <code>java8</code> 版本，如果选择其它版本，设置对应的路径和名称即可。 </p>\n<p>(2)编辑-&gt;变量名”Path”，在原变量值的最后面加上“;%JAVA_HOME%/bin;%JAVA_HOME%/jre/bin” </p>\n<p>(3)新建-&gt;变量名“CLASSPATH”,变量值“.;%JAVA_HOME%/lib;%JAVA_HOME%/lib/dt.jar;%JAVA_HOME%/lib/tools.jar”</p>\n<h3 id=\"3、确认环境配置是否正确\"><a href=\"#3、确认环境配置是否正确\" class=\"headerlink\" title=\"3、确认环境配置是否正确\"></a>3、确认环境配置是否正确</h3><p>在控制台分别输入 <code>java</code>，<code>javac</code>，<code>java -version</code> 命令，出现如下所示的 <code>JDK</code> 的编译器信息，包括修改命令的语法和参数选项等信息。</p>\n<p><code>java</code> 命令：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/4rDZIYn6yL5lGEp.png\" alt=\"6-jdk-windows.png\"></p>\n<p><code>javac</code> 命令：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/WagrjY8X9AcwPNI.png\" alt=\"7-jdk-windows.png\"></p>\n<p><code>java -version</code> 命令：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/wBrWpu7P8KIA1c6.png\" alt=\"8-jdk-windows.png\"></p>\n<h3 id=\"4、在控制台下验证第一个java程序：\"><a href=\"#4、在控制台下验证第一个java程序：\" class=\"headerlink\" title=\"4、在控制台下验证第一个java程序：\"></a>4、在控制台下验证第一个java程序：</h3><p>右键–》新建–》文本文档</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Test</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>用记事本编写好，点击“保存”，并保存在桌面后，先在控制台中进入桌面的目录。</p>\n<pre class=\" language-bash\"><code class=\"language-bash\">C:\n<span class=\"token function\">cd</span> /Users/<span class=\"token punctuation\">[</span>用户名<span class=\"token punctuation\">]</span>/Desktop</code></pre>\n<p>上面的[用户名]改成你的计算机用户名即可，不清楚的话打开我的电脑，进C盘目录：<code>C:/Users</code> 找一下。</p>\n<p>输入 <code>javac Test.java</code> 和 <code>java Test</code> 命令，即可运行程序（打印出结果“Hello Java”）。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/InRJXZb54T1veuc.png\" alt=\"9-jdk-windows.png\"></p>\n<p>至此，<code>Java</code> 开发环境搭建成功。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>你为了你的正义，我为了我的正义。 – 《火影忍者》</p>\n</blockquote>\n<h2 id=\"一、安装JDK\"><a href=\"#一、安装JDK\" class=\"headerlink\" title=\"一、安装JDK\"></a>一、安装JDK</h2><p>官网下载链接：<a href=\"https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html\" target=\"_blank\" rel=\"noopener\">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p>\n<p><img src=\"https://i.loli.net/2020/05/02/CvASgTp3BQFGlks.png\" alt=\"1-jdk-windows.png\"></p>\n<h2 id=\"二、配置环境变量\"><a href=\"#二、配置环境变量\" class=\"headerlink\" title=\"二、配置环境变量\"></a>二、配置环境变量</h2><p>需要配置以下几个环境变量：</p>\n<table>\n<thead>\n<tr>\n<th>环境变量名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>JAVA_HOME</td>\n<td>配置JDK安装路径</td>\n</tr>\n<tr>\n<td>PATH</td>\n<td>配置JDK命令文件的位置</td>\n</tr>\n<tr>\n<td>CLASSPATH</td>\n<td>配置类库文件的位置｜</td>\n</tr>\n</tbody></table>\n<h3 id=\"1、我的电脑（右键）–-gt-属性–-gt-高级系统设置\"><a href=\"#1、我的电脑（右键）–-gt-属性–-gt-高级系统设置\" class=\"headerlink\" title=\"1、我的电脑（右键）–&gt;属性–&gt;高级系统设置\"></a>1、我的电脑（右键）–&gt;属性–&gt;高级系统设置</h3><p><img src=\"https://i.loli.net/2020/05/02/KkW2HEcewYmfyLC.png\" alt=\"2-jdk-windows.png\"></p>\n<h3 id=\"2、环境变量–-gt-新建\"><a href=\"#2、环境变量–-gt-新建\" class=\"headerlink\" title=\"2、环境变量–&gt;新建\"></a>2、环境变量–&gt;新建</h3><p><img src=\"https://i.loli.net/2020/05/02/Iybmol7AfZ2JjPV.png\" alt=\"3-jdk-windows.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/iaUDGuIA2dFVLsb.png\" alt=\"4-jdk-windows.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/Fm6WAQtRjKyxPv3.png\" alt=\"5-jdk-windows.png\"></p>\n<p>(1)新建-&gt;变量名”JAVA_HOME”，变量值”C:/Java/jdk1.8.0_144”（即JDK的安装路径），在此，我安装的是 <code>java8</code> 版本，如果选择其它版本，设置对应的路径和名称即可。 </p>\n<p>(2)编辑-&gt;变量名”Path”，在原变量值的最后面加上“;%JAVA_HOME%/bin;%JAVA_HOME%/jre/bin” </p>\n<p>(3)新建-&gt;变量名“CLASSPATH”,变量值“.;%JAVA_HOME%/lib;%JAVA_HOME%/lib/dt.jar;%JAVA_HOME%/lib/tools.jar”</p>\n<h3 id=\"3、确认环境配置是否正确\"><a href=\"#3、确认环境配置是否正确\" class=\"headerlink\" title=\"3、确认环境配置是否正确\"></a>3、确认环境配置是否正确</h3><p>在控制台分别输入 <code>java</code>，<code>javac</code>，<code>java -version</code> 命令，出现如下所示的 <code>JDK</code> 的编译器信息，包括修改命令的语法和参数选项等信息。</p>\n<p><code>java</code> 命令：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/4rDZIYn6yL5lGEp.png\" alt=\"6-jdk-windows.png\"></p>\n<p><code>javac</code> 命令：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/WagrjY8X9AcwPNI.png\" alt=\"7-jdk-windows.png\"></p>\n<p><code>java -version</code> 命令：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/wBrWpu7P8KIA1c6.png\" alt=\"8-jdk-windows.png\"></p>\n<h3 id=\"4、在控制台下验证第一个java程序：\"><a href=\"#4、在控制台下验证第一个java程序：\" class=\"headerlink\" title=\"4、在控制台下验证第一个java程序：\"></a>4、在控制台下验证第一个java程序：</h3><p>右键–》新建–》文本文档</p>\n<pre><code class=\"java\">public class Test {\n    public static void main(String[] args) {\n        System.out.println(&quot;Hello World!&quot;);\n    }\n}</code></pre>\n<p>用记事本编写好，点击“保存”，并保存在桌面后，先在控制台中进入桌面的目录。</p>\n<pre><code class=\"bash\">C:\ncd /Users/[用户名]/Desktop</code></pre>\n<p>上面的[用户名]改成你的计算机用户名即可，不清楚的话打开我的电脑，进C盘目录：<code>C:/Users</code> 找一下。</p>\n<p>输入 <code>javac Test.java</code> 和 <code>java Test</code> 命令，即可运行程序（打印出结果“Hello Java”）。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/InRJXZb54T1veuc.png\" alt=\"9-jdk-windows.png\"></p>\n<p>至此，<code>Java</code> 开发环境搭建成功。</p>\n"},{"title":"【Java入门篇】小结","toc":true,"date":"2020-05-01T14:33:08.000Z","_content":"\n> 只要你在，我便无所不能。 -- 《进击的巨人》\n\n## 小结\n\n至此，`Java` 入门篇就告一段落了，通过本篇的学习，希望你能掌握以下内容：\n\n1. `Java` 有哪些用途\n2. 部署 `JDK`\n3. 安装 `IDEA`\n4. 使用 `IDEA` 创建一个类\n5. 使用 `IDEA` 开发一个简单的计算器\n\n`Java入门篇`的内容很简单，目的也只是为了让零基础的人能够快速上手 `Java` 并开发一个可以运行的程序，降低学习的门槛，增加学习的乐趣。\n\n如果你已经顺利完成了以上内容的学习，那么恭喜你，已经完成了新手的第一阶段试炼。后面的篇章就要真正开始 `Java` 中核心内容的介绍了，如果你学习的热情有幸还没有被浇灭，那么就拿着你的新手套装，在这场征程里继续前行吧。😆\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","source":"_posts/java/introduction/java-primer-conclusion.md","raw":"---\ntitle: 【Java入门篇】小结\ntags:\n  - Java入门\n  - Java\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-01 22:33:08\n---\n\n> 只要你在，我便无所不能。 -- 《进击的巨人》\n\n## 小结\n\n至此，`Java` 入门篇就告一段落了，通过本篇的学习，希望你能掌握以下内容：\n\n1. `Java` 有哪些用途\n2. 部署 `JDK`\n3. 安装 `IDEA`\n4. 使用 `IDEA` 创建一个类\n5. 使用 `IDEA` 开发一个简单的计算器\n\n`Java入门篇`的内容很简单，目的也只是为了让零基础的人能够快速上手 `Java` 并开发一个可以运行的程序，降低学习的门槛，增加学习的乐趣。\n\n如果你已经顺利完成了以上内容的学习，那么恭喜你，已经完成了新手的第一阶段试炼。后面的篇章就要真正开始 `Java` 中核心内容的介绍了，如果你学习的热情有幸还没有被浇灭，那么就拿着你的新手套装，在这场征程里继续前行吧。😆\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","slug":"java/introduction/java-primer-conclusion","published":1,"updated":"2020-05-01T14:33:08.000Z","_id":"cl70rsfgg003g5ohucflh3ax5","comments":1,"layout":"post","photos":[],"link":"","content":"<blockquote>\n<p>只要你在，我便无所不能。 – 《进击的巨人》</p>\n</blockquote>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>至此，<code>Java</code> 入门篇就告一段落了，通过本篇的学习，希望你能掌握以下内容：</p>\n<ol>\n<li><code>Java</code> 有哪些用途</li>\n<li>部署 <code>JDK</code></li>\n<li>安装 <code>IDEA</code></li>\n<li>使用 <code>IDEA</code> 创建一个类</li>\n<li>使用 <code>IDEA</code> 开发一个简单的计算器</li>\n</ol>\n<p><code>Java入门篇</code>的内容很简单，目的也只是为了让零基础的人能够快速上手 <code>Java</code> 并开发一个可以运行的程序，降低学习的门槛，增加学习的乐趣。</p>\n<p>如果你已经顺利完成了以上内容的学习，那么恭喜你，已经完成了新手的第一阶段试炼。后面的篇章就要真正开始 <code>Java</code> 中核心内容的介绍了，如果你学习的热情有幸还没有被浇灭，那么就拿着你的新手套装，在这场征程里继续前行吧。😆</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>只要你在，我便无所不能。 – 《进击的巨人》</p>\n</blockquote>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>至此，<code>Java</code> 入门篇就告一段落了，通过本篇的学习，希望你能掌握以下内容：</p>\n<ol>\n<li><code>Java</code> 有哪些用途</li>\n<li>部署 <code>JDK</code></li>\n<li>安装 <code>IDEA</code></li>\n<li>使用 <code>IDEA</code> 创建一个类</li>\n<li>使用 <code>IDEA</code> 开发一个简单的计算器</li>\n</ol>\n<p><code>Java入门篇</code>的内容很简单，目的也只是为了让零基础的人能够快速上手 <code>Java</code> 并开发一个可以运行的程序，降低学习的门槛，增加学习的乐趣。</p>\n<p>如果你已经顺利完成了以上内容的学习，那么恭喜你，已经完成了新手的第一阶段试炼。后面的篇章就要真正开始 <code>Java</code> 中核心内容的介绍了，如果你学习的热情有幸还没有被浇灭，那么就拿着你的新手套装，在这场征程里继续前行吧。😆</p>\n"},{"title":"【Java入门篇】五、Java 开发简介","toc":true,"date":"2020-05-01T14:33:06.000Z","_content":"\n> 每个人都衣冠楚楚，从来没有人会关心光芒万丈的外表下那藏在角落的，发了霉的落寞。  -- 《西风》\n\n## 前言\n\n万事开头难，如果你已经顺利通过了前面安装环境的考验，那么恭喜你已经拿到了 `Java` 世界的钥匙。\n\n在打开这扇大门之前，我想再说说我玩这个游戏的一些经验，希望能帮助你在这个游戏里有更好的体验。\n\n前面两篇已经介绍了 `Java` 开发环境搭建和 `IDE` 的下载安装，如果进行顺利的话，那么现在世界上最好的语言之一和世界上最好用的 `Java IDE`（没有之一，不接受反驳）已经握在了你的手中。所以现在你所需要学习的，就是如何使用这些工具。\n\n但在此之前，还想先说一说其他的内容。\n\n## 关于方向\n\n当你下定决心走上 `Java` 的探索之旅时，你需要确定一个大概的方向，有方向才会有学习下去的动力。\n\n如果只是单纯的想体验一下 `Java` 开发是怎样的，那么可以跟着本系列文章进行尝试，选择学习使用 `Java` 来开发一个你想要的功能。\n\n比如学习如何用 `Java` 来开发一个`定时提醒功能`，在固定时间或者某些特定事件发生后给你发送`闹铃提示`或者`邮件提示`。又比如使用 `Java` 来开发 `QQ`、`微信机器人`，自动接收群友消息并自动回复。兴趣是最好的老师，选择一个你感兴趣的方向，你才能走的更远。\n\n如果你打算使用 `Java` 来找工作，并有较充沛的学习时间预算，那么我建议你多花一点时间在基础的内容上，把 `Java` 基础的部分啃透会让你在之后的学习里轻松很多。\n\n如果你对 `Java` 有着强烈的兴趣，对 `Java` 有过一段时间的自学，但却因为无法坚持而中途放弃，那么我建议你找一批共同学习的伙伴，在相互交流探讨中，也许可以激发你学习的动力。\n\n很多人会问，我不是学计算机相关的专业，我以前从未接触过编程，但是我想学 `Java` ，以后会不会不好找工作？跟别人比是不是没有竞争力？\n\n对此，我只能负责任的说，是的，但也不全是。\n\n有时候，选择比努力更重要，别人选了计算机专业，软件工程专业，在IT行业找工作，相对而言确实比非相关专业的人要容易一点。别人学了计算机四年，比你有优势不是应该的吗。\n\n但也不要因此就觉得跨专业，跨行业是不可能的事情，事实上，很多 `Java` 从业者都不是计算机相关专业，他们带着各种各样的目的，通过各自的方法也同样走上了这条道路。\n\n我也是如此，我的专业是工商管理，但现在也在服务端开发的路上越走越远，这个过程虽然有些艰辛，也有不少曲折，但我觉得，对大多数愿意付出努力的人来说，是完全可行的。\n\n我分享的初衷，是希望能给那些对编程充满热情，但是却对未来充满迷茫和困惑的人提供一点方向。\n\n## 关于努力\n\n确定了方向，剩下的事情就只有努力了，就像在学生时代那样，想要考出更好的成绩，只需要不断的刷题学习和总结。\n\n其实 `Java` 学习过程也一样，在 `Java` 这个游戏里，必须不断打怪升级才能提升自己，才能接到奖励更丰富的任务，也能获得更高的声望，声望高的人才能在这个游戏里获得别人的认可。\n\n那如何在这个游戏里获得更好的游戏体验，如何更快更好的提升自我呢？那就是借助前人的经验，在这个游戏里有大批的老玩家，他们在这个游戏世界里已经徜徉了多年，有的满足于每天接`循环任务`来获取金币，有的喜欢去野外探险，寻找 `boss` 挑战，有的喜欢刷`副本`，企图刷出`绝世装备`。\n\n他们大都有一个自己的`经验法则`来帮助他们在这个游戏里更好的生存和发展。如果能在这个游戏里交到一个亦师亦友的朋友，那么无疑能给你极大的帮助。\n\n但需要说明的一点是，努力的方式并不一定是通用的，因为每个人擅长的领域不一样，有的人反应很快，擅长`单挑`，喜欢极限操作，所以通常是`竞技场`的常客，有的人擅长`指挥`，副本里队长名单里总有他们的身影。 就像之前所说，选择有时候比努力更重要，选择自己擅长的领域和方向去发展，也许会让你在这个游戏里有更重要的价值。\n\n至于如何努力，我个人觉得，`看书`应该是首选，经典的书籍往往经过了反复斟酌的优质内容，才有了现在的口碑，所以书籍内容不会有太多漏洞，不会像有些不负责任的博主，写博客只是为了博得关注，遇到不确定的地方，要么仅凭自己猜测，要么一笔带过，误导了很多读者。(希望我的博客至少不要误导人，哈哈)\n\n如果看书实在看不下去的话，可以看看经典的视频教程，`慕课网`的教程个人觉得还算不错，讲解比较形象，有兴趣的话可以去看看。\n\n如果还是不行，那就找两个有意思的项目来研究一下。想想看如何用 `Java` 来提高生活质量，或者来帮助你完成一些重复性的体力劳动。比如用 `Java` 来批量爬取图片，批量将 `txt` 文件导入 `Excel` 等等。\n\n## 正式起航\n\n这几篇大概把我平生的废话都说完了，一本正经的胡说八道了这么久，有点不习惯。如果让你感到无聊了，十分抱歉。【面壁中】\n\n如果你看完这些废话，觉得自己还是很有兴趣继续看下去，那么就让我们红尘作伴，活得潇潇洒洒。啊，说错了，让我们一起开始Java游戏世界的试炼吧！\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","source":"_posts/java/introduction/java-introduction.md","raw":"---\ntitle: 【Java入门篇】五、Java 开发简介\ntags:\n  - Java入门\n  - Java\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-01 22:33:06\n---\n\n> 每个人都衣冠楚楚，从来没有人会关心光芒万丈的外表下那藏在角落的，发了霉的落寞。  -- 《西风》\n\n## 前言\n\n万事开头难，如果你已经顺利通过了前面安装环境的考验，那么恭喜你已经拿到了 `Java` 世界的钥匙。\n\n在打开这扇大门之前，我想再说说我玩这个游戏的一些经验，希望能帮助你在这个游戏里有更好的体验。\n\n前面两篇已经介绍了 `Java` 开发环境搭建和 `IDE` 的下载安装，如果进行顺利的话，那么现在世界上最好的语言之一和世界上最好用的 `Java IDE`（没有之一，不接受反驳）已经握在了你的手中。所以现在你所需要学习的，就是如何使用这些工具。\n\n但在此之前，还想先说一说其他的内容。\n\n## 关于方向\n\n当你下定决心走上 `Java` 的探索之旅时，你需要确定一个大概的方向，有方向才会有学习下去的动力。\n\n如果只是单纯的想体验一下 `Java` 开发是怎样的，那么可以跟着本系列文章进行尝试，选择学习使用 `Java` 来开发一个你想要的功能。\n\n比如学习如何用 `Java` 来开发一个`定时提醒功能`，在固定时间或者某些特定事件发生后给你发送`闹铃提示`或者`邮件提示`。又比如使用 `Java` 来开发 `QQ`、`微信机器人`，自动接收群友消息并自动回复。兴趣是最好的老师，选择一个你感兴趣的方向，你才能走的更远。\n\n如果你打算使用 `Java` 来找工作，并有较充沛的学习时间预算，那么我建议你多花一点时间在基础的内容上，把 `Java` 基础的部分啃透会让你在之后的学习里轻松很多。\n\n如果你对 `Java` 有着强烈的兴趣，对 `Java` 有过一段时间的自学，但却因为无法坚持而中途放弃，那么我建议你找一批共同学习的伙伴，在相互交流探讨中，也许可以激发你学习的动力。\n\n很多人会问，我不是学计算机相关的专业，我以前从未接触过编程，但是我想学 `Java` ，以后会不会不好找工作？跟别人比是不是没有竞争力？\n\n对此，我只能负责任的说，是的，但也不全是。\n\n有时候，选择比努力更重要，别人选了计算机专业，软件工程专业，在IT行业找工作，相对而言确实比非相关专业的人要容易一点。别人学了计算机四年，比你有优势不是应该的吗。\n\n但也不要因此就觉得跨专业，跨行业是不可能的事情，事实上，很多 `Java` 从业者都不是计算机相关专业，他们带着各种各样的目的，通过各自的方法也同样走上了这条道路。\n\n我也是如此，我的专业是工商管理，但现在也在服务端开发的路上越走越远，这个过程虽然有些艰辛，也有不少曲折，但我觉得，对大多数愿意付出努力的人来说，是完全可行的。\n\n我分享的初衷，是希望能给那些对编程充满热情，但是却对未来充满迷茫和困惑的人提供一点方向。\n\n## 关于努力\n\n确定了方向，剩下的事情就只有努力了，就像在学生时代那样，想要考出更好的成绩，只需要不断的刷题学习和总结。\n\n其实 `Java` 学习过程也一样，在 `Java` 这个游戏里，必须不断打怪升级才能提升自己，才能接到奖励更丰富的任务，也能获得更高的声望，声望高的人才能在这个游戏里获得别人的认可。\n\n那如何在这个游戏里获得更好的游戏体验，如何更快更好的提升自我呢？那就是借助前人的经验，在这个游戏里有大批的老玩家，他们在这个游戏世界里已经徜徉了多年，有的满足于每天接`循环任务`来获取金币，有的喜欢去野外探险，寻找 `boss` 挑战，有的喜欢刷`副本`，企图刷出`绝世装备`。\n\n他们大都有一个自己的`经验法则`来帮助他们在这个游戏里更好的生存和发展。如果能在这个游戏里交到一个亦师亦友的朋友，那么无疑能给你极大的帮助。\n\n但需要说明的一点是，努力的方式并不一定是通用的，因为每个人擅长的领域不一样，有的人反应很快，擅长`单挑`，喜欢极限操作，所以通常是`竞技场`的常客，有的人擅长`指挥`，副本里队长名单里总有他们的身影。 就像之前所说，选择有时候比努力更重要，选择自己擅长的领域和方向去发展，也许会让你在这个游戏里有更重要的价值。\n\n至于如何努力，我个人觉得，`看书`应该是首选，经典的书籍往往经过了反复斟酌的优质内容，才有了现在的口碑，所以书籍内容不会有太多漏洞，不会像有些不负责任的博主，写博客只是为了博得关注，遇到不确定的地方，要么仅凭自己猜测，要么一笔带过，误导了很多读者。(希望我的博客至少不要误导人，哈哈)\n\n如果看书实在看不下去的话，可以看看经典的视频教程，`慕课网`的教程个人觉得还算不错，讲解比较形象，有兴趣的话可以去看看。\n\n如果还是不行，那就找两个有意思的项目来研究一下。想想看如何用 `Java` 来提高生活质量，或者来帮助你完成一些重复性的体力劳动。比如用 `Java` 来批量爬取图片，批量将 `txt` 文件导入 `Excel` 等等。\n\n## 正式起航\n\n这几篇大概把我平生的废话都说完了，一本正经的胡说八道了这么久，有点不习惯。如果让你感到无聊了，十分抱歉。【面壁中】\n\n如果你看完这些废话，觉得自己还是很有兴趣继续看下去，那么就让我们红尘作伴，活得潇潇洒洒。啊，说错了，让我们一起开始Java游戏世界的试炼吧！\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","slug":"java/introduction/java-introduction","published":1,"updated":"2020-05-01T14:33:06.000Z","_id":"cl70rsfgi003j5ohub2at5aio","comments":1,"layout":"post","photos":[],"link":"","content":"<blockquote>\n<p>每个人都衣冠楚楚，从来没有人会关心光芒万丈的外表下那藏在角落的，发了霉的落寞。  – 《西风》</p>\n</blockquote>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>万事开头难，如果你已经顺利通过了前面安装环境的考验，那么恭喜你已经拿到了 <code>Java</code> 世界的钥匙。</p>\n<p>在打开这扇大门之前，我想再说说我玩这个游戏的一些经验，希望能帮助你在这个游戏里有更好的体验。</p>\n<p>前面两篇已经介绍了 <code>Java</code> 开发环境搭建和 <code>IDE</code> 的下载安装，如果进行顺利的话，那么现在世界上最好的语言之一和世界上最好用的 <code>Java IDE</code>（没有之一，不接受反驳）已经握在了你的手中。所以现在你所需要学习的，就是如何使用这些工具。</p>\n<p>但在此之前，还想先说一说其他的内容。</p>\n<h2 id=\"关于方向\"><a href=\"#关于方向\" class=\"headerlink\" title=\"关于方向\"></a>关于方向</h2><p>当你下定决心走上 <code>Java</code> 的探索之旅时，你需要确定一个大概的方向，有方向才会有学习下去的动力。</p>\n<p>如果只是单纯的想体验一下 <code>Java</code> 开发是怎样的，那么可以跟着本系列文章进行尝试，选择学习使用 <code>Java</code> 来开发一个你想要的功能。</p>\n<p>比如学习如何用 <code>Java</code> 来开发一个<code>定时提醒功能</code>，在固定时间或者某些特定事件发生后给你发送<code>闹铃提示</code>或者<code>邮件提示</code>。又比如使用 <code>Java</code> 来开发 <code>QQ</code>、<code>微信机器人</code>，自动接收群友消息并自动回复。兴趣是最好的老师，选择一个你感兴趣的方向，你才能走的更远。</p>\n<p>如果你打算使用 <code>Java</code> 来找工作，并有较充沛的学习时间预算，那么我建议你多花一点时间在基础的内容上，把 <code>Java</code> 基础的部分啃透会让你在之后的学习里轻松很多。</p>\n<p>如果你对 <code>Java</code> 有着强烈的兴趣，对 <code>Java</code> 有过一段时间的自学，但却因为无法坚持而中途放弃，那么我建议你找一批共同学习的伙伴，在相互交流探讨中，也许可以激发你学习的动力。</p>\n<p>很多人会问，我不是学计算机相关的专业，我以前从未接触过编程，但是我想学 <code>Java</code> ，以后会不会不好找工作？跟别人比是不是没有竞争力？</p>\n<p>对此，我只能负责任的说，是的，但也不全是。</p>\n<p>有时候，选择比努力更重要，别人选了计算机专业，软件工程专业，在IT行业找工作，相对而言确实比非相关专业的人要容易一点。别人学了计算机四年，比你有优势不是应该的吗。</p>\n<p>但也不要因此就觉得跨专业，跨行业是不可能的事情，事实上，很多 <code>Java</code> 从业者都不是计算机相关专业，他们带着各种各样的目的，通过各自的方法也同样走上了这条道路。</p>\n<p>我也是如此，我的专业是工商管理，但现在也在服务端开发的路上越走越远，这个过程虽然有些艰辛，也有不少曲折，但我觉得，对大多数愿意付出努力的人来说，是完全可行的。</p>\n<p>我分享的初衷，是希望能给那些对编程充满热情，但是却对未来充满迷茫和困惑的人提供一点方向。</p>\n<h2 id=\"关于努力\"><a href=\"#关于努力\" class=\"headerlink\" title=\"关于努力\"></a>关于努力</h2><p>确定了方向，剩下的事情就只有努力了，就像在学生时代那样，想要考出更好的成绩，只需要不断的刷题学习和总结。</p>\n<p>其实 <code>Java</code> 学习过程也一样，在 <code>Java</code> 这个游戏里，必须不断打怪升级才能提升自己，才能接到奖励更丰富的任务，也能获得更高的声望，声望高的人才能在这个游戏里获得别人的认可。</p>\n<p>那如何在这个游戏里获得更好的游戏体验，如何更快更好的提升自我呢？那就是借助前人的经验，在这个游戏里有大批的老玩家，他们在这个游戏世界里已经徜徉了多年，有的满足于每天接<code>循环任务</code>来获取金币，有的喜欢去野外探险，寻找 <code>boss</code> 挑战，有的喜欢刷<code>副本</code>，企图刷出<code>绝世装备</code>。</p>\n<p>他们大都有一个自己的<code>经验法则</code>来帮助他们在这个游戏里更好的生存和发展。如果能在这个游戏里交到一个亦师亦友的朋友，那么无疑能给你极大的帮助。</p>\n<p>但需要说明的一点是，努力的方式并不一定是通用的，因为每个人擅长的领域不一样，有的人反应很快，擅长<code>单挑</code>，喜欢极限操作，所以通常是<code>竞技场</code>的常客，有的人擅长<code>指挥</code>，副本里队长名单里总有他们的身影。 就像之前所说，选择有时候比努力更重要，选择自己擅长的领域和方向去发展，也许会让你在这个游戏里有更重要的价值。</p>\n<p>至于如何努力，我个人觉得，<code>看书</code>应该是首选，经典的书籍往往经过了反复斟酌的优质内容，才有了现在的口碑，所以书籍内容不会有太多漏洞，不会像有些不负责任的博主，写博客只是为了博得关注，遇到不确定的地方，要么仅凭自己猜测，要么一笔带过，误导了很多读者。(希望我的博客至少不要误导人，哈哈)</p>\n<p>如果看书实在看不下去的话，可以看看经典的视频教程，<code>慕课网</code>的教程个人觉得还算不错，讲解比较形象，有兴趣的话可以去看看。</p>\n<p>如果还是不行，那就找两个有意思的项目来研究一下。想想看如何用 <code>Java</code> 来提高生活质量，或者来帮助你完成一些重复性的体力劳动。比如用 <code>Java</code> 来批量爬取图片，批量将 <code>txt</code> 文件导入 <code>Excel</code> 等等。</p>\n<h2 id=\"正式起航\"><a href=\"#正式起航\" class=\"headerlink\" title=\"正式起航\"></a>正式起航</h2><p>这几篇大概把我平生的废话都说完了，一本正经的胡说八道了这么久，有点不习惯。如果让你感到无聊了，十分抱歉。【面壁中】</p>\n<p>如果你看完这些废话，觉得自己还是很有兴趣继续看下去，那么就让我们红尘作伴，活得潇潇洒洒。啊，说错了，让我们一起开始Java游戏世界的试炼吧！</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>每个人都衣冠楚楚，从来没有人会关心光芒万丈的外表下那藏在角落的，发了霉的落寞。  – 《西风》</p>\n</blockquote>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>万事开头难，如果你已经顺利通过了前面安装环境的考验，那么恭喜你已经拿到了 <code>Java</code> 世界的钥匙。</p>\n<p>在打开这扇大门之前，我想再说说我玩这个游戏的一些经验，希望能帮助你在这个游戏里有更好的体验。</p>\n<p>前面两篇已经介绍了 <code>Java</code> 开发环境搭建和 <code>IDE</code> 的下载安装，如果进行顺利的话，那么现在世界上最好的语言之一和世界上最好用的 <code>Java IDE</code>（没有之一，不接受反驳）已经握在了你的手中。所以现在你所需要学习的，就是如何使用这些工具。</p>\n<p>但在此之前，还想先说一说其他的内容。</p>\n<h2 id=\"关于方向\"><a href=\"#关于方向\" class=\"headerlink\" title=\"关于方向\"></a>关于方向</h2><p>当你下定决心走上 <code>Java</code> 的探索之旅时，你需要确定一个大概的方向，有方向才会有学习下去的动力。</p>\n<p>如果只是单纯的想体验一下 <code>Java</code> 开发是怎样的，那么可以跟着本系列文章进行尝试，选择学习使用 <code>Java</code> 来开发一个你想要的功能。</p>\n<p>比如学习如何用 <code>Java</code> 来开发一个<code>定时提醒功能</code>，在固定时间或者某些特定事件发生后给你发送<code>闹铃提示</code>或者<code>邮件提示</code>。又比如使用 <code>Java</code> 来开发 <code>QQ</code>、<code>微信机器人</code>，自动接收群友消息并自动回复。兴趣是最好的老师，选择一个你感兴趣的方向，你才能走的更远。</p>\n<p>如果你打算使用 <code>Java</code> 来找工作，并有较充沛的学习时间预算，那么我建议你多花一点时间在基础的内容上，把 <code>Java</code> 基础的部分啃透会让你在之后的学习里轻松很多。</p>\n<p>如果你对 <code>Java</code> 有着强烈的兴趣，对 <code>Java</code> 有过一段时间的自学，但却因为无法坚持而中途放弃，那么我建议你找一批共同学习的伙伴，在相互交流探讨中，也许可以激发你学习的动力。</p>\n<p>很多人会问，我不是学计算机相关的专业，我以前从未接触过编程，但是我想学 <code>Java</code> ，以后会不会不好找工作？跟别人比是不是没有竞争力？</p>\n<p>对此，我只能负责任的说，是的，但也不全是。</p>\n<p>有时候，选择比努力更重要，别人选了计算机专业，软件工程专业，在IT行业找工作，相对而言确实比非相关专业的人要容易一点。别人学了计算机四年，比你有优势不是应该的吗。</p>\n<p>但也不要因此就觉得跨专业，跨行业是不可能的事情，事实上，很多 <code>Java</code> 从业者都不是计算机相关专业，他们带着各种各样的目的，通过各自的方法也同样走上了这条道路。</p>\n<p>我也是如此，我的专业是工商管理，但现在也在服务端开发的路上越走越远，这个过程虽然有些艰辛，也有不少曲折，但我觉得，对大多数愿意付出努力的人来说，是完全可行的。</p>\n<p>我分享的初衷，是希望能给那些对编程充满热情，但是却对未来充满迷茫和困惑的人提供一点方向。</p>\n<h2 id=\"关于努力\"><a href=\"#关于努力\" class=\"headerlink\" title=\"关于努力\"></a>关于努力</h2><p>确定了方向，剩下的事情就只有努力了，就像在学生时代那样，想要考出更好的成绩，只需要不断的刷题学习和总结。</p>\n<p>其实 <code>Java</code> 学习过程也一样，在 <code>Java</code> 这个游戏里，必须不断打怪升级才能提升自己，才能接到奖励更丰富的任务，也能获得更高的声望，声望高的人才能在这个游戏里获得别人的认可。</p>\n<p>那如何在这个游戏里获得更好的游戏体验，如何更快更好的提升自我呢？那就是借助前人的经验，在这个游戏里有大批的老玩家，他们在这个游戏世界里已经徜徉了多年，有的满足于每天接<code>循环任务</code>来获取金币，有的喜欢去野外探险，寻找 <code>boss</code> 挑战，有的喜欢刷<code>副本</code>，企图刷出<code>绝世装备</code>。</p>\n<p>他们大都有一个自己的<code>经验法则</code>来帮助他们在这个游戏里更好的生存和发展。如果能在这个游戏里交到一个亦师亦友的朋友，那么无疑能给你极大的帮助。</p>\n<p>但需要说明的一点是，努力的方式并不一定是通用的，因为每个人擅长的领域不一样，有的人反应很快，擅长<code>单挑</code>，喜欢极限操作，所以通常是<code>竞技场</code>的常客，有的人擅长<code>指挥</code>，副本里队长名单里总有他们的身影。 就像之前所说，选择有时候比努力更重要，选择自己擅长的领域和方向去发展，也许会让你在这个游戏里有更重要的价值。</p>\n<p>至于如何努力，我个人觉得，<code>看书</code>应该是首选，经典的书籍往往经过了反复斟酌的优质内容，才有了现在的口碑，所以书籍内容不会有太多漏洞，不会像有些不负责任的博主，写博客只是为了博得关注，遇到不确定的地方，要么仅凭自己猜测，要么一笔带过，误导了很多读者。(希望我的博客至少不要误导人，哈哈)</p>\n<p>如果看书实在看不下去的话，可以看看经典的视频教程，<code>慕课网</code>的教程个人觉得还算不错，讲解比较形象，有兴趣的话可以去看看。</p>\n<p>如果还是不行，那就找两个有意思的项目来研究一下。想想看如何用 <code>Java</code> 来提高生活质量，或者来帮助你完成一些重复性的体力劳动。比如用 <code>Java</code> 来批量爬取图片，批量将 <code>txt</code> 文件导入 <code>Excel</code> 等等。</p>\n<h2 id=\"正式起航\"><a href=\"#正式起航\" class=\"headerlink\" title=\"正式起航\"></a>正式起航</h2><p>这几篇大概把我平生的废话都说完了，一本正经的胡说八道了这么久，有点不习惯。如果让你感到无聊了，十分抱歉。【面壁中】</p>\n<p>如果你看完这些废话，觉得自己还是很有兴趣继续看下去，那么就让我们红尘作伴，活得潇潇洒洒。啊，说错了，让我们一起开始Java游戏世界的试炼吧！</p>\n"},{"title":"【Java入门篇】一、Java开发环境搭建——概念说明","toc":true,"date":"2020-05-01T14:33:02.000Z","_content":"\n> 如果不能忠于自己的心，胜负又有什么价值呢？\n\n## 说明\n\n前面说到 `Java` 也有一个大工厂，可以让你随心所欲的创建想要创建的事物，但是想要使用这个工厂，还得先部署这个工厂，它就是 `JDK` 。\n\n在此之前，先介绍几个概念：`JVM`、`JRE`、`JDK`。\n\n## JVM（Java Virtual Machine）\n\n`JVM` 即 `Java虚拟机`，是 `Java` 这个大工厂中的熔炉，也是驱动这个工厂运行的核心组件。\n\n`Java` \t是能够跨平台运行的，也就是说，同样的代码可以不经修改的在 `windows` 系统、`linux`系统、`mac`系统上运行并得到相同的结果。\n\n`JVM` 在这个过程中扮演着十分重要的角色，它就像一位翻译官，由它间接的与具体的系统打交道。不同系统有着不同的指令集，可以理解为有不同的语言和方言，但 `JVM` 这位翻译官精通各个系统的语言，可以将我们的代码翻译给系统去执行。 `Java` 代码被编译为 `.class` 文件后，由虚拟机将字节码文件解释成具体平台上的机器指令。\n\n`JVM` 其实是一种规范，只要按这种规范设计的产品都可以叫做虚拟机，目前来说比较主流的虚拟机有，`HotSpot`、`J9 VM`、`Zing VM`。\n\n## JRE（Java Runtime Environment）\n\n`JRE` 即 Java运行时环境，是运行 `Java` 程序必不可少的，既然是运行，自然要包含 `JVM`，同时还包含了 `JVM` 标准实现及 `Java` 核心类库，提供了 `Java` 运行时必要的基础信息。\n\n光有 `JVM` 无法完成 `class` 的执行，因为在解释 `class` 的时候 `JVM` 需要调用解释所需要的类库 `lib` 。 可以这样理解，`JVM` 只是一名翻译官，还需要各个助理才能完成各项具体任务。\n\n有了 `JRE`, `Java` 程序就能顺利的跑起来了，但 `JRE` 并不是一个开发环境，所以没有包含任何开发工具（如编译器和调试器）。\n\n## JDK（Java Development Kit）\n\n`JDK` 是 `Java` 语言的软件开发工具包，是 `Java` 开发者所必须的内容，也就是我们之后要部署的东西，主要包含了各种类库和工具，当然也包含了一个 `JRE`。\n\n## 小结\n\n综上所述，`JDK` 中包含有 `JRE` ，`JRE` 中包含有 `JVM` ，所以 `JDK` 在手，天下我有【手动滑稽】。\n\n想要进行 `Java` 开发，就必须要部署 `JDK` 环境，但如果只是想要运行 `Java` 开发的软件，那么安装一个JRE就足够了。\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","source":"_posts/java/introduction/java-environment.md","raw":"---\ntitle: 【Java入门篇】一、Java开发环境搭建——概念说明\ntags:\n  - Java入门\n  - Java\n  - 环境搭建\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-01 22:33:02\n---\n\n> 如果不能忠于自己的心，胜负又有什么价值呢？\n\n## 说明\n\n前面说到 `Java` 也有一个大工厂，可以让你随心所欲的创建想要创建的事物，但是想要使用这个工厂，还得先部署这个工厂，它就是 `JDK` 。\n\n在此之前，先介绍几个概念：`JVM`、`JRE`、`JDK`。\n\n## JVM（Java Virtual Machine）\n\n`JVM` 即 `Java虚拟机`，是 `Java` 这个大工厂中的熔炉，也是驱动这个工厂运行的核心组件。\n\n`Java` \t是能够跨平台运行的，也就是说，同样的代码可以不经修改的在 `windows` 系统、`linux`系统、`mac`系统上运行并得到相同的结果。\n\n`JVM` 在这个过程中扮演着十分重要的角色，它就像一位翻译官，由它间接的与具体的系统打交道。不同系统有着不同的指令集，可以理解为有不同的语言和方言，但 `JVM` 这位翻译官精通各个系统的语言，可以将我们的代码翻译给系统去执行。 `Java` 代码被编译为 `.class` 文件后，由虚拟机将字节码文件解释成具体平台上的机器指令。\n\n`JVM` 其实是一种规范，只要按这种规范设计的产品都可以叫做虚拟机，目前来说比较主流的虚拟机有，`HotSpot`、`J9 VM`、`Zing VM`。\n\n## JRE（Java Runtime Environment）\n\n`JRE` 即 Java运行时环境，是运行 `Java` 程序必不可少的，既然是运行，自然要包含 `JVM`，同时还包含了 `JVM` 标准实现及 `Java` 核心类库，提供了 `Java` 运行时必要的基础信息。\n\n光有 `JVM` 无法完成 `class` 的执行，因为在解释 `class` 的时候 `JVM` 需要调用解释所需要的类库 `lib` 。 可以这样理解，`JVM` 只是一名翻译官，还需要各个助理才能完成各项具体任务。\n\n有了 `JRE`, `Java` 程序就能顺利的跑起来了，但 `JRE` 并不是一个开发环境，所以没有包含任何开发工具（如编译器和调试器）。\n\n## JDK（Java Development Kit）\n\n`JDK` 是 `Java` 语言的软件开发工具包，是 `Java` 开发者所必须的内容，也就是我们之后要部署的东西，主要包含了各种类库和工具，当然也包含了一个 `JRE`。\n\n## 小结\n\n综上所述，`JDK` 中包含有 `JRE` ，`JRE` 中包含有 `JVM` ，所以 `JDK` 在手，天下我有【手动滑稽】。\n\n想要进行 `Java` 开发，就必须要部署 `JDK` 环境，但如果只是想要运行 `Java` 开发的软件，那么安装一个JRE就足够了。\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","slug":"java/introduction/java-environment","published":1,"updated":"2020-05-01T14:33:02.000Z","_id":"cl70rsfgl003n5ohu0hy1axga","comments":1,"layout":"post","photos":[],"link":"","content":"<blockquote>\n<p>如果不能忠于自己的心，胜负又有什么价值呢？</p>\n</blockquote>\n<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>前面说到 <code>Java</code> 也有一个大工厂，可以让你随心所欲的创建想要创建的事物，但是想要使用这个工厂，还得先部署这个工厂，它就是 <code>JDK</code> 。</p>\n<p>在此之前，先介绍几个概念：<code>JVM</code>、<code>JRE</code>、<code>JDK</code>。</p>\n<h2 id=\"JVM（Java-Virtual-Machine）\"><a href=\"#JVM（Java-Virtual-Machine）\" class=\"headerlink\" title=\"JVM（Java Virtual Machine）\"></a>JVM（Java Virtual Machine）</h2><p><code>JVM</code> 即 <code>Java虚拟机</code>，是 <code>Java</code> 这个大工厂中的熔炉，也是驱动这个工厂运行的核心组件。</p>\n<p><code>Java</code>     是能够跨平台运行的，也就是说，同样的代码可以不经修改的在 <code>windows</code> 系统、<code>linux</code>系统、<code>mac</code>系统上运行并得到相同的结果。</p>\n<p><code>JVM</code> 在这个过程中扮演着十分重要的角色，它就像一位翻译官，由它间接的与具体的系统打交道。不同系统有着不同的指令集，可以理解为有不同的语言和方言，但 <code>JVM</code> 这位翻译官精通各个系统的语言，可以将我们的代码翻译给系统去执行。 <code>Java</code> 代码被编译为 <code>.class</code> 文件后，由虚拟机将字节码文件解释成具体平台上的机器指令。</p>\n<p><code>JVM</code> 其实是一种规范，只要按这种规范设计的产品都可以叫做虚拟机，目前来说比较主流的虚拟机有，<code>HotSpot</code>、<code>J9 VM</code>、<code>Zing VM</code>。</p>\n<h2 id=\"JRE（Java-Runtime-Environment）\"><a href=\"#JRE（Java-Runtime-Environment）\" class=\"headerlink\" title=\"JRE（Java Runtime Environment）\"></a>JRE（Java Runtime Environment）</h2><p><code>JRE</code> 即 Java运行时环境，是运行 <code>Java</code> 程序必不可少的，既然是运行，自然要包含 <code>JVM</code>，同时还包含了 <code>JVM</code> 标准实现及 <code>Java</code> 核心类库，提供了 <code>Java</code> 运行时必要的基础信息。</p>\n<p>光有 <code>JVM</code> 无法完成 <code>class</code> 的执行，因为在解释 <code>class</code> 的时候 <code>JVM</code> 需要调用解释所需要的类库 <code>lib</code> 。 可以这样理解，<code>JVM</code> 只是一名翻译官，还需要各个助理才能完成各项具体任务。</p>\n<p>有了 <code>JRE</code>, <code>Java</code> 程序就能顺利的跑起来了，但 <code>JRE</code> 并不是一个开发环境，所以没有包含任何开发工具（如编译器和调试器）。</p>\n<h2 id=\"JDK（Java-Development-Kit）\"><a href=\"#JDK（Java-Development-Kit）\" class=\"headerlink\" title=\"JDK（Java Development Kit）\"></a>JDK（Java Development Kit）</h2><p><code>JDK</code> 是 <code>Java</code> 语言的软件开发工具包，是 <code>Java</code> 开发者所必须的内容，也就是我们之后要部署的东西，主要包含了各种类库和工具，当然也包含了一个 <code>JRE</code>。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>综上所述，<code>JDK</code> 中包含有 <code>JRE</code> ，<code>JRE</code> 中包含有 <code>JVM</code> ，所以 <code>JDK</code> 在手，天下我有【手动滑稽】。</p>\n<p>想要进行 <code>Java</code> 开发，就必须要部署 <code>JDK</code> 环境，但如果只是想要运行 <code>Java</code> 开发的软件，那么安装一个JRE就足够了。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>如果不能忠于自己的心，胜负又有什么价值呢？</p>\n</blockquote>\n<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>前面说到 <code>Java</code> 也有一个大工厂，可以让你随心所欲的创建想要创建的事物，但是想要使用这个工厂，还得先部署这个工厂，它就是 <code>JDK</code> 。</p>\n<p>在此之前，先介绍几个概念：<code>JVM</code>、<code>JRE</code>、<code>JDK</code>。</p>\n<h2 id=\"JVM（Java-Virtual-Machine）\"><a href=\"#JVM（Java-Virtual-Machine）\" class=\"headerlink\" title=\"JVM（Java Virtual Machine）\"></a>JVM（Java Virtual Machine）</h2><p><code>JVM</code> 即 <code>Java虚拟机</code>，是 <code>Java</code> 这个大工厂中的熔炉，也是驱动这个工厂运行的核心组件。</p>\n<p><code>Java</code>     是能够跨平台运行的，也就是说，同样的代码可以不经修改的在 <code>windows</code> 系统、<code>linux</code>系统、<code>mac</code>系统上运行并得到相同的结果。</p>\n<p><code>JVM</code> 在这个过程中扮演着十分重要的角色，它就像一位翻译官，由它间接的与具体的系统打交道。不同系统有着不同的指令集，可以理解为有不同的语言和方言，但 <code>JVM</code> 这位翻译官精通各个系统的语言，可以将我们的代码翻译给系统去执行。 <code>Java</code> 代码被编译为 <code>.class</code> 文件后，由虚拟机将字节码文件解释成具体平台上的机器指令。</p>\n<p><code>JVM</code> 其实是一种规范，只要按这种规范设计的产品都可以叫做虚拟机，目前来说比较主流的虚拟机有，<code>HotSpot</code>、<code>J9 VM</code>、<code>Zing VM</code>。</p>\n<h2 id=\"JRE（Java-Runtime-Environment）\"><a href=\"#JRE（Java-Runtime-Environment）\" class=\"headerlink\" title=\"JRE（Java Runtime Environment）\"></a>JRE（Java Runtime Environment）</h2><p><code>JRE</code> 即 Java运行时环境，是运行 <code>Java</code> 程序必不可少的，既然是运行，自然要包含 <code>JVM</code>，同时还包含了 <code>JVM</code> 标准实现及 <code>Java</code> 核心类库，提供了 <code>Java</code> 运行时必要的基础信息。</p>\n<p>光有 <code>JVM</code> 无法完成 <code>class</code> 的执行，因为在解释 <code>class</code> 的时候 <code>JVM</code> 需要调用解释所需要的类库 <code>lib</code> 。 可以这样理解，<code>JVM</code> 只是一名翻译官，还需要各个助理才能完成各项具体任务。</p>\n<p>有了 <code>JRE</code>, <code>Java</code> 程序就能顺利的跑起来了，但 <code>JRE</code> 并不是一个开发环境，所以没有包含任何开发工具（如编译器和调试器）。</p>\n<h2 id=\"JDK（Java-Development-Kit）\"><a href=\"#JDK（Java-Development-Kit）\" class=\"headerlink\" title=\"JDK（Java Development Kit）\"></a>JDK（Java Development Kit）</h2><p><code>JDK</code> 是 <code>Java</code> 语言的软件开发工具包，是 <code>Java</code> 开发者所必须的内容，也就是我们之后要部署的东西，主要包含了各种类库和工具，当然也包含了一个 <code>JRE</code>。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>综上所述，<code>JDK</code> 中包含有 <code>JRE</code> ，<code>JRE</code> 中包含有 <code>JVM</code> ，所以 <code>JDK</code> 在手，天下我有【手动滑稽】。</p>\n<p>想要进行 <code>Java</code> 开发，就必须要部署 <code>JDK</code> 环境，但如果只是想要运行 <code>Java</code> 开发的软件，那么安装一个JRE就足够了。</p>\n"},{"title":"【Java入门篇】四、Java开发环境搭建——IDE","toc":true,"date":"2020-05-01T14:33:05.000Z","_content":"\n> 不相信自己的人 连努力的价值都没有。 --《火影忍者》\n\n## 前言\n\n前面我们已经安装好了 `JDK` ，现在 `Java` 这款大型开放式沙盒游戏已经安装在我们的电脑里了，接下来我们就要准备学习如何玩这个游戏了。\n\n在入门阶段，我建议选择简单模式来进行，那么一个好的 `IDE` 是必不可少的。\n\n## 什么是IDE\n\n`IDE（integrated development enviroment）` 就是集成开发环境，是用于提供程序开发环境的应用程序，一般包括`代码编辑器`、`编译器`、`调试器`和`图形用户界面`等工具。集成了代码编写功能、分析功能、编译功能、调试功能等一体化的开发软件服务套。所有具备这一特性的软件或者软件套（组）都可以叫集成开发环境。\n\n简单来说， `IDE` 就是将一系列工具集成到了一个应用里，让你的开发之旅变得更加容易。\n\n## 为什么需要IDE\n\n很多老玩家在指导刚入坑的新手时，都喜欢循循善诱，教导新手使用 `文本编辑器` 而非 `IDE` ，这样可以提高对整个编译流程的理解。\n\n讲道理，确实是这样的，但是却将开发的复杂度增加了许多，对于新手而言，每增加一个步骤，就是增加了无数种失败的姿势，很多人的学习热情就消耗在了这种无关痛痒的小问题上，很容易产生挫败感，觉得这个游戏怎么这么难。\n\n所以我个人认为，`开局一条狗，砍到99`的打法并不适合每一个人，对于新手而言，先给一个`新手套装`，再来做任务会更加轻松。\n\n## 安装IDE\n\n接下来，我们去官网下载 `IDEA` ：`http://www.jetbrains.com/idea/`\n\n![java-ide-1.png](https://i.loli.net/2020/05/02/P2ZVXphwkvzrTqj.png)\n\n![java-ide-2.png](https://i.loli.net/2020/05/02/amnrtAJkhV87yqb.png)\n\n根据自己的系统进行选择安装即可，这里就不分系统进行介绍了，下载的时候，可以选 `ultimate` 版，也可以选 `community` 版，建议选择 `ultimate` 版。\n\n下载好以后安装，要激活码的时候可以看一看这个地址：`http://idea.lanyus.com/` 使用前请将“0.0.0.0 account.jetbrains.com”添加到 `hosts` 文件中，然后输入激活码就能成功激活了。当然，此方法仅供学习研究使用，有条件的盆友还是自觉购买正版产品吧。如果该方法已失效，则需要自行搜索[其它姿势](https://www.baidu.com/s?wd=idea%20%E6%BF%80%E6%B4%BB%E7%A0%81)了。\n\n安装的时候，所有的都按默认选项进行安装即可。\n\n## 新建项目\n\n然后开始我们的第一个新手任务——`HelloWorld`。\n\n![java-ide-3.png](https://i.loli.net/2020/05/02/IvMY16wh5pU9WNE.png)\n\n![java-ide-4.png](https://i.loli.net/2020/05/02/CrWpUA13NszeytF.png)\n\n![java-ide-5.png](https://i.loli.net/2020/05/02/qhDGHiVAOawZk9J.png)\n\n创建好以后，右键src文件夹，添加package，名字叫hello，然后在package里添加HelloWorld类\n\n![java-ide-6.png](https://i.loli.net/2020/05/02/MKGcT3CD7t2msRH.png)\n\n![java-ide-7.png](https://i.loli.net/2020/05/02/buyAFqTGB9QjEzU.png)\n\n![java-ide-8.png](https://i.loli.net/2020/05/02/nGU3f2zLcNHlXoT.png)\n\n然后在文件里放上代码：\n\n```java\npackage hello;\nimport java.lang.System;\n\npublic class HelloWorld {\n    public static void main(String[] args){\n        System.out.println(\"Hello World!\");\n    }\n}\n```\n\n点击 `Run` ，运行程序，选择 `HelloWorld` ，代码就跑起来了。\n\n![java-ide-9.png](https://i.loli.net/2020/05/02/O8f6ePSNw4BWFph.png)\n\n至此，`IDE` 设置完成，我们的第一个项目也完工。\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","source":"_posts/java/introduction/java-ide.md","raw":"---\ntitle: 【Java入门篇】四、Java开发环境搭建——IDE\ntags:\n  - Java入门\n  - Java\n  - 环境搭建\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-01 22:33:05\n---\n\n> 不相信自己的人 连努力的价值都没有。 --《火影忍者》\n\n## 前言\n\n前面我们已经安装好了 `JDK` ，现在 `Java` 这款大型开放式沙盒游戏已经安装在我们的电脑里了，接下来我们就要准备学习如何玩这个游戏了。\n\n在入门阶段，我建议选择简单模式来进行，那么一个好的 `IDE` 是必不可少的。\n\n## 什么是IDE\n\n`IDE（integrated development enviroment）` 就是集成开发环境，是用于提供程序开发环境的应用程序，一般包括`代码编辑器`、`编译器`、`调试器`和`图形用户界面`等工具。集成了代码编写功能、分析功能、编译功能、调试功能等一体化的开发软件服务套。所有具备这一特性的软件或者软件套（组）都可以叫集成开发环境。\n\n简单来说， `IDE` 就是将一系列工具集成到了一个应用里，让你的开发之旅变得更加容易。\n\n## 为什么需要IDE\n\n很多老玩家在指导刚入坑的新手时，都喜欢循循善诱，教导新手使用 `文本编辑器` 而非 `IDE` ，这样可以提高对整个编译流程的理解。\n\n讲道理，确实是这样的，但是却将开发的复杂度增加了许多，对于新手而言，每增加一个步骤，就是增加了无数种失败的姿势，很多人的学习热情就消耗在了这种无关痛痒的小问题上，很容易产生挫败感，觉得这个游戏怎么这么难。\n\n所以我个人认为，`开局一条狗，砍到99`的打法并不适合每一个人，对于新手而言，先给一个`新手套装`，再来做任务会更加轻松。\n\n## 安装IDE\n\n接下来，我们去官网下载 `IDEA` ：`http://www.jetbrains.com/idea/`\n\n![java-ide-1.png](https://i.loli.net/2020/05/02/P2ZVXphwkvzrTqj.png)\n\n![java-ide-2.png](https://i.loli.net/2020/05/02/amnrtAJkhV87yqb.png)\n\n根据自己的系统进行选择安装即可，这里就不分系统进行介绍了，下载的时候，可以选 `ultimate` 版，也可以选 `community` 版，建议选择 `ultimate` 版。\n\n下载好以后安装，要激活码的时候可以看一看这个地址：`http://idea.lanyus.com/` 使用前请将“0.0.0.0 account.jetbrains.com”添加到 `hosts` 文件中，然后输入激活码就能成功激活了。当然，此方法仅供学习研究使用，有条件的盆友还是自觉购买正版产品吧。如果该方法已失效，则需要自行搜索[其它姿势](https://www.baidu.com/s?wd=idea%20%E6%BF%80%E6%B4%BB%E7%A0%81)了。\n\n安装的时候，所有的都按默认选项进行安装即可。\n\n## 新建项目\n\n然后开始我们的第一个新手任务——`HelloWorld`。\n\n![java-ide-3.png](https://i.loli.net/2020/05/02/IvMY16wh5pU9WNE.png)\n\n![java-ide-4.png](https://i.loli.net/2020/05/02/CrWpUA13NszeytF.png)\n\n![java-ide-5.png](https://i.loli.net/2020/05/02/qhDGHiVAOawZk9J.png)\n\n创建好以后，右键src文件夹，添加package，名字叫hello，然后在package里添加HelloWorld类\n\n![java-ide-6.png](https://i.loli.net/2020/05/02/MKGcT3CD7t2msRH.png)\n\n![java-ide-7.png](https://i.loli.net/2020/05/02/buyAFqTGB9QjEzU.png)\n\n![java-ide-8.png](https://i.loli.net/2020/05/02/nGU3f2zLcNHlXoT.png)\n\n然后在文件里放上代码：\n\n```java\npackage hello;\nimport java.lang.System;\n\npublic class HelloWorld {\n    public static void main(String[] args){\n        System.out.println(\"Hello World!\");\n    }\n}\n```\n\n点击 `Run` ，运行程序，选择 `HelloWorld` ，代码就跑起来了。\n\n![java-ide-9.png](https://i.loli.net/2020/05/02/O8f6ePSNw4BWFph.png)\n\n至此，`IDE` 设置完成，我们的第一个项目也完工。\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","slug":"java/introduction/java-ide","published":1,"updated":"2020-05-01T14:33:05.000Z","_id":"cl70rsfgo003p5ohu82hier9h","comments":1,"layout":"post","photos":[],"link":"","content":"<blockquote>\n<p>不相信自己的人 连努力的价值都没有。 –《火影忍者》</p>\n</blockquote>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>前面我们已经安装好了 <code>JDK</code> ，现在 <code>Java</code> 这款大型开放式沙盒游戏已经安装在我们的电脑里了，接下来我们就要准备学习如何玩这个游戏了。</p>\n<p>在入门阶段，我建议选择简单模式来进行，那么一个好的 <code>IDE</code> 是必不可少的。</p>\n<h2 id=\"什么是IDE\"><a href=\"#什么是IDE\" class=\"headerlink\" title=\"什么是IDE\"></a>什么是IDE</h2><p><code>IDE（integrated development enviroment）</code> 就是集成开发环境，是用于提供程序开发环境的应用程序，一般包括<code>代码编辑器</code>、<code>编译器</code>、<code>调试器</code>和<code>图形用户界面</code>等工具。集成了代码编写功能、分析功能、编译功能、调试功能等一体化的开发软件服务套。所有具备这一特性的软件或者软件套（组）都可以叫集成开发环境。</p>\n<p>简单来说， <code>IDE</code> 就是将一系列工具集成到了一个应用里，让你的开发之旅变得更加容易。</p>\n<h2 id=\"为什么需要IDE\"><a href=\"#为什么需要IDE\" class=\"headerlink\" title=\"为什么需要IDE\"></a>为什么需要IDE</h2><p>很多老玩家在指导刚入坑的新手时，都喜欢循循善诱，教导新手使用 <code>文本编辑器</code> 而非 <code>IDE</code> ，这样可以提高对整个编译流程的理解。</p>\n<p>讲道理，确实是这样的，但是却将开发的复杂度增加了许多，对于新手而言，每增加一个步骤，就是增加了无数种失败的姿势，很多人的学习热情就消耗在了这种无关痛痒的小问题上，很容易产生挫败感，觉得这个游戏怎么这么难。</p>\n<p>所以我个人认为，<code>开局一条狗，砍到99</code>的打法并不适合每一个人，对于新手而言，先给一个<code>新手套装</code>，再来做任务会更加轻松。</p>\n<h2 id=\"安装IDE\"><a href=\"#安装IDE\" class=\"headerlink\" title=\"安装IDE\"></a>安装IDE</h2><p>接下来，我们去官网下载 <code>IDEA</code> ：<code>http://www.jetbrains.com/idea/</code></p>\n<p><img src=\"https://i.loli.net/2020/05/02/P2ZVXphwkvzrTqj.png\" alt=\"java-ide-1.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/amnrtAJkhV87yqb.png\" alt=\"java-ide-2.png\"></p>\n<p>根据自己的系统进行选择安装即可，这里就不分系统进行介绍了，下载的时候，可以选 <code>ultimate</code> 版，也可以选 <code>community</code> 版，建议选择 <code>ultimate</code> 版。</p>\n<p>下载好以后安装，要激活码的时候可以看一看这个地址：<code>http://idea.lanyus.com/</code> 使用前请将“0.0.0.0 account.jetbrains.com”添加到 <code>hosts</code> 文件中，然后输入激活码就能成功激活了。当然，此方法仅供学习研究使用，有条件的盆友还是自觉购买正版产品吧。如果该方法已失效，则需要自行搜索<a href=\"https://www.baidu.com/s?wd=idea%20%E6%BF%80%E6%B4%BB%E7%A0%81\" target=\"_blank\" rel=\"noopener\">其它姿势</a>了。</p>\n<p>安装的时候，所有的都按默认选项进行安装即可。</p>\n<h2 id=\"新建项目\"><a href=\"#新建项目\" class=\"headerlink\" title=\"新建项目\"></a>新建项目</h2><p>然后开始我们的第一个新手任务——<code>HelloWorld</code>。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/IvMY16wh5pU9WNE.png\" alt=\"java-ide-3.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/CrWpUA13NszeytF.png\" alt=\"java-ide-4.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/qhDGHiVAOawZk9J.png\" alt=\"java-ide-5.png\"></p>\n<p>创建好以后，右键src文件夹，添加package，名字叫hello，然后在package里添加HelloWorld类</p>\n<p><img src=\"https://i.loli.net/2020/05/02/MKGcT3CD7t2msRH.png\" alt=\"java-ide-6.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/buyAFqTGB9QjEzU.png\" alt=\"java-ide-7.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/nGU3f2zLcNHlXoT.png\" alt=\"java-ide-8.png\"></p>\n<p>然后在文件里放上代码：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> hello<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span>System<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HelloWorld</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>点击 <code>Run</code> ，运行程序，选择 <code>HelloWorld</code> ，代码就跑起来了。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/O8f6ePSNw4BWFph.png\" alt=\"java-ide-9.png\"></p>\n<p>至此，<code>IDE</code> 设置完成，我们的第一个项目也完工。</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>不相信自己的人 连努力的价值都没有。 –《火影忍者》</p>\n</blockquote>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>前面我们已经安装好了 <code>JDK</code> ，现在 <code>Java</code> 这款大型开放式沙盒游戏已经安装在我们的电脑里了，接下来我们就要准备学习如何玩这个游戏了。</p>\n<p>在入门阶段，我建议选择简单模式来进行，那么一个好的 <code>IDE</code> 是必不可少的。</p>\n<h2 id=\"什么是IDE\"><a href=\"#什么是IDE\" class=\"headerlink\" title=\"什么是IDE\"></a>什么是IDE</h2><p><code>IDE（integrated development enviroment）</code> 就是集成开发环境，是用于提供程序开发环境的应用程序，一般包括<code>代码编辑器</code>、<code>编译器</code>、<code>调试器</code>和<code>图形用户界面</code>等工具。集成了代码编写功能、分析功能、编译功能、调试功能等一体化的开发软件服务套。所有具备这一特性的软件或者软件套（组）都可以叫集成开发环境。</p>\n<p>简单来说， <code>IDE</code> 就是将一系列工具集成到了一个应用里，让你的开发之旅变得更加容易。</p>\n<h2 id=\"为什么需要IDE\"><a href=\"#为什么需要IDE\" class=\"headerlink\" title=\"为什么需要IDE\"></a>为什么需要IDE</h2><p>很多老玩家在指导刚入坑的新手时，都喜欢循循善诱，教导新手使用 <code>文本编辑器</code> 而非 <code>IDE</code> ，这样可以提高对整个编译流程的理解。</p>\n<p>讲道理，确实是这样的，但是却将开发的复杂度增加了许多，对于新手而言，每增加一个步骤，就是增加了无数种失败的姿势，很多人的学习热情就消耗在了这种无关痛痒的小问题上，很容易产生挫败感，觉得这个游戏怎么这么难。</p>\n<p>所以我个人认为，<code>开局一条狗，砍到99</code>的打法并不适合每一个人，对于新手而言，先给一个<code>新手套装</code>，再来做任务会更加轻松。</p>\n<h2 id=\"安装IDE\"><a href=\"#安装IDE\" class=\"headerlink\" title=\"安装IDE\"></a>安装IDE</h2><p>接下来，我们去官网下载 <code>IDEA</code> ：<code>http://www.jetbrains.com/idea/</code></p>\n<p><img src=\"https://i.loli.net/2020/05/02/P2ZVXphwkvzrTqj.png\" alt=\"java-ide-1.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/amnrtAJkhV87yqb.png\" alt=\"java-ide-2.png\"></p>\n<p>根据自己的系统进行选择安装即可，这里就不分系统进行介绍了，下载的时候，可以选 <code>ultimate</code> 版，也可以选 <code>community</code> 版，建议选择 <code>ultimate</code> 版。</p>\n<p>下载好以后安装，要激活码的时候可以看一看这个地址：<code>http://idea.lanyus.com/</code> 使用前请将“0.0.0.0 account.jetbrains.com”添加到 <code>hosts</code> 文件中，然后输入激活码就能成功激活了。当然，此方法仅供学习研究使用，有条件的盆友还是自觉购买正版产品吧。如果该方法已失效，则需要自行搜索<a href=\"https://www.baidu.com/s?wd=idea%20%E6%BF%80%E6%B4%BB%E7%A0%81\" target=\"_blank\" rel=\"noopener\">其它姿势</a>了。</p>\n<p>安装的时候，所有的都按默认选项进行安装即可。</p>\n<h2 id=\"新建项目\"><a href=\"#新建项目\" class=\"headerlink\" title=\"新建项目\"></a>新建项目</h2><p>然后开始我们的第一个新手任务——<code>HelloWorld</code>。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/IvMY16wh5pU9WNE.png\" alt=\"java-ide-3.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/CrWpUA13NszeytF.png\" alt=\"java-ide-4.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/qhDGHiVAOawZk9J.png\" alt=\"java-ide-5.png\"></p>\n<p>创建好以后，右键src文件夹，添加package，名字叫hello，然后在package里添加HelloWorld类</p>\n<p><img src=\"https://i.loli.net/2020/05/02/MKGcT3CD7t2msRH.png\" alt=\"java-ide-6.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/buyAFqTGB9QjEzU.png\" alt=\"java-ide-7.png\"></p>\n<p><img src=\"https://i.loli.net/2020/05/02/nGU3f2zLcNHlXoT.png\" alt=\"java-ide-8.png\"></p>\n<p>然后在文件里放上代码：</p>\n<pre><code class=\"java\">package hello;\nimport java.lang.System;\n\npublic class HelloWorld {\n    public static void main(String[] args){\n        System.out.println(&quot;Hello World!&quot;);\n    }\n}</code></pre>\n<p>点击 <code>Run</code> ，运行程序，选择 <code>HelloWorld</code> ，代码就跑起来了。</p>\n<p><img src=\"https://i.loli.net/2020/05/02/O8f6ePSNw4BWFph.png\" alt=\"java-ide-9.png\"></p>\n<p>至此，<code>IDE</code> 设置完成，我们的第一个项目也完工。</p>\n"},{"title":"【Java入门篇】六、Java简单示例","toc":true,"date":"2020-05-01T14:33:07.000Z","_content":"\n> 人都有两面，一面天使，一面恶魔\n\n## 前言\n\n为了统一风格，也为了增加趣味性，以后的文章都会以关卡的形式进行展示，这样也能让大家明确每一篇的目标，带着目的来阅读会更有方向感。\n\n之前已经写过了 `Hello World`，所以这次就换一个吧，这次的小目标便是——`Java简易版计算器`。\n\n## 功能说明\n\n第一版的 `Java` 计算器仅需要支持加法运算，用户输入两个数字，然后输出它们的和。\n\n## 方法预习\n\n如果是刚开始接触编程，也许你会毫无头绪，莫方，这是很正常的现象，因为你对于如何与计算机尤其是命令行进行交互毫无头绪。\n\n所以在开始编码前，需要先预习一些必要的知识。\n\n### 输出信息\n\n先来认识一个方法 `System.out.println()`，这个方法会将你传入的信息输出到`控制台`中，emmm，什么是`控制台`？你运行程序后出现的那个黑不拉几的东西就叫做`控制台`，它是我们与计算机交互的一个最简单原始的方式。\n\n来试验一下，还记得如何用 `idea` 创建一个类吗？不记得的话翻看一下[这里](../java-ide)。\n\n这次我们继续在 `hello` 包下面创建一个类叫做 `PrintTest` ，然后添加以下方法：\n\n```java\npackage hello;\n\npublic class PrintTest {\n    public static void main(String[] args){\n        System.out.println(\"输出测试\");\n    }\n}\n```\n\n然后我们点击运行，或者按键（`ctrl+shift+R`），就能看到下面的输出了：\n\n![java-simple-example-1.png](https://i.loli.net/2020/05/02/7tNkXUYGDI9bAo8.png)\n\n先不要问这个 `System` 是个什么东西，只要知道这样可以输出一行信息就行了，需要注意的是这个方法默认会在末尾加一个换行符，如果想要不换行，可以试试 `System.out.print() `。\n\n### 输入信息\n\n上面已经说过如何输出信息了，现在来看看如何输入信息并进行读取。\n\n先来认识一下 `Scanner` 类，`Scanner` 类是用来从各种输入源读取信息的，它可以从各种输入源中读取信息，最常用的当然就是控制台输入。\n\n那如何用 `Scanner` 读取控制台的输入呢？这就要用到 `System.in` 了，来看栗子，我们再新建一个 `InputTest` 类：\n\n```java\npackage hello;\n\nimport java.util.Scanner;\n\npublic class InputTest {\n    public static void main(String[] args){\n        Scanner in = new Scanner(System.in);\n        System.out.print(\"请输入一个整数:\");\n        int a = in.nextInt();\n        System.out.println(\"刚才输入的整数为：\" + a);\n    }\n}\n```\n\n然后再运行一下，并且输入一个数字然后按回车键，这里我输入的是20：\n\n![java-simple-example-2.png](https://i.loli.net/2020/05/02/LlMGZuJ1C6SgvUm.png)\n\n如果对于具体的细节还不清楚，没有关系，先照做就好了。\n\n## 代码编写\n\n那么接下来就开始设计这个最简单的计算器了，首先我们要提示用户输入一个整数，就像上面那样：\n\n```java\nSystem.out.print(\"请输入一个整数:\");\n```\n\n然后用一个 `int` 变量来存储，什么？不知道变量是干嘛的？没事，你可以先把它当做一个盒子，用来把用户输入的信息存放进去。\n\n```java\nScanner in = new Scanner(System.in);\nint a = in.nextInt();\n```\n\n然后提示用户再输入一个整数：\n\n```java\nSystem.out.print(\"请输入另一个整数:\");\n```\n\n然后再用一个 `int` 变量来存储。\n\n```java\nint b = in.nextInt();\n```\n\n接下来计算两者的和，并存到第三个变量中：\n\n```java\nint sum = a + b;\n```\n\n最后输出这个和：\n\n```java\nSystem.out.print(\"这两个数的和为:\" + sum);\n```\n\n所以整体代码如下：\n\n```java\npackage hello;\n\nimport java.util.Scanner;\n\npublic class SimpleCalculator {\n    public static void main(String[] args){\n        System.out.print(\"请输入一个整数:\");\n        Scanner in = new Scanner(System.in);\n        int a = in.nextInt();\n        System.out.print(\"请再输入一个整数:\");\n        int b = in.nextInt();\n        int sum = a + b;\n        System.out.print(\"这两个数的和为:\" + sum);\n    }\n}\n```\n\n输出如下：\n\n![java-simple-example-3.png](https://i.loli.net/2020/05/02/apKXJ3bZmunBSW9.png)\n\n这样，我们的简易版计算器就完成了。虽然简单，但还是建议你在自己电脑上实现一次，看代码和写代码是完全不一样的两种体验。\n\n回顾一下本篇，我们设计了一个类`SimpleCalculator`，并编写了一个main方法，并在里面完成了简易版计算器的逻辑设计。也许你对于自己写的东西还有很多疑问，对象是什么？类又是什么含义？Scanner还可以做什么？前面的package有什么作用，import又是在干嘛？别着急，接着看后面的文章，相信你的疑问会一点一点消失。\n\n## 练习题\n\n1. 写一个支持减法的计算器。\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","source":"_posts/java/introduction/java-simple-example.md","raw":"---\ntitle: 【Java入门篇】六、Java简单示例\ntags:\n  - Java入门\n  - Java\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-01 22:33:07\n---\n\n> 人都有两面，一面天使，一面恶魔\n\n## 前言\n\n为了统一风格，也为了增加趣味性，以后的文章都会以关卡的形式进行展示，这样也能让大家明确每一篇的目标，带着目的来阅读会更有方向感。\n\n之前已经写过了 `Hello World`，所以这次就换一个吧，这次的小目标便是——`Java简易版计算器`。\n\n## 功能说明\n\n第一版的 `Java` 计算器仅需要支持加法运算，用户输入两个数字，然后输出它们的和。\n\n## 方法预习\n\n如果是刚开始接触编程，也许你会毫无头绪，莫方，这是很正常的现象，因为你对于如何与计算机尤其是命令行进行交互毫无头绪。\n\n所以在开始编码前，需要先预习一些必要的知识。\n\n### 输出信息\n\n先来认识一个方法 `System.out.println()`，这个方法会将你传入的信息输出到`控制台`中，emmm，什么是`控制台`？你运行程序后出现的那个黑不拉几的东西就叫做`控制台`，它是我们与计算机交互的一个最简单原始的方式。\n\n来试验一下，还记得如何用 `idea` 创建一个类吗？不记得的话翻看一下[这里](../java-ide)。\n\n这次我们继续在 `hello` 包下面创建一个类叫做 `PrintTest` ，然后添加以下方法：\n\n```java\npackage hello;\n\npublic class PrintTest {\n    public static void main(String[] args){\n        System.out.println(\"输出测试\");\n    }\n}\n```\n\n然后我们点击运行，或者按键（`ctrl+shift+R`），就能看到下面的输出了：\n\n![java-simple-example-1.png](https://i.loli.net/2020/05/02/7tNkXUYGDI9bAo8.png)\n\n先不要问这个 `System` 是个什么东西，只要知道这样可以输出一行信息就行了，需要注意的是这个方法默认会在末尾加一个换行符，如果想要不换行，可以试试 `System.out.print() `。\n\n### 输入信息\n\n上面已经说过如何输出信息了，现在来看看如何输入信息并进行读取。\n\n先来认识一下 `Scanner` 类，`Scanner` 类是用来从各种输入源读取信息的，它可以从各种输入源中读取信息，最常用的当然就是控制台输入。\n\n那如何用 `Scanner` 读取控制台的输入呢？这就要用到 `System.in` 了，来看栗子，我们再新建一个 `InputTest` 类：\n\n```java\npackage hello;\n\nimport java.util.Scanner;\n\npublic class InputTest {\n    public static void main(String[] args){\n        Scanner in = new Scanner(System.in);\n        System.out.print(\"请输入一个整数:\");\n        int a = in.nextInt();\n        System.out.println(\"刚才输入的整数为：\" + a);\n    }\n}\n```\n\n然后再运行一下，并且输入一个数字然后按回车键，这里我输入的是20：\n\n![java-simple-example-2.png](https://i.loli.net/2020/05/02/LlMGZuJ1C6SgvUm.png)\n\n如果对于具体的细节还不清楚，没有关系，先照做就好了。\n\n## 代码编写\n\n那么接下来就开始设计这个最简单的计算器了，首先我们要提示用户输入一个整数，就像上面那样：\n\n```java\nSystem.out.print(\"请输入一个整数:\");\n```\n\n然后用一个 `int` 变量来存储，什么？不知道变量是干嘛的？没事，你可以先把它当做一个盒子，用来把用户输入的信息存放进去。\n\n```java\nScanner in = new Scanner(System.in);\nint a = in.nextInt();\n```\n\n然后提示用户再输入一个整数：\n\n```java\nSystem.out.print(\"请输入另一个整数:\");\n```\n\n然后再用一个 `int` 变量来存储。\n\n```java\nint b = in.nextInt();\n```\n\n接下来计算两者的和，并存到第三个变量中：\n\n```java\nint sum = a + b;\n```\n\n最后输出这个和：\n\n```java\nSystem.out.print(\"这两个数的和为:\" + sum);\n```\n\n所以整体代码如下：\n\n```java\npackage hello;\n\nimport java.util.Scanner;\n\npublic class SimpleCalculator {\n    public static void main(String[] args){\n        System.out.print(\"请输入一个整数:\");\n        Scanner in = new Scanner(System.in);\n        int a = in.nextInt();\n        System.out.print(\"请再输入一个整数:\");\n        int b = in.nextInt();\n        int sum = a + b;\n        System.out.print(\"这两个数的和为:\" + sum);\n    }\n}\n```\n\n输出如下：\n\n![java-simple-example-3.png](https://i.loli.net/2020/05/02/apKXJ3bZmunBSW9.png)\n\n这样，我们的简易版计算器就完成了。虽然简单，但还是建议你在自己电脑上实现一次，看代码和写代码是完全不一样的两种体验。\n\n回顾一下本篇，我们设计了一个类`SimpleCalculator`，并编写了一个main方法，并在里面完成了简易版计算器的逻辑设计。也许你对于自己写的东西还有很多疑问，对象是什么？类又是什么含义？Scanner还可以做什么？前面的package有什么作用，import又是在干嘛？别着急，接着看后面的文章，相信你的疑问会一点一点消失。\n\n## 练习题\n\n1. 写一个支持减法的计算器。\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","slug":"java/introduction/java-simple-example","published":1,"updated":"2020-05-01T14:33:07.000Z","_id":"cl70rsfgt003s5ohu207s65n8","comments":1,"layout":"post","photos":[],"link":"","content":"<blockquote>\n<p>人都有两面，一面天使，一面恶魔</p>\n</blockquote>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>为了统一风格，也为了增加趣味性，以后的文章都会以关卡的形式进行展示，这样也能让大家明确每一篇的目标，带着目的来阅读会更有方向感。</p>\n<p>之前已经写过了 <code>Hello World</code>，所以这次就换一个吧，这次的小目标便是——<code>Java简易版计算器</code>。</p>\n<h2 id=\"功能说明\"><a href=\"#功能说明\" class=\"headerlink\" title=\"功能说明\"></a>功能说明</h2><p>第一版的 <code>Java</code> 计算器仅需要支持加法运算，用户输入两个数字，然后输出它们的和。</p>\n<h2 id=\"方法预习\"><a href=\"#方法预习\" class=\"headerlink\" title=\"方法预习\"></a>方法预习</h2><p>如果是刚开始接触编程，也许你会毫无头绪，莫方，这是很正常的现象，因为你对于如何与计算机尤其是命令行进行交互毫无头绪。</p>\n<p>所以在开始编码前，需要先预习一些必要的知识。</p>\n<h3 id=\"输出信息\"><a href=\"#输出信息\" class=\"headerlink\" title=\"输出信息\"></a>输出信息</h3><p>先来认识一个方法 <code>System.out.println()</code>，这个方法会将你传入的信息输出到<code>控制台</code>中，emmm，什么是<code>控制台</code>？你运行程序后出现的那个黑不拉几的东西就叫做<code>控制台</code>，它是我们与计算机交互的一个最简单原始的方式。</p>\n<p>来试验一下，还记得如何用 <code>idea</code> 创建一个类吗？不记得的话翻看一下<a href=\"../java-ide\">这里</a>。</p>\n<p>这次我们继续在 <code>hello</code> 包下面创建一个类叫做 <code>PrintTest</code> ，然后添加以下方法：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> hello<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PrintTest</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"输出测试\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>然后我们点击运行，或者按键（<code>ctrl+shift+R</code>），就能看到下面的输出了：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/7tNkXUYGDI9bAo8.png\" alt=\"java-simple-example-1.png\"></p>\n<p>先不要问这个 <code>System</code> 是个什么东西，只要知道这样可以输出一行信息就行了，需要注意的是这个方法默认会在末尾加一个换行符，如果想要不换行，可以试试 <code>System.out.print()</code>。</p>\n<h3 id=\"输入信息\"><a href=\"#输入信息\" class=\"headerlink\" title=\"输入信息\"></a>输入信息</h3><p>上面已经说过如何输出信息了，现在来看看如何输入信息并进行读取。</p>\n<p>先来认识一下 <code>Scanner</code> 类，<code>Scanner</code> 类是用来从各种输入源读取信息的，它可以从各种输入源中读取信息，最常用的当然就是控制台输入。</p>\n<p>那如何用 <code>Scanner</code> 读取控制台的输入呢？这就要用到 <code>System.in</code> 了，来看栗子，我们再新建一个 <code>InputTest</code> 类：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> hello<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>Scanner<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">InputTest</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        Scanner in <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入一个整数:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"刚才输入的整数为：\"</span> <span class=\"token operator\">+</span> a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>然后再运行一下，并且输入一个数字然后按回车键，这里我输入的是20：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/LlMGZuJ1C6SgvUm.png\" alt=\"java-simple-example-2.png\"></p>\n<p>如果对于具体的细节还不清楚，没有关系，先照做就好了。</p>\n<h2 id=\"代码编写\"><a href=\"#代码编写\" class=\"headerlink\" title=\"代码编写\"></a>代码编写</h2><p>那么接下来就开始设计这个最简单的计算器了，首先我们要提示用户输入一个整数，就像上面那样：</p>\n<pre class=\" language-java\"><code class=\"language-java\">System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入一个整数:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>然后用一个 <code>int</code> 变量来存储，什么？不知道变量是干嘛的？没事，你可以先把它当做一个盒子，用来把用户输入的信息存放进去。</p>\n<pre class=\" language-java\"><code class=\"language-java\">Scanner in <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>然后提示用户再输入一个整数：</p>\n<pre class=\" language-java\"><code class=\"language-java\">System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入另一个整数:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>然后再用一个 <code>int</code> 变量来存储。</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">int</span> b <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>接下来计算两者的和，并存到第三个变量中：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">int</span> sum <span class=\"token operator\">=</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span></code></pre>\n<p>最后输出这个和：</p>\n<pre class=\" language-java\"><code class=\"language-java\">System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"这两个数的和为:\"</span> <span class=\"token operator\">+</span> sum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>所以整体代码如下：</p>\n<pre class=\" language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> hello<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>Scanner<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SimpleCalculator</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请输入一个整数:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        Scanner in <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请再输入一个整数:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> b <span class=\"token operator\">=</span> in<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> sum <span class=\"token operator\">=</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"这两个数的和为:\"</span> <span class=\"token operator\">+</span> sum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>输出如下：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/apKXJ3bZmunBSW9.png\" alt=\"java-simple-example-3.png\"></p>\n<p>这样，我们的简易版计算器就完成了。虽然简单，但还是建议你在自己电脑上实现一次，看代码和写代码是完全不一样的两种体验。</p>\n<p>回顾一下本篇，我们设计了一个类<code>SimpleCalculator</code>，并编写了一个main方法，并在里面完成了简易版计算器的逻辑设计。也许你对于自己写的东西还有很多疑问，对象是什么？类又是什么含义？Scanner还可以做什么？前面的package有什么作用，import又是在干嘛？别着急，接着看后面的文章，相信你的疑问会一点一点消失。</p>\n<h2 id=\"练习题\"><a href=\"#练习题\" class=\"headerlink\" title=\"练习题\"></a>练习题</h2><ol>\n<li>写一个支持减法的计算器。</li>\n</ol>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>人都有两面，一面天使，一面恶魔</p>\n</blockquote>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>为了统一风格，也为了增加趣味性，以后的文章都会以关卡的形式进行展示，这样也能让大家明确每一篇的目标，带着目的来阅读会更有方向感。</p>\n<p>之前已经写过了 <code>Hello World</code>，所以这次就换一个吧，这次的小目标便是——<code>Java简易版计算器</code>。</p>\n<h2 id=\"功能说明\"><a href=\"#功能说明\" class=\"headerlink\" title=\"功能说明\"></a>功能说明</h2><p>第一版的 <code>Java</code> 计算器仅需要支持加法运算，用户输入两个数字，然后输出它们的和。</p>\n<h2 id=\"方法预习\"><a href=\"#方法预习\" class=\"headerlink\" title=\"方法预习\"></a>方法预习</h2><p>如果是刚开始接触编程，也许你会毫无头绪，莫方，这是很正常的现象，因为你对于如何与计算机尤其是命令行进行交互毫无头绪。</p>\n<p>所以在开始编码前，需要先预习一些必要的知识。</p>\n<h3 id=\"输出信息\"><a href=\"#输出信息\" class=\"headerlink\" title=\"输出信息\"></a>输出信息</h3><p>先来认识一个方法 <code>System.out.println()</code>，这个方法会将你传入的信息输出到<code>控制台</code>中，emmm，什么是<code>控制台</code>？你运行程序后出现的那个黑不拉几的东西就叫做<code>控制台</code>，它是我们与计算机交互的一个最简单原始的方式。</p>\n<p>来试验一下，还记得如何用 <code>idea</code> 创建一个类吗？不记得的话翻看一下<a href=\"../java-ide\">这里</a>。</p>\n<p>这次我们继续在 <code>hello</code> 包下面创建一个类叫做 <code>PrintTest</code> ，然后添加以下方法：</p>\n<pre><code class=\"java\">package hello;\n\npublic class PrintTest {\n    public static void main(String[] args){\n        System.out.println(&quot;输出测试&quot;);\n    }\n}</code></pre>\n<p>然后我们点击运行，或者按键（<code>ctrl+shift+R</code>），就能看到下面的输出了：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/7tNkXUYGDI9bAo8.png\" alt=\"java-simple-example-1.png\"></p>\n<p>先不要问这个 <code>System</code> 是个什么东西，只要知道这样可以输出一行信息就行了，需要注意的是这个方法默认会在末尾加一个换行符，如果想要不换行，可以试试 <code>System.out.print()</code>。</p>\n<h3 id=\"输入信息\"><a href=\"#输入信息\" class=\"headerlink\" title=\"输入信息\"></a>输入信息</h3><p>上面已经说过如何输出信息了，现在来看看如何输入信息并进行读取。</p>\n<p>先来认识一下 <code>Scanner</code> 类，<code>Scanner</code> 类是用来从各种输入源读取信息的，它可以从各种输入源中读取信息，最常用的当然就是控制台输入。</p>\n<p>那如何用 <code>Scanner</code> 读取控制台的输入呢？这就要用到 <code>System.in</code> 了，来看栗子，我们再新建一个 <code>InputTest</code> 类：</p>\n<pre><code class=\"java\">package hello;\n\nimport java.util.Scanner;\n\npublic class InputTest {\n    public static void main(String[] args){\n        Scanner in = new Scanner(System.in);\n        System.out.print(&quot;请输入一个整数:&quot;);\n        int a = in.nextInt();\n        System.out.println(&quot;刚才输入的整数为：&quot; + a);\n    }\n}</code></pre>\n<p>然后再运行一下，并且输入一个数字然后按回车键，这里我输入的是20：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/LlMGZuJ1C6SgvUm.png\" alt=\"java-simple-example-2.png\"></p>\n<p>如果对于具体的细节还不清楚，没有关系，先照做就好了。</p>\n<h2 id=\"代码编写\"><a href=\"#代码编写\" class=\"headerlink\" title=\"代码编写\"></a>代码编写</h2><p>那么接下来就开始设计这个最简单的计算器了，首先我们要提示用户输入一个整数，就像上面那样：</p>\n<pre><code class=\"java\">System.out.print(&quot;请输入一个整数:&quot;);</code></pre>\n<p>然后用一个 <code>int</code> 变量来存储，什么？不知道变量是干嘛的？没事，你可以先把它当做一个盒子，用来把用户输入的信息存放进去。</p>\n<pre><code class=\"java\">Scanner in = new Scanner(System.in);\nint a = in.nextInt();</code></pre>\n<p>然后提示用户再输入一个整数：</p>\n<pre><code class=\"java\">System.out.print(&quot;请输入另一个整数:&quot;);</code></pre>\n<p>然后再用一个 <code>int</code> 变量来存储。</p>\n<pre><code class=\"java\">int b = in.nextInt();</code></pre>\n<p>接下来计算两者的和，并存到第三个变量中：</p>\n<pre><code class=\"java\">int sum = a + b;</code></pre>\n<p>最后输出这个和：</p>\n<pre><code class=\"java\">System.out.print(&quot;这两个数的和为:&quot; + sum);</code></pre>\n<p>所以整体代码如下：</p>\n<pre><code class=\"java\">package hello;\n\nimport java.util.Scanner;\n\npublic class SimpleCalculator {\n    public static void main(String[] args){\n        System.out.print(&quot;请输入一个整数:&quot;);\n        Scanner in = new Scanner(System.in);\n        int a = in.nextInt();\n        System.out.print(&quot;请再输入一个整数:&quot;);\n        int b = in.nextInt();\n        int sum = a + b;\n        System.out.print(&quot;这两个数的和为:&quot; + sum);\n    }\n}</code></pre>\n<p>输出如下：</p>\n<p><img src=\"https://i.loli.net/2020/05/02/apKXJ3bZmunBSW9.png\" alt=\"java-simple-example-3.png\"></p>\n<p>这样，我们的简易版计算器就完成了。虽然简单，但还是建议你在自己电脑上实现一次，看代码和写代码是完全不一样的两种体验。</p>\n<p>回顾一下本篇，我们设计了一个类<code>SimpleCalculator</code>，并编写了一个main方法，并在里面完成了简易版计算器的逻辑设计。也许你对于自己写的东西还有很多疑问，对象是什么？类又是什么含义？Scanner还可以做什么？前面的package有什么作用，import又是在干嘛？别着急，接着看后面的文章，相信你的疑问会一点一点消失。</p>\n<h2 id=\"练习题\"><a href=\"#练习题\" class=\"headerlink\" title=\"练习题\"></a>练习题</h2><ol>\n<li>写一个支持减法的计算器。</li>\n</ol>\n"},{"title":"【Java入门篇】起航","toc":true,"date":"2020-05-01T14:33:01.000Z","_content":"\n> 最害怕的东西，最应该去突破\n\n## 初衷\n\n之前博主在[博客园](http://www.cnblogs.com/mfrank/)已经陆续发了几十篇文章，但总体并没有一个很好的串联，在内容编排上也存在许多问题，因此特地将之前的文章做一个整理。\n\n一是将原有文章进行润色，让表达更加生动清晰，二是尽可能的将各个知识点连接成线，整理出自己的一套体系，并剔除其中的错误。\n\n本系列文章不会鼓吹Java怎么怎么好，也不打算尝试怂恿那些在Java边缘徘徊的人来学习Java，只想根据自己的学习经验来给那些想要学习Java却不得其法的人提供一点自己的经验和看法。\n\n`Java 入门篇` 是为零基础的人准备的，内容不多，主要包括环境搭建、IDE设置和使用等方面的介绍，最后会以一个简单的程序结束本篇。\n\n通过本篇的学习，你可以掌握以下内容：\n\n* 如何搭建 Java 开发环境\n* 如何使用 IDEA 进行开发\n* 完成简单的 Java 代码\n\n## 编程的世界观\n\n编程写代码其实跟玩游戏很相似，不断学习，不断提升，然后写代码来完成各种工作，就跟打怪升级，赚钱买装备，最终打倒BOSS是一样的。\n\n每一款好的游戏都有一个较为统一完整的世界观，也会有一个统一的背景设定，你需要先接受和理解这个设定的背景，然后慢慢了解这个游戏的完整世界观，这样才能真正融入这个游戏。\n\n比如说，`《剑网3》`的世界观设计一直遵循“纯武侠，真江湖”设计，背景设定便是唐宋时期，武林纷争，各大门派先后崛起，而你出身草芥，通过自己的努力，不断完成各种新手任务来提升等级，然后加入门派，再通过不断升级武器装备、完成各种副本来提升自我。\n\n又比如`《饥荒》`这款游戏，是关于一名科学家被恶魔传送到了异世界荒野的故事，游戏的主题是生存，所以你的目标是尽可能的利用各种资源来存活更长时间，同时要抵御各种外来威胁来保证自己的安全。\n\n如果把编程开发也比作游戏的话，它更像是《我的世界》这样的自由度很高的沙盒游戏。有的人会将《我的世界》玩成一款生存游戏，享受被僵尸追杀的快感，有人会将它玩成一款建筑游戏，打造属于自己的王国。带着不同的目的人，会有完全不同的游戏体验。\n\n编程也是如此，在编程的世界里，你拥有的是一个万能工厂，而你是一位工程师，在这里你可以生产出任何产品，汽车、轮船、火箭，如果你足够厉害，甚至可以创造一个新的世界，所有你需要做的，便是给出合格的设计图，接下来的事情，交给这个`万能工厂`就好了。\n\n每个人拥有这个`万能工厂`的人都有着不同的目的，有的人只是为了参观，有的人是为了制作出性能强悍的跑车，有的人是为了制作自己用的小玩具，而有的人只是为了用它来谋生。不同的目的就会有完全不同的前进方向，也会有完全不同的体验，有的人会觉得枯燥，有的人会觉得无聊，而有的人却会感觉激情四射，爱不释手。如果你能真正体会到其中的乐趣，那么你一定会爱上这个工厂。\n\n但做出一张好的`设计图`并不是一件简单的事情，所以你需要不断的学习它的规范，设计出符合规范的`设计图`，才能使用这个`万能工厂`正确生产出你想要的产品。\n\n等到你真正掌握了这个规范，就会发现，只满足于正确性还远远不够，于是渐渐的会开始追求效率和美感。为了提高设计效率，前辈们已经总结出很多种`设计模式`，适用于不同的应用场景，掌握了它们，在设计产品的时候便能更加随心所欲。\n\n而关于编程美学，也是一门用经验堆积起来的学问。毕竟，作为工程师的我们，需要与其他工程师不断交流切磋，我们会观摩欣赏别人的`设计图`，也会把自己的`设计图`和别人探讨。所以`设计图`不仅仅是为了给这个万能工厂来运转，也是为了阅读。\n\n当然，这都是后话了。\n\n## Java编程的世界观\n\n`Java` 是一门`高级编程语言`，所谓的高级，是相对于汇编等`机器语言`而言的，有更高层次的抽象，更加接近自然语言和数学公式，基本脱离了机器的硬件系统。\n\n前面说到，每种编程语言都是一个`万能工厂`，`Java` 也有一个`万能工厂`。不同语言代表的不同工厂有着各自的擅长领域。\n\n目前来说，`Java` 的主流应用领域便是 `Web/APP后端开发` 、`嵌入式设备` 、`大数据` 、`安卓开发` ，当然，`Java` 也可以开发桌面应用程序，也可以写游戏，但那些并不是 `Java` 擅长的领域。就像你可以用菜刀砍树，用斧头切菜一样，可以做，但是会有些别扭，有其他更好用的工具为什么要选择这样蹩脚的方式呢。\n\n不要忘了你的目标，如果你是为了探索和享受其中的乐趣，那可以尽管去做。如果是为了完成某项功能，那请别忘了，这些工厂都只是一个工具而已，你的最终目的是实现你的要的功能。\n\n> 吾生也有涯，而知也无涯。以有涯随无涯，殆已！\n\n简单来说，不管黑猫白猫，能抓住耗子的猫就是好猫。\n\n所以对待各种编程语言，首先要保持理智和克制，他们都只是一个工具，通常来说，我们的目的是为了解决问题，不要陷入对某种语言的盲目崇拜的陷阱里，脱离场景而进行语言之间的对比是毫无意义的。\n\n`Java` 有很多开发方向，本系列文章将主要以 `JavaWeb` 开发为目标进行探索，利用 `Java` 这个大工厂来开发网站后端应用，为我们的前台页面提供强劲稳定的功能支持。\n\n相对于桌面开发而言，`JavaWeb` 开发更多的时候开发出的产品是默默的在后台工作的，需要通过前台 `html` 页面或者 `手机app`，亦或是 `桌面app` 才能进行间接的交互。\n\n比如你打开淘宝，看到的那些页面架构和好看的图片大都是前端和UI的功劳，而你看到的那些文字和数字内容，大都是后端的数据驱动的成果。（当然，现在可能更多的功劳又要归功于基于大数据的推荐系统了）\n\n但不要因此而觉得 `Java` 后端开发很无聊，其实一个网站的后端就像一个程序的大脑，绝大部分的数据逻辑处理是由后端完成的，不仅要负责对数据进行处理，还需要跟数据库，各种消息中间件打交道，利用各种算法来实现特定的功能。\n\n前端则负责展示处理后的结果，并做出相应的响应，是一个应用的门面。前端侧重展示和交互，后端侧重程序的逻辑，都是为了提供更好的用户体验，只是着力点不一样而已。\n\n`Java` 这个大工厂能量无穷，想要完全掌控它的妙用需要一段较长的修炼时间，毕竟想要设计一张足够精巧的设计图纸并不是一件简单的事情，所以需要不断的学习。\n\n这个过程难免会遇到挫折和困难，其中很多坑对于新手而言是致命的，最简单的比如环境安装，很多人的兴趣就是夭折在环境的折腾上。其实很多坑，早有无数人踩过，也有很多人在网上分享过相关的解决办法，所以当你遇到问题的时候，可以先上百度找找，你要相信一定有人遇到过同样的问题，如果没找到，想想换个姿势搜索。\n\n当然也许苦苦搜寻之后，还是无法解决你的问题，这时候，来自共同学习的小伙伴的支持就显得弥足珍贵了，为此，博主创建了一个QQ群【529253292】，这里也许可以找到你想要的答案。\n\n`Java` 的学习深造过程，就像是升级打怪过关卡，每个知识点都有些小boss，把它们打倒后便能获得相应的经验值，可以提升你的等级，但是随着你的等级的提升，这些小怪小boss对你的修炼的帮助已经聊胜于无了，于是你需要进行更艰难的修炼，去挑战更厉害的boss。\n\n## 起航\n\n在这个世界里，自由度很大，大到也许会让刚接触的你迷失方向，不知所措。所以本系列文章将会提供给你一条前往 `JavaWeb` 开发的修炼道路，虽然并不一定是最优路线，但至少总体方向不会错，如果你刚好想往这个方向发展，那么本系列文章将会给你提供一些帮助。注意，本系列文章主张的是夯实基础，先修炼内功，然后再修炼外功，所以如果你想要的是捷径，想要知道如何在一两个月之内找到工作，那么这个系列文章可能不太适合你。\n\n当你的经验累积到一定的值时，就能获得相应的头衔，在 `JavaWeb` 的发展中主要有两条升级路线，一条是技术路线，一条是管理路线，大致就像这样:\n\n![java-started-1.png](https://i.loli.net/2020/05/02/SkyFbiuZjdQTOaW.png)\n\n两条路线的升级加点方式不太一样，但是都是当技术积累到一定程度后才能选择不同的升级路线。\n\n所以，年轻的勇士，不要犹豫了，拿起你的桃木剑，在 `Java` 这个世界探索出自己的道路吧！\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","source":"_posts/java/introduction/java-started.md","raw":"---\ntitle: 【Java入门篇】起航\ntags:\n  - Java入门\n  - Java\ncategories:\n  - 编程\ntoc: true\ndate: 2020-05-01 22:33:01\n---\n\n> 最害怕的东西，最应该去突破\n\n## 初衷\n\n之前博主在[博客园](http://www.cnblogs.com/mfrank/)已经陆续发了几十篇文章，但总体并没有一个很好的串联，在内容编排上也存在许多问题，因此特地将之前的文章做一个整理。\n\n一是将原有文章进行润色，让表达更加生动清晰，二是尽可能的将各个知识点连接成线，整理出自己的一套体系，并剔除其中的错误。\n\n本系列文章不会鼓吹Java怎么怎么好，也不打算尝试怂恿那些在Java边缘徘徊的人来学习Java，只想根据自己的学习经验来给那些想要学习Java却不得其法的人提供一点自己的经验和看法。\n\n`Java 入门篇` 是为零基础的人准备的，内容不多，主要包括环境搭建、IDE设置和使用等方面的介绍，最后会以一个简单的程序结束本篇。\n\n通过本篇的学习，你可以掌握以下内容：\n\n* 如何搭建 Java 开发环境\n* 如何使用 IDEA 进行开发\n* 完成简单的 Java 代码\n\n## 编程的世界观\n\n编程写代码其实跟玩游戏很相似，不断学习，不断提升，然后写代码来完成各种工作，就跟打怪升级，赚钱买装备，最终打倒BOSS是一样的。\n\n每一款好的游戏都有一个较为统一完整的世界观，也会有一个统一的背景设定，你需要先接受和理解这个设定的背景，然后慢慢了解这个游戏的完整世界观，这样才能真正融入这个游戏。\n\n比如说，`《剑网3》`的世界观设计一直遵循“纯武侠，真江湖”设计，背景设定便是唐宋时期，武林纷争，各大门派先后崛起，而你出身草芥，通过自己的努力，不断完成各种新手任务来提升等级，然后加入门派，再通过不断升级武器装备、完成各种副本来提升自我。\n\n又比如`《饥荒》`这款游戏，是关于一名科学家被恶魔传送到了异世界荒野的故事，游戏的主题是生存，所以你的目标是尽可能的利用各种资源来存活更长时间，同时要抵御各种外来威胁来保证自己的安全。\n\n如果把编程开发也比作游戏的话，它更像是《我的世界》这样的自由度很高的沙盒游戏。有的人会将《我的世界》玩成一款生存游戏，享受被僵尸追杀的快感，有人会将它玩成一款建筑游戏，打造属于自己的王国。带着不同的目的人，会有完全不同的游戏体验。\n\n编程也是如此，在编程的世界里，你拥有的是一个万能工厂，而你是一位工程师，在这里你可以生产出任何产品，汽车、轮船、火箭，如果你足够厉害，甚至可以创造一个新的世界，所有你需要做的，便是给出合格的设计图，接下来的事情，交给这个`万能工厂`就好了。\n\n每个人拥有这个`万能工厂`的人都有着不同的目的，有的人只是为了参观，有的人是为了制作出性能强悍的跑车，有的人是为了制作自己用的小玩具，而有的人只是为了用它来谋生。不同的目的就会有完全不同的前进方向，也会有完全不同的体验，有的人会觉得枯燥，有的人会觉得无聊，而有的人却会感觉激情四射，爱不释手。如果你能真正体会到其中的乐趣，那么你一定会爱上这个工厂。\n\n但做出一张好的`设计图`并不是一件简单的事情，所以你需要不断的学习它的规范，设计出符合规范的`设计图`，才能使用这个`万能工厂`正确生产出你想要的产品。\n\n等到你真正掌握了这个规范，就会发现，只满足于正确性还远远不够，于是渐渐的会开始追求效率和美感。为了提高设计效率，前辈们已经总结出很多种`设计模式`，适用于不同的应用场景，掌握了它们，在设计产品的时候便能更加随心所欲。\n\n而关于编程美学，也是一门用经验堆积起来的学问。毕竟，作为工程师的我们，需要与其他工程师不断交流切磋，我们会观摩欣赏别人的`设计图`，也会把自己的`设计图`和别人探讨。所以`设计图`不仅仅是为了给这个万能工厂来运转，也是为了阅读。\n\n当然，这都是后话了。\n\n## Java编程的世界观\n\n`Java` 是一门`高级编程语言`，所谓的高级，是相对于汇编等`机器语言`而言的，有更高层次的抽象，更加接近自然语言和数学公式，基本脱离了机器的硬件系统。\n\n前面说到，每种编程语言都是一个`万能工厂`，`Java` 也有一个`万能工厂`。不同语言代表的不同工厂有着各自的擅长领域。\n\n目前来说，`Java` 的主流应用领域便是 `Web/APP后端开发` 、`嵌入式设备` 、`大数据` 、`安卓开发` ，当然，`Java` 也可以开发桌面应用程序，也可以写游戏，但那些并不是 `Java` 擅长的领域。就像你可以用菜刀砍树，用斧头切菜一样，可以做，但是会有些别扭，有其他更好用的工具为什么要选择这样蹩脚的方式呢。\n\n不要忘了你的目标，如果你是为了探索和享受其中的乐趣，那可以尽管去做。如果是为了完成某项功能，那请别忘了，这些工厂都只是一个工具而已，你的最终目的是实现你的要的功能。\n\n> 吾生也有涯，而知也无涯。以有涯随无涯，殆已！\n\n简单来说，不管黑猫白猫，能抓住耗子的猫就是好猫。\n\n所以对待各种编程语言，首先要保持理智和克制，他们都只是一个工具，通常来说，我们的目的是为了解决问题，不要陷入对某种语言的盲目崇拜的陷阱里，脱离场景而进行语言之间的对比是毫无意义的。\n\n`Java` 有很多开发方向，本系列文章将主要以 `JavaWeb` 开发为目标进行探索，利用 `Java` 这个大工厂来开发网站后端应用，为我们的前台页面提供强劲稳定的功能支持。\n\n相对于桌面开发而言，`JavaWeb` 开发更多的时候开发出的产品是默默的在后台工作的，需要通过前台 `html` 页面或者 `手机app`，亦或是 `桌面app` 才能进行间接的交互。\n\n比如你打开淘宝，看到的那些页面架构和好看的图片大都是前端和UI的功劳，而你看到的那些文字和数字内容，大都是后端的数据驱动的成果。（当然，现在可能更多的功劳又要归功于基于大数据的推荐系统了）\n\n但不要因此而觉得 `Java` 后端开发很无聊，其实一个网站的后端就像一个程序的大脑，绝大部分的数据逻辑处理是由后端完成的，不仅要负责对数据进行处理，还需要跟数据库，各种消息中间件打交道，利用各种算法来实现特定的功能。\n\n前端则负责展示处理后的结果，并做出相应的响应，是一个应用的门面。前端侧重展示和交互，后端侧重程序的逻辑，都是为了提供更好的用户体验，只是着力点不一样而已。\n\n`Java` 这个大工厂能量无穷，想要完全掌控它的妙用需要一段较长的修炼时间，毕竟想要设计一张足够精巧的设计图纸并不是一件简单的事情，所以需要不断的学习。\n\n这个过程难免会遇到挫折和困难，其中很多坑对于新手而言是致命的，最简单的比如环境安装，很多人的兴趣就是夭折在环境的折腾上。其实很多坑，早有无数人踩过，也有很多人在网上分享过相关的解决办法，所以当你遇到问题的时候，可以先上百度找找，你要相信一定有人遇到过同样的问题，如果没找到，想想换个姿势搜索。\n\n当然也许苦苦搜寻之后，还是无法解决你的问题，这时候，来自共同学习的小伙伴的支持就显得弥足珍贵了，为此，博主创建了一个QQ群【529253292】，这里也许可以找到你想要的答案。\n\n`Java` 的学习深造过程，就像是升级打怪过关卡，每个知识点都有些小boss，把它们打倒后便能获得相应的经验值，可以提升你的等级，但是随着你的等级的提升，这些小怪小boss对你的修炼的帮助已经聊胜于无了，于是你需要进行更艰难的修炼，去挑战更厉害的boss。\n\n## 起航\n\n在这个世界里，自由度很大，大到也许会让刚接触的你迷失方向，不知所措。所以本系列文章将会提供给你一条前往 `JavaWeb` 开发的修炼道路，虽然并不一定是最优路线，但至少总体方向不会错，如果你刚好想往这个方向发展，那么本系列文章将会给你提供一些帮助。注意，本系列文章主张的是夯实基础，先修炼内功，然后再修炼外功，所以如果你想要的是捷径，想要知道如何在一两个月之内找到工作，那么这个系列文章可能不太适合你。\n\n当你的经验累积到一定的值时，就能获得相应的头衔，在 `JavaWeb` 的发展中主要有两条升级路线，一条是技术路线，一条是管理路线，大致就像这样:\n\n![java-started-1.png](https://i.loli.net/2020/05/02/SkyFbiuZjdQTOaW.png)\n\n两条路线的升级加点方式不太一样，但是都是当技术积累到一定程度后才能选择不同的升级路线。\n\n所以，年轻的勇士，不要犹豫了，拿起你的桃木剑，在 `Java` 这个世界探索出自己的道路吧！\n\n[//]: # (![微信公众号]&#40;https://i.loli.net/2020/05/02/AfHOY5RXge9tlVo.png&#41;)\n","slug":"java/introduction/java-started","published":1,"updated":"2020-05-01T14:33:01.000Z","_id":"cl70rsfgv003v5ohu9pox0zhk","comments":1,"layout":"post","photos":[],"link":"","content":"<blockquote>\n<p>最害怕的东西，最应该去突破</p>\n</blockquote>\n<h2 id=\"初衷\"><a href=\"#初衷\" class=\"headerlink\" title=\"初衷\"></a>初衷</h2><p>之前博主在<a href=\"http://www.cnblogs.com/mfrank/\" target=\"_blank\" rel=\"noopener\">博客园</a>已经陆续发了几十篇文章，但总体并没有一个很好的串联，在内容编排上也存在许多问题，因此特地将之前的文章做一个整理。</p>\n<p>一是将原有文章进行润色，让表达更加生动清晰，二是尽可能的将各个知识点连接成线，整理出自己的一套体系，并剔除其中的错误。</p>\n<p>本系列文章不会鼓吹Java怎么怎么好，也不打算尝试怂恿那些在Java边缘徘徊的人来学习Java，只想根据自己的学习经验来给那些想要学习Java却不得其法的人提供一点自己的经验和看法。</p>\n<p><code>Java 入门篇</code> 是为零基础的人准备的，内容不多，主要包括环境搭建、IDE设置和使用等方面的介绍，最后会以一个简单的程序结束本篇。</p>\n<p>通过本篇的学习，你可以掌握以下内容：</p>\n<ul>\n<li>如何搭建 Java 开发环境</li>\n<li>如何使用 IDEA 进行开发</li>\n<li>完成简单的 Java 代码</li>\n</ul>\n<h2 id=\"编程的世界观\"><a href=\"#编程的世界观\" class=\"headerlink\" title=\"编程的世界观\"></a>编程的世界观</h2><p>编程写代码其实跟玩游戏很相似，不断学习，不断提升，然后写代码来完成各种工作，就跟打怪升级，赚钱买装备，最终打倒BOSS是一样的。</p>\n<p>每一款好的游戏都有一个较为统一完整的世界观，也会有一个统一的背景设定，你需要先接受和理解这个设定的背景，然后慢慢了解这个游戏的完整世界观，这样才能真正融入这个游戏。</p>\n<p>比如说，<code>《剑网3》</code>的世界观设计一直遵循“纯武侠，真江湖”设计，背景设定便是唐宋时期，武林纷争，各大门派先后崛起，而你出身草芥，通过自己的努力，不断完成各种新手任务来提升等级，然后加入门派，再通过不断升级武器装备、完成各种副本来提升自我。</p>\n<p>又比如<code>《饥荒》</code>这款游戏，是关于一名科学家被恶魔传送到了异世界荒野的故事，游戏的主题是生存，所以你的目标是尽可能的利用各种资源来存活更长时间，同时要抵御各种外来威胁来保证自己的安全。</p>\n<p>如果把编程开发也比作游戏的话，它更像是《我的世界》这样的自由度很高的沙盒游戏。有的人会将《我的世界》玩成一款生存游戏，享受被僵尸追杀的快感，有人会将它玩成一款建筑游戏，打造属于自己的王国。带着不同的目的人，会有完全不同的游戏体验。</p>\n<p>编程也是如此，在编程的世界里，你拥有的是一个万能工厂，而你是一位工程师，在这里你可以生产出任何产品，汽车、轮船、火箭，如果你足够厉害，甚至可以创造一个新的世界，所有你需要做的，便是给出合格的设计图，接下来的事情，交给这个<code>万能工厂</code>就好了。</p>\n<p>每个人拥有这个<code>万能工厂</code>的人都有着不同的目的，有的人只是为了参观，有的人是为了制作出性能强悍的跑车，有的人是为了制作自己用的小玩具，而有的人只是为了用它来谋生。不同的目的就会有完全不同的前进方向，也会有完全不同的体验，有的人会觉得枯燥，有的人会觉得无聊，而有的人却会感觉激情四射，爱不释手。如果你能真正体会到其中的乐趣，那么你一定会爱上这个工厂。</p>\n<p>但做出一张好的<code>设计图</code>并不是一件简单的事情，所以你需要不断的学习它的规范，设计出符合规范的<code>设计图</code>，才能使用这个<code>万能工厂</code>正确生产出你想要的产品。</p>\n<p>等到你真正掌握了这个规范，就会发现，只满足于正确性还远远不够，于是渐渐的会开始追求效率和美感。为了提高设计效率，前辈们已经总结出很多种<code>设计模式</code>，适用于不同的应用场景，掌握了它们，在设计产品的时候便能更加随心所欲。</p>\n<p>而关于编程美学，也是一门用经验堆积起来的学问。毕竟，作为工程师的我们，需要与其他工程师不断交流切磋，我们会观摩欣赏别人的<code>设计图</code>，也会把自己的<code>设计图</code>和别人探讨。所以<code>设计图</code>不仅仅是为了给这个万能工厂来运转，也是为了阅读。</p>\n<p>当然，这都是后话了。</p>\n<h2 id=\"Java编程的世界观\"><a href=\"#Java编程的世界观\" class=\"headerlink\" title=\"Java编程的世界观\"></a>Java编程的世界观</h2><p><code>Java</code> 是一门<code>高级编程语言</code>，所谓的高级，是相对于汇编等<code>机器语言</code>而言的，有更高层次的抽象，更加接近自然语言和数学公式，基本脱离了机器的硬件系统。</p>\n<p>前面说到，每种编程语言都是一个<code>万能工厂</code>，<code>Java</code> 也有一个<code>万能工厂</code>。不同语言代表的不同工厂有着各自的擅长领域。</p>\n<p>目前来说，<code>Java</code> 的主流应用领域便是 <code>Web/APP后端开发</code> 、<code>嵌入式设备</code> 、<code>大数据</code> 、<code>安卓开发</code> ，当然，<code>Java</code> 也可以开发桌面应用程序，也可以写游戏，但那些并不是 <code>Java</code> 擅长的领域。就像你可以用菜刀砍树，用斧头切菜一样，可以做，但是会有些别扭，有其他更好用的工具为什么要选择这样蹩脚的方式呢。</p>\n<p>不要忘了你的目标，如果你是为了探索和享受其中的乐趣，那可以尽管去做。如果是为了完成某项功能，那请别忘了，这些工厂都只是一个工具而已，你的最终目的是实现你的要的功能。</p>\n<blockquote>\n<p>吾生也有涯，而知也无涯。以有涯随无涯，殆已！</p>\n</blockquote>\n<p>简单来说，不管黑猫白猫，能抓住耗子的猫就是好猫。</p>\n<p>所以对待各种编程语言，首先要保持理智和克制，他们都只是一个工具，通常来说，我们的目的是为了解决问题，不要陷入对某种语言的盲目崇拜的陷阱里，脱离场景而进行语言之间的对比是毫无意义的。</p>\n<p><code>Java</code> 有很多开发方向，本系列文章将主要以 <code>JavaWeb</code> 开发为目标进行探索，利用 <code>Java</code> 这个大工厂来开发网站后端应用，为我们的前台页面提供强劲稳定的功能支持。</p>\n<p>相对于桌面开发而言，<code>JavaWeb</code> 开发更多的时候开发出的产品是默默的在后台工作的，需要通过前台 <code>html</code> 页面或者 <code>手机app</code>，亦或是 <code>桌面app</code> 才能进行间接的交互。</p>\n<p>比如你打开淘宝，看到的那些页面架构和好看的图片大都是前端和UI的功劳，而你看到的那些文字和数字内容，大都是后端的数据驱动的成果。（当然，现在可能更多的功劳又要归功于基于大数据的推荐系统了）</p>\n<p>但不要因此而觉得 <code>Java</code> 后端开发很无聊，其实一个网站的后端就像一个程序的大脑，绝大部分的数据逻辑处理是由后端完成的，不仅要负责对数据进行处理，还需要跟数据库，各种消息中间件打交道，利用各种算法来实现特定的功能。</p>\n<p>前端则负责展示处理后的结果，并做出相应的响应，是一个应用的门面。前端侧重展示和交互，后端侧重程序的逻辑，都是为了提供更好的用户体验，只是着力点不一样而已。</p>\n<p><code>Java</code> 这个大工厂能量无穷，想要完全掌控它的妙用需要一段较长的修炼时间，毕竟想要设计一张足够精巧的设计图纸并不是一件简单的事情，所以需要不断的学习。</p>\n<p>这个过程难免会遇到挫折和困难，其中很多坑对于新手而言是致命的，最简单的比如环境安装，很多人的兴趣就是夭折在环境的折腾上。其实很多坑，早有无数人踩过，也有很多人在网上分享过相关的解决办法，所以当你遇到问题的时候，可以先上百度找找，你要相信一定有人遇到过同样的问题，如果没找到，想想换个姿势搜索。</p>\n<p>当然也许苦苦搜寻之后，还是无法解决你的问题，这时候，来自共同学习的小伙伴的支持就显得弥足珍贵了，为此，博主创建了一个QQ群【529253292】，这里也许可以找到你想要的答案。</p>\n<p><code>Java</code> 的学习深造过程，就像是升级打怪过关卡，每个知识点都有些小boss，把它们打倒后便能获得相应的经验值，可以提升你的等级，但是随着你的等级的提升，这些小怪小boss对你的修炼的帮助已经聊胜于无了，于是你需要进行更艰难的修炼，去挑战更厉害的boss。</p>\n<h2 id=\"起航\"><a href=\"#起航\" class=\"headerlink\" title=\"起航\"></a>起航</h2><p>在这个世界里，自由度很大，大到也许会让刚接触的你迷失方向，不知所措。所以本系列文章将会提供给你一条前往 <code>JavaWeb</code> 开发的修炼道路，虽然并不一定是最优路线，但至少总体方向不会错，如果你刚好想往这个方向发展，那么本系列文章将会给你提供一些帮助。注意，本系列文章主张的是夯实基础，先修炼内功，然后再修炼外功，所以如果你想要的是捷径，想要知道如何在一两个月之内找到工作，那么这个系列文章可能不太适合你。</p>\n<p>当你的经验累积到一定的值时，就能获得相应的头衔，在 <code>JavaWeb</code> 的发展中主要有两条升级路线，一条是技术路线，一条是管理路线，大致就像这样:</p>\n<p><img src=\"https://i.loli.net/2020/05/02/SkyFbiuZjdQTOaW.png\" alt=\"java-started-1.png\"></p>\n<p>两条路线的升级加点方式不太一样，但是都是当技术积累到一定程度后才能选择不同的升级路线。</p>\n<p>所以，年轻的勇士，不要犹豫了，拿起你的桃木剑，在 <code>Java</code> 这个世界探索出自己的道路吧！</p>\n<script>\n        document.querySelectorAll('.github-emoji')\n          .forEach(el => {\n            if (!el.dataset.src) { return; }\n            const img = document.createElement('img');\n            img.style = 'display:none !important;';\n            img.src = el.dataset.src;\n            img.addEventListener('error', () => {\n              img.remove();\n              el.style.color = 'inherit';\n              el.style.backgroundImage = 'none';\n              el.style.background = 'none';\n            });\n            img.addEventListener('load', () => {\n              img.remove();\n            });\n            document.body.appendChild(img);\n          });\n      </script>","site":{"data":{"friends":[{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"电商","introduction":"面向谷歌编程","url":"http://43.142.191.46:9527/","title":"前去学习"},{"avatar":"http://43.142.191.46:8080/crmebimage/public/operation/2022/08/19/e4c5aacf44c44157ac8381896a4f33bfiwjztayaan.png","name":"RabbitMQ","introduction":"消息列队","url":"http://43.142.191.46:15672/","title":"前去学习"}]}},"excerpt":"","more":"<blockquote>\n<p>最害怕的东西，最应该去突破</p>\n</blockquote>\n<h2 id=\"初衷\"><a href=\"#初衷\" class=\"headerlink\" title=\"初衷\"></a>初衷</h2><p>之前博主在<a href=\"http://www.cnblogs.com/mfrank/\" target=\"_blank\" rel=\"noopener\">博客园</a>已经陆续发了几十篇文章，但总体并没有一个很好的串联，在内容编排上也存在许多问题，因此特地将之前的文章做一个整理。</p>\n<p>一是将原有文章进行润色，让表达更加生动清晰，二是尽可能的将各个知识点连接成线，整理出自己的一套体系，并剔除其中的错误。</p>\n<p>本系列文章不会鼓吹Java怎么怎么好，也不打算尝试怂恿那些在Java边缘徘徊的人来学习Java，只想根据自己的学习经验来给那些想要学习Java却不得其法的人提供一点自己的经验和看法。</p>\n<p><code>Java 入门篇</code> 是为零基础的人准备的，内容不多，主要包括环境搭建、IDE设置和使用等方面的介绍，最后会以一个简单的程序结束本篇。</p>\n<p>通过本篇的学习，你可以掌握以下内容：</p>\n<ul>\n<li>如何搭建 Java 开发环境</li>\n<li>如何使用 IDEA 进行开发</li>\n<li>完成简单的 Java 代码</li>\n</ul>\n<h2 id=\"编程的世界观\"><a href=\"#编程的世界观\" class=\"headerlink\" title=\"编程的世界观\"></a>编程的世界观</h2><p>编程写代码其实跟玩游戏很相似，不断学习，不断提升，然后写代码来完成各种工作，就跟打怪升级，赚钱买装备，最终打倒BOSS是一样的。</p>\n<p>每一款好的游戏都有一个较为统一完整的世界观，也会有一个统一的背景设定，你需要先接受和理解这个设定的背景，然后慢慢了解这个游戏的完整世界观，这样才能真正融入这个游戏。</p>\n<p>比如说，<code>《剑网3》</code>的世界观设计一直遵循“纯武侠，真江湖”设计，背景设定便是唐宋时期，武林纷争，各大门派先后崛起，而你出身草芥，通过自己的努力，不断完成各种新手任务来提升等级，然后加入门派，再通过不断升级武器装备、完成各种副本来提升自我。</p>\n<p>又比如<code>《饥荒》</code>这款游戏，是关于一名科学家被恶魔传送到了异世界荒野的故事，游戏的主题是生存，所以你的目标是尽可能的利用各种资源来存活更长时间，同时要抵御各种外来威胁来保证自己的安全。</p>\n<p>如果把编程开发也比作游戏的话，它更像是《我的世界》这样的自由度很高的沙盒游戏。有的人会将《我的世界》玩成一款生存游戏，享受被僵尸追杀的快感，有人会将它玩成一款建筑游戏，打造属于自己的王国。带着不同的目的人，会有完全不同的游戏体验。</p>\n<p>编程也是如此，在编程的世界里，你拥有的是一个万能工厂，而你是一位工程师，在这里你可以生产出任何产品，汽车、轮船、火箭，如果你足够厉害，甚至可以创造一个新的世界，所有你需要做的，便是给出合格的设计图，接下来的事情，交给这个<code>万能工厂</code>就好了。</p>\n<p>每个人拥有这个<code>万能工厂</code>的人都有着不同的目的，有的人只是为了参观，有的人是为了制作出性能强悍的跑车，有的人是为了制作自己用的小玩具，而有的人只是为了用它来谋生。不同的目的就会有完全不同的前进方向，也会有完全不同的体验，有的人会觉得枯燥，有的人会觉得无聊，而有的人却会感觉激情四射，爱不释手。如果你能真正体会到其中的乐趣，那么你一定会爱上这个工厂。</p>\n<p>但做出一张好的<code>设计图</code>并不是一件简单的事情，所以你需要不断的学习它的规范，设计出符合规范的<code>设计图</code>，才能使用这个<code>万能工厂</code>正确生产出你想要的产品。</p>\n<p>等到你真正掌握了这个规范，就会发现，只满足于正确性还远远不够，于是渐渐的会开始追求效率和美感。为了提高设计效率，前辈们已经总结出很多种<code>设计模式</code>，适用于不同的应用场景，掌握了它们，在设计产品的时候便能更加随心所欲。</p>\n<p>而关于编程美学，也是一门用经验堆积起来的学问。毕竟，作为工程师的我们，需要与其他工程师不断交流切磋，我们会观摩欣赏别人的<code>设计图</code>，也会把自己的<code>设计图</code>和别人探讨。所以<code>设计图</code>不仅仅是为了给这个万能工厂来运转，也是为了阅读。</p>\n<p>当然，这都是后话了。</p>\n<h2 id=\"Java编程的世界观\"><a href=\"#Java编程的世界观\" class=\"headerlink\" title=\"Java编程的世界观\"></a>Java编程的世界观</h2><p><code>Java</code> 是一门<code>高级编程语言</code>，所谓的高级，是相对于汇编等<code>机器语言</code>而言的，有更高层次的抽象，更加接近自然语言和数学公式，基本脱离了机器的硬件系统。</p>\n<p>前面说到，每种编程语言都是一个<code>万能工厂</code>，<code>Java</code> 也有一个<code>万能工厂</code>。不同语言代表的不同工厂有着各自的擅长领域。</p>\n<p>目前来说，<code>Java</code> 的主流应用领域便是 <code>Web/APP后端开发</code> 、<code>嵌入式设备</code> 、<code>大数据</code> 、<code>安卓开发</code> ，当然，<code>Java</code> 也可以开发桌面应用程序，也可以写游戏，但那些并不是 <code>Java</code> 擅长的领域。就像你可以用菜刀砍树，用斧头切菜一样，可以做，但是会有些别扭，有其他更好用的工具为什么要选择这样蹩脚的方式呢。</p>\n<p>不要忘了你的目标，如果你是为了探索和享受其中的乐趣，那可以尽管去做。如果是为了完成某项功能，那请别忘了，这些工厂都只是一个工具而已，你的最终目的是实现你的要的功能。</p>\n<blockquote>\n<p>吾生也有涯，而知也无涯。以有涯随无涯，殆已！</p>\n</blockquote>\n<p>简单来说，不管黑猫白猫，能抓住耗子的猫就是好猫。</p>\n<p>所以对待各种编程语言，首先要保持理智和克制，他们都只是一个工具，通常来说，我们的目的是为了解决问题，不要陷入对某种语言的盲目崇拜的陷阱里，脱离场景而进行语言之间的对比是毫无意义的。</p>\n<p><code>Java</code> 有很多开发方向，本系列文章将主要以 <code>JavaWeb</code> 开发为目标进行探索，利用 <code>Java</code> 这个大工厂来开发网站后端应用，为我们的前台页面提供强劲稳定的功能支持。</p>\n<p>相对于桌面开发而言，<code>JavaWeb</code> 开发更多的时候开发出的产品是默默的在后台工作的，需要通过前台 <code>html</code> 页面或者 <code>手机app</code>，亦或是 <code>桌面app</code> 才能进行间接的交互。</p>\n<p>比如你打开淘宝，看到的那些页面架构和好看的图片大都是前端和UI的功劳，而你看到的那些文字和数字内容，大都是后端的数据驱动的成果。（当然，现在可能更多的功劳又要归功于基于大数据的推荐系统了）</p>\n<p>但不要因此而觉得 <code>Java</code> 后端开发很无聊，其实一个网站的后端就像一个程序的大脑，绝大部分的数据逻辑处理是由后端完成的，不仅要负责对数据进行处理，还需要跟数据库，各种消息中间件打交道，利用各种算法来实现特定的功能。</p>\n<p>前端则负责展示处理后的结果，并做出相应的响应，是一个应用的门面。前端侧重展示和交互，后端侧重程序的逻辑，都是为了提供更好的用户体验，只是着力点不一样而已。</p>\n<p><code>Java</code> 这个大工厂能量无穷，想要完全掌控它的妙用需要一段较长的修炼时间，毕竟想要设计一张足够精巧的设计图纸并不是一件简单的事情，所以需要不断的学习。</p>\n<p>这个过程难免会遇到挫折和困难，其中很多坑对于新手而言是致命的，最简单的比如环境安装，很多人的兴趣就是夭折在环境的折腾上。其实很多坑，早有无数人踩过，也有很多人在网上分享过相关的解决办法，所以当你遇到问题的时候，可以先上百度找找，你要相信一定有人遇到过同样的问题，如果没找到，想想换个姿势搜索。</p>\n<p>当然也许苦苦搜寻之后，还是无法解决你的问题，这时候，来自共同学习的小伙伴的支持就显得弥足珍贵了，为此，博主创建了一个QQ群【529253292】，这里也许可以找到你想要的答案。</p>\n<p><code>Java</code> 的学习深造过程，就像是升级打怪过关卡，每个知识点都有些小boss，把它们打倒后便能获得相应的经验值，可以提升你的等级，但是随着你的等级的提升，这些小怪小boss对你的修炼的帮助已经聊胜于无了，于是你需要进行更艰难的修炼，去挑战更厉害的boss。</p>\n<h2 id=\"起航\"><a href=\"#起航\" class=\"headerlink\" title=\"起航\"></a>起航</h2><p>在这个世界里，自由度很大，大到也许会让刚接触的你迷失方向，不知所措。所以本系列文章将会提供给你一条前往 <code>JavaWeb</code> 开发的修炼道路，虽然并不一定是最优路线，但至少总体方向不会错，如果你刚好想往这个方向发展，那么本系列文章将会给你提供一些帮助。注意，本系列文章主张的是夯实基础，先修炼内功，然后再修炼外功，所以如果你想要的是捷径，想要知道如何在一两个月之内找到工作，那么这个系列文章可能不太适合你。</p>\n<p>当你的经验累积到一定的值时，就能获得相应的头衔，在 <code>JavaWeb</code> 的发展中主要有两条升级路线，一条是技术路线，一条是管理路线，大致就像这样:</p>\n<p><img src=\"https://i.loli.net/2020/05/02/SkyFbiuZjdQTOaW.png\" alt=\"java-started-1.png\"></p>\n<p>两条路线的升级加点方式不太一样，但是都是当技术积累到一定程度后才能选择不同的升级路线。</p>\n<p>所以，年轻的勇士，不要犹豫了，拿起你的桃木剑，在 <code>Java</code> 这个世界探索出自己的道路吧！</p>\n"}],"PostAsset":[{"_id":"source/_posts/conclusion/2020-conclusion-slim/11.jpeg","slug":"11.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/14.jpeg","slug":"14.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/24.jpeg","slug":"24.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/25.jpeg","slug":"25.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/28.jpeg","slug":"28.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/8.jpeg","slug":"8.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/12.png","slug":"12.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/15.png","slug":"15.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/5.png","slug":"5.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-1.jpg","slug":"hexo-1.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-17.jpg","slug":"hexo-17.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-3.jpg","slug":"hexo-3.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-4.jpg","slug":"hexo-4.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-5.jpg","slug":"hexo-5.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-theme/hexo-theme-1.jpg","slug":"hexo-theme-1.jpg","post":"cl70rsfba000g5ohu5ho9b02j","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/11.png","slug":"11.png","post":"cl70rsfb9000f5ohuak0a9el4","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic/10.png","slug":"10.png","post":"cl70rsfbf000q5ohu7jjx94bs","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/2.png","slug":"2.png","post":"cl70rsfbh000t5ohubzf01mj3","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (4).png","slug":"carbon (4).png","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (5).png","slug":"carbon (5).png","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (1).png","slug":"carbon (1).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (13).png","slug":"carbon (13).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (12).png","slug":"carbon (12).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (14).png","slug":"carbon (14).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (8).png","slug":"carbon (8).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/23.jpeg","slug":"23.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/26.jpeg","slug":"26.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/14.png","slug":"14.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/2.png","slug":"2.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/4.png","slug":"4.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/6.png","slug":"6.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-2.jpg","slug":"hexo-2.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/1.png","slug":"1.png","post":"cl70rsfb9000f5ohuak0a9el4","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/3.png","slug":"3.png","post":"cl70rsfbh000t5ohubzf01mj3","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/6.png","slug":"6.png","post":"cl70rsfbh000t5ohubzf01mj3","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/5.png","slug":"5.png","post":"cl70rsfbh000t5ohubzf01mj3","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (3).png","slug":"carbon (3).png","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (15).png","slug":"carbon (15).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (4).png","slug":"carbon (4).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (5).png","slug":"carbon (5).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (9).png","slug":"carbon (9).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/27.jpeg","slug":"27.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/32.png","slug":"32.png","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/7.png","slug":"7.png","post":"cl70rsfbh000t5ohubzf01mj3","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/2-jdk-mac.png","slug":"2-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (10).png","slug":"carbon (10).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (3).png","slug":"carbon (3).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (6).png","slug":"carbon (6).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-basic-type/1.png","slug":"1.png","post":"cl70rsfb6000a5ohu5zhzbo4j","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-theme/hexo-theme-2.jpg","slug":"hexo-theme-2.jpg","post":"cl70rsfba000g5ohu5ho9b02j","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-theme/hexo-theme-3.jpg","slug":"hexo-theme-3.jpg","post":"cl70rsfba000g5ohu5ho9b02j","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2/$2ER{ZD68TZW07[M5{$JZGL.png","slug":"$2ER{ZD68TZW07[M5{$JZGL.png","post":"cl70rsfbk00155ohuf689b5gd","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2/42P7LF)NXQ`0JIN0~~43]PE.png","slug":"42P7LF)NXQ`0JIN0~~43]PE.png","post":"cl70rsfbk00155ohuf689b5gd","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message2/DTHP)NN0CQ28[@(HHY2R8{5.png","slug":"DTHP)NN0CQ28[@(HHY2R8{5.png","post":"cl70rsfbk00155ohuf689b5gd","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/111.png.jpg","slug":"111.png.jpg","post":"cl70rsfbj00115ohu0wq7hw4y","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/20170716034945131.jpg","slug":"20170716034945131.jpg","post":"cl70rsfbj00115ohu0wq7hw4y","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/5b65729e0001439305000294.jpg","slug":"5b65729e0001439305000294.jpg","post":"cl70rsfbj00115ohu0wq7hw4y","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/u=1091165172,1855706818&fm=26&gp=0.jpg","slug":"u=1091165172,1855706818&fm=26&gp=0.jpg","post":"cl70rsfbj00115ohu0wq7hw4y","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-ensure-reliable-delivery-of-message/{6582FAF9-A46E-4239-810B-E1D6883ED070}.png.jpg","slug":"{6582FAF9-A46E-4239-810B-E1D6883ED070}.png.jpg","post":"cl70rsfbj00115ohu0wq7hw4y","modified":0,"renderable":0},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/1565529015677.png","slug":"1565529015677.png","post":"cl70rsfb300065ohu2ghc4be7","modified":0,"renderable":0},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/EDaBTlbkyvbhmng.jpg","slug":"EDaBTlbkyvbhmng.jpg","post":"cl70rsfb300065ohu2ghc4be7","modified":0,"renderable":0},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/GBvgTpbkyvbhlEB.jpg","slug":"GBvgTpbkyvbhlEB.jpg","post":"cl70rsfb300065ohu2ghc4be7","modified":0,"renderable":0},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/IStGDBbkyvbhmow.jpg","slug":"IStGDBbkyvbhmow.jpg","post":"cl70rsfb300065ohu2ghc4be7","modified":0,"renderable":0},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/dtFxiMbkyvbhlzo.jpg","slug":"dtFxiMbkyvbhlzo.jpg","post":"cl70rsfb300065ohu2ghc4be7","modified":0,"renderable":0},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/fuuTyTbkyvbhmsa.jpg","slug":"fuuTyTbkyvbhmsa.jpg","post":"cl70rsfb300065ohu2ghc4be7","modified":0,"renderable":0},{"_id":"source/_posts/best-practice/how-to-retry-elegantly/timg.jpg","slug":"timg.jpg","post":"cl70rsfb300065ohu2ghc4be7","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/1.png","slug":"1.png","post":"cl70rsfbh000t5ohubzf01mj3","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-pic-rotate-use-gg-package/4.png","slug":"4.png","post":"cl70rsfbh000t5ohubzf01mj3","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic2/1.png","slug":"1.png","post":"cl70rsfbd000m5ohu334rbmha","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic2/2.png","slug":"2.png","post":"cl70rsfbd000m5ohu334rbmha","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic2/3.png","slug":"3.png","post":"cl70rsfbd000m5ohu334rbmha","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic2/4.png","slug":"4.png","post":"cl70rsfbd000m5ohu334rbmha","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic2/5.png","slug":"5.png","post":"cl70rsfbd000m5ohu334rbmha","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic2/6.png","slug":"6.png","post":"cl70rsfbd000m5ohu334rbmha","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic2/7.png","slug":"7.png","post":"cl70rsfbd000m5ohu334rbmha","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic2/SourceHanSansCN-Bold-2.otf","slug":"SourceHanSansCN-Bold-2.otf","post":"cl70rsfbd000m5ohu334rbmha","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic2/gilmer-heavy.ttf","slug":"gilmer-heavy.ttf","post":"cl70rsfbd000m5ohu334rbmha","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic2/方正楷体简体.ttf","slug":"方正楷体简体.ttf","post":"cl70rsfbd000m5ohu334rbmha","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-wx-pic-generator/1.png","slug":"1.png","post":"cl70rsfbj000y5ohua65p291g","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-wx-pic-generator/10.png","slug":"10.png","post":"cl70rsfbj000y5ohua65p291g","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-wx-pic-generator/11.png","slug":"11.png","post":"cl70rsfbj000y5ohua65p291g","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-wx-pic-generator/2.png","slug":"2.png","post":"cl70rsfbj000y5ohua65p291g","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-wx-pic-generator/3.png","slug":"3.png","post":"cl70rsfbj000y5ohua65p291g","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-wx-pic-generator/4.jpg","slug":"4.jpg","post":"cl70rsfbj000y5ohua65p291g","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-wx-pic-generator/5.jpg","slug":"5.jpg","post":"cl70rsfbj000y5ohua65p291g","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-wx-pic-generator/6.jpg","slug":"6.jpg","post":"cl70rsfbj000y5ohua65p291g","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-wx-pic-generator/7.png","slug":"7.png","post":"cl70rsfbj000y5ohua65p291g","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-wx-pic-generator/8.png","slug":"8.png","post":"cl70rsfbj000y5ohua65p291g","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-wx-pic-generator/9.png","slug":"9.png","post":"cl70rsfbj000y5ohua65p291g","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/10.png","slug":"10.png","post":"cl70rsfb9000f5ohuak0a9el4","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/2.png","slug":"2.png","post":"cl70rsfb9000f5ohuak0a9el4","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/3.png","slug":"3.png","post":"cl70rsfb9000f5ohuak0a9el4","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/4.png","slug":"4.png","post":"cl70rsfb9000f5ohuak0a9el4","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/5.png","slug":"5.png","post":"cl70rsfb9000f5ohuak0a9el4","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/6.png","slug":"6.png","post":"cl70rsfb9000f5ohuak0a9el4","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/7.png","slug":"7.png","post":"cl70rsfb9000f5ohuak0a9el4","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/8.png","slug":"8.png","post":"cl70rsfb9000f5ohuak0a9el4","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/9.png","slug":"9.png","post":"cl70rsfb9000f5ohuak0a9el4","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-basic-usage-of-gg-package/test.jpg","slug":"test.jpg","post":"cl70rsfb9000f5ohuak0a9el4","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic/1.png","slug":"1.png","post":"cl70rsfbf000q5ohu7jjx94bs","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic/2.png","slug":"2.png","post":"cl70rsfbf000q5ohu7jjx94bs","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic/3.png","slug":"3.png","post":"cl70rsfbf000q5ohu7jjx94bs","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic/4.png","slug":"4.png","post":"cl70rsfbf000q5ohu7jjx94bs","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic/5.png","slug":"5.png","post":"cl70rsfbf000q5ohu7jjx94bs","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic/6.png","slug":"6.png","post":"cl70rsfbf000q5ohu7jjx94bs","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic/7.png","slug":"7.png","post":"cl70rsfbf000q5ohu7jjx94bs","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic/8.png","slug":"8.png","post":"cl70rsfbf000q5ohu7jjx94bs","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic/9.png","slug":"9.png","post":"cl70rsfbf000q5ohu7jjx94bs","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic/gilmer-heavy.ttf","slug":"gilmer-heavy.ttf","post":"cl70rsfbf000q5ohu7jjx94bs","modified":0,"renderable":0},{"_id":"source/_posts/picture/go-draw-word-in-pic/方正楷体简体.ttf","slug":"方正楷体简体.ttf","post":"cl70rsfbf000q5ohu7jjx94bs","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/54b719620c68404a8b8dfacc070420cb.jpg","slug":"54b719620c68404a8b8dfacc070420cb.jpg","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/5d2ae72753a8e90481.png","slug":"5d2ae72753a8e90481.png","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/8(%(3A_Y`_N8XX8W5XHZMWY.png","slug":"8(%(3A_Y`_N8XX8W5XHZMWY.png","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/A51]5T0]5(4`@P{}[06(%~Q.png","slug":"A51]5T0]5(4`@P{}[06(%~Q.png","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/AG4T332}_NEUNPUAU(A_)U6.png","slug":"AG4T332}_NEUNPUAU(A_)U6.png","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/TIM图片20190714173105.png","slug":"TIM图片20190714173105.png","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/[@YD9OX4WP)E9$ME_7`Z]NB.png","slug":"[@YD9OX4WP)E9$ME_7`Z]NB.png","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (1).png","slug":"carbon (1).png","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon (2).png","slug":"carbon (2).png","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-dead-letter-queue/carbon.png","slug":"carbon.png","post":"cl70rsfbm00195ohu6z1m6rv7","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/10.png","slug":"10.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/1043143-20200727074006066-1700986643.png","slug":"1043143-20200727074006066-1700986643.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/11.png","slug":"11.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/13.png","slug":"13.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/3.png","slug":"3.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/7.png","slug":"7.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/8.png","slug":"8.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/data-analysis/r-study-install/9.png","slug":"9.png","post":"cl70rsfb7000b5ohuhon4f38o","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/3-jdk-mac.png","slug":"3-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-10.jpg","slug":"hexo-10.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-11.jpg","slug":"hexo-11.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-12.jpg","slug":"hexo-12.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-13.jpg","slug":"hexo-13.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-14.jpg","slug":"hexo-14.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-15.jpg","slug":"hexo-15.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-16.jpg","slug":"hexo-16.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-18.jpg","slug":"hexo-18.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-19.jpg","slug":"hexo-19.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-6.jpg","slug":"hexo-6.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-7.jpg","slug":"hexo-7.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-8.jpg","slug":"hexo-8.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/hexo/hexo-start/hexo-9.jpg","slug":"hexo-9.jpg","post":"cl70rsfbc000k5ohu16oq97x0","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/$QT%QELKW@$DM92E@ZNA647.png","slug":"$QT%QELKW@$DM92E@ZNA647.png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/1@J8$IFWP3]K{)U]{E~7V{1.png","slug":"1@J8$IFWP3]K{)U]{E~7V{1.png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/8Q$8RRCK~N@S]1@71KPJ]NC.png","slug":"8Q$8RRCK~N@S]1@71KPJ]NC.png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/LH`~)W5TPAA`OB6`5UH@FIB.png","slug":"LH`~)W5TPAA`OB6`5UH@FIB.png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (11).png","slug":"carbon (11).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (2).png","slug":"carbon (2).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon (7).png","slug":"carbon (7).png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/carbon.png","slug":"carbon.png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/rabbitmq/rabbitmq-how-to-use-delay-queue/屏幕快照 2019-07-28 下午6.04.42.png","slug":"屏幕快照 2019-07-28 下午6.04.42.png","post":"cl70rsfbo001f5ohucfcngr87","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-ide/java-ide-2.png","slug":"java-ide-2.png","post":"cl70rsfgo003p5ohu82hier9h","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/1.jpg","slug":"1.jpg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/10.png","slug":"10.png","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/12.jpeg","slug":"12.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/13.jpeg","slug":"13.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/15.png","slug":"15.png","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/16.jpeg","slug":"16.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/17.jpeg","slug":"17.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/18.jpeg","slug":"18.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/19.jpeg","slug":"19.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/2.jpg","slug":"2.jpg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/20.png","slug":"20.png","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/21.jpeg","slug":"21.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/22.jpeg","slug":"22.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/29.jpeg","slug":"29.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/3.jpeg","slug":"3.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/30.jpeg","slug":"30.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/31.png","slug":"31.png","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/4.png","slug":"4.png","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/5.png","slug":"5.png","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/6.png","slug":"6.png","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/7.jpeg","slug":"7.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/conclusion/2020-conclusion-slim/9.jpeg","slug":"9.jpeg","post":"cl70rsfb400075ohu812jdjxs","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/4-jdk-mac.png","slug":"4-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-started/java-started-1.png","slug":"java-started-1.png","post":"cl70rsfgv003v5ohu9pox0zhk","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-simple-example/java-simple-example-1.png","slug":"java-simple-example-1.png","post":"cl70rsfgt003s5ohu207s65n8","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-simple-example/java-simple-example-2.png","slug":"java-simple-example-2.png","post":"cl70rsfgt003s5ohu207s65n8","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-simple-example/java-simple-example-3.png","slug":"java-simple-example-3.png","post":"cl70rsfgt003s5ohu207s65n8","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-windows/1-jdk-windows.png","slug":"1-jdk-windows.png","post":"cl70rsfgd003d5ohubtwu2lru","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-windows/2-jdk-windows.png","slug":"2-jdk-windows.png","post":"cl70rsfgd003d5ohubtwu2lru","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-windows/3-jdk-windows.png","slug":"3-jdk-windows.png","post":"cl70rsfgd003d5ohubtwu2lru","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-windows/4-jdk-windows.png","slug":"4-jdk-windows.png","post":"cl70rsfgd003d5ohubtwu2lru","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-windows/5-jdk-windows.png","slug":"5-jdk-windows.png","post":"cl70rsfgd003d5ohubtwu2lru","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-windows/6-jdk-windows.png","slug":"6-jdk-windows.png","post":"cl70rsfgd003d5ohubtwu2lru","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-windows/7-jdk-windows.png","slug":"7-jdk-windows.png","post":"cl70rsfgd003d5ohubtwu2lru","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-windows/8-jdk-windows.png","slug":"8-jdk-windows.png","post":"cl70rsfgd003d5ohubtwu2lru","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-windows/9-jdk-windows.png","slug":"9-jdk-windows.png","post":"cl70rsfgd003d5ohubtwu2lru","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-ide/java-ide-1.png","slug":"java-ide-1.png","post":"cl70rsfgo003p5ohu82hier9h","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-ide/java-ide-3.png","slug":"java-ide-3.png","post":"cl70rsfgo003p5ohu82hier9h","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-ide/java-ide-4.png","slug":"java-ide-4.png","post":"cl70rsfgo003p5ohu82hier9h","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-ide/java-ide-5.png","slug":"java-ide-5.png","post":"cl70rsfgo003p5ohu82hier9h","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-ide/java-ide-6.png","slug":"java-ide-6.png","post":"cl70rsfgo003p5ohu82hier9h","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-ide/java-ide-7.png","slug":"java-ide-7.png","post":"cl70rsfgo003p5ohu82hier9h","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-ide/java-ide-8.png","slug":"java-ide-8.png","post":"cl70rsfgo003p5ohu82hier9h","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-ide/java-ide-9.png","slug":"java-ide-9.png","post":"cl70rsfgo003p5ohu82hier9h","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/1-jdk-mac.png","slug":"1-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/10-jdk-mac.png","slug":"10-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/11-jdk-mac.png","slug":"11-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/12-jdk-mac.png","slug":"12-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/13-jdk-mac.png","slug":"13-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/14-jdk-mac.png","slug":"14-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/15-jdk-mac.png","slug":"15-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/16-jdk-mac.png","slug":"16-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/5-jdk-mac.png","slug":"5-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/6-jdk-mac.png","slug":"6-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/7-jdk-mac.png","slug":"7-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/8-jdk-mac.png","slug":"8-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0},{"_id":"source/_posts/java/introduction/java-environment-mac/9-jdk-mac.png","slug":"9-jdk-mac.png","post":"cl70rsfgc003b5ohug4bv93mx","modified":0,"renderable":0}],"PostCategory":[{"post_id":"cl70rsfb300065ohu2ghc4be7","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbb000h5ohuds5ghpwj"},{"post_id":"cl70rsfb8000c5ohu7ah576ex","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbd000l5ohudkls46jg"},{"post_id":"cl70rsfb9000f5ohuak0a9el4","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbe000n5ohuc4iz0txv"},{"post_id":"cl70rsfb400075ohu812jdjxs","category_id":"cl70rsfb9000d5ohuckahdx5v","_id":"cl70rsfbh000r5ohu5vx140ty"},{"post_id":"cl70rsfba000g5ohu5ho9b02j","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbi000u5ohu6lnqczak"},{"post_id":"cl70rsfbd000m5ohu334rbmha","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbj000z5ohugren39c5"},{"post_id":"cl70rsfbf000q5ohu7jjx94bs","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbk00125ohua94thw5b"},{"post_id":"cl70rsfb7000b5ohuhon4f38o","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbl00165ohu6eyf81zt"},{"post_id":"cl70rsfb7000b5ohuhon4f38o","category_id":"cl70rsfbe000o5ohu7ka57f9g","_id":"cl70rsfbm001a5ohufo3ldw1l"},{"post_id":"cl70rsfbh000t5ohubzf01mj3","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbn001c5ohuhha8exd1"},{"post_id":"cl70rsfbj000y5ohua65p291g","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbp001g5ohu52g5b0ch"},{"post_id":"cl70rsfbc000k5ohu16oq97x0","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbq001i5ohuhhx95xyv"},{"post_id":"cl70rsfbc000k5ohu16oq97x0","category_id":"cl70rsfbi000w5ohuccg86wmx","_id":"cl70rsfbr001l5ohu5qq2297t"},{"post_id":"cl70rsfbj00115ohu0wq7hw4y","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbr001n5ohu4osj2dts"},{"post_id":"cl70rsfbk00155ohuf689b5gd","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbt001p5ohugk3phomb"},{"post_id":"cl70rsfb6000a5ohu5zhzbo4j","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbt001r5ohufyneftm5"},{"post_id":"cl70rsfb6000a5ohu5zhzbo4j","category_id":"cl70rsfbe000o5ohu7ka57f9g","_id":"cl70rsfbu001v5ohu1lifeo4a"},{"post_id":"cl70rsfbm00195ohu6z1m6rv7","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbv001x5ohudz8a076v"},{"post_id":"cl70rsfbn001b5ohu702z6i5x","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbv001z5ohufvhf20z1"},{"post_id":"cl70rsfbo001f5ohucfcngr87","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbv00205ohuhlzp479n"},{"post_id":"cl70rsfbq001k5ohu8yu29nc7","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfbw00225ohuhku67zm3"},{"post_id":"cl70rsfbp001h5ohu1zyidzi3","category_id":"cl70rsfbr001m5ohu100072q3","_id":"cl70rsfbw00245ohud48i5eyq"},{"post_id":"cl70rsfbp001h5ohu1zyidzi3","category_id":"cl70rsfbu001u5ohu4xw16h73","_id":"cl70rsfbx00275ohualnc6fu2"},{"post_id":"cl70rsfg800325ohu1sog7nls","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfgb00375ohuc6t25c2l"},{"post_id":"cl70rsfg900335ohuddjgdhwc","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfgb00395ohudbhchiwe"},{"post_id":"cl70rsfg900355ohu6io7ermn","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfgc003c5ohu8bph4mg8"},{"post_id":"cl70rsfga00365ohu9ofp7rvh","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfgd003e5ohu5c555xed"},{"post_id":"cl70rsfgb00385ohu00jv4gds","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfgg003h5ohucs00a8l4"},{"post_id":"cl70rsfgc003b5ohug4bv93mx","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfgj003k5ohu3wrkbyc2"},{"post_id":"cl70rsfgd003d5ohubtwu2lru","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfgm003o5ohuc947ehmu"},{"post_id":"cl70rsfgg003g5ohucflh3ax5","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfgq003q5ohugx4y992f"},{"post_id":"cl70rsfgi003j5ohub2at5aio","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfgt003t5ohu7qekbt3k"},{"post_id":"cl70rsfgl003n5ohu0hy1axga","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfgw003w5ohu0wav7jci"},{"post_id":"cl70rsfgo003p5ohu82hier9h","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfgz003z5ohuacusgay8"},{"post_id":"cl70rsfgt003s5ohu207s65n8","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfh200405ohuerpthdmx"},{"post_id":"cl70rsfgv003v5ohu9pox0zhk","category_id":"cl70rsfb500085ohu9ti75tpk","_id":"cl70rsfh300425ohu87rygmrf"}],"PostTag":[{"post_id":"cl70rsfb300065ohu2ghc4be7","tag_id":"cl70rsfb600095ohudun72i8u","_id":"cl70rsfbh000s5ohu9a1xfz6r"},{"post_id":"cl70rsfb300065ohu2ghc4be7","tag_id":"cl70rsfb9000e5ohu4ig1dbxu","_id":"cl70rsfbi000v5ohu4e7lfwzc"},{"post_id":"cl70rsfb300065ohu2ghc4be7","tag_id":"cl70rsfbb000j5ohuakvv9u85","_id":"cl70rsfbj00105ohu59h08odo"},{"post_id":"cl70rsfb400075ohu812jdjxs","tag_id":"cl70rsfbe000p5ohu5pv06xb2","_id":"cl70rsfbk00135ohu04oga023"},{"post_id":"cl70rsfb6000a5ohu5zhzbo4j","tag_id":"cl70rsfbi000x5ohu9vcx3l3v","_id":"cl70rsfbm00185ohugv3chri9"},{"post_id":"cl70rsfb7000b5ohuhon4f38o","tag_id":"cl70rsfbi000x5ohu9vcx3l3v","_id":"cl70rsfbo001e5ohu6yj8g1xc"},{"post_id":"cl70rsfb8000c5ohu7ah576ex","tag_id":"cl70rsfbn001d5ohudh3wf6dk","_id":"cl70rsfbt001q5ohu9vyngl1m"},{"post_id":"cl70rsfb8000c5ohu7ah576ex","tag_id":"cl70rsfbq001j5ohu3b6sgzzw","_id":"cl70rsfbt001s5ohu1sb94g3d"},{"post_id":"cl70rsfb9000f5ohuak0a9el4","tag_id":"cl70rsfbs001o5ohu5y3m01ue","_id":"cl70rsfbu001w5ohu99lk0cwo"},{"post_id":"cl70rsfba000g5ohu5ho9b02j","tag_id":"cl70rsfbn001d5ohudh3wf6dk","_id":"cl70rsfbw00235ohuaps9dywq"},{"post_id":"cl70rsfba000g5ohu5ho9b02j","tag_id":"cl70rsfbq001j5ohu3b6sgzzw","_id":"cl70rsfbw00255ohubf7408qb"},{"post_id":"cl70rsfbc000k5ohu16oq97x0","tag_id":"cl70rsfbn001d5ohudh3wf6dk","_id":"cl70rsfc8002b5ohu38go7dv6"},{"post_id":"cl70rsfbc000k5ohu16oq97x0","tag_id":"cl70rsfbq001j5ohu3b6sgzzw","_id":"cl70rsfca002c5ohughm510or"},{"post_id":"cl70rsfbc000k5ohu16oq97x0","tag_id":"cl70rsfbx00285ohufwn4aber","_id":"cl70rsfcc002e5ohubqmxad37"},{"post_id":"cl70rsfbc000k5ohu16oq97x0","tag_id":"cl70rsfc200295ohuev09ac82","_id":"cl70rsfcg002f5ohu7cbi1uyq"},{"post_id":"cl70rsfbd000m5ohu334rbmha","tag_id":"cl70rsfbs001o5ohu5y3m01ue","_id":"cl70rsfcj002h5ohu16jb08v8"},{"post_id":"cl70rsfbf000q5ohu7jjx94bs","tag_id":"cl70rsfbs001o5ohu5y3m01ue","_id":"cl70rsfck002i5ohubfve937c"},{"post_id":"cl70rsfbh000t5ohubzf01mj3","tag_id":"cl70rsfbs001o5ohu5y3m01ue","_id":"cl70rsfcm002k5ohu7iym2chx"},{"post_id":"cl70rsfbj000y5ohua65p291g","tag_id":"cl70rsfbs001o5ohu5y3m01ue","_id":"cl70rsfcr002m5ohu77pre1wp"},{"post_id":"cl70rsfbj00115ohu0wq7hw4y","tag_id":"cl70rsfcp002l5ohubkvzd7jj","_id":"cl70rsfcv002o5ohu0ox48kd1"},{"post_id":"cl70rsfbk00155ohuf689b5gd","tag_id":"cl70rsfcp002l5ohubkvzd7jj","_id":"cl70rsfd0002q5ohudkcpfp32"},{"post_id":"cl70rsfbm00195ohu6z1m6rv7","tag_id":"cl70rsfcp002l5ohubkvzd7jj","_id":"cl70rsfd5002s5ohu16pda8r6"},{"post_id":"cl70rsfbn001b5ohu702z6i5x","tag_id":"cl70rsfd5002r5ohugc869aaf","_id":"cl70rsfdc002u5ohu9l4mdvoe"},{"post_id":"cl70rsfbo001f5ohucfcngr87","tag_id":"cl70rsfcp002l5ohubkvzd7jj","_id":"cl70rsfdl002x5ohufosb54ap"},{"post_id":"cl70rsfbo001f5ohucfcngr87","tag_id":"cl70rsfdf002v5ohufn747d0s","_id":"cl70rsfdn002y5ohuadr0bzsq"},{"post_id":"cl70rsfbp001h5ohu1zyidzi3","tag_id":"cl70rsfd5002r5ohugc869aaf","_id":"cl70rsfdq00305ohu0be95tyz"},{"post_id":"cl70rsfbq001k5ohu8yu29nc7","tag_id":"cl70rsfd5002r5ohugc869aaf","_id":"cl70rsfdu00315ohu1asmcw6m"},{"post_id":"cl70rsfg800325ohu1sog7nls","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfgg003i5ohucsda0gfk"},{"post_id":"cl70rsfg800325ohu1sog7nls","tag_id":"cl70rsfgb003a5ohufbs88f9u","_id":"cl70rsfgj003l5ohu6l6r69t4"},{"post_id":"cl70rsfg900335ohuddjgdhwc","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfgt003u5ohu08qh3pvh"},{"post_id":"cl70rsfg900335ohuddjgdhwc","tag_id":"cl70rsfgb003a5ohufbs88f9u","_id":"cl70rsfgw003x5ohuc60m4l74"},{"post_id":"cl70rsfg900355ohu6io7ermn","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfh300435ohu4yx11ahw"},{"post_id":"cl70rsfg900355ohu6io7ermn","tag_id":"cl70rsfgb003a5ohufbs88f9u","_id":"cl70rsfh300445ohuauw13quh"},{"post_id":"cl70rsfga00365ohu9ofp7rvh","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfh300465ohu7bdm7ofy"},{"post_id":"cl70rsfga00365ohu9ofp7rvh","tag_id":"cl70rsfgb003a5ohufbs88f9u","_id":"cl70rsfh300475ohuaf3t5rfk"},{"post_id":"cl70rsfgb00385ohu00jv4gds","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfh300495ohub18dcd3i"},{"post_id":"cl70rsfgb00385ohu00jv4gds","tag_id":"cl70rsfgb003a5ohufbs88f9u","_id":"cl70rsfh3004a5ohuaef4f6ec"},{"post_id":"cl70rsfgc003b5ohug4bv93mx","tag_id":"cl70rsfh300485ohufm0a0kp1","_id":"cl70rsfh3004c5ohua4da0uxh"},{"post_id":"cl70rsfgc003b5ohug4bv93mx","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfh3004d5ohu7pxe6hxs"},{"post_id":"cl70rsfgc003b5ohug4bv93mx","tag_id":"cl70rsfbn001d5ohudh3wf6dk","_id":"cl70rsfh4004f5ohu9rdj983g"},{"post_id":"cl70rsfgd003d5ohubtwu2lru","tag_id":"cl70rsfh300485ohufm0a0kp1","_id":"cl70rsfh4004g5ohue7su60t2"},{"post_id":"cl70rsfgd003d5ohubtwu2lru","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfh4004i5ohu3f8r15lc"},{"post_id":"cl70rsfgd003d5ohubtwu2lru","tag_id":"cl70rsfbn001d5ohudh3wf6dk","_id":"cl70rsfh4004j5ohuck81bo19"},{"post_id":"cl70rsfgg003g5ohucflh3ax5","tag_id":"cl70rsfh300485ohufm0a0kp1","_id":"cl70rsfh4004l5ohudmv90rx2"},{"post_id":"cl70rsfgg003g5ohucflh3ax5","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfh4004m5ohu1onb7mft"},{"post_id":"cl70rsfgi003j5ohub2at5aio","tag_id":"cl70rsfh300485ohufm0a0kp1","_id":"cl70rsfh5004o5ohu8zwma0jg"},{"post_id":"cl70rsfgi003j5ohub2at5aio","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfh5004p5ohu7zr37hn3"},{"post_id":"cl70rsfgl003n5ohu0hy1axga","tag_id":"cl70rsfh300485ohufm0a0kp1","_id":"cl70rsfh5004r5ohu02kpe8w6"},{"post_id":"cl70rsfgl003n5ohu0hy1axga","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfh5004s5ohuf6es1w3c"},{"post_id":"cl70rsfgl003n5ohu0hy1axga","tag_id":"cl70rsfbn001d5ohudh3wf6dk","_id":"cl70rsfh5004u5ohugyf5c67a"},{"post_id":"cl70rsfgo003p5ohu82hier9h","tag_id":"cl70rsfh300485ohufm0a0kp1","_id":"cl70rsfh5004v5ohu7rzf8hpg"},{"post_id":"cl70rsfgo003p5ohu82hier9h","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfh5004w5ohuh21z36m1"},{"post_id":"cl70rsfgo003p5ohu82hier9h","tag_id":"cl70rsfbn001d5ohudh3wf6dk","_id":"cl70rsfh5004x5ohu7eyn42he"},{"post_id":"cl70rsfgt003s5ohu207s65n8","tag_id":"cl70rsfh300485ohufm0a0kp1","_id":"cl70rsfh5004y5ohudqdreax2"},{"post_id":"cl70rsfgt003s5ohu207s65n8","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfh5004z5ohu6j1xguu9"},{"post_id":"cl70rsfgv003v5ohu9pox0zhk","tag_id":"cl70rsfh300485ohufm0a0kp1","_id":"cl70rsfh500505ohucxvdbh6o"},{"post_id":"cl70rsfgv003v5ohu9pox0zhk","tag_id":"cl70rsfg900345ohu7id2hjqz","_id":"cl70rsfh500515ohu7g2j1ksz"}],"Tag":[{"name":"最佳实践","_id":"cl70rsfb600095ohudun72i8u"},{"name":"优雅重试","_id":"cl70rsfb9000e5ohu4ig1dbxu"},{"name":"Spring","_id":"cl70rsfbb000j5ohuakvv9u85"},{"name":"年终总结","_id":"cl70rsfbe000p5ohu5pv06xb2"},{"name":"R","_id":"cl70rsfbi000x5ohu9vcx3l3v"},{"name":"环境搭建","_id":"cl70rsfbn001d5ohudh3wf6dk"},{"name":"Hexo","_id":"cl70rsfbq001j5ohu3b6sgzzw"},{"name":"go","_id":"cl70rsfbs001o5ohu5y3m01ue"},{"name":"github pages","_id":"cl70rsfbx00285ohufwn4aber"},{"name":"travis ci","_id":"cl70rsfc200295ohuev09ac82"},{"name":"RabbitMQ","_id":"cl70rsfcp002l5ohubkvzd7jj"},{"name":"Thoughts","_id":"cl70rsfd5002r5ohugc869aaf"},{"name":"DelayQueue","_id":"cl70rsfdf002v5ohufn747d0s"},{"name":"Java","_id":"cl70rsfg900345ohu7id2hjqz"},{"name":"Java基础","_id":"cl70rsfgb003a5ohufbs88f9u"},{"name":"Java入门","_id":"cl70rsfh300485ohufm0a0kp1"}]}}